!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Stone=e():t.Stone=e()}(window,(function(){return function(t){var e=window.webpackHotUpdateStone;window.webpackHotUpdateStone=function(t,n){!function(t,e){if(!b[t]||!x[t])return;for(var n in x[t]=!1,e)Object.prototype.hasOwnProperty.call(e,n)&&(p[n]=e[n]);0==--g&&0===v&&S()}(t,n),e&&e(t,n)};var n,i=!0,r="04b559931a35b506e0c8",o={},a=[],s=[];function l(t){var e=A[t];if(!e)return E;var i=function(i){return e.hot.active?(A[i]?-1===A[i].parents.indexOf(t)&&A[i].parents.push(t):(a=[t],n=i),-1===e.children.indexOf(i)&&e.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+t),a=[]),E(i)},r=function(t){return{configurable:!0,enumerable:!0,get:function(){return E[t]},set:function(e){E[t]=e}}};for(var o in E)Object.prototype.hasOwnProperty.call(E,o)&&"e"!==o&&"t"!==o&&Object.defineProperty(i,o,r(o));return i.e=function(t){return"ready"===h&&f("prepare"),v++,E.e(t).then(e,(function(t){throw e(),t}));function e(){v--,"prepare"===h&&(y[t]||M(t),0===v&&0===g&&S())}},i.t=function(t,e){return 1&e&&(t=i(t)),E.t(t,-2&e)},i}function c(t){var e={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==t,active:!0,accept:function(t,n){if(void 0===t)e._selfAccepted=!0;else if("function"==typeof t)e._selfAccepted=t;else if("object"==typeof t)for(var i=0;i<t.length;i++)e._acceptedDependencies[t[i]]=n||function(){};else e._acceptedDependencies[t]=n||function(){}},decline:function(t){if(void 0===t)e._selfDeclined=!0;else if("object"==typeof t)for(var n=0;n<t.length;n++)e._declinedDependencies[t[n]]=!0;else e._declinedDependencies[t]=!0},dispose:function(t){e._disposeHandlers.push(t)},addDisposeHandler:function(t){e._disposeHandlers.push(t)},removeDisposeHandler:function(t){var n=e._disposeHandlers.indexOf(t);n>=0&&e._disposeHandlers.splice(n,1)},check:_,apply:T,status:function(t){if(!t)return h;u.push(t)},addStatusHandler:function(t){u.push(t)},removeStatusHandler:function(t){var e=u.indexOf(t);e>=0&&u.splice(e,1)},data:o[t]};return n=void 0,e}var u=[],h="idle";function f(t){h=t;for(var e=0;e<u.length;e++)u[e].call(null,t)}var d,p,m,g=0,v=0,y={},x={},b={};function w(t){return+t+""===t?+t:t}function _(t){if("idle"!==h)throw new Error("check() is only allowed in idle status");return i=t,f("check"),(e=1e4,e=e||1e4,new Promise((function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var i=new XMLHttpRequest,o=E.p+""+r+".hot-update.json";i.open("GET",o,!0),i.timeout=e,i.send(null)}catch(t){return n(t)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===i.status)t();else if(200!==i.status&&304!==i.status)n(new Error("Manifest request to "+o+" failed."));else{try{var e=JSON.parse(i.responseText)}catch(t){return void n(t)}t(e)}}}))).then((function(t){if(!t)return f("idle"),null;x={},y={},b=t.c,m=t.h,f("prepare");var e=new Promise((function(t,e){d={resolve:t,reject:e}}));p={};return M(1),"prepare"===h&&0===v&&0===g&&S(),e}));var e}function M(t){b[t]?(x[t]=!0,g++,function(t){var e=document.createElement("script");e.charset="utf-8",e.src=E.p+""+t+"."+r+".hot-update.js",document.head.appendChild(e)}(t)):y[t]=!0}function S(){f("ready");var t=d;if(d=null,t)if(i)Promise.resolve().then((function(){return T(i)})).then((function(e){t.resolve(e)}),(function(e){t.reject(e)}));else{var e=[];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&e.push(w(n));t.resolve(e)}}function T(e){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var n,i,s,l,c;function u(t){for(var e=[t],n={},i=e.map((function(t){return{chain:[t],id:t}}));i.length>0;){var r=i.pop(),o=r.id,a=r.chain;if((l=A[o])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:o};if(l.hot._main)return{type:"unaccepted",chain:a,moduleId:o};for(var s=0;s<l.parents.length;s++){var c=l.parents[s],u=A[c];if(u){if(u.hot._declinedDependencies[o])return{type:"declined",chain:a.concat([c]),moduleId:o,parentId:c};-1===e.indexOf(c)&&(u.hot._acceptedDependencies[o]?(n[c]||(n[c]=[]),d(n[c],[o])):(delete n[c],e.push(c),i.push({chain:a.concat([c]),id:c})))}}}}return{type:"accepted",moduleId:t,outdatedModules:e,outdatedDependencies:n}}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];-1===t.indexOf(i)&&t.push(i)}}e=e||{};var g={},v=[],y={},x=function(){console.warn("[HMR] unexpected require("+M.moduleId+") to disposed module")};for(var _ in p)if(Object.prototype.hasOwnProperty.call(p,_)){var M;c=w(_);var S=!1,T=!1,q=!1,C="";switch((M=p[_]?u(c):{type:"disposed",moduleId:_}).chain&&(C="\nUpdate propagation: "+M.chain.join(" -> ")),M.type){case"self-declined":e.onDeclined&&e.onDeclined(M),e.ignoreDeclined||(S=new Error("Aborted because of self decline: "+M.moduleId+C));break;case"declined":e.onDeclined&&e.onDeclined(M),e.ignoreDeclined||(S=new Error("Aborted because of declined dependency: "+M.moduleId+" in "+M.parentId+C));break;case"unaccepted":e.onUnaccepted&&e.onUnaccepted(M),e.ignoreUnaccepted||(S=new Error("Aborted because "+c+" is not accepted"+C));break;case"accepted":e.onAccepted&&e.onAccepted(M),T=!0;break;case"disposed":e.onDisposed&&e.onDisposed(M),q=!0;break;default:throw new Error("Unexception type "+M.type)}if(S)return f("abort"),Promise.reject(S);if(T)for(c in y[c]=p[c],d(v,M.outdatedModules),M.outdatedDependencies)Object.prototype.hasOwnProperty.call(M.outdatedDependencies,c)&&(g[c]||(g[c]=[]),d(g[c],M.outdatedDependencies[c]));q&&(d(v,[M.moduleId]),y[c]=x)}var P,R=[];for(i=0;i<v.length;i++)c=v[i],A[c]&&A[c].hot._selfAccepted&&y[c]!==x&&R.push({module:c,errorHandler:A[c].hot._selfAccepted});f("dispose"),Object.keys(b).forEach((function(t){!1===b[t]&&function(t){delete installedChunks[t]}(t)}));for(var L,I,D=v.slice();D.length>0;)if(c=D.pop(),l=A[c]){var O={},N=l.hot._disposeHandlers;for(s=0;s<N.length;s++)(n=N[s])(O);for(o[c]=O,l.hot.active=!1,delete A[c],delete g[c],s=0;s<l.children.length;s++){var F=A[l.children[s]];F&&((P=F.parents.indexOf(c))>=0&&F.parents.splice(P,1))}}for(c in g)if(Object.prototype.hasOwnProperty.call(g,c)&&(l=A[c]))for(I=g[c],s=0;s<I.length;s++)L=I[s],(P=l.children.indexOf(L))>=0&&l.children.splice(P,1);for(c in f("apply"),r=m,y)Object.prototype.hasOwnProperty.call(y,c)&&(t[c]=y[c]);var B=null;for(c in g)if(Object.prototype.hasOwnProperty.call(g,c)&&(l=A[c])){I=g[c];var z=[];for(i=0;i<I.length;i++)if(L=I[i],n=l.hot._acceptedDependencies[L]){if(-1!==z.indexOf(n))continue;z.push(n)}for(i=0;i<z.length;i++){n=z[i];try{n(I)}catch(t){e.onErrored&&e.onErrored({type:"accept-errored",moduleId:c,dependencyId:I[i],error:t}),e.ignoreErrored||B||(B=t)}}}for(i=0;i<R.length;i++){var U=R[i];c=U.module,a=[c];try{E(c)}catch(t){if("function"==typeof U.errorHandler)try{U.errorHandler(t)}catch(n){e.onErrored&&e.onErrored({type:"self-accept-error-handler-errored",moduleId:c,error:n,originalError:t}),e.ignoreErrored||B||(B=n),B||(B=t)}else e.onErrored&&e.onErrored({type:"self-accept-errored",moduleId:c,error:t}),e.ignoreErrored||B||(B=t)}}return B?(f("fail"),Promise.reject(B)):(f("idle"),new Promise((function(t){t(v)})))}var A={};function E(e){if(A[e])return A[e].exports;var n=A[e]={i:e,l:!1,exports:{},hot:c(e),parents:(s=a,a=[],s),children:[]};return t[e].call(n.exports,n,n.exports,l(e)),n.l=!0,n.exports}return E.m=t,E.c=A,E.d=function(t,e,n){E.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},E.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},E.t=function(t,e){if(1&e&&(t=E(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(E.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)E.d(n,i,function(e){return t[e]}.bind(null,i));return n},E.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return E.d(e,"a",e),e},E.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},E.p="",E.h=function(){return r},l(4)(E.s=4)}([function(t,e,n){"use strict";n.r(e),n.d(e,"ACESFilmicToneMapping",(function(){return nt})),n.d(e,"AddEquation",(function(){return T})),n.d(e,"AddOperation",(function(){return J})),n.d(e,"AdditiveAnimationBlendMode",(function(){return We})),n.d(e,"AdditiveBlending",(function(){return w})),n.d(e,"AlphaFormat",(function(){return Nt})),n.d(e,"AlwaysDepth",(function(){return j})),n.d(e,"AlwaysStencilFunc",(function(){return Sn})),n.d(e,"AmbientLight",(function(){return Th})),n.d(e,"AmbientLightProbe",(function(){return Yh})),n.d(e,"AnimationClip",(function(){return Lu})),n.d(e,"AnimationLoader",(function(){return Uu})),n.d(e,"AnimationMixer",(function(){return Tf})),n.d(e,"AnimationObjectGroup",(function(){return Mf})),n.d(e,"AnimationUtils",(function(){return xu})),n.d(e,"ArcCurve",(function(){return Yu})),n.d(e,"ArrayCamera",(function(){return Ds})),n.d(e,"ArrowHelper",(function(){return pd})),n.d(e,"Audio",(function(){return of})),n.d(e,"AudioAnalyser",(function(){return hf})),n.d(e,"AudioContext",(function(){return Hh})),n.d(e,"AudioListener",(function(){return rf})),n.d(e,"AudioLoader",(function(){return Wh})),n.d(e,"AxesHelper",(function(){return md})),n.d(e,"AxisHelper",(function(){return up})),n.d(e,"BackSide",(function(){return m})),n.d(e,"BasicDepthPacking",(function(){return on})),n.d(e,"BasicShadowMap",(function(){return u})),n.d(e,"BinaryTextureLoader",(function(){return mp})),n.d(e,"Bone",(function(){return yl})),n.d(e,"BooleanKeyframeTrack",(function(){return Tu})),n.d(e,"BoundingBoxHelper",(function(){return hp})),n.d(e,"Box2",(function(){return Of})),n.d(e,"Box3",(function(){return $n})),n.d(e,"Box3Helper",(function(){return cd})),n.d(e,"BoxBufferGeometry",(function(){return vo})),n.d(e,"BoxGeometry",(function(){return go})),n.d(e,"BoxHelper",(function(){return ld})),n.d(e,"BufferAttribute",(function(){return Sr})),n.d(e,"BufferGeometry",(function(){return Vr})),n.d(e,"BufferGeometryLoader",(function(){return Ih})),n.d(e,"ByteType",(function(){return Tt})),n.d(e,"Cache",(function(){return Du})),n.d(e,"Camera",(function(){return _o})),n.d(e,"CameraHelper",(function(){return od})),n.d(e,"CanvasRenderer",(function(){return yp})),n.d(e,"CanvasTexture",(function(){return Gl})),n.d(e,"CatmullRomCurve3",(function(){return th})),n.d(e,"CineonToneMapping",(function(){return et})),n.d(e,"CircleBufferGeometry",(function(){return au})),n.d(e,"CircleGeometry",(function(){return ou})),n.d(e,"ClampToEdgeWrapping",(function(){return ft})),n.d(e,"Clock",(function(){return Kh})),n.d(e,"ClosedSplineCurve3",(function(){return sp})),n.d(e,"Color",(function(){return vr})),n.d(e,"ColorKeyframeTrack",(function(){return Au})),n.d(e,"CompressedTexture",(function(){return Vl})),n.d(e,"CompressedTextureLoader",(function(){return ku})),n.d(e,"ConeBufferGeometry",(function(){return ru})),n.d(e,"ConeGeometry",(function(){return iu})),n.d(e,"CubeCamera",(function(){return So})),n.d(e,"CubeGeometry",(function(){return go})),n.d(e,"CubeReflectionMapping",(function(){return ot})),n.d(e,"CubeRefractionMapping",(function(){return at})),n.d(e,"CubeTexture",(function(){return Jo})),n.d(e,"CubeTextureLoader",(function(){return Vu})),n.d(e,"CubeUVReflectionMapping",(function(){return ct})),n.d(e,"CubeUVRefractionMapping",(function(){return ut})),n.d(e,"CubicBezierCurve",(function(){return rh})),n.d(e,"CubicBezierCurve3",(function(){return oh})),n.d(e,"CubicInterpolant",(function(){return wu})),n.d(e,"CullFaceBack",(function(){return s})),n.d(e,"CullFaceFront",(function(){return l})),n.d(e,"CullFaceFrontBack",(function(){return c})),n.d(e,"CullFaceNone",(function(){return a})),n.d(e,"Curve",(function(){return Wu})),n.d(e,"CurvePath",(function(){return fh})),n.d(e,"CustomBlending",(function(){return S})),n.d(e,"CustomToneMapping",(function(){return it})),n.d(e,"CylinderBufferGeometry",(function(){return nu})),n.d(e,"CylinderGeometry",(function(){return eu})),n.d(e,"Cylindrical",(function(){return If})),n.d(e,"DataTexture",(function(){return Ao})),n.d(e,"DataTexture2DArray",(function(){return Ko})),n.d(e,"DataTexture3D",(function(){return $o})),n.d(e,"DataTextureLoader",(function(){return Gu})),n.d(e,"DecrementStencilOp",(function(){return dn})),n.d(e,"DecrementWrapStencilOp",(function(){return mn})),n.d(e,"DefaultLoadingManager",(function(){return Nu})),n.d(e,"DepthFormat",(function(){return jt})),n.d(e,"DepthStencilFormat",(function(){return Vt})),n.d(e,"DepthTexture",(function(){return Hl})),n.d(e,"DirectionalLight",(function(){return Sh})),n.d(e,"DirectionalLightHelper",(function(){return nd})),n.d(e,"DiscreteInterpolant",(function(){return Mu})),n.d(e,"DodecahedronBufferGeometry",(function(){return rc})),n.d(e,"DodecahedronGeometry",(function(){return ic})),n.d(e,"DoubleSide",(function(){return g})),n.d(e,"DstAlphaFactor",(function(){return N})),n.d(e,"DstColorFactor",(function(){return B})),n.d(e,"DynamicBufferAttribute",(function(){return Jd})),n.d(e,"DynamicCopyUsage",(function(){return Ln})),n.d(e,"DynamicDrawUsage",(function(){return An})),n.d(e,"DynamicReadUsage",(function(){return Cn})),n.d(e,"EdgesGeometry",(function(){return tu})),n.d(e,"EdgesHelper",(function(){return fp})),n.d(e,"EllipseCurve",(function(){return Xu})),n.d(e,"EqualDepth",(function(){return H})),n.d(e,"EqualStencilFunc",(function(){return xn})),n.d(e,"EquirectangularReflectionMapping",(function(){return st})),n.d(e,"EquirectangularRefractionMapping",(function(){return lt})),n.d(e,"Euler",(function(){return Li})),n.d(e,"EventDispatcher",(function(){return Nn})),n.d(e,"ExtrudeBufferGeometry",(function(){return Uc})),n.d(e,"ExtrudeGeometry",(function(){return zc})),n.d(e,"Face3",(function(){return yr})),n.d(e,"Face4",(function(){return Nd})),n.d(e,"FaceColors",(function(){return Ud})),n.d(e,"FileLoader",(function(){return zu})),n.d(e,"FlatShading",(function(){return v})),n.d(e,"Float32Attribute",(function(){return op})),n.d(e,"Float32BufferAttribute",(function(){return Lr})),n.d(e,"Float64Attribute",(function(){return ap})),n.d(e,"Float64BufferAttribute",(function(){return Ir})),n.d(e,"FloatType",(function(){return Pt})),n.d(e,"Fog",(function(){return Gs})),n.d(e,"FogExp2",(function(){return Vs})),n.d(e,"Font",(function(){return kh})),n.d(e,"FontLoader",(function(){return Vh})),n.d(e,"FrontSide",(function(){return p})),n.d(e,"Frustum",(function(){return Co})),n.d(e,"GLBufferAttribute",(function(){return qf})),n.d(e,"GLSL1",(function(){return Dn})),n.d(e,"GLSL3",(function(){return On})),n.d(e,"GammaEncoding",(function(){return Ke})),n.d(e,"Geometry",(function(){return mo})),n.d(e,"GeometryUtils",(function(){return vp})),n.d(e,"GreaterDepth",(function(){return X})),n.d(e,"GreaterEqualDepth",(function(){return W})),n.d(e,"GreaterEqualStencilFunc",(function(){return Mn})),n.d(e,"GreaterStencilFunc",(function(){return wn})),n.d(e,"GridHelper",(function(){return Jf})),n.d(e,"Group",(function(){return Is})),n.d(e,"HalfFloatType",(function(){return Rt})),n.d(e,"HemisphereLight",(function(){return gh})),n.d(e,"HemisphereLightHelper",(function(){return Qf})),n.d(e,"HemisphereLightProbe",(function(){return Xh})),n.d(e,"IcosahedronBufferGeometry",(function(){return nc})),n.d(e,"IcosahedronGeometry",(function(){return ec})),n.d(e,"ImageBitmapLoader",(function(){return zh})),n.d(e,"ImageLoader",(function(){return ju})),n.d(e,"ImageUtils",(function(){return Vn})),n.d(e,"ImmediateRenderObject",(function(){return zf})),n.d(e,"IncrementStencilOp",(function(){return fn})),n.d(e,"IncrementWrapStencilOp",(function(){return pn})),n.d(e,"InstancedBufferAttribute",(function(){return Lh})),n.d(e,"InstancedBufferGeometry",(function(){return Rh})),n.d(e,"InstancedInterleavedBuffer",(function(){return Ef})),n.d(e,"InstancedMesh",(function(){return Ml})),n.d(e,"Int16Attribute",(function(){return ep})),n.d(e,"Int16BufferAttribute",(function(){return qr})),n.d(e,"Int32Attribute",(function(){return ip})),n.d(e,"Int32BufferAttribute",(function(){return Pr})),n.d(e,"Int8Attribute",(function(){return Kd})),n.d(e,"Int8BufferAttribute",(function(){return Tr})),n.d(e,"IntType",(function(){return qt})),n.d(e,"InterleavedBuffer",(function(){return Ws})),n.d(e,"InterleavedBufferAttribute",(function(){return Ys})),n.d(e,"Interpolant",(function(){return bu})),n.d(e,"InterpolateDiscrete",(function(){return ze})),n.d(e,"InterpolateLinear",(function(){return Ue})),n.d(e,"InterpolateSmooth",(function(){return ke})),n.d(e,"InvertStencilOp",(function(){return gn})),n.d(e,"JSONLoader",(function(){return xp})),n.d(e,"KeepStencilOp",(function(){return un})),n.d(e,"KeyframeTrack",(function(){return Su})),n.d(e,"LOD",(function(){return dl})),n.d(e,"LatheBufferGeometry",(function(){return Qc})),n.d(e,"LatheGeometry",(function(){return Zc})),n.d(e,"Layers",(function(){return Oi})),n.d(e,"LensFlare",(function(){return wp})),n.d(e,"LessDepth",(function(){return V})),n.d(e,"LessEqualDepth",(function(){return G})),n.d(e,"LessEqualStencilFunc",(function(){return bn})),n.d(e,"LessStencilFunc",(function(){return yn})),n.d(e,"Light",(function(){return mh})),n.d(e,"LightProbe",(function(){return qh})),n.d(e,"LightShadow",(function(){return vh})),n.d(e,"Line",(function(){return Pl})),n.d(e,"Line3",(function(){return Bf})),n.d(e,"LineBasicMaterial",(function(){return Sl})),n.d(e,"LineCurve",(function(){return ah})),n.d(e,"LineCurve3",(function(){return sh})),n.d(e,"LineDashedMaterial",(function(){return vu})),n.d(e,"LineLoop",(function(){return Dl})),n.d(e,"LinePieces",(function(){return Bd})),n.d(e,"LineSegments",(function(){return Il})),n.d(e,"LineStrip",(function(){return Fd})),n.d(e,"LinearEncoding",(function(){return Qe})),n.d(e,"LinearFilter",(function(){return xt})),n.d(e,"LinearInterpolant",(function(){return _u})),n.d(e,"LinearMipMapLinearFilter",(function(){return Mt})),n.d(e,"LinearMipMapNearestFilter",(function(){return wt})),n.d(e,"LinearMipmapLinearFilter",(function(){return _t})),n.d(e,"LinearMipmapNearestFilter",(function(){return bt})),n.d(e,"LinearToneMapping",(function(){return $})),n.d(e,"Loader",(function(){return Fu})),n.d(e,"LoaderUtils",(function(){return Ph})),n.d(e,"LoadingManager",(function(){return Ou})),n.d(e,"LogLuvEncoding",(function(){return tn})),n.d(e,"LoopOnce",(function(){return Ne})),n.d(e,"LoopPingPong",(function(){return Be})),n.d(e,"LoopRepeat",(function(){return Fe})),n.d(e,"LuminanceAlphaFormat",(function(){return Ut})),n.d(e,"LuminanceFormat",(function(){return zt})),n.d(e,"MOUSE",(function(){return r})),n.d(e,"Material",(function(){return br})),n.d(e,"MaterialLoader",(function(){return Ch})),n.d(e,"Math",(function(){return zn})),n.d(e,"MathUtils",(function(){return zn})),n.d(e,"Matrix3",(function(){return kn})),n.d(e,"Matrix4",(function(){return Si})),n.d(e,"MaxEquation",(function(){return C})),n.d(e,"Mesh",(function(){return so})),n.d(e,"MeshBasicMaterial",(function(){return wr})),n.d(e,"MeshDepthMaterial",(function(){return Es})),n.d(e,"MeshDistanceMaterial",(function(){return qs})),n.d(e,"MeshFaceMaterial",(function(){return jd})),n.d(e,"MeshLambertMaterial",(function(){return mu})),n.d(e,"MeshMatcapMaterial",(function(){return gu})),n.d(e,"MeshNormalMaterial",(function(){return pu})),n.d(e,"MeshPhongMaterial",(function(){return fu})),n.d(e,"MeshPhysicalMaterial",(function(){return hu})),n.d(e,"MeshStandardMaterial",(function(){return uu})),n.d(e,"MeshToonMaterial",(function(){return du})),n.d(e,"MinEquation",(function(){return q})),n.d(e,"MirroredRepeatWrapping",(function(){return dt})),n.d(e,"MixOperation",(function(){return Q})),n.d(e,"MultiMaterial",(function(){return Vd})),n.d(e,"MultiplyBlending",(function(){return M})),n.d(e,"MultiplyOperation",(function(){return Z})),n.d(e,"NearestFilter",(function(){return pt})),n.d(e,"NearestMipMapLinearFilter",(function(){return yt})),n.d(e,"NearestMipMapNearestFilter",(function(){return gt})),n.d(e,"NearestMipmapLinearFilter",(function(){return vt})),n.d(e,"NearestMipmapNearestFilter",(function(){return mt})),n.d(e,"NeverDepth",(function(){return k})),n.d(e,"NeverStencilFunc",(function(){return vn})),n.d(e,"NoBlending",(function(){return x})),n.d(e,"NoColors",(function(){return zd})),n.d(e,"NoToneMapping",(function(){return K})),n.d(e,"NormalAnimationBlendMode",(function(){return He})),n.d(e,"NormalBlending",(function(){return b})),n.d(e,"NotEqualDepth",(function(){return Y})),n.d(e,"NotEqualStencilFunc",(function(){return _n})),n.d(e,"NumberKeyframeTrack",(function(){return Eu})),n.d(e,"Object3D",(function(){return Zi})),n.d(e,"ObjectLoader",(function(){return Oh})),n.d(e,"ObjectSpaceNormalMap",(function(){return ln})),n.d(e,"OctahedronBufferGeometry",(function(){return tc})),n.d(e,"OctahedronGeometry",(function(){return $l})),n.d(e,"OneFactor",(function(){return R})),n.d(e,"OneMinusDstAlphaFactor",(function(){return F})),n.d(e,"OneMinusDstColorFactor",(function(){return z})),n.d(e,"OneMinusSrcAlphaFactor",(function(){return O})),n.d(e,"OneMinusSrcColorFactor",(function(){return I})),n.d(e,"OrthographicCamera",(function(){return _h})),n.d(e,"PCFShadowMap",(function(){return h})),n.d(e,"PCFSoftShadowMap",(function(){return f})),n.d(e,"PMREMGenerator",(function(){return qd})),n.d(e,"ParametricBufferGeometry",(function(){return Yl})),n.d(e,"ParametricGeometry",(function(){return Xl})),n.d(e,"Particle",(function(){return Hd})),n.d(e,"ParticleBasicMaterial",(function(){return Yd})),n.d(e,"ParticleSystem",(function(){return Wd})),n.d(e,"ParticleSystemMaterial",(function(){return Zd})),n.d(e,"Path",(function(){return dh})),n.d(e,"PerspectiveCamera",(function(){return Mo})),n.d(e,"Plane",(function(){return $i})),n.d(e,"PlaneBufferGeometry",(function(){return Io})),n.d(e,"PlaneGeometry",(function(){return Lo})),n.d(e,"PlaneHelper",(function(){return ud})),n.d(e,"PointCloud",(function(){return Gd})),n.d(e,"PointCloudMaterial",(function(){return Xd})),n.d(e,"PointLight",(function(){return wh})),n.d(e,"PointLightHelper",(function(){return Wf})),n.d(e,"Points",(function(){return Ul})),n.d(e,"PointsMaterial",(function(){return Ol})),n.d(e,"PolarGridHelper",(function(){return Kf})),n.d(e,"PolyhedronBufferGeometry",(function(){return Ql})),n.d(e,"PolyhedronGeometry",(function(){return Zl})),n.d(e,"PositionalAudio",(function(){return uf})),n.d(e,"PropertyBinding",(function(){return _f})),n.d(e,"PropertyMixer",(function(){return ff})),n.d(e,"QuadraticBezierCurve",(function(){return lh})),n.d(e,"QuadraticBezierCurve3",(function(){return ch})),n.d(e,"Quaternion",(function(){return Zn})),n.d(e,"QuaternionKeyframeTrack",(function(){return Cu})),n.d(e,"QuaternionLinearInterpolant",(function(){return qu})),n.d(e,"REVISION",(function(){return i})),n.d(e,"RGBADepthPacking",(function(){return an})),n.d(e,"RGBAFormat",(function(){return Bt})),n.d(e,"RGBAIntegerFormat",(function(){return Zt})),n.d(e,"RGBA_ASTC_10x10_Format",(function(){return ye})),n.d(e,"RGBA_ASTC_10x5_Format",(function(){return me})),n.d(e,"RGBA_ASTC_10x6_Format",(function(){return ge})),n.d(e,"RGBA_ASTC_10x8_Format",(function(){return ve})),n.d(e,"RGBA_ASTC_12x10_Format",(function(){return xe})),n.d(e,"RGBA_ASTC_12x12_Format",(function(){return be})),n.d(e,"RGBA_ASTC_4x4_Format",(function(){return se})),n.d(e,"RGBA_ASTC_5x4_Format",(function(){return le})),n.d(e,"RGBA_ASTC_5x5_Format",(function(){return ce})),n.d(e,"RGBA_ASTC_6x5_Format",(function(){return ue})),n.d(e,"RGBA_ASTC_6x6_Format",(function(){return he})),n.d(e,"RGBA_ASTC_8x5_Format",(function(){return fe})),n.d(e,"RGBA_ASTC_8x6_Format",(function(){return de})),n.d(e,"RGBA_ASTC_8x8_Format",(function(){return pe})),n.d(e,"RGBA_BPTC_Format",(function(){return we})),n.d(e,"RGBA_ETC2_EAC_Format",(function(){return ae})),n.d(e,"RGBA_PVRTC_2BPPV1_Format",(function(){return ie})),n.d(e,"RGBA_PVRTC_4BPPV1_Format",(function(){return ne})),n.d(e,"RGBA_S3TC_DXT1_Format",(function(){return Jt})),n.d(e,"RGBA_S3TC_DXT3_Format",(function(){return Kt})),n.d(e,"RGBA_S3TC_DXT5_Format",(function(){return $t})),n.d(e,"RGBDEncoding",(function(){return rn})),n.d(e,"RGBEEncoding",(function(){return $e})),n.d(e,"RGBEFormat",(function(){return kt})),n.d(e,"RGBFormat",(function(){return Ft})),n.d(e,"RGBIntegerFormat",(function(){return Yt})),n.d(e,"RGBM16Encoding",(function(){return nn})),n.d(e,"RGBM7Encoding",(function(){return en})),n.d(e,"RGB_ETC1_Format",(function(){return re})),n.d(e,"RGB_ETC2_Format",(function(){return oe})),n.d(e,"RGB_PVRTC_2BPPV1_Format",(function(){return ee})),n.d(e,"RGB_PVRTC_4BPPV1_Format",(function(){return te})),n.d(e,"RGB_S3TC_DXT1_Format",(function(){return Qt})),n.d(e,"RGFormat",(function(){return Wt})),n.d(e,"RGIntegerFormat",(function(){return Xt})),n.d(e,"RawShaderMaterial",(function(){return cu})),n.d(e,"Ray",(function(){return Mi})),n.d(e,"Raycaster",(function(){return Cf})),n.d(e,"RectAreaLight",(function(){return Ah})),n.d(e,"RedFormat",(function(){return Gt})),n.d(e,"RedIntegerFormat",(function(){return Ht})),n.d(e,"ReinhardToneMapping",(function(){return tt})),n.d(e,"RepeatWrapping",(function(){return ht})),n.d(e,"ReplaceStencilOp",(function(){return hn})),n.d(e,"ReverseSubtractEquation",(function(){return E})),n.d(e,"RingBufferGeometry",(function(){return Yc})),n.d(e,"RingGeometry",(function(){return Xc})),n.d(e,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return Ie})),n.d(e,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Pe})),n.d(e,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return Re})),n.d(e,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return Le})),n.d(e,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return De})),n.d(e,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return Oe})),n.d(e,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return _e})),n.d(e,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return Me})),n.d(e,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return Se})),n.d(e,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return Te})),n.d(e,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return Ae})),n.d(e,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return Ee})),n.d(e,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return qe})),n.d(e,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return Ce})),n.d(e,"Scene",(function(){return Hs})),n.d(e,"SceneUtils",(function(){return bp})),n.d(e,"ShaderChunk",(function(){return Do})),n.d(e,"ShaderLib",(function(){return No})),n.d(e,"ShaderMaterial",(function(){return wo})),n.d(e,"ShadowMaterial",(function(){return lu})),n.d(e,"Shape",(function(){return ph})),n.d(e,"ShapeBufferGeometry",(function(){return Kc})),n.d(e,"ShapeGeometry",(function(){return Jc})),n.d(e,"ShapePath",(function(){return Uh})),n.d(e,"ShapeUtils",(function(){return Nc})),n.d(e,"ShortType",(function(){return At})),n.d(e,"Skeleton",(function(){return vl})),n.d(e,"SkeletonHelper",(function(){return Hf})),n.d(e,"SkinnedMesh",(function(){return pl})),n.d(e,"SmoothShading",(function(){return y})),n.d(e,"Sphere",(function(){return mi})),n.d(e,"SphereBufferGeometry",(function(){return Wc})),n.d(e,"SphereGeometry",(function(){return Hc})),n.d(e,"Spherical",(function(){return Lf})),n.d(e,"SphericalHarmonics3",(function(){return Eh})),n.d(e,"Spline",(function(){return cp})),n.d(e,"SplineCurve",(function(){return uh})),n.d(e,"SplineCurve3",(function(){return lp})),n.d(e,"SpotLight",(function(){return xh})),n.d(e,"SpotLightHelper",(function(){return kf})),n.d(e,"Sprite",(function(){return cl})),n.d(e,"SpriteMaterial",(function(){return Zs})),n.d(e,"SrcAlphaFactor",(function(){return D})),n.d(e,"SrcAlphaSaturateFactor",(function(){return U})),n.d(e,"SrcColorFactor",(function(){return L})),n.d(e,"StaticCopyUsage",(function(){return Rn})),n.d(e,"StaticDrawUsage",(function(){return Tn})),n.d(e,"StaticReadUsage",(function(){return qn})),n.d(e,"StereoCamera",(function(){return Jh})),n.d(e,"StreamCopyUsage",(function(){return In})),n.d(e,"StreamDrawUsage",(function(){return En})),n.d(e,"StreamReadUsage",(function(){return Pn})),n.d(e,"StringKeyframeTrack",(function(){return Pu})),n.d(e,"SubtractEquation",(function(){return A})),n.d(e,"SubtractiveBlending",(function(){return _})),n.d(e,"TOUCH",(function(){return o})),n.d(e,"TangentSpaceNormalMap",(function(){return sn})),n.d(e,"TetrahedronBufferGeometry",(function(){return Kl})),n.d(e,"TetrahedronGeometry",(function(){return Jl})),n.d(e,"TextBufferGeometry",(function(){return Gc})),n.d(e,"TextGeometry",(function(){return Vc})),n.d(e,"Texture",(function(){return Hn})),n.d(e,"TextureLoader",(function(){return Hu})),n.d(e,"TorusBufferGeometry",(function(){return uc})),n.d(e,"TorusGeometry",(function(){return cc})),n.d(e,"TorusKnotBufferGeometry",(function(){return lc})),n.d(e,"TorusKnotGeometry",(function(){return sc})),n.d(e,"Triangle",(function(){return ur})),n.d(e,"TriangleFanDrawMode",(function(){return Ze})),n.d(e,"TriangleStripDrawMode",(function(){return Ye})),n.d(e,"TrianglesDrawMode",(function(){return Xe})),n.d(e,"TubeBufferGeometry",(function(){return ac})),n.d(e,"TubeGeometry",(function(){return oc})),n.d(e,"UVMapping",(function(){return rt})),n.d(e,"Uint16Attribute",(function(){return np})),n.d(e,"Uint16BufferAttribute",(function(){return Cr})),n.d(e,"Uint32Attribute",(function(){return rp})),n.d(e,"Uint32BufferAttribute",(function(){return Rr})),n.d(e,"Uint8Attribute",(function(){return $d})),n.d(e,"Uint8BufferAttribute",(function(){return Ar})),n.d(e,"Uint8ClampedAttribute",(function(){return tp})),n.d(e,"Uint8ClampedBufferAttribute",(function(){return Er})),n.d(e,"Uniform",(function(){return Af})),n.d(e,"UniformsLib",(function(){return Oo})),n.d(e,"UniformsUtils",(function(){return bo})),n.d(e,"UnsignedByteType",(function(){return St})),n.d(e,"UnsignedInt248Type",(function(){return Ot})),n.d(e,"UnsignedIntType",(function(){return Ct})),n.d(e,"UnsignedShort4444Type",(function(){return Lt})),n.d(e,"UnsignedShort5551Type",(function(){return It})),n.d(e,"UnsignedShort565Type",(function(){return Dt})),n.d(e,"UnsignedShortType",(function(){return Et})),n.d(e,"VSMShadowMap",(function(){return d})),n.d(e,"Vector2",(function(){return Un})),n.d(e,"Vector3",(function(){return Qn})),n.d(e,"Vector4",(function(){return Wn})),n.d(e,"VectorKeyframeTrack",(function(){return Ru})),n.d(e,"Vertex",(function(){return Qd})),n.d(e,"VertexColors",(function(){return kd})),n.d(e,"VideoTexture",(function(){return jl})),n.d(e,"WebGL1Renderer",(function(){return js})),n.d(e,"WebGLCubeRenderTarget",(function(){return To})),n.d(e,"WebGLMultisampleRenderTarget",(function(){return Yn})),n.d(e,"WebGLRenderTarget",(function(){return Xn})),n.d(e,"WebGLRenderTargetCube",(function(){return gp})),n.d(e,"WebGLRenderer",(function(){return ks})),n.d(e,"WebGLUtils",(function(){return Ls})),n.d(e,"WireframeGeometry",(function(){return Wl})),n.d(e,"WireframeHelper",(function(){return dp})),n.d(e,"WrapAroundEnding",(function(){return Ge})),n.d(e,"XHRLoader",(function(){return pp})),n.d(e,"ZeroCurvatureEnding",(function(){return je})),n.d(e,"ZeroFactor",(function(){return P})),n.d(e,"ZeroSlopeEnding",(function(){return Ve})),n.d(e,"ZeroStencilOp",(function(){return cn})),n.d(e,"sRGBEncoding",(function(){return Je})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let t=1;t<arguments.length;t++){const n=arguments[t];if(null!=n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e});const i="120",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,s=1,l=2,c=3,u=0,h=1,f=2,d=3,p=0,m=1,g=2,v=1,y=2,x=0,b=1,w=2,_=3,M=4,S=5,T=100,A=101,E=102,q=103,C=104,P=200,R=201,L=202,I=203,D=204,O=205,N=206,F=207,B=208,z=209,U=210,k=0,j=1,V=2,G=3,H=4,W=5,X=6,Y=7,Z=0,Q=1,J=2,K=0,$=1,tt=2,et=3,nt=4,it=5,rt=300,ot=301,at=302,st=303,lt=304,ct=306,ut=307,ht=1e3,ft=1001,dt=1002,pt=1003,mt=1004,gt=1004,vt=1005,yt=1005,xt=1006,bt=1007,wt=1007,_t=1008,Mt=1008,St=1009,Tt=1010,At=1011,Et=1012,qt=1013,Ct=1014,Pt=1015,Rt=1016,Lt=1017,It=1018,Dt=1019,Ot=1020,Nt=1021,Ft=1022,Bt=1023,zt=1024,Ut=1025,kt=Bt,jt=1026,Vt=1027,Gt=1028,Ht=1029,Wt=1030,Xt=1031,Yt=1032,Zt=1033,Qt=33776,Jt=33777,Kt=33778,$t=33779,te=35840,ee=35841,ne=35842,ie=35843,re=36196,oe=37492,ae=37496,se=37808,le=37809,ce=37810,ue=37811,he=37812,fe=37813,de=37814,pe=37815,me=37816,ge=37817,ve=37818,ye=37819,xe=37820,be=37821,we=36492,_e=37840,Me=37841,Se=37842,Te=37843,Ae=37844,Ee=37845,qe=37846,Ce=37847,Pe=37848,Re=37849,Le=37850,Ie=37851,De=37852,Oe=37853,Ne=2200,Fe=2201,Be=2202,ze=2300,Ue=2301,ke=2302,je=2400,Ve=2401,Ge=2402,He=2500,We=2501,Xe=0,Ye=1,Ze=2,Qe=3e3,Je=3001,Ke=3007,$e=3002,tn=3003,en=3004,nn=3005,rn=3006,on=3200,an=3201,sn=0,ln=1,cn=0,un=7680,hn=7681,fn=7682,dn=7683,pn=34055,mn=34056,gn=5386,vn=512,yn=513,xn=514,bn=515,wn=516,_n=517,Mn=518,Sn=519,Tn=35044,An=35048,En=35040,qn=35045,Cn=35049,Pn=35041,Rn=35046,Ln=35050,In=35042,Dn="100",On="300 es";function Nn(){}Object.assign(Nn.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t)}}});const Fn=[];for(let t=0;t<256;t++)Fn[t]=(t<16?"0":"")+t.toString(16);let Bn=1234567;const zn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Fn[255&t]+Fn[t>>8&255]+Fn[t>>16&255]+Fn[t>>24&255]+"-"+Fn[255&e]+Fn[e>>8&255]+"-"+Fn[e>>16&15|64]+Fn[e>>24&255]+"-"+Fn[63&n|128]+Fn[n>>8&255]+"-"+Fn[n>>16&255]+Fn[n>>24&255]+Fn[255&i]+Fn[i>>8&255]+Fn[i>>16&255]+Fn[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Bn=t%2147483647),Bn=16807*Bn%2147483647,(Bn-1)/2147483646},degToRad:function(t){return t*zn.DEG2RAD},radToDeg:function(t){return t*zn.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((e+i)/2),u=a((e+i)/2),h=o((e-i)/2),f=a((e-i)/2),d=o((i-e)/2),p=a((i-e)/2);switch(r){case"XYX":t.set(s*u,l*h,l*f,s*c);break;case"YZY":t.set(l*f,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*f,s*u,s*c);break;case"XZX":t.set(s*u,l*p,l*d,s*c);break;case"YXY":t.set(l*d,s*u,l*p,s*c);break;case"ZYZ":t.set(l*p,l*d,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};class Un{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class kn{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,o,a,s,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=a,c[3]=e,c[4]=r,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],f=n[5],d=n[8],p=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],w=i[5],_=i[8];return r[0]=o*p+a*v+s*b,r[3]=o*m+a*y+s*w,r[6]=o*g+a*x+s*_,r[1]=l*p+c*v+u*b,r[4]=l*m+c*y+u*w,r[7]=l*g+c*x+u*_,r[2]=h*p+f*v+d*b,r[5]=h*m+f*y+d*w,r[8]=h*g+f*x+d*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-n*r*c+n*a*s+i*r*l-i*o*s}getInverse(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=t.elements,i=this.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],f=n[8],d=f*l-c*h,p=c*u-f*s,m=h*s-l*u,g=r*d+o*p+a*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return i[0]=d*v,i[1]=(a*h-f*o)*v,i[2]=(c*o-a*l)*v,i[3]=p*v,i[4]=(f*r-a*u)*v,i[5]=(a*s-c*r)*v,i[6]=m*v,i[7]=(o*u-h*r)*v,i[8]=(l*r-o*s)*v,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).getInverse(this).transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);this.set(n*s,n*l,-n*(s*o+l*a)+o+t,-i*l,i*s,-i*(-l*o+s*a)+a+e,0,0,1)}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],c=i[7];return i[0]=e*r+n*s,i[3]=e*o+n*l,i[6]=e*a+n*c,i[1]=-n*r+e*s,i[4]=-n*o+e*l,i[7]=-n*a+e*c,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e){void 0===e&&(e=0);for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}let jn;const Vn={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===jn&&(jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),jn.width=t.width,jn.height=t.height;const n=jn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=jn}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let Gn=0;function Hn(t,e,n,i,r,o,a,s,l,c){Object.defineProperty(this,"id",{value:Gn++}),this.uuid=zn.generateUUID(),this.name="",this.image=void 0!==t?t:Hn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Hn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ft,this.wrapT=void 0!==i?i:ft,this.magFilter=void 0!==r?r:xt,this.minFilter=void 0!==o?o:_t,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Bt,this.internalFormat=null,this.type=void 0!==s?s:St,this.offset=new Un(0,0),this.repeat=new Un(1,1),this.center=new Un(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Qe,this.version=0,this.onUpdate=null}Hn.DEFAULT_IMAGE=void 0,Hn.DEFAULT_MAPPING=rt,Hn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Hn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=zn.generateUUID()),!e&&void 0===t.images[i.uuid]){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)e.push(Vn.getDataURL(i[t]))}else e=Vn.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:e}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==rt)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ht:t.x=t.x-Math.floor(t.x);break;case ft:t.x=t.x<0?0:1;break;case dt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ht:t.y=t.y-Math.floor(t.y);break;case ft:t.y=t.y<0?0:1;break;case dt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Hn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Wn{constructor(t=0,e=0,n=0,i=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const o=t.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],f=o[2],d=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-f)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+f)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(a+1)/2,o=(u+1)/2,m=(p+1)/2,g=(s+c)/4,v=(l+f)/4,y=(h+d)/4;return t>o&&t>m?t<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=g/n,r=v/n):o>m?o<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=g/i,r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=v/r,i=y/r),this.set(n,i,r,e),this}let m=Math.sqrt((d-h)*(d-h)+(l-f)*(l-f)+(c-s)*(c-s));return Math.abs(m)<.001&&(m=1),this.x=(d-h)/m,this.y=(l-f)/m,this.z=(c-s)/m,this.w=Math.acos((a+u+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function Xn(t,e,n){this.width=t,this.height=e,this.scissor=new Wn(0,0,t,e),this.scissorTest=!1,this.viewport=new Wn(0,0,t,e),n=n||{},this.texture=new Hn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:xt,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Yn(t,e,n){Xn.call(this,t,e,n),this.samples=4}Xn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Xn,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Yn.prototype=Object.assign(Object.create(Xn.prototype),{constructor:Yn,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Xn.prototype.copy.call(this,t),this.samples=t.samples,this}});class Zn{constructor(t=0,e=0,n=0,i=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return n.copy(t).slerp(e,i)}static slerpFlat(t,e,n,i,r,o,a){let s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],f=r[o+1],d=r[o+2],p=r[o+3];if(u!==p||s!==h||l!==f||c!==d){let t=1-a;const e=s*h+l*f+c*d+u*p,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,e*n);t=Math.sin(t*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*t+h*r,l=l*t+f*r,c=c*t+d*r,u=u*t+p*r,t===1-a){const t=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=t,l*=t,c*=t,u*=t}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],f=r[o+2],d=r[o+3];return t[e]=a*d+c*u+s*f-l*h,t[e+1]=s*d+c*h+l*u-a*f,t[e+2]=l*d+c*f+a*h-s*u,t[e+3]=c*d-a*u-s*h-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,o=t._order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(i/2),u=a(r/2),h=s(n/2),f=s(i/2),d=s(r/2);switch(o){case"XYZ":this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d;break;case"YXZ":this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d;break;case"ZXY":this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d;break;case"ZYX":this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d;break;case"YZX":this._x=h*c*u+l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u-h*f*d;break;case"XZY":this._x=h*c*u-l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],a=e[5],s=e[9],l=e[2],c=e[6],u=e[10],h=n+a+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-s)*t,this._y=(r-l)*t,this._z=(o-i)*t}else if(n>a&&n>u){const t=2*Math.sqrt(1+n-a-u);this._w=(c-s)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(r+l)/t}else if(a>u){const t=2*Math.sqrt(1+a-n-u);this._w=(r-l)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(s+c)/t}else{const t=2*Math.sqrt(1+u-n-a);this._w=(o-i)/t,this._x=(r+l)/t,this._y=(s+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(zn.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}inverse(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=n*c+o*a+i*l-r*s,this._y=i*c+o*s+r*a-n*l,this._z=r*c+o*l+n*s-i*a,this._w=o*c-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Qn{constructor(t=0,e=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Kn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Kn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*i-a*n,c=s*n+a*e-r*i,u=s*i+r*n-o*e,h=-r*e-o*n-a*i;return this.x=l*s+h*-r+c*-a-u*-o,this.y=c*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Jn.copy(this).projectOnVector(t),this.sub(Jn)}reflect(t){return this.sub(Jn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(zn.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Jn=new Qn,Kn=new Zn;class $n{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Qn(1/0,1/0,1/0),this.max=void 0!==e?e:new Qn(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=t.length;s<l;s+=3){const l=t[s],c=t[s+1],u=t[s+2];l<e&&(e=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(e,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=t.count;s<l;s++){const l=t.getX(s),c=t.getY(s),u=t.getZ(s);l<e&&(e=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(e,n,i),this.max.set(r,o,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=ni.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Qn),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Qn),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),ii.copy(e.boundingBox),ii.applyMatrix4(t.matrixWorld),this.union(ii));const n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Qn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ni),ni.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ui),hi.subVectors(this.max,ui),ri.subVectors(t.a,ui),oi.subVectors(t.b,ui),ai.subVectors(t.c,ui),si.subVectors(oi,ri),li.subVectors(ai,oi),ci.subVectors(ri,ai);let e=[0,-si.z,si.y,0,-li.z,li.y,0,-ci.z,ci.y,si.z,0,-si.x,li.z,0,-li.x,ci.z,0,-ci.x,-si.y,si.x,0,-li.y,li.x,0,-ci.y,ci.x,0];return!!ti(e,ri,oi,ai,hi)&&(e=[1,0,0,0,1,0,0,0,1],!!ti(e,ri,oi,ai,hi)&&(fi.crossVectors(si,li),e=[fi.x,fi.y,fi.z],ti(e,ri,oi,ai,hi)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Qn),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ni.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(ni).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ei[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ei[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ei[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ei[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ei[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ei[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ei[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ei[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ei),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function ti(t,e,n,i,r){for(let o=0,a=t.length-3;o<=a;o+=3){di.fromArray(t,o);const a=r.x*Math.abs(di.x)+r.y*Math.abs(di.y)+r.z*Math.abs(di.z),s=e.dot(di),l=n.dot(di),c=i.dot(di);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>a)return!1}return!0}const ei=[new Qn,new Qn,new Qn,new Qn,new Qn,new Qn,new Qn,new Qn],ni=new Qn,ii=new $n,ri=new Qn,oi=new Qn,ai=new Qn,si=new Qn,li=new Qn,ci=new Qn,ui=new Qn,hi=new Qn,fi=new Qn,di=new Qn,pi=new $n;class mi{constructor(t,e){this.center=void 0!==t?t:new Qn,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):pi.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Qn),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new $n),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const gi=new Qn,vi=new Qn,yi=new Qn,xi=new Qn,bi=new Qn,wi=new Qn,_i=new Qn;class Mi{constructor(t,e){this.origin=void 0!==t?t:new Qn,this.direction=void 0!==e?e:new Qn(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Qn),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,gi)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Qn),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=gi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(gi.copy(this.direction).multiplyScalar(e).add(this.origin),gi.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){vi.copy(t).add(e).multiplyScalar(.5),yi.copy(e).sub(t).normalize(),xi.copy(this.origin).sub(vi);const r=.5*t.distanceTo(e),o=-this.direction.dot(yi),a=xi.dot(this.direction),s=-xi.dot(yi),l=xi.lengthSq(),c=Math.abs(1-o*o);let u,h,f,d;if(c>0)if(u=o*s-a,h=o*a-s,d=r*c,u>=0)if(h>=-d)if(h<=d){const t=1/c;u*=t,h*=t,f=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;else h<=-d?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),f=-u*u+h*(h+2*s)+l):h<=d?(u=0,h=Math.min(Math.max(-r,-s),r),f=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),f=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(yi).multiplyScalar(h).add(vi),f}intersectSphere(t,e){gi.subVectors(t.center,this.origin);const n=gi.dot(this.direction),i=gi.dot(gi)-n*n,r=t.radius*t.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,o,a,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,gi)}intersectTriangle(t,e,n,i,r){bi.subVectors(e,t),wi.subVectors(n,t),_i.crossVectors(bi,wi);let o,a=this.direction.dot(_i);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}xi.subVectors(this.origin,t);const s=o*this.direction.dot(wi.crossVectors(xi,wi));if(s<0)return null;const l=o*this.direction.dot(bi.cross(xi));if(l<0)return null;if(s+l>a)return null;const c=-o*xi.dot(_i);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Si{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,o,a,s,l,c,u,h,f,d,p,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Si).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Ti.setFromMatrixColumn(t,0).length(),r=1/Ti.setFromMatrixColumn(t,1).length(),o=1/Ti.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=o*c,n=o*u,i=a*c,r=a*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*s,e[2]=r-t*l,e[6]=i+n*l,e[10]=o*s}else if("YXZ"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t+r*a,e[4]=i*a-n,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=o*s}else if("ZXY"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t-r*a,e[4]=-o*u,e[8]=i+n*a,e[1]=n+i*a,e[5]=o*c,e[9]=r-t*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){const t=o*c,n=o*u,i=a*c,r=a*u;e[0]=s*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=s*u,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){const t=o*s,n=o*l,i=a*s,r=a*l;e[0]=s*c,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-l*c,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=o*s,n=o*l,i=a*s,r=a*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=o*c,e[9]=n*u-i,e[2]=i*u-n,e[6]=a*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ei,t,qi)}lookAt(t,e,n){const i=this.elements;return Ri.subVectors(t,e),0===Ri.lengthSq()&&(Ri.z=1),Ri.normalize(),Ci.crossVectors(n,Ri),0===Ci.lengthSq()&&(1===Math.abs(n.z)?Ri.x+=1e-4:Ri.z+=1e-4,Ri.normalize(),Ci.crossVectors(n,Ri)),Ci.normalize(),Pi.crossVectors(Ri,Ci),i[0]=Ci.x,i[4]=Pi.x,i[8]=Ri.x,i[1]=Ci.y,i[5]=Pi.y,i[9]=Ri.y,i[2]=Ci.z,i[6]=Pi.z,i[10]=Ri.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],w=i[0],_=i[4],M=i[8],S=i[12],T=i[1],A=i[5],E=i[9],q=i[13],C=i[2],P=i[6],R=i[10],L=i[14],I=i[3],D=i[7],O=i[11],N=i[15];return r[0]=o*w+a*T+s*C+l*I,r[4]=o*_+a*A+s*P+l*D,r[8]=o*M+a*E+s*R+l*O,r[12]=o*S+a*q+s*L+l*N,r[1]=c*w+u*T+h*C+f*I,r[5]=c*_+u*A+h*P+f*D,r[9]=c*M+u*E+h*R+f*O,r[13]=c*S+u*q+h*L+f*N,r[2]=d*w+p*T+m*C+g*I,r[6]=d*_+p*A+m*P+g*D,r[10]=d*M+p*E+m*R+g*O,r[14]=d*S+p*q+m*L+g*N,r[3]=v*w+y*T+x*C+b*I,r[7]=v*_+y*A+x*P+b*D,r[11]=v*M+y*E+x*R+b*O,r[15]=v*S+y*q+x*L+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],f=t[14];return t[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*f-n*s*f)+t[7]*(+e*s*f-e*l*h+r*o*h-i*o*f+i*l*c-r*s*c)+t[11]*(+e*l*u-e*a*f-r*o*u+n*o*f+r*a*c-n*l*c)+t[15]*(-i*a*c-e*s*u+e*a*h+i*o*u-n*o*h+n*s*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}getInverse(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,i=t.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],f=i[8],d=i[9],p=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15],b=d*y*h-v*p*h+v*u*m-c*y*m-d*u*x+c*p*x,w=g*p*h-f*y*h-g*u*m+l*y*m+f*u*x-l*p*x,_=f*v*h-g*d*h+g*c*m-l*v*m-f*c*x+l*d*x,M=g*d*u-f*v*u-g*c*p+l*v*p+f*c*y-l*d*y,S=r*b+o*w+a*_+s*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return n[0]=b*T,n[1]=(v*p*s-d*y*s-v*a*m+o*y*m+d*a*x-o*p*x)*T,n[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*x+o*u*x)*T,n[3]=(d*u*s-c*p*s-d*a*h+o*p*h+c*a*m-o*u*m)*T,n[4]=w*T,n[5]=(f*y*s-g*p*s+g*a*m-r*y*m-f*a*x+r*p*x)*T,n[6]=(g*u*s-l*y*s-g*a*h+r*y*h+l*a*x-r*u*x)*T,n[7]=(l*p*s-f*u*s+f*a*h-r*p*h-l*a*m+r*u*m)*T,n[8]=_*T,n[9]=(g*d*s-f*v*s-g*o*m+r*v*m+f*o*x-r*d*x)*T,n[10]=(l*v*s-g*c*s+g*o*h-r*v*h-l*o*x+r*c*x)*T,n[11]=(f*c*s-l*d*s-f*o*h+r*d*h+l*o*m-r*c*m)*T,n[12]=M*T,n[13]=(f*v*a-g*d*a+g*o*p-r*v*p-f*o*y+r*d*y)*T,n[14]=(g*c*a-l*v*a-g*o*u+r*v*u+l*o*y-r*c*y)*T,n[15]=(l*d*a-f*c*a+f*o*u-r*d*u-l*o*p+r*c*p)*T,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,a=t.y,s=t.z,l=r*o,c=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+n,c*s-i*o,0,l*s-i*a,c*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,o=e._y,a=e._z,s=e._w,l=r+r,c=o+o,u=a+a,h=r*l,f=r*c,d=r*u,p=o*c,m=o*u,g=a*u,v=s*l,y=s*c,x=s*u,b=n.x,w=n.y,_=n.z;return i[0]=(1-(p+g))*b,i[1]=(f+x)*b,i[2]=(d-y)*b,i[3]=0,i[4]=(f-x)*w,i[5]=(1-(h+g))*w,i[6]=(m+v)*w,i[7]=0,i[8]=(d+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+p))*_,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Ti.set(i[0],i[1],i[2]).length();const o=Ti.set(i[4],i[5],i[6]).length(),a=Ti.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Ai.copy(this);const s=1/r,l=1/o,c=1/a;return Ai.elements[0]*=s,Ai.elements[1]*=s,Ai.elements[2]*=s,Ai.elements[4]*=l,Ai.elements[5]*=l,Ai.elements[6]*=l,Ai.elements[8]*=c,Ai.elements[9]*=c,Ai.elements[10]*=c,e.setFromRotationMatrix(Ai),n.x=r,n.y=o,n.z=a,this}makePerspective(t,e,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*r/(e-t),l=2*r/(n-i),c=(e+t)/(e-t),u=(n+i)/(n-i),h=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,i,r,o){const a=this.elements,s=1/(e-t),l=1/(n-i),c=1/(o-r),u=(e+t)*s,h=(n+i)*l,f=(o+r)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e){void 0===e&&(e=0);for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Ti=new Qn,Ai=new Si,Ei=new Qn(0,0,0),qi=new Qn(1,1,1),Ci=new Qn,Pi=new Qn,Ri=new Qn;class Li{constructor(t=0,e=0,n=0,i=Li.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const i=zn.clamp,r=t.elements,o=r[0],a=r[4],s=r[8],l=r[1],c=r[5],u=r[9],h=r[2],f=r[6],d=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Ii.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ii,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return Di.setFromEuler(this),this.setFromQuaternion(Di,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Qn(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Li.DefaultOrder="XYZ",Li.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Ii=new Si,Di=new Zn;class Oi{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Ni=0;const Fi=new Qn,Bi=new Zn,zi=new Si,Ui=new Qn,ki=new Qn,ji=new Qn,Vi=new Zn,Gi=new Qn(1,0,0),Hi=new Qn(0,1,0),Wi=new Qn(0,0,1),Xi={type:"added"},Yi={type:"removed"};function Zi(){Object.defineProperty(this,"id",{value:Ni++}),this.uuid=zn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zi.DefaultUp.clone();const t=new Qn,e=new Li,n=new Zn,i=new Qn(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Si},normalMatrix:{value:new kn}}),this.matrix=new Si,this.matrixWorld=new Si,this.matrixAutoUpdate=Zi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Oi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Zi.DefaultUp=new Qn(0,1,0),Zi.DefaultMatrixAutoUpdate=!0,Zi.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Zi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Bi.setFromAxisAngle(t,e),this.quaternion.multiply(Bi),this},rotateOnWorldAxis:function(t,e){return Bi.setFromAxisAngle(t,e),this.quaternion.premultiply(Bi),this},rotateX:function(t){return this.rotateOnAxis(Gi,t)},rotateY:function(t){return this.rotateOnAxis(Hi,t)},rotateZ:function(t){return this.rotateOnAxis(Wi,t)},translateOnAxis:function(t,e){return Fi.copy(t).applyQuaternion(this.quaternion),this.position.add(Fi.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Gi,t)},translateY:function(t){return this.translateOnAxis(Hi,t)},translateZ:function(t){return this.translateOnAxis(Wi,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(zi.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?Ui.copy(t):Ui.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ki.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?zi.lookAt(ki,Ui,this.up):zi.lookAt(Ui,ki,this.up),this.quaternion.setFromRotationMatrix(zi),i&&(zi.extractRotation(i.matrixWorld),Bi.setFromRotationMatrix(zi),this.quaternion.premultiply(Bi.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Xi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Yi)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),zi.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),zi.multiply(t.parent.matrixWorld)),t.applyMatrix4(zi),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Qn),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Zn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ki,t,ji),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Qn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ki,Vi,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Qn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(e){const e=o(t.geometries),i=o(t.materials),r=o(t.textures),a=o(t.images),s=o(t.shapes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s)}return n.object=i,n;function o(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}});const Qi=new Qn,Ji=new Qn,Ki=new kn;class $i{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Qn(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Qi.subVectors(n,e).cross(Ji.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Qn),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Qn);const n=t.delta(Qi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Qn),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Ki.getNormalMatrix(t),i=this.coplanarPoint(Qi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const tr=new Qn,er=new Qn,nr=new Qn,ir=new Qn,rr=new Qn,or=new Qn,ar=new Qn,sr=new Qn,lr=new Qn,cr=new Qn;class ur{constructor(t,e,n){this.a=void 0!==t?t:new Qn,this.b=void 0!==e?e:new Qn,this.c=void 0!==n?n:new Qn}static getNormal(t,e,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Qn),i.subVectors(n,e),tr.subVectors(t,e),i.cross(tr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){tr.subVectors(i,e),er.subVectors(n,e),nr.subVectors(t,e);const o=tr.dot(tr),a=tr.dot(er),s=tr.dot(nr),l=er.dot(er),c=er.dot(nr),u=o*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Qn),0===u)return r.set(-2,-1,-1);const h=1/u,f=(l*s-a*c)*h,d=(o*c-a*s)*h;return r.set(1-f-d,d,f)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,ir),ir.x>=0&&ir.y>=0&&ir.x+ir.y<=1}static getUV(t,e,n,i,r,o,a,s){return this.getBarycoord(t,e,n,i,ir),s.set(0,0),s.addScaledVector(r,ir.x),s.addScaledVector(o,ir.y),s.addScaledVector(a,ir.z),s}static isFrontFacing(t,e,n,i){return tr.subVectors(n,e),er.subVectors(t,e),tr.cross(er).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return tr.subVectors(this.c,this.b),er.subVectors(this.a,this.b),.5*tr.cross(er).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Qn),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ur.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new $i),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ur.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return ur.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return ur.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ur.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Qn);const n=this.a,i=this.b,r=this.c;let o,a;rr.subVectors(i,n),or.subVectors(r,n),sr.subVectors(t,n);const s=rr.dot(sr),l=or.dot(sr);if(s<=0&&l<=0)return e.copy(n);lr.subVectors(t,i);const c=rr.dot(lr),u=or.dot(lr);if(c>=0&&u<=c)return e.copy(i);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return o=s/(s-c),e.copy(n).addScaledVector(rr,o);cr.subVectors(t,r);const f=rr.dot(cr),d=or.dot(cr);if(d>=0&&f<=d)return e.copy(r);const p=f*l-s*d;if(p<=0&&l>=0&&d<=0)return a=l/(l-d),e.copy(n).addScaledVector(or,a);const m=c*d-f*u;if(m<=0&&u-c>=0&&f-d>=0)return ar.subVectors(r,i),a=(u-c)/(u-c+(f-d)),e.copy(i).addScaledVector(ar,a);const g=1/(m+p+h);return o=p*g,a=h*g,e.copy(n).addScaledVector(rr,o).addScaledVector(or,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const hr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fr={h:0,s:0,l:0},dr={h:0,s:0,l:0};function pr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function mr(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function gr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class vr{constructor(t,e,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=zn.euclideanModulo(t,1),e=zn.clamp(e,0,1),n=zn.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=pr(r,i,t+1/3),this.g=pr(r,i,t),this.b=pr(r,i,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[5]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=hr[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e){void 0===e&&(e=2);const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=mr(t.r),this.g=mr(t.g),this.b=mr(t.b),this}copyLinearToSRGB(t){return this.r=gr(t.r),this.g=gr(t.g),this.b=gr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),o=Math.min(e,n,i);let a,s;const l=(o+r)/2;if(o===r)a=0,s=0;else{const t=r-o;switch(s=l<=.5?t/(r+o):t/(2-r-o),r){case e:a=(n-i)/t+(n<i?6:0);break;case n:a=(i-e)/t+2;break;case i:a=(e-n)/t+4}a/=6}return t.h=a,t.s=s,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(fr),fr.h+=t,fr.s+=e,fr.l+=n,this.setHSL(fr.h,fr.s,fr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpHSL(t,e){this.getHSL(fr),t.getHSL(dr);const n=zn.lerp(fr.h,dr.h,e),i=zn.lerp(fr.s,dr.s,e),r=zn.lerp(fr.l,dr.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}vr.NAMES=hr,vr.prototype.r=1,vr.prototype.g=1,vr.prototype.b=1;class yr{constructor(t,e,n,i,r,o){this.a=t,this.b=e,this.c=n,this.normal=i&&i.isVector3?i:new Qn,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new vr,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let xr=0;function br(){Object.defineProperty(this,"id",{value:xr++}),this.uuid=zn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=p,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=O,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=G,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Sn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function wr(t){br.call(this),this.type="MeshBasicMaterial",this.color=new vr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}br.prototype=Object.assign(Object.create(Nn.prototype),{constructor:br,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===v;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==p&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(br.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),wr.prototype=Object.create(br.prototype),wr.prototype.constructor=wr,wr.prototype.isMeshBasicMaterial=!0,wr.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const _r=new Qn,Mr=new Un;function Sr(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0}function Tr(t,e,n){Sr.call(this,new Int8Array(t),e,n)}function Ar(t,e,n){Sr.call(this,new Uint8Array(t),e,n)}function Er(t,e,n){Sr.call(this,new Uint8ClampedArray(t),e,n)}function qr(t,e,n){Sr.call(this,new Int16Array(t),e,n)}function Cr(t,e,n){Sr.call(this,new Uint16Array(t),e,n)}function Pr(t,e,n){Sr.call(this,new Int32Array(t),e,n)}function Rr(t,e,n){Sr.call(this,new Uint32Array(t),e,n)}function Lr(t,e,n){Sr.call(this,new Float32Array(t),e,n)}function Ir(t,e,n){Sr.call(this,new Float64Array(t),e,n)}Object.defineProperty(Sr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Sr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new vr),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Un),e[n++]=r.x,e[n++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Qn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Wn),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Mr.fromBufferAttribute(this,e),Mr.applyMatrix3(t),this.setXY(e,Mr.x,Mr.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)_r.fromBufferAttribute(this,e),_r.applyMatrix3(t),this.setXYZ(e,_r.x,_r.y,_r.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)_r.x=this.getX(e),_r.y=this.getY(e),_r.z=this.getZ(e),_r.applyMatrix4(t),this.setXYZ(e,_r.x,_r.y,_r.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)_r.x=this.getX(e),_r.y=this.getY(e),_r.z=this.getZ(e),_r.applyNormalMatrix(t),this.setXYZ(e,_r.x,_r.y,_r.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)_r.x=this.getX(e),_r.y=this.getY(e),_r.z=this.getZ(e),_r.transformDirection(t),this.setXYZ(e,_r.x,_r.y,_r.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Tr.prototype=Object.create(Sr.prototype),Tr.prototype.constructor=Tr,Ar.prototype=Object.create(Sr.prototype),Ar.prototype.constructor=Ar,Er.prototype=Object.create(Sr.prototype),Er.prototype.constructor=Er,qr.prototype=Object.create(Sr.prototype),qr.prototype.constructor=qr,Cr.prototype=Object.create(Sr.prototype),Cr.prototype.constructor=Cr,Pr.prototype=Object.create(Sr.prototype),Pr.prototype.constructor=Pr,Rr.prototype=Object.create(Sr.prototype),Rr.prototype.constructor=Rr,Lr.prototype=Object.create(Sr.prototype),Lr.prototype.constructor=Lr,Ir.prototype=Object.create(Sr.prototype),Ir.prototype.constructor=Ir;class Dr{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const e=[];let n,i,r=void 0;const o=t.faces;for(i=0;i<o.length;i++){const t=o[i];t.materialIndex!==r&&(r=t.materialIndex,void 0!==n&&(n.count=3*i-n.start,e.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,e.push(n)),this.groups=e}fromGeometry(t){const e=t.faces,n=t.vertices,i=t.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,a=t.morphTargets,s=a.length;let l;if(s>0){l=[];for(let t=0;t<s;t++)l[t]={name:a[t].name,data:[]};this.morphTargets.position=l}const c=t.morphNormals,u=c.length;let h;if(u>0){h=[];for(let t=0;t<u;t++)h[t]={name:c[t].name,data:[]};this.morphTargets.normal=h}const f=t.skinIndices,d=t.skinWeights,p=f.length===n.length,m=d.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=g.normal;this.normals.push(t,t,t)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===r){const e=i[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Un,new Un,new Un))}if(!0===o){const e=i[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Un,new Un,new Un))}for(let t=0;t<s;t++){const e=a[t].vertices;l[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<u;e++){const n=c[e].vertexNormals[t];h[e].data.push(n.a,n.b,n.c)}p&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function Or(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}let Nr=1;const Fr=new Si,Br=new Zi,zr=new Qn,Ur=new $n,kr=new $n,jr=new Qn;function Vr(){Object.defineProperty(this,"id",{value:Nr+=2}),this.uuid=zn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Vr.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Vr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Or(t)>65535?Rr:Cr)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new kn).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Fr.makeRotationX(t),this.applyMatrix4(Fr),this},rotateY:function(t){return Fr.makeRotationY(t),this.applyMatrix4(Fr),this},rotateZ:function(t){return Fr.makeRotationZ(t),this.applyMatrix4(Fr),this},translate:function(t,e,n){return Fr.makeTranslation(t,e,n),this.applyMatrix4(Fr),this},scale:function(t,e,n){return Fr.makeScale(t,e,n),this.applyMatrix4(Fr),this},lookAt:function(t){return Br.lookAt(t),Br.updateMatrix(),this.applyMatrix4(Br.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(zr).negate(),this.translate(zr.x,zr.y,zr.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Lr(3*e.vertices.length,3),n=new Lr(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Lr(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Lr(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Dr).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Sr(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Sr(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new Sr(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Sr(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Sr(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],i=t.morphTargets[e];for(let t=0,e=i.length;t<e;t++){const e=i[t],r=new Lr(3*e.data.length,3);r.name=e.name,n.push(r.copyVector3sArray(e.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Lr(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Lr(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $n);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Qn(-1/0,-1/0,-1/0),new Qn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Ur.setFromBufferAttribute(n),this.morphTargetsRelative?(jr.addVectors(this.boundingBox.min,Ur.min),this.boundingBox.expandByPoint(jr),jr.addVectors(this.boundingBox.max,Ur.max),this.boundingBox.expandByPoint(jr)):(this.boundingBox.expandByPoint(Ur.min),this.boundingBox.expandByPoint(Ur.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new mi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Qn,1/0);if(t){const n=this.boundingSphere.center;if(Ur.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];kr.setFromBufferAttribute(n),this.morphTargetsRelative?(jr.addVectors(Ur.min,kr.min),Ur.expandByPoint(jr),jr.addVectors(Ur.max,kr.max),Ur.expandByPoint(jr)):(Ur.expandByPoint(kr.min),Ur.expandByPoint(kr.max))}Ur.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)jr.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(jr));if(e)for(let r=0,o=e.length;r<o;r++){const o=e[r],a=this.morphTargetsRelative;for(let e=0,r=o.count;e<r;e++)jr.fromBufferAttribute(o,e),a&&(zr.fromBufferAttribute(t,e),jr.add(zr)),i=Math.max(i,n.distanceToSquared(jr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Sr(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Qn,r=new Qn,o=new Qn,a=new Qn,s=new Qn,l=new Qn,c=new Qn,u=new Qn;if(t)for(let h=0,f=t.count;h<f;h+=3){const f=t.getX(h+0),d=t.getX(h+1),p=t.getX(h+2);i.fromBufferAttribute(e,f),r.fromBufferAttribute(e,d),o.fromBufferAttribute(e,p),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),a.fromBufferAttribute(n,f),s.fromBufferAttribute(n,d),l.fromBufferAttribute(n,p),a.add(c),s.add(c),l.add(c),n.setXYZ(f,a.x,a.y,a.z),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,o=t.attributes[i],a=o.array,s=o.itemSize*e,l=Math.min(a.length,r.length-s);for(let t=0,e=s;t<l;t++,e++)r[e]=a[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)jr.fromBufferAttribute(t,e),jr.normalize(),t.setXYZ(e,jr.x,jr.y,jr.z)},toNonIndexed:function(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,o=new n.constructor(e.length*i);let a=0,s=0;for(let t=0,r=e.length;t<r;t++){a=e[t]*i;for(let t=0;t<i;t++)o[s++]=n[a++]}return new Sr(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new Vr,n=this.index.array,i=this.attributes;for(const r in i){const o=t(i[r],n);e.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let e=0,i=a.length;e<i;e++){const i=t(a[e],n);o.push(i)}e.morphAttributes[i]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e],r=i.toJSON(t.data);""!==i.name&&(r.name=i.name),t.data.attributes[e]=r}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.toJSON(t.data);""!==i.name&&(r.name=i.name),o.push(r)}o.length>0&&(i[e]=o,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t},clone:function(){return(new Vr).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Gr=new Si,Hr=new Mi,Wr=new mi,Xr=new Qn,Yr=new Qn,Zr=new Qn,Qr=new Qn,Jr=new Qn,Kr=new Qn,$r=new Qn,to=new Qn,eo=new Qn,no=new Un,io=new Un,ro=new Un,oo=new Qn,ao=new Qn;function so(t,e){Zi.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Vr,this.material=void 0!==e?e:new wr,this.updateMorphTargets()}function lo(t,e,n,i,r,o,a,s){let l;if(l=e.side===m?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,e.side!==g,s),null===l)return null;ao.copy(s),ao.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(ao);return c<n.near||c>n.far?null:{distance:c,point:ao.clone(),object:t}}function co(t,e,n,i,r,o,a,s,l,c,u,h){Xr.fromBufferAttribute(r,c),Yr.fromBufferAttribute(r,u),Zr.fromBufferAttribute(r,h);const f=t.morphTargetInfluences;if(e.morphTargets&&o&&f){$r.set(0,0,0),to.set(0,0,0),eo.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=f[t],n=o[t];0!==e&&(Qr.fromBufferAttribute(n,c),Jr.fromBufferAttribute(n,u),Kr.fromBufferAttribute(n,h),a?($r.addScaledVector(Qr,e),to.addScaledVector(Jr,e),eo.addScaledVector(Kr,e)):($r.addScaledVector(Qr.sub(Xr),e),to.addScaledVector(Jr.sub(Yr),e),eo.addScaledVector(Kr.sub(Zr),e)))}Xr.add($r),Yr.add(to),Zr.add(eo)}t.isSkinnedMesh&&(t.boneTransform(c,Xr),t.boneTransform(u,Yr),t.boneTransform(h,Zr));const d=lo(t,e,n,i,Xr,Yr,Zr,oo);if(d){s&&(no.fromBufferAttribute(s,c),io.fromBufferAttribute(s,u),ro.fromBufferAttribute(s,h),d.uv=ur.getUV(oo,Xr,Yr,Zr,no,io,ro,new Un)),l&&(no.fromBufferAttribute(l,c),io.fromBufferAttribute(l,u),ro.fromBufferAttribute(l,h),d.uv2=ur.getUV(oo,Xr,Yr,Zr,no,io,ro,new Un));const t=new yr(c,u,h);ur.getNormal(Xr,Yr,Zr,t.normal),d.face=t}return d}so.prototype=Object.assign(Object.create(Zi.prototype),{constructor:so,isMesh:!0,copy:function(t){return Zi.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Wr.copy(n.boundingSphere),Wr.applyMatrix4(r),!1===t.ray.intersectsSphere(Wr))return;if(Gr.getInverse(r),Hr.copy(t.ray).applyMatrix4(Gr),null!==n.boundingBox&&!1===Hr.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,f=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,d=h.length;n<d;n++){const d=h[n],p=i[d.materialIndex];for(let n=Math.max(d.start,f.start),i=Math.min(d.start+d.count,f.start+f.count);n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),f=r.getX(n+2);o=co(this,p,t,Hr,a,s,l,c,u,i,h,f),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,e.push(o))}}else{for(let n=Math.max(0,f.start),h=Math.min(r.count,f.start+f.count);n<h;n+=3){const h=r.getX(n),f=r.getX(n+1),d=r.getX(n+2);o=co(this,i,t,Hr,a,s,l,c,u,h,f,d),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}else if(void 0!==a)if(Array.isArray(i))for(let n=0,r=h.length;n<r;n++){const r=h[n],d=i[r.materialIndex];for(let n=Math.max(r.start,f.start),i=Math.min(r.start+r.count,f.start+f.count);n<i;n+=3){o=co(this,d,t,Hr,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,e.push(o))}}else{for(let n=Math.max(0,f.start),r=Math.min(a.count,f.start+f.count);n<r;n+=3){o=co(this,i,t,Hr,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),e.push(o))}}}else if(n.isGeometry){const r=Array.isArray(i),a=n.vertices,s=n.faces;let l;const c=n.faceVertexUvs[0];c.length>0&&(l=c);for(let n=0,c=s.length;n<c;n++){const c=s[n],u=r?i[c.materialIndex]:i;if(void 0===u)continue;const h=a[c.a],f=a[c.b],d=a[c.c];if(o=lo(this,u,t,Hr,h,f,d,oo),o){if(l&&l[n]){const t=l[n];no.copy(t[0]),io.copy(t[1]),ro.copy(t[2]),o.uv=ur.getUV(oo,h,f,d,no,io,ro,new Un)}o.face=c,o.faceIndex=n,e.push(o)}}}}});let uo=0;const ho=new Si,fo=new Zi,po=new Qn;function mo(){Object.defineProperty(this,"id",{value:uo+=2}),this.uuid=zn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}mo.prototype=Object.assign(Object.create(Nn.prototype),{constructor:mo,isGeometry:!0,applyMatrix4:function(t){const e=(new kn).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,i=n.vertexNormals.length;t<i;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return ho.makeRotationX(t),this.applyMatrix4(ho),this},rotateY:function(t){return ho.makeRotationY(t),this.applyMatrix4(ho),this},rotateZ:function(t){return ho.makeRotationZ(t),this.applyMatrix4(ho),this},translate:function(t,e,n){return ho.makeTranslation(t,e,n),this.applyMatrix4(ho),this},scale:function(t,e,n){return ho.makeScale(t,e,n),this.applyMatrix4(ho),this},lookAt:function(t){return fo.lookAt(t),fo.updateMatrix(),this.applyMatrix4(fo.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,i=t.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,a=i.color,s=i.uv,l=i.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let t=0;t<r.count;t++)e.vertices.push((new Qn).fromBufferAttribute(r,t)),void 0!==a&&e.colors.push((new vr).fromBufferAttribute(a,t));function c(t,n,i,r){const c=void 0===a?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[i].clone()],u=void 0===o?[]:[(new Qn).fromBufferAttribute(o,t),(new Qn).fromBufferAttribute(o,n),(new Qn).fromBufferAttribute(o,i)],h=new yr(t,n,i,u,c,r);e.faces.push(h),void 0!==s&&e.faceVertexUvs[0].push([(new Un).fromBufferAttribute(s,t),(new Un).fromBufferAttribute(s,n),(new Un).fromBufferAttribute(s,i)]),void 0!==l&&e.faceVertexUvs[1].push([(new Un).fromBufferAttribute(l,t),(new Un).fromBufferAttribute(l,n),(new Un).fromBufferAttribute(l,i)])}const u=t.groups;if(u.length>0)for(let t=0;t<u.length;t++){const e=u[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)void 0!==n?c(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):c(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)c(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<r.count;t+=3)c(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(po).negate(),this.translate(po.x,po.y,po.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,i=new Si;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){const t=new Qn,e=new Qn;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],r=this.vertices[i.a],o=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,o),e.subVectors(r,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new Qn;if(t){const t=new Qn,n=new Qn;for(let i=0,r=this.faces.length;i<r;i++){const r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,a),n.subVectors(o,a),t.cross(n),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],i=n.vertexNormals;3===i.length?(i[0].copy(e[n.a]),i[1].copy(e[n.b]),i[2].copy(e[n.c])):(i[0]=e[n.a].clone(),i[1]=e[n.b].clone(),i[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new mo;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,i=this.faces.length;e<i;e++){const e=new Qn,i={a:new Qn,b:new Qn,c:new Qn};t.push(e),n.push(i)}}const n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],i=n.faceNormals[t],r=n.vertexNormals[t];i.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $n),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new mi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let i;const r=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,c=this.colors,u=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new kn).getNormalMatrix(e));for(let t=0,n=a.length;t<n;t++){const n=a[t].clone();void 0!==e&&n.applyMatrix4(e),o.push(n)}for(let t=0,e=u.length;t<e;t++)c.push(u[t].clone());for(let t=0,e=l.length;t<e;t++){const e=l[t];let o,a;const c=e.vertexNormals,u=e.vertexColors,h=new yr(e.a+r,e.b+r,e.c+r);h.normal.copy(e.normal),void 0!==i&&h.normal.applyMatrix3(i).normalize();for(let t=0,e=c.length;t<e;t++)o=c[t].clone(),void 0!==i&&o.applyMatrix3(i).normalize(),h.vertexNormals.push(o);h.color.copy(e.color);for(let t=0,e=u.length;t<e;t++)a=u[t],h.vertexColors.push(a.clone());h.materialIndex=e.materialIndex+n,s.push(h)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){const i=n[t],r=[];for(let t=0,e=i.length;t<e;t++)r.push(i[t].clone());this.faceVertexUvs[e].push(r)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],n=[],i=Math.pow(10,4);for(let r=0,o=this.vertices.length;r<o;r++){const o=this.vertices[r],a=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===t[a]?(t[a]=r,e.push(this.vertices[r]),n[r]=e.length-1):n[r]=n[t[a]]}const r=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const i=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(i[e]===i[(e+1)%3]){r.push(t);break}}for(let t=r.length-1;t>=0;t--){const e=r[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const o=this.vertices.length-e.length;return this.vertices=e,o},setFromPoints:function(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];this.vertices.push(new Qn(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));const n=this.faceVertexUvs[0],i=this.faceVertexUvs[1];let r,o;n&&n.length===e&&(r=[]),i&&i.length===e&&(o=[]);for(let a=0;a<e;a++){const e=t[a]._id;r&&r.push(n[e]),o&&o.push(i[e])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];e.push(n.x,n.y,n.z)}const n=[],i=[],r={},o=[],a={},s=[],l={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],i=!0,r=!1,o=void 0!==this.faceVertexUvs[0][t],a=e.normal.length()>0,s=e.vertexNormals.length>0,l=1!==e.color.r||1!==e.color.g||1!==e.color.b,d=e.vertexColors.length>0;let p=0;if(p=c(p,0,0),p=c(p,1,i),p=c(p,2,r),p=c(p,3,o),p=c(p,4,a),p=c(p,5,s),p=c(p,6,l),p=c(p,7,d),n.push(p),n.push(e.a,e.b,e.c),n.push(e.materialIndex),o){const e=this.faceVertexUvs[0][t];n.push(f(e[0]),f(e[1]),f(e[2]))}if(a&&n.push(u(e.normal)),s){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(l&&n.push(h(e.color)),d){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function c(t,e,n){return n?t|1<<e:t&~(1<<e)}function u(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]?r[e]:(r[e]=i.length/3,i.push(t.x,t.y,t.z),r[e])}function h(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==a[e]?a[e]:(a[e]=o.length,o.push(t.getHex()),a[e])}function f(t){const e=t.x.toString()+t.y.toString();return void 0!==l[e]?l[e]:(l[e]=s.length/2,s.push(t.x,t.y),l[e])}return t.data={},t.data.vertices=e,t.data.normals=i,o.length>0&&(t.data.colors=o),s.length>0&&(t.data.uvs=[s]),t.data.faces=n,t},clone:function(){return(new mo).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());const n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());const i=t.faces;for(let t=0,e=i.length;t<e;t++)this.faces.push(i[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){const n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){const i=n[t],r=[];for(let t=0,e=i.length;t<e;t++){const e=i[t];r.push(e.clone())}this.faceVertexUvs[e].push(r)}}const r=t.morphTargets;for(let t=0,e=r.length;t<e;t++){const e={};if(e.name=r[t].name,void 0!==r[t].vertices){e.vertices=[];for(let n=0,i=r[t].vertices.length;n<i;n++)e.vertices.push(r[t].vertices[n].clone())}if(void 0!==r[t].normals){e.normals=[];for(let n=0,i=r[t].normals.length;n<i;n++)e.normals.push(r[t].normals[n].clone())}this.morphTargets.push(e)}const o=t.morphNormals;for(let t=0,e=o.length;t<e;t++){const e={};if(void 0!==o[t].vertexNormals){e.vertexNormals=[];for(let n=0,i=o[t].vertexNormals.length;n<i;n++){const i=o[t].vertexNormals[n],r={};r.a=i.a.clone(),r.b=i.b.clone(),r.c=i.c.clone(),e.vertexNormals.push(r)}}if(void 0!==o[t].faceNormals){e.faceNormals=[];for(let n=0,i=o[t].faceNormals.length;n<i;n++)e.faceNormals.push(o[t].faceNormals[n].clone())}this.morphNormals.push(e)}const a=t.skinWeights;for(let t=0,e=a.length;t<e;t++)this.skinWeights.push(a[t].clone());const s=t.skinIndices;for(let t=0,e=s.length;t<e;t++)this.skinIndices.push(s[t].clone());const l=t.lineDistances;for(let t=0,e=l.length;t<e;t++)this.lineDistances.push(l[t]);const c=t.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=t.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class go extends mo{constructor(t,e,n,i,r,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new vo(t,e,n,i,r,o)),this.mergeVertices()}}class vo extends Vr{constructor(t=1,e=1,n=1,i=1,r=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const s=[],l=[],c=[],u=[];let h=0,f=0;function d(t,e,n,i,r,o,d,p,m,g,v){const y=o/m,x=d/g,b=o/2,w=d/2,_=p/2,M=m+1,S=g+1;let T=0,A=0;const E=new Qn;for(let o=0;o<S;o++){const a=o*x-w;for(let s=0;s<M;s++){const h=s*y-b;E[t]=h*i,E[e]=a*r,E[n]=_,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=p>0?1:-1,c.push(E.x,E.y,E.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+M*t,i=h+e+M*(t+1),r=h+(e+1)+M*(t+1),o=h+(e+1)+M*t;s.push(n,i,o),s.push(i,r,o),A+=6}a.addGroup(f,A,v),f+=A,h+=T}d("z","y","x",-1,-1,n,e,t,o,r,0),d("z","y","x",1,-1,n,e,-t,o,r,1),d("x","z","y",1,1,t,n,e,i,o,2),d("x","z","y",1,-1,t,n,-e,i,o,3),d("x","y","z",1,-1,t,e,n,i,r,4),d("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new Lr(l,3)),this.setAttribute("normal",new Lr(c,3)),this.setAttribute("uv",new Lr(u,2))}}function yo(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function xo(t){const e={};for(let n=0;n<t.length;n++){const i=yo(t[n]);for(const t in i)e[t]=i[t]}return e}const bo={clone:yo,merge:xo};function wo(t){br.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function _o(){Zi.call(this),this.type="Camera",this.matrixWorldInverse=new Si,this.projectionMatrix=new Si,this.projectionMatrixInverse=new Si}function Mo(t,e,n,i){_o.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}wo.prototype=Object.create(br.prototype),wo.prototype.constructor=wo,wo.prototype.isShaderMaterial=!0,wo.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=yo(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},wo.prototype.toJSON=function(t){const e=br.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},_o.prototype=Object.assign(Object.create(Zi.prototype),{constructor:_o,isCamera:!0,copy:function(t,e){return Zi.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Qn),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Zi.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){Zi.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Mo.prototype=Object.assign(Object.create(_o.prototype),{constructor:Mo,isPerspectiveCamera:!0,copy:function(t,e){return _o.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*zn.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*zn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*zn.RAD2DEG*Math.atan(Math.tan(.5*zn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*zn.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,a=o.fullHeight;r+=o.offsetX*i/t,e-=o.offsetY*n/a,i*=o.width/t,n*=o.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=Zi.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function So(t,e,n){if(Zi.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Mo(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Qn(1,0,0)),this.add(i);const r=new Mo(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Qn(-1,0,0)),this.add(r);const o=new Mo(90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Qn(0,1,0)),this.add(o);const a=new Mo(90,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Qn(0,-1,0)),this.add(a);const s=new Mo(90,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Qn(0,0,1)),this.add(s);const l=new Mo(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Qn(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,s),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c},this.clear=function(t,e,i,r){const o=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(n,o),t.clear(e,i,r);t.setRenderTarget(o)}}function To(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Xn.call(this,t,t,e),this.texture.isWebGLCubeRenderTargetTexture=!0}function Ao(t,e,n,i,r,o,a,s,l,c,u,h){Hn.call(this,null,o,a,s,l,c,i,r,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==l?l:pt,this.minFilter=void 0!==c?c:pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}So.prototype=Object.create(Zi.prototype),So.prototype.constructor=So,To.prototype=Object.create(Xn.prototype),To.prototype.constructor=To,To.prototype.isWebGLCubeRenderTarget=!0,To.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=Bt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},i=new vo(5,5,5),r=new wo({name:"CubemapFromEquirect",uniforms:yo(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:m,blending:x});r.uniforms.tEquirect.value=e;const o=new so(i,r),a=e.minFilter;return e.minFilter===_t&&(e.minFilter=xt),new So(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this},Ao.prototype=Object.create(Hn.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isDataTexture=!0;const Eo=new mi,qo=new Qn;class Co{constructor(t,e,n,i,r,o){this.planes=[void 0!==t?t:new $i,void 0!==e?e:new $i,void 0!==n?n:new $i,void 0!==i?i:new $i,void 0!==r?r:new $i,void 0!==o?o:new $i]}set(t,e,n,i,r,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],f=n[9],d=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(a-i,u-s,p-h,y-m).normalize(),e[1].setComponents(a+i,u+s,p+h,y+m).normalize(),e[2].setComponents(a+r,u+l,p+f,y+g).normalize(),e[3].setComponents(a-r,u-l,p-f,y-g).normalize(),e[4].setComponents(a-o,u-c,p-d,y-v).normalize(),e[5].setComponents(a+o,u+c,p+d,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Eo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Eo)}intersectsSprite(t){return Eo.center.set(0,0,0),Eo.radius=.7071067811865476,Eo.applyMatrix4(t.matrixWorld),this.intersectsSphere(Eo)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(qo.x=i.normal.x>0?t.max.x:t.min.x,qo.y=i.normal.y>0?t.max.y:t.min.y,qo.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(qo)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}function Po(){let t=null,e=!1,n=null,i=null;function r(e,o){n(e,o),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ro(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){var o=i.get(e);return void((!o||o.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const a=i.get(e);void 0===a?i.set(e,function(e,n){const i=e.array,r=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,r)):a.version<e.version&&(!function(e,i,r){const o=i.array,a=i.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,o):(n?t.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(a.buffer,e,r),a.version=e.version)}}}class Lo extends mo{constructor(t,e,n,i){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Io(t,e,n,i)),this.mergeVertices()}}class Io extends Vr{constructor(t,e,n,i){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=(t=t||1)/2,o=(e=e||1)/2,a=Math.floor(n)||1,s=Math.floor(i)||1,l=a+1,c=s+1,u=t/a,h=e/s,f=[],d=[],p=[],m=[];for(let t=0;t<c;t++){const e=t*h-o;for(let n=0;n<l;n++){const i=n*u-r;d.push(i,-e,0),p.push(0,0,1),m.push(n/a),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<a;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),o=e+1+l*t;f.push(n,i,o),f.push(i,r,o)}this.setIndex(f),this.setAttribute("position",new Lr(d,3)),this.setAttribute("normal",new Lr(p,3)),this.setAttribute("uv",new Lr(m,2))}}const Do={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)⋅G(v) / 4(n⋅l)(n⋅v)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},Oo={common:{diffuse:{value:new vr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new kn},uv2Transform:{value:new kn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Un(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kn}},sprite:{diffuse:{value:new vr(15658734)},opacity:{value:1},center:{value:new Un(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new kn}}},No={basic:{uniforms:xo([Oo.common,Oo.specularmap,Oo.envmap,Oo.aomap,Oo.lightmap,Oo.fog]),vertexShader:Do.meshbasic_vert,fragmentShader:Do.meshbasic_frag},lambert:{uniforms:xo([Oo.common,Oo.specularmap,Oo.envmap,Oo.aomap,Oo.lightmap,Oo.emissivemap,Oo.fog,Oo.lights,{emissive:{value:new vr(0)}}]),vertexShader:Do.meshlambert_vert,fragmentShader:Do.meshlambert_frag},phong:{uniforms:xo([Oo.common,Oo.specularmap,Oo.envmap,Oo.aomap,Oo.lightmap,Oo.emissivemap,Oo.bumpmap,Oo.normalmap,Oo.displacementmap,Oo.fog,Oo.lights,{emissive:{value:new vr(0)},specular:{value:new vr(1118481)},shininess:{value:30}}]),vertexShader:Do.meshphong_vert,fragmentShader:Do.meshphong_frag},standard:{uniforms:xo([Oo.common,Oo.envmap,Oo.aomap,Oo.lightmap,Oo.emissivemap,Oo.bumpmap,Oo.normalmap,Oo.displacementmap,Oo.roughnessmap,Oo.metalnessmap,Oo.fog,Oo.lights,{emissive:{value:new vr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Do.meshphysical_vert,fragmentShader:Do.meshphysical_frag},toon:{uniforms:xo([Oo.common,Oo.aomap,Oo.lightmap,Oo.emissivemap,Oo.bumpmap,Oo.normalmap,Oo.displacementmap,Oo.gradientmap,Oo.fog,Oo.lights,{emissive:{value:new vr(0)}}]),vertexShader:Do.meshtoon_vert,fragmentShader:Do.meshtoon_frag},matcap:{uniforms:xo([Oo.common,Oo.bumpmap,Oo.normalmap,Oo.displacementmap,Oo.fog,{matcap:{value:null}}]),vertexShader:Do.meshmatcap_vert,fragmentShader:Do.meshmatcap_frag},points:{uniforms:xo([Oo.points,Oo.fog]),vertexShader:Do.points_vert,fragmentShader:Do.points_frag},dashed:{uniforms:xo([Oo.common,Oo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Do.linedashed_vert,fragmentShader:Do.linedashed_frag},depth:{uniforms:xo([Oo.common,Oo.displacementmap]),vertexShader:Do.depth_vert,fragmentShader:Do.depth_frag},normal:{uniforms:xo([Oo.common,Oo.bumpmap,Oo.normalmap,Oo.displacementmap,{opacity:{value:1}}]),vertexShader:Do.normal_vert,fragmentShader:Do.normal_frag},sprite:{uniforms:xo([Oo.sprite,Oo.fog]),vertexShader:Do.sprite_vert,fragmentShader:Do.sprite_frag},background:{uniforms:{uvTransform:{value:new kn},t2D:{value:null}},vertexShader:Do.background_vert,fragmentShader:Do.background_frag},cube:{uniforms:xo([Oo.envmap,{opacity:{value:1}}]),vertexShader:Do.cube_vert,fragmentShader:Do.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Do.equirect_vert,fragmentShader:Do.equirect_frag},distanceRGBA:{uniforms:xo([Oo.common,Oo.displacementmap,{referencePosition:{value:new Qn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Do.distanceRGBA_vert,fragmentShader:Do.distanceRGBA_frag},shadow:{uniforms:xo([Oo.lights,Oo.fog,{color:{value:new vr(0)},opacity:{value:1}}]),vertexShader:Do.shadow_vert,fragmentShader:Do.shadow_frag}};function Fo(t,e,n,i,r){const o=new vr(0);let a,s,l=0,c=null,u=0,h=null;function f(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),l=void 0!==e?e:1,f(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,f(o,l)},render:function(n,r,d,g){let v=!0===r.isScene?r.background:null;v&&v.isTexture&&(v=e.get(v));const y=t.xr,x=y.getSession&&y.getSession();x&&"additive"===x.environmentBlendMode&&(v=null),null===v?f(o,l):v&&v.isColor&&(f(v,1),g=!0),(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.isWebGLCubeRenderTargetTexture||v.mapping===ct)?(void 0===s&&(s=new so(new vo(1,1,1),new wo({name:"BackgroundCubeMaterial",uniforms:yo(No.cube.uniforms),vertexShader:No.cube.vertexShader,fragmentShader:No.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(s)),v.isWebGLCubeRenderTarget&&(v=v.texture),s.material.uniforms.envMap.value=v,s.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,c===v&&u===v.version&&h===t.toneMapping||(s.material.needsUpdate=!0,c=v,u=v.version,h=t.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):v&&v.isTexture&&(void 0===a&&(a=new so(new Io(2,2),new wo({name:"BackgroundMaterial",uniforms:yo(No.background.uniforms),vertexShader:No.background.vertexShader,fragmentShader:No.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),a.material.uniforms.uvTransform.value.copy(v.matrix),c===v&&u===v.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=v,u=v.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Bo(t,e,n,i){const r=t.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),a=i.isWebGL2||null!==o,s={},l=f(null);let c=l;function u(e){return i.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function h(e){return i.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function f(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function d(){const t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function p(t){m(t,0)}function m(n,r){const o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;if(o[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),s[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r}}function g(){const e=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function v(e,n,r,o,a,s){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,o,a,s):t.vertexAttribIPointer(e,n,r,a,s)}function y(){x(),c!==l&&(c=l,u(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,x){let b=!1;if(a){const e=function(e,n,r){const a=!0===r.wireframe;let l=s[e.id];void 0===l&&(l={},s[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[a];void 0===u&&(u=f(i.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),c[a]=u);return u}(y,h,l);c!==e&&(c=e,u(c.object)),b=function(t,e){const n=c.attributes,i=t.attributes;if(Object.keys(n).length!==Object.keys(i).length)return!0;for(const t in i){const e=n[t],r=i[t];if(void 0===e)return!0;if(e.attribute!==r)return!0;if(e.data!==r.data)return!0}return c.index!==e}(y,x),b&&function(t,e){const n={},i=t.attributes;for(const t in i){const e=i[t],r={};r.attribute=e,e.data&&(r.data=e.data),n[t]=r}c.attributes=n,c.index=e}(y,x)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===t||(c.geometry=y.id,c.program=h.id,c.wireframe=t,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==x&&n.update(x,34963),b&&(!function(r,o,a,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const l=s.attributes,c=a.getAttributes(),u=o.defaultAttributeValues;for(const e in c){const i=c[e];if(i>=0){const o=l[e];if(void 0!==o){const e=o.normalized,r=o.itemSize,a=n.get(o);if(void 0===a)continue;const l=a.buffer,c=a.type,u=a.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,a=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)):p(i),t.bindBuffer(34962,l),v(i,r,c,e,a*u,h*u)}else o.isInstancedBufferAttribute?(m(i,o.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)):p(i),t.bindBuffer(34962,l),v(i,r,c,e,0,0)}else if("instanceMatrix"===e){const e=n.get(r.instanceMatrix);if(void 0===e)continue;const o=e.buffer,a=e.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(i+0,4,a,!1,64,0),t.vertexAttribPointer(i+1,4,a,!1,64,16),t.vertexAttribPointer(i+2,4,a,!1,64,32),t.vertexAttribPointer(i+3,4,a,!1,64,48)}else if("instanceColor"===e){const e=n.get(r.instanceColor);if(void 0===e)continue;const o=e.buffer,a=e.type;m(i,1),t.bindBuffer(34962,o),t.vertexAttribPointer(i,3,a,!1,12,0)}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i,n);break;case 3:t.vertexAttrib3fv(i,n);break;case 4:t.vertexAttrib4fv(i,n);break;default:t.vertexAttrib1fv(i,n)}}}}g()}(r,l,h,y),null!==x&&t.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const t in s){const e=s[t];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0===s[t.id])return;const e=s[t.id];for(const t in e){const n=e[t];for(const t in n)h(n[t].object),delete n[t];delete e[t]}delete s[t.id]},releaseStatesOfProgram:function(t){for(const e in s){const n=s[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)h(i[t].object),delete i[t];delete n[t.id]}},initAttributes:d,enableAttribute:p,disableUnusedAttributes:g}}function zo(t,e,n,i){const r=i.isWebGL2;let o;this.setMode=function(t){o=t},this.render=function(e,i){t.drawArrays(o,e,i),n.update(i,o,1)},this.renderInstances=function(i,a,s){if(0===s)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,i,a,s),n.update(a,o,s)}}function Uo(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),f=t.getParameter(34076),d=t.getParameter(34921),p=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=u>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;const n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function ko(t){const e=this;let n=null,i=0,r=!1,o=!1;const a=new $i,s=new kn,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(t,n,i,r){const o=null!==t?t.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const e=i+4*o,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=i;e!==o;++e,n+=4)a.copy(t[e]).applyMatrix4(r,s),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const a=0!==t.length||e||0!==i||r;return r=e,n=u(t,o,0),i=t.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(e,a,s){const h=e.clippingPlanes,f=e.clipIntersection,d=e.clipShadows,p=t.get(e);if(!r||null===h||0===h.length||o&&!d)o?u(null):c();else{const t=o?0:i,e=4*t;let r=p.clippingState||null;l.value=r,r=u(h,a,e,s);for(let t=0;t!==e;++t)r[t]=n[t];p.clippingState=r,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=t}}}function jo(t){let e=new WeakMap;function n(t,e){return e===st?t.mapping=ot:e===lt&&(t.mapping=at),t}return{get:function(i){if(i&&i.isTexture){const r=i.mapping;if(r===st||r===lt){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const r=i.image;if(r&&r.height>0){const o=t.getRenderList(),a=t.getRenderTarget(),s=t.getRenderState(),l=new To(r.height/2);return l.fromEquirectangularTexture(t,i),e.set(i,l),t.setRenderTarget(a),t.setRenderList(o),t.setRenderState(s),n(l.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}function Vo(t){const e={};return{has:function(n){if(void 0!==e[n])return null!==e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,null!==i},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function Go(t,e,n,i){const r=new WeakMap,o=new WeakMap;function a(t){const s=t.target,l=r.get(s);null!==l.index&&e.remove(l.index);for(const t in l.attributes)e.remove(l.attributes[t]);s.removeEventListener("dispose",a),r.delete(s);const c=o.get(l);c&&(e.remove(c),o.delete(l)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],o=t[e+2];n.push(i,r,r,o,o,i)}}else{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const s=new(Or(n)>65535?Rr:Cr)(n,1);s.version=a;const l=o.get(t);l&&e.remove(l),o.set(t,s)}return{get:function(t,e){let i=r.get(e);return i||(e.addEventListener("dispose",a),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Vr).setFromObject(t)),i=e._bufferGeometry),r.set(e,i),n.memory.geometries++,i)},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return o.get(t)}}}function Ho(t,e,n,i){const r=i.isWebGL2;let o,a,s;this.setMode=function(t){o=t},this.setIndex=function(t){a=t.type,s=t.bytesPerElement},this.render=function(e,i){t.drawElements(o,i,a,e*s),n.update(i,o,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,h;if(r)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,a,i*s,c),n.update(l,o,c)}}function Wo(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Xo(t,e){return t[0]-e[0]}function Yo(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Zo(t){const e={},n=new Float32Array(8),i=[];for(let t=0;t<8;t++)i[t]=[t,0];return{update:function(r,o,a,s){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let u=e[o.id];if(void 0===u){u=[];for(let t=0;t<c;t++)u[t]=[t,0];e[o.id]=u}for(let t=0;t<c;t++){const e=u[t];e[0]=t,e[1]=l[t]}u.sort(Yo);for(let t=0;t<8;t++)t<c&&u[t][1]?(i[t][0]=u[t][0],i[t][1]=u[t][1]):(i[t][0]=Number.MAX_SAFE_INTEGER,i[t][1]=0);i.sort(Xo);const h=a.morphTargets&&o.morphAttributes.position,f=a.morphNormals&&o.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=i[t],r=e[0],a=e[1];r!==Number.MAX_SAFE_INTEGER&&a?(h&&o.getAttribute("morphTarget"+t)!==h[r]&&o.setAttribute("morphTarget"+t,h[r]),f&&o.getAttribute("morphNormal"+t)!==f[r]&&o.setAttribute("morphNormal"+t,f[r]),n[t]=a,d+=a):(h&&void 0!==o.getAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),f&&void 0!==o.getAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const p=o.morphTargetsRelative?1:1-d;s.getUniforms().setValue(t,"morphTargetBaseInfluence",p),s.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Qo(t,e,n,i){let r=new WeakMap;return{update:function(t){const o=i.render.frame,a=t.geometry,s=e.get(t,a);return r.get(s)!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),r.set(s,o)),t.isInstancedMesh&&(n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),s},dispose:function(){r=new WeakMap}}}function Jo(t,e,n,i,r,o,a,s,l,c){t=void 0!==t?t:[],e=void 0!==e?e:ot,a=void 0!==a?a:Ft,Hn.call(this,t,e,n,i,r,o,a,s,l,c),this.flipY=!1}function Ko(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=pt,this.minFilter=pt,this.wrapR=ft,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function $o(t,e,n,i){Hn.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=pt,this.minFilter=pt,this.wrapR=ft,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}No.physical={uniforms:xo([No.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Un(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new vr(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Do.meshphysical_vert,fragmentShader:Do.meshphysical_frag},Jo.prototype=Object.create(Hn.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isCubeTexture=!0,Object.defineProperty(Jo.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Ko.prototype=Object.create(Hn.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isDataTexture2DArray=!0,$o.prototype=Object.create(Hn.prototype),$o.prototype.constructor=$o,$o.prototype.isDataTexture3D=!0;const ta=new Hn,ea=new Ko,na=new $o,ia=new Jo,ra=[],oa=[],aa=new Float32Array(16),sa=new Float32Array(9),la=new Float32Array(4);function ca(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let o=ra[r];if(void 0===o&&(o=new Float32Array(r),ra[r]=o),0!==e){i.toArray(o,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(o,r)}return o}function ua(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function ha(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function fa(t,e){let n=oa[e];void 0===n&&(n=new Int32Array(e),oa[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function da(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function pa(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ua(n,e))return;t.uniform2fv(this.addr,e),ha(n,e)}}function ma(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ua(n,e))return;t.uniform3fv(this.addr,e),ha(n,e)}}function ga(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ua(n,e))return;t.uniform4fv(this.addr,e),ha(n,e)}}function va(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ua(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),ha(n,e)}else{if(ua(n,i))return;la.set(i),t.uniformMatrix2fv(this.addr,!1,la),ha(n,i)}}function ya(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ua(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),ha(n,e)}else{if(ua(n,i))return;sa.set(i),t.uniformMatrix3fv(this.addr,!1,sa),ha(n,i)}}function xa(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ua(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),ha(n,e)}else{if(ua(n,i))return;aa.set(i),t.uniformMatrix4fv(this.addr,!1,aa),ha(n,i)}}function ba(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||ta,r)}function wa(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||ea,r)}function _a(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||na,r)}function Ma(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||ia,r)}function Sa(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ta(t,e){const n=this.cache;ua(n,e)||(t.uniform2iv(this.addr,e),ha(n,e))}function Aa(t,e){const n=this.cache;ua(n,e)||(t.uniform3iv(this.addr,e),ha(n,e))}function Ea(t,e){const n=this.cache;ua(n,e)||(t.uniform4iv(this.addr,e),ha(n,e))}function qa(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Ca(t,e){t.uniform1fv(this.addr,e)}function Pa(t,e){t.uniform1iv(this.addr,e)}function Ra(t,e){t.uniform2iv(this.addr,e)}function La(t,e){t.uniform3iv(this.addr,e)}function Ia(t,e){t.uniform4iv(this.addr,e)}function Da(t,e){const n=ca(e,this.size,2);t.uniform2fv(this.addr,n)}function Oa(t,e){const n=ca(e,this.size,3);t.uniform3fv(this.addr,n)}function Na(t,e){const n=ca(e,this.size,4);t.uniform4fv(this.addr,n)}function Fa(t,e){const n=ca(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ba(t,e){const n=ca(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function za(t,e){const n=ca(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Ua(t,e,n){const i=e.length,r=fa(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTexture2D(e[t]||ta,r[t])}function ka(t,e,n){const i=e.length,r=fa(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTextureCube(e[t]||ia,r[t])}function ja(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return da;case 35664:return pa;case 35665:return ma;case 35666:return ga;case 35674:return va;case 35675:return ya;case 35676:return xa;case 5124:case 35670:return Sa;case 35667:case 35671:return Ta;case 35668:case 35672:return Aa;case 35669:case 35673:return Ea;case 5125:return qa;case 35678:case 36198:case 36298:case 36306:case 35682:return ba;case 35679:case 36299:case 36307:return _a;case 35680:case 36300:case 36308:case 36293:return Ma;case 36289:case 36303:case 36311:case 36292:return wa}}(e.type)}function Va(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ca;case 35664:return Da;case 35665:return Oa;case 35666:return Na;case 35674:return Fa;case 35675:return Ba;case 35676:return za;case 5124:case 35670:return Pa;case 35667:case 35671:return Ra;case 35668:case 35672:return La;case 35669:case 35673:return Ia;case 35678:case 36198:case 36298:case 36306:case 35682:return Ua;case 35680:case 36300:case 36308:case 36293:return ka}}(e.type)}function Ga(t){this.id=t,this.seq=[],this.map={}}Va.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ha(e,t)},Ga.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(t,e[o.id],n)}};const Ha=/([\w\d_]+)(\])?(\[|\.)?/g;function Wa(t,e){t.seq.push(e),t.map[e.id]=e}function Xa(t,e,n){const i=t.name,r=i.length;for(Ha.lastIndex=0;;){const o=Ha.exec(i),a=Ha.lastIndex;let s=o[1];const l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===r){Wa(n,void 0===c?new ja(s,t,e):new Va(s,t,e));break}{let t=n.map[s];void 0===t&&(t=new Ga(s),Wa(n,t)),n=t}}}function Ya(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Xa(n,t.getUniformLocation(e,n.name),this)}}function Za(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}Ya.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},Ya.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},Ya.upload=function(t,e,n,i){for(let r=0,o=e.length;r!==o;++r){const o=e[r],a=n[o.id];!1!==a.needsUpdate&&o.setValue(t,a.value,i)}},Ya.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let Qa=0;function Ja(t){switch(t){case Qe:return["Linear","( value )"];case Je:return["sRGB","( value )"];case $e:return["RGBE","( value )"];case en:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case Ke:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case tn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Ka(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function $a(t,e){const n=Ja(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ts(t,e){const n=Ja(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function es(t,e){let n;switch(e){case $:n="Linear";break;case tt:n="Reinhard";break;case et:n="OptimizedCineon";break;case nt:n="ACESFilmic";break;case it:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ns(t){return""!==t}function is(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const os=/^[ \t]*#include +<([\w\d./]+)>/gm;function as(t){return t.replace(os,ss)}function ss(t,e){const n=Do[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return as(n)}const ls=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,cs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function us(t){return t.replace(cs,fs).replace(ls,hs)}function hs(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),fs(t,e,n,i)}function fs(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function ds(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ps(t,e,n,i){const r=t.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===h?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===f?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===d&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ot:case at:e="ENVMAP_TYPE_CUBE";break;case ct:case ut:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case at:case ut:e="ENVMAP_MODE_REFRACTION"}return e}(n),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Z:e="ENVMAP_BLENDING_MULTIPLY";break;case Q:e="ENVMAP_BLENDING_MIX";break;case J:e="ENVMAP_BLENDING_ADD"}return e}(n),m=t.gammaFactor>0?t.gammaFactor:1,g=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ns).join("\n")}(n),v=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(o),y=r.createProgram();let x,b,w=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(x=[v].filter(ns).join("\n"),x.length>0&&(x+="\n"),b=[g,v].filter(ns).join("\n"),b.length>0&&(b+="\n")):(x=[ds(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ns).join("\n"),b=[g,ds(n),"#define SHADER_NAME "+n.shaderName,v,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==K?"#define TONE_MAPPING":"",n.toneMapping!==K?Do.tonemapping_pars_fragment:"",n.toneMapping!==K?es("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Do.encodings_pars_fragment,n.map?$a("mapTexelToLinear",n.mapEncoding):"",n.matcap?$a("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?$a("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?$a("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?$a("lightMapTexelToLinear",n.lightMapEncoding):"",ts("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ns).join("\n")),a=as(a),a=is(a,n),a=rs(a,n),s=as(s),s=is(s,n),s=rs(s,n),a=us(a),s=us(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(w="#version 300 es\n",x=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,b=["#define varying in",n.glslVersion===On?"":"out highp vec4 pc_fragColor;",n.glslVersion===On?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const _=w+b+s,M=Za(r,35633,w+x+a),S=Za(r,35632,_);if(r.attachShader(y,M),r.attachShader(y,S),void 0!==n.index0AttributeName?r.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(y).trim(),e=r.getShaderInfoLog(M).trim(),n=r.getShaderInfoLog(S).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(y,35714)){i=!1;const e=Ka(r,M,"vertex"),n=Ka(r,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(y,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:n,prefix:b}})}let T,A;return r.deleteShader(M),r.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new Ya(r,y)),T},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r).name;n[i]=t.getAttribLocation(e,i)}return n}(r,y)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=Qa++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}function ms(t,e,n,i,r,o){const a=[],s=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,u=i.maxVertexUniforms,h=i.vertexTextures;let f=i.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Qe,e}return{getParameters:function(r,a,p,y,x){const b=y.fog,w=r.isMeshStandardMaterial?y.environment:null,_=e.get(r.envMap||w),M=d[r.type],S=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=u,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(x):0;let T,A;if(null!==r.precision&&(f=i.getMaxPrecision(r.precision),f!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",f,"instead.")),M){const t=No[M];T=t.vertexShader,A=t.fragmentShader}else T=r.vertexShader,A=r.fragmentShader;const E=t.getRenderTarget();return{isWebGL2:s,shaderID:M,shaderName:r.type,vertexShader:T,fragmentShader:A,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:f,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:h,outputEncoding:null!==E?v(E.texture):t.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:v(_),envMapCubeUV:!!_&&(_.mapping===ct||_.mapping===ut),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ln,tangentSpaceNormalMap:r.normalMapType===sn,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:r.skinning&&S>0,maxBones:S,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:K,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===g,flipSided:r.side===m,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<p.length;t++)n.push(e[p[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=d[t.type];let n;if(e){const t=No[e];n=bo.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=a.length;t<e;t++){const e=a[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new ps(t,n,e,r),a.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function gs(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function vs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ys(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function xs(t){const e=[];let n=0;const i=[],r=[],o={id:-1};function a(i,r,a,s,l,c){let u=e[n];const h=t.get(a);return void 0===u?(u={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:l,group:c},e[n]=u):(u.id=i.id,u.object=i,u.geometry=r,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=i.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:i,transparent:r,init:function(){n=0,i.length=0,r.length=0},push:function(t,e,n,o,s,l){const c=a(t,e,n,o,s,l);(!0===n.transparent?r:i).push(c)},unshift:function(t,e,n,o,s,l){const c=a(t,e,n,o,s,l);(!0===n.transparent?r:i).unshift(c)},finish:function(){for(let t=n,i=e.length;t<i;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){i.length>1&&i.sort(t||vs),r.length>1&&r.sort(e||ys)}}}function bs(t){let e=new WeakMap;return{get:function(n,i){const r=e.get(n);let o;return void 0===r?(o=new xs(t),e.set(n,new WeakMap),e.get(n).set(i,o)):(o=r.get(i),void 0===o&&(o=new xs(t),r.set(i,o))),o},dispose:function(){e=new WeakMap}}}function ws(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Qn,color:new vr};break;case"SpotLight":n={position:new Qn,direction:new Qn,color:new vr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Qn,color:new vr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Qn,skyColor:new vr,groundColor:new vr};break;case"RectAreaLight":n={color:new vr,position:new Qn,halfWidth:new Qn,halfHeight:new Qn}}return t[e.id]=n,n}}}let _s=0;function Ms(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Ss(){const t=new ws,e=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Un};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Un,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)n.probe.push(new Qn);const i=new Qn,r=new Si,o=new Si;return{setup:function(a,s,l){let c=0,u=0,h=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let f=0,d=0,p=0,m=0,g=0,v=0,y=0,x=0;const b=l.matrixWorldInverse;a.sort(Ms);for(let s=0,l=a.length;s<l;s++){const l=a[s],w=l.color,_=l.intensity,M=l.distance,S=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight)c+=w.r*_,u+=w.g*_,h+=w.b*_;else if(l.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(l.sh.coefficients[t],_);else if(l.isDirectionalLight){const r=t.get(l);if(r.color.copy(l.color).multiplyScalar(l.intensity),r.direction.setFromMatrixPosition(l.matrixWorld),i.setFromMatrixPosition(l.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(b),l.castShadow){const t=l.shadow,i=e.get(l);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.directionalShadow[f]=i,n.directionalShadowMap[f]=S,n.directionalShadowMatrix[f]=l.shadow.matrix,v++}n.directional[f]=r,f++}else if(l.isSpotLight){const r=t.get(l);if(r.position.setFromMatrixPosition(l.matrixWorld),r.position.applyMatrix4(b),r.color.copy(w).multiplyScalar(_),r.distance=M,r.direction.setFromMatrixPosition(l.matrixWorld),i.setFromMatrixPosition(l.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(b),r.coneCos=Math.cos(l.angle),r.penumbraCos=Math.cos(l.angle*(1-l.penumbra)),r.decay=l.decay,l.castShadow){const t=l.shadow,i=e.get(l);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.spotShadow[p]=i,n.spotShadowMap[p]=S,n.spotShadowMatrix[p]=l.shadow.matrix,x++}n.spot[p]=r,p++}else if(l.isRectAreaLight){const e=t.get(l);e.color.copy(w).multiplyScalar(_),e.position.setFromMatrixPosition(l.matrixWorld),e.position.applyMatrix4(b),o.identity(),r.copy(l.matrixWorld),r.premultiply(b),o.extractRotation(r),e.halfWidth.set(.5*l.width,0,0),e.halfHeight.set(0,.5*l.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),n.rectArea[m]=e,m++}else if(l.isPointLight){const i=t.get(l);if(i.position.setFromMatrixPosition(l.matrixWorld),i.position.applyMatrix4(b),i.color.copy(l.color).multiplyScalar(l.intensity),i.distance=l.distance,i.decay=l.decay,l.castShadow){const t=l.shadow,i=e.get(l);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,n.pointShadow[d]=i,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=l.shadow.matrix,y++}n.point[d]=i,d++}else if(l.isHemisphereLight){const e=t.get(l);e.direction.setFromMatrixPosition(l.matrixWorld),e.direction.transformDirection(b),e.direction.normalize(),e.skyColor.copy(l.color).multiplyScalar(_),e.groundColor.copy(l.groundColor).multiplyScalar(_),n.hemi[g]=e,g++}}m>0&&(n.rectAreaLTC1=Oo.LTC_1,n.rectAreaLTC2=Oo.LTC_2),n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h;const w=n.hash;w.directionalLength===f&&w.pointLength===d&&w.spotLength===p&&w.rectAreaLength===m&&w.hemiLength===g&&w.numDirectionalShadows===v&&w.numPointShadows===y&&w.numSpotShadows===x||(n.directional.length=f,n.spot.length=p,n.rectArea.length=m,n.point.length=d,n.hemi.length=g,n.directionalShadow.length=v,n.directionalShadowMap.length=v,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=v,n.pointShadowMatrix.length=y,n.spotShadowMatrix.length=x,w.directionalLength=f,w.pointLength=d,w.spotLength=p,w.rectAreaLength=m,w.hemiLength=g,w.numDirectionalShadows=v,w.numPointShadows=y,w.numSpotShadows=x,n.version=_s++)},state:n}}function Ts(){const t=new Ss,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(i){t.setup(e,n,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function As(){let t=new WeakMap;return{get:function(e,n){let i;return!1===t.has(e)?(i=new Ts,t.set(e,new WeakMap),t.get(e).set(n,i)):!1===t.get(e).has(n)?(i=new Ts,t.get(e).set(n,i)):i=t.get(e).get(n),i},dispose:function(){t=new WeakMap}}}function Es(t){br.call(this),this.type="MeshDepthMaterial",this.depthPacking=on,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function qs(t){br.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Qn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Es.prototype=Object.create(br.prototype),Es.prototype.constructor=Es,Es.prototype.isMeshDepthMaterial=!0,Es.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},qs.prototype=Object.create(br.prototype),qs.prototype.constructor=qs,qs.prototype.isMeshDistanceMaterial=!0,qs.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function Cs(t,e,n){let i=new Co;const r=new Un,o=new Un,a=new Wn,s=[],l=[],c={},u={0:m,1:p,2:g},f=new wo({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Un},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),v=f.clone();v.defines.HORIZONAL_PASS=1;const y=new Vr;y.setAttribute("position",new Sr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new so(y,f),w=this;function _(n,i){const r=e.update(b);f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,f,b,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,v,b,null)}function M(t,e,n){const i=t<<0|e<<1|n<<2;let r=s[i];return void 0===r&&(r=new Es({depthPacking:an,morphTargets:t,skinning:e}),s[i]=r),r}function S(t,e,n){const i=t<<0|e<<1|n<<2;let r=l[i];return void 0===r&&(r=new qs({morphTargets:t,skinning:e}),l[i]=r),r}function T(e,n,i,r,o,a,s){let l=null,h=M,f=e.customDepthMaterial;if(!0===r.isPointLight&&(h=S,f=e.customDistanceMaterial),void 0===f){let t=!1;!0===i.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),l=h(t,r,!0===e.isInstancedMesh)}else l=f;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const t=l.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let r=n[e];void 0===r&&(r=l.clone(),n[e]=r),l=r}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=s===d?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function A(n,r,o,a,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===d)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=r[c.materialIndex];if(u&&u.visible){const e=T(n,i,u,a,o.near,o.far,s);t.renderBufferDirect(o,null,i,e,n,c)}}}else if(r.visible){const e=T(n,i,r,a,o.near,o.far,s);t.renderBufferDirect(o,null,i,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)A(l[t],r,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(e,s,l){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),f=t.state;f.setBlending(x),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(let c=0,u=e.length;c<u;c++){const u=e[c],h=u.shadow;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}r.copy(h.mapSize);const p=h.getFrameExtents();if(r.multiply(p),o.copy(h.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/p.x),r.x=o.x*p.x,h.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/p.y),r.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===d){const t={minFilter:xt,magFilter:xt,format:Bt};h.map=new Xn(r.x,r.y,t),h.map.texture.name=u.name+".shadowMap",h.mapPass=new Xn(r.x,r.y,t),h.camera.updateProjectionMatrix()}if(null===h.map){const t={minFilter:pt,magFilter:pt,format:Bt};h.map=new Xn(r.x,r.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const m=h.getViewportCount();for(let t=0;t<m;t++){const e=h.getViewport(t);a.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),f.viewport(a),h.updateMatrices(u,t),i=h.getFrustum(),A(s,l,h.camera,u,this.type)}h.isPointLightShadow||this.type!==d||_(h,l),h.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(c,u,h)}}function Ps(t,e,n){const i=n.isWebGL2;const r=new function(){let e=!1;const n=new Wn;let i=null;const r=new Wn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,o,a,s){!0===s&&(e*=a,i*=a,o*=a),n.set(e,i,o,a),!1===r.equals(n)&&(t.clearColor(e,i,o,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?pt(2929):mt(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case k:t.depthFunc(512);break;case j:t.depthFunc(519);break;case V:t.depthFunc(513);break;case G:t.depthFunc(515);break;case H:t.depthFunc(514);break;case W:t.depthFunc(518);break;case X:t.depthFunc(516);break;case Y:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},c=new function(){let e=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(t){e||(t?pt(2960):mt(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&o===a||(t.stencilFunc(e,n,a),i=e,r=n,o=a)},setOp:function(e,n,i){a===e&&s===n&&l===i||(t.stencilOp(e,n,i),a=e,s=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,c=null}}};let u={},h=null,f=null,d=null,p=null,v=null,y=null,Z=null,Q=null,J=null,K=!1,$=null,tt=null,et=null,nt=null,it=null;const rt=t.getParameter(35661);let ot=!1,at=0;const st=t.getParameter(7938);-1!==st.indexOf("WebGL")?(at=parseFloat(/^WebGL\ ([0-9])/.exec(st)[1]),ot=at>=1):-1!==st.indexOf("OpenGL ES")&&(at=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(st)[1]),ot=at>=2);let lt=null,ct={};const ut=new Wn,ht=new Wn;function ft(e,n,i){const r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return o}const dt={};function pt(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function mt(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}dt[3553]=ft(3553,3553,1),dt[34067]=ft(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),c.setClear(0),pt(2929),o.setFunc(G),xt(!1),bt(s),pt(2884),yt(x);const gt={[T]:32774,[A]:32778,[E]:32779};if(i)gt[q]=32775,gt[C]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(gt[q]=t.MIN_EXT,gt[C]=t.MAX_EXT)}const vt={[P]:0,[R]:1,[L]:768,[D]:770,[U]:776,[B]:774,[N]:772,[I]:769,[O]:771,[z]:775,[F]:773};function yt(e,n,i,r,o,a,s,l){if(e!==x){if(f||(pt(3042),f=!0),e===S)o=o||n,a=a||i,s=s||r,n===p&&o===Z||(t.blendEquationSeparate(gt[n],gt[o]),p=n,Z=o),i===v&&r===y&&a===Q&&s===J||(t.blendFuncSeparate(vt[i],vt[r],vt[a],vt[s]),v=i,y=r,Q=a,J=s),d=e,K=null;else if(e!==d||l!==K){if(p===T&&Z===T||(t.blendEquation(32774),p=T,Z=T),l)switch(e){case b:t.blendFuncSeparate(1,771,1,771);break;case w:t.blendFunc(1,1);break;case _:t.blendFuncSeparate(0,0,769,771);break;case M:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case b:t.blendFuncSeparate(770,771,1,771);break;case w:t.blendFunc(770,1);break;case _:t.blendFunc(0,769);break;case M:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,y=null,Q=null,J=null,d=e,K=l}}else f&&(mt(3042),f=!1)}function xt(e){$!==e&&(e?t.frontFace(2304):t.frontFace(2305),$=e)}function bt(e){e!==a?(pt(2884),e!==tt&&(e===s?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):mt(2884),tt=e}function wt(e,n,i){e?(pt(32823),nt===n&&it===i||(t.polygonOffset(n,i),nt=n,it=i)):mt(32823)}function _t(e){void 0===e&&(e=33984+rt-1),lt!==e&&(t.activeTexture(e),lt=e)}return{buffers:{color:r,depth:o,stencil:c},enable:pt,disable:mt,useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:yt,setMaterial:function(t,e){t.side===g?mt(2884):pt(2884);let n=t.side===m;e&&(n=!n),xt(n),t.blending===b&&!1===t.transparent?yt(x):yt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite);const i=t.stencilWrite;c.setTest(i),i&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),wt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:xt,setCullFace:bt,setLineWidth:function(e){e!==et&&(ot&&t.lineWidth(e),et=e)},setPolygonOffset:wt,setScissorTest:function(t){t?pt(3089):mt(3089)},activeTexture:_t,bindTexture:function(e,n){null===lt&&_t();let i=ct[lt];void 0===i&&(i={type:void 0,texture:void 0},ct[lt]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||dt[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=ct[lt];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ut.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ut.copy(e))},viewport:function(e){!1===ht.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ht.copy(e))},reset:function(){u={},lt=null,ct={},h=null,d=null,$=null,tt=null,r.reset(),o.reset(),c.reset()}}}function Rs(t,e,n,i,r,o,a){const s=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,f=new WeakMap;let d,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return p?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?zn.floorPowerOfTwo:Math.floor,o=i(r*t.width),a=i(r*t.height);void 0===d&&(d=m(o,a));const s=n?m(o,a):d;return s.width=o,s.height=a,s.getContext("2d").drawImage(t,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+a+")."),s}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return zn.isPowerOfTwo(t.width)&&zn.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==pt&&t.minFilter!==xt}function x(e,n,r,o){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function b(n,i,r){if(!1===s)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function w(t){return t===pt||t===mt||t===vt?9728:9729}function _(e){const n=e.target;n.removeEventListener("dispose",_),function(e){const n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=i.get(e),r=i.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(e.texture),i.remove(e)}(n),a.memory.textures--}let S=0;function T(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void L(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function A(e,r){if(6!==e.image.length)return;const a=i.get(e);if(e.version>0&&a.__version!==e.version){R(a,e),n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);const i=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),l=e.image[0]&&e.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=i||l?l?e.image[t].image:e.image[t]:g(e.image[t],!1,!0,c);const h=u[0],f=v(h)||s,d=o.convert(e.format),p=o.convert(e.type),m=b(e.internalFormat,d,p);let w;if(P(34067,e,f),i){for(let t=0;t<6;t++){w=u[t].mipmaps;for(let i=0;i<w.length;i++){const r=w[i];e.format!==Bt&&e.format!==Ft?null!==d?n.compressedTexImage2D(34069+t,i,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,i,m,r.width,r.height,0,d,p,r.data)}}a.__maxMipLevel=w.length-1}else{w=e.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,d,p,u[t].data);for(let e=0;e<w.length;e++){const i=w[e].image[t].image;n.texImage2D(34069+t,e+1,m,i.width,i.height,0,d,p,i.data)}}else{n.texImage2D(34069+t,0,m,d,p,u[t]);for(let e=0;e<w.length;e++){const i=w[e];n.texImage2D(34069+t,e+1,m,d,p,i.image[t])}}a.__maxMipLevel=w.length}y(e,f)&&x(34067,e,h.width,h.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture)}function E(t,e){n.activeTexture(33984+e),n.bindTexture(34067,i.get(t).__webglTexture)}const q={[ht]:10497,[ft]:33071,[dt]:33648},C={[pt]:9728,[mt]:9984,[vt]:9986,[xt]:9729,[bt]:9985,[_t]:9987};function P(n,o,a){a?(t.texParameteri(n,10242,q[o.wrapS]),t.texParameteri(n,10243,q[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,q[o.wrapR]),t.texParameteri(n,10240,C[o.magFilter]),t.texParameteri(n,10241,C[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===ft&&o.wrapT===ft||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,w(o.magFilter)),t.texParameteri(n,10241,w(o.minFilter)),o.minFilter!==pt&&o.minFilter!==xt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=e.get("EXT_texture_filter_anisotropic");if(l){if(o.type===Pt&&null===e.get("OES_texture_float_linear"))return;if(o.type===Rt&&null===(s||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function R(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",_),e.__webglTexture=t.createTexture(),a.memory.textures++)}function L(e,i,r){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),R(e,i),n.activeTexture(33984+r),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);const l=function(t){return!s&&(t.wrapS!==ft||t.wrapT!==ft||t.minFilter!==pt&&t.minFilter!==xt)}(i)&&!1===v(i.image),c=g(i.image,l,!1,u),h=v(c)||s,f=o.convert(i.format);let d,p=o.convert(i.type),m=b(i.internalFormat,f,p);P(a,i,h);const w=i.mipmaps;if(i.isDepthTexture)m=6402,s?m=i.type===Pt?36012:i.type===Ct?33190:i.type===Ot?35056:33189:i.type===Pt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===jt&&6402===m&&i.type!==Et&&i.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Et,p=o.convert(i.type)),i.format===Vt&&6402===m&&(m=34041,i.type!==Ot&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ot,p=o.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,f,p,null);else if(i.isDataTexture)if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)d=w[t],n.texImage2D(3553,t,m,d.width,d.height,0,f,p,d.data);i.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,f,p,c.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(let t=0,e=w.length;t<e;t++)d=w[t],i.format!==Bt&&i.format!==Ft?null!==f?n.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,m,d.width,d.height,0,f,p,d.data);e.__maxMipLevel=w.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,f,p,c.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,f,p,c.data),e.__maxMipLevel=0;else if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)d=w[t],n.texImage2D(3553,t,m,f,p,d);i.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,f,p,c),e.__maxMipLevel=0;y(i,h)&&x(a,i,c.width,c.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function I(e,r,a,s){const l=o.convert(r.texture.format),c=o.convert(r.texture.type),u=b(r.texture.internalFormat,l,c);n.texImage2D(s,0,u,r.width,r.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function D(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Pt?r=36012:e.type===Ct&&(r=33190));const i=N(n);t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const e=N(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=o.convert(n.texture.format),r=o.convert(n.texture.type),a=b(n.texture.internalFormat,e,r);if(i){const e=N(n);t.renderbufferStorageMultisample(36161,e,a,n.width,n.height)}else t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function O(e){const n=i.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===jt)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==Vt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)t.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=t.createRenderbuffer(),D(n.__webglDepthbuffer[i],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),D(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function N(t){return s&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let F=!1,B=!1;this.allocateTextureUnit=function(){const t=S;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?L(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?L(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=A,this.setTextureCubeDynamic=E,this.setupRenderTarget=function(e){const r=i.get(e),l=i.get(e.texture);e.addEventListener("dispose",M),l.__webglTexture=t.createTexture(),a.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=v(e)||s;if(!s||e.texture.format!==Ft||e.texture.type!==Pt&&e.texture.type!==Rt||(e.texture.format=Bt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),u)if(s){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const n=o.convert(e.texture.format),i=o.convert(e.texture.type),a=b(e.texture.internalFormat,n,i),s=N(e);t.renderbufferStorageMultisample(36161,s,a,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),D(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),P(34067,e.texture,h);for(let t=0;t<6;t++)I(r.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,h)&&x(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),P(3553,e.texture,h),I(r.__webglFramebuffer,e,36064,3553),y(e.texture,h)&&x(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,v(t)||s)){const r=t.isWebGLCubeRenderTarget?34067:3553,o=i.get(e).__webglTexture;n.bindTexture(r,o),x(r,e,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(s){const n=i.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const r=e.width,o=e.height;let a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,r,o,0,0,r,o,a,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?A(t,e):E(t,e)}}function Ls(t,e,n){const i=n.isWebGL2;return{convert:function(t){let n;if(t===St)return 5121;if(t===Lt)return 32819;if(t===It)return 32820;if(t===Dt)return 33635;if(t===Tt)return 5120;if(t===At)return 5122;if(t===Et)return 5123;if(t===qt)return 5124;if(t===Ct)return 5125;if(t===Pt)return 5126;if(t===Rt)return i?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(t===Nt)return 6406;if(t===Ft)return 6407;if(t===Bt)return 6408;if(t===zt)return 6409;if(t===Ut)return 6410;if(t===jt)return 6402;if(t===Vt)return 34041;if(t===Gt)return 6403;if(t===Ht)return 36244;if(t===Wt)return 33319;if(t===Xt)return 33320;if(t===Yt)return 36248;if(t===Zt)return 36249;if(t===Qt||t===Jt||t===Kt||t===$t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===Qt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Jt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Kt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===$t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===te||t===ee||t===ne||t===ie){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(t===te)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ee)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===ne)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ie)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===re)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===oe||t===ae)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(t===oe)return n.COMPRESSED_RGB8_ETC2;if(t===ae)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===se||t===le||t===ce||t===ue||t===he||t===fe||t===de||t===pe||t===me||t===ge||t===ve||t===ye||t===xe||t===be||t===_e||t===Me||t===Se||t===Te||t===Ae||t===Ee||t===qe||t===Ce||t===Pe||t===Re||t===Le||t===Ie||t===De||t===Oe?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):t===we?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===Ot?i?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Is(){Zi.call(this),this.type="Group"}function Ds(t){Mo.call(this),this.cameras=t||[]}Is.prototype=Object.assign(Object.create(Zi.prototype),{constructor:Is,isGroup:!0}),Ds.prototype=Object.assign(Object.create(Mo.prototype),{constructor:Ds,isArrayCamera:!0});var Os=new Qn,Ns=new Qn;function Fs(t){var e,n,i=this,r=null,o=null,a=null,s=[],l=new Si,c=new Si,u=1,h="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",b,!1));var f=new Si,d=new Zn,p=new Qn,m=new Mo;m.viewport=new Wn,m.layers.enable(1);var g=new Mo;g.viewport=new Wn,g.layers.enable(2);var v=new Ds([m,g]);v.layers.enable(1),v.layers.enable(2);var y,x=new Un;function b(){if(i.isPresenting=null!==r&&!0===r.isPresenting){var o=r.getEyeParameters("left");e=2*o.renderWidth*u,n=o.renderHeight*u,y=t.getPixelRatio(),t.getSize(x),t.setDrawingBufferSize(e,n,1),m.viewport.set(0,0,e/2,n),g.viewport.set(e/2,0,e/2,n),T.start(),i.dispatchEvent({type:"sessionstart"})}else i.enabled&&t.setDrawingBufferSize(x.width,x.height,y),T.stop(),i.dispatchEvent({type:"sessionend"})}var w=[],_=[];function M(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),n=0,i=e.length;n<i;n++){var r=e[n];if(r&&("Daydream Controller"===r.id||"Gear VR Controller"===r.id||"Oculus Go Controller"===r.id||"OpenVR Gamepad"===r.id||r.id.startsWith("Oculus Touch")||r.id.startsWith("HTC Vive Focus")||r.id.startsWith("Spatial Controller"))){var o=r.hand;if(0===t&&(""===o||"right"===o))return r;if(1===t&&"left"===o)return r}}}function S(t,i){null!==i&&4===i.length&&t.set(i[0]*e,i[1]*n,i[2]*e,i[3]*n)}this.enabled=!1,this.getController=function(t){var e=s[t];return void 0===e&&((e=new Is).matrixAutoUpdate=!1,e.visible=!1,s[t]=e),e},this.getDevice=function(){return r},this.setDevice=function(t){void 0!==t&&(r=t),T.setContext(t)},this.setFramebufferScaleFactor=function(t){u=t},this.setReferenceSpaceType=function(t){h=t},this.setPoseTarget=function(t){void 0!==t&&(a=t)},this.getCamera=function(t){var e="local-floor"===h?1.6:0;if(r.depthNear=t.near,r.depthFar=t.far,r.getFrameData(o),"local-floor"===h){var n=r.stageParameters;n?l.fromArray(n.sittingToStandingTransform):l.makeTranslation(0,e,0)}var i=o.pose,u=null!==a?a:t;u.matrix.copy(l),u.matrix.decompose(u.position,u.quaternion,u.scale),null!==i.orientation&&(d.fromArray(i.orientation),u.quaternion.multiply(d)),null!==i.position&&(d.setFromRotationMatrix(l),p.fromArray(i.position),p.applyQuaternion(d),u.position.add(p)),u.updateMatrixWorld();for(var y=u.children,x=0,b=y.length;x<b;x++)y[x].updateMatrixWorld(!0);m.near=t.near,g.near=t.near,m.far=t.far,g.far=t.far,m.matrixWorldInverse.fromArray(o.leftViewMatrix),g.matrixWorldInverse.fromArray(o.rightViewMatrix),c.getInverse(l),"local-floor"===h&&(m.matrixWorldInverse.multiply(c),g.matrixWorldInverse.multiply(c));var T=u.parent;null!==T&&(f.getInverse(T.matrixWorld),m.matrixWorldInverse.multiply(f),g.matrixWorldInverse.multiply(f)),m.matrixWorld.getInverse(m.matrixWorldInverse),g.matrixWorld.getInverse(g.matrixWorldInverse),m.projectionMatrix.fromArray(o.leftProjectionMatrix),g.projectionMatrix.fromArray(o.rightProjectionMatrix),function(t,e,n){Os.setFromMatrixPosition(e.matrixWorld),Ns.setFromMatrixPosition(n.matrixWorld);var i=Os.distanceTo(Ns),r=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],f=a*u,d=a*h,p=i/(-u+h),m=p*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=a+p,v=s+p,y=f-m,x=d+(i-m),b=l*s/v*g,w=c*s/v*g;t.projectionMatrix.makePerspective(y,x,b,w,g,v)}(v,m,g);var A=r.getLayers();if(A.length){var E=A[0];S(m.viewport,E.leftBounds),S(g.viewport,E.rightBounds)}return function(){for(var t=0;t<s.length;t++){var e=s[t],n=M(t);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var i=n.pose;!1===i.hasPosition&&e.position.set(.2,-.6,-.05),null!==i.position&&e.position.fromArray(i.position),null!==i.orientation&&e.quaternion.fromArray(i.orientation),e.matrix.compose(e.position,e.quaternion,e.scale),e.matrix.premultiply(l),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0,e.visible=!0;var r="Daydream Controller"===n.id?0:1;void 0===w[t]&&(w[t]=!1),w[t]!==n.buttons[r].pressed&&(w[t]=n.buttons[r].pressed,!0===w[t]?e.dispatchEvent({type:"selectstart"}):(e.dispatchEvent({type:"selectend"}),e.dispatchEvent({type:"select"}))),r=2,void 0===_[t]&&(_[t]=!1),void 0!==n.buttons[r]&&_[t]!==n.buttons[r].pressed&&(_[t]=n.buttons[r].pressed,!0===_[t]?e.dispatchEvent({type:"squeezestart"}):(e.dispatchEvent({type:"squeezeend"}),e.dispatchEvent({type:"squeeze"})))}else e.visible=!1}}(),v},this.getStandingMatrix=function(){return l},this.isPresenting=!1;var T=new Po;this.setAnimationLoop=function(t){T.setAnimationLoop(t),this.isPresenting&&T.start()},this.submitFrame=function(){this.isPresenting&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",b)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Bs(){this._targetRay=null,this._grip=null,this._hand=null}function zs(t,e){const n=this;let i=null,r=1,o=null,a="local-floor",s=null;var l=null;const c=[],u=new Map;var h,f=[];const d=new Mo;d.layers.enable(1),d.viewport=new Wn;const p=new Mo;p.layers.enable(2),p.viewport=new Wn;const m=[d,p],g=new Ds;g.layers.enable(1),g.layers.enable(2);let v=null,y=null;function x(t){const e=u.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function b(){u.forEach((function(t,e){t.disconnect(e)})),u.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),E.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function w(t){o=t,E.setContext(i),E.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function _(t){const e=i.inputSources;for(let t=0;t<c.length;t++)u.set(e[t],c[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=u.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),u.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=u.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.getCameraPose=function(){return s},this.getController=function(t){let e=c[index];return void 0===e&&(e=new Bs,c[index]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=c[t];return void 0===e&&(e=new Bs,c[t]=e),e.getGripSpace()},this.getHand=function(t){let e=c[t];return void 0===e&&(e=new Bs,c[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.addLayer=function(t){window.XRWebGLBinding&&this.layersEnabled&&(f.push(t),i.updateRenderState({layers:f}))},this.removeLayer=function(t){window.XRWebGLBinding&&this.layersEnabled&&(f.splice(f.indexOf(t),1),i.updateRenderState({layers:f}))},this.setSession=function(t){if(i=t,null!==i){i.addEventListener("select",x),i.addEventListener("selectstart",x),i.addEventListener("selectend",x),i.addEventListener("squeeze",x),i.addEventListener("squeezestart",x),i.addEventListener("squeezeend",x),i.addEventListener("end",b);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,e,n),window.XRWebGLBinding&&this.layersEnabled?this.addLayer(h):i.updateRenderState({baseLayer:h}),i.requestReferenceSpace(a).then(w),i.addEventListener("inputsourceschange",_)}};const M=new Qn,S=new Qn;function T(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.setPoseTarget=function(t){void 0!==t&&(l=t)},this.getCamera=function(t){g.near=p.near=d.near=t.near,g.far=p.far=d.far=t.far,v===g.near&&y===g.far||(i.updateRenderState({depthNear:g.near,depthFar:g.far}),v=g.near,y=g.far);const e=t.parent,n=g.cameras;var r=l||t;T(g,e);for(let t=0;t<n.length;t++)T(n[t],e);r.matrixWorld.copy(g.matrixWorld);const o=r.children;for(let t=0,e=o.length;t<e;t++)o[t].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){M.setFromMatrixPosition(e.matrixWorld),S.setFromMatrixPosition(n.matrixWorld);const i=M.distanceTo(S),r=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],f=a*u,d=a*h,p=i/(-u+h),m=p*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const g=a+p,v=s+p,y=f-m,x=d+(i-m),b=l*s/v*g,w=c*s/v*g;t.projectionMatrix.makePerspective(y,x,b,w,g,v)}(g,d,p):g.projectionMatrix.copy(d.projectionMatrix),g};let A=null;const E=new Po;E.setAnimationLoop((function(e,n){if(s=n.getViewerPose(o),null!==s){const e=s.views;t.setFramebuffer(h.framebuffer);let n=!1;e.length!==g.cameras.length&&(g.cameras.length=0,n=!0);for(let t=0;t<e.length;t++){const i=e[t],r=h.getViewport(i),o=m[t];o.matrix.fromArray(i.transform.matrix),o.projectionMatrix.fromArray(i.projectionMatrix),o.viewport.set(r.x,r.y,r.width,r.height),0===t&&g.matrix.copy(o.matrix),!0===n&&g.cameras.push(o)}}const r=i.inputSources;for(let t=0;t<c.length;t++){const e=c[t],i=r[t];e.update(i,n,o)}A&&A(e,n)})),this.setAnimationLoop=function(t){A=t},this.dispose=function(){}}function Us(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const i=t.get(n).envMap;if(i){e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const r=t.get(i).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,o;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,n.side===m&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),n.side===m&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,o){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===m&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,i):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===m&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===m&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,o):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function ks(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,f=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Qe,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const d=this;let p=!1,m=null,g=0,v=0,y=null,x=null,b=-1,w=null,_=null;const M=new Wn,S=new Wn;let T=null,A=e.width,E=e.height,q=1,C=null,P=null;const R=new Wn(0,0,A,E),L=new Wn(0,0,A,E);let I=!1;const D=new Co;let O=!1,N=!1;const F=new Si,B=new Qn,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===y?q:1}let k,j,V,G,H,W,X,Y,Z,Q,J,$,tt,et,nt,it,rt,ot,at,st,lt,ct=n;function ut(t,n){for(let i=0;i<t.length;i++){const r=t[i],o=e.getContext(r,n);if(null!==o)return o}return null}try{const t={alpha:i,depth:r,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",mt,!1),null===ct){const e=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&e.shift(),ct=ut(e,t),null===ct)throw ut(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ct.getShaderPrecisionFormat&&(ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ht(){k=new Vo(ct),j=new Uo(ct,k,t),!1===j.isWebGL2&&(k.get("WEBGL_depth_texture"),k.get("OES_texture_float"),k.get("OES_texture_half_float"),k.get("OES_texture_half_float_linear"),k.get("OES_standard_derivatives"),k.get("OES_element_index_uint"),k.get("OES_vertex_array_object"),k.get("ANGLE_instanced_arrays")),k.get("OES_texture_float_linear"),st=new Ls(ct,k,j),V=new Ps(ct,k,j),V.scissor(S.copy(L).multiplyScalar(q).floor()),V.viewport(M.copy(R).multiplyScalar(q).floor()),G=new Wo(ct),H=new gs,W=new Rs(ct,k,V,H,j,st,G),X=new jo(d),Y=new Ro(ct,j),lt=new Bo(ct,k,Y,j),Z=new Go(ct,Y,G,lt),Q=new Qo(ct,Z,Y,G),rt=new Zo(ct),nt=new ko(H),J=new ms(d,X,k,j,lt,nt),$=new Us(H),tt=new bs(H),et=new As,it=new Fo(d,X,V,Q,s),ot=new zo(ct,k,G,j),at=new Ho(ct,k,G,j),G.programs=J.programs,d.capabilities=j,d.extensions=k,d.properties=H,d.renderLists=tt,d.state=V,d.info=G}ht();const ft="undefined"!=typeof navigator&&"xr"in navigator?new zs(d,ct):new Fs(d);this.xr=ft;const dt=new Cs(d,Q,j.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function mt(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1,ht()}function gt(t){const e=t.target;e.removeEventListener("dispose",gt),function(t){vt(t),H.remove(t)}(e)}function vt(t){const e=H.get(t).program;void 0!==e&&J.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return ct},this.getContextAttributes=function(){return ct.getContextAttributes()},this.forceContextLoss=function(){const t=k.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=k.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(t){void 0!==t&&(q=t,this.setSize(A,E,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Un),t.set(A,E)},this.setSize=function(t,n,i){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=t,E=n,e.width=Math.floor(t*q),e.height=Math.floor(n*q),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Un),t.set(A*q,E*q).floor()},this.setDrawingBufferSize=function(t,n,i){A=t,E=n,q=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Wn),t.copy(M)},this.getViewport=function(t){return t.copy(R)},this.setViewport=function(t,e,n,i){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,n,i),V.viewport(M.copy(R).multiplyScalar(q).floor())},this.getScissor=function(t){return t.copy(L)},this.setScissor=function(t,e,n,i){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,i),V.scissor(S.copy(L).multiplyScalar(q).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){V.setScissorTest(I=t)},this.setOpaqueSort=function(t){C=t},this.setTransparentSort=function(t){P=t},this.getClearColor=function(){return it.getClearColor()},this.setClearColor=function(){it.setClearColor.apply(it,arguments)},this.getClearAlpha=function(){return it.getClearAlpha()},this.setClearAlpha=function(){it.setClearAlpha.apply(it,arguments)},this.clear=function(t,e,n){let i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),ct.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",mt,!1),tt.dispose(),et.dispose(),H.dispose(),X.dispose(),Q.dispose(),lt.dispose(),ft.dispose(),xt.stop()},this.renderBufferImmediate=function(t,e){lt.initAttributes();const n=H.get(t);t.hasPositions&&!n.position&&(n.position=ct.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ct.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ct.createBuffer()),t.hasColors&&!n.color&&(n.color=ct.createBuffer());const i=e.getAttributes();t.hasPositions&&(ct.bindBuffer(34962,n.position),ct.bufferData(34962,t.positionArray,35048),lt.enableAttribute(i.position),ct.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(ct.bindBuffer(34962,n.normal),ct.bufferData(34962,t.normalArray,35048),lt.enableAttribute(i.normal),ct.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(ct.bindBuffer(34962,n.uv),ct.bufferData(34962,t.uvArray,35048),lt.enableAttribute(i.uv),ct.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(ct.bindBuffer(34962,n.color),ct.bufferData(34962,t.colorArray,35048),lt.enableAttribute(i.color),ct.vertexAttribPointer(i.color,3,5126,!1,0,0)),lt.disableUnusedAttributes(),ct.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,r,o){null===e&&(e=z);const a=r.isMesh&&r.matrixWorld.determinant()<0,s=Tt(t,e,i,r);V.setMaterial(i,a);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===i.wireframe&&(l=Z.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&rt.update(r,n,i,s),lt.setup(r,i,s,n,l);let f=ot;null!==l&&(u=Y.get(l),f=at,f.setIndex(u));const d=null!==l?l.count:c.count,p=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(p,g),x=Math.min(d,p+m,g+v)-1,b=Math.max(0,x-y+1);if(0!==b){if(r.isMesh)!0===i.wireframe?(V.setLineWidth(i.wireframeLinewidth*U()),f.setMode(1)):f.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),V.setLineWidth(t*U()),r.isLineSegments?f.setMode(1):r.isLineLoop?f.setMode(2):f.setMode(3)}else r.isPoints?f.setMode(0):r.isSprite&&f.setMode(4);if(r.isInstancedMesh)f.renderInstances(y,b,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(y,b,t)}else f.render(y,b)}},this.compile=function(t,e){f=et.get(t,e),f.init(),t.traverse((function(t){t.isLight&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(e);const n=new WeakMap;t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){const o=i[r];!1===n.has(o)&&(Mt(o,t,e),n.set(o))}else!1===n.has(i)&&(Mt(i,t,e),n.set(i))}))};let yt=null;const xt=new Po;function bt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){i&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=Q.update(t),r=t.material;r.visible&&h.push(t,e,r,n,B.z,null)}}else if(t.isImmediateRenderObject)i&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F),h.push(t,null,t.material,n,B.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==G.render.frame&&(t.skeleton.update(),t.skeleton.frame=G.render.frame),!t.frustumCulled||D.intersectsObject(t))){i&&B.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=Q.update(t),r=t.material;if(Array.isArray(r)){const i=e.groups;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=r[a.materialIndex];s&&s.visible&&h.push(t,e,s,n,B.z,a)}}else r.visible&&h.push(t,e,r,n,B.z,null)}const r=t.children;for(let t=0,o=r.length;t<o;t++)bt(r[t],e,n,i)}function wt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,o=t.length;r<o;r++){const o=t[r],a=o.object,s=o.geometry,l=null===i?o.material:i,c=o.group;if(n.isArrayCamera){_=n;const t=n.cameras;for(let n=0,i=t.length;n<i;n++){const i=t[n];a.layers.test(i.layers)&&(V.viewport(M.copy(i.viewport)),f.setupLights(i),_t(a,e,i,s,l,c))}}else _=null,_t(a,e,n,s,l,c)}}function _t(t,e,n,i,r,o){if(t.onBeforeRender(d,e,n,i,r,o),f=et.get(e,_||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const i=Tt(n,e,r,t);V.setMaterial(r),lt.reset(),function(t,e){t.render((function(t){d.renderBufferImmediate(t,e)}))}(t,i)}else d.renderBufferDirect(n,e,i,r,t,o);t.onAfterRender(d,e,n,i,r,o),f=et.get(e,_||n)}function Mt(t,e,n){!0!==e.isScene&&(e=z);const i=H.get(t),r=f.state.lights,o=f.state.shadowsArray,a=r.state.version,s=J.getParameters(t,r.state,o,e,n),l=J.getProgramCacheKey(s);let c=i.program,u=!0;if(void 0===c)t.addEventListener("dispose",gt);else if(c.cacheKey!==l)vt(t);else if(i.lightsStateVersion!==a)u=!1;else{if(void 0!==s.shaderID){const n=t.isMeshStandardMaterial?e.environment:null;return void(i.envMap=X.get(t.envMap||n))}u=!1}u&&(s.uniforms=J.getUniforms(t),t.onBeforeCompile(s,d),c=J.acquireProgram(s,l),i.program=c,i.uniforms=s.uniforms,i.outputEncoding=s.outputEncoding);const h=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=nt.numPlanes,i.numIntersection=nt.numIntersection,h.clippingPlanes=nt.uniform),i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=X.get(t.envMap||i.environment),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=i.program.getUniforms(),m=Ya.seqWithValue(p.seq,h);i.uniformsList=m}function Tt(t,e,n,i){!0!==e.isScene&&(e=z),W.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===y?d.outputEncoding:y.texture.encoding,s=X.get(n.envMap||o),l=H.get(n),c=f.state.lights;if(!0===O&&(!0===N||t!==w)){const e=t===w&&n.id===b;nt.setState(n,t,e)}n.version===l.__version?n.fog&&l.fog!==r?Mt(n,e,i):l.environment!==o?Mt(n,e,i):l.needsLights&&l.lightsStateVersion!==c.state.version?Mt(n,e,i):void 0===l.numClippingPlanes||l.numClippingPlanes===nt.numPlanes&&l.numIntersection===nt.numIntersection?l.outputEncoding!==a?Mt(n,e,i):l.envMap!==s&&Mt(n,e,i):Mt(n,e,i):(Mt(n,e,i),l.__version=n.version);let u=!1,h=!1,p=!1;const m=l.program,g=m.getUniforms(),v=l.uniforms;if(V.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==b&&(b=n.id,h=!0),u||w!==t){if(g.setValue(ct,"projectionMatrix",t.projectionMatrix),j.logarithmicDepthBuffer&&g.setValue(ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(ct,B.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ct,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ct,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){g.setOptional(ct,i,"bindMatrix"),g.setOptional(ct,i,"bindMatrixInverse");const t=i.skeleton;if(t){const e=t.bones;if(j.floatVertexTextures){if(void 0===t.boneTexture){let n=Math.sqrt(4*e.length);n=zn.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(t.boneMatrices);const r=new Ao(i,n,n,Bt,Pt);t.boneMatrices=i,t.boneTexture=r,t.boneTextureSize=n}g.setValue(ct,"boneTexture",t.boneTexture,W),g.setValue(ct,"boneTextureSize",t.boneTextureSize)}else g.setOptional(ct,t,"boneMatrices")}}var x,_;return(h||l.receiveShadow!==i.receiveShadow)&&(l.receiveShadow=i.receiveShadow,g.setValue(ct,"receiveShadow",i.receiveShadow)),h&&(g.setValue(ct,"toneMappingExposure",d.toneMappingExposure),l.needsLights&&(_=p,(x=v).ambientLightColor.needsUpdate=_,x.lightProbe.needsUpdate=_,x.directionalLights.needsUpdate=_,x.directionalLightShadows.needsUpdate=_,x.pointLights.needsUpdate=_,x.pointLightShadows.needsUpdate=_,x.spotLights.needsUpdate=_,x.spotLightShadows.needsUpdate=_,x.rectAreaLights.needsUpdate=_,x.hemisphereLights.needsUpdate=_),r&&n.fog&&$.refreshFogUniforms(v,r),$.refreshMaterialUniforms(v,n,q,E),Ya.upload(ct,l.uniformsList,v,W)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Ya.upload(ct,l.uniformsList,v,W),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ct,"center",i.center),g.setValue(ct,"modelViewMatrix",i.modelViewMatrix),g.setValue(ct,"normalMatrix",i.normalMatrix),g.setValue(ct,"modelMatrix",i.matrixWorld),m}var At;xt.setAnimationLoop((function(t){ft.isPresenting||yt&&yt(t)})),"undefined"!=typeof window&&xt.setContext(window),this.setAnimationLoop=function(t){yt=t,ft.setAnimationLoop(t),null===t?xt.stop():xt.start()},this.render=function(t,e){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===p)return;lt.resetDefaultState(),b=-1,w=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(e=ft.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,n||y),f=et.get(t,e),f.init(),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(F),N=this.localClippingEnabled,O=nt.init(this.clippingPlanes,N,e),h=tt.get(t,e),h.init(),bt(t,e,0,d.sortObjects),h.finish(),!0===d.sortObjects&&h.sort(C,P),!0===O&&nt.beginShadows();const r=f.state.shadowsArray;dt.render(r,t,e),f.setupLights(e),!0===O&&nt.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),it.render(h,t,e,i);const o=h.opaque,a=h.transparent;o.length>0&&wt(o,t,e),a.length>0&&wt(a,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==y&&(W.updateRenderTargetMipmap(y),W.updateMultisampleRenderTarget(y)),V.buffers.depth.setTest(!0),V.buffers.depth.setMask(!0),V.buffers.color.setMask(!0),V.setPolygonOffset(!1),ft.enabled&&ft.submitFrame&&ft.submitFrame(),h=null,f=null},this.setTexture2D=(At=!1,function(t,e){t&&t.isWebGLRenderTarget&&(At||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),At=!0),t=t.texture),W.setTexture2D(t,e)}),this.setFramebuffer=function(t){m!==t&&null===y&&ct.bindFramebuffer(36160,t),m=t},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderState=function(){return f},this.setRenderState=function(t){f=t},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e=0,n=0){y=t,g=e,v=n,t&&void 0===H.get(t).__webglFramebuffer&&W.setupRenderTarget(t);let i=m,r=!1;if(t){const n=H.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=n[e],r=!0):i=t.isWebGLMultisampleRenderTarget?H.get(t).__webglMultisampledFramebuffer:n,M.copy(t.viewport),S.copy(t.scissor),T=t.scissorTest}else M.copy(R).multiplyScalar(q).floor(),S.copy(L).multiplyScalar(q).floor(),T=I;if(x!==i&&(ct.bindFramebuffer(36160,i),x=i),V.viewport(M),V.scissor(S),V.setScissorTest(T),r){const i=H.get(t.texture);ct.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,i,r,o,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=H.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){let a=!1;s!==x&&(ct.bindFramebuffer(36160,s),a=!0);try{const s=t.texture,l=s.format,c=s.type;if(l!==Bt&&st.convert(l)!==ct.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===St||st.convert(c)===ct.getParameter(35738)||c===Pt&&(j.isWebGL2||k.get("OES_texture_float")||k.get("WEBGL_color_buffer_float"))||c===Rt&&(j.isWebGL2?k.get("EXT_color_buffer_float"):k.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ct.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&ct.readPixels(e,n,i,r,st.convert(l),st.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&ct.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),a=st.convert(e.format);W.setTexture2D(e,0),ct.copyTexImage2D(3553,n,a,t.x,t.y,r,o,0),V.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i){void 0===i&&(i=0);const r=e.image.width,o=e.image.height,a=st.convert(n.format),s=st.convert(n.type);W.setTexture2D(n,0),ct.pixelStorei(37440,n.flipY),ct.pixelStorei(37441,n.premultiplyAlpha),ct.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ct.texSubImage2D(3553,i,t.x,t.y,r,o,a,s,e.image.data):e.isCompressedTexture?ct.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):ct.texSubImage2D(3553,i,t.x,t.y,a,s,e.image),0===i&&n.generateMipmaps&&ct.generateMipmap(3553),V.unbindTexture()},this.initTexture=function(t){W.setTexture2D(t,0),V.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function js(t){ks.call(this,t)}Object.assign(Fs.prototype,Nn.prototype),Object.assign(Bs.prototype,{constructor:Bs,getHandSpace:function(){if(null===this._hand&&(this._hand=new Is,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Is;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Is,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Is,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let i=null,r=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(t)if(l&&t.hand){o=!0;for(let i=0;i<=window.XRHand.LITTLE_PHALANX_TIP;i++)if(t.hand[i]){const r=e.getJointPose(t.hand[i],n),o=l.joints[i];null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=r.radius),o.visible=null!==r;const a=l.joints[window.XRHand.INDEX_PHALANX_TIP],s=l.joints[window.XRHand.THUMB_PHALANX_TIP],c=a.position.distanceTo(s.position),u=.02,h=.005;l.inputState.pinching&&c>u+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&c<=u-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==a&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),null!==s&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)));return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==o),this}}),Object.assign(zs.prototype,Nn.prototype),js.prototype=Object.assign(Object.create(ks.prototype),{constructor:js,isWebGL1Renderer:!0});class Vs{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new vr(t),this.density=void 0!==e?e:25e-5}clone(){return new Vs(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Gs{constructor(t,e,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new vr(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}clone(){return new Gs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Hs extends Zi{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function Ws(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=zn.generateUUID()}Object.defineProperty(Ws.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ws.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new Ws(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Xs=new Qn;function Ys(t,e,n,i){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}function Zs(t){br.call(this),this.type="SpriteMaterial",this.color=new vr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let Qs;Object.defineProperties(Ys.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Ys.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)Xs.x=this.getX(e),Xs.y=this.getY(e),Xs.z=this.getZ(e),Xs.applyMatrix4(t),this.setXYZ(e,Xs.x,Xs.y,Xs.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Sr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ys(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Zs.prototype=Object.create(br.prototype),Zs.prototype.constructor=Zs,Zs.prototype.isSpriteMaterial=!0,Zs.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const Js=new Qn,Ks=new Qn,$s=new Qn,tl=new Un,el=new Un,nl=new Si,il=new Qn,rl=new Qn,ol=new Qn,al=new Un,sl=new Un,ll=new Un;function cl(t){if(Zi.call(this),this.type="Sprite",void 0===Qs){Qs=new Vr;const t=new Ws(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Qs.setIndex([0,1,2,0,2,3]),Qs.setAttribute("position",new Ys(t,3,0,!1)),Qs.setAttribute("uv",new Ys(t,2,3,!1))}this.geometry=Qs,this.material=void 0!==t?t:new Zs,this.center=new Un(.5,.5)}function ul(t,e,n,i,r,o){tl.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(el.x=o*tl.x-r*tl.y,el.y=r*tl.x+o*tl.y):el.copy(tl),t.copy(e),t.x+=el.x,t.y+=el.y,t.applyMatrix4(nl)}cl.prototype=Object.assign(Object.create(Zi.prototype),{constructor:cl,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ks.setFromMatrixScale(this.matrixWorld),nl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),$s.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ks.multiplyScalar(-$s.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;ul(il.set(-.5,-.5,0),$s,o,Ks,i,r),ul(rl.set(.5,-.5,0),$s,o,Ks,i,r),ul(ol.set(.5,.5,0),$s,o,Ks,i,r),al.set(0,0),sl.set(1,0),ll.set(1,1);let a=t.ray.intersectTriangle(il,rl,ol,!1,Js);if(null===a&&(ul(rl.set(-.5,.5,0),$s,o,Ks,i,r),sl.set(0,1),a=t.ray.intersectTriangle(il,ol,rl,!1,Js),null===a))return;const s=t.ray.origin.distanceTo(Js);s<t.near||s>t.far||e.push({distance:s,point:Js.clone(),uv:ur.getUV(Js,il,rl,ol,al,sl,ll,new Un),face:null,object:this})},copy:function(t){return Zi.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const hl=new Qn,fl=new Qn;function dl(){Zi.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function pl(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),so.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Si,this.bindMatrixInverse=new Si}dl.prototype=Object.assign(Object.create(Zi.prototype),{constructor:dl,isLOD:!0,copy:function(t){Zi.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){hl.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(hl);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){hl.setFromMatrixPosition(t.matrixWorld),fl.setFromMatrixPosition(this.matrixWorld);const n=hl.distanceTo(fl)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(t){const e=Zi.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e}}),pl.prototype=Object.assign(Object.create(so.prototype),{constructor:pl,isSkinnedMesh:!0,copy:function(t){return so.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Wn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){so.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new Qn,e=new Wn,n=new Wn,i=new Qn,r=new Si;return function(o,a){const s=this.skeleton,l=this.geometry;e.fromBufferAttribute(l.attributes.skinIndex,o),n.fromBufferAttribute(l.attributes.skinWeight,o),t.fromBufferAttribute(l.attributes.position,o).applyMatrix4(this.bindMatrix),a.set(0,0,0);for(let o=0;o<4;o++){const l=n.getComponent(o);if(0!==l){const n=e.getComponent(o);r.multiplyMatrices(s.bones[n].matrixWorld,s.boneInverses[n]),a.addScaledVector(i.copy(t).applyMatrix4(r),l)}}return a.applyMatrix4(this.bindMatrixInverse)}}()});const ml=new Si,gl=new Si;function vl(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Si)}}function yl(){Zi.call(this),this.type="Bone"}Object.assign(vl.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new Si;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:gl;ml.multiplyMatrices(r,e[i]),ml.toArray(n,16*i)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new vl(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),yl.prototype=Object.assign(Object.create(Zi.prototype),{constructor:yl,isBone:!0});const xl=new Si,bl=new Si,wl=[],_l=new so;function Ml(t,e,n){so.call(this,t,e),this.instanceMatrix=new Sr(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Sl(t){br.call(this),this.type="LineBasicMaterial",this.color=new vr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Ml.prototype=Object.assign(Object.create(so.prototype),{constructor:Ml,isInstancedMesh:!0,copy:function(t){return so.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new Sr(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,i=this.count;if(_l.geometry=this.geometry,_l.material=this.material,void 0!==_l.material)for(let r=0;r<i;r++){this.getMatrixAt(r,xl),bl.multiplyMatrices(n,xl),_l.matrixWorld=bl,_l.raycast(t,wl);for(let t=0,n=wl.length;t<n;t++){const n=wl[t];n.instanceId=r,n.object=this,e.push(n)}wl.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Sl.prototype=Object.create(br.prototype),Sl.prototype.constructor=Sl,Sl.prototype.isLineBasicMaterial=!0,Sl.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Tl=new Qn,Al=new Qn,El=new Si,ql=new Mi,Cl=new mi;function Pl(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Zi.call(this),this.type="Line",this.geometry=void 0!==t?t:new Vr,this.material=void 0!==e?e:new Sl,this.updateMorphTargets()}Pl.prototype=Object.assign(Object.create(Zi.prototype),{constructor:Pl,isLine:!0,copy:function(t){return Zi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Tl.fromBufferAttribute(e,t-1),Al.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Tl.distanceTo(Al);t.setAttribute("lineDistance",new Lr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let t=1,i=e.length;t<i;t++)n[t]=n[t-1],n[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cl.copy(n.boundingSphere),Cl.applyMatrix4(i),Cl.radius+=r,!1===t.ray.intersectsSphere(Cl))return;El.getInverse(i),ql.copy(t.ray).applyMatrix4(El);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Qn,l=new Qn,c=new Qn,u=new Qn,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position.array;if(null!==i){const n=i.array;for(let i=0,o=n.length-1;i<o;i+=h){const o=n[i],h=n[i+1];if(s.fromArray(r,3*o),l.fromArray(r,3*h),ql.distanceSqToSegment(s,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const f=t.ray.origin.distanceTo(u);f<t.near||f>t.far||e.push({distance:f,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let n=0,i=r.length/3-1;n<i;n+=h){if(s.fromArray(r,3*n),l.fromArray(r,3*n+3),ql.distanceSqToSegment(s,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const i=n.vertices,r=i.length;for(let n=0;n<r-1;n+=h){if(ql.distanceSqToSegment(i[n],i[n+1],u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Rl=new Qn,Ll=new Qn;function Il(t,e){Pl.call(this,t,e),this.type="LineSegments"}function Dl(t,e){Pl.call(this,t,e),this.type="LineLoop"}function Ol(t){br.call(this),this.type="PointsMaterial",this.color=new vr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Il.prototype=Object.assign(Object.create(Pl.prototype),{constructor:Il,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Rl.fromBufferAttribute(e,t),Ll.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Rl.distanceTo(Ll);t.setAttribute("lineDistance",new Lr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let t=0,i=e.length;t<i;t+=2)Rl.copy(e[t]),Ll.copy(e[t+1]),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Rl.distanceTo(Ll)}return this}}),Dl.prototype=Object.assign(Object.create(Pl.prototype),{constructor:Dl,isLineLoop:!0}),Ol.prototype=Object.create(br.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isPointsMaterial=!0,Ol.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Nl=new Si,Fl=new Mi,Bl=new mi,zl=new Qn;function Ul(t,e){Zi.call(this),this.type="Points",this.geometry=void 0!==t?t:new Vr,this.material=void 0!==e?e:new Ol,this.updateMorphTargets()}function kl(t,e,n,i,r,o,a){const s=Fl.distanceSqToPoint(t);if(s<n){const n=new Qn;Fl.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:a})}}function jl(t,e,n,i,r,o,a,s,l){Hn.call(this,t,e,n,i,r,o,a,s,l),this.format=void 0!==a?a:Ft,this.minFilter=void 0!==o?o:xt,this.magFilter=void 0!==r?r:xt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function Vl(t,e,n,i,r,o,a,s,l,c,u,h){Hn.call(this,null,o,a,s,l,c,i,r,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Gl(t,e,n,i,r,o,a,s,l){Hn.call(this,t,e,n,i,r,o,a,s,l),this.needsUpdate=!0}function Hl(t,e,n,i,r,o,a,s,l,c){if((c=void 0!==c?c:jt)!==jt&&c!==Vt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===jt&&(n=Et),void 0===n&&c===Vt&&(n=Ot),Hn.call(this,null,i,r,o,a,s,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:pt,this.minFilter=void 0!==s?s:pt,this.flipY=!1,this.generateMipmaps=!1}Ul.prototype=Object.assign(Object.create(Zi.prototype),{constructor:Ul,isPoints:!0,copy:function(t){return Zi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Bl.copy(n.boundingSphere),Bl.applyMatrix4(i),Bl.radius+=r,!1===t.ray.intersectsSphere(Bl))return;Nl.getInverse(i),Fl.copy(t.ray).applyMatrix4(Nl);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position.array;if(null!==r){const n=r.array;for(let r=0,s=n.length;r<s;r++){const s=n[r];zl.fromArray(o,3*s),kl(zl,s,a,i,t,e,this)}}else for(let n=0,r=o.length/3;n<r;n++)zl.fromArray(o,3*n),kl(zl,n,a,i,t,e,this)}else{const r=n.vertices;for(let n=0,o=r.length;n<o;n++)kl(r[n],n,a,i,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),jl.prototype=Object.assign(Object.create(Hn.prototype),{constructor:jl,isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Vl.prototype=Object.create(Hn.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isCompressedTexture=!0,Gl.prototype=Object.create(Hn.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isCanvasTexture=!0,Hl.prototype=Object.create(Hn.prototype),Hl.prototype.constructor=Hl,Hl.prototype.isDepthTexture=!0;class Wl extends Vr{constructor(t){super(),this.type="WireframeGeometry";const e=[],n=[0,0],i={},r=["a","b","c"];if(t&&t.isGeometry){const o=t.faces;for(let t=0,e=o.length;t<e;t++){const e=o[t];for(let t=0;t<3;t++){const o=e[r[t]],a=e[r[(t+1)%3]];n[0]=Math.min(o,a),n[1]=Math.max(o,a);const s=n[0]+","+n[1];void 0===i[s]&&(i[s]={index1:n[0],index2:n[1]})}}for(const n in i){const r=i[n];let o=t.vertices[r.index1];e.push(o.x,o.y,o.z),o=t.vertices[r.index2],e.push(o.x,o.y,o.z)}}else if(t&&t.isBufferGeometry){const r=new Qn;if(null!==t.index){const o=t.attributes.position,a=t.index;let s=t.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,e=s.length;t<e;++t){const e=s[t],r=e.start;for(let t=r,o=r+e.count;t<o;t+=3)for(let e=0;e<3;e++){const r=a.getX(t+e),o=a.getX(t+(e+1)%3);n[0]=Math.min(r,o),n[1]=Math.max(r,o);const s=n[0]+","+n[1];void 0===i[s]&&(i[s]={index1:n[0],index2:n[1]})}}for(const t in i){const n=i[t];r.fromBufferAttribute(o,n.index1),e.push(r.x,r.y,r.z),r.fromBufferAttribute(o,n.index2),e.push(r.x,r.y,r.z)}}else{const n=t.attributes.position;for(let t=0,i=n.count/3;t<i;t++)for(let i=0;i<3;i++){const o=3*t+i;r.fromBufferAttribute(n,o),e.push(r.x,r.y,r.z);const a=3*t+(i+1)%3;r.fromBufferAttribute(n,a),e.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Lr(e,3))}}function Xl(t,e,n){mo.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new Yl(t,e,n)),this.mergeVertices()}function Yl(t,e,n){Vr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const i=[],r=[],o=[],a=[],s=new Qn,l=new Qn,c=new Qn,u=new Qn,h=new Qn;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const f=e+1;for(let i=0;i<=n;i++){const f=i/n;for(let n=0;n<=e;n++){const i=n/e;t(i,f,l),r.push(l.x,l.y,l.z),i-1e-5>=0?(t(i-1e-5,f,c),u.subVectors(l,c)):(t(i+1e-5,f,c),u.subVectors(c,l)),f-1e-5>=0?(t(i,f-1e-5,c),h.subVectors(l,c)):(t(i,f+1e-5,c),h.subVectors(c,l)),s.crossVectors(u,h).normalize(),o.push(s.x,s.y,s.z),a.push(i,f)}}for(let t=0;t<n;t++)for(let n=0;n<e;n++){const e=t*f+n,r=t*f+n+1,o=(t+1)*f+n+1,a=(t+1)*f+n;i.push(e,r,a),i.push(r,o,a)}this.setIndex(i),this.setAttribute("position",new Lr(r,3)),this.setAttribute("normal",new Lr(o,3)),this.setAttribute("uv",new Lr(a,2))}Xl.prototype=Object.create(mo.prototype),Xl.prototype.constructor=Xl,Yl.prototype=Object.create(Vr.prototype),Yl.prototype.constructor=Yl;class Zl extends mo{constructor(t,e,n,i){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},this.fromBufferGeometry(new Ql(t,e,n,i)),this.mergeVertices()}}class Ql extends Vr{constructor(t,e,n,i){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1;const r=[],o=[];function a(t,e,n,i){const r=Math.pow(2,i),o=[];for(let i=0;i<=r;i++){o[i]=[];const a=t.clone().lerp(n,i/r),s=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)o[i][t]=0===t&&i===r?a:a.clone().lerp(s,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(s(o[t][n+1]),s(o[t+1][n]),s(o[t][n])):(s(o[t][n+1]),s(o[t+1][n+1]),s(o[t+1][n]))}}function s(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Qn,i=new Qn,r=new Qn;for(let o=0;o<e.length;o+=3)l(e[o+0],n),l(e[o+1],i),l(e[o+2],r),a(n,i,r,t)}(i=i||0),function(t){const e=new Qn;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Qn;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=u(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);o.push(i,1-a)}var e;(function(){const t=new Qn,e=new Qn,n=new Qn,i=new Qn,a=new Un,s=new Un,l=new Un;for(let h=0,f=0;h<r.length;h+=9,f+=6){t.set(r[h+0],r[h+1],r[h+2]),e.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),a.set(o[f+0],o[f+1]),s.set(o[f+2],o[f+3]),l.set(o[f+4],o[f+5]),i.copy(t).add(e).add(n).divideScalar(3);const d=u(i);c(a,f+0,t,d),c(s,f+2,e,d),c(l,f+4,n,d)}})(),function(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],i=o[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),i<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new Lr(r,3)),this.setAttribute("normal",new Lr(r.slice(),3)),this.setAttribute("uv",new Lr(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}}class Jl extends mo{constructor(t,e){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Kl(t,e)),this.mergeVertices()}}class Kl extends Ql{constructor(t,e){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class $l extends mo{constructor(t,e){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new tc(t,e)),this.mergeVertices()}}class tc extends Ql{constructor(t,e){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class ec extends mo{constructor(t,e){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new nc(t,e)),this.mergeVertices()}}class nc extends Ql{constructor(t,e){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class ic extends mo{constructor(t,e){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new rc(t,e)),this.mergeVertices()}}class rc extends Ql{constructor(t,e){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class oc extends mo{constructor(t,e,n,i,r,o){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const a=new ac(t,e,n,i,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}}class ac extends Vr{constructor(t,e,n,i,r){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},e=e||64,n=n||1,i=i||8,r=r||!1;const o=t.computeFrenetFrames(e,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Qn,s=new Qn,l=new Un;let c=new Qn;const u=[],h=[],f=[],d=[];function p(r){c=t.getPointAt(r/e,c);const l=o.normals[r],f=o.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),o=-Math.cos(e);s.x=o*l.x+r*f.x,s.y=o*l.y+r*f.y,s.z=o*l.z+r*f.z,s.normalize(),h.push(s.x,s.y,s.z),a.x=c.x+n*s.x,a.y=c.y+n*s.y,a.z=c.z+n*s.z,u.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)p(t);p(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,f.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),o=(i+1)*t+e,a=(i+1)*(t-1)+e;d.push(n,r,a),d.push(r,o,a)}}()}(),this.setIndex(d),this.setAttribute("position",new Lr(u,3)),this.setAttribute("normal",new Lr(h,3)),this.setAttribute("uv",new Lr(f,2))}toJSON(){const t=Vr.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class sc extends mo{constructor(t,e,n,i,r,o,a){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new lc(t,e,n,i,r,o)),this.mergeVertices()}}class lc extends Vr{constructor(t,e,n,i,r,o){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;const a=[],s=[],l=[],c=[],u=new Qn,h=new Qn,f=new Qn,d=new Qn,p=new Qn,m=new Qn,g=new Qn;for(let a=0;a<=n;++a){const y=a/n*r*Math.PI*2;v(y,r,o,t,f),v(y+.01,r,o,t,d),m.subVectors(d,f),g.addVectors(d,f),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,o=-e*Math.cos(r),d=e*Math.sin(r);u.x=f.x+(o*g.x+d*p.x),u.y=f.y+(o*g.y+d*p.y),u.z=f.z+(o*g.z+d*p.z),s.push(u.x,u.y,u.z),h.subVectors(u,f).normalize(),l.push(h.x,h.y,h.z),c.push(a/n),c.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),o=(i+1)*t+e,s=(i+1)*(t-1)+e;a.push(n,r,s),a.push(r,o,s)}function v(t,e,n,i,r){const o=Math.cos(t),a=Math.sin(t),s=n/e*t,l=Math.cos(s);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new Lr(s,3)),this.setAttribute("normal",new Lr(l,3)),this.setAttribute("uv",new Lr(c,2))}}class cc extends mo{constructor(t,e,n,i,r){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new uc(t,e,n,i,r)),this.mergeVertices()}}class uc extends Vr{constructor(t,e,n,i,r){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},t=t||1,e=e||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;const o=[],a=[],s=[],l=[],c=new Qn,u=new Qn,h=new Qn;for(let o=0;o<=n;o++)for(let f=0;f<=i;f++){const d=f/i*r,p=o/n*Math.PI*2;u.x=(t+e*Math.cos(p))*Math.cos(d),u.y=(t+e*Math.cos(p))*Math.sin(d),u.z=e*Math.sin(p),a.push(u.x,u.y,u.z),c.x=t*Math.cos(d),c.y=t*Math.sin(d),h.subVectors(u,c).normalize(),s.push(h.x,h.y,h.z),l.push(f/i),l.push(o/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,a=(i+1)*(t-1)+e,s=(i+1)*t+e;o.push(n,r,s),o.push(r,a,s)}this.setIndex(o),this.setAttribute("position",new Lr(a,3)),this.setAttribute("normal",new Lr(s,3)),this.setAttribute("uv",new Lr(l,2))}}const hc=function(t,e,n){n=n||2;const i=e&&e.length,r=i?e[0]*n:t.length;let o=fc(t,0,r,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c,u,h,f,d;if(i&&(o=function(t,e,n,i){const r=[];let o,a,s,l,c;for(o=0,a=e.length;o<a;o++)s=e[o]*i,l=o<a-1?e[o+1]*i:t.length,c=fc(t,s,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Mc(c));for(r.sort(xc),o=0;o<r.length;o++)bc(r[o],n),n=dc(n,n.next);return n}(t,e,o,n)),t.length>80*n){s=c=t[0],l=u=t[1];for(let e=n;e<r;e+=n)h=t[e],f=t[e+1],h<s&&(s=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-s,u-l),d=0!==d?1/d:0}return pc(o,a,n,s,l,d),a};function fc(t,e,n,i,r){let o,a;if(r===function(t,e,n,i){let r=0;for(let o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}(t,e,n,i)>0)for(o=e;o<n;o+=i)a=Ic(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=Ic(o,t[o],t[o+1],a);return a&&Ec(a,a.next)&&(Dc(a),a=a.next),a}function dc(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Ec(i,i.next)&&0!==Ac(i.prev,i,i.next))i=i.next;else{if(Dc(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function pc(t,e,n,i,r,o,a){if(!t)return;!a&&o&&function(t,e,n,i){let r=t;do{null===r.z&&(r.z=_c(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,o,a,s,l,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<c&&(s++,i=i.nextZ,i);e++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,o);let s,l,c=t;for(;t.prev!==t.next;)if(s=t.prev,l=t.next,o?gc(t,i,r,o):mc(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),Dc(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?pc(t=vc(dc(t),e,n),e,n,i,r,o,2):2===a&&yc(t,e,n,i,r,o):pc(dc(t),e,n,i,r,o,1);break}}function mc(t){const e=t.prev,n=t,i=t.next;if(Ac(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Sc(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Ac(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function gc(t,e,n,i){const r=t.prev,o=t,a=t.next;if(Ac(r,o,a)>=0)return!1;const s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=_c(s,l,e,n,i),f=_c(c,u,e,n,i);let d=t.prevZ,p=t.nextZ;for(;d&&d.z>=h&&p&&p.z<=f;){if(d!==t.prev&&d!==t.next&&Sc(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ac(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==t.prev&&p!==t.next&&Sc(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ac(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Sc(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ac(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&Sc(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ac(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function vc(t,e,n){let i=t;do{const r=i.prev,o=i.next.next;!Ec(r,o)&&qc(r,i,i.next,o)&&Rc(r,o)&&Rc(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),Dc(i),Dc(i.next),i=t=o),i=i.next}while(i!==t);return dc(i)}function yc(t,e,n,i,r,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Tc(a,t)){let s=Lc(a,t);return a=dc(a,a.next),s=dc(s,s.next),pc(a,e,n,i,r,o),void pc(s,e,n,i,r,o)}t=t.next}a=a.next}while(a!==t)}function xc(t,e){return t.x-e.x}function bc(t,e){if(e=function(t,e){let n=e;const i=t.x,r=t.y;let o,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>a){if(a=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===a)return o;const s=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{i>=n.x&&n.x>=l&&i!==n.x&&Sc(r<c?i:a,r,l,c,r<c?a:i,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(i-n.x),Rc(n,t)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&wc(o,n)))&&(o=n,h=u)),n=n.next}while(n!==s);return o}(t,e)){const n=Lc(e,t);dc(e,e.next),dc(n,n.next)}}function wc(t,e){return Ac(t.prev,t,e.prev)<0&&Ac(e.next,t,t.next)<0}function _c(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Mc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Sc(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function Tc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&qc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Rc(t,e)&&Rc(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ac(t.prev,t,e.prev)||Ac(t,e.prev,e))||Ec(t,e)&&Ac(t.prev,t,t.next)>0&&Ac(e.prev,e,e.next)>0)}function Ac(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ec(t,e){return t.x===e.x&&t.y===e.y}function qc(t,e,n,i){const r=Pc(Ac(t,e,n)),o=Pc(Ac(t,e,i)),a=Pc(Ac(n,i,t)),s=Pc(Ac(n,i,e));return r!==o&&a!==s||(!(0!==r||!Cc(t,n,e))||(!(0!==o||!Cc(t,i,e))||(!(0!==a||!Cc(n,t,i))||!(0!==s||!Cc(n,e,i)))))}function Cc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Pc(t){return t>0?1:t<0?-1:0}function Rc(t,e){return Ac(t.prev,t,t.next)<0?Ac(t,e,t.next)>=0&&Ac(t,t.prev,e)>=0:Ac(t,e,t.prev)<0||Ac(t,t.next,e)<0}function Lc(t,e){const n=new Oc(t.i,t.x,t.y),i=new Oc(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Ic(t,e,n,i){const r=new Oc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Dc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Oc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Nc={area:function(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},isClockWise:function(t){return Nc.area(t)<0},triangulateShape:function(t,e){const n=[],i=[],r=[];Fc(t),Bc(n,t);let o=t.length;e.forEach(Fc);for(let t=0;t<e.length;t++)i.push(o),o+=e[t].length,Bc(n,e[t]);const a=hc(n,i);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}};function Fc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Bc(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class zc extends mo{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Uc(t,e)),this.mergeVertices()}toJSON(){const t=super.toJSON();return jc(this.parameters.shapes,this.parameters.options,t)}}class Uc extends Vr{constructor(t,e){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){o(t[e])}function o(t){const o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,f=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const p=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:kc;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,x,b,w=!1;p&&(g=p.getSpacedPoints(s),w=!0,c=!1,v=p.computeFrenetFrames(s,!1),y=new Qn,x=new Qn,b=new Qn),c||(d=0,u=0,h=0,f=0);const _=t.extractPoints(a);let M=_.shape;const S=_.holes;if(!Nc.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];Nc.isClockWise(e)&&(S[t]=e.reverse())}}const T=Nc.triangulateShape(M,S),A=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function E(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const q=M.length,C=T.length;function P(t,e,n){let i,r,o;const a=t.x-e.x,s=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),f=Math.sqrt(l*l+c*c),d=e.x-s/h,p=e.y+a/h,m=((n.x-c/f-d)*c-(n.y+l/f-p)*l)/(a*c-s*l);i=d+a*m-t.x,r=p+s*m-t.y;const g=i*i+r*r;if(g<=2)return new Un(i,r);o=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(c)&&(t=!0),t?(i=-s,r=a,o=Math.sqrt(u)):(i=a,r=s,o=Math.sqrt(u/2))}return new Un(i/o,r/o)}const R=[];for(let t=0,e=A.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),R[t]=P(A[t],A[n],A[i]);const L=[];let I,D=R.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];I=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[t]=P(e[t],e[i],e[r]);L.push(I),D=D.concat(I)}for(let t=0;t<d;t++){const e=t/d,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+f;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],R[t],i);F(e.x,e.y,-n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=L[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],I[t],i);F(r.x,r.y,-n)}}}const O=h+f;for(let t=0;t<q;t++){const e=c?E(M[t],D[t],O):M[t];w?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(x).add(y),F(b.x,b.y,b.z)):F(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<q;e++){const n=c?E(M[e],D[e],O):M[e];w?(x.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(x).add(y),F(b.x,b.y,b.z)):F(n.x,n.y,l/s*t)}for(let t=d-1;t>=0;t--){const e=t/d,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+f;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],R[t],i);F(e.x,e.y,l+n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=L[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],I[t],i);w?F(r.x,r.y+g[s-1].y,g[s-1].x+n):F(r.x,r.y,l+n)}}}function N(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=s+2*d;t<n;t++){const n=q*t,o=q*(t+1);z(e+i+n,e+r+n,e+r+o,e+i+o)}}}function F(t,e,n){o.push(t),o.push(e),o.push(n)}function B(t,e,r){U(t),U(e),U(r);const o=i.length/3,a=m.generateTopUV(n,i,o-3,o-2,o-1);k(a[0]),k(a[1]),k(a[2])}function z(t,e,r,o){U(t),U(e),U(o),U(e),U(r),U(o);const a=i.length/3,s=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);k(s[0]),k(s[1]),k(s[3]),k(s[1]),k(s[2]),k(s[3])}function U(t){i.push(o[3*t+0]),i.push(o[3*t+1]),i.push(o[3*t+2])}function k(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=q*t;for(let t=0;t<C;t++){const n=T[t];B(n[2]+e,n[1]+e,n[0]+e)}t=s+2*d,e=q*t;for(let t=0;t<C;t++){const n=T[t];B(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<C;t++){const e=T[t];B(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=T[t];B(e[0]+q*s,e[1]+q*s,e[2]+q*s)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;N(A,e),e+=A.length;for(let t=0,n=S.length;t<n;t++){const n=S[t];N(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Lr(i,3)),this.setAttribute("uv",new Lr(r,2)),this.computeVertexNormals()}toJSON(){const t=Vr.prototype.toJSON.call(this);return jc(this.parameters.shapes,this.parameters.options,t)}}const kc={generateTopUV:function(t,e,n,i,r){const o=e[3*n],a=e[3*n+1],s=e[3*i],l=e[3*i+1],c=e[3*r],u=e[3*r+1];return[new Un(o,a),new Un(s,l),new Un(c,u)]},generateSideWallUV:function(t,e,n,i,r,o){const a=e[3*n],s=e[3*n+1],l=e[3*n+2],c=e[3*i],u=e[3*i+1],h=e[3*i+2],f=e[3*r],d=e[3*r+1],p=e[3*r+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(s-u)<.01?[new Un(a,1-l),new Un(c,1-h),new Un(f,1-p),new Un(m,1-v)]:[new Un(s,1-l),new Un(u,1-h),new Un(d,1-p),new Un(g,1-v)]}};function jc(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class Vc extends mo{constructor(t,e){super(),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Gc(t,e)),this.mergeVertices()}}class Gc extends Uc{constructor(t,e){const n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new mo;const i=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(i,e),this.type="TextBufferGeometry"}}class Hc extends mo{constructor(t,e,n,i,r,o,a){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Wc(t,e,n,i,r,o,a)),this.mergeVertices()}}class Wc extends Vr{constructor(t,e,n,i,r,o,a){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;const s=Math.min(o+a,Math.PI);let l=0;const c=[],u=new Qn,h=new Qn,f=[],d=[],p=[],m=[];for(let f=0;f<=n;f++){const g=[],v=f/n;let y=0;0==f&&0==o?y=.5/e:f==n&&s==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const s=n/e;u.x=-t*Math.cos(i+s*r)*Math.sin(o+v*a),u.y=t*Math.cos(o+v*a),u.z=t*Math.sin(i+s*r)*Math.sin(o+v*a),d.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(s+y,1-v),g.push(l++)}c.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=c[t][i+1],r=c[t][i],a=c[t+1][i],l=c[t+1][i+1];(0!==t||o>0)&&f.push(e,r,l),(t!==n-1||s<Math.PI)&&f.push(r,a,l)}this.setIndex(f),this.setAttribute("position",new Lr(d,3)),this.setAttribute("normal",new Lr(p,3)),this.setAttribute("uv",new Lr(m,2))}}class Xc extends mo{constructor(t,e,n,i,r,o){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Yc(t,e,n,i,r,o)),this.mergeVertices()}}class Yc extends Vr{constructor(t,e,n,i,r,o){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},t=t||.5,e=e||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const a=[],s=[],l=[],c=[];let u=t;const h=(e-t)/(i=void 0!==i?Math.max(1,i):1),f=new Qn,d=new Un;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*o;f.x=u*Math.cos(i),f.y=u*Math.sin(i),s.push(f.x,f.y,f.z),l.push(0,0,1),d.x=(f.x/e+1)/2,d.y=(f.y/e+1)/2,c.push(d.x,d.y)}u+=h}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,s=i+n+2,l=i+1;a.push(r,o,l),a.push(o,s,l)}}this.setIndex(a),this.setAttribute("position",new Lr(s,3)),this.setAttribute("normal",new Lr(l,3)),this.setAttribute("uv",new Lr(c,2))}}class Zc extends mo{constructor(t,e,n,i){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},this.fromBufferGeometry(new Qc(t,e,n,i)),this.mergeVertices()}}class Qc extends Vr{constructor(t,e,n,i){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e)||12,n=n||0,i=i||2*Math.PI,i=zn.clamp(i,0,2*Math.PI);const r=[],o=[],a=[],s=1/e,l=new Qn,c=new Un;for(let r=0;r<=e;r++){const u=n+r*s*i,h=Math.sin(u),f=Math.cos(u);for(let n=0;n<=t.length-1;n++)l.x=t[n].x*h,l.y=t[n].y,l.z=t[n].x*f,o.push(l.x,l.y,l.z),c.x=r/e,c.y=n/(t.length-1),a.push(c.x,c.y)}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,o=i,a=i+t.length,s=i+t.length+1,l=i+1;r.push(o,a,l),r.push(a,s,l)}if(this.setIndex(r),this.setAttribute("position",new Lr(o,3)),this.setAttribute("uv",new Lr(a,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new Qn,r=new Qn,o=new Qn,a=e*t.length*3;for(let e=0,s=0;e<t.length;e++,s+=3)i.x=n[s+0],i.y=n[s+1],i.z=n[s+2],r.x=n[a+s+0],r.y=n[a+s+1],r.z=n[a+s+2],o.addVectors(i,r).normalize(),n[s+0]=n[a+s+0]=o.x,n[s+1]=n[a+s+1]=o.y,n[s+2]=n[a+s+2]=o.z}}}class Jc extends mo{constructor(t,e){super(),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Kc(t,e)),this.mergeVertices()}toJSON(){const t=mo.prototype.toJSON.call(this);return $c(this.parameters.shapes,t)}}class Kc extends Vr{constructor(t,e){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const n=[],i=[],r=[],o=[];let a=0,s=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,s,e),a+=s,s=0;function l(t){const a=i.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===Nc.isClockWise(c)&&(c=c.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===Nc.isClockWise(e)&&(u[t]=e.reverse())}const h=Nc.triangulateShape(c,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=h.length;t<e;t++){const e=h[t],i=e[0]+a,r=e[1]+a,o=e[2]+a;n.push(i,r,o),s+=3}}this.setIndex(n),this.setAttribute("position",new Lr(i,3)),this.setAttribute("normal",new Lr(r,3)),this.setAttribute("uv",new Lr(o,2))}toJSON(){const t=Vr.prototype.toJSON.call(this);return $c(this.parameters.shapes,t)}}function $c(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}class tu extends Vr{constructor(t,e){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;const n=[],i=Math.cos(zn.DEG2RAD*e),r=[0,0],o={};let a,s,l;const c=["a","b","c"];let u;t.isBufferGeometry?(u=new mo,u.fromBufferGeometry(t)):u=t.clone(),u.mergeVertices(),u.computeFaceNormals();const h=u.vertices,f=u.faces;for(let t=0,e=f.length;t<e;t++){const e=f[t];for(let n=0;n<3;n++)a=e[c[n]],s=e[c[(n+1)%3]],r[0]=Math.min(a,s),r[1]=Math.max(a,s),l=r[0]+","+r[1],void 0===o[l]?o[l]={index1:r[0],index2:r[1],face1:t,face2:void 0}:o[l].face2=t}for(l in o){const t=o[l];if(void 0===t.face2||f[t.face1].normal.dot(f[t.face2].normal)<=i){let e=h[t.index1];n.push(e.x,e.y,e.z),e=h[t.index2],n.push(e.x,e.y,e.z)}}this.setAttribute("position",new Lr(n,3))}}class eu extends mo{constructor(t,e,n,i,r,o,a,s){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new nu(t,e,n,i,r,o,a,s)),this.mergeVertices()}}class nu extends Vr{constructor(t,e,n,i,r,o,a,s){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s};const l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;const c=[],u=[],h=[],f=[];let d=0;const p=[],m=n/2;let g=0;function v(n){const r=d,o=new Un,p=new Qn;let v=0;const y=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,m*x,0),h.push(0,x,0),f.push(.5,.5),d++;const b=d;for(let t=0;t<=i;t++){const e=t/i*s+a,n=Math.cos(e),r=Math.sin(e);p.x=y*r,p.y=m*x,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,x,0),o.x=.5*n+.5,o.y=.5*r*x+.5,f.push(o.x,o.y),d++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new Qn,v=new Qn;let y=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*s+a,l=Math.sin(r),p=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*p,u.push(v.x,v.y,v.z),o.set(l,x,p).normalize(),h.push(o.x,o.y,o.z),f.push(e,1-g),c.push(d++)}p.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=p[e][t],i=p[e+1][t],r=p[e+1][t+1],o=p[e][t+1];c.push(n,i,o),c.push(i,r,o),y+=6}l.addGroup(g,y,0),g+=y}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Lr(u,3)),this.setAttribute("normal",new Lr(h,3)),this.setAttribute("uv",new Lr(f,2))}}class iu extends eu{constructor(t,e,n,i,r,o,a){super(0,t,e,n,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}}class ru extends nu{constructor(t,e,n,i,r,o,a){super(0,t,e,n,i,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}}class ou extends mo{constructor(t,e,n,i){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new au(t,e,n,i)),this.mergeVertices()}}class au extends Vr{constructor(t,e,n,i){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;const r=[],o=[],a=[],s=[],l=new Qn,c=new Un;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let r=0,u=3;r<=e;r++,u+=3){const h=n+r/e*i;l.x=t*Math.cos(h),l.y=t*Math.sin(h),o.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(o[u]/t+1)/2,c.y=(o[u+1]/t+1)/2,s.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Lr(o,3)),this.setAttribute("normal",new Lr(a,3)),this.setAttribute("uv",new Lr(s,2))}}var su=Object.freeze({__proto__:null,WireframeGeometry:Wl,ParametricGeometry:Xl,ParametricBufferGeometry:Yl,TetrahedronGeometry:Jl,TetrahedronBufferGeometry:Kl,OctahedronGeometry:$l,OctahedronBufferGeometry:tc,IcosahedronGeometry:ec,IcosahedronBufferGeometry:nc,DodecahedronGeometry:ic,DodecahedronBufferGeometry:rc,PolyhedronGeometry:Zl,PolyhedronBufferGeometry:Ql,TubeGeometry:oc,TubeBufferGeometry:ac,TorusKnotGeometry:sc,TorusKnotBufferGeometry:lc,TorusGeometry:cc,TorusBufferGeometry:uc,TextGeometry:Vc,TextBufferGeometry:Gc,SphereGeometry:Hc,SphereBufferGeometry:Wc,RingGeometry:Xc,RingBufferGeometry:Yc,PlaneGeometry:Lo,PlaneBufferGeometry:Io,LatheGeometry:Zc,LatheBufferGeometry:Qc,ShapeGeometry:Jc,ShapeBufferGeometry:Kc,ExtrudeGeometry:zc,ExtrudeBufferGeometry:Uc,EdgesGeometry:tu,ConeGeometry:iu,ConeBufferGeometry:ru,CylinderGeometry:eu,CylinderBufferGeometry:nu,CircleGeometry:ou,CircleBufferGeometry:au,BoxGeometry:go,BoxBufferGeometry:vo});function lu(t){br.call(this),this.type="ShadowMaterial",this.color=new vr(0),this.transparent=!0,this.setValues(t)}function cu(t){wo.call(this,t),this.type="RawShaderMaterial"}function uu(t){br.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new vr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function hu(t){uu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Un(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function fu(t){br.call(this),this.type="MeshPhongMaterial",this.color=new vr(16777215),this.specular=new vr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function du(t){br.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new vr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function pu(t){br.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mu(t){br.call(this),this.type="MeshLambertMaterial",this.color=new vr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function gu(t){br.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new vr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Un(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function vu(t){Sl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}lu.prototype=Object.create(br.prototype),lu.prototype.constructor=lu,lu.prototype.isShadowMaterial=!0,lu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this},cu.prototype=Object.create(wo.prototype),cu.prototype.constructor=cu,cu.prototype.isRawShaderMaterial=!0,uu.prototype=Object.create(br.prototype),uu.prototype.constructor=uu,uu.prototype.isMeshStandardMaterial=!0,uu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},hu.prototype=Object.create(uu.prototype),hu.prototype.constructor=hu,hu.prototype.isMeshPhysicalMaterial=!0,hu.prototype.copy=function(t){return uu.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new vr).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},fu.prototype=Object.create(br.prototype),fu.prototype.constructor=fu,fu.prototype.isMeshPhongMaterial=!0,fu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},du.prototype=Object.create(br.prototype),du.prototype.constructor=du,du.prototype.isMeshToonMaterial=!0,du.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},pu.prototype=Object.create(br.prototype),pu.prototype.constructor=pu,pu.prototype.isMeshNormalMaterial=!0,pu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},mu.prototype=Object.create(br.prototype),mu.prototype.constructor=mu,mu.prototype.isMeshLambertMaterial=!0,mu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},gu.prototype=Object.create(br.prototype),gu.prototype.constructor=gu,gu.prototype.isMeshMatcapMaterial=!0,gu.prototype.copy=function(t){return br.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},vu.prototype=Object.create(Sl.prototype),vu.prototype.constructor=vu,vu.prototype.isLineDashedMaterial=!0,vu.prototype.copy=function(t){return Sl.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var yu=Object.freeze({__proto__:null,ShadowMaterial:lu,SpriteMaterial:Zs,RawShaderMaterial:cu,ShaderMaterial:wo,PointsMaterial:Ol,MeshPhysicalMaterial:hu,MeshStandardMaterial:uu,MeshPhongMaterial:fu,MeshToonMaterial:du,MeshNormalMaterial:pu,MeshLambertMaterial:mu,MeshDepthMaterial:Es,MeshDistanceMaterial:qs,MeshBasicMaterial:wr,MeshMatcapMaterial:gu,LineDashedMaterial:vu,LineBasicMaterial:Sl,Material:br});const xu={arraySlice:function(t,e,n){return xu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let o=0,a=0;a!==i;++o){const i=n[o]*e;for(let n=0;n!==e;++n)r[a++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,o=t[0];for(;void 0!==o&&void 0===o[i];)o=t[r++];if(void 0===o)return;let a=o[i];if(void 0!==a)if(Array.isArray(a))do{a=o[i],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[i],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[r++]}while(void 0!==o);else do{a=o[i],void 0!==a&&(e.push(o.time),n.push(a)),o=t[r++]}while(void 0!==o)},subclip:function(t,e,n,i,r){r=r||30;const o=t.clone();o.name=e;const a=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],s=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*r;if(!(o<n||o>=i)){l.push(e.times[t]);for(let n=0;n<s;++n)c.push(e.values[t*s+n])}}0!==l.length&&(e.times=xu.convertArray(l,e.times.constructor),e.values=xu.convertArray(c,e.values.constructor),a.push(e))}o.tracks=a;let s=1/0;for(let t=0;t<o.tracks.length;++t)s>o.tracks[t].times[0]&&(s=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===i||i<=0)&&(i=30);const r=t.tracks.length,o=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===a)continue;let s=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=i.times.length-1;let f;if(o<=i.times[0]){const t=s,e=l-s;f=xu.arraySlice(i.values,t,e)}else if(o>=i.times[h]){const t=h*l+s,e=t+l-s;f=xu.arraySlice(i.values,t,e)}else{const t=i.createInterpolant(),e=s,n=l-s;t.evaluate(o),f=xu.arraySlice(t.resultBuffer,e,n)}if("quaternion"===r){(new Zn).fromArray(f).normalize().conjugate().toArray(f)}const d=a.times.length;for(let t=0;t<d;++t){const e=t*u+c;if("quaternion"===r)Zn.multiplyQuaternionsFlat(a.values,e,f,0,a.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)a.values[e+n]-=f[n]}}}return t.blendMode=We,t}};function bu(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function wu(t,e,n,i){bu.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function _u(t,e,n,i){bu.call(this,t,e,n,i)}function Mu(t,e,n,i){bu.call(this,t,e,n,i)}function Su(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=xu.convertArray(e,this.TimeBufferType),this.values=xu.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Tu(t,e,n){Su.call(this,t,e,n)}function Au(t,e,n,i){Su.call(this,t,e,n,i)}function Eu(t,e,n,i){Su.call(this,t,e,n,i)}function qu(t,e,n,i){bu.call(this,t,e,n,i)}function Cu(t,e,n,i){Su.call(this,t,e,n,i)}function Pu(t,e,n,i){Su.call(this,t,e,n,i)}function Ru(t,e,n,i){Su.call(this,t,e,n,i)}function Lu(t,e,n,i){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==i?i:He,this.uuid=zn.generateUUID(),this.duration<0&&this.resetDuration()}function Iu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Eu;case"vector":case"vector2":case"vector3":case"vector4":return Ru;case"color":return Au;case"quaternion":return Cu;case"bool":case"boolean":return Tu;case"string":return Pu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];xu.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(bu.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let o;n:{i:if(!(t<i)){for(let o=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===o)break;if(r=i,i=e[++n],t<i)break e}o=e.length;break n}if(t>=r)break t;{const a=e[1];t<a&&(n=2,r=a);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===o)break;if(i=r,r=e[--n-1],t>=r)break e}o=n,n=0}}for(;n<o;){const i=n+o>>>1;t<e[i]?o=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(bu.prototype,{beforeStart_:bu.prototype.copySampleValue_,afterEnd_:bu.prototype.copySampleValue_}),wu.prototype=Object.assign(Object.create(bu.prototype),{constructor:wu,DefaultSettings_:{endingStart:je,endingEnd:je},intervalChanged_:function(t,e,n){const i=this.parameterPositions;let r=t-2,o=t+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case Ve:r=t,a=2*e-n;break;case Ge:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Ve:o=t,s=2*n-e;break;case Ge:o=1,s=n+i[1]-i[0];break;default:o=t-1,s=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=o*c},interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-e)/(i-e),p=d*d,m=p*d,g=-h*m+2*h*p-h*d,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*m+(1.5+f)*p+.5*d,x=f*m-f*p;for(let t=0;t!==a;++t)r[t]=g*o[c+t]+v*o[l+t]+y*o[s+t]+x*o[u+t];return r}}),_u.prototype=Object.assign(Object.create(bu.prototype),{constructor:_u,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(n-e)/(i-e),u=1-c;for(let t=0;t!==a;++t)r[t]=o[l+t]*u+o[s+t]*c;return r}}),Mu.prototype=Object.assign(Object.create(bu.prototype),{constructor:Mu,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Su,{toJSON:function(t){const e=t.constructor;let n;if(void 0!==e.toJSON)n=e.toJSON(t);else{n={name:t.name,times:xu.convertArray(t.times,Array),values:xu.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}}),Object.assign(Su.prototype,{constructor:Su,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ue,InterpolantFactoryMethodDiscrete:function(t){return new Mu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new _u(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new wu(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case ze:e=this.InterpolantFactoryMethodDiscrete;break;case Ue:e=this.InterpolantFactoryMethodLinear;break;case ke:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ze;case this.InterpolantFactoryMethodLinear:return Ue;case this.InterpolantFactoryMethodSmooth:return ke}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this},trim:function(t,e){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const t=this.getValueSize();this.times=xu.arraySlice(n,r,o),this.values=xu.arraySlice(this.values,r*t,o*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,o),t=!1;break}o=i}if(void 0!==i&&xu.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t},optimize:function(){const t=xu.arraySlice(this.times),e=xu.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===ke,r=t.length-1;let o=1;for(let a=1;a<r;++a){let r=!1;const s=t[a];if(s!==t[a+1]&&(1!==a||s!==s[0]))if(i)r=!0;else{const t=a*n,i=t-n,o=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[o+a]){r=!0;break}}}if(r){if(a!==o){t[o]=t[a];const i=a*n,r=o*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++o}}if(r>0){t[o]=t[r];for(let t=r*n,i=o*n,a=0;a!==n;++a)e[i+a]=e[t+a];++o}return o!==t.length?(this.times=xu.arraySlice(t,0,o),this.values=xu.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},clone:function(){const t=xu.arraySlice(this.times,0),e=xu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),Tu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Tu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ze,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Au.prototype=Object.assign(Object.create(Su.prototype),{constructor:Au,ValueTypeName:"color"}),Eu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Eu,ValueTypeName:"number"}),qu.prototype=Object.assign(Object.create(bu.prototype),{constructor:qu,interpolate_:function(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(i-e);let l=t*a;for(let t=l+a;l!==t;l+=4)Zn.slerpFlat(r,0,o,l-a,o,l,s);return r}}),Cu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Cu,ValueTypeName:"quaternion",DefaultInterpolation:Ue,InterpolantFactoryMethodLinear:function(t){return new qu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Pu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Pu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ze,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ru.prototype=Object.assign(Object.create(Su.prototype),{constructor:Ru,ValueTypeName:"vector"}),Object.assign(Lu,{parse:function(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(Iu(n[t]).scale(i));return new Lu(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(Su.toJSON(n[t]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){const r=e.length,o=[];for(let t=0;t<r;t++){let a=[],s=[];a.push((t+r-1)%r,t,(t+1)%r),s.push(0,1,0);const l=xu.getKeyframeOrder(a);a=xu.sortedArray(a,1,l),s=xu.sortedArray(s,1,l),i||0!==a[0]||(a.push(r),s.push(s[0])),o.push(new Eu(".morphTargetInfluences["+e[t].name+"]",a,s).scale(1/n))}return new Lu(t,-1,o)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(r);if(o&&o.length>1){const t=o[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const o=[];for(const t in i)o.push(Lu.CreateFromMorphTargetSequence(t,i[t],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const o=[],a=[];xu.flattenJSON(n,o,a,i),0!==o.length&&r.push(new t(e,o,a))}},i=[],r=t.name||"default",o=t.fps||30,a=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new Eu(".morphTargetInfluence["+n+"]",t,o))}s=t.length*(o||1)}else{const o=".bones["+e[t].name+"]";n(Ru,o+".position",r,"pos",i),n(Cu,o+".quaternion",r,"rot",i),n(Ru,o+".scale",r,"scl",i)}}return 0===i.length?null:new Lu(r,s,i,a)}}),Object.assign(Lu.prototype,{resetDuration:function(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Lu(this.name,this.duration,t,this.blendMode)}});const Du={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ou(t,e,n){const i=this;let r=!1,o=0,a=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===r&&void 0!==i.onStart&&i.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}const Nu=new Ou;function Fu(t){this.manager=void 0!==t?t:Nu,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Fu.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const Bu={};function zu(t){Fu.call(this,t)}function Uu(t){Fu.call(this,t)}function ku(t){Fu.call(this,t)}function ju(t){Fu.call(this,t)}function Vu(t){Fu.call(this,t)}function Gu(t){Fu.call(this,t)}function Hu(t){Fu.call(this,t)}function Wu(){this.type="Curve",this.arcLengthDivisions=200}function Xu(t,e,n,i,r,o,a,s){Wu.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Yu(t,e,n,i,r,o){Xu.call(this,t,e,n,n,i,r,o),this.type="ArcCurve"}function Zu(){let t=0,e=0,n=0,i=0;function r(r,o,a,s){t=r,e=a,n=-3*r+3*o-2*a-s,i=2*r-2*o+a+s}return{initCatmullRom:function(t,e,n,i,o){r(e,n,o*(n-t),o*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,o,a,s){let l=(e-t)/o-(n-t)/(o+a)+(n-e)/a,c=(n-e)/a-(i-e)/(a+s)+(i-n)/s;l*=a,c*=a,r(e,n,l,c)},calc:function(r){const o=r*r;return t+e*r+n*o+i*(o*r)}}}zu.prototype=Object.assign(Object.create(Fu.prototype),{constructor:zu,load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Du.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;if(void 0!==Bu[t])return void Bu[t].push({onLoad:e,onProgress:n,onError:i});const a=t.match(/^data:(.*?)(;base64)?,(.*)$/);let s;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let i;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const t=new Uint8Array(s.length);for(let e=0;e<s.length;e++)t[e]=s.charCodeAt(e);i="blob"===o?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;i=e.parseFromString(s,n);break;case"json":i=JSON.parse(s);break;default:i=s}setTimeout((function(){e&&e(i),r.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}),0)}}else{Bu[t]=[],Bu[t].push({onLoad:e,onProgress:n,onError:i}),s=new XMLHttpRequest,s.open("GET",t,!0),s.addEventListener("load",(function(e){const n=this.response,i=Bu[t];if(delete Bu[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Du.add(t,n);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(n)}r.manager.itemEnd(t)}else{for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}}),!1),s.addEventListener("progress",(function(e){const n=Bu[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onProgress&&i.onProgress(e)}}),!1),s.addEventListener("error",(function(e){const n=Bu[t];delete Bu[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),s.addEventListener("abort",(function(e){const n=Bu[t];delete Bu[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.overrideMimeType&&s.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)s.setRequestHeader(t,this.requestHeader[t]);s.send(null)}return r.manager.itemStart(t),s},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Uu.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Uu,load:function(t,e,n,i){const r=this,o=new zu(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)},parse:function(t){const e=[];for(let n=0;n<t.length;n++){const i=Lu.parse(t[n]);e.push(i)}return e}}),ku.prototype=Object.assign(Object.create(Fu.prototype),{constructor:ku,load:function(t,e,n,i){const r=this,o=[],a=new Vl;a.image=o;const s=new zu(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader);let l=0;function c(c){s.load(t[c],(function(t){const n=r.parse(t,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=xt),a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,i)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else s.load(t,(function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=xt),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,i);return a}}),ju.prototype=Object.assign(Object.create(Fu.prototype),{constructor:ju,load:function(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Du.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Du.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}),Vu.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Vu,load:function(t,e,n,i){const r=new Jo,o=new ju(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(t[n],(function(t){r.images[n]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let e=0;e<t.length;++e)s(e);return r}}),Gu.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Gu,load:function(t,e,n,i){const r=this,o=new Ao,a=new zu(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.load(t,(function(t){const n=r.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:ft,o.wrapT=void 0!==n.wrapT?n.wrapT:ft,o.magFilter=void 0!==n.magFilter?n.magFilter:xt,o.minFilter=void 0!==n.minFilter?n.minFilter:xt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=_t),1===n.mipmapCount&&(o.minFilter=xt),o.needsUpdate=!0,e&&e(o,n))}),n,i),o}}),Hu.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Hu,load:function(t,e,n,i){const r=new Hn,o=new ju(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){r.image=n;const i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=i?Ft:Bt,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}),Object.assign(Wu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let i=0;const r=n.length;let o;o=e||t*n[r-1];let a,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),a=n[i]-o,a<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)},getTangent:function(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),o=this.getPoint(i),a=e||(r.isVector2?new Un:new Qn);return a.copy(o).sub(r).normalize(),a},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Qn,i=[],r=[],o=[],a=new Qn,s=new Si;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new Qn),i[e].normalize()}r[0]=new Qn,o[0]=new Qn;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),o[e]=o[e-1].clone(),a.crossVectors(i[e-1],i[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(zn.clamp(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(s.makeRotationAxis(a,t))}o[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(zn.clamp(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],e*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Xu.prototype=Object.create(Wu.prototype),Xu.prototype.constructor=Xu,Xu.prototype.isEllipseCurve=!0,Xu.prototype.getPoint=function(t,e){const n=e||new Un,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=s-this.aX,i=l-this.aY;s=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(s,l)},Xu.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Xu.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Xu.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Yu.prototype=Object.create(Xu.prototype),Yu.prototype.constructor=Yu,Yu.prototype.isArcCurve=!0;const Qu=new Qn,Ju=new Zu,Ku=new Zu,$u=new Zu;function th(t,e,n,i){Wu.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=void 0!==i?i:.5}function eh(t,e,n,i,r){const o=.5*(i-e),a=.5*(r-n),s=t*t;return(2*n-2*i+o+a)*(t*s)+(-3*n+3*i-2*o-a)*s+o*t+n}function nh(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function ih(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}function rh(t,e,n,i){Wu.call(this),this.type="CubicBezierCurve",this.v0=t||new Un,this.v1=e||new Un,this.v2=n||new Un,this.v3=i||new Un}function oh(t,e,n,i){Wu.call(this),this.type="CubicBezierCurve3",this.v0=t||new Qn,this.v1=e||new Qn,this.v2=n||new Qn,this.v3=i||new Qn}function ah(t,e){Wu.call(this),this.type="LineCurve",this.v1=t||new Un,this.v2=e||new Un}function sh(t,e){Wu.call(this),this.type="LineCurve3",this.v1=t||new Qn,this.v2=e||new Qn}function lh(t,e,n){Wu.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Un,this.v1=e||new Un,this.v2=n||new Un}function ch(t,e,n){Wu.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Qn,this.v1=e||new Qn,this.v2=n||new Qn}function uh(t){Wu.call(this),this.type="SplineCurve",this.points=t||[]}th.prototype=Object.create(Wu.prototype),th.prototype.constructor=th,th.prototype.isCatmullRomCurve3=!0,th.prototype.getPoint=function(t,e){const n=e||new Qn,i=this.points,r=i.length,o=(r-(this.closed?0:1))*t;let a,s,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(Qu.subVectors(i[0],i[1]).add(i[0]),a=Qu);const u=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?s=i[(l+2)%r]:(Qu.subVectors(i[r-1],i[r-2]).add(i[r-1]),s=Qu),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(s),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Ju.initNonuniformCatmullRom(a.x,u.x,h.x,s.x,e,n,i),Ku.initNonuniformCatmullRom(a.y,u.y,h.y,s.y,e,n,i),$u.initNonuniformCatmullRom(a.z,u.z,h.z,s.z,e,n,i)}else"catmullrom"===this.curveType&&(Ju.initCatmullRom(a.x,u.x,h.x,s.x,this.tension),Ku.initCatmullRom(a.y,u.y,h.y,s.y,this.tension),$u.initCatmullRom(a.z,u.z,h.z,s.z,this.tension));return n.set(Ju.calc(c),Ku.calc(c),$u.calc(c)),n},th.prototype.copy=function(t){Wu.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},th.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},th.prototype.fromJSON=function(t){Wu.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Qn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},rh.prototype=Object.create(Wu.prototype),rh.prototype.constructor=rh,rh.prototype.isCubicBezierCurve=!0,rh.prototype.getPoint=function(t,e){const n=e||new Un,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(ih(t,i.x,r.x,o.x,a.x),ih(t,i.y,r.y,o.y,a.y)),n},rh.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},rh.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},rh.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},oh.prototype=Object.create(Wu.prototype),oh.prototype.constructor=oh,oh.prototype.isCubicBezierCurve3=!0,oh.prototype.getPoint=function(t,e){const n=e||new Qn,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(ih(t,i.x,r.x,o.x,a.x),ih(t,i.y,r.y,o.y,a.y),ih(t,i.z,r.z,o.z,a.z)),n},oh.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},oh.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},oh.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},ah.prototype=Object.create(Wu.prototype),ah.prototype.constructor=ah,ah.prototype.isLineCurve=!0,ah.prototype.getPoint=function(t,e){const n=e||new Un;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},ah.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ah.prototype.getTangent=function(t,e){const n=e||new Un;return n.copy(this.v2).sub(this.v1).normalize(),n},ah.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ah.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ah.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},sh.prototype=Object.create(Wu.prototype),sh.prototype.constructor=sh,sh.prototype.isLineCurve3=!0,sh.prototype.getPoint=function(t,e){const n=e||new Qn;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},sh.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},sh.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},sh.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},sh.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},lh.prototype=Object.create(Wu.prototype),lh.prototype.constructor=lh,lh.prototype.isQuadraticBezierCurve=!0,lh.prototype.getPoint=function(t,e){const n=e||new Un,i=this.v0,r=this.v1,o=this.v2;return n.set(nh(t,i.x,r.x,o.x),nh(t,i.y,r.y,o.y)),n},lh.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},lh.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},lh.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ch.prototype=Object.create(Wu.prototype),ch.prototype.constructor=ch,ch.prototype.isQuadraticBezierCurve3=!0,ch.prototype.getPoint=function(t,e){const n=e||new Qn,i=this.v0,r=this.v1,o=this.v2;return n.set(nh(t,i.x,r.x,o.x),nh(t,i.y,r.y,o.y),nh(t,i.z,r.z,o.z)),n},ch.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ch.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ch.prototype.fromJSON=function(t){return Wu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},uh.prototype=Object.create(Wu.prototype),uh.prototype.constructor=uh,uh.prototype.isSplineCurve=!0,uh.prototype.getPoint=function(t,e){const n=e||new Un,i=this.points,r=(i.length-1)*t,o=Math.floor(r),a=r-o,s=i[0===o?o:o-1],l=i[o],c=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set(eh(a,s.x,l.x,c.x,u.x),eh(a,s.y,l.y,c.y,u.y)),n},uh.prototype.copy=function(t){Wu.prototype.copy.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this},uh.prototype.toJSON=function(){const t=Wu.prototype.toJSON.call(this);t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t},uh.prototype.fromJSON=function(t){Wu.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Un).fromArray(n))}return this};var hh=Object.freeze({__proto__:null,ArcCurve:Yu,CatmullRomCurve3:th,CubicBezierCurve:rh,CubicBezierCurve3:oh,EllipseCurve:Xu,LineCurve:ah,LineCurve3:sh,QuadraticBezierCurve:lh,QuadraticBezierCurve3:ch,SplineCurve:uh});function fh(){Wu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function dh(t){fh.call(this),this.type="Path",this.currentPoint=new Un,t&&this.setFromPoints(t)}function ph(t){dh.call(this,t),this.uuid=zn.generateUUID(),this.type="Shape",this.holes=[]}function mh(t,e){Zi.call(this),this.type="Light",this.color=new vr(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function gh(t,e,n){mh.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.groundColor=new vr(e)}function vh(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Un(512,512),this.map=null,this.mapPass=null,this.matrix=new Si,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Co,this._frameExtents=new Un(1,1),this._viewportCount=1,this._viewports=[new Wn(0,0,1,1)]}function yh(){vh.call(this,new Mo(50,1,.5,500))}function xh(t,e,n,i,r,o){mh.call(this,t,e),this.type="SpotLight",this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.target=new Zi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new yh}function bh(){vh.call(this,new Mo(90,1,.5,500)),this._frameExtents=new Un(4,2),this._viewportCount=6,this._viewports=[new Wn(2,1,1,1),new Wn(0,1,1,1),new Wn(3,1,1,1),new Wn(1,1,1,1),new Wn(3,0,1,1),new Wn(1,0,1,1)],this._cubeDirections=[new Qn(1,0,0),new Qn(-1,0,0),new Qn(0,0,1),new Qn(0,0,-1),new Qn(0,1,0),new Qn(0,-1,0)],this._cubeUps=[new Qn(0,1,0),new Qn(0,1,0),new Qn(0,1,0),new Qn(0,1,0),new Qn(0,0,1),new Qn(0,0,-1)]}function wh(t,e,n,i){mh.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new bh}function _h(t,e,n,i,r,o){_o.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Mh(){vh.call(this,new _h(-5,5,5,-5,.5,500))}function Sh(t,e){mh.call(this,t,e),this.type="DirectionalLight",this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.target=new Zi,this.shadow=new Mh}function Th(t,e){mh.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Ah(t,e,n,i){mh.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}fh.prototype=Object.assign(Object.create(Wu.prototype),{constructor:fh,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ah(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){const t=n[i]-e,r=this.curves[i],o=r.getLength(),a=0===o?0:1-t/o;return r.getPointAt(a)}i++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a);for(let t=0;t<s.length;t++){const i=s[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Wu.prototype.copy.call(this,t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Wu.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Wu.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new hh[n.type]).fromJSON(n))}return this}}),dh.prototype=Object.assign(Object.create(fh.prototype),{constructor:dh,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new ah(this.currentPoint.clone(),new Un(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,i){const r=new lh(this.currentPoint.clone(),new Un(t,e),new Un(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(t,e,n,i,r,o){const a=new rh(this.currentPoint.clone(),new Un(t,e),new Un(n,i),new Un(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this},splineThru:function(t){const e=new uh([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,i,r,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,i,r,o),this},absarc:function(t,e,n,i,r,o){return this.absellipse(t,e,n,n,i,r,o),this},ellipse:function(t,e,n,i,r,o,a,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,o,a,s),this},absellipse:function(t,e,n,i,r,o,a,s){const l=new Xu(t,e,n,i,r,o,a,s);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return fh.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=fh.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return fh.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),ph.prototype=Object.assign(Object.create(dh.prototype),{constructor:ph,getPointsHoles:function(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){dh.prototype.copy.call(this,t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const t=dh.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){dh.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new dh).fromJSON(n))}return this}}),mh.prototype=Object.assign(Object.create(Zi.prototype),{constructor:mh,isLight:!0,copy:function(t){return Zi.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=Zi.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),gh.prototype=Object.assign(Object.create(mh.prototype),{constructor:gh,isHemisphereLight:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(vh.prototype,{_projScreenMatrix:new Si,_lightPositionWorld:new Qn,_lookTarget:new Qn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),yh.prototype=Object.assign(Object.create(vh.prototype),{constructor:yh,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*zn.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),vh.prototype.updateMatrices.call(this,t)}}),xh.prototype=Object.assign(Object.create(mh.prototype),{constructor:xh,isSpotLight:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),bh.prototype=Object.assign(Object.create(vh.prototype),{constructor:bh,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),wh.prototype=Object.assign(Object.create(mh.prototype),{constructor:wh,isPointLight:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),_h.prototype=Object.assign(Object.create(_o.prototype),{constructor:_h,isOrthographicCamera:!0,copy:function(t,e){return _o.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,o=n+t,a=i+e,s=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,o=r+t*this.view.width,a-=e*this.view.offsetY,s=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=Zi.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Mh.prototype=Object.assign(Object.create(vh.prototype),{constructor:Mh,isDirectionalLightShadow:!0,updateMatrices:function(t){vh.prototype.updateMatrices.call(this,t)}}),Sh.prototype=Object.assign(Object.create(mh.prototype),{constructor:Sh,isDirectionalLight:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Th.prototype=Object.assign(Object.create(mh.prototype),{constructor:Th,isAmbientLight:!0}),Ah.prototype=Object.assign(Object.create(mh.prototype),{constructor:Ah,isRectAreaLight:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=mh.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class Eh{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Qn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*i*1.092548),e.addScaledVector(o[5],i*r*1.092548),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],n*r*1.092548),e.addScaledVector(o[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*i),e.addScaledVector(o[2],1.023328*r),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*i),e.addScaledVector(o[5],.858086*i*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],.858086*n*r),e.addScaledVector(o[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e){void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}function qh(t,e){mh.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Eh}function Ch(t){Fu.call(this,t),this.textures={}}qh.prototype=Object.assign(Object.create(mh.prototype),{constructor:qh,isLightProbe:!0,copy:function(t){return mh.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=mh.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),Ch.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Ch,load:function(t,e,n,i){const r=this,o=new zu(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=new yu[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new vr).setHex(t.sheen)),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(i.uniforms[e]={},r.type){case"t":i.uniforms[e].value=n(r.value);break;case"c":i.uniforms[e].value=(new vr).setHex(r.value);break;case"v2":i.uniforms[e].value=(new Un).fromArray(r.value);break;case"v3":i.uniforms[e].value=(new Qn).fromArray(r.value);break;case"v4":i.uniforms[e].value=(new Wn).fromArray(r.value);break;case"m3":i.uniforms[e].value=(new kn).fromArray(r.value);break;case"m4":i.uniforms[e].value=(new Si).fromArray(r.value);break;default:i.uniforms[e].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Un).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Un).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),i},setTextures:function(t){return this.textures=t,this}});const Ph={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Rh(){Vr.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Lh(t,e,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Sr.call(this,t,e,n),this.meshPerAttribute=i||1}function Ih(t){Fu.call(this,t)}Rh.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Rh,isInstancedBufferGeometry:!0,copy:function(t){return Vr.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=Vr.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Lh.prototype=Object.assign(Object.create(Sr.prototype),{constructor:Lh,isInstancedBufferAttribute:!0,copy:function(t){return Sr.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=Sr.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Ih.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Ih,load:function(t,e,n,i){const r=this,o=new zu(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)},parse:function(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],o=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),a=new Ws(new Dh[r.type](o),r.stride);return a.uuid=r.uuid,e[i]=a,a}const r=t.isInstancedBufferGeometry?new Rh:new Vr,o=t.data.index;if(void 0!==o){const t=new Dh[o.type](o.array);r.setIndex(new Sr(t,1))}const a=t.data.attributes;for(const e in a){const n=a[e];let o;if(n.isInterleavedBufferAttribute){o=new Ys(i(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=new Dh[n.type](n.array);o=new(n.isInstancedBufferAttribute?Lh:Sr)(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),r.setAttribute(e,o)}const s=t.data.morphAttributes;if(s)for(const e in s){const n=s[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let a;if(r.isInterleavedBufferAttribute){a=new Ys(i(t.data,r.data),r.itemSize,r.offset,r.normalized)}else{a=new Sr(new Dh[r.type](r.array),r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),o.push(a)}r.morphAttributes[e]=o}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new Qn;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new mi(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}});const Dh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Oh(t){Fu.call(this,t)}Oh.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Oh,load:function(t,e,n,i){const r=this,o=""===this.path?Ph.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const a=new zu(r.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.load(t,(function(n){let o=null;try{o=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,i)},parse:function(t,e){const n=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),o=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,i,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new ph).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){const n={};let i;if(void 0!==t){const r=new Ih;for(let o=0,a=t.length;o<a;o++){let a;const s=t[o];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new su[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new su[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new su[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new su[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new su[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new su[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new su[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new su[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new su[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new su[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new su[s.type]((new hh[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new su[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new su[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let t=0,n=s.shapes.length;t<n;t++){const n=e[s.shapes[t]];i.push(n)}a=new su[s.type](i,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let t=0,n=s.shapes.length;t<n;t++){const n=e[s.shapes[t]];i.push(n)}const t=s.options.extrudePath;void 0!==t&&(s.options.extrudePath=(new hh[t.type]).fromJSON(t)),a=new su[s.type](i,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}}return n},parseMaterials:function(t,e){const n={},i={};if(void 0!==t){const r=new Ch;r.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];if("MultiMaterial"===o.type){const t=[];for(let e=0;e<o.materials.length;e++){const i=o.materials[e];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),t.push(n[i.uuid])}i[o.uuid]=t}else void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i},parseAnimations:function(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n],r=Lu.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),e.push(r)}return e},parseImages:function(t,e){const n=this,i={};let r;function o(t){return n.manager.itemStart(t),r.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){const a=new Ou(e);r=new ju(a),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],a=r.url;if(Array.isArray(a)){i[r.uuid]=[];for(let t=0,e=a.length;t<e;t++){const e=a[t],s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;i[r.uuid].push(o(s))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r.url)?r.url:n.resourcePath+r.url;i[r.uuid]=o(t)}}}return i},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,o=t.length;r<o;r++){const o=t[r];let a;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),a=Array.isArray(e[o.image])?new Jo(e[o.image]):new Hn(e[o.image]),a.needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=n(o.mapping,Nh)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=n(o.wrap[0],Fh),a.wrapT=n(o.wrap[1],Fh)),void 0!==o.format&&(a.format=o.format),void 0!==o.type&&(a.type=o.type),void 0!==o.encoding&&(a.encoding=o.encoding),void 0!==o.minFilter&&(a.minFilter=n(o.minFilter,Bh)),void 0!==o.magFilter&&(a.magFilter=n(o.magFilter,Bh)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(a.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(a.unpackAlignment=o.unpackAlignment),i[o.uuid]=a}return i},parseObject:function(t,e,n){let i,r,o;function a(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function s(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new Hs,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new vr(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new Gs(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new Vs(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new Mo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new _h(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new Th(t.color,t.intensity);break;case"DirectionalLight":i=new Sh(t.color,t.intensity);break;case"PointLight":i=new wh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new Ah(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new xh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new gh(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new qh).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":r=a(t.geometry),o=s(t.material),i=new so(r,o);break;case"InstancedMesh":r=a(t.geometry),o=s(t.material);const e=t.count,n=t.instanceMatrix;i=new Ml(r,o,e),i.instanceMatrix=new Sr(new Float32Array(n.array),16);break;case"LOD":i=new dl;break;case"Line":i=new Pl(a(t.geometry),s(t.material),t.mode);break;case"LineLoop":i=new Dl(a(t.geometry),s(t.material));break;case"LineSegments":i=new Il(a(t.geometry),s(t.material));break;case"PointCloud":case"Points":i=new Ul(a(t.geometry),s(t.material));break;case"Sprite":i=new cl(s(t.material));break;case"Group":i=new Is;break;default:i=new Zi}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const r=t.children;for(let t=0;t<r.length;t++)i.add(this.parseObject(r[t],e,n))}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}});const Nh={UVMapping:rt,CubeReflectionMapping:ot,CubeRefractionMapping:at,EquirectangularReflectionMapping:st,EquirectangularRefractionMapping:lt,CubeUVReflectionMapping:ct,CubeUVRefractionMapping:ut},Fh={RepeatWrapping:ht,ClampToEdgeWrapping:ft,MirroredRepeatWrapping:dt},Bh={NearestFilter:pt,NearestMipmapNearestFilter:mt,NearestMipmapLinearFilter:vt,LinearFilter:xt,LinearMipmapNearestFilter:bt,LinearMipmapLinearFilter:_t};function zh(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Fu.call(this,t),this.options={premultiplyAlpha:"none"}}function Uh(){this.type="ShapePath",this.color=new vr,this.subPaths=[],this.currentPath=null}function kh(t){this.type="Font",this.data=t}function jh(t,e,n,i,r){const o=r.glyphs[t]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const a=new Uh;let s,l,c,u,h,f,d,p;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=t.length;r<o;){switch(t[r++]){case"m":s=t[r++]*e+n,l=t[r++]*e+i,a.moveTo(s,l);break;case"l":s=t[r++]*e+n,l=t[r++]*e+i,a.lineTo(s,l);break;case"q":c=t[r++]*e+n,u=t[r++]*e+i,h=t[r++]*e+n,f=t[r++]*e+i,a.quadraticCurveTo(h,f,c,u);break;case"b":c=t[r++]*e+n,u=t[r++]*e+i,h=t[r++]*e+n,f=t[r++]*e+i,d=t[r++]*e+n,p=t[r++]*e+i,a.bezierCurveTo(h,f,d,p,c,u)}}}return{offsetX:o.ha*e,path:a}}function Vh(t){Fu.call(this,t)}let Gh;zh.prototype=Object.assign(Object.create(Fu.prototype),{constructor:zh,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Du.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,r.options)})).then((function(n){Du.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}),Object.assign(Uh.prototype,{moveTo:function(t,e){return this.currentPath=new dh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new ph;r.curves=i.curves,e.push(r)}return e}function i(t,e){const n=e.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=e[r],a=e[o],s=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[o],s=-s,a=e[r],l=-l),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-s*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return i}const r=Nc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let a,s,l;const c=[];if(1===o.length)return s=o[0],l=new ph,l.curves=s.curves,c.push(l),c;let u=!r(o[0].getPoints());u=t?!u:u;const h=[],f=[];let d,p,m=[],g=0;f[g]=void 0,m[g]=[];for(let e=0,n=o.length;e<n;e++)s=o[e],d=s.getPoints(),a=r(d),a=t?!a:a,a?(!u&&f[g]&&g++,f[g]={s:new ph,p:d},f[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:d[0]});if(!f[0])return n(o);if(f.length>1){let t=!1;const e=[];for(let t=0,e=f.length;t<e;t++)h[t]=[];for(let n=0,r=f.length;n<r;n++){const r=m[n];for(let o=0;o<r.length;o++){const a=r[o];let s=!0;for(let r=0;r<f.length;r++)i(a.p,f[r].p)&&(n!==r&&e.push({froms:n,tos:r,hole:o}),s?(s=!1,h[r].push(a)):t=!0);s&&h[n].push(a)}}e.length>0&&(t||(m=h))}for(let t=0,e=f.length;t<e;t++){l=f[t].s,c.push(l),p=m[t];for(let t=0,e=p.length;t<e;t++)l.holes.push(p[t].h)}return c}}),Object.assign(kh.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);const n=[],i=function(t,e,n){const i=Array.from?Array.from(t):String(t).split(""),r=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[];let s=0,l=0;for(let t=0;t<i.length;t++){const e=i[t];if("\n"===e)s=0,l-=o;else{const t=jh(e,r,s,l,n);s+=t.offsetX,a.push(t.path)}}return a}(t,e,this.data);for(let t=0,e=i.length;t<e;t++)Array.prototype.push.apply(n,i[t].toShapes());return n}}),Vh.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Vh,load:function(t,e,n,i){const r=this,o=new zu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const i=r.parse(n);e&&e(i)}),n,i)},parse:function(t){return new kh(t)}});const Hh={getContext:function(){return void 0===Gh&&(Gh=new(window.AudioContext||window.webkitAudioContext)),Gh},setContext:function(t){Gh=t}};function Wh(t){Fu.call(this,t)}function Xh(t,e,n){qh.call(this,void 0,n);const i=(new vr).set(t),r=(new vr).set(e),o=new Qn(i.r,i.g,i.b),a=new Qn(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function Yh(t,e){qh.call(this,void 0,e);const n=(new vr).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Wh.prototype=Object.assign(Object.create(Fu.prototype),{constructor:Wh,load:function(t,e,n,i){const r=this,o=new zu(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(t,(function(n){try{const t=n.slice(0);Hh.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}}),Xh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Xh,isHemisphereLightProbe:!0,copy:function(t){return qh.prototype.copy.call(this,t),this},toJSON:function(t){return qh.prototype.toJSON.call(this,t)}}),Yh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Yh,isAmbientLightProbe:!0,copy:function(t){return qh.prototype.copy.call(this,t),this},toJSON:function(t){return qh.prototype.toJSON.call(this,t)}});const Zh=new Si,Qh=new Si;function Jh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Mo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Mo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(Jh.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),i=e.eyeSep/2,r=i*e.near/e.focus,o=e.near*Math.tan(zn.DEG2RAD*e.fov*.5)/e.zoom;let a,s;Qh.elements[12]=-i,Zh.elements[12]=i,a=-o*e.aspect+r,s=o*e.aspect+r,n.elements[0]=2*e.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(n),a=-o*e.aspect-r,s=o*e.aspect-r,n.elements[0]=2*e.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Qh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Zh)}});class Kh{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const $h=new Qn,tf=new Zn,ef=new Qn,nf=new Qn;class rf extends Zi{constructor(){super(),this.type="AudioListener",this.context=Hh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Kh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($h,tf,ef),nf.set(0,0,-1).applyQuaternion(tf),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime($h.x,t),e.positionY.linearRampToValueAtTime($h.y,t),e.positionZ.linearRampToValueAtTime($h.z,t),e.forwardX.linearRampToValueAtTime(nf.x,t),e.forwardY.linearRampToValueAtTime(nf.y,t),e.forwardZ.linearRampToValueAtTime(nf.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition($h.x,$h.y,$h.z),e.setOrientation(nf.x,nf.y,nf.z,n.x,n.y,n.z)}}class of extends Zi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const af=new Qn,sf=new Zn,lf=new Qn,cf=new Qn;class uf extends of{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(af,sf,lf),cf.set(0,0,1).applyQuaternion(sf);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(af.x,t),e.positionY.linearRampToValueAtTime(af.y,t),e.positionZ.linearRampToValueAtTime(af.z,t),e.orientationX.linearRampToValueAtTime(cf.x,t),e.orientationY.linearRampToValueAtTime(cf.y,t),e.orientationZ.linearRampToValueAtTime(cf.z,t)}else e.setPosition(af.x,af.y,af.z),e.setOrientation(cf.x,cf.y,cf.z)}}class hf{constructor(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}function ff(t,e,n){let i,r,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(ff.prototype,{accumulate:function(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==i;++t)n[r+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=o},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){a.setValue(n,i);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]},_slerp:function(t,e,n,i){Zn.slerpFlat(t,e,t,e,t,n,i)},_slerpAdditive:function(t,e,n,i,r){const o=this._workIndex*r;Zn.multiplyQuaternionsFlat(t,o,t,e,t,n),Zn.slerpFlat(t,e,t,e,t,o,i)},_lerp:function(t,e,n,i,r){const o=1-i;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*o+t[n+a]*i}},_lerpAdditive:function(t,e,n,i,r){for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]+t[n+o]*i}}});const df=new RegExp("[\\[\\]\\.:\\/]","g"),pf="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",mf=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),gf=/(WCOD+)?/.source.replace("WCOD",pf),vf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),yf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),xf=new RegExp("^"+mf+gf+vf+yf+"$"),bf=["material","materials","bones"];function wf(t,e,n){const i=n||_f.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function _f(t,e,n){this.path=e,this.parsedPath=n||_f.parseTrackName(e),this.node=_f.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Mf(){this.uuid=zn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(wf.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(_f,{Composite:wf,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new _f.Composite(t,e,n):new _f(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(df,"")},parseTrackName:function(t){const e=xf.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==bf.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const o=n(r.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(_f.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=_f.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const o=t[i];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(_f.prototype,{_getValue_unbound:_f.prototype.getValue,_setValue_unbound:_f.prototype.setValue}),Object.assign(Mf.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let a=void 0,s=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let f=e[h];if(void 0===f){f=s++,e[h]=f,t.push(u);for(let t=0,e=o;t!==e;++t)r[t].push(new _f(u,n[t],i[t]))}else if(f<l){a=t[f];const s=--l,c=t[s];e[c.uuid]=f,t[f]=c,e[h]=s,t[s]=u;for(let t=0,e=o;t!==e;++t){const e=r[t],o=e[s];let a=e[f];e[f]=o,void 0===a&&(a=new _f(u,n[t],i[t])),e[s]=a}}else t[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,l=e[s];if(void 0!==l&&l>=r){const o=r++,c=t[o];e[c.uuid]=l,t[l]=c,e[s]=o,t[o]=a;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[l];e[l]=i,e[o]=r}}}this.nCachedObjects_=r},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=t.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,l=e[s];if(void 0!==l)if(delete e[s],l<r){const a=--r,s=t[a],c=--o,u=t[c];e[s.uuid]=l,t[l]=s,e[u.uuid]=a,t[a]=u,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[c];e[l]=i,e[a]=r,e.pop()}}else{const r=--o,a=t[r];e[a.uuid]=l,t[l]=a,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[t]=i,o.push(t),a.push(e),r.push(u);for(let n=c,i=s.length;n!==i;++n){const i=s[n];u[n]=new _f(i,t,e)}return u},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}});class Sf{constructor(t,e,n,i){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=i||e.blendMode;const r=e.tracks,o=r.length,a=new Array(o),s={endingStart:je,endingEnd:je};for(let t=0;t!==o;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Fe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,o=n/i;t.warp(1,r,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=r,s[1]=r+n,l[0]=t/o,l[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const o=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case We:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulateAdditive(a);break;case He:default:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulate(i,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const o=n===Be;if(0===t)return-1===r?i:o&&1==(1&r)?e-i:i;if(n===Ne){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Ve,i.endingEnd=Ve):(i.endingStart=t?this.zeroSlopeAtStart?Ve:je:Ge,i.endingEnd=e?this.zeroSlopeAtEnd?Ve:je:Ge)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=e,a[1]=r+t,s[1]=n,this}}function Tf(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Tf.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Tf,_bindAction:function(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let t=0;t!==r;++t){const r=i[t],l=r.name;let u=c[l];if(void 0!==u)o[t]=u;else{if(u=o[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;u=new ff(_f.create(n,l,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),o[t]=u}a[t].resultBuffer=u.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const i=this._actions,r=this._actionsByClip;let o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_addInactiveBinding:function(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[e];void 0===o&&(o={},i[e]=o),o[n]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new _u(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const i=e||this._root,r=i.uuid;let o="string"==typeof t?Lu.findByName(i,t):t;const a=null!==o?o.uuid:t,s=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:He),void 0!==s){const t=s.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Sf(this,o,e,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c},existingAction:function(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?Lu.findByName(n,t):t,o=r?r.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let a=0;a!==n;++a){e[a]._update(i,t,r,o)}const a=this._bindings,s=this._nActiveBindings;for(let t=0;t!==s;++t)a[t].apply(o);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,o=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,e[r]=o,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class Af{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Af(void 0===this.value.clone?this.value:this.value.clone())}}function Ef(t,e,n){Ws.call(this,t,e),this.meshPerAttribute=n||1}function qf(t,e,n,i,r){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}function Cf(t,e,n,i){this.ray=new Mi(t,e),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new Oi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Pf(t,e){return t.distance-e.distance}function Rf(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Rf(i[t],e,n,!0)}}Ef.prototype=Object.assign(Object.create(Ws.prototype),{constructor:Ef,isInstancedInterleavedBuffer:!0,copy:function(t){return Ws.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=Ws.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=Ws.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(qf.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(qf.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Cf.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){const i=n||[];return Rf(t,this,i,e),i.sort(Pf),i},intersectObjects:function(t,e,n){const i=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let n=0,r=t.length;n<r;n++)Rf(t[n],this,i,e);return i.sort(Pf),i}});class Lf{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(zn.clamp(e/this.radius,-1,1))),this}}class If{constructor(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}}const Df=new Un;class Of{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Un(1/0,1/0),this.max=void 0!==e?e:new Un(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Df.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Un),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Un),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Un),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Un),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Df.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Nf=new Qn,Ff=new Qn;class Bf{constructor(t,e){this.start=void 0!==t?t:new Qn,this.end=void 0!==e?e:new Qn}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Qn),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Qn),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Qn),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Nf.subVectors(t,this.start),Ff.subVectors(this.end,this.start);const n=Ff.dot(Ff);let i=Ff.dot(Nf)/n;return e&&(i=zn.clamp(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Qn),this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function zf(t){Zi.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}zf.prototype=Object.create(Zi.prototype),zf.prototype.constructor=zf,zf.prototype.isImmediateRenderObject=!0;const Uf=new Qn;class kf extends Zi{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Vr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,o=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Lr(i,3));const r=new Sl({fog:!1,toneMapped:!1});this.cone=new Il(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Uf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Uf),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const jf=new Qn,Vf=new Si,Gf=new Si;class Hf extends Il{constructor(t){const e=function t(e){const n=[];e&&e.isBone&&n.push(e);for(let i=0;i<e.children.length;i++)n.push.apply(n,t(e.children[i]));return n}(t),n=new Vr,i=[],r=[],o=new vr(0,0,1),a=new vr(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new Lr(i,3)),n.setAttribute("color",new Lr(r,3)),super(n,new Sl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Gf.getInverse(this.root.matrixWorld);for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Vf.multiplyMatrices(Gf,r.matrixWorld),jf.setFromMatrixPosition(Vf),i.setXYZ(n,jf.x,jf.y,jf.z),Vf.multiplyMatrices(Gf,r.parent.matrixWorld),jf.setFromMatrixPosition(Vf),i.setXYZ(n+1,jf.x,jf.y,jf.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}class Wf extends so{constructor(t,e,n){super(new Wc(e,4,2),new wr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Xf=new Qn,Yf=new vr,Zf=new vr;class Qf extends Zi{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new tc(e);i.rotateY(.5*Math.PI),this.material=new wr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new Sr(o,3)),this.add(new so(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Yf.copy(this.light.color),Zf.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?Yf:Zf;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Xf.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Jf extends Il{constructor(t,e,n,i){t=t||10,e=e||10,n=new vr(void 0!==n?n:4473924),i=new vr(void 0!==i?i:8947848);const r=e/2,o=t/e,a=t/2,s=[],l=[];for(let t=0,c=0,u=-a;t<=e;t++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);const e=t===r?n:i;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Vr;c.setAttribute("position",new Lr(s,3)),c.setAttribute("color",new Lr(l,3)),super(c,new Sl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Kf extends Il{constructor(t,e,n,i,r,o){t=t||10,e=e||16,n=n||8,i=i||64,r=new vr(void 0!==r?r:4473924),o=new vr(void 0!==o?o:8947848);const a=[],s=[];for(let n=0;n<=e;n++){const i=n/e*(2*Math.PI),l=Math.sin(i)*t,c=Math.cos(i)*t;a.push(0,0,0),a.push(l,0,c);const u=1&n?r:o;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const l=1&e?r:o,c=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*c,r=Math.cos(e)*c;a.push(n,0,r),s.push(l.r,l.g,l.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*c,r=Math.cos(e)*c,a.push(n,0,r),s.push(l.r,l.g,l.b)}}const l=new Vr;l.setAttribute("position",new Lr(a,3)),l.setAttribute("color",new Lr(s,3)),super(l,new Sl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const $f=new Qn,td=new Qn,ed=new Qn;class nd extends Zi{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new Vr;i.setAttribute("position",new Lr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Sl({fog:!1,toneMapped:!1});this.lightPlane=new Pl(i,r),this.add(this.lightPlane),i=new Vr,i.setAttribute("position",new Lr([0,0,0,0,0,1],3)),this.targetLine=new Pl(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){$f.setFromMatrixPosition(this.light.matrixWorld),td.setFromMatrixPosition(this.light.target.matrixWorld),ed.subVectors(td,$f),this.lightPlane.lookAt(td),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(td),this.targetLine.scale.z=ed.length()}}const id=new Qn,rd=new _o;class od extends Il{constructor(t){const e=new Vr,n=new Sl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},a=new vr(16755200),s=new vr(16711680),l=new vr(43775),c=new vr(16777215),u=new vr(3355443);function h(t,e,n){f(t,n),f(e,n)}function f(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(i.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new Lr(i,3)),e.setAttribute("color",new Lr(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const t=this.geometry,e=this.pointMap;rd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ad("c",e,t,rd,0,0,-1),ad("t",e,t,rd,0,0,1),ad("n1",e,t,rd,-1,-1,-1),ad("n2",e,t,rd,1,-1,-1),ad("n3",e,t,rd,-1,1,-1),ad("n4",e,t,rd,1,1,-1),ad("f1",e,t,rd,-1,-1,1),ad("f2",e,t,rd,1,-1,1),ad("f3",e,t,rd,-1,1,1),ad("f4",e,t,rd,1,1,1),ad("u1",e,t,rd,.7,1.1,-1),ad("u2",e,t,rd,-.7,1.1,-1),ad("u3",e,t,rd,0,2,-1),ad("cf1",e,t,rd,-1,0,1),ad("cf2",e,t,rd,1,0,1),ad("cf3",e,t,rd,0,-1,1),ad("cf4",e,t,rd,0,1,1),ad("cn1",e,t,rd,-1,0,-1),ad("cn2",e,t,rd,1,0,-1),ad("cn3",e,t,rd,0,-1,-1),ad("cn4",e,t,rd,0,1,-1),t.getAttribute("position").needsUpdate=!0}}function ad(t,e,n,i,r,o,a){id.set(r,o,a).unproject(i);const s=e[t];if(void 0!==s){const t=n.getAttribute("position");for(let e=0,n=s.length;e<n;e++)t.setXYZ(s[e],id.x,id.y,id.z)}}const sd=new $n;class ld extends Il{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Vr;r.setIndex(new Sr(n,1)),r.setAttribute("position",new Sr(i,3)),super(r,new Sl({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&sd.setFromObject(this.object),sd.isEmpty())return;const e=sd.min,n=sd.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Il.prototype.copy.call(this,t),this.object=t.object,this}}class cd extends Il{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Vr;i.setIndex(new Sr(n,1)),i.setAttribute("position",new Lr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Sl({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class ud extends Pl{constructor(t,e,n){const i=void 0!==n?n:16776960,r=new Vr;r.setAttribute("position",new Lr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Sl({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;const o=new Vr;o.setAttribute("position",new Lr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new so(o,new wr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?m:p,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const hd=new Qn;let fd,dd;class pd extends Zi{constructor(t,e,n,i,r,o){super(),this.type="ArrowHelper",void 0===t&&(t=new Qn(0,0,1)),void 0===e&&(e=new Qn(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===o&&(o=.2*r),void 0===fd&&(fd=new Vr,fd.setAttribute("position",new Lr([0,0,0,0,1,0],3)),dd=new nu(0,.5,1,5,1),dd.translate(0,-.5,0)),this.position.copy(e),this.line=new Pl(fd,new Sl({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new so(dd,new wr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{hd.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(hd,e)}}setLength(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class md extends Il{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Vr;n.setAttribute("position",new Lr(e,3)),n.setAttribute("color",new Lr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Sl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const gd=Math.pow(2,8),vd=[.125,.215,.35,.446,.526,.582],yd=5+vd.length,xd={[Qe]:0,[Je]:1,[$e]:2,[en]:3,[nn]:4,[rn]:5,[Ke]:6},bd=new _h,{_lodPlanes:wd,_sizeLods:_d,_sigmas:Md}=function(){const t=[],e=[],n=[];let i=8;for(let r=0;r<yd;r++){const o=Math.pow(2,i);e.push(o);let a=1/o;r>4?a=vd[r-8+4-1]:0==r&&(a=0),n.push(a);const s=1/(o-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,f=6,d=3,p=2,m=1,g=new Float32Array(d*f*h),v=new Float32Array(p*f*h),y=new Float32Array(m*f*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(i,d*f*t),v.set(u,p*f*t);const r=[t,t,t,t,t,t];y.set(r,m*f*t)}const x=new Vr;x.setAttribute("position",new Sr(g,d)),x.setAttribute("uv",new Sr(v,p)),x.setAttribute("faceIndex",new Sr(y,m)),t.push(x),i>4&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}();let Sd=null;const Td=(1+Math.sqrt(5))/2,Ad=1/Td,Ed=[new Qn(1,1,1),new Qn(-1,1,1),new Qn(1,1,-1),new Qn(-1,1,-1),new Qn(0,Td,Ad),new Qn(0,Td,-Ad),new Qn(Ad,0,Td),new Qn(-Ad,0,Td),new Qn(Td,Ad,0),new Qn(-Td,Ad,0)];class qd{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new Qn(0,1,0);return new cu({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:xd[Qe]},outputEncoding:{value:xd[Qe]}},vertexShader:Dd(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Od()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Sd=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Id(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Ld(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<wd.length;t++)wd[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Sd),t.scissorTest=!1,Rd(t,0,0,t.width,t.height)}_fromTexture(t){Sd=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:pt,minFilter:pt,generateMipmaps:!1,type:St,format:kt,encoding:Cd(t)?t.encoding:$e,depthBuffer:!1},n=Pd(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Pd(e),n}_compileMaterial(t){const e=new so(wd[0],t);this._renderer.compile(e,bd)}_sceneToCubeUV(t,e,n,i){const r=new Mo(90,1,e,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.outputEncoding,c=s.toneMapping,u=s.getClearColor(),h=s.getClearAlpha();s.toneMapping=K,s.outputEncoding=Qe;let f=t.background;if(f&&f.isColor){f.convertSRGBToLinear();const e=Math.max(f.r,f.g,f.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);f=f.multiplyScalar(Math.pow(2,-n));const i=(n+128)/255;s.setClearColor(f,i),t.background=null}for(let e=0;e<6;e++){const n=e%3;0==n?(r.up.set(0,o[e],0),r.lookAt(a[e],0,0)):1==n?(r.up.set(0,0,o[e]),r.lookAt(0,a[e],0)):(r.up.set(0,o[e],0),r.lookAt(0,0,a[e])),Rd(i,n*gd,e>2?gd:0,gd,gd),s.setRenderTarget(i),s.render(t,r)}s.toneMapping=c,s.outputEncoding=l,s.setClearColor(u,h)}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Id()):null==this._equirectShader&&(this._equirectShader=Ld());const i=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new so(wd[0],i),o=i.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=xd[t.encoding],o.outputEncoding.value=xd[e.texture.encoding],Rd(e,0,0,3*gd,2*gd),n.setRenderTarget(e),n.render(r,bd)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<yd;e++){const n=Math.sqrt(Md[e]*Md[e]-Md[e-1]*Md[e-1]),i=Ed[(e-1)%Ed.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",r),this._halfBlur(o,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,o,a){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new so(wd[i],l),u=l.uniforms,h=_d[n]-1,f=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,d=r/f,p=isFinite(r)?1+Math.floor(3*d):20;p>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/d,n=Math.exp(-e*e/2);m.push(n),0==t?g+=n:t<p&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;u.envMap.value=t.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=f,u.mipInt.value=8-n,u.inputEncoding.value=xd[t.texture.encoding],u.outputEncoding.value=xd[t.texture.encoding];const v=_d[i];Rd(e,3*Math.max(0,gd-2*v),(0===i?0:2*gd)+2*v*(i>4?i-8+4:0),3*v,2*v),s.setRenderTarget(e),s.render(c,bd)}}function Cd(t){return void 0!==t&&t.type===St&&(t.encoding===Qe||t.encoding===Je||t.encoding===Ke)}function Pd(t){const e=new Xn(3*gd,3*gd,t);return e.texture.mapping=ct,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Rd(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Ld(){return new cu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Un(1,1)},inputEncoding:{value:xd[Qe]},outputEncoding:{value:xd[Qe]}},vertexShader:Dd(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Od()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1})}function Id(){return new cu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:xd[Qe]},outputEncoding:{value:xd[Qe]}},vertexShader:Dd(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Od()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1})}function Dd(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Od(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Nd(t,e,n,i,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new yr(t,e,n,r,o,a)}const Fd=0,Bd=1,zd=0,Ud=1,kd=2;function jd(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Vd(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Gd(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ul(t,e)}function Hd(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new cl(t)}function Wd(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ul(t,e)}function Xd(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ol(t)}function Yd(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ol(t)}function Zd(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ol(t)}function Qd(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Qn(t,e,n)}function Jd(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Sr(t,e).setUsage(An)}function Kd(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Tr(t,e)}function $d(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ar(t,e)}function tp(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Er(t,e)}function ep(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new qr(t,e)}function np(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Cr(t,e)}function ip(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Pr(t,e)}function rp(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Rr(t,e)}function op(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Lr(t,e)}function ap(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ir(t,e)}function sp(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),th.call(this,t),this.type="catmullrom",this.closed=!0}function lp(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),th.call(this,t),this.type="catmullrom"}function cp(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),th.call(this,t),this.type="catmullrom"}function up(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new md(t)}function hp(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ld(t,e)}function fp(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Il(new tu(t.geometry),new Sl({color:void 0!==e?e:16777215}))}function dp(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Il(new Wl(t.geometry),new Sl({color:void 0!==e?e:16777215}))}function pp(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new zu(t)}function mp(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Gu(t)}function gp(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new To(t,n)}Wu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Wu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(fh.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new mo;for(let n=0,i=t.length;n<i;n++){const i=t[n];e.vertices.push(new Qn(i.x,i.y,i.z||0))}return e}}),Object.assign(dh.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),sp.prototype=Object.create(th.prototype),lp.prototype=Object.create(th.prototype),cp.prototype=Object.create(th.prototype),Object.assign(cp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Jf.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hf.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Fu.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ph.extractUrlBase(t)}}),Fu.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Oh.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Of.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign($n.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(mi.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Co.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Bf.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(zn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),zn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),zn.ceilPowerOfTwo(t)}}),Object.assign(kn.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Si.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Qn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,o)}}),$i.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Zn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Mi.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(ur.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(ur,{barycoordFromPoint:function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ur.getBarycoord(t,e,n,i,r)},normal:function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ur.getNormal(t,e,n,i)}}),Object.assign(ph.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new zc(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jc(this,t)}}),Object.assign(Un.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Qn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wn.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(mo.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Zi.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Zi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(so.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(so.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xe},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(dl.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(vl.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),pl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Wu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Mo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(mh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Sr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===An},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(An)}}}),Object.assign(Sr.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?An:Tn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Vr.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Sr(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Vr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Rh.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Cf.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ws.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===An},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ws.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?An:Tn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Uc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Hs.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Af.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(br.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new vr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(fu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(hu.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(wo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(ks.prototype,{clearTarget:function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ks.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Je:Qe}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Cs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Xn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(of.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Wh).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),hf.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},So.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};const vp={merge:function(t,e,n){let i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,e=e.geometry),t.merge(e,i,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function yp(){console.error("THREE.CanvasRenderer has been removed")}function xp(){console.error("THREE.JSONLoader has been removed.")}Vn.crossOrigin=void 0,Vn.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Hu;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Vn.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Vu;r.setCrossOrigin(this.crossOrigin);const o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Vn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Vn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const bp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function wp(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}}))},,function(t,e,n){"use strict";(function(t){var i,r,o=n(438),a={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(t,e,n){return typeof t===e?t:n},ensureArrayTypedArg:function(t,e,n){if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(typeof t[i]!==e)return n;return t}return this.ensureTypedArg(t,e,n)},ensureInstanceOf:function(t,e,n){return void 0!==e&&t instanceof e?t:n},ensureArrayInstanceOf:function(t,e,n){if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(void 0!==e&&t[i]instanceof e==!1)return n;return t}return this.ensureInstanceOf(t,e,n)},ensureValueOverLifetimeCompliance:function(t,e,n){e=e||3,n=n||3,!1===Array.isArray(t._value)&&(t._value=[t._value]),!1===Array.isArray(t._spread)&&(t._spread=[t._spread]);var i=this.clamp(t._value.length,e,n),r=this.clamp(t._spread.length,e,n),o=Math.max(i,r);t._value.length!==o&&(t._value=this.interpolateArray(t._value,o)),t._spread.length!==o&&(t._spread=this.interpolateArray(t._spread,o))},interpolateArray:function(t,e){for(var n=t.length,i=["function"==typeof t[0].clone?t[0].clone():t[0]],r=(n-1)/(e-1),o=1;o<e-1;++o){var a=o*r,s=Math.floor(a),l=Math.ceil(a),c=a-s;i[o]=this.lerpTypeAgnostic(t[s],t[l],c)}return i.push("function"==typeof t[n-1].clone?t[n-1].clone():t[n-1]),i},clamp:function(t,e,n){return Math.max(e,Math.min(t,n))},zeroToEpsilon:function(t,e){var n=t;return n=e?1e-5*Math.random()*10:1e-5,t<0&&t>-1e-5&&(n=-n),n},lerpTypeAgnostic:function(e,n,i){var r,o=this.types;return typeof e===o.NUMBER&&typeof n===o.NUMBER?e+(n-e)*i:e instanceof t.Vector2&&n instanceof t.Vector2?((r=e.clone()).x=this.lerp(e.x,n.x,i),r.y=this.lerp(e.y,n.y,i),r):e instanceof t.Vector3&&n instanceof t.Vector3?((r=e.clone()).x=this.lerp(e.x,n.x,i),r.y=this.lerp(e.y,n.y,i),r.z=this.lerp(e.z,n.z,i),r):e instanceof t.Vector4&&n instanceof t.Vector4?((r=e.clone()).x=this.lerp(e.x,n.x,i),r.y=this.lerp(e.y,n.y,i),r.z=this.lerp(e.z,n.z,i),r.w=this.lerp(e.w,n.w,i),r):e instanceof t.Color&&n instanceof t.Color?((r=e.clone()).r=this.lerp(e.r,n.r,i),r.g=this.lerp(e.g,n.g,i),r.b=this.lerp(e.b,n.b,i),r):void console.warn("TDS: Invalid argument types, or argument types do not match.",e,n)},lerp:function(t,e,n){return t+(e-t)*n},roundToNearestMultiple:function(t,e){var n;return 0===e?t:0===(n=Math.abs(t)%e)?t:t<0?-(Math.abs(t)-n):t+e-n},arrayValuesAreEqual:function(t){for(var e=0;e<t.length-1;++e)if(t[e]!==t[e+1])return!1;return!0},randomFloat:function(t,e){return t+e*(Math.random()-.5)},randomVector3:function(t,e,n,i,r){var o=n.x+(Math.random()*i.x-.5*i.x),a=n.y+(Math.random()*i.y-.5*i.y),s=n.z+(Math.random()*i.z-.5*i.z);r&&(o=.5*-r.x+this.roundToNearestMultiple(o,r.x),a=.5*-r.y+this.roundToNearestMultiple(a,r.y),s=.5*-r.z+this.roundToNearestMultiple(s,r.z)),t.typedArray.setVec3Components(e,o,a,s)},randomColor:function(t,e,n,i){var r=n.r+Math.random()*i.x,o=n.g+Math.random()*i.y,a=n.b+Math.random()*i.z;r=this.clamp(r,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),t.typedArray.setVec3Components(e,r,o,a)},randomColorAsHex:(r=new t.Color,function(t,e,n,i){for(var o=n.length,a=[],s=0;s<o;++s){var l=i[s];r.copy(n[s]),r.r+=Math.random()*l.x-.5*l.x,r.g+=Math.random()*l.y-.5*l.y,r.b+=Math.random()*l.z-.5*l.z,r.r=this.clamp(r.r,0,1),r.g=this.clamp(r.g,0,1),r.b=this.clamp(r.b,0,1),a.push(r.getHex())}t.typedArray.setVec4Components(e,a[0],a[1],a[2],a[3])}),randomVector3OnSphere:function(t,e,n,i,r,o,a,s){var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(i,r),f=0,d=0,p=0;a&&(h=Math.round(h/a)*a),f=u*Math.cos(c)*h,d=u*Math.sin(c)*h,p=l*h,f*=o.x,d*=o.y,p*=o.z,f+=n.x,d+=n.y,p+=n.z,t.typedArray.setVec3Components(e,f,d,p)},seededRandom:function(t){var e=1e4*Math.sin(t);return e-(0|e)},randomVector3OnDisc:function(t,e,n,i,r,o,a){var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,r)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=n.x,u+=n.y,h+=n.z,t.typedArray.setVec3Components(e,c,u,h)},randomVector3OnMesh:function(e,n,i,r,a,s){const l=new o.a(s).setWeightAttribute("color").build(),c=new t.Vector3,u=new t.Vector3;l.sample(c,u),e.typedArray.setVec3Components(n,c.x,c.y,c.z)},randomDirectionVector3OnSphere:(i=new t.Vector3,function(t,e,n,r,o,a,s,l){i.copy(a),i.x-=n,i.y-=r,i.z-=o,i.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(e,i.x,i.y,i.z)}),randomDirectionVector3OnDisc:function(){var e=new t.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,0)}}(),randomDirectionVector3OnMesh:function(){var e=new t.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,e.z)}}(),getPackedRotationAxis:function(){var e=new t.Vector3,n=new t.Vector3,i=new t.Color,r=new t.Vector3(1,1,1);return function(t,o){return e.copy(t).normalize(),n.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}()};e.a=a}).call(this,n(0))},function(t,e,n){"use strict";var i=n(247),r=n.n(i),o=n(248),a=n.n(o),s=n(249),l=n.n(s),c=n(250),u=n.n(c),h=n(251),f=n.n(h),d=n(252),p=n.n(d),m=n(253),g=n.n(m),v=n(254),y=n.n(v),x=n(255),b=n.n(x),w=n(129),_=n.n(w),M=n(256),S=n.n(M),T=n(257),A=n.n(T),E=n(258),q=n.n(E),C=n(259),P=n.n(C),R=n(260),L=n.n(R),I=n(261),D=n.n(I),O=n(262),N=n.n(O),F=n(263),B=n.n(F),z=n(264),U=n.n(z),k=n(265),j=n.n(k),V=n(266),G=n.n(V),H=n(267),W=n.n(H),X=n(160),Y=n.n(X),Z=n(161),Q=n.n(Z),J=n(268),K=n.n(J),$=n(269),tt=n.n($),et=n(270),nt=n.n(et),it=n(271),rt=n.n(it),ot=n(272),at=n.n(ot),st=n(273),lt=n.n(st),ct=n(274),ut=n.n(ct),ht=n(275),ft=n.n(ht),dt=n(276),pt=n.n(dt),mt=n(277),gt=n.n(mt),vt=n(278),yt=n.n(vt),xt=n(279),bt=n.n(xt),wt=n(280),_t=n.n(wt),Mt=n(281),St=n.n(Mt),Tt=n(282),At=n.n(Tt),Et=n(283),qt=n.n(Et),Ct=n(284),Pt=n.n(Ct),Rt=n(285),Lt=n.n(Rt),It=n(162),Dt=n.n(It),Ot=n(208),Nt=n.n(Ot),Ft=n(286),Bt=n.n(Ft),zt=n(209),Ut=n.n(zt),kt=n(287),jt=n.n(kt),Vt=n(288),Gt=n.n(Vt),Ht=n(163),Wt=n.n(Ht),Xt=n(289),Yt=n.n(Xt),Zt=n(189),Qt=n.n(Zt),Jt=n(290),Kt=n.n(Jt),$t=n(291),te=n.n($t),ee=n(292),ne=n.n(ee),ie=n(293),re=n.n(ie),oe=n(294),ae=n.n(oe),se=(n(522),n(210)),le=n.n(se),ce=n(295),ue=n.n(ce),he=n(296),fe=n.n(he),de=n(297),pe=n.n(de),me=n(298),ge=n.n(me),ve=n(299),ye=n.n(ve),xe=n(300),be=n.n(xe),we=n(301),_e=n.n(we),Me=n(302),Se=n.n(Me),Te=n(303),Ae=n.n(Te),Ee=n(304),qe=n.n(Ee),Ce=n(305),Pe=n.n(Ce),Re=n(306),Le=n.n(Re),Ie=n(307),De=n.n(Ie),Oe=n(173),Ne=n.n(Oe),Fe=n(308),Be=n.n(Fe),ze=n(309),Ue=n.n(ze),ke=n(310),je=n.n(ke),Ve=n(311),Ge=n.n(Ve),He=n(312),We=n.n(He),Xe=n(313),Ye=n.n(Xe),Ze=n(314),Qe=n.n(Ze),Je=n(315),Ke=n.n(Je),$e=n(316),tn=n.n($e),en=n(317),nn=n.n(en),rn=n(318),on=n.n(rn),an=n(319),sn=n.n(an),ln=n(320),cn=n.n(ln),un=n(321),hn=n.n(un),fn=n(322),dn=n.n(fn),pn=n(323),mn=n.n(pn),gn=n(324),vn=n.n(gn),yn=n(325),xn=n.n(yn),bn=n(326),wn=n.n(bn),_n=n(327),Mn=n.n(_n),Sn=n(328),Tn=n.n(Sn),An=n(329),En=n.n(An),qn=n(330),Cn=n.n(qn),Pn=n(331),Rn=n.n(Pn),Ln=n(332),In=n.n(Ln),Dn=n(333),On=n.n(Dn),Nn=n(334),Fn=n.n(Nn),Bn=n(335),zn=n.n(Bn),Un=n(336),kn=n.n(Un),jn=n(337),Vn=n.n(jn),Gn=n(338),Hn=n.n(Gn),Wn=n(339),Xn=n.n(Wn),Yn=n(340),Zn=n.n(Yn),Qn=n(341),Jn=n.n(Qn),Kn=n(342),$n=n.n(Kn),ti=n(343),ei=n.n(ti),ni=n(344),ii=n.n(ni),ri=n(345),oi=n.n(ri),ai=n(346),si=n.n(ai),li=n(347),ci=n.n(li),ui=n(348),hi=n.n(ui),fi=n(349),di=n.n(fi),pi=n(350),mi=n.n(pi),gi=n(351),vi=n.n(gi),yi=n(352),xi=n.n(yi),bi=n(353),wi=n.n(bi),_i=n(354),Mi=n.n(_i),Si=n(355),Ti=n.n(Si),Ai=n(356),Ei=n.n(Ai),qi=n(357),Ci=n.n(qi),Pi=n(358),Ri=n.n(Pi),Li=n(359),Ii=n.n(Li),Di=n(360),Oi=n.n(Di),Ni=n(361),Fi=n.n(Ni),Bi=n(362),zi=n.n(Bi),Ui=n(363),ki=n.n(Ui),ji=n(364),Vi=n.n(ji),Gi=n(365),Hi=n.n(Gi),Wi=n(366),Xi=n.n(Wi),Yi=n(367),Zi=n.n(Yi),Qi=n(368),Ji=n.n(Qi),Ki=n(369),$i=n.n(Ki),tr=n(370),er=n.n(tr),nr=n(371),ir=n.n(nr),rr=n(372),or=n.n(rr),ar=n(373),sr=n.n(ar),lr=n(374),cr=n.n(lr),ur=n(375),hr=n.n(ur),fr=n(376),dr=n.n(fr),pr=n(377),mr=n.n(pr),gr=n(378),vr=n.n(gr),yr=n(379),xr=n.n(yr),br=n(380),wr=n.n(br),_r=n(381),Mr=n.n(_r),Sr=n(382),Tr=n.n(Sr),Ar=n(383),Er=n.n(Ar),qr=n(384),Cr=n.n(qr),Pr=n(385),Rr=n.n(Pr),Lr=n(386),Ir=n.n(Lr),Dr=n(387),Or=n.n(Dr),Nr=n(388),Fr=n.n(Nr),Br=n(389),zr=n.n(Br),Ur=n(390),kr=n.n(Ur),jr=n(391),Vr=n.n(jr),Gr=n(392),Hr=n.n(Gr),Wr=n(393),Xr=n.n(Wr),Yr=n(394),Zr=n.n(Yr),Qr=n(395),Jr=n.n(Qr),Kr=n(396),$r=n.n(Kr),to=n(397),eo=n.n(to),no=n(398),io=n.n(no),ro=n(399),oo=n.n(ro),ao=n(400),so=n.n(ao),lo=n(401),co=n.n(lo),uo=n(402),ho=n.n(uo),fo=n(403),po=n.n(fo),mo=n(404),go=n.n(mo),vo=n(405),yo=n.n(vo),xo=n(406),bo=n.n(xo),wo=n(407),_o=n.n(wo),Mo=n(408),So=n.n(Mo),To=n(409),Ao=n.n(To),Eo=n(410),qo=n.n(Eo),Co=n(411),Po=n.n(Co),Ro=n(412),Lo=n.n(Ro),Io=n(413),Do=n.n(Io),Oo=n(414),No=n.n(Oo),Fo=n(415),Bo=n.n(Fo),zo=n(416),Uo=n.n(zo),ko=n(417),jo=n.n(ko),Vo=n(418),Go=n.n(Vo),Ho=n(419),Wo=n.n(Ho),Xo=n(420),Yo=n.n(Xo),Zo=n(421),Qo=n.n(Zo),Jo=n(422),Ko=n.n(Jo),$o=n(423),ta=n.n($o),ea=n(424),na=n.n(ea),ia=n(425),ra=n.n(ia),oa=n(426),aa=n.n(oa),sa=n(427),la=n.n(sa),ca=n(428),ua=n.n(ca),ha=n(429),fa=n.n(ha),da=n(430),pa=n.n(da),ma=n(431),ga=n.n(ma),va=n(432),ya=n.n(va),xa=n(433),ba=n.n(xa),wa=n(434),_a=n.n(wa),Ma=n(435),Sa=n(82),Ta={};Ta.default=tt.a,Ta.locked=nt.a,Ta.icons={D2:le.a,D3:le.a,Camera:ue.a,ArrowRight:pe.a,ArrowLeft:ge.a,ArrowDown:ye.a,Arrow:fe.a,Check:be.a,Alpha:_e.a,Icon:Se.a,Pause:Ae.a,Play:qe.a,Stop:xn.a,Close:Pe.a,Font:Ye.a,File:Qe.a,Video:Ke.a,Grid:tn.a,Canvas:nn.a,Material:on.a,Webcam:sn.a,Rotate:We.a,Select:je.a,Resize:Ge.a,Plane:Ue.a,Sphere:Be.a,Mag:hn.a,Tree:dn.a,Assets:mn.a,Templates:Or.a,Fullscreen:De.a,Loading:Mn.a,World:xi.a,Local:wi.a,Code:Ii.a,Door:ki.a,xPos:Vi.a,yPos:Xi.a,zPos:Ji.a,xNeg:Hi.a,yNeg:Zi.a,zNeg:$i.a,Link:er.a,Splitter:cr.a,Plus:Ir.a,Sort:Fr.a,Shape:zr.a,Menu:cn.a,Logo:Le.a,New:a.a,Create:wn.a,Save:l.a,Publish:u.a,Load:f.a,Settings:p.a,Web:g.a,Import:y.a,Export:b.a,Edit:vn.a,Undo:S.a,Redo:A.a,Copy:q.a,Paste:P.a,Delete:L.a,Cut:D.a,Add:N.a,Intersect:B.a,Subtract:U.a,Union:j.a,Figures:G.a,Move:W.a,Probe:Y.a,VR:Ne.a,XR:Ne.a,AR:Ne.a,Entity:Tn.a,Water:zn.a,Robot:kn.a,Pond:Vn.a,Terrain:Hn.a,Tool:Xn.a,Sculpt:Zn.a,Line:Ut.a,Point:Nt.a,Spline:oi.a,Lineloop:ei.a,Circle:ii.a,Pen:si.a,FatLine:ci.a,DashedLine:hi.a,GridHide:di.a,Eraser:mi.a,Clean:vi.a,Extruder:Ci.a,Pipeline:kr.a,Slider:Oi.a,ImageSlider:Fi.a,Annotator:Ri.a,ParticleSlider:zi.a,About:r.a,Inspector:Er.a,Snap:Hr.a,Unsnap:Xr.a,Subdivision:Zr.a,Simplify:Jr.a,Model:In.a,GLTF:K.a,FBX:On.a,Kinect:rt.a,LeapDevice:at.a,Sky:lt.a,SpotLight:ut.a,PointLight:ft.a,HemisphereLight:pt.a,DirectionalLight:gt.a,AmbientLight:yt.a,RectAreaLight:bt.a.png,PerspectiveCamera:_t.a,OrthographicCamera:St.a,SpineAnimation:At.a,Mesh:Wt.a,Box:Wt.a,SkinnedMesh:qt.a,ParticleEmitter:Pt.a,Particle:Lt.a,Particle1:hr.a,Script:Q.a,Sprite:Dt.a,Points:Nt.a,Line:Ut.a,LineSegments:jt.a,Ground:Cn.a,Flame:dr.a,Leaf:mr.a,Raindrop:vr.a,Rain:xr.a,Snow:wr.a,Fountain:Mr.a,Fireworks:Tr.a,Connector:Vr.a,Program:Q.a,Scene:_.a,Audio:Bt.a,PositionalAudio:Gt.a,Physics:ne.a,Misc:Fn.a,Object3D:_.a,CubeCamera:Y.a,Bone:Yt.a,Group:Qt.a,LensFlare:re.a,OrbitControls:Kt.a,FirstPersonControls:te.a,Search:ae.a,Empty:En.a,Annotation:Rn.a,Target:Jn.a,Brush:$n.a,Board:Mi.a,Text:Ti.a,TextImage:Ei.a,Image:Dt.a,StickyNote:ir.a,Running:or.a,Standing:sr.a,Brush3:Cr.a,Transparent:Rr.a},Ta.imgs={Flare0:$r.a,Flare1:eo.a,Flare2:io.a,Flare3:oo.a,Water1:so.a,Water2:co.a,WaterMap1:ho.a,WaterMap2:po.a,WaterMap3:go.a,WaterMap7:yo.a,Cloud1:So.a,Cloud2:Ao.a,Cloud3:qo.a,Pano1:bo.a,Pano2:_o.a,CM_VIRIDIS:Po.a,CM_GRAY:Lo.a,CM_NOISE:Do.a,Noise:la.a,Tile0:No.a,Tile1:Bo.a,JadeWhite:_a.a,SkyboxPosX:Uo.a,SkyboxPosY:jo.a,SkyboxPosZ:Go.a,SkyboxNegX:Wo.a,SkyboxNegY:Yo.a,SkyboxNegZ:Qo.a,Demo1:ua.a,Demo2:fa.a,Demo3:pa.a,Demo4:ga.a,Demo5:ya.a,Demo6:ba.a,Terrain:Ko.a,TerrainBg:ta.a,TerrainNormal:na.a,WhiteBoard:ra.a,Stroke:aa.a},Ta.fonts={Default:Ma},Ta.get=function(t){var e=Ta.icons[t]||Ta.default;if(Sa.a.IS_PRODUCTION){var n=e.replace(/^.*[\\\/]/,"");return Sa.a.STONE_URL+"/assets/"+n}return e},Ta.getImg=function(t){var e=Ta.imgs[t]||Ta.default;if(Sa.a.IS_PRODUCTION){var n=e.replace(/^.*[\\\/]/,"");return Sa.a.STONE_URL+"/assets/"+n}return e},Ta.getFont=function(t){return Ta.fonts[t]||Ta.fonts.Default},e.a=Ta},function(t,e,n){"use strict";n.r(e);n(479),n(480),n(242),n(82);var i=n(31),r=(n(487),n(114));let o={meta:{language:"CN",name:"Chinese",version:1},techbrood:"踏得",stone:"Stone",slogan:"Stone - 网页3D在线编辑器，快速构建和分享沉浸式展示",comingSoon:"敬请期待",edit:"编辑",delete:"删除",copy:"拷贝",clone:"克隆",paste:"粘贴",cut:"剪切",duplicate:"重复",rename:"重命名",renameObject:"对象重命名",select:"选择",redo:"重做",undo:"撤销",add:"添加",mix:"混合",multiply:"相乘",setTransparent:"设为透明",tool:"工具",hierarchy:"场景树",inspector:"检测器",assets:"资源池",templates:"模板库",enabled:"启用",disabled:"禁用",snap:"吸附",grid:"辅助网格",computeNormals:"计算法线",applyTransformation:"应用变换",sceneEditor:"场景编辑器",objectEditor:"对象编辑器",scriptEditor:"脚本编辑器",particleEditor:"粒子编辑器",recenterGeometries:"几何体居中",enable:"启用",disable:"禁用",static:"静止",dynamic:"动态",createScene:"添加场景",addPoint:"添加点",removePoint:"删除点",box:"立方体",plane:"平面",sphere:"球体",disc:"圆盘",cylinder:"圆柱",convexHull:"凸耳",cube:"立方体",torus:"环面",torusKnot:"环状结",cone:"圆锥",light:"光源",directionalLight:"平行光",spotLight:"聚光灯",pointLight:"点光源",ambientLight:"环境光",empty:"空",camera:"相机",perspectiveCamera:"远景相机",orthographicCamera:"正交相机",pipeline:"管线",tube:"管子",name:"名字",count:"数量",rate:"速率",maxParticleCount:"粒子数量",particleRate:"发射速度",delayTime:"延迟时间",visible:"是否可见",side:"边",position:"位置",rotation:"旋转",scale:"缩放",uuid:"唯一编号",repeat:"重复",offset:"偏移",center:"中心",wrapHor:"水平包裹",wrapVert:"垂直包裹",clampEdge:"夹住边缘",repeatMirror:"重复镜像",premulAlpha:"预乘Alpha",vector:"矢量",type:"类型",physics:"物理",size:"尺寸",viewport:"视口",mode:"模式",anchor:"锚点",antialiasing:"抗锯齿",exposure:"暴露",backend:"后端",whitepoint:"白点",tonemapping:"调和映射",shadows:"阴影",shadowType:"阴影类型",shadowsAutoUpdate:"阴影自动更新",autoClear:"自动清除",autoClearColor:"自动清除颜色",autoClearDepth:"自动清除深度",autoClearStencil:"自动清除模具",checkShaderErrors:"检查着色器",clearColor:"清除颜色",clearDepth:"清除深度",clearStencil:"清除模板",stencil:"模具",sortObjects:"排序对象",gammaFactor:"伽马因子",gammaInput:"伽马输入",gammaOutput:"伽马输出",precision:"精准",alpha:"Alpha",premultipliedAlpha:"预乘Alpha",preserveDrawingBuffer:"保留缓冲区",powerPreference:"功率选项",logarithmicDepthBuffer:"对数深度缓存",physicallyCorrectLights:"物理校正灯光",depthWrite:"深度写入",toneMapped:"调和映射",depthTest:"深度测试",depthMode:"深度模式",background:"背景",fog:"雾",color:"颜色",emissiveColor:"发射色",backgroundColor:"背景色",fontSize:"字体大小",density:"密度",near:"近",far:"远",wireframe:"线框",transparent:"透明",opacity:"不透明度",alphaTest:"Alpha测试",blendingMode:"混合模式",useCamera:"使用相机",renderrorder:"渲染顺序",fov:"视角",clippingPlanes:"剪裁平面",iterations:"迭代",tolerance:"公差",gravity:"重力",usePhysics:"使用物理",useNavigator:"使用导航器",defaultScene:"默认场景",intensity:"强度",time:"时间",shading:"阴影",skinning:"皮肤",roughness:"粗糙度",metalness:"金属性",bias:"偏差",refraction:"折射",refractionRatio:"折射率",morphTargets:"变形目标",textureMap:"纹理贴图",sky:"天空",castShadows:"投射阴影",sunDistance:"太阳距离",autoUpdate:"自动更新",skyColor:"天空颜色",groundColor:"底色",mapping:"映射",minFilter:"缩小过滤器",magFilter:"放大过滤器",flipY:"翻转Y",toneMapped:"调和映射",text:"文本",textImage:"文本图像",mirror:"镜像",thickness:"厚度",bevel:"斜角",lineHeight:"行高",letterSpacing:"字母间距",align:"对齐",smoothing:"平滑",threshold:"阈值",shader:"着色器",outline:"轮廓",outlineColor:"轮廓颜色",outlineWidth:"轮廓宽度",border:"边界",borderColor:"边界颜色",borderSize:"边框大小",borderRadius:"边界半径",font:"字体",direction:"方向",forward:"前进",backward:"后退",duration:"持续时间",emitterType:"发射器类型",age:"生存时间",initial:"初始",variation:"变化量",velocity:"速度",acceleration:"加速度",base:"基础",spread:"扩散",min:"最小",max:"最大",wiggle:"摇摆",mass:"质量",linearDamping:"线性阻尼",angularDamping:"角阻尼",friction:"摩擦系数",restitution:"恢复系数",lockRotation:"锁定旋转",annotation:"注解",title:"标题",description:"说明",rotate:"旋转",edgeThickness:"边缘厚度",edgeStrength:"边缘力量",edgeGlow:"边缘发光",pulsePeriod:"脉冲周期",hiddenColor:"隐藏色",sunColor:"太阳色",godrays:"云隙光",water:"水",distance:"距离",inclination:"倾斜",azimuth:"方位角",turbidity:"浊度",rayleigh:"散射",mieCoefficient:"Mie散射雾系数",mieDirectionalG:"Mie散射雾粒子量",exposure:"曝光度",upforcePerVolume:"单位体积压力",visibility:"可见性",shape:"形状",line:"细线",fatline:"粗线",spline:"曲线",palette:"调色板",point:"点",palete:"调色板",pen:"笔",penStyle:"笔型",painter:"画板",toggle:"切换",eraser:"橡皮擦",strokes:"笔划",gradient:"渐变",autoFit:"自动调整",padding:"填充",margin:"白边",paintOnMesh:"在模型上绘制",paintInSpace:"在空间中绘制",brush:"画笔",attenuation:"衰减",clockwise:"顺时针",counterClockwise:"逆时针",speed:"速度",on:"打开",off:"关",roughnessMap:"粗糙贴图",metalnessMap:"金属贴图",bumpMap:"凹凸贴图",bumpScale:"凹凸贴图程度",normalMap:"法线贴图",normalScale:"法线贴图程度",normalType:"法线类型",displacementMap:"置换贴图",displacementScale:"置换贴图程度",emissiveMap:"自发光贴图",alphaMap:"Alpha贴图",environmentMap:"环境贴图",ambientOcclusionMap:"环境光遮挡贴图",sceneAutoSwitching:"场景自动轮播",lockPointer:"锁定鼠标",version:"版本",vrScale:"VR比例",flowX:"X方向流动",flowY:"Y方向流动",flowSpeed:"流速",reflectivity:"反射率",transparency:"透明度",clearCoat:"透明涂层",clearCoatRoughness:"透明涂层粗糙度",clearcoatNormalMap:"透明涂层法线贴图",clearcoatNormalScale:"透明涂层法向缩放",useCubeCamera:"使用立方体相机",cubeReflection:"立方体反射",cubeRefraction:"立方体折射",equirectangularReflection:"等矩形反射",equirectangularRefraction:"等矩形折射",sphericalReflection:"球面反射",cubeUVReflection:"立方体UV反射",cubeUVRefraction:"立方体UV折射",useTexture:"使用贴图",wrapHor:"水平包装",wrapVert:"垂直包装",castShadow:"投射阴影",receiveShadow:"接收阴影",frustumCulled:"视锥剔除",movementSpeed:"移动速度",rotateSpeed:"旋转速度",autoRotate:"自动旋转",autoRotateSpeed:"自动旋转速度",zoom:"缩放",zoomSpeed:"缩放速度",damping:"阻尼",minDistance:"最小距离",maxDistance:"最大距离",minPolarAngle:"最小极角",maxPolarAngle:"最大极角",putTitleHere:"请在此处输入标题",putLabelHere:"请在此处输入描述",titleSize:"标题字体大小",labelSize:"描述字体大小",startColor:"起始颜色",stopColor:"结束颜色",draggable:"可拖拉",glowing:"发光的",layers:"层(逗号分开)",bloomRadius:"发光半径",bloomStrength:"发光强度",bloomThreshold:"发光阈值",refractionIndex:"折射率",dispersion:"色散",materialType:"材料类型",relative:"相对",absolute:"绝对",bottomRight:"右下角",bottomLeft:"左下角",topRight:"右上角",topLeft:"左上角",firstPerson:"第一人称",orbit:"轨道控制",left:"左",right:"右",front:"前",back:"后",double:"双面",top:"上",bottom:"下",local:"局部",world:"全局",highp:"高精度",mediump:"中精度",lowp:"低精度",highPerformance:"高性能",lowPower:"低功耗",default:"默认",never:"从不",always:"总是",less:"小于",lessOrEqual:"小于等于",greater:"大于",greaterOrEqual:"大于等于",notEqual:"不等于",none:"无",linear:"线性",exponential:"指数",normal:"正常",additive:"加法",subtractive:"减法",horizontal:"水平",vertical:"垂直",smooth:"光滑",flat:"平坦",width:"宽度",height:"高度",resolution:"分辨率",webgl:"WebGL 1.0",webgl2:"WebGL 2.0",nearest:"最近",allSides:"全方位",random:"随机",union:"联合",subtract:"减去",intersect:"相交",simplify:"简化",annotator:"注释",extruder:"拔高",merge:"合并",subdivisionModifier:"细分",simplifyModifier:"简化",project:"项目",program:"程序",run:"运行",stop:"停止",new:"新建",save:"保存",saveAs:"另存为",load:"加载",settings:"设置",publish:"发布",import:"引入",export:"导出",exit:"退出",selectAll:"全选",render:"渲染",tools:"工具",selectShortcut:"选择",moveShortcut:"平移 (T)",scaleShortcut:"缩放 (S)",rotateShortcut:"旋转 (R)",space:"空间",about:"关于",search:"搜索",replace:"替换",replaceAll:"全部替换",clear:"清除",cameraNavigation:"相机导航模式",cameraMode:"更改相机模式",scene:"场景",move:"移动",play:"运行",entity:"实体",robot:"机器人",pond:"池塘",terrain:"地形",codeEditor:"代码编辑器",toolbox:"工具箱",slider:"轮播器",textSlider:"文本轮播器",textImageSlider:"富文本轮播器",imageSlider:"图片轮播器",particleSlider:"粒子轮播器",transition:"平移",fadeOut:"淡出",particle:"粒子",interval:"间隔",spacing:"间距",waveSpeed:"波动速度",shininess:"亮度",specular:"高光",specularMap:"高光贴图",movement:"运动",sensitivity:"敏感度",moveSpeed:"移动速度",heightSpeed:"高度速度",autoForward:"自动前进",autoSpeedFactor:"自动变速因素",lockVertical:"垂直锁定",flame:"火苗",raindrop:"雨",snow:"雪",leaf:"树叶",fountain:"喷泉",fireworks:"烟花",addComponents:"添加组件",plus:"添加",addScene:"添加新场景",reset:"重置",general:"通用",theme:"方案",historySize:"操作历史记录数量上限",hintHistory:"历史记录中存储了多少更改",image:"图像",video:"视频",file:"文件",material:"材质",geometry:"几何体",geometryType:"几何体类型",texture:"贴图",toggleVR:"虚拟现实切换",toggleFullscreen:"全屏切换",augmentedReality:"增强现实",virtualReality:"虚拟现实",projectSaved:"项目已保存",projectLoaded:"项目已加载",projectExported:"项目已导出",deleteObjects:"删除对象？",loadProjectChangesLost:"对项目的所有未保存的更改都将丢失。",loadProject:"加载项目？",createProject:"创建新项目？",unsavedChangesExit:"项目中所有未保存的更改都将丢失。你真的想退出吗？",cannotAddItself:"无法将对象添加到自身。",cannotAddToChildren:"无法将对象添加到其子对象。",nothingToRedo:"没什么可以重做的！",nothingToUndo:"无法进一步撤消。",openTabToEditContent:"打开新选项卡编辑内容或创建新项目。",needsObjectGeometry:"需要几何运算的对象。",needsObjectMesh:"操作需要一个网格对象。",needsTwoObjectMesh:"操作需要两个网格对象。",needsTwoObjectGeometry:"操作需要两个具有几何图形的对象。",needsTwoObjects:"操作需要两个对象。",selectObjectEditAnimation:"编辑对象,选择动画。",nothingToShow:"选择一个对象以查看其属性。",errorExportingProject:"导出项目出错。",errorLoadingFile:"加载文件出错。",errorSavingFile:"保存文件出错。",errorPaste:"粘贴出错。",errorRunInitialize:"程序初始化出错。",errorRunpdate:"程序运行出错。",errorRunRender:"程序渲染出错。",webglNotSupported:"WebGL不支持或被禁用.\nStone不能运行。",unknownFileFormat:"未知文件格式。",failedLoadSpine:"加载脊椎动画失败,请确保.json和.atlas具有相同的名称。",noAudioData:"没有音频数据,需要将音频拖到对象中添加音频组件。",hintCheckShaderErrors:"定义在编译和链接过程中是否检查材质着色器程序的错误。",hintStencil:"模具缓冲区是否至少有8位绘图缓冲区。",hintSortObjects:"如果为真,则渲染器从后到前对对象进行排序以进行渲染。如果使用多个透明对象,这很重要。",hintAlpha:"画布是否包含透明度缓冲区。",hintAntialiasing:"抗锯齿可用于平滑锯齿边缘。",hintBackend:"首选呈现后端API以使用（如果可用）。着色器代码在渲染后端之间可能不兼容。",hintPremultipliedAlpha:"渲染器是否假定颜色已预乘透明度。",hintLogarithmicDepthBuffer:"是否使用对数深度缓冲区。如果在一个场景中处理巨大的比例差异,可能需要使用此方法。",hintRenderOrder:"低阶摄影机首先被渲染。",hintShadowsAutoUpdate:"启用对场景中阴影的自动更新。如果不需要动态照明/阴影,可以将其设置为否。",hintPrecision:"着色器精度。可以是highp、mediump或lowp。如果设备支持,则默认为highp。",hintPowerPreference:"向用户代理提供一个提示,指示哪个GPU配置适合此WebGL上下文。",hintTonemapping:"色调映射可用于将图像的颜色重新映射到不同的集合,从而根据全局亮度为场景提供不同的颜色氛围和/或动态颜色。",hintAutoClearColor:"定义渲染器是否应清除颜色缓冲区。",hintAutoClearDepth:"定义渲染器是否应清除深度缓冲区。",hintAutoClearStencil:"定义渲染器是否应清除模具缓冲区。",hintPhysicallyCorrectLights:"是否使用物理校正的照明模式。",hintCloseBrush:"在编辑材质之前必须先关闭画刷工具。",hintAttachedToScene:"该组件只能附加到场景（Scene）实体上。",hintAttachedToMesh:"该组件只能附加到网格（Mesh）实体上。",hintOnlyBasicGeometrySupport:"目前只有简单模型支持画刷功能,请选择立方体圆球等模型。",hintHaveToCloseBrushFirst:"在更改目标网格之前,必须先关闭画刷。",hintExtruderLimitation:"拔高只能应用于直线或样条曲线。",hintTwinkleAttachedToLight:"闪烁只能应用于点光源。",hintUseGlb:"请使用GLB格式的GLTF模型文件。",hintParticleNoGeometry:"该粒子没有放在合适的模型下。",hintNoSpline:"请先选择样条曲线实体。",hintNoEntity:"请先选择一个实体。",hintModifierToMeshLimitation:"该修改器只能用于网格（Mesh）实体上。",updatedRestart:"更新\n重新启动编辑器。",alreadyUpdated:"已经更新。",updateFailed:"未能下载更新文件。",misc:"杂项",information:"描述",author:"作者",stoneIntroduction:"Stone, 多一个维度的浏览。"};r.a.register(o);n(489),n(155),n(86);var a=n(26),s=n(16),l=(n(120),n(46),n(56),n(93),n(481));n(482),n(483),n(486);var c={NAME:"The runtime under stone studio",VERSION:"0.3.0",__levents:[],container:null,program:null,canvas:null,renderer:null,autofitWindow:!1,locale:r.a.setLocale(i.a.general.locale),init:function(t,e,n){console.log("Intialize Stone studio runtime..."),t&&this.loadProgram(t,e,n)},createProgram:function(t){return this.program=new a.a(t),this.program},loadProgram:function(t,e,n,r){var o=this;"string"==typeof e&&(e=document.getElementById(e)),this.container=e||document.body;var c=this.createLoadingAnimation();function u(){try{if(!1!==n){var t=(new l.StaticPair).decode(h.result);o.program.fromJSON(t)}else o.program.fromJSON(JSON.parse(h.result));o.removeLoadingAnimation(c),o.program.init(),o.resize(),o.runProgram()}catch(t){o.removeLoadingAnimation(c),console.error("TDS: Error loading file",t)}}if(this.program||this.createProgram(this.container),this.program.mode=a.a.MODE_STANDALONE,this.canvas||(this.canvas=document.createElement("canvas"),this.program.container.appendChild(this.canvas),this.canvas.style.width="100%",this.canvas.style.height="100%",this.program.canvas=this.canvas),this.renderer||(this.renderer=i.a.render.createRenderer(this.canvas)),t instanceof File)(h=new FileReader).onload=u,!1!==n?h.readAsArrayBuffer(t):h.readAsText(t);else if("string"==typeof t){var h={};!1!==n?s.a.readFileArrayBuffer(t,t=>{h.result=t,u()}):h.result=s.a.readFile(t,!1,t=>{h.result=t,u()})}},runProgram:function(){var t=this;this.renderer.setAnimationLoop((function(){if(null!==t.program){try{t.program.update()}catch(t){return c.alert(c.locale.errorRunRender+"\n("+t+")"),void console.warn("TDS: Error while running program.",t)}try{t.program.render(t.renderer)}catch(t){return c.alert(c.locale.errorRunRender+"\n("+t+")"),void console.warn("TDS: Error while rendering program.",t)}}})),this.program.lockPointer&&this.mouse.setLock(!0)},resize:function(){if(null!==this.canvas&&null!==this.program&&null!==this.renderer){var t=1,e=1;this.autofitWindow?(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",t=window.innerWidth,e=window.innerHeight):(t=this.canvas.offsetWidth,e=this.canvas.offsetHeight),this.program.handlePixelRatio&&(t*=window.devicePixelRatio,e*=window.devicePixelRatio),this.renderer.setSize(t,e,!1),this.program.resize(t,e)}},webAudioAvailable:function(){return void 0!==window.AudioContext||void 0!==window.webkitAudioContext},webglAvailable:function(){try{var t=document.createElement("canvas");(t.getContext("webgl")||t.getContext("experimental-webgl")).getSupportedExtensions();return!0}catch(t){return!1}return!1},webvrAvailable:function(){return void 0!==navigator.getVRDisplays},getVRDisplays:function(t){void 0!==navigator.getVRDisplays?navigator.getVRDisplays().then((function(e){e.length>0?t(e[0]):console.warn("TDS: WebVR supported but no display is available.")})):console.warn("TDS: WebVR is not supported.")},isFullscreen:function(){return!0===document.webkitIsFullScreen||!0===document.mozFullScreen||!0===document.webkitIsFullScreen||!0===document.webkitIsFullScreen||!0===document.fullscreen||!1},setFullscreen:function(t,e){var n=this.isFullscreen();void 0===t&&(t=!n),!0===t?(void 0===e&&(e=document.body),!1===n&&(e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen,void 0!==e.requestFullscreen&&e.requestFullscreen())):!0===n&&(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,void 0!==document.exitFullscreen&&document.exitFullscreen())},confirm:function(t){return window.confirm(t)},alert:function(t){window.alert(t)},prompt:function(t,e){return window.prompt(t,e)},getDPI:function(){return i.a.general.ignorePixelRatio?1:c.getDPI()},createLoadingAnimation:function(){this.injectStyle("\n\t\t\t.loading_box {\n\t\t\t\tdisplay: flex;\n\t\t\t\tdisplay: -webkit-flex;\n\t\t\t\theight: 100vh;\t\t\t\t\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t}\t\t\n\t\t\t.loader {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth: 0;\n\t\t\t\theight: 0;\n\t\t\t\tborder-left: 10px solid transparent;\n\t\t\t\tborder-right: 10px solid transparent;\n\t\t\t\tborder-bottom: 10px solid #4183D7;\n\t\t\t\tborder-top: 10px solid #F5AB35;\n\t\t\t\t-webkit-animation: loader5 1.2s ease-in-out infinite alternate;\n\t\t\t\tanimation: loader 1.2s ease-in-out infinite alternate;\n\t\t\t}\n\t\t\t@keyframes loader {\n\t\t\t\tfrom {\n\t\t\t\t\ttransform: rotate(0deg);\n\t\t\t\t}\n\t\t\t\tto {\n\t\t\t\t\ttransform: rotate(720deg);\n\t\t\t\t}\n\t\t\t}\n\t  \t");var t=document.createElement("div");return this.container.appendChild(t),t.innerHTML="<div class='loading_box'><div class='loader'></div></div>",t},removeLoadingAnimation:function(t){this.container.removeChild(t)},injectStyle:function(t){const e=document.createElement("style");e.textContent=t,document.head.append(e)}};e.default=c;window.TDS_RT=c},function(t,e,n){(function(e){n(154);var i=n(44);window.utils=i,window.levent=i.levent;var r=t.exports.components={},o=t.exports.Component=function(t,e,...n){if(t)return this.name="",this.displayName="",this.isPublic=!0,this.isComponent=!0,this.entity=t,this.object3D=e,this.enabled=!0,this.initialized=!1,this.dependencies=[],this.singleTon=!0,this.isReplicable=!0,this.proxy()};o.prototype={setEntity:function(t){this.entity=t},getEntity:function(){return this.entity},proxy:function(){return new Proxy(this,{get:function(t,e){return e in t?t[e]:t.object3D?t.object3D[e]:void 0},set:function(t,e,n){if(e in t)t[e]=n;else{if(!t.object3D)return!1;t.object3D[e]=n}return!0}})},createObject3D:function(...t){return this},init:function(){return this},lazyLoad:function(t){return this},resize:function(t,e){},load:function(t,e){return this.fromJSON(t,e)},reload:function(){},fromJSON:function(t,e){if(t)return t.meta&&(this.name=t.meta.name),Object.assign(this,t.properties),this},toJSON:function(){var t={meta:{name:this.name,isComponent:!0},object:{},properties:{}};return this.object3D&&(t.object={uuid:this.object3D.uuid}),t},clone:function(t,e){var n=null;return n=e?new r[this.name](t,e.clone()):new r[this.name](t),n=Object.assign(n,this)},bind:function(t,e,n){},unbind:function(t,e,n){},update:function(t){},tick:function(){},tock:function(){},play:function(){},pause:function(){},dispose:function(){},destroy:function(){},enable:function(t){},attached:function(){if(this.entity&&this.object3D&&this.object3D instanceof e.Object3D){if(this.entity.object3D===this.object3D)return;this.entity.addObject3D(this.object3D)}},detached:function(){this.entity&&this.entity.removeObject3D(this.object3D)}},t.exports.registerComponent=function(t,e){return r[t]=e,e},Object.defineProperty(o.prototype,"root",{set:function(t){this.root=t},get:function(){return this.entity}}),Object.defineProperty(o.prototype,"getClass",{value:function(){return this.constructor.name}})}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));n(46);function i(e,n){this.element=document.createElement(void 0!==n?n:"div"),this.element.style.position="absolute",this.element.style.overflow="hidden",this.element.style.color=Theme.color,this.parent=null,void 0!==e&&this.attachTo(e),this.visible=!0,this.size=new t.Vector2(0,0),this.position=new t.Vector2(0,0),this._mode=i.TOP_LEFT}i.prototype.constructor=i,i.prototype.isElement=!0,i.TOP_LEFT=0,i.TOP_RIGHT=1,i.BOTTOM_LEFT=2,i.BOTTOM_RIGHT=3,i.preventDefault=function(t){t.preventDefault()},i.prototype.setHtml=function(t){this.element.innerHTML=t},i.prototype.addClass=function(t){this.element.classList.add(t)},i.prototype.removeClass=function(t){this.element.classList.contains(t)&&this.element.classList.remove(t)},i.prototype.setStyle=function(t,e){this.element.style[t]=e},i.prototype.preventDragEvents=function(){this.element.ondrop=i.preventDefault,this.element.ondragover=i.preventDefault},i.prototype.setAltText=function(t){var e=document.createElement("div");e.style.position="absolute",e.style.display="none",e.style.alignItems="center",e.style.zIndex="10000",e.style.border="3px solid",e.style.borderRadius="0px",e.style.color=Theme.textColor,e.style.backgroundColor=Theme.barColor,e.style.borderColor=Theme.barColor,e.style.height="fit-content",document.body.appendChild(e);var n=document.createTextNode(t);e.appendChild(n);var i=this.destroy;return this.destroy=function(){i.call(this),document.body.contains(e)&&document.body.removeChild(e)},this.element.style.pointerEvents="auto",this.element.onmousemove=function(t){e.style.display="flex",e.style.left=t.clientX+8+"px",e.style.top=t.clientY-20+"px"},this.element.onmouseout=function(){e.style.display="none"},e},i.prototype.setOnClick=function(t){this.element.onclick=t},i.prototype.removeAllChildren=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)},i.prototype.attachTo=function(t){this.parent!==t&&void 0!==t&&(null!==this.parent&&i.prototype.destroy.call(this),this.parent=t,!0===t.isElement?t.element.appendChild(this.element):t instanceof HTMLElement?t.appendChild(this.element):(console.warn("TDS: Parent is not a Element.",this),this.parent.appendChild(this.element)))},i.prototype.destroy=function(){null!==this.parent&&(!0===this.parent.isElement?this.parent.element.contains(this.element)&&(this.parent.element.removeChild(this.element),this.parent=null):(console.warn("TDS: Parent is not a Element.",this),this.parent.contains(this.element)&&(this.parent.removeChild(this.element),this.parent=null)))},i.prototype.setMode=function(t){this._mode=t,this.element.style.bottom=null,this.element.style.top=null,this.element.style.right=null,this.element.style.left=null},i.prototype.setStyles=function(t){for(var e in t)this.element.style[e]=t[e]},i.prototype.center=function(){this.position.set((this.parent.size.x-this.size.x)/2,(this.parent.size.y-this.size.y)/2)},i.prototype.setVisibility=function(t){this.visible=t,this.updateVisibility()},i.prototype.updateVisibility=function(){this.element.style.display=this.visible?"block":"none"},i.prototype.updatePosition=function(t){void 0!==t&&(this._mode=t),this._mode===i.TOP_LEFT||this._mode===i.TOP_RIGHT?this.element.style.top=this.position.y+"px":this.element.style.bottom=this.position.y+"px",this._mode===i.TOP_LEFT||this._mode===i.BOTTOM_LEFT?this.element.style.left=this.position.x+"px":this.element.style.right=this.position.x+"px"},i.prototype.updateSize=function(){this.element.style.width=this.size.x+"px",this.element.style.height=this.size.y+"px"},i.prototype.updateStyles=function(){},i.prototype.updateInterface=function(){this.updateVisibility(),this.visible&&(this.updateSize(),this.updatePosition(),this.updateStyles())}}).call(this,n(0))},,,,function(t,e,n){"use strict";function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}
/*!
 * GSAP 3.4.2
 * https://greensock.com
 *
 * @license Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/n.d(e,"a",(function(){return Oe})),n.d(e,"c",(function(){return sn})),n.d(e,"x",(function(){return hn})),n.d(e,"b",(function(){return fn})),n.d(e,"w",(function(){return Jt})),n.d(e,"i",(function(){return vt})),n.d(e,"n",(function(){return Y})),n.d(e,"o",(function(){return Z})),n.d(e,"k",(function(){return B})),n.d(e,"l",(function(){return k})),n.d(e,"r",(function(){return tn})),n.d(e,"q",(function(){return K})),n.d(e,"g",(function(){return yt})),n.d(e,"u",(function(){return an})),n.d(e,"e",(function(){return we})),n.d(e,"s",(function(){return le})),n.d(e,"d",(function(){return ke})),n.d(e,"p",(function(){return ut})),n.d(e,"v",(function(){return _e})),n.d(e,"f",(function(){return P})),n.d(e,"t",(function(){return xt})),n.d(e,"m",(function(){return it})),n.d(e,"j",(function(){return Je})),n.d(e,"h",(function(){return gt}));var o,a,s,l,c,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,T,A,E,q,C,P={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},R={duration:.5,overwrite:!1,delay:0},L=2*Math.PI,I=L/4,D=0,O=Math.sqrt,N=Math.cos,F=Math.sin,B=function(t){return"string"==typeof t},z=function(t){return"function"==typeof t},U=function(t){return"number"==typeof t},k=function(t){return void 0===t},j=function(t){return"object"==typeof t},V=function(t){return!1!==t},G=function(){return"undefined"!=typeof window},H=function(t){return z(t)||B(t)},W=Array.isArray,X=/(?:-?\.?\d|\.)+/gi,Y=/[-+=.]*\d+[.e\-+]*\d*[e\-\+]*\d*/g,Z=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Q=/[-+=.]*\d+(?:\.|e-|e)*\d*/gi,J=/\(([^()]+)\)/i,K=/[+-]=-?[\.\d]+/,$=/[#\-+.]*\b[a-z\d-=+%.]+/gi,tt={},et={},nt=function(t){return(et=qt(t,tt))&&hn},it=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},rt=function(t,e){return!e&&console.warn(t)},ot=function(t,e){return t&&(tt[t]=e)&&et&&(et[t]=e)||tt},at=function(){return 0},st={},lt=[],ct={},ut={},ht={},ft=30,dt=[],pt="",mt=function(t){var e,n,i=t[0];if(j(i)||z(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=dt.length;n--&&!dt[n].targetTest(i););e=dt[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new Oe(t[n],e)))||t.splice(n,1);return t},gt=function(t){return t._gsap||mt(ee(t))[0]._gsap},vt=function(t,e){var n=t[e];return z(n)?t[e]():k(n)&&t.getAttribute(e)||n},yt=function(t,e){return(t=t.split(",")).forEach(e)||t},xt=function(t){return Math.round(1e5*t)/1e5||0},bt=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},wt=function(t,e,n){var i,r=U(t[1]),o=(r?2:1)+(e<2?0:1),a=t[o];if(r&&(a.duration=t[1]),a.parent=n,e){for(i=a;n&&!("immediateRender"in i);)i=n.vars.defaults||{},n=V(n.vars.inherit)&&n.parent;a.immediateRender=V(i.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return a},_t=function(){var t,e,n=lt.length,i=lt.slice(0);for(ct={},lt.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Mt=function(t,e,n,i){lt.length&&_t(),t.render(e,n,i),lt.length&&_t()},St=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match($).length<2?e:t},Tt=function(t){return t},At=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},Et=function(t,e){for(var n in e)n in t||"duration"===n||"ease"===n||(t[n]=e[n])},qt=function(t,e){for(var n in e)t[n]=e[n];return t},Ct=function t(e,n){for(var i in n)e[i]=j(n[i])?t(e[i]||(e[i]={}),n[i]):n[i];return e},Pt=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},Rt=function(t){var e=t.parent||o,n=t.keyframes?Et:At;if(V(t.inherit))for(;e;)n(t,e.vars.defaults),e=e.parent||e._dp;return t},Lt=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,o=e._next;r?r._next=o:t[n]===e&&(t[n]=o),o?o._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},It=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},Dt=function(t){for(var e=t;e;)e._dirty=1,e=e.parent;return t},Ot=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Nt=function(t){return t._repeat?Ft(t._tTime,t=t.duration()+t._rDelay)*t:0},Ft=function(t,e){return(t/=e)&&~~t===t?~~t-1:~~t},Bt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},zt=function(t){return t._end=xt(t._start+(t._tDur/Math.abs(t._ts||t._rts||1e-8)||0))},Ut=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=xt(t._dp._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),zt(t),n._dirty||Dt(n)),t},kt=function(t,e){var n;if((e._time||e._initted&&!e._dur)&&(n=Bt(t.rawTime(),e),(!e._dur||Qt(0,e.totalDuration(),n)-e._tTime>1e-8)&&e.render(n,!0)),Dt(t)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},jt=function(t,e,n,i){return e.parent&&It(e),e._start=xt(n+e._delay),e._end=xt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),function(t,e,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var o,a=t[i];if(r)for(o=e[r];a&&a[r]>o;)a=a._prev;a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=a,e.parent=e._dp=t}(t,e,"_first","_last",t._sort?"_start":0),t._recent=e,i||kt(t,e),t},Vt=function(t,e){return(tt.ScrollTrigger||it("scrollTrigger",e))&&tt.ScrollTrigger.create(e,t)},Gt=function(t,e,n,i){return je(t,e),t._initted?!n&&t._pt&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&u!==_e.frame?(lt.push(t),t._lazy=[e,i],1):void 0:1},Ht=function(t,e,n){var i=t._repeat,r=xt(e)||0;return t._dur=r,t._tDur=i?i<0?1e10:xt(r*(i+1)+t._rDelay*i):r,t._time>r&&(t._time=r,t._tTime=Math.min(t._tTime,t._tDur)),!n&&Dt(t.parent),t.parent&&zt(t),t},Wt=function(t){return t instanceof Fe?Dt(t):Ht(t,t._dur)},Xt={_start:0,endTime:at},Yt=function t(e,n){var i,r,o=e.labels,a=e._recent||Xt,s=e.duration()>=1e8?a.endTime(!1):e._dur;return B(n)&&(isNaN(n)||n in o)?"<"===(i=n.charAt(0))||">"===i?("<"===i?a._start:a.endTime(a._repeat>=0))+(parseFloat(n.substr(1))||0):(i=n.indexOf("="))<0?(n in o||(o[n]=s),o[n]):(r=+(n.charAt(i-1)+n.substr(i+1)),i>1?t(e,n.substr(0,i-1))+r:s+r):null==n?s:+n},Zt=function(t,e){return t||0===t?e(t):e},Qt=function(t,e,n){return n<t?t:n>e?e:n},Jt=function(t){return(t+"").substr((parseFloat(t)+"").length)},Kt=[].slice,$t=function(t,e){return t&&j(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&j(t[0]))&&!t.nodeType&&t!==a},te=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var i;return B(t)&&!e||$t(t,1)?(i=n).push.apply(i,ee(t)):n.push(t)}))||n},ee=function(t,e){return!B(t)||e||!s&&Me()?W(t)?te(t,e):$t(t)?Kt.call(t,0):t?[t]:[]:Kt.call(l.querySelectorAll(t),0)},ne=function(t){return t.sort((function(){return.5-Math.random()}))},ie=function(t){if(z(t))return t;var e=j(t)?t:{each:t},n=Pe(e.ease),i=e.from||0,r=parseFloat(e.base)||0,o={},a=i>0&&i<1,s=isNaN(i)||a,l=e.axis,c=i,u=i;return B(i)?c=u={center:.5,edges:.5,end:1}[i]||0:!a&&s&&(c=i[0],u=i[1]),function(t,a,h){var f,d,p,m,g,v,y,x,b,w=(h||e).length,_=o[w];if(!_){if(!(b="auto"===e.grid?0:(e.grid||[1,1e8])[1])){for(y=-1e8;y<(y=h[b++].getBoundingClientRect().left)&&b<w;);b--}for(_=o[w]=[],f=s?Math.min(b,w)*c-.5:i%b,d=s?w*u/b-.5:i/b|0,y=0,x=1e8,v=0;v<w;v++)p=v%b-f,m=d-(v/b|0),_[v]=g=l?Math.abs("y"===l?m:p):O(p*p+m*m),g>y&&(y=g),g<x&&(x=g);"random"===i&&ne(_),_.max=y-x,_.min=x,_.v=w=(parseFloat(e.amount)||parseFloat(e.each)*(b>w?w-1:l?"y"===l?w/b:b:Math.max(b,w/b))||0)*("edges"===i?-1:1),_.b=w<0?r-w:r,_.u=Jt(e.amount||e.each)||0,n=n&&w<0?qe(n):n}return w=(_[t]-_.min)/_.max||0,xt(_.b+(n?n(w):w)*_.v)+_.u}},re=function(t){var e=t<1?Math.pow(10,(t+"").length-2):1;return function(n){return Math.floor(Math.round(parseFloat(n)/t)*t*e)/e+(U(n)?0:Jt(n))}},oe=function(t,e){var n,i,r=W(t);return!r&&j(t)&&(n=r=t.radius||1e8,t.values?(t=ee(t.values),(i=!U(t[0]))&&(n*=n)):t=re(t.increment)),Zt(e,r?z(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,o,a=parseFloat(i?e.x:e),s=parseFloat(i?e.y:0),l=1e8,c=0,u=t.length;u--;)(r=i?(r=t[u].x-a)*r+(o=t[u].y-s)*o:Math.abs(t[u]-a))<l&&(l=r,c=u);return c=!n||l<=n?t[c]:e,i||c===e||U(e)?c:c+Jt(e)}:re(t))},ae=function(t,e,n,i){return Zt(W(t)?!e:!0===n?!!(n=0):!i,(function(){return W(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t+Math.random()*(e-t))/n)*n*i)/i}))},se=function(t,e,n){return Zt(n,(function(n){return t[~~e(n)]}))},le=function(t){for(var e,n,i,r,o=0,a="";~(e=t.indexOf("random(",o));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?$:X),a+=t.substr(o,e-o)+ae(r?n:+n[0],+n[1],+n[2]||1e-5),o=i+1;return a+t.substr(o,t.length-o)},ce=function(t,e,n,i,r){var o=e-t,a=i-n;return Zt(r,(function(e){return n+((e-t)/o*a||0)}))},ue=function(t,e,n){var i,r,o,a=t.labels,s=1e8;for(i in a)(r=a[i]-e)<0==!!n&&r&&s>(r=Math.abs(r))&&(o=i,s=r);return o},he=function(t,e,n){var i,r,o=t.vars,a=o[e];if(a)return i=o[e+"Params"],r=o.callbackScope||t,n&&lt.length&&_t(),i?a.apply(r,i):a.call(r)},fe=function(t){return It(t),t.progress()<1&&he(t,"onInterrupt"),t},de=function(t){var e=(t=!t.name&&t.default||t).name,n=z(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:at,render:en,add:Ue,kill:rn,modifier:nn,rawVars:0},o={targetTest:0,get:0,getSetter:Je,aliases:{},register:0};if(Me(),t!==i){if(ut[e])return;At(i,At(Pt(t,r),o)),qt(i.prototype,qt(r,Pt(t,o))),ut[i.prop=e]=i,t.targetTest&&(dt.push(i),st[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}ot(e,i),t.register&&t.register(hn,i,sn)},pe={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},me=function(t,e,n){return 255*(6*(t=t<0?t+1:t>1?t-1:t)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)+.5|0},ge=function(t,e,n){var i,r,o,a,s,l,c,u,h,f,d=t?U(t)?[t>>16,t>>8&255,255&t]:0:pe.black;if(!d){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),pe[t])d=pe[t];else if("#"===t.charAt(0))4===t.length&&(i=t.charAt(1),r=t.charAt(2),o=t.charAt(3),t="#"+i+i+r+r+o+o),d=[(t=parseInt(t.substr(1),16))>>16,t>>8&255,255&t];else if("hsl"===t.substr(0,3))if(d=f=t.match(X),e){if(~t.indexOf("="))return d=t.match(Y),n&&d.length<4&&(d[3]=1),d}else a=+d[0]%360/360,s=+d[1]/100,i=2*(l=+d[2]/100)-(r=l<=.5?l*(s+1):l+s-l*s),d.length>3&&(d[3]*=1),d[0]=me(a+1/3,i,r),d[1]=me(a,i,r),d[2]=me(a-1/3,i,r);else d=t.match(X)||pe.transparent;d=d.map(Number)}return e&&!f&&(i=d[0]/255,r=d[1]/255,o=d[2]/255,l=((c=Math.max(i,r,o))+(u=Math.min(i,r,o)))/2,c===u?a=s=0:(h=c-u,s=l>.5?h/(2-c-u):h/(c+u),a=c===i?(r-o)/h+(r<o?6:0):c===r?(o-i)/h+2:(i-r)/h+4,a*=60),d[0]=~~(a+.5),d[1]=~~(100*s+.5),d[2]=~~(100*l+.5)),n&&d.length<4&&(d[3]=1),d},ve=function(t){var e=[],n=[],i=-1;return t.split(xe).forEach((function(t){var r=t.match(Z)||[];e.push.apply(e,r),n.push(i+=r.length+1)})),e.c=n,e},ye=function(t,e,n){var i,r,o,a,s="",l=(t+s).match(xe),c=e?"hsla(":"rgba(",u=0;if(!l)return t;if(l=l.map((function(t){return(t=ge(t,e,1))&&c+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(o=ve(t),(i=n.c).join(s)!==o.c.join(s)))for(a=(r=t.replace(xe,"1").split(Z)).length-1;u<a;u++)s+=r[u]+(~i.indexOf(u)?l.shift()||c+"0,0,0,0)":(o.length?o:l.length?l:n).shift());if(!r)for(a=(r=t.split(xe)).length-1;u<a;u++)s+=r[u]+l[u];return s+r[a]},xe=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(t in pe)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),be=/hsl[a]?\(/,we=function(t){var e,n=t.join(" ");if(xe.lastIndex=0,xe.test(n))return e=be.test(n),t[1]=ye(t[1],e),t[0]=ye(t[0],e,ve(t[1])),!0},_e=(v=Date.now,y=500,x=33,b=v(),w=b,M=_=1/240,T=function t(e){var n,i,r=v()-w,o=!0===e;r>y&&(b+=r-x),w+=r,g.time=(w-b)/1e3,((n=g.time-M)>0||o)&&(g.frame++,M+=n+(n>=_?.004:_-n),i=1),o||(d=p(t)),i&&S.forEach((function(t){return t(g.time,r,g.frame,e)}))},g={time:0,frame:0,tick:function(){T(!0)},wake:function(){c&&(!s&&G()&&(a=s=window,l=a.document||{},tt.gsap=hn,(a.gsapVersions||(a.gsapVersions=[])).push(hn.version),nt(et||a.GreenSockGlobals||!a.gsap&&a||{}),m=a.requestAnimationFrame),d&&g.sleep(),p=m||function(t){return setTimeout(t,1e3*(M-g.time)+1|0)},f=1,T(2))},sleep:function(){(m?a.cancelAnimationFrame:clearTimeout)(d),f=0,p=at},lagSmoothing:function(t,e){y=t||1e8,x=Math.min(e,y,0)},fps:function(t){_=1/(t||240),M=g.time+_},add:function(t){S.indexOf(t)<0&&S.push(t),Me()},remove:function(t){var e;~(e=S.indexOf(t))&&S.splice(e,1)},_listeners:S=[]}),Me=function(){return!f&&_e.wake()},Se={},Te=/^[\d.\-M][\d.\-,\s]/,Ae=/["']/g,Ee=function(t){for(var e,n,i,r={},o=t.substr(1,t.length-3).split(":"),a=o[0],s=1,l=o.length;s<l;s++)n=o[s],e=s!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[a]=isNaN(i)?i.replace(Ae,"").trim():+i,a=n.substr(e+1).trim();return r},qe=function(t){return function(e){return 1-t(1-e)}},Ce=function t(e,n){for(var i,r=e._first;r;)r instanceof Fe?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},Pe=function(t,e){return t&&(z(t)?t:Se[t]||function(t){var e=(t+"").split("("),n=Se[e[0]];return n&&e.length>1&&n.config?n.config.apply(null,~t.indexOf("{")?[Ee(e[1])]:J.exec(t)[1].split(",").map(St)):Se._CE&&Te.test(t)?Se._CE("",t):n}(t))||e},Re=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,o={easeIn:e,easeOut:n,easeInOut:i};return yt(t,(function(t){for(var e in Se[t]=tt[t]=o,Se[r=t.toLowerCase()]=n,o)Se[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Se[t+"."+e]=o[e]})),o},Le=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},Ie=function t(e,n,i){var r=n>=1?n:1,o=(i||(e?.3:.45))/(n<1?n:1),a=o/L*(Math.asin(1/r)||0),s=function(t){return 1===t?1:r*Math.pow(2,-10*t)*F((t-a)*o)+1},l="out"===e?s:"in"===e?function(t){return 1-s(1-t)}:Le(s);return o=L/o,l.config=function(n,i){return t(e,n,i)},l},De=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:Le(i);return r.config=function(n){return t(e,n)},r};yt("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;Re(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Se.Linear.easeNone=Se.none=Se.Linear.easeIn,Re("Elastic",Ie("in"),Ie("out"),Ie()),A=7.5625,q=1/(E=2.75),Re("Bounce",(function(t){return 1-C(1-t)}),C=function(t){return t<q?A*t*t:t<.7272727272727273?A*Math.pow(t-1.5/E,2)+.75:t<.9090909090909092?A*(t-=2.25/E)*t+.9375:A*Math.pow(t-2.625/E,2)+.984375}),Re("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),Re("Circ",(function(t){return-(O(1-t*t)-1)})),Re("Sine",(function(t){return 1===t?1:1-N(t*I)})),Re("Back",De("in"),De("out"),De()),Se.SteppedEase=Se.steps=tt.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*Qt(0,1-1e-8,t)|0)+r)*n}}},R.ease=Se["quad.out"],yt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return pt+=t+","+t+"Params,"}));var Oe=function(t,e){this.id=D++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:vt,this.set=e?e.getSetter:Je},Ne=function(){function t(t,e){var n=t.parent||o;this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ht(this,+t.duration,1),this.data=t.data,f||_e.wake(),n&&jt(n,this,e||0===e?e:n._time,1),t.reversed&&this.reverse(),t.paused&&this.paused(!0)}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){if(!arguments.length)return this._tDur;this._dirty=0;var e=this._time/this._dur||0;return Ht(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1)),this._tTime?Ut(this,e*t+Nt(this)):this},e.totalTime=function(t,e){if(Me(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Ut(this,t);n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&jt(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&1e-8===Math.abs(this._zTime)||!t&&!this._initted)&&(this._ts||(this._pTime=t),Mt(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+Nt(this))%this._dur||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+Nt(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?Ft(this._tTime,n)+1:1},e.timeScale=function(t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?Bt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,Ot(this.totalTime(Qt(-this._delay,this._tDur,e),!0))},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Me(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&(this._tTime-=1e-8)&&1e-8!==Math.abs(this._zTime)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&jt(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(V(t)?this.totalDuration():this.duration())/Math.abs(this._ts)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Bt(e.rawTime(t),this):this._tTime:this._tTime},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(e._ts||1),e=e._dp;return n},e.repeat=function(t){return arguments.length?(this._repeat=t,Wt(this)):this._repeat},e.repeatDelay=function(t){return arguments.length?(this._rDelay=t,Wt(this)):this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(Yt(this,t),V(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,V(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-1e-8))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise((function(n){var i=z(t)?t:Tt,r=function(){var t=e.then;e.then=null,z(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r}))},e.kill=function(){fe(this)},t}();At(Ne.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Fe=function(t){function e(e,n){var r;return void 0===e&&(e={}),(r=t.call(this,e,n)||this).labels={},r.smoothChildTiming=!!e.smoothChildTiming,r.autoRemoveChildren=!!e.autoRemoveChildren,r._sort=V(e.sortChildren),r.parent&&kt(r.parent,i(r)),e.scrollTrigger&&Vt(i(r),e.scrollTrigger),r}r(e,t);var n=e.prototype;return n.to=function(t,e,n){return new We(t,wt(arguments,0,this),Yt(this,U(e)?arguments[3]:n)),this},n.from=function(t,e,n){return new We(t,wt(arguments,1,this),Yt(this,U(e)?arguments[3]:n)),this},n.fromTo=function(t,e,n,i){return new We(t,wt(arguments,2,this),Yt(this,U(e)?arguments[4]:i)),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,Rt(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new We(t,e,Yt(this,n),1),this},n.call=function(t,e,n){return jt(this,We.delayedCall(0,t,e),Yt(this,n))},n.staggerTo=function(t,e,n,i,r,o,a){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=o,n.onCompleteParams=a,n.parent=this,new We(t,n,Yt(this,r)),this},n.staggerFrom=function(t,e,n,i,r,o,a){return n.runBackwards=1,Rt(n).immediateRender=V(n.immediateRender),this.staggerTo(t,e,n,i,r,o,a)},n.staggerFromTo=function(t,e,n,i,r,o,a,s){return i.startAt=n,Rt(i).immediateRender=V(i.immediateRender),this.staggerTo(t,e,i,r,o,a,s)},n.render=function(t,e,n){var i,r,a,s,l,c,u,h,f,d,p,m,g=this._time,v=this._dirty?this.totalDuration():this._tDur,y=this._dur,x=this!==o&&t>v-1e-8&&t>=0?v:t<1e-8?0:t,b=this._zTime<0!=t<0&&(this._initted||!y);if(x!==this._tTime||n||b){if(g!==this._time&&y&&(x+=this._time-g,t+=this._time-g),i=x,f=this._start,c=!(h=this._ts),b&&(y||(g=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat&&(p=this._yoyo,l=y+this._rDelay,((i=xt(x%l))>y||v===x)&&(i=y),(s=~~(x/l))&&s===x/l&&(i=y,s--),d=Ft(this._tTime,l),!g&&this._tTime&&d!==s&&(d=s),p&&1&s&&(i=y-i,m=1),s!==d&&!this._lock)){var w=p&&1&d,_=w===(p&&1&s);if(s<d&&(w=!w),g=w?0:y,this._lock=1,this.render(g||(m?0:xt(s*l)),e,!y)._lock=0,!e&&this.parent&&he(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),g!==this._time||c!==!this._ts)return this;if(_&&(this._lock=2,g=w?y+1e-4:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!c)return this;Ce(this,m)}if(this._hasPause&&!this._forcing&&this._lock<2&&(u=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if(!i._dur&&"isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if(!i._dur&&"isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,xt(g),xt(i)))&&(x-=i-(i=u._start)),this._tTime=x,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t),g||!i||e||he(this,"onStart"),i>=g&&t>=0)for(r=this._first;r;){if(a=r._next,(r._act||i>=r._start)&&r._ts&&u!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!c){u=0,a&&(x+=this._zTime=-1e-8);break}}r=a}else{r=this._last;for(var M=t<0?t:i;r;){if(a=r._prev,(r._act||M<=r._end)&&r._ts&&u!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(M-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(M-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!c){u=0,a&&(x+=this._zTime=M?-1e-8:1e-8);break}}r=a}}if(u&&!e&&(this.pause(),u.render(i>=g?0:-1e-8)._zTime=i>=g?1:-1,this._ts))return this._start=f,zt(this),this.render(t,e,n);this._onUpdate&&!e&&he(this,"onUpdate",!0),(x===v&&v>=this.totalDuration()||!x&&g)&&(f!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||((t||!y)&&(x===v&&this._ts>0||!x&&this._ts<0)&&It(this,1),e||t<0&&!g||!x&&!g||(he(this,x===v?"onComplete":"onReverseComplete",!0),this._prom&&!(x<v&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(U(e)||(e=Yt(this,e)),!(t instanceof Ne)){if(W(t))return t.forEach((function(t){return n.add(t,e)})),Dt(this);if(B(t))return this.addLabel(t,e);if(!z(t))return this;t=We.delayedCall(0,t)}return this!==t?jt(this,t,e):this},n.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-1e8);for(var r=[],o=this._first;o;)o._start>=i&&(o instanceof We?e&&r.push(o):(n&&r.push(o),t&&r.push.apply(r,o.getChildren(!0,e,n)))),o=o._next;return r},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return B(t)?this.removeLabel(t):z(t)?this.killTweensOf(t):(Lt(this,t),t===this._recent&&(this._recent=this._last),Dt(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=xt(_e.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=Yt(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var i=We.delayedCall(0,e||at,n);return i.data="isPause",this._hasPause=1,jt(this,i,Yt(this,t))},n.removePause=function(t){var e=this._first;for(t=Yt(this,t);e;)e._start===t&&"isPause"===e.data&&It(e),e=e._next},n.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)Be!==i[r]&&i[r].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,i=[],r=ee(t),o=this._first,a=U(e);o;)o instanceof We?bt(o._targets,r)&&(a?(!Be||o._initted&&o._ts)&&o.globalTime(0)<=e&&o.globalTime(o.totalDuration())>e:!e||o.isActive())&&i.push(o):(n=o.getTweensOf(r,e)).length&&i.push.apply(i,n),o=o._next;return i},n.tweenTo=function(t,e){e=e||{};var n=this,i=Yt(n,t),r=e,o=r.startAt,a=r.onStart,s=r.onStartParams,l=We.to(n,At(e,{ease:"none",lazy:!1,time:i,duration:e.duration||Math.abs((i-(o&&"time"in o?o.time:n._time))/n.timeScale())||1e-8,onStart:function(){n.pause();var t=e.duration||Math.abs((i-n._time)/n.timeScale());l._dur!==t&&Ht(l,t).render(l._time,!0,!0),a&&a.apply(l,s||[])}}));return l},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,At({startAt:{time:Yt(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),ue(this,Yt(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),ue(this,Yt(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+1e-8)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,o=this.labels;r;)r._start>=n&&(r._start+=t),r=r._next;if(e)for(i in o)o[i]>=n&&(o[i]+=t);return Dt(this)},n.invalidate=function(){var e=this._first;for(this._lock=0;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._time=this._tTime=this._pTime=0,t&&(this.labels={}),Dt(this)},n.totalDuration=function(t){var e,n,i,r,a=0,s=this,l=s._last,c=1e8;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(r=s.parent;l;)e=l._prev,l._dirty&&l.totalDuration(),(i=l._start)>c&&s._sort&&l._ts&&!s._lock?(s._lock=1,jt(s,l,i-l._delay,1)._lock=0):c=i,i<0&&l._ts&&(a-=i,(!r&&!s._dp||r&&r.smoothChildTiming)&&(s._start+=i/s._ts,s._time-=i,s._tTime-=i),s.shiftChildren(-i,!1,-Infinity),c=0),(n=zt(l))>a&&l._ts&&(a=n),l=e;Ht(s,s===o&&s._time>a?s._time:a,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(o._ts&&(Mt(o,Bt(t,o)),u=_e.frame),_e.frame>=ft){ft+=P.autoSleep||120;var e=o._first;if((!e||!e._ts)&&P.autoSleep&&_e._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||_e.sleep()}}},e}(Ne);At(Fe.prototype,{_lock:0,_hasPause:0,_forcing:0});var Be,ze=function(t,e,n,i,r,o,a){var s,l,c,u,h,f,d,p,m=new sn(this._pt,t,e,0,1,tn,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(d=~(i+="").indexOf("random("))&&(i=le(i)),o&&(o(p=[n,i],t,e),n=p[0],i=p[1]),l=n.match(Q)||[];s=Q.exec(i);)u=s[0],h=i.substring(g,s.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[v++]&&(f=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:h||1===v?h:",",s:f,c:"="===u.charAt(1)?parseFloat(u.substr(2))*("-"===u.charAt(0)?-1:1):parseFloat(u)-f,m:c&&c<4?Math.round:0},g=Q.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=a,(K.test(i)||d)&&(m.e=0),this._pt=m,m},Ue=function(t,e,n,i,r,o,a,s,l){z(i)&&(i=i(r||0,t,o));var c,u=t[e],h="get"!==n?n:z(u)?l?t[e.indexOf("set")||!z(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,f=z(u)?l?Ze:Ye:Xe;if(B(i)&&(~i.indexOf("random(")&&(i=le(i)),"="===i.charAt(1)&&(i=parseFloat(h)+parseFloat(i.substr(2))*("-"===i.charAt(0)?-1:1)+(Jt(h)||0))),h!==i)return isNaN(h*i)?(!u&&!(e in t)&&it(e,i),ze.call(this,t,e,h,i,f,s||P.stringFilter,l)):(c=new sn(this._pt,t,e,+h||0,i-(h||0),"boolean"==typeof u?$e:Ke,0,f),l&&(c.fp=l),a&&c.modifier(a,this,t),this._pt=c)},ke=function(t,e,n,i,r,o){var a,s,l,c;if(ut[t]&&!1!==(a=new ut[t]).init(r,a.rawVars?e[t]:function(t,e,n,i,r){if(z(t)&&(t=Ve(t,r,e,n,i)),!j(t)||t.style&&t.nodeType||W(t))return B(t)?Ve(t,r,e,n,i):t;var o,a={};for(o in t)a[o]=Ve(t[o],r,e,n,i);return a}(e[t],i,r,o,n),n,i,o)&&(n._pt=s=new sn(n._pt,r,t,0,1,a.render,a,0,a.priority),n!==h))for(l=n._ptLookup[n._targets.indexOf(r)],c=a._props.length;c--;)l[a._props[c]]=s;return a},je=function t(e,n){var i,r,a,s,l,c,u,h,f,d,p,m,g,v=e.vars,y=v.ease,x=v.startAt,b=v.immediateRender,w=v.lazy,_=v.onUpdate,M=v.onUpdateParams,S=v.callbackScope,T=v.runBackwards,A=v.yoyoEase,E=v.keyframes,q=v.autoRevert,C=e._dur,P=e._startAt,L=e._targets,I=e.parent,D=I&&"nested"===I.data?I.parent._targets:L,O="auto"===e._overwrite,N=e.timeline;if(N&&(!E||!y)&&(y="none"),e._ease=Pe(y,R.ease),e._yEase=A?qe(Pe(!0===A?y:A,R.ease)):0,A&&e._yoyo&&!e._repeat&&(A=e._yEase,e._yEase=e._ease,e._ease=A),!N){if(m=(h=L[0]?gt(L[0]).harness:0)&&v[h.prop],i=Pt(v,st),P&&P.render(-1,!0).kill(),x){if(It(e._startAt=We.set(L,At({data:"isStart",overwrite:!1,parent:I,immediateRender:!0,lazy:V(w),startAt:null,delay:0,onUpdate:_,onUpdateParams:M,callbackScope:S,stagger:0},x))),b)if(n>0)!q&&(e._startAt=0);else if(C&&!(n<0&&P))return void(e._zTime=n)}else if(T&&C)if(P)!q&&(e._startAt=0);else if(n&&(b=!1),a=At({overwrite:!1,data:"isFromStart",lazy:b&&V(w),immediateRender:b,stagger:0,parent:I},i),m&&(a[h.prop]=m),It(e._startAt=We.set(L,a)),b){if(!n)return}else t(e._startAt,1e-8);for(e._pt=0,w=C&&V(w)||w&&!C,r=0;r<L.length;r++){if(u=(l=L[r])._gsap||mt(L)[r]._gsap,e._ptLookup[r]=d={},ct[u.id]&&_t(),p=D===L?r:D.indexOf(l),h&&!1!==(f=new h).init(l,m||i,e,p,D)&&(e._pt=s=new sn(e._pt,l,f.name,0,1,f.render,f,0,f.priority),f._props.forEach((function(t){d[t]=s})),f.priority&&(c=1)),!h||m)for(a in i)ut[a]&&(f=ke(a,i,e,p,l,D))?f.priority&&(c=1):d[a]=s=Ue.call(e,l,a,"get",i[a],p,D,0,v.stringFilter);e._op&&e._op[r]&&e.kill(l,e._op[r]),O&&e._pt&&(Be=e,o.killTweensOf(l,d,e.globalTime(0)),g=!e.parent,Be=0),e._pt&&w&&(ct[u.id]=1)}c&&an(e),e._onInit&&e._onInit(e)}e._from=!N&&!!v.runBackwards,e._onUpdate=_,e._initted=(!e._op||e._pt)&&!g},Ve=function(t,e,n,i,r){return z(t)?t.call(e,n,i,r):B(t)&&~t.indexOf("random(")?le(t):t},Ge=pt+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",He=(Ge+",id,stagger,delay,duration,paused,scrollTrigger").split(","),We=function(t){function e(e,n,r,a){var s;"number"==typeof n&&(r.duration=n,n=r,r=null);var l,c,u,h,f,d,p,m,g=(s=t.call(this,a?n:Rt(n),r)||this).vars,v=g.duration,y=g.delay,x=g.immediateRender,b=g.stagger,w=g.overwrite,_=g.keyframes,M=g.defaults,S=g.scrollTrigger,T=g.yoyoEase,A=s.parent,E=(W(e)?U(e[0]):"length"in n)?[e]:ee(e);if(s._targets=E.length?mt(E):rt("GSAP target "+e+" not found. https://greensock.com",!P.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=w,_||b||H(v)||H(y)){if(n=s.vars,(l=s.timeline=new Fe({data:"nested",defaults:M||{}})).kill(),l.parent=i(s),_)At(l.vars.defaults,{ease:"none"}),_.forEach((function(t){return l.to(E,t,">")}));else{if(h=E.length,p=b?ie(b):at,j(b))for(f in b)~Ge.indexOf(f)&&(m||(m={}),m[f]=b[f]);for(c=0;c<h;c++){for(f in u={},n)He.indexOf(f)<0&&(u[f]=n[f]);u.stagger=0,T&&(u.yoyoEase=T),m&&qt(u,m),d=E[c],u.duration=+Ve(v,i(s),c,d,E),u.delay=(+Ve(y,i(s),c,d,E)||0)-s._delay,!b&&1===h&&u.delay&&(s._delay=y=u.delay,s._start+=y,u.delay=0),l.to(d,u,p(c,d,E))}l.duration()?v=y=0:s.timeline=0}v||s.duration(v=l.duration())}else s.timeline=0;return!0===w&&(Be=i(s),o.killTweensOf(E),Be=0),A&&kt(A,i(s)),(x||!v&&!_&&s._start===xt(A._time)&&V(x)&&function t(e){return!e||e._ts&&t(e.parent)}(i(s))&&"nested"!==A.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-y))),S&&Vt(i(s),S),s}r(e,t);var n=e.prototype;return n.render=function(t,e,n){var i,r,o,a,s,l,c,u,h,f=this._time,d=this._tDur,p=this._dur,m=t>d-1e-8&&t>=0?d:t<1e-8?0:t;if(p){if(m!==this._tTime||!t||n||this._startAt&&this._zTime<0!=t<0){if(i=m,u=this.timeline,this._repeat){if(a=p+this._rDelay,((i=xt(m%a))>p||d===m)&&(i=p),(o=~~(m/a))&&o===m/a&&(i=p,o--),(l=this._yoyo&&1&o)&&(h=this._yEase,i=p-i),s=Ft(this._tTime,a),i===f&&!n&&this._initted)return this;o!==s&&(u&&this._yEase&&Ce(u,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(xt(a*o),!0).invalidate()._lock=0))}if(!this._initted){if(Gt(this,t<0?t:i,n,e))return this._tTime=0,this;if(p!==this._dur)return this.render(t,e,n)}for(this._tTime=m,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(h||this._ease)(i/p),this._from&&(this.ratio=c=1-c),i&&!f&&!e&&he(this,"onStart"),r=this._pt;r;)r.r(c,r.d),r=r._next;u&&u.render(t<0?t:!i&&l?-1e-8:u._dur*c,e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(t<0&&this._startAt&&this._startAt.render(t,!0,n),he(this,"onUpdate")),this._repeat&&o!==s&&this.vars.onRepeat&&!e&&this.parent&&he(this,"onRepeat"),m!==this._tDur&&m||this._tTime!==m||(t<0&&this._startAt&&!this._onUpdate&&this._startAt.render(t,!0,!0),(t||!p)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&It(this,1),e||t<0&&!f||!m&&!f||(he(this,m===d?"onComplete":"onReverseComplete",!0),this._prom&&!(m<d&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var r,o,a=t.ratio,s=e<0||!e&&a&&!t._start&&t._zTime>1e-8&&!t._dp._lock||t._ts<0||t._dp._ts<0?0:1,l=t._rDelay,c=0;if(l&&t._repeat&&(c=Qt(0,t._tDur,e),Ft(c,l)!==(o=Ft(t._tTime,l))&&(a=1-s,t.vars.repeatRefresh&&t._initted&&t.invalidate())),t._initted||!Gt(t,e,i,n))if(s!==a||i||1e-8===t._zTime||!e&&t._zTime){for(o=t._zTime,t._zTime=e||(n?1e-8:0),n||(n=e&&!o),t.ratio=s,t._from&&(s=1-s),t._time=0,t._tTime=c,n||he(t,"onStart"),r=t._pt;r;)r.r(s,r.d),r=r._next;t._startAt&&e<0&&t._startAt.render(e,!0,!0),t._onUpdate&&!n&&he(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&he(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===s&&(s&&It(t,1),n||(he(t,s?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._act=this._lazy=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),t.prototype.invalidate.call(this)},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e)&&(this._lazy=0,this.parent))return fe(this);if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,Be&&!0!==Be.vars.overwrite)._first||fe(this),this.parent&&n!==this.timeline.totalDuration()&&Ht(this,this._dur*this.timeline._tDur/n),this}var i,r,o,a,s,l,c,u=this._targets,h=t?ee(t):u,f=this._ptLookup,d=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(u,h))return"all"===e&&(this._pt=0),fe(this);for(i=this._op=this._op||[],"all"!==e&&(B(e)&&(s={},yt(e,(function(t){return s[t]=1})),e=s),e=function(t,e){var n,i,r,o,a=t[0]?gt(t[0]).harness:0,s=a&&a.aliases;if(!s)return e;for(i in n=qt({},e),s)if(i in n)for(r=(o=s[i].split(",")).length;r--;)n[o[r]]=n[i];return n}(u,e)),c=u.length;c--;)if(~h.indexOf(u[c]))for(s in r=f[c],"all"===e?(i[c]=e,a=r,o={}):(o=i[c]=i[c]||{},a=e),a)(l=r&&r[s])&&("kill"in l.d&&!0!==l.d.kill(s)||Lt(this,l,"_pt"),delete r[s]),"all"!==o&&(o[s]=1);return this._initted&&!this._pt&&d&&fe(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,n){return new e(t,wt(arguments,1))},e.delayedCall=function(t,n,i,r){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},e.fromTo=function(t,n,i){return new e(t,wt(arguments,2))},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return o.killTweensOf(t,e,n)},e}(Ne);At(We.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),yt("staggerTo,staggerFrom,staggerFromTo",(function(t){We[t]=function(){var e=new Fe,n=Kt.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var Xe=function(t,e,n){return t[e]=n},Ye=function(t,e,n){return t[e](n)},Ze=function(t,e,n,i){return t[e](i.fp,n)},Qe=function(t,e,n){return t.setAttribute(e,n)},Je=function(t,e){return z(t[e])?Ye:k(t[e])&&t.setAttribute?Qe:Xe},Ke=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4,e)},$e=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},tn=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},en=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},nn=function(t,e,n,i){for(var r,o=this._pt;o;)r=o._next,o.p===i&&o.modifier(t,e,n),o=r},rn=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?Lt(this,i,"_pt"):i.dep||(e=1),i=n;return!e},on=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},an=function(t){for(var e,n,i,r,o=t._pt;o;){for(e=o._next,n=i;n&&n.pr>o.pr;)n=n._next;(o._prev=n?n._prev:r)?o._prev._next=o:i=o,(o._next=n)?n._prev=o:r=o,o=e}t._pt=i},sn=function(){function t(t,e,n,i,r,o,a,s,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=o||Ke,this.d=a||this,this.set=s||Xe,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=on,this.m=t,this.mt=n,this.tween=e},t}();yt(pt+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return st[t]=1})),tt.TweenMax=tt.TweenLite=We,tt.TimelineLite=tt.TimelineMax=Fe,o=new Fe({sortChildren:!1,defaults:R,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),P.stringFilter=we;var ln={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return de(t)}))},timeline:function(t){return new Fe(t)},getTweensOf:function(t,e){return o.getTweensOf(t,e)},getProperty:function(t,e,n,i){B(t)&&(t=ee(t)[0]);var r=gt(t||{}).get,o=n?Tt:St;return"native"===n&&(n=""),t?e?o((ut[e]&&ut[e].get||r)(t,e,n,i)):function(e,n,i){return o((ut[e]&&ut[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=ee(t)).length>1){var i=t.map((function(t){return hn.quickSetter(t,e,n)})),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var o=ut[e],a=gt(t),s=a.harness&&(a.harness.aliases||{})[e]||e,l=o?function(e){var i=new o;h._pt=0,i.init(t,n?e+n:e,h,0,[t]),i.render(1,i),h._pt&&en(1,h)}:a.set(t,s);return o?l:function(e){return l(t,s,n?e+n:e,a,1)}},isTweening:function(t){return o.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Pe(t.ease,R.ease)),Ct(R,t||{})},config:function(t){return Ct(P,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,o=t.extendTimeline;(i||"").split(",").forEach((function(t){return t&&!ut[t]&&!tt[t]&&rt(e+" effect requires "+t+" plugin.")})),ht[e]=function(t,e,i){return n(ee(t),At(e||{},r),i)},o&&(Fe.prototype[e]=function(t,n,i){return this.add(ht[e](t,j(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){Se[t]=Pe(e)},parseEase:function(t,e){return arguments.length?Pe(t,e):Se},getById:function(t){return o.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new Fe(t);for(r.smoothChildTiming=V(t.smoothChildTiming),o.remove(r),r._dp=0,r._time=r._tTime=o._time,n=o._first;n;)i=n._next,!e&&!n._dur&&n instanceof We&&n.vars.onComplete===n._targets[0]||jt(r,n,n._start-n._delay),n=i;return jt(o,r,0),r},utils:{wrap:function t(e,n,i){var r=n-e;return W(e)?se(e,t(0,e.length),n):Zt(i,(function(t){return(r+(t-e)%r)%r+e}))},wrapYoyo:function t(e,n,i){var r=n-e,o=2*r;return W(e)?se(e,t(0,e.length-1),n):Zt(i,(function(t){return e+((t=(o+(t-e)%o)%o||0)>r?o-t:t)}))},distribute:ie,random:ae,snap:oe,normalize:function(t,e,n){return ce(t,e,0,1,n)},getUnit:Jt,clamp:function(t,e,n){return Zt(n,(function(n){return Qt(t,e,n)}))},splitColor:ge,toArray:ee,mapRange:ce,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||Jt(n))}},interpolate:function t(e,n,i,r){var o=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!o){var a,s,l,c,u,h=B(e),f={};if(!0===i&&(r=1)&&(i=null),h)e={p:e},n={p:n};else if(W(e)&&!W(n)){for(l=[],c=e.length,u=c-2,s=1;s<c;s++)l.push(t(e[s-1],e[s]));c--,o=function(t){t*=c;var e=Math.min(u,~~t);return l[e](t-e)},i=n}else r||(e=qt(W(e)?[]:{},e));if(!l){for(a in n)Ue.call(f,e,a,"get",n[a]);o=function(t){return en(t,f)||(h?e.p:e)}}}return Zt(i,o)},shuffle:ne},install:nt,effects:ht,ticker:_e,updateRoot:Fe.updateRoot,plugins:ut,globalTimeline:o,core:{PropTween:sn,globals:ot,Tween:We,Timeline:Fe,Animation:Ne,getCache:gt,_removeLinkedListItem:Lt}};yt("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return ln[t]=We[t]})),_e.add(Fe.updateRoot),h=ln.to({},{duration:0});var cn=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},un=function(t,e){return{name:t,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(B(n)&&(i={},yt(n,(function(t){return i[t]=1})),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,o=t._targets;for(n in e)for(i=o.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=cn(r,n)),r&&r.modifier&&r.modifier(e[n],t,o[i],n))}(t,n)}}}},hn=ln.registerPlugin({name:"attr",init:function(t,e,n,i,r){var o,a;for(o in e)(a=this.add(t,"setAttribute",(t.getAttribute(o)||0)+"",e[o],i,r,0,0,o))&&(a.op=o),this._props.push(o)}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n])}},un("roundProps",re),un("modifiers"),un("snap",oe))||ln;We.version=Fe.version=hn.version="3.4.2",c=1,G()&&Me();Se.Power0,Se.Power1;var fn=Se.Power2;Se.Power3,Se.Power4,Se.Linear,Se.Quad,Se.Cubic,Se.Quart,Se.Quint,Se.Strong,Se.Elastic,Se.Back,Se.SteppedEase,Se.Bounce,Se.Sine,Se.Expo,Se.Circ},,function(t,e,n){(function(e){var r=n(5).components,o=["transform"],a=t.exports.entities={},s=t.exports.Entity=function(t,n){this.uuid=e.Math.generateUUID(),this.components=[],this.isEntity=!0,this.isPlaying=!1,this.isDestroyed=!1,this.enabled=!0,this.renderOrder=0,this.object3D=t||new e.Group,this.states=[],this.node=null,this.folded=!1,this.parent=null,this.children=[],this.name=n||(t?t.name:"Entity"),this.type="Entity";var i=this.proxy();return o.forEach(t=>{var e=new r[t](i);i.addComponent(e)}),i.object3D.entity=i,i};s.prototype={proxy:function(){return new Proxy(this,{get:function(t,e){return e in t?t[e]:t.object3D[e]},set:function(t,e,n){return e in t?t[e]=n:t.object3D[e]=n,!0}})},init:function(){for(key in this.components){var t=this.components[key];if(t.enabled&&!t.initialized){var e=t.init();if(null==e)return e;t.initialized=!0}}for(var n=0;n<this.children.length;n++)this.children[n].init();return this},lazyLoad:function(t,e){for(key in this.components){var n=this.components[key];n.enabled&&n.lazyLoad(t,e)}for(var i=0;i<this.children.length;i++)this.children[i].lazyLoad(t,e);return this},play:function(){for(key in this.components){var t=this.components[key];t.enabled&&t.play()}for(var e=0;e<this.children.length;e++)this.children[e].play();return this},update:function(t,e){if(this.enabled){var n,i,r;e=e||!0;for(i in this.components){var o=this.components[i];o.enabled&&o.update(t)}if(e)for(r=this.getChildEntities(),n=0;n<r.length;n++)r[n].enabled&&r[n].update(t)}},reload:function(t){if(this.enabled){var e,n,i;t=t||!0;for(i in this.components)this.components[i].reload();if(t)for(e=this.getChildEntities(),n=0;n<e.length;n++)e[n].reload();levent.trigger(this.parent,"child-reloaded",{child:this})}},getObject3D:function(){return this.object3D},setObject3D:function(t){this.object3D=t},addObject3D:function(t){this.object3D?this.object3D.getObjectById(t.uuid)||(t.entity=this,this.object3D.add(t),levent.trigger(TDS_RT,"object3d_added",{object:t})):this.setObject3D(t)},removeObject3D:function(t){this.object3D.remove(t),levent.trigger(TDS_RT,"object3d_removed",{obj:t})},add:function(t,n){return t instanceof e.Object3D?(this.object3D.add(t),this):(this.children.push(t),(void 0===n||n)&&t.object3D&&this.object3D.add(t.object3D),t.init(),t.parent=this,this)},addToParent:function(t){t&&t.add&&!this.attachedToParent&&(t.add(this),t.children.push(this),this.attachedToParent=!0)},removeFromParent:function(t){this.parent.remove(this),this.attachedToParent=!1,this.parent=null},remove:function(t){if(t instanceof e.Object3D)return this.object3D.remove(t),this;this.object3D.remove(t.object3D);let n=this.children.indexOf(t);return n>-1&&this.children.splice(n,1),levent.trigger(TDS_RT,"entity_removed",{obj:t}),this},traverse:function(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)},contains:function(t){return this.object3D.contains(t.object3D)},getChildEntities:function(){return this.children},createComponents:function(){},initComponents:function(){this.components.forEach(t=>{t.init()})},addComponent:function(t,e,n){if(this.hasComponent(t.type)&&t.singleTon)return this;if(t.entity=this,!0!==n){let e=t.init();if(null==e)return e;t.initialized=!0}t.attached(),this.components.push(t);var r=t.dependencies;if(r)for(i=0;i<r.length;i++);return void 0!==e&&!1!==e||levent.trigger(TDS_RT,"entity_component_added",{object:t}),this},hasComponent(t){for(var e=!1,n=0;n<this.components.length;n++){if(this.components[n].type==t){e=!0;break}}return e},getComponent(t){for(var e=0;e<this.components.length;e++){var n=this.components[e];if(n.type==t)return n}return null},removeComponent:function(t,e,n){var i,r=e||!0;if("string"==typeof t||t instanceof String?i=this.getComponent(t):t.isComponent&&(i=t),!i)return this;i.pause();let o=this.components.indexOf(i);return o>-1&&this.components.splice(o,1),i.detached(),r&&(i.destroy(),delete this.components[i]),void 0!==n&&!1!==n||levent.trigger(TDS_RT,"entity_component_removed",{object:t}),this},componentChanged:function(t){},play:function(){var t,e,n;if(!this.isPlaying&&this.hasLoaded){for(n in this.isPlaying=!0,this.components)this.components[n].play();for(t=this.getChildEntities(),e=0;e<t.length;e++)t[e].play();levent.trigger(TDS_RT,"play",{})}},pause:function(){var t,e,n;if(this.isPlaying){for(n in this.isPlaying=!1,this.components)this.components[n].pause();for(t=this.getChildEntities(),e=0;e<t.length;e++)t[e].pause();levent.trigger(TDS_RT,"pause",{})}},resize:function(t,e){this.components.forEach(n=>{n.resize(t,e)}),this.children.forEach(n=>{n.resize(t,e)})},onHover:function(){},onClicked:function(){},onPointerDown:function(){},onPointerUp:function(){},dispose:function(){var t;for(t in this.components){var e=this.components[t];e.dispose(),e.initialized=!1}this.children.forEach(t=>{t.dispose()}),levent.trigger(TDS_RT,"dispose",{})},destroy:function(){var t;for(t in this.components)this.components[t].destroy();this.children.forEach(t=>{t.destroy()}),levent.trigger(TDS_RT,"destroy",{})},addState:function(t){this.is(t)||this.states.push(t)},removeState:function(t){var e=this.states.indexOf(t);-1!==e&&this.states.splice(e,1)},is:function(t){return-1!==this.states.indexOf(t)},inspect:function(){},preStore:function(){},postStore:function(){},preRestore:function(){},postRestore:function(t){Object.assign(this,t.properties)},toJSON:function(t){var e={meta:t||{className:this.className,name:this.name,type:this.type,isEntity:!0},components:[],object:{}};return this.components.forEach(t=>{e.components.push(t.toJSON())}),this.preStore(),this.object3D&&(e.object={uuid:this.object3D.uuid}),e.object.children=[],this.children.forEach(t=>{e.object.children.push(t.toJSON())}),this.postStore(),e},fromJSON:function(t,e){var n=t.meta;n&&(this.name=n.name,this.type=n.type),this.preRestore();for(var i=t.components,o=0;o<i.length;o++){var l=i[o],c=l.meta.name;e&&l.object.uuid&&(d=e.object3D.getObjectByProperty("uuid",l.object.uuid));var u=new r[c](this,d);u.load(l,e),this.addComponent(u)}if(t.object.children)for(var h=0;h<t.object.children.length;h++){var f,d,p=t.object.children[h];p.object.uuid?(e&&p.object.uuid&&(d=e.object3D.getObjectByProperty("uuid",p.object.uuid)),f=p.meta.className?new a[p.meta.className](d):new s(d)):f=p.meta.className?new a[p.meta.className]:new s,f.parent=this,this.add(f.fromJSON(p,e))}return this.postRestore(t),this}},t.exports.registerEntity=function(t,e){return a[t]=e,e}}).call(this,n(0))},,,,function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(164);n(155);function r(){}try{r.fs=n(527)}catch(t){}r.isRemote=function(t){return t.startsWith("http")},r.readFile=function(t,e,n,i,r){fetch(t).then((function(t){return t.text()})).then((function(t){void 0!==n&&n(t)})).catch((function(t){void 0!==r&&r(t)}))},r.readFileJson=function(t,e,n,i){fetch(t).then((function(t){return t.json()})).then((function(t){void 0!==e&&e(t)})).catch((function(t){void 0!==i&&i(t)}))},r.readFileBlob=function(t,e,n,i){fetch(t).then((function(t){return t.blob()})).then((function(t){void 0!==e&&e(t)})).catch((function(t){void 0!==i&&i(t)}))},r.readFileArrayBuffer=function(t,e,n,i){fetch(t).then((function(t){return t.ok||TDS_RT.alert("HTTP error, status = "+t.status),t.arrayBuffer()})).then((function(t){void 0!==e&&e(t)})).catch((function(t){void 0!==i&&i(t)}))},r.readFileBase64=function(t,e,n,i,r){void 0===e&&(e=!1);var o=new XMLHttpRequest;return o.open("GET",t,!e),o.overrideMimeType("text/plain; charset=x-user-defined"),void 0!==n&&(o.onload=function(){n(Base64Utils.fromBinaryString(o.response))}),void 0!==i&&(o.onprogress=i),void 0!==r&&(o.onerror=r),o.send(null),!0===e?Base64Utils.fromBinaryString(o.response):null},r.writeFile=function(t,e,n,i){var r=new Blob([e],{type:"octet/stream"}),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(r),o.style.display="none",o.onclick=function(){document.body.removeChild(this)},document.body.appendChild(o),o.click(),void 0!==i&&i()},r.writeFileBase64=function(t,e,n,r){var o=i.a.fromBase64(Base64Utils.removeHeader(e)),a=new Blob([o]),s=document.createElement("a");s.download=t,s.href=window.URL.createObjectURL(a),s.onclick=function(){document.body.removeChild(this)},s.style.display="none",document.body.appendChild(s),s.click(),void 0!==r&&r()},r.writeFileArrayBuffer=function(t,e,n,i){var r=new Blob([e]),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(r),o.onclick=function(){document.body.removeChild(this)},o.style.display="none",document.body.appendChild(o),o.click(),void 0!==i&&i()},r.chooseFile=function(t,e,n,i){var r=document.createElement("input");r.type="file",r.style.display="none",document.body.appendChild(r),void 0!==e&&(r.accept=e),!0===i&&(r.multiple=!0),r.onchange=function(e){void 0!==t&&t(r.files),document.body.removeChild(r)},r.click()},r.chooseFileName=function(t,e,n){var i=prompt("Save As",void 0!==n?n:"file");null!==i&&(void 0===e||i.endsWith(e)||(i+=e),void 0!==t&&t(i))},r.copyFile=function(t,e){},r.makeDirectory=function(t){},r.getFilesDirectory=function(t){return[]},r.deleteFolder=function(t){},r.copyFolder=function(t,e){},r.fileExists=function(t){return!1},r.getFileName=function(t){if(void 0!==t){var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(e>n?e+1:n+1,t.lastIndexOf("."))}return""},r.getFileNameWithExtension=function(t){if(void 0!==t){var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(e>n?e+1:n+1,t.length)}return""},r.getNameWithoutExtension=function(t){return void 0!==t?t.substring(0,t.lastIndexOf(".")):""},r.getFilePath=function(t){if(void 0!==t){var e=t.lastIndexOf("\\"),n=t.lastIndexOf("/");return t.substring(0,e>n?e+1:n+1)}return""},r.getFileExtension=function(t){return void 0!==t?t.substring(t.lastIndexOf(".")+1,t.length).toLowerCase():""}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(32);function r(e,n,r,o,a,s,l,c,u,h){"string"==typeof e||e instanceof ArrayBuffer?this.img=new i.a(e):this.img=void 0===e?new i.a:e,t.Texture.call(this,document.createElement("img"),n,r,o,a,s,l,c,u,h);var f=this;if(this.name="texture",this.category="Image",this.disposed=!1,this.format=this.img.hasTransparency()?t.RGBAFormat:t.RGBFormat,this.image.crossOrigin="anonymous",this.image.src=this.img.data,this.image.onload=function(){f.needsUpdate=!0},this.image.onerror=function(){console.log("TDS: Failed to load image "+f.img.uuid+" data."),f.img.createSolidColor(),f.image.src=f.img.data,f.needsUpdate=!0},"gif"===this.img.encoding){this.generateMipmaps=!1,this.magFilter=t.LinearFilter,this.minFilter=t.LinearFilter,function t(){f.disposed||(f.needsUpdate=!0,requestAnimationFrame(t))}()}}r.prototype=Object.create(t.Texture.prototype),r.prototype.dispose=function(){t.Texture.prototype.dispose.call(this),this.disposed=!0},r.prototype.toJSON=function(e){var n=t.Texture.prototype.toJSON.call(this,e),i=this.img.toJSON(e);return i instanceof Promise?(n.image=this.img.uuid,e.images[this.img.uuid]=this.img):n.image=i.uuid,n}}).call(this,n(0))},,function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var i=n(81),r=n(3),o=n(17),a=n(12).Entity;function s(t){var e=a.call(this,t);return this.interval=3e3,this.intHandler=null,this.transitionMode=s.TRANSITION_FADEOUT,this.transitionSteps=60,this.rotateDirection=s.ROTATE_HORIZONTAL,this.arrowSize=.5,this.arrowLeft=this.arrowRight=null,this.transitionMode===s.TRANSITION_FADEOUT&&(this.interval=3e3/this.transitionSteps),e}s.ROTATE_HORIZONTAL=0,s.ROTATE_VERTICAL=1,s.TRANSITION_NONE=0,s.TRANSITION_FADEOUT=1,s.TRANSITION_PARTICLE=2,s.prototype=Object.create(a.prototype),s.prototype.init=function(){return this.setupInterval(),this},s.prototype.setupInterval=function(){clearInterval(this.intHandler),this.intHandler=setInterval(()=>{this.change()},this.interval)},s.prototype.changeInterval=function(t){var e=t||3e3;this.dispose(),this.transitionMode===s.TRANSITION_FADEOUT&&(this.interval=e/this.transitionSteps,this.setupInterval()),this.transitionMode===s.TRANSITION_NONE&&(this.interval=e,this.setupInterval()),this.transitionMode===s.TRANSITION_PARTICLE&&(clearInterval(this.intHandler),this.interval=e,this.setupTransitionMap())},s.prototype.change=function(){},s.prototype.forward=function(){},s.prototype.backward=function(){},s.prototype.addSlide=function(){},s.prototype.removeSlide=function(){},s.prototype.dispose=function(){clearInterval(this.intHandler)},s.prototype.destroy=function(){clearInterval(this.intHandler)},s.prototype.setTransitionMode=function(t){this.transitionMode=t||s.TRANSITION_NONE,this.changeInterval()},s.prototype.setupTransitionMap=function(){},s.prototype.resetTransitionMap=function(){},s.prototype.componentChanged=function(t){this.setupTransitionMap()},s.prototype.createNavigator=function(){var e=this,n=new t.Vector2,a=TDS_RT.program.getActiveScene(),s=TDS_RT.program.getActiveCanvas(a),l=TDS_RT.program.getActiveCamera(a),c=new t.Raycaster;if(s){var u,h,f=new o.a(r.a.get("ArrowLeft")),d=new o.a(r.a.get("ArrowRight"));if(this.arrowLeft)u=this.arrowLeft,h=this.arrowRight,u.material.map=f,h.material.map=d;else{(u=this.arrowLeft=new i.default(void 0,"ArrowLeft",this.arrowSize,this.arrowSize,.01)).material.map=f,u.material.color.setHex(16772608),u.material.transparent=!0,u.material.needsUpdate=!0,u.castShadow=u.receiveShadow=!1,(h=this.arrowRight=new i.default(void 0,"ArrowRight",this.arrowSize,this.arrowSize,.01)).material.map=d,h.material.color.setHex(16772608),h.material.transparent=!0,h.material.needsUpdate=!0,h.castShadow=u.receiveShadow=!1,u.position.copy(this.object3D.position),h.position.copy(this.object3D.position);var p=this.size;u.position.x-=p.x/2+2*this.arrowSize,u.position.y+=p.y/2+.5,h.position.x+=p.x/2+2*this.arrowSize,h.position.y+=p.y/2+.5,this.add(u),this.add(h)}this._mousedown=function(t){n.x=t.offsetX/s.width*2-1,n.y=-t.offsetY/s.height*2+1,c.setFromCamera(n,l);var i=c.intersectObjects([a],!0);if(i.length>0){var r=i[0].object;r==h&&e.change("forward",!0),r==u&&e.change("back",!0)}},s.addEventListener("mousedown",this._mousedown,!1)}},s.prototype.resetArrows=function(){this.traverse(t=>{"ArrowLeft"===t.name&&(this.arrowLeft=t,this.object3D.add(this.arrowLeft.object3D)),"ArrowRight"===t.name&&(this.arrowRight=t,this.object3D.add(this.arrowRight.object3D))})},s.prototype.showArrows=function(){this.arrowRight.visible=this.arrowLeft.visible=!0},s.prototype.hideArrows=function(){this.arrowRight.visible=this.arrowLeft.visible=!1},s.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.properties={interval:this.interval,arrowSize:this.arrowSize,transitionMode:this.transitionMode},t},s.prototype.fromJSON=function(t,e){return a.prototype.fromJSON.call(this,t,e),this}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(146),r=n(5).Component,o=n(5).registerComponent;function a(t,e,n,i){var o=r.call(this,t,e);return this.name="mesh",this.type="Mesh",this.glowing=!1,this.oldMaterial=null,e||this.createObject3D(n,i),o}a.prototype=Object.create(r.prototype),a.prototype.createObject3D=function(e,n){void 0===n&&(n=new t.MeshPhysicalMaterial({color:16777215})),this.object3D=new t.Mesh(e,n),this.object3D.receiveShadow=!0,this.object3D.castShadow=!0},a.prototype.dispose=function(){this.material&&void 0!==this.material.dispose&&this.material.dispose(),this.geometry&&this.geometry.dispose()},a.prototype.updateGeometry=function(t){null!==this.geometry&&(this.geometry.dispose(),null!==t&&(this.geometry=t))},a.prototype.getLayersString=function(){for(var t="",e=0;e<32;e++)0!=(Math.pow(2,e)&this.layers.mask)&&(t+=e.toString()+",");return t=t.substring(0,t.length-1)},a.prototype.setLayersFromString=function(t){var e=t.split(",");this.layers.disableAll(),e.forEach(t=>{this.layers.enable(t)})},a.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return t.properties={glowing:this.glowing,layers_mask:this.layers.mask},t},a.prototype.fromJSON=function(e,n){if(r.prototype.fromJSON.call(this,e,n),e.properties.glowing){this.glowing=e.properties.glowing;const n=new t.MeshBasicMaterial({color:this.material.color});this.material=n,this.receiveShadow=!1,this.layers.enable(i.default.BLOOM_LAYER)}return e.properties.layers_mask&&(this.layers.mask=e.properties.layers_mask),this},Object.defineProperty(a.prototype,"position",{set:function(t){this.object3D.position=t},get:function(){return this.object3D.position},enumerable:!0}),Object.defineProperty(a.prototype,"rotation",{set:function(t){this.object3D.rotation=t},get:function(){return this.object3D.rotation},enumerable:!0}),Object.defineProperty(a.prototype,"scale",{set:function(t){this.object3D.scale=t},get:function(){return this.object3D.scale},enumerable:!0}),e.default=o("mesh",a)}.call(this,n(0))},,,function(t,e,n){t.exports=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){e.glMatrix=n(1),e.mat2=n(2),e.mat2d=n(3),e.mat3=n(4),e.mat4=n(5),e.quat=n(6),e.vec2=n(9),e.vec3=n(7),e.vec4=n(8)},function(t,e){var n={EPSILON:1e-6};n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===this.Float32Array&&"SIMD"in this,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var i=Math.PI/180;n.toRadian=function(t){return t*i},n.equals=function(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=n},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,n,r){var o=new i.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o},set:function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},transpose:function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*o-r*i;return a?(a=1/a,t[0]=o*a,t[1]=-i*a,t[2]=-r*a,t[3]=n*a,t):null},adjoint:function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*s+o*l,t[1]=r*s+a*l,t[2]=i*c+o*u,t[3]=r*c+a*u,t}};r.mul=r.multiply,r.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*s,t[1]=r*l+a*s,t[2]=i*-s+o*l,t[3]=r*-s+a*l,t},r.scale=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1];return t[0]=i*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},r.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},r.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},r.sub=r.subtract,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=e[0],l=e[1],c=e[2],u=e[3];return Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},t.exports=r},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,n,r,o,a){var s=new i.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=o,s[5]=a,s},set:function(t,e,n,i,r,o,a){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=a,t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=n*o-i*r;return l?(l=1/l,t[0]=o*l,t[1]=-i*l,t[2]=-r*l,t[3]=n*l,t[4]=(r*s-o*a)*l,t[5]=(i*a-n*s)*l,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=n[0],u=n[1],h=n[2],f=n[3],d=n[4],p=n[5];return t[0]=i*c+o*u,t[1]=r*c+a*u,t[2]=i*h+o*f,t[3]=r*h+a*f,t[4]=i*d+o*p+s,t[5]=r*d+a*p+l,t}};r.mul=r.multiply,r.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=Math.sin(n),u=Math.cos(n);return t[0]=i*u+o*c,t[1]=r*u+a*c,t[2]=i*-c+o*u,t[3]=r*-c+a*u,t[4]=s,t[5]=l,t},r.scale=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=n[0],u=n[1];return t[0]=i*c,t[1]=r*c,t[2]=o*u,t[3]=a*u,t[4]=s,t[5]=l,t},r.translate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=n[0],u=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=i*c+o*u+s,t[5]=r*c+a*u+l,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=e[0],u=e[1],h=e[2],f=e[3],d=e[4],p=e[5];return Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-f)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-d)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(l-p)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},t.exports=r},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,n,r,o,a,s,l,c){var u=new i.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=o,u[5]=a,u[6]=s,u[7]=l,u[8]=c,u},set:function(t,e,n,i,r,o,a,s,l,c){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=c,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=u*a-s*c,f=-u*o+s*l,d=c*o-a*l,p=n*h+i*f+r*d;return p?(p=1/p,t[0]=h*p,t[1]=(-u*i+r*c)*p,t[2]=(s*i-r*a)*p,t[3]=f*p,t[4]=(u*n-r*l)*p,t[5]=(-s*n+r*o)*p,t[6]=d*p,t[7]=(-c*n+i*l)*p,t[8]=(a*n-i*o)*p,t):null},adjoint:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8];return t[0]=a*u-s*c,t[1]=r*c-i*u,t[2]=i*s-r*a,t[3]=s*l-o*u,t[4]=n*u-r*l,t[5]=r*o-n*s,t[6]=o*c-a*l,t[7]=i*l-n*c,t[8]=n*a-i*o,t},determinant:function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*(c*o-a*l)+n*(-c*r+a*s)+i*(l*r-o*s)},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],d=n[1],p=n[2],m=n[3],g=n[4],v=n[5],y=n[6],x=n[7],b=n[8];return t[0]=f*i+d*a+p*c,t[1]=f*r+d*s+p*u,t[2]=f*o+d*l+p*h,t[3]=m*i+g*a+v*c,t[4]=m*r+g*s+v*u,t[5]=m*o+g*l+v*h,t[6]=y*i+x*a+b*c,t[7]=y*r+x*s+b*u,t[8]=y*o+x*l+b*h,t}};r.mul=r.multiply,r.translate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=f*i+d*a+c,t[7]=f*r+d*s+u,t[8]=f*o+d*l+h,t},r.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*i+f*a,t[1]=d*r+f*s,t[2]=d*o+f*l,t[3]=d*a-f*i,t[4]=d*s-f*r,t[5]=d*l-f*o,t[6]=c,t[7]=u,t[8]=h,t},r.scale=function(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},r.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,l=r+r,c=n*a,u=i*a,h=i*s,f=r*a,d=r*s,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-h-p,t[3]=u-v,t[6]=f+g,t[1]=u+v,t[4]=1-c-p,t[7]=d-m,t[2]=f-g,t[5]=d+m,t[8]=1-c-h,t},r.normalFromMat4=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=n*s-i*a,x=n*l-r*a,b=n*c-o*a,w=i*l-r*s,_=i*c-o*s,M=r*c-o*l,S=u*m-h*p,T=u*g-f*p,A=u*v-d*p,E=h*g-f*m,q=h*v-d*m,C=f*v-d*g,P=y*C-x*q+b*E+w*A-_*T+M*S;return P?(P=1/P,t[0]=(s*C-l*q+c*E)*P,t[1]=(l*A-a*C-c*T)*P,t[2]=(a*q-s*A+c*S)*P,t[3]=(r*q-i*C-o*E)*P,t[4]=(n*C-r*A+o*T)*P,t[5]=(i*A-n*q-o*S)*P,t[6]=(m*M-g*_+v*w)*P,t[7]=(g*b-p*M-v*x)*P,t[8]=(p*_-m*b+v*y)*P,t):null},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=e[0],d=e[1],p=e[2],m=e[3],g=e[4],v=e[5],y=t[6],x=e[7],b=e[8];return Math.abs(n-f)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-g)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-v)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-y)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-x)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-b)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},t.exports=r},function(t,e,n){var i=n(1),r={scalar:{},SIMD:{},create:function(){var t=new i.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new i.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,n,r,o,a,s,l,c,u,h,f,d,p,m,g){var v=new i.ARRAY_TYPE(16);return v[0]=t,v[1]=e,v[2]=n,v[3]=r,v[4]=o,v[5]=a,v[6]=s,v[7]=l,v[8]=c,v[9]=u,v[10]=h,v[11]=f,v[12]=d,v[13]=p,v[14]=m,v[15]=g,v},set:function(t,e,n,i,r,o,a,s,l,c,u,h,f,d,p,m,g){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};r.scalar.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},r.SIMD.transpose=function(t,e){var n,i,r,o,a,s,l,c,u,h;return n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.shuffle(n,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,o,0,1,4,5),l=SIMD.Float32x4.shuffle(a,s,0,2,4,6),c=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,c),a=SIMD.Float32x4.shuffle(n,i,2,3,6,7),s=SIMD.Float32x4.shuffle(r,o,2,3,6,7),u=SIMD.Float32x4.shuffle(a,s,0,2,4,6),h=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,8,u),SIMD.Float32x4.store(t,12,h),t},r.transpose=i.USE_SIMD?r.SIMD.transpose:r.scalar.transpose,r.scalar.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=n*s-i*a,x=n*l-r*a,b=n*c-o*a,w=i*l-r*s,_=i*c-o*s,M=r*c-o*l,S=u*m-h*p,T=u*g-f*p,A=u*v-d*p,E=h*g-f*m,q=h*v-d*m,C=f*v-d*g,P=y*C-x*q+b*E+w*A-_*T+M*S;return P?(P=1/P,t[0]=(s*C-l*q+c*E)*P,t[1]=(r*q-i*C-o*E)*P,t[2]=(m*M-g*_+v*w)*P,t[3]=(f*_-h*M-d*w)*P,t[4]=(l*A-a*C-c*T)*P,t[5]=(n*C-r*A+o*T)*P,t[6]=(g*b-p*M-v*x)*P,t[7]=(u*M-f*b+d*x)*P,t[8]=(a*q-s*A+c*S)*P,t[9]=(i*A-n*q-o*S)*P,t[10]=(p*_-m*b+v*y)*P,t[11]=(h*b-u*_-d*y)*P,t[12]=(s*T-a*E-l*S)*P,t[13]=(n*E-i*T+r*S)*P,t[14]=(m*x-p*w-g*y)*P,t[15]=(u*w-h*x+f*y)*P,t):null},r.SIMD.invert=function(t,e){var n,i,r,o,a,s,l,c,u,h,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return a=SIMD.Float32x4.shuffle(f,d,0,1,4,5),i=SIMD.Float32x4.shuffle(p,m,0,1,4,5),n=SIMD.Float32x4.shuffle(a,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,a,1,3,5,7),a=SIMD.Float32x4.shuffle(f,d,2,3,6,7),o=SIMD.Float32x4.shuffle(p,m,2,3,6,7),r=SIMD.Float32x4.shuffle(a,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,a,1,3,5,7),a=SIMD.Float32x4.mul(r,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.mul(i,a),l=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),a=SIMD.Float32x4.mul(i,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),s),u=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,a)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),r=SIMD.Float32x4.swizzle(r,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),s),c=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(r,a)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),a=SIMD.Float32x4.mul(n,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),c),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),u),a=SIMD.Float32x4.swizzle(a,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),c),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.mul(n,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,a)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),c),a=SIMD.Float32x4.swizzle(a,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.mul(n,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,a)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),u),h=SIMD.Float32x4.mul(n,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),a=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(a,a))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(h,c)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(h,u)),t):null},r.invert=i.USE_SIMD?r.SIMD.invert:r.scalar.invert,r.scalar.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],v=e[15];return t[0]=s*(f*v-d*g)-h*(l*v-c*g)+m*(l*d-c*f),t[1]=-(i*(f*v-d*g)-h*(r*v-o*g)+m*(r*d-o*f)),t[2]=i*(l*v-c*g)-s*(r*v-o*g)+m*(r*c-o*l),t[3]=-(i*(l*d-c*f)-s*(r*d-o*f)+h*(r*c-o*l)),t[4]=-(a*(f*v-d*g)-u*(l*v-c*g)+p*(l*d-c*f)),t[5]=n*(f*v-d*g)-u*(r*v-o*g)+p*(r*d-o*f),t[6]=-(n*(l*v-c*g)-a*(r*v-o*g)+p*(r*c-o*l)),t[7]=n*(l*d-c*f)-a*(r*d-o*f)+u*(r*c-o*l),t[8]=a*(h*v-d*m)-u*(s*v-c*m)+p*(s*d-c*h),t[9]=-(n*(h*v-d*m)-u*(i*v-o*m)+p*(i*d-o*h)),t[10]=n*(s*v-c*m)-a*(i*v-o*m)+p*(i*c-o*s),t[11]=-(n*(s*d-c*h)-a*(i*d-o*h)+u*(i*c-o*s)),t[12]=-(a*(h*g-f*m)-u*(s*g-l*m)+p*(s*f-l*h)),t[13]=n*(h*g-f*m)-u*(i*g-r*m)+p*(i*f-r*h),t[14]=-(n*(s*g-l*m)-a*(i*g-r*m)+p*(i*l-r*s)),t[15]=n*(s*f-l*h)-a*(i*f-r*h)+u*(i*l-r*s),t},r.SIMD.adjoint=function(t,e){var n,i,r,o,a,s,l,c,u,h,f,d,p;return n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),u=SIMD.Float32x4.shuffle(n,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,o,0,1,4,5),a=SIMD.Float32x4.shuffle(u,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,u,1,3,5,7),u=SIMD.Float32x4.shuffle(n,i,2,3,6,7),c=SIMD.Float32x4.shuffle(r,o,2,3,6,7),l=SIMD.Float32x4.shuffle(u,c,0,2,4,6),c=SIMD.Float32x4.shuffle(c,u,1,3,5,7),u=SIMD.Float32x4.mul(l,c),u=SIMD.Float32x4.swizzle(u,1,0,3,2),h=SIMD.Float32x4.mul(s,u),f=SIMD.Float32x4.mul(a,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,u),h),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,u),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),u=SIMD.Float32x4.mul(s,l),u=SIMD.Float32x4.swizzle(u,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,u),h),p=SIMD.Float32x4.mul(a,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(c,u)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,u),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),u=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),c),u=SIMD.Float32x4.swizzle(u,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,u),h),d=SIMD.Float32x4.mul(a,u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(l,u)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,u),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),u=SIMD.Float32x4.mul(a,s),u=SIMD.Float32x4.swizzle(u,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,u),d),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,u),p),u=SIMD.Float32x4.swizzle(u,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,u),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,u)),u=SIMD.Float32x4.mul(a,c),u=SIMD.Float32x4.swizzle(u,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,u)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,u),d),u=SIMD.Float32x4.swizzle(u,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,u),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,u)),u=SIMD.Float32x4.mul(a,l),u=SIMD.Float32x4.swizzle(u,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,u),f),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,u)),u=SIMD.Float32x4.swizzle(u,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,u)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,u),p),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,p),t},r.adjoint=i.USE_SIMD?r.SIMD.adjoint:r.scalar.adjoint,r.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15];return(e*a-n*o)*(h*g-f*m)-(e*s-i*o)*(u*g-f*p)+(e*l-r*o)*(u*m-h*p)+(n*s-i*a)*(c*g-f*d)-(n*l-r*a)*(c*m-h*d)+(i*l-r*s)*(c*p-u*d)},r.SIMD.multiply=function(t,e,n){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(n,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),a))));SIMD.Float32x4.store(t,0,l);var c=SIMD.Float32x4.load(n,4),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),a))));SIMD.Float32x4.store(t,4,u);var h=SIMD.Float32x4.load(n,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(n,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));return SIMD.Float32x4.store(t,12,p),t},r.scalar.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],g=e[13],v=e[14],y=e[15],x=n[0],b=n[1],w=n[2],_=n[3];return t[0]=x*i+b*s+w*h+_*m,t[1]=x*r+b*l+w*f+_*g,t[2]=x*o+b*c+w*d+_*v,t[3]=x*a+b*u+w*p+_*y,x=n[4],b=n[5],w=n[6],_=n[7],t[4]=x*i+b*s+w*h+_*m,t[5]=x*r+b*l+w*f+_*g,t[6]=x*o+b*c+w*d+_*v,t[7]=x*a+b*u+w*p+_*y,x=n[8],b=n[9],w=n[10],_=n[11],t[8]=x*i+b*s+w*h+_*m,t[9]=x*r+b*l+w*f+_*g,t[10]=x*o+b*c+w*d+_*v,t[11]=x*a+b*u+w*p+_*y,x=n[12],b=n[13],w=n[14],_=n[15],t[12]=x*i+b*s+w*h+_*m,t[13]=x*r+b*l+w*f+_*g,t[14]=x*o+b*c+w*d+_*v,t[15]=x*a+b*u+w*p+_*y,t},r.multiply=i.USE_SIMD?r.SIMD.multiply:r.scalar.multiply,r.mul=r.multiply,r.scalar.translate=function(t,e,n){var i,r,o,a,s,l,c,u,h,f,d,p,m=n[0],g=n[1],v=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*v+e[12],t[13]=e[1]*m+e[5]*g+e[9]*v+e[13],t[14]=e[2]*m+e[6]*g+e[10]*v+e[14],t[15]=e[3]*m+e[7]*g+e[11]*v+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=i*m+s*g+h*v+e[12],t[13]=r*m+l*g+f*v+e[13],t[14]=o*m+c*g+d*v+e[14],t[15]=a*m+u*g+p*v+e[15]),t},r.SIMD.translate=function(t,e,n){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(n[0],n[1],n[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(i,SIMD.Float32x4.add(r,SIMD.Float32x4.add(o,a)));return SIMD.Float32x4.store(t,12,l),t},r.translate=i.USE_SIMD?r.SIMD.translate:r.scalar.translate,r.scalar.scale=function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.SIMD.scale=function(t,e,n){var i,r,o,a=SIMD.Float32x4(n[0],n[1],n[2],0);return i=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(a,0,0,0,0))),r=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.scale=i.USE_SIMD?r.SIMD.scale:r.scalar.scale,r.rotate=function(t,e,n,r){var o,a,s,l,c,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,T,A,E,q,C=r[0],P=r[1],R=r[2],L=Math.sqrt(C*C+P*P+R*R);return Math.abs(L)<i.EPSILON?null:(C*=L=1/L,P*=L,R*=L,o=Math.sin(n),s=1-(a=Math.cos(n)),l=e[0],c=e[1],u=e[2],h=e[3],f=e[4],d=e[5],p=e[6],m=e[7],g=e[8],v=e[9],y=e[10],x=e[11],b=C*C*s+a,w=P*C*s+R*o,_=R*C*s-P*o,M=C*P*s-R*o,S=P*P*s+a,T=R*P*s+C*o,A=C*R*s+P*o,E=P*R*s-C*o,q=R*R*s+a,t[0]=l*b+f*w+g*_,t[1]=c*b+d*w+v*_,t[2]=u*b+p*w+y*_,t[3]=h*b+m*w+x*_,t[4]=l*M+f*S+g*T,t[5]=c*M+d*S+v*T,t[6]=u*M+p*S+y*T,t[7]=h*M+m*S+x*T,t[8]=l*A+f*E+g*q,t[9]=c*A+d*E+v*q,t[10]=u*A+p*E+y*q,t[11]=h*A+m*E+x*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},r.scalar.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*i,t[5]=a*r+u*i,t[6]=s*r+h*i,t[7]=l*r+f*i,t[8]=c*r-o*i,t[9]=u*r-a*i,t[10]=h*r-s*i,t[11]=f*r-l*i,t},r.SIMD.rotateX=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,i))),t},r.rotateX=i.USE_SIMD?r.SIMD.rotateX:r.scalar.rotateX,r.scalar.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*i,t[1]=a*r-u*i,t[2]=s*r-h*i,t[3]=l*r-f*i,t[8]=o*i+c*r,t[9]=a*i+u*r,t[10]=s*i+h*r,t[11]=l*i+f*r,t},r.SIMD.rotateY=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,r))),t},r.rotateY=i.USE_SIMD?r.SIMD.rotateY:r.scalar.rotateY,r.scalar.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*i,t[1]=a*r+u*i,t[2]=s*r+h*i,t[3]=l*r+f*i,t[4]=c*r-o*i,t[5]=u*r-a*i,t[6]=h*r-s*i,t[7]=f*r-l*i,t},r.SIMD.rotateZ=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,i))),t},r.rotateZ=i.USE_SIMD?r.SIMD.rotateZ:r.scalar.rotateZ,r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e,n){var r,o,a,s=n[0],l=n[1],c=n[2],u=Math.sqrt(s*s+l*l+c*c);return Math.abs(u)<i.EPSILON?null:(s*=u=1/u,l*=u,c*=u,r=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=s*s*a+o,t[1]=l*s*a+c*r,t[2]=c*s*a-l*r,t[3]=0,t[4]=s*l*a-c*r,t[5]=l*l*a+o,t[6]=c*l*a+s*r,t[7]=0,t[8]=s*c*a+l*r,t[9]=l*c*a-s*r,t[10]=c*c*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},r.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotationTranslation=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=i+i,l=r+r,c=o+o,u=i*s,h=i*l,f=i*c,d=r*l,p=r*c,m=o*c,g=a*s,v=a*l,y=a*c;return t[0]=1-(d+m),t[1]=h+y,t[2]=f-v,t[3]=0,t[4]=h-y,t[5]=1-(u+m),t[6]=p+g,t[7]=0,t[8]=f+v,t[9]=p-g,t[10]=1-(u+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},r.getRotation=function(t,e){var n=e[0]+e[5]+e[10],i=0;return n>0?(i=2*Math.sqrt(n+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},r.fromRotationTranslationScale=function(t,e,n,i){var r=e[0],o=e[1],a=e[2],s=e[3],l=r+r,c=o+o,u=a+a,h=r*l,f=r*c,d=r*u,p=o*c,m=o*u,g=a*u,v=s*l,y=s*c,x=s*u,b=i[0],w=i[1],_=i[2];return t[0]=(1-(p+g))*b,t[1]=(f+x)*b,t[2]=(d-y)*b,t[3]=0,t[4]=(f-x)*w,t[5]=(1-(h+g))*w,t[6]=(m+v)*w,t[7]=0,t[8]=(d+y)*_,t[9]=(m-v)*_,t[10]=(1-(h+p))*_,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.fromRotationTranslationScaleOrigin=function(t,e,n,i,r){var o=e[0],a=e[1],s=e[2],l=e[3],c=o+o,u=a+a,h=s+s,f=o*c,d=o*u,p=o*h,m=a*u,g=a*h,v=s*h,y=l*c,x=l*u,b=l*h,w=i[0],_=i[1],M=i[2],S=r[0],T=r[1],A=r[2];return t[0]=(1-(m+v))*w,t[1]=(d+b)*w,t[2]=(p-x)*w,t[3]=0,t[4]=(d-b)*_,t[5]=(1-(f+v))*_,t[6]=(g+y)*_,t[7]=0,t[8]=(p+x)*M,t[9]=(g-y)*M,t[10]=(1-(f+m))*M,t[11]=0,t[12]=n[0]+S-(t[0]*S+t[4]*T+t[8]*A),t[13]=n[1]+T-(t[1]*S+t[5]*T+t[9]*A),t[14]=n[2]+A-(t[2]*S+t[6]*T+t[10]*A),t[15]=1,t},r.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,l=r+r,c=n*a,u=i*a,h=i*s,f=r*a,d=r*s,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-h-p,t[1]=u+v,t[2]=f-g,t[3]=0,t[4]=u-v,t[5]=1-c-p,t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.frustum=function(t,e,n,i,r,o,a){var s=1/(n-e),l=1/(r-i),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*l,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t},r.perspective=function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},r.perspectiveFromFieldOfView=function(t,e,n,i){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(r+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*l*.5,t[9]=(r-o)*c*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},r.ortho=function(t,e,n,i,r,o,a){var s=1/(e-n),l=1/(i-r),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(a+o)*c,t[15]=1,t},r.lookAt=function(t,e,n,o){var a,s,l,c,u,h,f,d,p,m,g=e[0],v=e[1],y=e[2],x=o[0],b=o[1],w=o[2],_=n[0],M=n[1],S=n[2];return Math.abs(g-_)<i.EPSILON&&Math.abs(v-M)<i.EPSILON&&Math.abs(y-S)<i.EPSILON?r.identity(t):(f=g-_,d=v-M,p=y-S,a=b*(p*=m=1/Math.sqrt(f*f+d*d+p*p))-w*(d*=m),s=w*(f*=m)-x*p,l=x*d-b*f,(m=Math.sqrt(a*a+s*s+l*l))?(a*=m=1/m,s*=m,l*=m):(a=0,s=0,l=0),c=d*l-p*s,u=p*a-f*l,h=f*s-d*a,(m=Math.sqrt(c*c+u*u+h*h))?(c*=m=1/m,u*=m,h*=m):(c=0,u=0,h=0),t[0]=a,t[1]=c,t[2]=f,t[3]=0,t[4]=s,t[5]=u,t[6]=d,t[7]=0,t[8]=l,t[9]=h,t[10]=p,t[11]=0,t[12]=-(a*g+s*v+l*y),t[13]=-(c*g+u*v+h*y),t[14]=-(f*g+d*v+p*y),t[15]=1,t)},r.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],v=t[14],y=t[15],x=e[0],b=e[1],w=e[2],_=e[3],M=e[4],S=e[5],T=e[6],A=e[7],E=e[8],q=e[9],C=e[10],P=e[11],R=e[12],L=e[13],I=e[14],D=e[15];return Math.abs(n-x)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(r-b)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(o-w)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-_)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-M)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-S)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-A)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-E)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-q)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(q))&&Math.abs(d-C)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-P)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-R)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-L)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(v-I)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(y-D)<=i.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},t.exports=r},function(t,e,n){var i=n(1),r=n(4),o=n(7),a=n(8),s={create:function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};s.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(i,r,a){var l=o.dot(r,a);return-.999999>l?(o.cross(t,e,r),o.length(t)<1e-6&&o.cross(t,n,r),o.normalize(t,t),s.setAxisAngle(i,t,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(o.cross(t,r,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+l,s.normalize(i,i))}}(),s.setAxes=function(){var t=r.create();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=a.clone,s.fromValues=a.fromValues,s.copy=a.copy,s.set=a.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t},s.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return 0!=i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},s.add=a.add,s.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+a*s+r*c-o*l,t[1]=r*u+a*l+o*s-i*c,t[2]=o*u+a*c+i*l-r*s,t[3]=a*u-i*s-r*l-o*c,t},s.mul=s.multiply,s.scale=a.scale,s.rotateX=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+a*s,t[1]=r*l+o*s,t[2]=o*l-r*s,t[3]=a*l-i*s,t},s.rotateY=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l-o*s,t[1]=r*l+a*s,t[2]=o*l+i*s,t[3]=a*l-r*s,t},s.rotateZ=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*s,t[1]=r*l-i*s,t[2]=o*l+a*s,t[3]=a*l-o*s,t},s.calculateW=function(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},s.dot=a.dot,s.lerp=a.lerp,s.slerp=function(t,e,n,i){var r,o,a,s,l,c=e[0],u=e[1],h=e[2],f=e[3],d=n[0],p=n[1],m=n[2],g=n[3];return 0>(o=c*d+u*p+h*m+f*g)&&(o=-o,d=-d,p=-p,m=-m,g=-g),1-o>1e-6?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-i)*r)/a,l=Math.sin(i*r)/a):(s=1-i,l=i),t[0]=s*c+l*d,t[1]=s*u+l*p,t[2]=s*h+l*m,t[3]=s*f+l*g,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(n,i,r,o,a,l){return s.slerp(t,i,a,l),s.slerp(e,r,o,l),s.slerp(n,t,e,2*l*(1-l)),n}}(),s.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-i*s,t[2]=-r*s,t[3]=o*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=a.length,s.len=s.length,s.squaredLength=a.squaredLength,s.sqrLen=s.squaredLength,s.normalize=a.normalize,s.fromMat3=function(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*a+a]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+r]+e[3*r+o])*n,t[a]=(e[3*a+r]+e[3*r+a])*n}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=a.exactEquals,s.equals=a.equals,t.exports=s},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,n){var r=new i.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}};r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.cross=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],l=n[2];return t[0]=r*l-o*s,t[1]=o*a-i*l,t[2]=i*s-r*a,t},r.lerp=function(t,e,n,i){var r=e[0],o=e[1],a=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t},r.hermite=function(t,e,n,i,r,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),u=a*(3-2*o);return t[0]=e[0]*s+n[0]*l+i[0]*c+r[0]*u,t[1]=e[1]*s+n[1]*l+i[1]*c+r[1]*u,t[2]=e[2]*s+n[2]*l+i[2]*c+r[2]*u,t},r.bezier=function(t,e,n,i,r,o){var a=1-o,s=a*a,l=o*o,c=s*a,u=3*o*s,h=3*l*a,f=l*o;return t[0]=e[0]*c+n[0]*u+i[0]*h+r[0]*f,t[1]=e[1]*c+n[1]*u+i[1]*h+r[1]*f,t[2]=e[2]*c+n[2]*u+i[2]*h+r[2]*f,t},r.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI,r=2*i.RANDOM()-1,o=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=r*e,t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[3]*i+n[7]*r+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/a,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/a,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/a,t},r.transformMat3=function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t},r.transformQuat=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*i+s*o-l*r,h=c*r+l*i-a*o,f=c*o+a*r-s*i,d=-a*i-s*r-l*o;return t[0]=u*c+d*-a+h*-l-f*-s,t[1]=h*c+d*-s+f*-a-u*-l,t[2]=f*c+d*-l+u*-s-h*-a,t},r.rotateX=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.rotateY=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.rotateZ=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,o,a){var s,l;for(n||(n=3),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),r.angle=function(t,e){var n=r.fromValues(t[0],t[1],t[2]),i=r.fromValues(e[0],e[1],e[2]);r.normalize(n,n),r.normalize(i,i);var o=r.dot(n,i);return o>1?0:Math.acos(o)},r.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=e[0],s=e[1],l=e[2];return Math.abs(n-a)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-l)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},t.exports=r},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,n,r){var o=new i.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}};r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+i*i+r*r+o*o)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+r*r+o*o},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=o*a),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},r.lerp=function(t,e,n,i){var r=e[0],o=e[1],a=e[2],s=e[3];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t[3]=s+i*(n[3]-s),t},r.random=function(t,e){return e=e||1,t[0]=i.RANDOM(),t[1]=i.RANDOM(),t[2]=i.RANDOM(),t[3]=i.RANDOM(),r.normalize(t,t),r.scale(t,t,e),t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t},r.transformQuat=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*i+s*o-l*r,h=c*r+l*i-a*o,f=c*o+a*r-s*i,d=-a*i-s*r-l*o;return t[0]=u*c+d*-a+h*-l-f*-s,t[1]=h*c+d*-s+f*-a-u*-l,t[2]=f*c+d*-l+u*-s-h*-a,t[3]=e[3],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,o,a){var s,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),r.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=e[0],l=e[1],c=e[2],u=e[3];return Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},t.exports=r},function(t,e,n){var i=n(1),r={create:function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},clone:function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var n=new i.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,n){return t[0]=e,t[1]=n,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}};r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},r.lerp=function(t,e,n,i){var r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t},r.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},r.transformMat2=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t},r.transformMat2d=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t},r.transformMat3=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,o,a){var s,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r.equals=function(t,e){var n=t[0],r=t[1],o=e[0],a=e[1];return Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},t.exports=r}])},,function(t,e,n){"use strict";n.r(e);var i="http://www.w3.org/1999/xhtml",r={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},o=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),r.hasOwnProperty(e)?{space:r[e],local:t}:t};function a(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===i&&e.documentElement.namespaceURI===i?e.createElement(t):e.createElementNS(n,t)}}function s(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var l=function(t){var e=o(t);return(e.local?s:a)(e)};function c(){}var u=function(t){return null==t?c:function(){return this.querySelector(t)}};function h(){return[]}var f=function(t){return null==t?h:function(){return this.querySelectorAll(t)}},d=function(t){return function(){return this.matches(t)}},p=function(t){return new Array(t.length)};function m(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}m.prototype={constructor:m,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function g(t,e,n,i,r,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new m(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function v(t,e,n,i,r,o,a){var s,l,c,u={},h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(d[s]=c="$"+a.call(l,l.__data__,s,e),c in u?r[s]=l:u[c]=l);for(s=0;s<f;++s)(l=u[c="$"+a.call(t,o[s],s,o)])?(i[s]=l,l.__data__=o[s],u[c]=null):n[s]=new m(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&u[d[s]]===l&&(r[s]=l)}function y(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function x(t){return function(){this.removeAttribute(t)}}function b(t){return function(){this.removeAttributeNS(t.space,t.local)}}function w(t,e){return function(){this.setAttribute(t,e)}}function _(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function M(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function S(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var T=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function A(t){return function(){this.style.removeProperty(t)}}function E(t,e,n){return function(){this.style.setProperty(t,e,n)}}function q(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function C(t,e){return t.style.getPropertyValue(e)||T(t).getComputedStyle(t,null).getPropertyValue(e)}function P(t){return function(){delete this[t]}}function R(t,e){return function(){this[t]=e}}function L(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function I(t){return t.trim().split(/^|\s+/)}function D(t){return t.classList||new O(t)}function O(t){this._node=t,this._names=I(t.getAttribute("class")||"")}function N(t,e){for(var n=D(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function F(t,e){for(var n=D(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function B(t){return function(){N(this,t)}}function z(t){return function(){F(this,t)}}function U(t,e){return function(){(e.apply(this,arguments)?N:F)(this,t)}}O.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function k(){this.textContent=""}function j(t){return function(){this.textContent=t}}function V(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function G(){this.innerHTML=""}function H(t){return function(){this.innerHTML=t}}function W(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function X(){this.nextSibling&&this.parentNode.appendChild(this)}function Y(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var t=this.parentNode;t&&t.removeChild(this)}function J(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function K(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var $={},tt=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||($={mouseenter:"mouseover",mouseleave:"mouseout"}));function et(t,e,n){return t=nt(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function nt(t,e,n){return function(i){var r=tt;tt=i;try{t.call(this,this.__data__,e,n)}finally{tt=r}}}function it(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function rt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?e.length=r:delete this.__on}}}function ot(t,e,n){var i=$.hasOwnProperty(t.type)?et:nt;return function(r,o,a){var s,l=this.__on,c=i(e,o,a);if(l)for(var u=0,h=l.length;u<h;++u)if((s=l[u]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=c,s.capture=n),void(s.value=e);this.addEventListener(t.type,c,n),s={type:t.type,name:t.name,value:e,listener:c,capture:n},l?l.push(s):this.__on=[s]}}function at(t,e,n,i){var r=tt;t.sourceEvent=tt,tt=t;try{return e.apply(n,i)}finally{tt=r}}function st(t,e,n){var i=T(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function lt(t,e){return function(){return st(this,t,e)}}function ct(t,e){return function(){return st(this,t,e.apply(this,arguments))}}var ut=[null];function ht(t,e){this._groups=t,this._parents=e}function ft(){return new ht([[document.documentElement]],ut)}ht.prototype=ft.prototype={constructor:ht,select:function(t){"function"!=typeof t&&(t=u(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,c=i[r]=new Array(l),h=0;h<l;++h)(o=s[h])&&(a=t.call(o,o.__data__,h,s))&&("__data__"in o&&(a.__data__=o.__data__),c[h]=a);return new ht(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=f(t));for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(i.push(t.call(a,a.__data__,c,s)),r.push(a));return new ht(i,r)},filter:function(t){"function"!=typeof t&&(t=d(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new ht(i,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),u=-1,this.each((function(t){p[++u]=t})),p;var n,i=e?v:g,r=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),u=0;u<a;++u){var h=r[u],f=o[u],d=f.length,p=t.call(h,h&&h.__data__,u,r),m=p.length,y=l[u]=new Array(m),x=s[u]=new Array(m);i(h,f,y,x,c[u]=new Array(d),p,e);for(var b,w,_=0,M=0;_<m;++_)if(b=y[_]){for(_>=M&&(M=_+1);!(w=x[M])&&++M<m;);b._next=w||null}}return(s=new ht(s,r))._enter=l,s._exit=c,s},enter:function(){return new ht(this._enter||this._groups.map(p),this._parents)},exit:function(){return new ht(this._exit||this._groups.map(p),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new ht(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=y);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,c=r[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new ht(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=o(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?b:x:"function"==typeof e?n.local?S:M:n.local?_:w)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?A:"function"==typeof e?q:E)(t,e,null==n?"":n)):C(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?P:"function"==typeof e?L:R)(t,e)):this.node()[t]},classed:function(t,e){var n=I(t+"");if(arguments.length<2){for(var i=D(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?U:e?B:z)(n,e))},text:function(t){return arguments.length?this.each(null==t?k:("function"==typeof t?V:j)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?W:H)(t)):this.node().innerHTML},raise:function(){return this.each(X)},lower:function(){return this.each(Y)},append:function(t){var e="function"==typeof t?t:l(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:l(t),i=null==e?Z:"function"==typeof e?e:u(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Q)},clone:function(t){return this.select(t?K:J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=it(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?ot:rt,null==n&&(n=!1),i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(i=0,l=s[c];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?ct:lt)(t,e))}};var dt=ft,pt=function(t){return"string"==typeof t?new ht([[document.querySelector(t)]],[document.documentElement]):new ht([[t]],ut)},mt=function(t){return pt(l(t).call(document.documentElement))},gt=0;function vt(){return new yt}function yt(){this._="@"+(++gt).toString(36)}yt.prototype=vt.prototype={constructor:yt,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var xt=function(){for(var t,e=tt;t=e.sourceEvent;)e=t;return e},bt=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]},wt=function(t){var e=xt();return e.changedTouches&&(e=e.changedTouches[0]),bt(t,e)},_t=function(t){return"string"==typeof t?new ht([document.querySelectorAll(t)],[document.documentElement]):new ht([null==t?[]:t],ut)},Mt=function(t,e,n){arguments.length<3&&(n=e,e=xt().changedTouches);for(var i,r=0,o=e?e.length:0;r<o;++r)if((i=e[r]).identifier===n)return bt(t,i);return null},St=function(t,e){null==e&&(e=xt().touches);for(var n=0,i=e?e.length:0,r=new Array(i);n<i;++n)r[n]=bt(t,e[n]);return r};n.d(e,"create",(function(){return mt})),n.d(e,"creator",(function(){return l})),n.d(e,"local",(function(){return vt})),n.d(e,"matcher",(function(){return d})),n.d(e,"mouse",(function(){return wt})),n.d(e,"namespace",(function(){return o})),n.d(e,"namespaces",(function(){return r})),n.d(e,"clientPoint",(function(){return bt})),n.d(e,"select",(function(){return pt})),n.d(e,"selectAll",(function(){return _t})),n.d(e,"selection",(function(){return dt})),n.d(e,"selector",(function(){return u})),n.d(e,"selectorAll",(function(){return f})),n.d(e,"style",(function(){return C})),n.d(e,"touch",(function(){return Mt})),n.d(e,"touches",(function(){return St})),n.d(e,"window",(function(){return T})),n.d(e,"event",(function(){return tt})),n.d(e,"customEvent",(function(){return at}))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return d}));var i=n(104),r=(n(55),n(90)),o=n(70),a=n(113),s=n(452),l=n(166),c=n(143),u=n(211),h=n(27),f=n(74);n(12).Entity;function d(e,n){this.object3D=new t.Object3D,this.type=this.object3D.type="Program",this.isProgram=!0,this.rm=window.RM=new i.a,this.matrixAutoUpdate=!1,this.mode=d.MODE_EDITING,this.name=void 0!==n?n:"program",this.description="",this.author="",this.version="0",this.lockPointer=!1,this.handlePixelRatio=!1,this.vr=!0,this.vrScale=1,this.ar=!1,this.rendererConfig=new r.a,this.defaultScene=null,this.defaultCamera=null,this.keyboard=null,this.mouse=null,this.renderer=null,this.scene=null,this.scenes=[],this.scenelist=new s.a,this.autoRotateScene=!1,this.sceneInterval=3e3,this.navigateInScene=!1,this.navHelpers=null,this.container=e,this.canvas=null,this.division=null,this.clock=new t.Clock}d.MODE_EDITING=0,d.MODE_RUNNING=1,d.MODE_STANDALONE=2,d.prototype.init=function(){if(this.rm.reset(),null===this.mouse&&(this.mouse=new h.a),null===this.keyboard&&(this.keyboard=new f.a),null!==this.defaultScene){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t].uuid===this.defaultScene){this.setScene(this.scenes[t]);break}}else if(this.scenes.length>0)if(this.setScene(this.scenes[0]),this.navigateInScene){for(t=0;t<this.scenes.length;t++)this.addNavigationArrowsInScene(this.scenes[t]);this.setupNavigationEventsHandler()}else if(this.scenes.length>0&&this.mode===d.MODE_RUNNING){var e=Editor.getRunner();this.addNavigationHelpers(e.element),this.applySimpleTransition()}this.clock.start()},d.prototype.next=function(){var t=this.scenelist,e=this.scene;!1!==t.next(e)&&this.setScene(t.next(e))},d.prototype.prev=function(){var t=this.scenelist,e=this.scene;!1!==t.prev(e)&&this.setScene(t.prev(e))},d.prototype.applySimpleTransition=function(){this.autoRotateScene?this.iSceneInterval=setInterval(()=>{this.next()},this.sceneInterval):clearInterval(this.iSceneInterval)},d.prototype.addNavigationHelpers=function(t){var e,n=this;t=t||document.body;this.navHelpers=document.createElement("div"),this.navHelpers.id="scene-nav-helpers",t.appendChild(this.navHelpers),this.navHelpers.style.overflow="hidden",this.navHelpers.style.position="absolute",this.navHelpers.style.zIndex="999",this.navHelpers.style.pointerEvents="none",e=document.createElement("div"),this.navHelpers.appendChild(e),e.className="overlay",e.style.backgroundColor="#ae81ff",e.style.width="100%",e.style.height="100%",e.style.opacity="0",e.style.pointerEvents="none";var i=document.createElement("div");this.navHelpers.appendChild(i),i.className="nav-dots",i.style.position="absolute",i.style.textAlign="center",i.style.left="50%",i.style.bottom="2%",i.style.transform="translate(-50%, 0%) matrix(1, 0, 0, 1, 0, 0)";for(var r=0;r<this.scenes.length;r++){var o=document.createElement("div");i.appendChild(o),o.className="nav-dot",o.style.width="12px",o.style.height="12px",o.style.borderRadius="100%",o.style.position="relative",o.style.backgroundColor="#fff",o.style.margin="12px 8px",o.style.float="left",o.style.transform=0==r?"matrix3d(1.5, 0.00366519, 0, 0, -0.00366519, 1.5, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)":"matrix(1, 0, 0, 1, 0, 0)"}function a(){var t=n.scenes.indexOf(n.scene),e=i.childNodes,r=Array.from(e),o=0;r.forEach(e=>{e.style.transform=o===t?"matrix3d(1.5, 0.00366519, 0, 0, -0.00366519, 1.5, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)":"matrix(1, 0, 0, 1, 0, 0)",o++})}var s=document.createElement("a");s.id="scene-nav-left",s.className="arrowPrev",this.navHelpers.appendChild(s),s.style.position="absolute",s.style.top="50%",s.style.left="2%",s.style.pointerEvents="all",s.addEventListener("click",()=>{n.prev(),e.classList.add("transition"),setTimeout(()=>{e.classList.remove("transition")},n.sceneInterval),a()});var l=document.createElement("a");l.id="scene-nav-right",l.className="arrowNext",this.navHelpers.appendChild(l),l.style.position="absolute",l.style.top="50%",l.style.right="2%",l.style.pointerEvents="all",l.addEventListener("click",()=>{n.next(),e.classList.add("transition"),setTimeout(()=>{e.classList.remove("transition")},n.sceneInterval),a()})},d.prototype.updateNavHelpers=function(){var t=this.canvas.getBoundingClientRect();this.navHelpers.style.top="0px",this.navHelpers.style.left="0px",this.navHelpers.style.width=t.right-t.left+"px",this.navHelpers.style.height=t.bottom-t.top+"px"},d.prototype.addNavigationArrowsInScene=function(t){if(!t.eNavLeft){var e=t.eNavLeft=new l.default("Arrow Left");e.position.set(-10,0,0),e.scale.set(.03,.03,.005),e.rotation.z=1.57,Editor.addObject(e,t,!1)}if(!t.eNavRight){var n=t.eNavRight=new l.default("Arrow Right");n.position.set(10,0,0),n.scale.set(.03,.03,.005),n.rotation.z=-1.57,Editor.addObject(n,t,!1)}},d.prototype.setupNavigationEventsHandler=function(){var e=this,n=this.scene,i=n.eNavLeft,r=n.eNavRight,o=new t.Vector2,a=new t.Raycaster;this._mousedown=function(t){o.x=t.offsetX/e.canvas.width*2-1,o.y=-t.offsetY/e.canvas.height*2+1,a.setFromCamera(o,n.camera);var s=a.intersectObjects([n],!0);if(s.length>0){var l=s[0].object;l==r&&e.next(),l==i&&e.prev()}},this.canvas&&this.canvas.addEventListener("mousedown",this._mousedown,!1)},d.prototype.setMouseKeyboard=function(t,e){this.mouse=t,this.keyboard=e},d.prototype.setRenderer=function(t,e){this.renderer=t,this.renderer.autoClear=!1,this.canvas=t.domElement,this.division=this.canvas.parentElement,e&&this.updateRenderer()},d.prototype.play=function(){null!==this.scene&&this.scene.play()},d.prototype.update=function(){var t=this.clock.getDelta();this.mouse.update(),this.keyboard.update(),null!==this.scene&&this.scene.update(t)},d.prototype.render=function(t){this.scene.render(t)},d.prototype.resize=function(t,e){null!==this.defaultCamera&&this.defaultCamera.resize(t,e),this.scenes.forEach(n=>{n.resize(t,e)}),null!==this.navHelpers&&this.updateNavHelpers()},d.prototype.updateRenderer=function(){null!==this.renderer&&(this.renderer.shadowMap.enabled=this.shadows,this.renderer.shadowMap.type=this.shadowsType,this.renderer.toneMapping=this.toneMapping,this.renderer.toneMappingExposure=this.toneMappingExposure,this.renderer.toneMappingWhitePoint=this.toneMappingWhitePoint)},d.prototype.isInRunner=function(){return"undefined"==typeof Editor||TDS_RT.program.mode===d.MODE_RUNNING&&Editor.getRunner().active},d.prototype.getScene=function(t){for(var e=t;null!==e.parent;)if((e=e.parent)instanceof o.a)return e;return null},d.prototype.getEntity=function(t){for(var e=t;null!==e.parent;){if(e.entity)return e.entity;e=e.parent}return null},d.prototype.setActiveScene=function(t){this.scene!==t&&this.scene.deactivate(),this.scene=t,this.scene.activate()},d.prototype.getActiveScene=function(){return this.scene?this.scene:this.scenes.length>0?this.scene[0]:null},d.prototype.getActiveCamera=function(t){if(void 0===t&&(t=this.getActiveScene()),TDS_RT.program.isInRunner())return t.camera?t.camera:t.defaultCamera;var e=Editor.getSceneEditor(t);return e?e.camera:null},d.prototype.getActiveCanvas=function(t){if(void 0===t&&(t=this.getActiveScene()),TDS_RT.program.isInRunner())return t.root.canvas;var e=Editor.getSceneEditor(t);return e?e.canvas.canvas:null},d.prototype.getActiveRenderer=function(t){if(void 0===t&&(t=this.getActiveScene()),TDS_RT.program.isInRunner())return t.root.renderer;var e=Editor.getSceneEditor(t);return e?e.canvas.renderer:null},d.prototype.arAvailable=function(){return this.ar&&u.a.arAvailable()},d.prototype.enterAR=function(){if(this.arAvailable()&&!this.xrEnabled){var t=this;c.a.enterAR(this.renderer,(function(){t.xrEnabled=!0}))}},d.prototype.exitAR=function(){this.xrEnabled&&(u.a.exitAR(this.renderer),this.xrEnabled=!1)},d.prototype.vrAvailable=function(){return this.vr&&c.a.vrAvailable()},d.prototype.enterVR=function(){if(this.vr){var t=this;c.a.enterVR(this.renderer,(function(){t.xrEnabled=!0}))}},d.prototype.exitVR=function(){this.vr&&(c.a.exitVR(this.renderer),this.xrEnabled=!1)},d.prototype.setScene=function(t){null!==this.scene&&this.scene.dispose(),t instanceof o.a?this.setActiveScene(t):"string"==typeof t&&(this.scene=this.getObjectByName(t)),null!==this.scene&&(null===this.scene.defaultCamera&&(this.scene.defaultCamera=this.defaultCamera),this.scene.init(),this.renderer&&this.canvas&&this.scene.lazyLoad(this.renderer,this.canvas))},d.prototype.remove=function(t){if(t instanceof o.a){t.destroy();var e=this.scenes.indexOf(t);e>-1&&this.scenes.splice(e,1),this.scenelist.remove(t),0===this.scenes.length&&(this.scene=null)}else console.warn("TDS: Trying to remove Object3D from program, only Scene objects allowed.")},d.prototype.add=function(t,e){t instanceof o.a?(t.program=t.parent=this,this.scenes.push(t),this.scenelist.append(t),!1!==e&&this.object3D.add(t.object3D),this.scenes.length>=1&&this.setScene(this.scenes[0])):console.warn("TDS: Only Scene objects allowed.")},d.prototype.setInitialScene=function(t){this.defaultScene=t.uuid},d.prototype.dispose=function(){void 0!==this._mousedown&&this.canvas.removeEventListener("mousedown",this._mousedown),null!==this.scene?this.scene.dispose():console.warn("TDS: Program dispose() scene is null.",this),this.rm.dispose()},d.prototype.destroy=function(){this.dispose(),this.scene.destroy()},d.prototype.toJSON=function(e){var n=this,i=t.Object3D.prototype.toJSON.call(this.object3D,e,(function(t,e){var i=n.textures;for(var r in i){var o=i[r];void 0===t.textures[o.uuid]&&(t.textures[o.uuid]=o.toJSON(t))}var a=n.materials;for(var r in a){var s=a[r];void 0===t.materials[s.uuid]&&(t.materials[s.uuid]=s.toJSON(t))}var l=n.fonts;for(var r in l){var c=l[r];void 0===t.fonts[c.uuid]&&(t.fonts[c.uuid]=c.toJSON(t))}var u=n.audio;for(var r in u){var h=u[r];void 0===t.audio[h.uuid]&&(t.audio[h.uuid]=h.toJSON(t))}var f=n.resources;for(var r in f){var d=f[r];void 0===t.resources[d.uuid]&&(t.resources[d.uuid]=d.toJSON(t))}}));null!==this.defaultScene&&(i.object.defaultScene=this.defaultScene);var r=[];return this.scenes.forEach(t=>{r.push(t.toJSON())}),i.object.scenes=r,i.object.author=this.author,i.object.description=this.description,i.object.version=this.version,i.object.lockPointer=this.lockPointer,i.object.handlePixelRatio=this.handlePixelRatio,i.object.ar=this.ar,i.object.vr=this.vr,i.object.vrScale=this.vrScale,i},d.prototype.fromJSON=function(t){var e=new a.a;this.object3D=e.parse(t);for(var n=t.object.scenes,i=0;i<n.length;i++){var r=n[i],s=new o.a(this,this.object3D.children[i]);s.fromJSON(r),this.add(s,!1)}return this},Object.defineProperty(d.prototype,"children",{get:function(){return this.scenes},set:function(t){this.scenes=t},enumerable:!0})}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(55),r=n(54);function o(e,n){this._keys=new Array(5),this._position=new t.Vector2(0,0),this._positionUpdated=!1,this._delta=new t.Vector2(0,0),this._wheel=0,this._wheelUpdated=!1,this._doubleClicked=new Array(5),this.keys=new Array(5),this.position=new t.Vector2(0,0),this.delta=new t.Vector2(0,0),this.wheel=0,this.doubleClicked=new Array(5),this.domElement=void 0!==e?e:window,this.canvas=null,this.events=new i.a;for(var a=0;a<5;a++)this._doubleClicked[a]=!1,this.doubleClicked[a]=!1,this._keys[a]=new r.a,this.keys[a]=new r.a;var s=this;if(void 0!==window.onmousewheel?this.events.add(this.domElement,"mousewheel",(function(t){s._wheel=t.deltaY,s._wheelUpdated=!0})):void 0!==window.addEventListener?this.events.add(this.domElement,"DOMMouseScroll",(function(t){s._wheel=30*t.detail,s._wheelUpdated=!0})):this.events.add(this.domElement,"wheel",(function(t){s._wheel=t.deltaY,s._wheelUpdated=!0})),void 0!==window.ontouchstart||navigator.msMaxTouchPoints>0){var l=new t.Vector2(0,0);this.events.add(this.domElement,"touchstart",(function(t){var e=t.touches[0];s.updatePosition(e.clientX,e.clientY,0,0),s.updateKey(o.LEFT,r.a.DOWN),l.set(e.clientX,e.clientY)})),this.events.add(this.domElement,"touchend",(function(t){s.updateKey(o.LEFT,r.a.UP)})),this.events.add(this.domElement,"touchcancel",(function(t){s.updateKey(o.LEFT,r.a.UP)})),this.events.add(document.body,"touchmove",(function(t){var e=t.touches[0];s.updatePosition(e.clientX,e.clientY,e.clientX-l.x,e.clientY-l.y),l.set(e.clientX,e.clientY)}))}this.events.add(this.domElement,"mousemove",(function(t){s.updatePosition(t.clientX,t.clientY,t.movementX,t.movementY)})),this.events.add(this.domElement,"mousedown",(function(t){s.updateKey(t.which-1,r.a.DOWN)})),this.events.add(this.domElement,"mouseup",(function(t){s.updateKey(t.which-1,r.a.UP)})),this.events.add(this.domElement,"dragstart",(function(t){s.updateKey(t.which-1,r.a.UP)})),this.events.add(this.domElement,"dblclick",(function(t){s._doubleClicked[t.which-1]=!0})),!0!==n&&this.create()}o.prototype=o,o.prototype.constructor=o,o.LEFT=0,o.MIDDLE=1,o.RIGHT=2,o.BACK=3,o.FORWARD=4,o.setCanvas=function(t){this.canvas=t,t.mouseInside=!1,t.addEventListener("mouseenter",(function(){this.mouseInside=!0})),t.addEventListener("mouseleave",(function(){this.mouseInside=!1}))},o.insideCanvas=function(){return null!==this.canvas&&this.canvas.mouseInside},o.setLock=function(t){null!==this.canvas&&(t?this.canvas.requestPointerLock?this.canvas.requestPointerLock():this.canvas.mozRequestPointerLock?this.canvas.mozRequestPointerLock():this.canvas.webkitRequestPointerLock&&this.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())},o.buttonPressed=function(t){return this.keys[t].pressed},o.buttonDoubleClicked=function(t){return this.doubleClicked[t]},o.buttonJustPressed=function(t){return this.keys[t].justPressed},o.buttonJustReleased=function(t){return this.keys[t].justReleased},o.updatePosition=function(t,e,n,i){if(null!==this.canvas){var r=this.canvas.getBoundingClientRect();t-=r.left,e-=r.top}this._position.set(t,e),this._delta.x+=n,this._delta.y+=i,this._positionUpdated=!0},o.updateKey=function(t,e){t>-1&&this._keys[t].update(e)},o.update=function(){for(var t=0;t<5;t++)this._keys[t].justPressed&&this.keys[t].justPressed&&(this._keys[t].justPressed=!1),this._keys[t].justReleased&&this.keys[t].justReleased&&(this._keys[t].justReleased=!1),this.keys[t].set(this._keys[t].justPressed,this._keys[t].pressed,this._keys[t].justReleased),!0===this._doubleClicked[t]?(this.doubleClicked[t]=!0,this._doubleClicked[t]=!1):this.doubleClicked[t]=!1;this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0,this._positionUpdated?(this.delta.copy(this._delta),this.position.copy(this._position),this._delta.set(0,0),this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)},o.create=function(){this.events.create()},o.dispose=function(){this.events.destroy()}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(16);function r(e,n){this.name=e,this.uuid=t.Math.generateUUID(),this.type=n,this.format="",this.encoding="",this.data=null,this.url=""}r.prototype.export=function(t){"base64"===this.format?i.a.writeFileBase64(t,this.data):"arraybuffer"===this.format?i.a.writeFileArrayBuffer(t,void 0!==this.arraybuffer?this.arraybuffer:this.data):"string"===this.format?i.a.writeFile(t,this.data):"json"===this.format?i.a.writeFile(t,JSON.stringify(this.data)):"url"===this.format&&i.a.writeFileArrayBuffer(t,i.a.readFileArrayBuffer(this.data))},r.prototype.toJSON=function(t){var e={};return e.name=this.name,e.uuid=this.uuid,e.type=this.type,e}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(53);function r(t){i.a.call(this),this.actions=t}r.prototype.apply=function(){for(var t=0;t<this.actions.length;t++)this.actions[t].apply()},r.prototype.revert=function(){for(var t=0;t<this.actions.length;t++)this.actions[t].revert()}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);function r(){this.uuid=i.Math.generateUUID(),this.type="Pass",this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(r.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")},dispose:function(){}}),r.FullScreenQuad=function(){var t=new i.OrthographicCamera(-1,1,1,-1,0,1),e=new i.PlaneBufferGeometry(2,2),n=function(t){this._mesh=new i.Mesh(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}(),r.prototype.toJSON=function(t){var e={};return e.uuid=this.uuid,e.type=this.type,e.clear=this.clear,e.enabled=this.enabled,e.needsSwap=this.needsSwap,e.renderToScreen=this.renderToScreen,e}},function(t,e,n){"use strict";var i={general:{autoUpdate:!1,theme:"dark",locale:"CN",historySize:20,immediateMode:!0,filePreviewSize:70,ignorePixelRatio:!0},editor:{angleFormat:0,snap:!1,snapAngle:.1,gridSize:100,gridSpacing:.5,gridEnabled:!0,gridFixed:!1,axisEnabled:!0,transformationSpace:"World",navigation:11,invertNavigation:!1,keyboardNavigation:!1,keyboardNavigationSpeed:.5,mouseLookSensitivity:.002,mouseMoveSpeed:.001,mouseWheelSensitivity:5e-4,cameraRotationCube:!0,cameraRotationCubeSize:120},render:new(n(90).a),code:{theme:"monokai",keymap:"sublime",fontSize:14,lineNumbers:!0,lineWrapping:!1,autoCloseBrackets:!0,highlightActiveLine:!1,showMatchesOnScrollbar:!0,dragFiles:!0,indentWithTabs:!0,tabSize:4,indentUnit:4},store:function(){var t=JSON.stringify({general:this.general,editor:this.editor,render:this.render,code:this.code,jslint:this.jslint},null,"\t");t.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1"),LocalStorage.set("config",t)},load:function(){try{var t=LocalStorage.get("config");for(var e in t)for(var n in void 0===this[e]&&(this[e]={}),t[e])this[e][n]=t[e][n]}catch(t){console.warn("TDS: Failed to load configuration file")}},CONFIG_FILE:"config.js",RADIANS:0,DEGREES:1,FIRST_PERSON:10,ORBIT:11,PLANAR_LEFT:12,PLANAR_RIGHT:13,PLANAR_FRONT:14,PLANAR_BACK:15,PLANAR_TOP:16,PLANAR_BOTTOM:17,FILE_PATH:"./assets/"};e.a=i,window.Settings=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n(69),r=n(67),o=(n(110),n(16)),a=n(28),s=n(164);function l(t,e){a.a.call(this,"image","Image"),this.width=-1,this.height=-1,void 0===e&&(e="png"),void 0!==t?t instanceof ArrayBuffer?this.loadArrayBufferData(t,e):i.a.isBase64(t)?(this.encoding=i.a.getFileFormat(t),this.format="base64",this.data=t):(this.encoding=o.a.getFileExtension(t),this.format="url",t.indexOf("http")<0&&(t=Config.STONE_URL+"/"+t),this.data=t):this.createSolidColor()}l.prototype=Object.create(a.a.prototype),l.prototype.createSolidColor=function(t){var e=document.createElement("canvas");e.width=1,e.height=1;var n=e.getContext("2d");n.fillStyle=void 0!==t?t:r.a.randomColor(),n.fillRect(0,0,1,1),this.data=e.toDataURL("image/png"),this.format="base64",this.encoding="png"},l.prototype.loadArrayBufferData=function(t,e){var n=new Uint8Array(t),i=new Blob([n],{type:"image/"+e});this.data=URL.createObjectURL(i),this.arraybuffer=t,this.encoding=e,this.format="arraybuffer"},l.prototype.hasTransparency=function(){return"png"===this.encoding||"gif"===this.encoding},l.prototype.compressJPEG=function(t){var e=document.createElement("img");e.src=this.data;var n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);var i=this;n.toBlob((function(t){var e=new FileReader;e.onload=function(){i.encoding="jpeg",i.format="arraybuffer",i.data=e.result},e.readAsArrayBuffer(t)}),"image/jpeg",void 0!==t?t:.7)},l.prototype.toJSON=function(t){var e=this;if(void 0!==t.images[this.uuid])return t.images[this.uuid];var n=a.a.prototype.toJSON.call(this,t);if("url"===this.format){var r=this.data;return r.indexOf("http")<0&&(r=Config.STONE_URL+"/"+r),fetch(r).then((function(t){return t.ok||TDS_RT.alert("HTTP error, status = "+t.status),t.arrayBuffer()})).then((function(i){return e.loadArrayBufferData(i,e.encoding),n.width=e.width,n.height=e.height,n.encoding=e.encoding,t.images[e.uuid]=n,n})).catch((function(t){console.log(t)}))}return"arraybuffer"===this.format?(n.format=this.format,n.data=this.arraybuffer):"base64"===this.format?(n.format="arraybuffer",n.data=s.a.fromBase64(i.a.removeHeader(this.data))):(n.format=this.format,n.data=this.data),t.images[this.uuid]=n,n},l.fileIsImage=function(t){return void 0!==t&&(!!t.type.startsWith("image")||((t=t.name.toLocaleLowerCase()).endsWith("tga")||t.endsWith("dds")||t.endsWith("pvr")||t.endsWith("ktx")||t.endsWith("basis")||t.endsWith("hdr")))}},,function(t,e,n){"use strict";(function(t){var i=n(94),r=n(113),o=(n(79),n(49)),a=n(5).Component,s=n(5).registerComponent;function l(t,e,n,i){var r=a.call(this,t,e);return this.name="particle",this.type="ParticleEmitter",e||this.createObject3D(n,i),r}l.valueOverLifetimeLength=4,l.prototype=Object.create(a.prototype),l.defaultEmitter={particleCount:200,velocity:{value:new t.Vector3(0,0,0),spread:new t.Vector3(3,3,3)},acceleration:{value:new t.Vector3(0,0,0),spread:new t.Vector3(0,0,0)},size:{value:[.8,.5,.3,.1]},color:{value:[new t.Color(1,.36,.06),new t.Color(.09,.04,1),new t.Color(1,.05,.08),new t.Color(1,1,1)]}},l.flameEmitter={particleCount:200,maxAge:{value:.3,spread:0},velocity:{value:new t.Vector3(0,5,0),spread:new t.Vector3(.1,0,.1)},acceleration:{value:new t.Vector3(0,.1,0),spread:new t.Vector3(0,0,0)},size:{value:[.2,.6,.5,.1]},opacity:{value:[.5,.9,.8,.3]},color:{value:[new t.Color(1,.8,.06),new t.Color(.9,.6,.01),new t.Color(.8,.5,.08),new t.Color(.5,.1,.5)]}},l.dropEmitter={particleCount:200,maxAge:{value:2,spread:1.5},wiggle:{value:0,spread:1},position:{value:new t.Vector3(0,5,0),spread:new t.Vector3(10,0,10)},rotation:{value:[0,0,0,0],spread:[.3,.4,.5,.5]},velocity:{value:new t.Vector3(0,-1,0),spread:new t.Vector3(3,0,3)},acceleration:{value:new t.Vector3(0,-1,0),spread:new t.Vector3(0,0,0)},size:{value:[0,0,0,0],spread:[.3,.4,.5,.5]},opacity:{value:[.5,.9,.8,.3]},color:{value:[new t.Color(.9,.9,.9),new t.Color(.95,.95,.95),new t.Color(1,1,1),new t.Color(1,1,1)]}},l.fountainEmitter={particleCount:1e3,velocity:{value:new t.Vector3(0,5,0),spread:new t.Vector3(3,3,3)},acceleration:{value:new t.Vector3(0,-2,0),spread:new t.Vector3(0,0,0)},size:{value:[.07,.05,.03,.01],spread:[0,0,0,0]},color:{value:[new t.Color(.9,.9,.9),new t.Color(.95,.95,.95),new t.Color(1,1,1),new t.Color(1,1,1)]}},l.fireworksEmitter={particleCount:1e3,position:{value:new t.Vector3(0,5,0),spread:new t.Vector3(0,0,0)},velocity:{value:new t.Vector3(0,-1,0),spread:new t.Vector3(5,5,5)},acceleration:{value:new t.Vector3(0,-2,0),spread:new t.Vector3(0,0,0)},size:{value:[.8,.5,.3,.1]},color:{value:[new t.Color(1,.36,.06),new t.Color(.09,.04,1),new t.Color(1,.05,.08),new t.Color(1,1,1)]}},l.prototype.createObject3D=function(t,e){return this.object3D=new i.default(t,e),this.object3D.name="particle",this},l.prototype.reload=function(){this.dispose();var t=(new r.a).parse(this.object3D.toJSON());this.group=t.group,this.emitter=t.emitter,this.geometry=this.group.geometry,this.material=this.group.material},l.prototype.dispose=function(){this.group.dispose(),t.Object3D.prototype.dispose.call(this)},l.prototype.toJSON=function(e){var n=this.material,i=this.geometry;this.material=void 0,this.geometry=void 0;var r=this.group.texture,o=t.Object3D.prototype.toJSON.call(this,e,(function(t,e){r=r.toJSON(t)}));return this.material=n,this.geometry=i,o.meta={name:this.name,isComponent:!0},o.object.group=this.group.toJSON(e),o.object.emitter=this.emitter.toJSON(e),o},l.prototype.fromJSON=function(t){this.emitter.type===o.a.MESH&&this.reload()},e.a=s("particle",l)}).call(this,n(0))},,,,,function(t,e,n){"use strict";var i={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D textureSampler;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min(max(1.0 - sign(x - y), 0.0), 1.0);","}","float when_eq(float x, float y) {","    return 1.0 - abs(sign(x - y));","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor(in float hex) {","   vec3 c = vec3(0.0);","   float r = mod((hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);","   float g = mod((hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);","   float b = mod(hex, PACKED_COLOR_SIZE);","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis(in float hex) {","   vec3 c = vec3(0.0);","   float r = mod((hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);","   float g = mod((hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE);","   float b = mod(hex, PACKED_COLOR_SIZE);","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3(2.0);","   c -= vec3(1.0);","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime(in float positionInTime, in vec4 attr) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float(VALUE_OVER_LIFETIME_LENGTH - 1);","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[0] * when_eq(deltaAge, 0.0);","","    for(int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i) {","       fIndex = float(i);","       shouldApplyValue = and(when_gt(deltaAge, fIndex), when_le(deltaAge, fIndex + 1.0));","       value += shouldApplyValue * mix(attr[i], attr[i + 1], deltaAge - fIndex);","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime(in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4) {","    vec3 value = vec3(0.0);","    value.x = getFloatOverLifetime(positionInTime, vec4(color1.x, color2.x, color3.x, color4.x));","    value.y = getFloatOverLifetime(positionInTime, vec4(color1.y, color2.y, color3.y, color4.y));","    value.z = getFloatOverLifetime(positionInTime, vec4(color1.z, color2.z, color3.z, color4.z));","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition(in float age) {","   return modelViewMatrix * vec4(position, 1.0);","}","vec3 getVelocity(in float age) {","   return velocity * age;","}","vec3 getAcceleration(in float age) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix(in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation(in vec3 pos, in float positionInTime) {","      if(rotation.y == 0.0) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis(rotation.x);","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq(rotation.z, 0.0) * rotation.y;","      angle += when_gt(rotation.z, 0.0) * mix(0.0, rotation.y, positionInTime);","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix(axis, angle);","      return center - vec3(rotationMatrix * vec4(translated, 0.0));","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos(-vAngle);","       float s = sin(-vAngle);","       vUv = vec2(c * x + s * y + 0.5, c * y - s * x + 0.5);","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D(textureSampler, vUv);"].join("\n")};e.a=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(69),r=(n(67),n(110),n(16)),o=n(28);function a(t,e){o.a.call(this,"video","Video"),void 0!==t&&(t instanceof ArrayBuffer?this.loadArrayBufferData(t,e):i.a.isBase64(t)?(this.encoding=i.a.getFileFormat(t),this.format="base64",this.data=t):this.loadArrayBufferData(r.a.readFileArrayBuffer(t),r.a.getFileExtension(t)))}a.prototype=Object.create(o.a.prototype),a.fileIsVideo=function(t){return!(void 0===t||!t.type.startsWith("video"))},a.prototype.loadArrayBufferData=function(t,e){var n=new Uint8Array(t),i=new Blob([n],{type:"video/"+e});this.data=URL.createObjectURL(i),this.arraybuffer=t,this.encoding=e,this.format="arraybuffer"},a.prototype.toJSON=function(t){if(void 0!==t.videos[this.uuid])return t.videos[this.uuid];var e=o.a.prototype.toJSON.call(this,t);return e.encoding=this.encoding,"arraybuffer"===this.format?(e.format=this.format,e.data=this.arraybuffer):"base64"===this.format?(e.format="arraybuffer",e.data=ArraybufferUtils.fromBase64(i.a.removeHeader(this.data))):(e.format=this.format,e.data=this.data),t.videos[this.uuid]=e,e}},,,function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);function r(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(r.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),r.FullScreenQuad=function(){var t=new i.OrthographicCamera(-1,1,1,-1,0,1),e=new i.PlaneBufferGeometry(2,2),n=function(t){this._mesh=new i.Mesh(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}()},function(t,e,n){var i=n(184),r=n(511),o=n(513),a=n(185),s=n(514),l=n(236),c=i("utils:warn");t.exports.levent=l,t.exports.bind=n(515),t.exports.coordinates=n(516),t.exports.debug=i,t.exports.device=o,t.exports.objectPool=s,t.exports.split=n(517).split,t.exports.styleParser=n(518),t.exports.checkHeadsetConnected=function(){return c("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),o.checkHeadsetConnected(arguments)},t.exports.isGearVR=t.exports.device.isGearVR=function(){c("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},t.exports.isIOS=function(){return c("`utils.isIOS` has moved to `utils.device.isIOS`"),o.isIOS(arguments)},t.exports.isOculusGo=t.exports.device.isOculusGo=function(){c("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},t.exports.isMobile=function(){return c("`utils.isMobile has moved to `utils.device.isMobile`"),o.isMobile(arguments)},t.exports.throttle=function(e,n,i){var r;return i&&(e=t.exports.bind(e,i)),function(){var t=Date.now(),i=void 0===r?n:t-r;(void 0===r||i>=n)&&(r=t,e.apply(null,arguments))}},t.exports.throttleTick=function(e,n,i){var r;return i&&(e=t.exports.bind(e,i)),function(t,i){var o=void 0===r?i:t-r;(void 0===r||o>=n)&&(r=t,e(t,o))}},t.exports.debounce=function(t,e,n){var i;return function(){var r=this,o=arguments,a=function(){i=null,n||t.apply(r,o)},s=n&&!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(r,o)}},t.exports.extend=a,t.exports.extendDeep=r,t.exports.clone=function(t){return JSON.parse(JSON.stringify(t))};var u,h,f=(u=s.createPool((function(){return[]})),function(t,e){var n,i,r,o,a,s;if(void 0===t||void 0===e||null===t||null===e||!(t&&e&&t.constructor===Object&&e.constructor===Object||t.constructor===Array&&e.constructor===Array))return t===e;for(n in i=u.use(),r=u.use(),i.length=0,r.length=0,t)i.push(n);for(n in e)r.push(n);if(i.length!==r.length)return u.recycle(i),u.recycle(r),!1;for(o=0;o<i.length;++o)if(a=t[i[o]],s=e[i[o]],"object"==typeof a||"object"==typeof s||Array.isArray(a)&&Array.isArray(s)){if(a===s)continue;if(!f(a,s))return u.recycle(i),u.recycle(r),!1}else if(a!==s)return u.recycle(i),u.recycle(r),!1;return u.recycle(i),u.recycle(r),!0});t.exports.deepEqual=f,t.exports.diff=(h=[],function(t,e,n){var i,r,o,a,s,l,c;for(s in a=n||{},h.length=0,t)h.push(s);if(!e)return a;for(o in e)-1===h.indexOf(o)&&h.push(o);for(l=0;l<h.length;l++)i=t[s=h[l]],r=e[s],((c=i&&r&&i.constructor===Object&&r.constructor===Object)&&!f(i,r)||!c&&i!==r)&&(a[s]=r);return a}),t.exports.shouldCaptureKeyEvent=function(t){return!t.metaKey&&document.activeElement===document.body},t.exports.splitString=function(t,e){void 0===e&&(e=" ");var n=new RegExp(e,"g");return(t=(t||"").replace(n,e)).split(e)},t.exports.getElData=function(t,e){e=e||{};var n={};return Object.keys(e).forEach((function(e){t.hasAttribute(e)&&(n[e]=t.getAttribute(e))})),n},t.exports.getUrlParameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},t.exports.isIframed=function(){return window.top!==window.self},t.exports.findAllScenes=function(t){for(var e=[],n=t.getElementsByTagName("*"),i=0,r=n.length;i<r;i++)n[i].isScene&&e.push(n[i]);return e},t.exports.fullAssign=function(t,...e){return e.forEach(e=>{let n=Object.keys(e).reduce((t,n)=>(t[n]=Object.getOwnPropertyDescriptor(e,n),t),{});Object.getOwnPropertySymbols(e).forEach(t=>{let i=Object.getOwnPropertyDescriptor(e,t);i.enumerable&&(n[t]=i)}),Object.defineProperties(t,n)}),t},t.exports.srcLoader=n(519)},,function(t,e,n){"use strict";(function(t){var i=n(6),r={parent:null,element:document.body,mode:i.a.TOP_LEFT,isElement:!0,visible:!0,position:new t.Vector2(0,0),_size:new t.Vector2(0,0)};Object.defineProperties(r,{size:{get:function(){return this._size.set(window.innerWidth,window.innerHeight),this._size},set:function(){}}}),e.a=r}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return c})),n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return d}));var i=10,r={vertexShader:["varying vec2 v_Uv;","void main() {","v_Uv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}\n"].join("\n"),fragmengtShaders:{dropShader:["const float PI = 3.141592653589793;","uniform sampler2D u_Texture;","uniform vec2 u_Center;","uniform float u_Radius;","uniform float u_Strength;","varying vec2 v_Uv;","void main() {","vec4 info = texture2D(u_Texture, v_Uv);","float drop = max(0.0, 1.0 - length(u_Center - v_Uv) / u_Radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * u_Strength;","gl_FragColor = info;","}\n"].join("\n"),stepShader:["uniform sampler2D u_Texture;","uniform vec2 u_Delta;","varying vec2 v_Uv;","void main() {","vec4 info = texture2D(u_Texture, v_Uv);","vec2 dx = vec2(u_Delta.x, 0.0);","vec2 dy = vec2(0.0, u_Delta.y);","float average = (texture2D(u_Texture, v_Uv - dx).r + texture2D(u_Texture, v_Uv - dy).r + texture2D(u_Texture, v_Uv + dx).r + texture2D(u_Texture, v_Uv + dy).r) * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.995;","info.r += info.g;","gl_FragColor = info;","}\n"].join("\n"),normalShader:["uniform sampler2D u_Texture;","uniform vec2 u_Delta;","varying vec2 v_Uv;","void main() {","vec4 info = texture2D(u_Texture, v_Uv);","vec3 dx = vec3(u_Delta.x, texture2D(u_Texture, vec2(v_Uv.x + u_Delta.x, v_Uv.y)).r - info.r, 0.0);","vec3 dy = vec3(0.0, texture2D(u_Texture, vec2(v_Uv.x, v_Uv.y + u_Delta.y)).r - info.r, u_Delta.y);","info.ba = normalize(cross(dy, dx)).xz;","gl_FragColor = info;","}\n"].join("\n")}},o=["vec2 intersectCube(vec3 origin, vec3 ray, vec3 cubeMin, vec3 cubeMax) {","vec3 t1 = (cubeMin - origin) / ray;","vec3 t2 = (cubeMax - origin) / ray;","vec3 ta = min(t1, t2);","vec3 tb = max(t1, t2);","float tminxy = max(ta.x, ta.y);","float tmaxxy = min(tb.x, tb.y);","float tmin = max(tminxy, ta.z);","float tmax = min(tmaxxy, tb.z);","return vec2(tmin, tmax);","}\n"].join("\n"),a=["vec2 getUv(vec2 pos, float maxWidth, float maxHeight){","vec2 newPos;","newPos.x = (pos.x + maxWidth / 2.0) / maxWidth;","newPos.y = (pos.y + maxHeight / 2.0) / maxHeight;","return newPos;","}\n"].join("\n"),s=["vec3 getWallColor(vec3 worldPos, vec3 ray, vec3 lightDir){","vec3 color;","vec3 faceNormal;","vec2 t = intersectCube(worldPos, ray, vec3(-WATER_WIDTH / 2.0, -u_PoolHeight, -WATER_WIDTH / 2.0), vec3(WATER_WIDTH / 2.0, 0.0, WATER_WIDTH / 2.0));","vec3 hit = worldPos + t.y * ray;","if (WATER_WIDTH / 2.0 - abs(hit.x) <= 0.1){","color = (texture2D(u_TileTexture, getUv(hit.yz, WATER_WIDTH, WATER_WIDTH))).xyz;","faceNormal = vec3(1.0, 0.0, 0.0);","} else if(WATER_WIDTH / 2.0 - abs(hit.z) <= 0.1){","color = (texture2D(u_TileTexture, getUv(hit.xy, WATER_WIDTH, WATER_WIDTH))).xyz;","faceNormal = vec3(0.0, 0.0, 1.0);","} else if(hit.y <= -u_PoolHeight + 0.1){","color = (texture2D(u_TileTexture, getUv(hit.xz, WATER_WIDTH, WATER_WIDTH))).xyz;","faceNormal = vec3(0.0, 1.0, 0.0);","} else {","color = vec3(1.0);","faceNormal = vec3(0.0, 1.0, 0.0);","}","float diffuse = dot(faceNormal, u_LightDir);","diffuse = 0.3 * ((diffuse >= 0.0)? 1.0 : 0.0) * diffuse + 0.7;","vec2 t2 = intersectCube(hit, -u_LightDir, vec3(-WATER_WIDTH / 2.0, -u_PoolHeight, -WATER_WIDTH / 2.0), vec3(WATER_WIDTH / 2.0, 0.0, WATER_WIDTH / 2.0));","vec3 inverseHit = hit - t2.y * u_LightDir;","vec3 lit = (inverseHit.y < 0.0) ? SHADOW_COLOR: vec3(1.0, 1.0, 1.0);","vec2 causticsUv = getUv((hit.xz - hit.y * lightDir.xz / lightDir.y), WATER_WIDTH, WATER_WIDTH);","causticsUv.y = 1.0 - causticsUv.y;","float caustics = texture2D(u_CausticTex, causticsUv).r;","float litCaustics = pow(lit.x, 2.0);","color *= diffuse * WATER_COLOR * (lit * 0.8 + litCaustics * caustics * 0.8);","return color;","}\n"].join("\n"),l=["vec4 getWallColor2(vec3 worldPos, vec3 ray, vec3 lightDir){","vec3 color;","vec3 faceNormal;","vec2 t = intersectCube(worldPos, ray, vec3(-WATER_WIDTH / 2.0, -u_PoolHeight, -WATER_WIDTH / 2.0), vec3(WATER_WIDTH / 2.0, 0.0, WATER_WIDTH / 2.0));","vec3 hit = worldPos + t.y * ray;","if (WATER_WIDTH / 2.0 - abs(hit.x) <= 0.1){","faceNormal = vec3(1.0, 0.0, 0.0);","} else if(WATER_WIDTH / 2.0 - abs(hit.z) <= 0.1){","faceNormal = vec3(0.0, 0.0, 1.0);","} else if(hit.y <= -u_PoolHeight + 0.1){","faceNormal = vec3(0.0, 1.0, 0.0);","} else{","return vec4(0.0);","}","color = (texture2D(u_TileTexture, getUv(hit.xz, WATER_WIDTH, WATER_WIDTH))).xyz;","float diffuse = dot(faceNormal, u_LightDir);","diffuse = 0.3 * ((diffuse >= 0.0)? 1.0 : 0.0) * diffuse + 0.7;","vec2 t2 = intersectCube(hit, -u_LightDir, vec3(-WATER_WIDTH / 2.0, -u_PoolHeight, -WATER_WIDTH / 2.0), vec3(WATER_WIDTH / 2.0, 0.0, WATER_WIDTH / 2.0));","vec3 inverseHit = hit - t2.y * u_LightDir;","vec3 lit = (inverseHit.y < 0.0) ? SHADOW_COLOR: vec3(1.0, 1.0, 1.0);","vec2 causticsUv = getUv((hit.xz - hit.y * lightDir.xz / lightDir.y), WATER_WIDTH, WATER_WIDTH);","causticsUv.y = 1.0 - causticsUv.y;","float caustics = texture2D(u_CausticTex, causticsUv).r;","float litCaustics = pow(lit.x, 2.0);","color *= UNDERWATER_DIM * diffuse * WATER_COLOR * (lit * 0.8 + litCaustics * caustics * 0.8);","return vec4(color, 1.0);","}\n"].join("\n"),c=new Array(2),u=["uniform sampler2D u_RippleShader;","varying vec3 v_WorldPos;","varying vec4 v_clipSpace;","varying vec2 v_Uv;"].join("\n"),h=["precision mediump float;","const float IOR_AIR = 1.0;","const float IOR_WATER = 1.33;","const float WATER_WIDTH = "+i+".0;","const vec3 SHADOW_COLOR = vec3(0.34, 0.43, 0.5);","const vec3 WATER_COLOR = vec3(0.86, 0.96, 0.99);","uniform sampler2D u_RippleShader;","uniform sampler2D u_CausticTex;","uniform sampler2D u_TileTexture;","uniform sampler2D u_SkyTexture;","uniform vec3 u_LightDir;","uniform float u_PoolHeight;","varying vec3 v_WorldPos;","varying vec4 v_clipSpace;","varying vec2 v_Uv;"].join("\n");h+=a+o+s,c[0]={},c[0].vertexShader=u+["void main() {","vec4 info = texture2D(u_RippleShader, uv);","/* as the water plane has been rotated clockwise 90 degree along x axis, we made changes to z coords to make waves */","vec4 worldPos = modelMatrix * vec4(position + vec3(0.0, 0.0, info.r), 1.0);","v_clipSpace = projectionMatrix * viewMatrix * worldPos;","gl_Position = v_clipSpace;","v_WorldPos = worldPos.xyz;","v_Uv = uv;","}\n"].join("\n"),c[0].fragmentShader=h+["void main() {","vec4 info = texture2D(u_RippleShader, v_Uv);","vec2 myUv = v_Uv;",'/* make water look more "peaked" */',"for (int i = 0; i < 10; i++) {","myUv += info.ba * 0.005;","info = texture2D(u_RippleShader, myUv);","}","vec3 eyeRay = normalize(v_WorldPos - cameraPosition);","vec3 worldNormal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);","float fresnel = mix(0.25, 1.0, pow(1.0 + dot(worldNormal, eyeRay), 3.0));","vec3 reflectRay = reflect(eyeRay, worldNormal);","vec3 refractRay = refract(eyeRay, worldNormal, IOR_AIR/ IOR_WATER);","vec3 refractLight = refract(u_LightDir, worldNormal, IOR_AIR / IOR_WATER);","vec3 refractColor = getWallColor(v_WorldPos, refractRay, refractLight);","vec2 ndc =  (v_clipSpace.xy/v_clipSpace.w) / 2.0 + 0.5;","vec2 reflectTexCoords = vec2(1.0 - ndc.x, ndc.y);","for (int i = 0; i < 10; i++) {","reflectTexCoords += info.ba * 0.005;","}","vec3 reflectColor = texture2D(u_SkyTexture, reflectTexCoords).rgb;","gl_FragColor = vec4(mix(refractColor, reflectColor, fresnel), 1.0);","}\n"].join("\n"),c[1]={},c[1].vertexShader=c[0].vertexShader,c[1].fragmentShader=h+["void main() {","vec4 info = texture2D(u_RippleShader, v_Uv);","vec2 myUv = v_Uv;",'/* make water look more "peaked" */',"for (int i = 0; i < 10; i++) {","myUv += info.ba * 0.005;","info = texture2D(u_RippleShader, myUv);","}","vec3 eyeRay = normalize(v_WorldPos - cameraPosition);","vec3 worldNormal = - vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);","float fresnel = mix(0.5, 1.0, pow(1.0 + dot(worldNormal, eyeRay), 3.0));","vec3 reflectRay = reflect(eyeRay, worldNormal);","vec3 refractRay = refract(eyeRay, worldNormal, IOR_WATER / IOR_AIR);","vec3 refractLight = refract(u_LightDir, worldNormal, IOR_AIR / IOR_WATER);","vec2 ndc =  (v_clipSpace.xy/v_clipSpace.w) / 2.0 + 0.5;","vec2 refractTexCoords = vec2(1.0 - ndc.x, ndc.y);","vec3 reflectColor = getWallColor(v_WorldPos, reflectRay, refractLight);","vec3 refractColor = texture2D(u_SkyTexture, refractTexCoords).rgb;","gl_FragColor = vec4(mix(reflectColor, refractColor, (1.0 - fresnel) * length(refractRay)), 1.0);","}\n"].join("\n");var f={};f.vertexShader=["precision mediump float;","varying vec3 v_WorldPos;","uniform float u_PoolHeight;","void main(){","vec4 worldPos = modelMatrix * vec4(position, 1.0);","worldPos.y *= u_PoolHeight;","gl_Position = projectionMatrix * viewMatrix * worldPos;","v_WorldPos = worldPos.xyz;","}\n"].join("\n"),f.fragmentShader=["precision mediump float;","const float IOR_AIR = 1.0;","const float IOR_WATER = 1.33;","const float WATER_WIDTH = "+i+".0;","const vec3 SHADOW_COLOR = vec3(0.34, 0.43, 0.5);","const vec3 WATER_COLOR = vec3(0.86, 0.96, 0.99);","const float UNDERWATER_DIM = 0.6;","uniform sampler2D u_RippleShader;","uniform sampler2D u_CausticTex;","uniform sampler2D u_TileTexture;","uniform vec3 u_LightDir;","uniform float u_PoolHeight;","varying vec3 v_WorldPos;\n"].join("\n")+a+o+l+["void main(){","vec4 info = texture2D(u_RippleShader, getUv(v_WorldPos.xz, WATER_WIDTH, WATER_WIDTH));","vec3 worldNormal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);","vec3 refractLight = refract(u_LightDir, worldNormal, IOR_AIR / IOR_WATER);","vec3 eyeRay = v_WorldPos - cameraPosition;","vec4 wallColor = getWallColor2(v_WorldPos, eyeRay, refractLight);","gl_FragColor = wallColor;","}\n"].join("\n");var d={vertexShader:"precision mediump float;\n"+o+["const float IOR_AIR = 1.0;","const float IOR_WATER = 1.333;","const float WATER_WIDTH = "+i+".0;","uniform vec3 u_LightDir;","uniform sampler2D u_RippleShader;","uniform float u_PoolHeight;","varying vec3 v_OldPos;","varying vec3 v_NewPos;","vec3 getHitPosition(vec3 origin, vec3 ray){","vec2 t = intersectCube(origin, ray, vec3(-WATER_WIDTH / 2.0, -u_PoolHeight, -WATER_WIDTH / 2.0), vec3(WATER_WIDTH / 2.0, 0.0, WATER_WIDTH / 2.0));","return origin + ray * t.y;","}","vec3 project(vec3 pos, vec3 light){","vec2 delta = (-u_PoolHeight - pos.y) / light.y * light.xz;","pos.xz += delta;","pos.y = 0.0;","return pos;","}","void main() {","vec4 info = texture2D(u_RippleShader, uv);","vec3 waveNormal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);","vec3 refractLight0 = refract(u_LightDir, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);","vec3 refractLight1 = refract(u_LightDir, waveNormal, IOR_AIR / IOR_WATER);","vec3 worldPos = vec3(position.x, 0.0, position.y);","vec3 hit0 = getHitPosition(worldPos, refractLight0);","vec3 hit1 = getHitPosition(worldPos + vec3(0.0, info.r, 0.0), refractLight1);","v_OldPos = project(hit0, refractLight0);","v_NewPos = project(hit1, refractLight1);","gl_Position =  projectionMatrix * modelViewMatrix * vec4((v_NewPos.xz + refractLight0.xz / refractLight0.y), 0.0, 1.0);","}\n"].join("\n"),fragmentShader:["precision mediump float;","uniform vec3 u_LightDir;","uniform float u_PoolHeight;","varying vec3 v_OldPos;","varying vec3 v_NewPos;","void main() {","float oldArea = length(dFdx(v_OldPos)) * length(dFdy(v_OldPos));","float newArea = length(dFdx(v_NewPos)) * length(dFdy(v_NewPos));","float r = clamp((oldArea - newArea) / oldArea, 0.0, 1.0);","gl_FragColor = vec4(r, 0.0, 0.0, 1.0);","}"].join("\n")}},function(t,e,n){"use strict";e.a={BOX:1,SPHERE:2,DISC:3,MESH:4}},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n){var o=r.call(this,e);if(this.className="MeshEntity",this.name=n||(e.name?e.name:"Mesh"),this.type="Mesh",e instanceof t.Mesh){let t=new i.default(this,e);o.addComponent(t)}else e.traverse(n=>{if(n instanceof t.Mesh){let t=new i.default(e),r=new a(n);r.addComponent(t),o.add(r)}});return o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getMesh=function(){return this.object3D},e.default=o("MeshEntity",a)}.call(this,n(0))},,function(t,e,n){"use strict";(function(t){function i(e){this.offset=new t.Vector2(0,0),this.size=new t.Vector2(1,1),this.mode=void 0!==e?e:i.RELATIVE,this.anchor=i.TOP_LEFT,this.width=1,this.height=1,this.viewport=new t.Vector4(0,0,1,1)}var r;n.d(e,"a",(function(){return i})),i.RELATIVE=200,i.ABSOLUTE=201,i.TOP_LEFT=301,i.TOP_RIGHT=302,i.BOTTOM_LEFT=303,i.BOTTOM_RIGHT=304,i.prototype.update=function(e){var n,r,o,a,s,l;void 0===e?(o=0,a=0,n=this.width,r=this.height):(o=e.viewport.x,a=e.viewport.y,n=e.viewport.z,r=e.viewport.w),this.mode===i.RELATIVE?(s=new t.Vector2(this.offset.x*n,this.offset.y*r),l=new t.Vector2(this.size.x*n,this.size.y*r)):this.mode===i.ABSOLUTE&&(s=this.offset,l=this.size),this.anchor===i.BOTTOM_LEFT?this.viewport.set(s.x+o,s.y+a,l.x,l.y):this.anchor===i.BOTTOM_RIGHT?this.viewport.set(n-l.x-s.x+o,s.y+a,l.x,l.y):this.anchor===i.TOP_LEFT?this.viewport.set(s.x+o,r-l.y-s.y+a,l.x,l.y):this.anchor===i.TOP_RIGHT&&this.viewport.set(n-l.x-s.x+o,r-l.y-s.y+a,l.x,l.y)},i.prototype.getAspectRatio=function(){return this.viewport.z/this.viewport.w},i.prototype.isInside=function(t,e){return e.position.x>this.viewport.x&&e.position.x<this.viewport.x+this.viewport.z&&e.position.y<this.height-this.viewport.y&&e.position.y>this.height-this.viewport.y-this.viewport.w},i.prototype.getNormalized=(r=new t.Vector2,function(t,e){var n=e.position.x-this.viewport.z-this.viewport.x,i=e.position.y-(this.height-(this.viewport.y+this.viewport.w));return r.set(n/this.viewport.z*2+1,-i/this.viewport.w*2+1),r}),i.prototype.enable=function(t){t.setViewport(this.viewport),t.setScissor(this.viewport)},i.prototype.toJSON=function(){return{offset:this.offset.toArray(),size:this.size.toArray(),mode:this.mode,anchor:this.anchor}},i.prototype.fromJSON=function(t){this.offset.fromArray(t.offset),this.size.fromArray(t.size),this.mode=t.mode,this.anchor=t.anchor}}).call(this,n(0))},function(t,e,n){"use strict";function i(){this.id=i._id++}n.d(e,"a",(function(){return i})),i._id=1,i.prototype.apply=function(){},i.prototype.revert=function(){}},function(t,e,n){"use strict";function i(){this.pressed=!1,this.justPressed=!1,this.justReleased=!1}n.d(e,"a",(function(){return i})),i.DOWN=-1,i.UP=1,i.RESET=0,i.prototype.constructor=i,i.prototype.update=function(t){this.justPressed=!1,this.justReleased=!1,t===i.DOWN?(!1===this.pressed&&(this.justPressed=!0),this.pressed=!0):t===i.UP?(this.pressed&&(this.justReleased=!0),this.pressed=!1):t===i.RESET&&(this.justReleased=!1,this.justPressed=!1)},i.prototype.set=function(t,e,n){this.justPressed=t,this.pressed=e,this.justReleased=n},i.prototype.reset=function(){this.justPressed=!1,this.pressed=!1,this.justReleased=!1}},function(t,e,n){"use strict";function i(){this.events=[]}n.d(e,"a",(function(){return i})),i.prototype.add=function(t,e,n){this.events.push([t,e,n,!1])},i.prototype.clear=function(){this.destroy(),this.events=[]},i.prototype.create=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].addEventListener(e[1],e[2]),e[3]=!0}},i.prototype.destroy=function(){for(var t=0;t<this.events.length;t++){var e=this.events[t];e[0].removeEventListener(e[1],e[2]),e[3]=!1}},i.prototype.addScrollEvent=function(t,e){void 0!==window.onmousewheel?this.add(t,"mousewheel",e):void 0!==window.addEventListener?this.add(t,"DOMMouseScroll",(function(t){t.deltaY=30*t.detail,e(t)})):this.add(t,"wheel",e)};new i},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(6),r=n(90);function o(e,n,o){i.a.call(this,e,"div"),this.options=void 0!==n?n:new r.a,this.onResize=null,this.resolution=new t.Vector2,this.onCanvasReset=null,this.canvas=null,this.resetCanvas(),this.renderer=null,this.createRenderer(),levent.trigger(TDS_RT,"canvas_created",{canvas:this.canvas})}o.prototype=Object.create(i.a.prototype),o.prototype.setOnResize=function(t){this.onResize=t},o.prototype.resetCanvas=function(){this.element.contains(this.canvas)&&this.element.removeChild(this.canvas),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.display="block",this.canvas.style.top="0px",this.canvas.style.left="0px",0===this.element.children.length?this.element.appendChild(this.canvas):this.element.insertBefore(this.canvas,this.element.firstChild),this.element.contains(this.cssDivision)&&this.element.removeChild(this.cssDivision),this.resizeCanvas(),null!==this.onCanvasReset&&this.onCanvasReset(this)},o.prototype.createRenderer=function(){this.renderer=this.options.createRenderer(this.canvas)},o.prototype.getBlob=function(t,e,n){this.canvas.toBlob(t,void 0!==e?e:"image/jpeg",void 0!==n?n:.7)},o.prototype.reloadContext=function(){this.forceContextLoss(),this.resetCanvas(),this.createRenderer(),this.updateSize()},o.prototype.forceContextLoss=function(){try{null!==this.renderer&&(this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=null)}catch(t){this.renderer=null,console.log("TDS: Failed to destroy WebGL context.")}},o.prototype.resizeCanvas=function(){this.resolution.copy(this.size),this.resolution.multiplyScalar(TDS_RT.getDPI()),this.canvas.width=this.resolution.x,this.canvas.height=this.resolution.y,this.canvas.style.width=this.size.x+"px",this.canvas.style.height=this.size.y+"px",null!==this.onResize&&this.onResize(this.resolution.x,this.resolution.y)},o.prototype.destroy=function(){i.a.prototype.destroy.call(this),this.forceContextLoss()},o.prototype.updateSize=function(){i.a.prototype.updateSize.call(this),this.resizeCanvas(),null!==this.renderer&&this.renderer.setSize(this.size.x,this.size.y,!1)}}).call(this,n(0))},,function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(53),r=n(124);function o(t,e){i.a.call(this),this.resource=t,this.category=e}o.prototype.apply=function(){r.a.addResource(this.resource,this.category),o.updateInterface()},o.prototype.revert=function(){r.a.removeResource(this.resource,this.category),o.updateInterface()},o.updateInterface=function(){Editor.updateView()}},,,function(t,e,n){"use strict";n.r(e);var i={value:function(){}};function r(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i)throw new Error("illegal type: "+t);i[t]=[]}return new o(i)}function o(t){this._=t}function a(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function s(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function l(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=i,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}o.prototype=r.prototype={constructor:o,on:function(t,e){var n,i=this._,r=a(t+"",i),o=-1,c=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<c;)if(n=(t=r[o]).type)i[n]=l(i[n],t.name,e);else if(null==e)for(n in i)i[n]=l(i[n],t.name,null);return this}for(;++o<c;)if((n=(t=r[o]).type)&&(n=s(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new o(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(i=this._[t]).length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};var c=r;n.d(e,"dispatch",(function(){return c}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(0),r=n(30),o=function(t,e){r.a.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof i.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=i.UniformsUtils.clone(t.uniforms),this.material=new i.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new r.a.FullScreenQuad(this.material)};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}})},,,function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(69),r=(n(67),n(110),n(16)),o=n(28);function a(t,e){o.a.call(this,"audio","Audio"),void 0!==t&&(t instanceof ArrayBuffer?(this.data=t,this.encoding=void 0!==e?e:"",this.format="arraybuffer"):i.a.isBase64(t)?(this.encoding=void 0!==e?e:"",this.data=ArraybufferUtils.fromBase64(t),this.format="arraybuffer"):(this.data=r.a.readFileArrayBuffer(t),this.encoding=r.a.getFileExtension(t),this.format="arraybuffer"))}a.prototype=Object.create(o.a.prototype),a.fileIsAudio=function(t){return!(void 0===t||!t.type.startsWith("audio"))},a.prototype.getAudioBuffer=function(t,e){t.decodeAudioData(this.data.slice(0),e,(function(t){console.error("TDStudio: Cannot decode audio buffer ("+t+")")}))},a.prototype.toJSON=function(t){if(void 0!==t.audio[this.uuid])return t.audio[this.uuid];var e=o.a.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.data=this.data,e.format=this.format,t.audio[this.uuid]=e,e}},,function(t,e,n){"use strict";var i=[];for(let t=0;t<256;t++)i[t]=(t<16?"0":"")+t.toString(16);var r={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+"-"+i[255&e]+i[e>>8&255]+"-"+i[e>>16&15|64]+i[e>>24&255]+"-"+i[63&n|128]+i[n>>8&255]+"-"+i[n>>16&255]+i[n>>24&255]+i[255&r]+i[r>>8&255]+i[r>>16&255]+i[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*r.DEG2RAD},radToDeg:function(t){return t*r.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((e+i)/2),u=a((e+i)/2),h=o((e-i)/2),f=a((e-i)/2),d=o((i-e)/2),p=a((i-e)/2);switch(r){case"XYX":t.set(s*u,l*h,l*f,s*c);break;case"YZY":t.set(l*f,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*f,s*u,s*c);break;case"XZX":t.set(s*u,l*p,l*d,s*c);break;case"YXY":t.set(l*d,s*u,l*p,s*c);break;case"ZYZ":t.set(l*p,l*d,s*u,s*c);break;default:console.warn("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},randomColor:function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}};r.PI2=2*Math.PI,r.PID3=Math.PI/3,r.PID2=Math.PI/2,e.a=r},,function(t,e,n){"use strict";function i(){}n.d(e,"a",(function(){return i})),i.encoding="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i.isBase64=function(t){if("string"!=typeof t)return!1;if(t.startsWith("data:"))return!0;for(var e=0;e<t.length;e++)if(!i.encoding.includes(t.charAt(e)))return!1;return!0},i.removeHeader=function(t){return t.slice(t.search(";base64,")+8)},i.getFileFormat=function(t){var e=t.indexOf("/")+1,n=t.indexOf(";");return t.substr(e,n-e)},i.fromArraybuffer=function(t){for(var e,n,r,o,a,s="",l=new Uint8Array(t),c=l.byteLength%3,u=l.byteLength-c,h=0;h<u;h+=3)e=(16515072&(a=l[h]<<16|l[h+1]<<8|l[h+2]))>>18,n=(258048&a)>>12,r=(4032&a)>>6,o=63&a,s+=i.encoding[e]+i.encoding[n]+i.encoding[r]+i.encoding[o];return 1===c?(e=(252&(a=l[u]))>>2,n=(3&a)<<4,s+=i.encoding[e]+i.encoding[n]+"=="):2===c&&(e=(64512&(a=l[u]<<8|l[u+1]))>>10,n=(1008&a)>>4,r=(15&a)<<2,s+=i.encoding[e]+i.encoding[n]+i.encoding[r]+"="),s},i.fromBinaryString=function(t){for(var e,n,r,o="",a=t.length%3,s=t.length-a,l=0;l<s;l+=3)e=255&t.charCodeAt(l),n=t.charCodeAt(l+1),r=t.charCodeAt(l+2),o+=i.encoding.charAt(e>>2),o+=i.encoding.charAt((3&e)<<4|(240&n)>>4),o+=i.encoding.charAt((15&n)<<2|(192&r)>>6),o+=i.encoding.charAt(63&r);return 1===a?(e=255&t.charCodeAt(l),o+=i.encoding.charAt(e>>2),o+=i.encoding.charAt((3&e)<<4),o+="=="):2===a&&(e=255&t.charCodeAt(l),n=t.charCodeAt(l+1),o+=i.encoding.charAt(e>>2),o+=i.encoding.charAt((3&e)<<4|(240&n)>>4),o+=i.encoding.charAt((15&n)<<2),o+="="),o}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return g}));var i=n(157),r=n(130),o=n(131),a=n(81),s=(n(238),n(158)),l=n(193),c=(n(113),n(187),n(206)),u=n(154).systems,h=n(5).components,f=n(12).entities,d=n(44),p=n(12).Entity,m=n(236);d.bind,d.device.isIOS(),d.device.isMobile(),d.device.isWebXRAvailable,d.debug("core:scene:warn");function g(e,n){var i=p.call(this);this.name="scene",this.type="Scene",this.getImageData=!1,this.imgData=null,this.object3D=n||new t.Scene,this.program=e,this.program.scene=this,this.systems=[],m.trigger(TDS_RT,"SCENE_CREATED",{scene:this,version:TDS_RT.VERSION}),this.enabled=!0,this.eventQueues={},this.delta=0,this.components=[],this.cameras=[],this.mainCamera=null,this.camera=null,this.isScene=!0,this.usePhysics=!0,this.physics=null,this.eNavLeft=null,this.eNavRight=null;var r=new l.default(i);return i.addComponent(r),this.initSystems(),i}n(528),g.prototype=Object.create(p.prototype),g.prototype.default=function(){var e=new s.default;this.add(e);var n=new a.default;n.position.set(0,.5,0),n.scale.set(1,1,1);var l=new c.a(1).modify(n.geometry);n.geometry=(new t.BufferGeometry).fromGeometry(l),n.geometry.computeVertexNormals(),this.add(n);var u=new o.default(void 0,void 0,1);this.add(u);var h=new r.default(void 0,void 0,.5);h.position.set(1,1,5),this.add(h);var f=new i.default;f.position.set(0,1,10),this.add(f),this.init()},g.prototype.init=function(){return p.prototype.init.call(this),this},g.prototype.initSystems=function(){let t;for(t in u)this.initSystem(t)},g.prototype.initSystem=function(t){this.systems[t]||(this.systems[t]=new u[t](this),this.systems[t].init())},g.prototype.getSystem=function(t){return this.systems[t]?this.systems[t]:null},g.prototype.addBehavior=function(t){var e,n,i=this.behaviors;for(n in i)t[n]&&-1===(e=this.behaviors[n]).indexOf(t)&&e.push(t)},g.prototype.removeBehavior=function(t){var e,n,i,r=this.behaviors;for(n in r)t[n]&&-1!==(i=(e=this.behaviors[n]).indexOf(t))&&e.splice(i,1)},g.prototype.play=function(){this.systems.forEach(t=>{t.play()}),this.cameras.forEach(t=>{t.getCamera().play()}),this.components.forEach(t=>{t.play()}),this.children.forEach(t=>{t.play(),t.components&&t.components.forEach(t=>{t.play()})}),m.trigger(TDS_RT,"SCENE_STARTED",{})},g.prototype.tick=function(t,e){this.systems.forEach(t=>{t.tick()})},g.prototype.tock=function(t,e,n){this.systems.forEach(t=>{t.tock()})},g.prototype.activate=function(){m.trigger(TDS_RT,"scene_activated",{})},g.prototype.deactivate=function(){m.trigger(TDS_RT,"scene_deactivated",{})},g.prototype.render=function(t){var e=this.program.canvas.clientWidth,n=this.program.canvas.clientHeight;if(t.autoClear=!1,t.setViewport(0,0,e,n),t.setScissor(0,0,e,n),t.setClearColor(this.background),this.cameras&&this.cameras.length>0){t.setScissorTest(!0);for(var i=0;i<this.cameras.length;i++)this.cameras[i].getCamera().setupRenderer(t),this.cameras[i].getCamera().render(t,this);t.setScissorTest(!1)}else null!==this.defaultCamera&&this.defaultCamera.render(t,this);this.getImageData&&(this.imgData=t.domElement.toDataURL("image/jpeg",1),this.getImageData=!1,m.trigger(TDS_RT,"RENDER_IMAGEDATA_READY",{}))},g.prototype.update=function(t){p.prototype.update.call(this,t),this.usePhysics&&this.world.step(t<.05?t:.05),this.children.forEach(e=>{e.object3D.traverse(e=>{e.update(t)})})},g.prototype.updateCameraOrder=function(){this.cameras.sort((function(t,e){return t.order>e.order}))},g.prototype.removeCamera=function(t){var e=this.cameras.indexOf(t);e>-1&&this.cameras.splice(e,1),this.camera===t.getCamera()&&delete this.camera},g.prototype.addCamera=function(t){this.cameras.push(t),this.camera||(this.camera=t.getCamera())},g.prototype.resize=function(t,e){t*e!=0&&(this.cameras.forEach(n=>{n.getCamera().resize(t,e)}),this.components.forEach(n=>{n.resize(t,e)}),this.children.forEach(n=>{n.resize(t,e)}),m.trigger(TDS_RT,"SCENE_RESIZED",{scene:this,x:t,y:e}))},g.prototype.enterAR=function(){},g.prototype.enterVR=function(t){},g.prototype.exitVR=function(){},g.prototype.dispose=function(){p.prototype.dispose.call(this),this.children.forEach(t=>{t.object3D.traverse(t=>{t.dispose()})})},g.prototype.isCameraActive=function(t){return this.cameras.indexOf(t)>-1},g.prototype.getActiveCamera=function(){return this.camera||(this.camera=this.cameras[0]),this.camera},g.prototype.setActiveCamera=function(t){this.camera=t},g.prototype.preStore=function(){this.children.forEach(t=>{t.preStore()})},g.prototype.postStore=function(){this.children.forEach(t=>{t.postStore()})},g.prototype.toJSON=function(t){var e={meta:t||{className:this.className,name:this.name,type:this.type,isEntity:!0},components:[],object:{}};return this.components.forEach(t=>{e.components.push(t.toJSON())}),this.preStore(),e.object.children=[],this.children.forEach(t=>{e.object.children.push(t.toJSON())}),this.postStore(),e},g.prototype.fromJSON=function(t){var e=t.meta;e&&(this.name=e.name,this.type=e.type);for(var n=t.components,i=0;i<n.length;i++){var r=n[i],o=r.meta.name,a=null;if("orbit-controls"!==o){var s=this.object3D.getObjectByProperty("uuid",r.object.uuid);a=new h[o](this,s),this.addComponent(a)}else a=this.getComponent("OrbitControls");a.load(r,this)}for(var l=0;l<t.object.children.length;l++){var c,u=t.object.children[l];if(u.object.uuid){s=this.object3D.getObjectByProperty("uuid",u.object.uuid);c=new f[u.meta.className](s,!1)}else c=new f[u.meta.className](void 0,!1);c.parent=this,this.add(c.fromJSON(u,this))}return this},Object.defineProperty(g.prototype,"defaultCamera",{get:function(){return this.program.defaultCamera},set:function(t){this.program.defaultCamera=t},enumerable:!0}),Object.defineProperty(g.prototype,"root",{set:function(t){this.program=t},get:function(){return this.program},enumerable:!0}),Object.defineProperty(g.prototype,"world",{get:function(){return this.physics.world},set:function(t){this.physics.world=t},enumerable:!0})}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(437);function r(t,e,n){var i=r.typeSizeMap;this.type="string"==typeof t&&i.hasOwnProperty(t)?t:"f",this.componentSize=i[this.type],this.arrayType=n||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!e,this.updateMin=0,this.updateMax=0}r.constructor=r,r.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},r.prototype.setUpdateRange=function(t,e){this.updateMin=Math.min(t*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(e*this.componentSize,this.updateMax*this.componentSize)},r.prototype.flagUpdate=function(){var t=this.bufferAttribute,e=t.updateRange;e.offset=this.updateMin,e.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),t.needsUpdate=!0},r.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0},r.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer},r.prototype.splice=function(t,e){this.typedArray.splice(t,e),this.forceUpdateAll()},r.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},r.prototype._ensureTypedArray=function(t){null!==this.typedArray&&this.typedArray.size===t*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==t?this.typedArray.setSize(t):null===this.typedArray&&(this.typedArray=new i.a(this.arrayType,t,this.componentSize)))},r.prototype._createBufferAttribute=function(e){if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize,void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new t.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},r.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length}}).call(this,n(0))},,,function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(55),r=n(54);function o(t){this.keys=[],this.actions=[];var e=this,n=this.actions;this.events=new i.a,this.events.add(window,"keydown",(function(t){n.push(t.keyCode),n.push(r.a.DOWN)})),this.events.add(window,"keyup",(function(t){n.push(t.keyCode),n.push(r.a.UP)})),this.events.add(window,"focus",(function(t){e.reset()})),!0!==t&&this.create()}o.prototype=o,o.prototype.constructor=o,o.update=function(){for(var t=0;this.actions.length>t;){var e=this.actions.shift(),n=this.actions.shift();void 0===this.keys[e]&&(this.keys[e]=new r.a),this.keys[e].update(n),(this.keys[e].justReleased||this.keys[e].justPressed)&&(this.actions.push(e),this.actions.push(r.a.RESET),t+=2)}},o.reset=function(){for(var t=0;t<this.keys.length;t++)void 0!==this.keys[t]&&this.keys[t].reset()},o.keyPressed=function(t){return void 0!==this.keys[t]&&this.keys[t].pressed},o.keyJustPressed=function(t){return void 0!==this.keys[t]&&this.keys[t].justPressed},o.keyJustReleased=function(t){return void 0!==this.keys[t]&&this.keys[t].justReleased},o.create=function(){this.events.create()},o.dispose=function(){this.events.destroy()},o.TAB=9,o.ENTER=13,o.SHIFT=16,o.CTRL=17,o.ALT=18,o.CAPS_LOCK=20,o.ESC=27,o.SPACEBAR=32,o.PAGE_UP=33,o.PAGE_DOWN=34,o.END=35,o.HOME=36,o.INSERT=45,o.DEL=46,o.LEFT=37,o.RIGHT=39,o.UP=38,o.DOWN=40,o.NUM0=48,o.NUM1=49,o.NUM2=50,o.NUM3=51,o.NUM4=52,o.NUM5=53,o.NUM6=54,o.NUM7=55,o.NUM8=56,o.NUM9=57,o.A=65,o.B=66,o.C=67,o.D=68,o.E=69,o.F=70,o.G=71,o.H=72,o.I=73,o.J=74,o.K=75,o.L=76,o.M=77,o.N=78,o.O=79,o.P=80,o.Q=81,o.R=82,o.S=83,o.T=84,o.U=85,o.V=86,o.W=87,o.X=88,o.Y=89,o.Z=90,o.F1=112,o.F2=113,o.F3=114,o.F4=115,o.F5=116,o.F6=117,o.F7=118,o.F8=119,o.F9=120,o.F10=121,o.F11=122,o.F12=123},,,,function(t,e,n){"use strict";var i,r,o,a,s,l,c,u,h=n(10),f={},d=180/Math.PI,p=Math.PI/180,m=Math.atan2,g=/([A-Z])/g,v=/(?:left|right|width|margin|padding|x)/i,y=/[\s,\(]\S/,x={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},b=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},w=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},_=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},M=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},S=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},T=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},A=function(t,e,n){return t.style[e]=n},E=function(t,e,n){return t.style.setProperty(e,n)},q=function(t,e,n){return t._gsap[e]=n},C=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},P=function(t,e,n,i,r){var o=t._gsap;o.scaleX=o.scaleY=n,o.renderTransform(r,o)},R=function(t,e,n,i,r){var o=t._gsap;o[e]=n,o.renderTransform(r,o)},L="transform",I=L+"Origin",D=function(t,e){var n=r.createElementNS?r.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):r.createElement(t);return n.style?n:r.createElement(t)},O=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(g,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,F(n)||n,1)||""},N="O,Moz,ms,Ms,Webkit".split(","),F=function(t,e,n){var i=(e||s).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(N[r]+t in i););return r<0?null:(3===r?"ms":r>=0?N[r]:"")+t},B=function(){"undefined"!=typeof window&&window.document&&(i=window,r=i.document,o=r.documentElement,s=D("div")||{style:{}},l=D("div"),L=F(L),I=L+"Origin",s.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",u=!!F("perspective"),a=1)},z=function t(e){var n,i=D("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,a=this.nextSibling,s=this.style.cssText;if(o.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(a?r.insertBefore(this,a):r.appendChild(this)),o.removeChild(i),this.style.cssText=s,n},U=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},k=function(t){var e;try{e=t.getBBox()}catch(n){e=z.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===z||(e=z.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+U(t,["x","cx","x1"])||0,y:+U(t,["y","cy","y1"])||0,width:0,height:0}},j=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!k(t))},V=function(t,e){if(e){var n=t.style;e in f&&e!==I&&(e=L),n.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),n.removeProperty(e.replace(g,"-$1").toLowerCase())):n.removeAttribute(e)}},G=function(t,e,n,i,r,o){var a=new h.c(t._pt,e,n,0,1,o?T:S);return t._pt=a,a.b=i,a.e=r,t._props.push(n),a},H={deg:1,rad:1,turn:1},W=function t(e,n,i,o){var a,l,c,u,d=parseFloat(i)||0,p=(i+"").trim().substr((d+"").length)||"px",m=s.style,g=v.test(n),y="svg"===e.tagName.toLowerCase(),x=(y?"client":"offset")+(g?"Width":"Height"),b="px"===o,w="%"===o;return o===p||!d||H[o]||H[p]?d:("px"!==p&&!b&&(d=t(e,n,i,"px")),u=e.getCTM&&j(e),w&&(f[n]||~n.indexOf("adius"))?Object(h.t)(d/(u?e.getBBox()[g?"width":"height"]:e[x])*100):(m[g?"width":"height"]=100+(b?p:o),l=~n.indexOf("adius")||"em"===o&&e.appendChild&&!y?e:e.parentNode,u&&(l=(e.ownerSVGElement||{}).parentNode),l&&l!==r&&l.appendChild||(l=r.body),(c=l._gsap)&&w&&c.width&&g&&c.time===h.v.time?Object(h.t)(d/c.width*100):((w||"%"===p)&&(m.position=O(e,"position")),l===e&&(m.position="static"),l.appendChild(s),a=s[x],l.removeChild(s),m.position="absolute",g&&w&&((c=Object(h.h)(l)).time=h.v.time,c.width=l[x]),Object(h.t)(b?a*d/100:a&&d?100/a*d:0))))},X=function(t,e,n,i){var r;return a||B(),e in x&&"transform"!==e&&~(e=x[e]).indexOf(",")&&(e=e.split(",")[0]),f[e]&&"transform"!==e?(r=rt(t,i),r="transformOrigin"!==e?r[e]:ot(O(t,I))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=J[e]&&J[e](t,e,n)||O(t,e)||Object(h.i)(t,e)||("opacity"===e?1:0)),n&&!~(r+"").indexOf(" ")?W(t,e,r,n)+n:r},Y=function(t,e,n,i){if(!n||"none"===n){var r=F(e,t,1),o=r&&O(t,r,1);o&&o!==n?(e=r,n=o):"borderColor"===e&&(n=O(t,"borderTopColor"))}var a,s,l,c,u,f,d,p,m,g,v,y,x=new h.c(this._pt,t.style,e,0,1,h.r),b=0,w=0;if(x.b=n,x.e=i,n+="","auto"===(i+="")&&(t.style[e]=i,i=O(t,e)||i,t.style[e]=n),a=[n,i],Object(h.e)(a),i=a[1],l=(n=a[0]).match(h.o)||[],(i.match(h.o)||[]).length){for(;s=h.o.exec(i);)d=s[0],m=i.substring(b,s.index),u?u=(u+1)%5:"rgba("!==m.substr(-5)&&"hsla("!==m.substr(-5)||(u=1),d!==(f=l[w++]||"")&&(c=parseFloat(f)||0,v=f.substr((c+"").length),(y="="===d.charAt(1)?+(d.charAt(0)+"1"):0)&&(d=d.substr(2)),p=parseFloat(d),g=d.substr((p+"").length),b=h.o.lastIndex-g.length,g||(g=g||h.f.units[e]||v,b===i.length&&(i+=g,x.e+=g)),v!==g&&(c=W(t,e,f,g)||0),x._pt={_next:x._pt,p:m||1===w?m:",",s:c,c:y?y*p:p-c,m:u&&u<4?Math.round:0});x.c=b<i.length?i.substring(b,i.length):""}else x.r="display"===e&&"none"===i?T:S;return h.q.test(i)&&(x.e=0),this._pt=x,x},Z={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Q=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,o=e.t,a=o.style,s=e.u,l=o._gsap;if("all"===s||!0===s)a.cssText="",i=1;else for(r=(s=s.split(",")).length;--r>-1;)n=s[r],f[n]&&(i=1,n="transformOrigin"===n?I:L),V(o,n);i&&(V(o,L),l&&(l.svg&&o.removeAttribute("transform"),rt(o,1),l.uncache=1))}},J={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var o=t._pt=new h.c(t._pt,e,n,0,0,Q);return o.u=i,o.pr=-10,o.tween=r,t._props.push(n),1}}},K=[1,0,0,1,0,0],$={},tt=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},et=function(t){var e=O(t,L);return tt(e)?K:e.substr(7).match(h.n).map(h.t)},nt=function(t,e){var n,i,r,a,s=t._gsap||Object(h.h)(t),l=t.style,c=et(t);return s.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(c=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?K:c:(c!==K||t.offsetParent||t===o||s.svg||(r=l.display,l.display="block",(n=t.parentNode)&&t.offsetParent||(a=1,i=t.nextSibling,o.appendChild(t)),c=et(t),r?l.display=r:V(t,"display"),a&&(i?n.insertBefore(t,i):n?n.appendChild(t):o.removeChild(t))),e&&c.length>6?[c[0],c[1],c[4],c[5],c[12],c[13]]:c)},it=function(t,e,n,i,r,o){var a,s,l,c=t._gsap,u=r||nt(t,!0),h=c.xOrigin||0,f=c.yOrigin||0,d=c.xOffset||0,p=c.yOffset||0,m=u[0],g=u[1],v=u[2],y=u[3],x=u[4],b=u[5],w=e.split(" "),_=parseFloat(w[0])||0,M=parseFloat(w[1])||0;n?u!==K&&(s=m*y-g*v)&&(l=_*(-g/s)+M*(m/s)-(m*b-g*x)/s,_=_*(y/s)+M*(-v/s)+(v*b-y*x)/s,M=l):(_=(a=k(t)).x+(~w[0].indexOf("%")?_/100*a.width:_),M=a.y+(~(w[1]||w[0]).indexOf("%")?M/100*a.height:M)),i||!1!==i&&c.smooth?(x=_-h,b=M-f,c.xOffset=d+(x*m+b*v)-x,c.yOffset=p+(x*g+b*y)-b):c.xOffset=c.yOffset=0,c.xOrigin=_,c.yOrigin=M,c.smooth=!!i,c.origin=e,c.originIsAbsolute=!!n,t.style[I]="0px 0px",o&&(G(o,c,"xOrigin",h,_),G(o,c,"yOrigin",f,M),G(o,c,"xOffset",d,c.xOffset),G(o,c,"yOffset",p,c.yOffset)),t.setAttribute("data-svg-origin",_+" "+M)},rt=function(t,e){var n=t._gsap||new h.a(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,o,a,s,l,c,f,g,v,y,x,b,w,_,M,S,T,A,E,q,C,P,R,D,N,F,B,z,U,k,V,G=t.style,H=n.scaleX<0,W=O(t,I)||"0";return i=r=o=l=c=f=g=v=y=0,a=s=1,n.svg=!(!t.getCTM||!j(t)),w=nt(t,n.svg),n.svg&&(R=!n.uncache&&t.getAttribute("data-svg-origin"),it(t,R||W,!!R||n.originIsAbsolute,!1!==n.smooth,w)),x=n.xOrigin||0,b=n.yOrigin||0,w!==K&&(T=w[0],A=w[1],E=w[2],q=w[3],i=C=w[4],r=P=w[5],6===w.length?(a=Math.sqrt(T*T+A*A),s=Math.sqrt(q*q+E*E),l=T||A?m(A,T)*d:0,(g=E||q?m(E,q)*d+l:0)&&(s*=Math.cos(g*p)),n.svg&&(i-=x-(x*T+b*E),r-=b-(x*A+b*q))):(V=w[6],U=w[7],F=w[8],B=w[9],z=w[10],k=w[11],i=w[12],r=w[13],o=w[14],c=(_=m(V,z))*d,_&&(R=C*(M=Math.cos(-_))+F*(S=Math.sin(-_)),D=P*M+B*S,N=V*M+z*S,F=C*-S+F*M,B=P*-S+B*M,z=V*-S+z*M,k=U*-S+k*M,C=R,P=D,V=N),f=(_=m(-E,z))*d,_&&(M=Math.cos(-_),k=q*(S=Math.sin(-_))+k*M,T=R=T*M-F*S,A=D=A*M-B*S,E=N=E*M-z*S),l=(_=m(A,T))*d,_&&(R=T*(M=Math.cos(_))+A*(S=Math.sin(_)),D=C*M+P*S,A=A*M-T*S,P=P*M-C*S,T=R,C=D),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,f=180-f),a=Object(h.t)(Math.sqrt(T*T+A*A+E*E)),s=Object(h.t)(Math.sqrt(P*P+V*V)),_=m(C,P),g=Math.abs(_)>2e-4?_*d:0,y=k?1/(k<0?-k:k):0),n.svg&&(R=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!tt(O(t,L)),R&&t.setAttribute("transform",R))),Math.abs(g)>90&&Math.abs(g)<270&&(H?(a*=-1,g+=l<=0?180:-180,l+=l<=0?180:-180):(s*=-1,g+=g<=0?180:-180)),n.x=((n.xPercent=i&&Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)?0:i)+"px",n.y=((n.yPercent=r&&Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)?0:r)+"px",n.z=o+"px",n.scaleX=Object(h.t)(a),n.scaleY=Object(h.t)(s),n.rotation=Object(h.t)(l)+"deg",n.rotationX=Object(h.t)(c)+"deg",n.rotationY=Object(h.t)(f)+"deg",n.skewX=g+"deg",n.skewY=v+"deg",n.transformPerspective=y+"px",(n.zOrigin=parseFloat(W.split(" ")[2])||0)&&(G[I]=ot(W)),n.xOffset=n.yOffset=0,n.force3D=h.f.force3D,n.renderTransform=n.svg?ct:u?lt:st,n.uncache=0,n},ot=function(t){return(t=t.split(" "))[0]+" "+t[1]},at=function(t,e,n){var i=Object(h.w)(e);return Object(h.t)(parseFloat(e)+parseFloat(W(t,"x",n+"px",i)))+i},st=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,lt(t,e)},lt=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,o=n.x,a=n.y,s=n.z,l=n.rotation,c=n.rotationY,u=n.rotationX,h=n.skewX,f=n.skewY,d=n.scaleX,m=n.scaleY,g=n.transformPerspective,v=n.force3D,y=n.target,x=n.zOrigin,b="",w="auto"===v&&t&&1!==t||!0===v;if(x&&("0deg"!==u||"0deg"!==c)){var _,M=parseFloat(c)*p,S=Math.sin(M),T=Math.cos(M);M=parseFloat(u)*p,_=Math.cos(M),o=at(y,o,S*_*-x),a=at(y,a,-Math.sin(M)*-x),s=at(y,s,T*_*-x+x)}"0px"!==g&&(b+="perspective("+g+") "),(i||r)&&(b+="translate("+i+"%, "+r+"%) "),(w||"0px"!==o||"0px"!==a||"0px"!==s)&&(b+="0px"!==s||w?"translate3d("+o+", "+a+", "+s+") ":"translate("+o+", "+a+") "),"0deg"!==l&&(b+="rotate("+l+") "),"0deg"!==c&&(b+="rotateY("+c+") "),"0deg"!==u&&(b+="rotateX("+u+") "),"0deg"===h&&"0deg"===f||(b+="skew("+h+", "+f+") "),1===d&&1===m||(b+="scale("+d+", "+m+") "),y.style[L]=b||"translate(0, 0)"},ct=function(t,e){var n,i,r,o,a,s=e||this,l=s.xPercent,c=s.yPercent,u=s.x,f=s.y,d=s.rotation,m=s.skewX,g=s.skewY,v=s.scaleX,y=s.scaleY,x=s.target,b=s.xOrigin,w=s.yOrigin,_=s.xOffset,M=s.yOffset,S=s.forceCSS,T=parseFloat(u),A=parseFloat(f);d=parseFloat(d),m=parseFloat(m),(g=parseFloat(g))&&(m+=g=parseFloat(g),d+=g),d||m?(d*=p,m*=p,n=Math.cos(d)*v,i=Math.sin(d)*v,r=Math.sin(d-m)*-y,o=Math.cos(d-m)*y,m&&(g*=p,a=Math.tan(m-g),r*=a=Math.sqrt(1+a*a),o*=a,g&&(a=Math.tan(g),n*=a=Math.sqrt(1+a*a),i*=a)),n=Object(h.t)(n),i=Object(h.t)(i),r=Object(h.t)(r),o=Object(h.t)(o)):(n=v,o=y,i=r=0),(T&&!~(u+"").indexOf("px")||A&&!~(f+"").indexOf("px"))&&(T=W(x,"x",u,"px"),A=W(x,"y",f,"px")),(b||w||_||M)&&(T=Object(h.t)(T+b-(b*n+w*r)+_),A=Object(h.t)(A+w-(b*i+w*o)+M)),(l||c)&&(a=x.getBBox(),T=Object(h.t)(T+l/100*a.width),A=Object(h.t)(A+c/100*a.height)),a="matrix("+n+","+i+","+r+","+o+","+T+","+A+")",x.setAttribute("transform",a),S&&(x.style[L]=a)},ut=function(t,e,n,i,r,o){var a,s,l=Object(h.k)(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?d:1),u=o?c*o:c-i,f=i+u+"deg";return l&&("short"===(a=r.split("_")[1])&&(u%=360)!==u%180&&(u+=u<0?360:-360),"cw"===a&&u<0?u=(u+36e9)%360-360*~~(u/360):"ccw"===a&&u>0&&(u=(u-36e9)%360-360*~~(u/360))),t._pt=s=new h.c(t._pt,e,n,i,u,w),s.e=f,s.u="deg",t._props.push(n),s},ht=function(t,e,n){var i,o,a,s,c,u,d,p=l.style,m=n._gsap;for(o in p.cssText=getComputedStyle(n).cssText+";position:absolute;display:block;",p[L]=e,r.body.appendChild(l),i=rt(l,1),f)(a=m[o])!==(s=i[o])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(o)<0&&(c=Object(h.w)(a)!==(d=Object(h.w)(s))?W(n,o,a,d):parseFloat(a),u=parseFloat(s),t._pt=new h.c(t._pt,m,o,c,u-c,b),t._pt.u=d||0,t._props.push(o));r.body.removeChild(l)};
/*!
 * CSSPlugin 3.4.2
 * https://greensock.com
 *
 * Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/Object(h.g)("padding,margin,Width,Radius",(function(t,e){var n="Top",i="Right",r="Bottom",o="Left",a=(e<3?[n,i,r,o]:[n+o,n+i,r+i,r+o]).map((function(n){return e<2?t+n:"border"+n+t}));J[e>1?"border"+t:t]=function(t,e,n,i,r){var o,s;if(arguments.length<4)return o=a.map((function(e){return X(t,e,n)})),5===(s=o.join(" ")).split(o[0]).length?o[0]:s;o=(i+"").split(" "),s={},a.forEach((function(t,e){return s[t]=o[e]=o[e]||o[(e-1)/2|0]})),t.init(e,s,r)}}));var ft,dt,pt={name:"css",register:B,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var o,s,l,c,u,d,p,m,g,v,w,S,T,A,E,q,C,P,R,I=this._props,D=t.style;for(p in a||B(),e)if("autoRound"!==p&&(s=e[p],!h.p[p]||!Object(h.d)(p,e,n,i,t,r)))if(u=typeof s,d=J[p],"function"===u&&(u=typeof(s=s.call(n,i,t,r))),"string"===u&&~s.indexOf("random(")&&(s=Object(h.s)(s)),d)d(this,t,p,s,n)&&(E=1);else if("--"===p.substr(0,2))this.add(D,"setProperty",getComputedStyle(t).getPropertyValue(p)+"",s+"",i,r,0,0,p);else{if(o=X(t,p),c=parseFloat(o),(v="string"===u&&"="===s.charAt(1)?+(s.charAt(0)+"1"):0)&&(s=s.substr(2)),l=parseFloat(s),p in x&&("autoAlpha"===p&&(1===c&&"hidden"===X(t,"visibility")&&l&&(c=0),G(this,D,"visibility",c?"inherit":"hidden",l?"inherit":"hidden",!l)),"scale"!==p&&"transform"!==p&&~(p=x[p]).indexOf(",")&&(p=p.split(",")[0])),w=p in f)if(S||((T=t._gsap).renderTransform||rt(t),A=!1!==e.smoothOrigin&&T.smooth,(S=this._pt=new h.c(this._pt,D,L,0,1,T.renderTransform,T,0,-1)).dep=1),"scale"===p)this._pt=new h.c(this._pt,T,"scaleY",T.scaleY,v?v*l:l-T.scaleY),I.push("scaleY",p),p+="X";else{if("transformOrigin"===p){C=void 0,P=void 0,R=void 0,C=(q=s).split(" "),P=C[0],R=C[1]||"50%","top"!==P&&"bottom"!==P&&"left"!==R&&"right"!==R||(q=P,P=R,R=q),C[0]=Z[P]||P,C[1]=Z[R]||R,s=C.join(" "),T.svg?it(t,s,0,A,0,this):((g=parseFloat(s.split(" ")[2])||0)!==T.zOrigin&&G(this,T,"zOrigin",T.zOrigin,g),G(this,D,p,ot(o),ot(s)));continue}if("svgOrigin"===p){it(t,s,1,A,0,this);continue}if(p in $){ut(this,T,p,c,s,v);continue}if("smoothOrigin"===p){G(this,T,"smooth",T.smooth,s);continue}if("force3D"===p){T[p]=s;continue}if("transform"===p){ht(this,s,t);continue}}else p in D||(p=F(p)||p);if(w||(l||0===l)&&(c||0===c)&&!y.test(s)&&p in D)l||(l=0),(m=(o+"").substr((c+"").length))!==(g=(s+"").substr((l+"").length)||(p in h.f.units?h.f.units[p]:m))&&(c=W(t,p,o,g)),this._pt=new h.c(this._pt,w?T:D,p,c,v?v*l:l-c,"px"!==g||!1===e.autoRound||w?b:M),this._pt.u=g||0,m!==g&&(this._pt.b=o,this._pt.r=_);else if(p in D)Y.call(this,t,p,o,s);else{if(!(p in t)){Object(h.m)(p,s);continue}this.add(t,p,t[p],s,i,r)}I.push(p)}E&&Object(h.u)(this)},get:X,aliases:x,getSetter:function(t,e,n){var i=x[e];return i&&i.indexOf(",")<0&&(e=i),e in f&&e!==I&&(t._gsap.x||X(t,"x"))?n&&c===n?"scale"===e?C:q:(c=n||{})&&("scale"===e?P:R):t.style&&!Object(h.l)(t.style[e])?A:~e.indexOf("-")?E:Object(h.j)(t,e)},core:{_removeProperty:V,_getMatrix:nt}};h.x.utils.checkPrefix=F,ft="rotation,rotationX,rotationY,skewX,skewY",dt=Object(h.g)("x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+ft+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){f[t]=1})),Object(h.g)(ft,(function(t){h.f.units[t]="deg",$[t]=1})),x[dt[13]]="x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+ft,Object(h.g)("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");x[e[1]]=dt[e[0]]})),Object(h.g)("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){h.f.units[t]="px"})),h.x.registerPlugin(pt),n.d(e,"a",(function(){return mt}));var mt=(h.x.registerPlugin(pt)||h.x).core.Tween},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var i=n(2),r=n(49),o=n(34),a=n(4);function s(e){for(var n in(e=i.a.ensureTypedArg(e,i.a.types.OBJECT,{})).position=i.a.ensureTypedArg(e.position,i.a.types.OBJECT,{}),e.velocity=i.a.ensureTypedArg(e.velocity,i.a.types.OBJECT,{}),e.acceleration=i.a.ensureTypedArg(e.acceleration,i.a.types.OBJECT,{}),e.radius=i.a.ensureTypedArg(e.radius,i.a.types.OBJECT,{}),e.drag=i.a.ensureTypedArg(e.drag,i.a.types.OBJECT,{}),e.rotation=i.a.ensureTypedArg(e.rotation,i.a.types.OBJECT,{}),e.color=i.a.ensureTypedArg(e.color,i.a.types.OBJECT,{}),e.opacity=i.a.ensureTypedArg(e.opacity,i.a.types.OBJECT,{}),e.size=i.a.ensureTypedArg(e.size,i.a.types.OBJECT,{}),e.angle=i.a.ensureTypedArg(e.angle,i.a.types.OBJECT,{}),e.wiggle=i.a.ensureTypedArg(e.wiggle,i.a.types.OBJECT,{}),e.maxAge=i.a.ensureTypedArg(e.maxAge,i.a.types.OBJECT,{}),this.uuid=t.Math.generateUUID(),this._times=0,this.type=i.a.ensureTypedArg(e.type,i.a.types.NUMBER,r.a.BOX),this.position={_value:i.a.ensureInstanceOf(e.position.value,t.Vector3,new t.Vector3),_spread:i.a.ensureInstanceOf(e.position.spread,t.Vector3,new t.Vector3),_spreadClamp:i.a.ensureInstanceOf(e.position.spreadClamp,t.Vector3,new t.Vector3),_distribution:i.a.ensureTypedArg(e.position.distribution,i.a.types.NUMBER,this.type),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1),_radius:i.a.ensureTypedArg(e.position.radius,i.a.types.NUMBER,10),_radiusScale:i.a.ensureInstanceOf(e.position.radiusScale,t.Vector3,new t.Vector3(1,1,1)),_distributionClamp:i.a.ensureTypedArg(e.position.distributionClamp,i.a.types.NUMBER,0),_mesh:i.a.ensureTypedArg(e.position.mesh,i.a.types.STRING,"")},this.velocity={_value:i.a.ensureInstanceOf(e.velocity.value,t.Vector3,new t.Vector3),_spread:i.a.ensureInstanceOf(e.velocity.spread,t.Vector3,new t.Vector3),_distribution:i.a.ensureTypedArg(e.velocity.distribution,i.a.types.NUMBER,this.type),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.acceleration={_value:i.a.ensureInstanceOf(e.acceleration.value,t.Vector3,new t.Vector3),_spread:i.a.ensureInstanceOf(e.acceleration.spread,t.Vector3,new t.Vector3),_distribution:i.a.ensureTypedArg(e.acceleration.distribution,i.a.types.NUMBER,this.type),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.drag={_value:i.a.ensureTypedArg(e.drag.value,i.a.types.NUMBER,0),_spread:i.a.ensureTypedArg(e.drag.spread,i.a.types.NUMBER,0),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.wiggle={_value:i.a.ensureTypedArg(e.wiggle.value,i.a.types.NUMBER,0),_spread:i.a.ensureTypedArg(e.wiggle.spread,i.a.types.NUMBER,0)},this.rotation={_axis:i.a.ensureInstanceOf(e.rotation.axis,t.Vector3,new t.Vector3(0,1,0)),_axisSpread:i.a.ensureInstanceOf(e.rotation.axisSpread,t.Vector3,new t.Vector3),_angle:i.a.ensureTypedArg(e.rotation.angle,i.a.types.NUMBER,0),_angleSpread:i.a.ensureTypedArg(e.rotation.angleSpread,i.a.types.NUMBER,0),_static:i.a.ensureTypedArg(e.rotation.static,i.a.types.BOOLEAN,!1),_center:i.a.ensureInstanceOf(e.rotation.center,t.Vector3,this.position._value.clone()),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.maxAge={_value:i.a.ensureTypedArg(e.maxAge.value,i.a.types.NUMBER,2),_spread:i.a.ensureTypedArg(e.maxAge.spread,i.a.types.NUMBER,0)},this.color={_value:i.a.ensureArrayInstanceOf(e.color.value,t.Color,new t.Color),_spread:i.a.ensureArrayInstanceOf(e.color.spread,t.Vector3,new t.Vector3),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.opacity={_value:i.a.ensureArrayTypedArg(e.opacity.value,i.a.types.NUMBER,1),_spread:i.a.ensureArrayTypedArg(e.opacity.spread,i.a.types.NUMBER,0),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.size={_value:i.a.ensureArrayTypedArg(e.size.value,i.a.types.NUMBER,1),_spread:i.a.ensureArrayTypedArg(e.size.spread,i.a.types.NUMBER,0),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.angle={_value:i.a.ensureArrayTypedArg(e.angle.value,i.a.types.NUMBER,0),_spread:i.a.ensureArrayTypedArg(e.angle.spread,i.a.types.NUMBER,0),_randomise:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)},this.particleCount=i.a.ensureTypedArg(e.particleCount,i.a.types.NUMBER,100),this.duration=i.a.ensureTypedArg(e.duration,i.a.types.NUMBER,null),this.isStatic=i.a.ensureTypedArg(e.isStatic,i.a.types.BOOLEAN,!1),this.activeMultiplier=i.a.ensureTypedArg(e.activeMultiplier,i.a.types.NUMBER,1),this.direction=i.a.ensureTypedArg(e.direction,i.a.types.NUMBER,1),this.delayTime=i.a.ensureTypedArg(e.delayTime,i.a.types.NUMBER,0),this.alive=i.a.ensureTypedArg(e.alive,i.a.types.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:i.a.ensureTypedArg(e.position.randomise,i.a.types.BOOLEAN,!1)||i.a.ensureTypedArg(e.radius.randomise,i.a.types.BOOLEAN,!1),velocity:i.a.ensureTypedArg(e.velocity.randomise,i.a.types.BOOLEAN,!1),acceleration:i.a.ensureTypedArg(e.acceleration.randomise,i.a.types.BOOLEAN,!1)||i.a.ensureTypedArg(e.drag.randomise,i.a.types.BOOLEAN,!1),rotation:i.a.ensureTypedArg(e.rotation.randomise,i.a.types.BOOLEAN,!1),rotationCenter:i.a.ensureTypedArg(e.rotation.randomise,i.a.types.BOOLEAN,!1),size:i.a.ensureTypedArg(e.size.randomise,i.a.types.BOOLEAN,!1),color:i.a.ensureTypedArg(e.color.randomise,i.a.types.BOOLEAN,!1),opacity:i.a.ensureTypedArg(e.opacity.randomise,i.a.types.BOOLEAN,!1),angle:i.a.ensureTypedArg(e.angle.randomise,i.a.types.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,i.a.ensureValueOverLifetimeCompliance(this.color,o.a.valueOverLifetimeLength,o.a.valueOverLifetimeLength),i.a.ensureValueOverLifetimeCompliance(this.opacity,o.a.valueOverLifetimeLength,o.a.valueOverLifetimeLength),i.a.ensureValueOverLifetimeCompliance(this.size,o.a.valueOverLifetimeLength,o.a.valueOverLifetimeLength),i.a.ensureValueOverLifetimeCompliance(this.angle,o.a.valueOverLifetimeLength,o.a.valueOverLifetimeLength)}s.constructor=s,s.prototype._createGetterSetters=function(t,e){var n=this;for(var r in t)if(t.hasOwnProperty(r)){var a=r.replace("_","");Object.defineProperty(t,a,{get:function(t){return function(){return this[t]}}(r),set:function(t){return function(r){var a=n.updateMap[e],s=this[t],l=o.a.valueOverLifetimeLength;"_rotationCenter"===t?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===t?n.resetFlags[a]=r:(n.updateFlags[a]=!0,n.updateCounts[a]=0),n.group._updateDefines(),this[t]=r,Array.isArray(s)&&i.a.ensureValueOverLifetimeCompliance(n[e],l,l)}}(r)})}},s.prototype._setBufferUpdateRanges=function(t){this.attributeKeys=t,this.attributeCount=t.length;for(var e=this.attributeCount-1;e>=0;--e)this.bufferUpdateRanges[t[e]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},s.prototype._calculatePPSValue=function(t){var e=this.particleCount;this.duration?this.particlesPerSecond=e/(t<this.duration?t:this.duration):this.particlesPerSecond=e/t},s.prototype._setAttributeOffset=function(t){this.attributeOffset=t,this.activationIndex=t,this.activationEnd=t+this.particleCount},s.prototype._assignValue=function(t,e){switch(t){case"position":this._assignPositionValue(e);break;case"velocity":case"acceleration":this._assignForceValue(e,t);break;case"size":case"opacity":this._assignAbsLifetimeValue(e,t);break;case"angle":this._assignAngleValue(e);break;case"params":this._assignParamsValue(e);break;case"rotation":this._assignRotationValue(e);break;case"color":this._assignColorValue(e)}},s.prototype._assignPositionValue=function(t){var e=this.position,n=this.attributes.position,o=e._value,s=e._spread;switch(e._distribution){case r.a.BOX:i.a.randomVector3(n,t,o,s,e._spreadClamp);break;case r.a.SPHERE:i.a.randomVector3OnSphere(n,t,o,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x,e._distributionClamp||this.particleCount);break;case r.a.DISC:i.a.randomVector3OnDisc(n,t,o,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x);break;case r.a.MESH:var l=a.default.program.getActiveScene();if(l){var c=l.object3D.getObjectByProperty("uuid",e._mesh);i.a.randomVector3OnMesh(n,t,o,s,e._spreadClamp,c)}}},s.prototype._assignForceValue=function(t,e){var n,o,a,s,l,c=this[e],u=c._value,h=c._spread;switch(c._distribution){case r.a.BOX:i.a.randomVector3(this.attributes[e],t,u,h);break;case r.a.SPHERE:o=(n=this.attributes.position.typedArray.array)[l=3*t],a=n[l+1],s=n[l+2],i.a.randomDirectionVector3OnSphere(this.attributes[e],t,o,a,s,this.position._value,c._value.x,c._spread.x);break;case r.a.DISC:o=(n=this.attributes.position.typedArray.array)[l=3*t],a=n[l+1],s=n[l+2],i.a.randomDirectionVector3OnDisc(this.attributes[e],t,o,a,s,this.position._value,c._value.x,c._spread.x);break;case r.a.MESH:i.a.randomVector3(this.attributes[e],t,u,h)}if("acceleration"===e){var f=i.a.clamp(i.a.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*t+3]=f}},s.prototype._assignAbsLifetimeValue=function(t,e){var n,r=this.attributes[e].typedArray,o=this[e];i.a.arrayValuesAreEqual(o._value)&&i.a.arrayValuesAreEqual(o._spread)?(n=Math.abs(i.a.randomFloat(o._value[0],o._spread[0])),r.setVec4Components(t,n,n,n,n)):r.setVec4Components(t,Math.abs(i.a.randomFloat(o._value[0],o._spread[0])),Math.abs(i.a.randomFloat(o._value[1],o._spread[1])),Math.abs(i.a.randomFloat(o._value[2],o._spread[2])),Math.abs(i.a.randomFloat(o._value[3],o._spread[3])))},s.prototype._assignAngleValue=function(t){var e,n=this.attributes.angle.typedArray,r=this.angle;i.a.arrayValuesAreEqual(r._value)&&i.a.arrayValuesAreEqual(r._spread)?(e=i.a.randomFloat(r._value[0],r._spread[0]),n.setVec4Components(t,e,e,e,e)):n.setVec4Components(t,i.a.randomFloat(r._value[0],r._spread[0]),i.a.randomFloat(r._value[1],r._spread[1]),i.a.randomFloat(r._value[2],r._spread[2]),i.a.randomFloat(r._value[3],r._spread[3]))},s.prototype._assignParamsValue=function(t){this.attributes.params.typedArray.setVec4Components(t,this.isStatic?1:0,0,Math.abs(i.a.randomFloat(this.maxAge._value,this.maxAge._spread)),i.a.randomFloat(this.wiggle._value,this.wiggle._spread))},s.prototype._assignRotationValue=function(t){this.attributes.rotation.typedArray.setVec3Components(t,i.a.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),i.a.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(t,this.rotation._center)},s.prototype._assignColorValue=function(t){i.a.randomColorAsHex(this.attributes.color,t,this.color._value,this.color._spread)},s.prototype._resetParticle=function(t){for(var e,n,i=this.resetFlags,r=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)n=r[e=a[s]],!0!==i[e]&&!0!==n||(this._assignValue(e,t),this._updateAttributeUpdateRange(e,t),!0===n&&o[e]===this.particleCount?(r[e]=!1,o[e]=0):1==n&&++o[e])},s.prototype._updateAttributeUpdateRange=function(t,e){var n=this.bufferUpdateRanges[t];n.min=Math.min(e,n.min),n.max=Math.max(e,n.max)},s.prototype._resetBufferRanges=function(){for(var t=this.bufferUpdateRanges,e=this.bufferUpdateKeys,n=this.bufferUpdateCount-1;n>=0;--n){var i=e[n];t[i].min=Number.POSITIVE_INFINITY,t[i].max=Number.NEGATIVE_INFINITY}},s.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},s.prototype._decrementParticleCount=function(){--this.activeParticleCount},s.prototype._incrementParticleCount=function(){++this.activeParticleCount},s.prototype._checkParticleAges=function(t,e,n,i){for(var r,o,a,s,l=e-1;l>=t;--l)0!==(s=n[r=4*l])&&(a=n[r+1],o=n[r+2],1===this.direction?(a+=i)>=o&&(a=0,s=0,this._decrementParticleCount()):(a-=i)<=0&&(a=o,s=0,this._decrementParticleCount()),n[r]=s,n[r+1]=a,this._updateAttributeUpdateRange("params",l))},s.prototype._activateParticles=function(t,e,n,i){for(var r,o,a=this.direction,s=t;s<e;++s)0!=n[r=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),n[r]=1,this._resetParticle(s),o=i*(s-t),n[r+1]=-1===a?n[r+2]-o:o,this._updateAttributeUpdateRange("params",s))},s.prototype.tick=function(t,e){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var n=this.attributeOffset,i=n+this.particleCount,r=this.paramsArray,o=this.particlesPerSecond*this.activeMultiplier*t,a=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(n,i,r,t),!(e%this.maxAge.value<=this.delayTime))if(!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var s=1===this.particleCount?a:0|a,l=Math.min(s+o,this.activationEnd),c=l-this.activationIndex|0,u=c>0?t/c:0;this._activateParticles(s,l,r,u),this.activationIndex+=o,this.activationIndex>i&&(this.activationIndex=n),this.age+=t}else this.age=0}},s.prototype.reset=function(t){if(this.age=0,this.alive=!1,!0===t){for(var e,n=this.attributeOffset,i=n+this.particleCount,r=this.paramsArray,o=this.attributes.params.bufferAttribute,a=i-1;a>=n;--a)r[e=4*a]=0,r[e+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},s.prototype.enable=function(){return this.alive=!0,this},s.prototype.disable=function(){return this.alive=!1,this},s.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("TDS: ParticleEmitterControl does not belong to a group, cannot remove."),this},s.prototype.toJSON=function(t){var e={};e.uuid=this.uuid,e.type=this.type,e.direction=this.direction,e.delayTime=this.delayTime,e.particleCount=this.particleCount,e.duration=this.duration,e.isStatic=this.isStatic,e.maxAge={},e.maxAge.value=this.maxAge.value,e.maxAge.spread=this.maxAge.spread,e.position={},e.position.value=this.position.value.toArray(),e.position.spread=this.position.spread.toArray(),e.position.radius=this.position.radius,e.position.radiusScale=this.position.radiusScale.toArray(),e.position.mesh=this.position.mesh,e.velocity={},e.velocity.value=this.velocity.value.toArray(),e.velocity.spread=this.velocity.spread.toArray(),e.acceleration={},e.acceleration.value=this.acceleration.value.toArray(),e.acceleration.spread=this.acceleration.spread.toArray(),e.wiggle={},e.wiggle.value=this.wiggle.value,e.wiggle.spread=this.wiggle.spread,e.opacity={},e.opacity.value=this.opacity.value.slice(0),e.opacity.spread=this.opacity.spread,e.size={},e.size.value=this.size.value.slice(0),e.size.spread=this.size.spread,e.angle={},e.angle.value=this.angle.value.slice(0),e.angle.spread=this.angle.spread,e.color={},e.color.value=[];for(var n=0;n<this.color.value.length;n++)e.color.value.push(this.color.value[n].getHex());e.color.spread=[];for(n=0;n<this.color.spread.length;n++)e.color.spread.push(this.color.spread[n].toArray());return e}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(30),r=function(t,e,n,r,o){i.a.call(this),t&&(this.scene=t),e&&(this.camera=e),this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};r.prototype=Object.assign(Object.create(i.a.prototype),{constructor:r,render:function(t,e,n,i,r,o,a){var s,l,c,u=t.autoClear;t.autoClear=!1,o&&(this.scene=o),a&&(this.camera=a),void 0!==this.overrideMaterial&&(c=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(s=t.getClearColor().getHex(),l=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(s,l),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=c),t.autoClear=u}})},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n,i,o,a,s,l){var c=r.call(this,t);return this.name=e||"Box",this.className="BoxEntity",this.type="Box",this.isPrimitive=!0,t||c.createComponents(n,i,o),c}a.prototype=Object.create(r.prototype),a.prototype.createComponents=function(e,n,r,o,a,s){var l=new t.MeshStandardMaterial({color:16777215,roughness:.6,metalness:.2});l.name="default";e=e||1,n=n||1,r=r||1,o=o||5,a=a||5,s=s||5;var c=new i.default(this,void 0,new t.BoxBufferGeometry(e,n,r,o,a,s),l);this.addComponent(c),this.object3D=c.object3D},a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getBox=function(){return this.object3D},e.default=o("BoxEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";var i={APP_NAME:"Stone - 网页3D在线编辑器，快速构建沉浸式展示",API_SERVER_URL:"https://api.stone.techbrood.com/v1",STONE_URL:"https://techbrood.com/stone",IS_PRODUCTION:!0};e.a=i,window.Config=i},function(t,e,n){"use strict";function i(t,e){this.targetData=t,this.onLoadCallback}n.d(e,"a",(function(){return i})),i.prototype.init=function(){},i.prototype.load=function(t){return this.onLoadCallback=t},i.prototype.onLoad=function(){if(null!=this.onLoadCallback)return this.onLoadCallback()},i.prototype.destroy=function(){if(null!=this.particles)return this.particles.geometry.dispose(),this.particles.material.dispose(),this.particles=null},i.prototype.resize=function(){},i.prototype.getParticles=function(){return null}},,function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(102),r=function(){i.a.call(this),this.type="LineGeometry"};r.prototype=Object.assign(Object.create(i.a.prototype),{constructor:r,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,n=new Float32Array(2*e),r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return i.a.prototype.setPositions.call(this,n),this},setColors:function(t){for(var e=t.length-3,n=new Float32Array(2*e),r=0;r<e;r+=3)n[2*r]=t[r],n[2*r+1]=t[r+1],n[2*r+2]=t[r+2],n[2*r+3]=t[r+3],n[2*r+4]=t[r+4],n[2*r+5]=t[r+5];return i.a.prototype.setColors.call(this,n),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},copy:function(){return this}})},function(t,e,n){"use strict";var i=n(82),r=n(16),o={version:"0.1",server_path:"",server_filename:"defaults",server_url:i.a.API_SERVER_URL,files_path:"",file_max_size:2e7,preview_prefix:"_tn_",preview_sufix:".jpg",generate_preview:!0,preview_size:128,NOT_LOGGED:0,WAITING:1,LOGGED:2,TOKEN_NAME:"tds_token",request:function(t,e,n,i,r,a){t=o.server_url+"/"+t;var s=new XMLHttpRequest;s.open(e?"POST":"GET",t,!0);var l=null;if(e){l=new FormData;for(var c in e)l.append(c,e[c]);var u=decodeURI((RegExp("pid=(.+?)(&|$)").exec(location.search)||[,null])[1]);u&&l.append("project_id",u)}return s.onload=function(){var t=this.response;if(this.status<200||this.status>299)i&&i(this.status);else{var e=this.getResponseHeader("content-type");if(!a&&"application/json"==e||"application/json; charset=UTF-8"==e)try{t=JSON.parse(t)}catch(t){console.log(t)}n&&n(t)}},s.onerror=function(t){console.error(t),i&&i(t)},r&&s.upload.addEventListener("progress",(function(t){var n=0;t.lengthComputable&&(n=t.loaded/t.total),r(n,t,e)}),!1),s.send(l),s},loadFile:function(t,e,n,i,o){"text"===e?r.a.readFile(t,!1,n,i,o):"json"===e?r.a.readFileJson(t,n,i,o):"blob"===e?r.a.readFileBlob(t,n,i,o):r.a.readFileArrayBuffer(t,n,i,o)},login:function(t,e,n){var i=new o.Session;i.server_url=o.server_url,i.status=o.WAITING;var r,a="",s=new RegExp("(^| )tds_token=([^;]*)(;|$)");return(r=document.cookie.match(s))&&(a=unescape(r[2])),this.request("users/login",{token:a},(function(t){null!=t.user&&null!=t.user.id&&""!=t.user.id||(window.location.href="/"),i.last_resp=t,i.user=t.user,i.status=t.status>0?o.LOGGED:o.NOT_LOGGED,t.session_token&&i.setToken(t.session_token),i&&i.status>0&&o.onNewSession&&o.onNewSession(i),n&&n(i,t)}))},preCheck:function(t){console.log("Checking Server");var e=this;return this.request("system/ready",{},(function(n){o.system_info=n.info,o.files_path=n.info.files_path,o.preview_prefix=n.info.preview_prefix,o.preview_sufix=n.info.preview_sufix,t&&t(1==n.status,n),e.request("files/checkAppFile",{},(function(t){1==t.status&&SceneStorageModule.loadScene("/projects/"+n.project_directory_name+"/app.tsp",(function(){}),!0)}))}),(function(e){console.log("Error Checking Server"),t&&t(null,e)}))},checkExistingSession:function(t){var e=localStorage.getItem(o.TOKEN_NAME);if(e)return this.request("user/checkToken",{token:e},(function(n){if(null!=n.user&&null!=n.user.id&&""!=n.user.id||(localStorage.removeItem(o.TOKEN_NAME),window.location.href="/"),t)if(n.user){var i=new o.Session;i.server_url=o.server_url,i.status=o.LOGGED,i.user=n.user,i.token=e,t(i),o.onNewSession&&o.onNewSession(i)}else t(null)}));t&&t(null)},getTemplates:function(t){return this.request("projects/templates",null,(function(e){t&&t(e)}))},loadTemplate:function(t,e){var n=i.a.STONE_URL+"/templates/"+t.slug+".tsp";this.loadFile(n,"arraybuffer",e)},getModels:function(t,e){var n="models/templates";return t&&(n+="?q="+t),this.request(n,null,(function(t){e&&e(t)}))},loadModel:function(t,e){var n=r.a.getFileExtension(t);"obj"===n||"json"===n||"svg"===n||"dae"===n?this.loadFile(t,"text",e):this.loadFile(t,"arraybuffer",e)},cleanPath:function(t){var e="",n=t.indexOf("://");-1!=n&&(e=t.substr(0,n+3),t=t.substr(n+3));var i=t.split("/");i=i.filter((function(t){return!!t}));for(var r=[],o=1;o<i.length;o++)".."==i[o]?r.pop():r.push(i[o]);return e+i.join("/")},getFullpath:function(t,e,n){return this.cleanPath(t+"/"+e+"/"+n)},validateFilename:function(t){return/^[0-9a-zA-Z\_\- ... ]+$/.test(fullpath)},validateFolder:function(t){if(!t)return!0;return/^[0-9a-zA-Z\/\_\- ... ]+$/.test(t)},parsePath:function(t,e){if(!/^[0-9a-zA-Z\/\_\- ... ]+$/.test(t))return null;(t=this.cleanPath(t)).indexOf("/");return{unit:"",folder:"",filename:t}},getSizeString:function(t){return(t/1048576).toFixed(1)+" MBs"}};function a(){this.onsessionexpired=null,this.units={}}o.Session=a,a.prototype.request=function(t,e,n,i,r){if(!this.token)return console.warn("CloudBridge: not logged in"),void(i&&i(null));(e=e||{}).token=this.token;var a=this;return o.request(t,e,(function(t){-1==t.status&&"token not valid"==t.msg&&a.onsessionexpired&&a.onsessionexpired(a),n&&n(t)}),i,r)},a.prototype.setToken=function(t){this.token=t,localStorage.setItem(o.TOKEN_NAME,t)},a.prototype.logout=function(t,e){return localStorage.getItem(o.TOKEN_NAME)==this.token&&localStorage.removeItem(o.TOKEN_NAME),this.request("user/logout",{},(function(n){1==n.status?t&&t(1==n.status):e&&e(n.msg)}))},a.prototype.getUserInfo=function(t,e){return this.request("user/getInfo",{username:t},(function(t){e&&e(t.data,t)}))},a.prototype.uploadFile=function(t,e,n,i,r,a){if(void 0===e&&(e="/"),null==t||null==t)throw"Data cannot be null";var s=o.parsePath(e);if(!s)return r&&r("Filename has invalid characters"),void TDS_RT.alert("Filename has invalid characters: "+e);var l=s.unit,c=s.folder,u=s.filename,h=o.file_max_size||2e7,f=null,d="";if(t.constructor===ArrayBuffer)f=t.byteLength,d="arraybuffer";else if(t.constructor===File||t.constructor===Blob)f=t.size,d="file";else{if(t.constructor!==String)throw"Unknown data format, only string, ArrayBuffer, Blob and File supported";f=t.length,d="string"}if(void 0===f)throw"Size is undefined";u.split(".").pop().toLowerCase();var p={unit:l,folder:c,filename:u,encoding:d,data:t};n&&("string"==typeof n?p.category=n:(n.category&&(p.category=n.category),n.metadata&&(p.metadata="object"==typeof n.metadata?JSON.stringify(n.metadata):n.metadata),n.preview&&(p.preview=n.preview)));var m=this;if(f>h){if(t.constructor==Blob||t.constructor==File){var g=new FileReader;return g.onload=function(){var t=this.result;m.uploadFile(e,t,n,i,r,a)},g.readAsArrayBuffer(t),null}var v=Math.ceil(f/h)+1,y=Math.ceil(f/v),x=[];if(t.constructor===String)throw"String big file split not implemented yet";if(t.constructor===ArrayBuffer)for(var b=new Uint8Array(t),w=0;w<v;++w){var _=w*y,M=(w+1)*y;M-_>h&&(M=_+h);y=M-_;var S=b.subarray(_,M);if(!y||!S.length)break;x.push({part:w,start:_,end:M,size:y,data:S})}delete p.data,p.total_size=f;m.request("files/upload",p,(function(t){if(-1!=t.status){var n=x.length,o=0;!function t(){var s=x.shift();p.action="files/uploadPart",p.fullpath=e,p.offset=s.start,p.total_size=f,p.data=new Blob([s.data],{type:"application/octet-binary"}),p.encoding="file";m.request(m.request_url,p,(function(s){-1!=s.status?(o++,a&&a(e,o/n),x.length?t():i&&i(e)):r&&r(s.msg,s)}),(function(t){r&&r(t)}),(function(t,e){a&&a((o+t)/n,e,p)}))}()}else r&&r(t.msg,t)}),r);return null}return"arraybuffer"==p.encoding&&(p.encoding="file",p.data=new Blob([p.data],{type:"application/octet-binary"})),this.request("files/upload",p,(function(t){if(1!=t.status)return void(r&&r(t.msg));i&&i(1==t.status,t)}),r,a)},a.prototype.copyFile=function(t,e,n,i){if("http://"==t.substr(0,5))throw"CloudBridge does not support full URLs as fullpath";var r=o.parsePath(t),a=o.parsePath(t);return r&&a?this.request("files/copy",{fullpath:t,target_fullpath:e},(function(t){1==t.status?n&&n(t.status,t):i&&i(t.msg)}),i):(i&&i("Filename has invalid characters"),void TDS_RT.alert("Filename has invalid characters: "+t))},a.prototype.moveFile=function(t,e,n,i){if("http://"==t.substr(0,5))throw"CloudBridge does not support full URLs as fullpath";return o.parsePath(e)?this.request("files/move",{ignore_storage:!0,fullpath:t,target_fullpath:e},(function(t){1==t.status?n&&n(t.status,t):i&&i(t.msg)}),i):(i&&i("Filename has invalid characters"),void TDS_RT.alert("Filename has invalid characters: "+e))},a.prototype.deleteFile=function(t,e,n){if("http://"==t.substr(0,5))throw"CloudBridge does not support full URLs as fullpath";return this.request("files/delete",{fullpath:t},(function(t){1==t.status?e&&e(1==t.status,t):n&&n(t.msg)}),n)},e.a=o,window.CloudBridge=o},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return f}));var i=n(0),r=n(47),o=n(175),a=n(62),s=n(80),l=(n(30),n(172)),c=n(445),u=n(475),h=n(98);function f(e,n){if(this.uuid=t.Math.generateUUID(),this.layer=0,void 0===n){i.LinearFilter,i.LinearFilter,i.RGBAFormat;if(e){var o=e.getSize(new i.Vector2);this._pixelRatio=e.getPixelRatio(),this.width=o.width,this.height=o.height}else this._pixelRatio=1,this.width=1,this.height=1;(n=new i.WebGLRenderTarget(this.width*this._pixelRatio,this.height*this._pixelRatio,f.parameters)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this.width=n.width,this.height=n.height;this.renderer=e,this.renderToScreen=!0,this.passes=[],this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.copyPass=new a.a(r.a),this.clock=new i.Clock}f.DEFAULT_LAYER=0,f.bufferParameters={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat,stencilBuffer:!1},f.prototype.swapBuffers=function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},f.prototype.addPass=function(t){this.passes.push(t)},f.prototype.moveBack=function(t){var e=this.passes.indexOf(t);if(e>0){for(var n=e;n!==e-1;n-=1)this.passes[n]=this.passes[n-1];return this.passes[e-1]=t,!0}return!1},f.prototype.moveForward=function(t){var e=this.passes.indexOf(t);if(-1!==e&&e<this.passes.length-1){for(var n=e;n!==e+1;n+=1)this.passes[n]=this.passes[n+1];return this.passes[e+1]=t,!0}return!1},f.prototype.removePass=function(t){var e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)},f.prototype.insertPass=function(t,e){this.passes.splice(e,0,t)},f.prototype.isLastEnabledPass=function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},f.prototype.render=function(t,e,n,i){n.layers.set(this.layer);var r=e.background;this.ignoreSceneBackground&&(e.background=null),void 0===i&&(i=this.clock.getDelta()),t&&(this.renderer=t);var a,s,l=this.renderer.getRenderTarget(),c=!1,u=this.passes.length;for(s=0;s<u;s++)if(!1!==(a=this.passes[s]).enabled){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),a.render(this.renderer,this.writeBuffer,this.readBuffer,i,c,e,n),a.needsSwap){if(c){var h=this.renderer.getContext(),d=this.renderer.state.buffers.stencil;d.setFunc(h.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,i,e,n),d.setFunc(h.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==o.b&&(a instanceof o.b?c=!0:a instanceof o.a&&(c=!1))}this.renderer.setRenderTarget(l),r&&(e.background=r),n.layers.set(f.DEFAULT_LAYER)},f.prototype.setSize=function(t,e){t=Math.floor(t),e=Math.floor(e),this.width=t,this.height=e,this.writeBuffer.setSize(t,e),this.readBuffer.setSize(t,e);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(t,e)},f.prototype.reset=function(){if(void 0===renderTarget){var t=this.renderer.getSize(new i.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this.width=t.width,this.height=t.height,renderTarget=this.renderTarget1.clone(),renderTarget.setSize(this.width*this._pixelRatio,this.height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=renderTarget,this.renderTarget2=renderTarget.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},f.prototype.dispose=function(){this.writeBuffer.dispose(),this.readBuffer.dispose(),this.writeBuffer=null,this.readBuffer=null},f.prototype.toJSON=function(){var t={};t.uuid=this.uuid,t.passes=[];for(var e=0;e<this.passes.length;e++)t.passes.push(this.passes[e].toJSON());return t},f.fromJSON=function(t){var e=new f;e.uuid=t.uuid;for(var n=0;n<t.passes.length;n++){var i=t.passes[n],r=null;if("UnrealBloom"===i.type){(r=new l.a).strength=i.strength,r.radius=i.radius,r.threshold=i.threshold,r.bloomFactors=i.bloomFactors;for(n=0;n<r.bloomTintColors.length;n++)r.bloomTintColors[n].fromArray(i.bloomTintColors[n])}else r="Bloom"===i.type?new u.a(i.strength,i.kernelSize,i.sigma,i.resolution):"FXAA"===i.type?new h.a:"Copy"===i.type?new c.a:new s.a;r.uuid=i.uuid,r.enabled=i.enabled,r.needsSwap=i.needsSwap,r.renderToScreen=i.renderToScreen,r.clear=i.clear,r.copyToScreen=!0===i.copyToScreen,e.addPass(r)}return e}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(53),r=n(108);function o(t,e,n){i.a.call(this),this.object=t,this.index=void 0!==n?n:-1,this.parent=e}o.prototype.apply=function(){-1!==this.index?(this.parent.children.splice(this.index,0,this.object),this.object.parent=this.parent):(this.parent.add(this.object),this.index=this.parent.children.indexOf(this.object)),o.updateInterface(this.object,this.parent,this.index)},o.prototype.revert=function(){this.parent.remove(this.object),r.a.updateInterface(this.object,this.parent)},o.updateInterface=function(t,e,n){GUI.sceneTree.addObject(t,e,n)}},function(t,e,n){"use strict";function i(){}i.list=[],i.themes=[],i.prototype.register=function(t,e){i.list.push(e),i.themes[e]=t},i.prototype.get=function(t){return i.themes[t]},i.prototype.getList=function(){return i.list},e.a=new i},function(t,e,n){"use strict";(function(t){function i(){this.backend=i.WEBGL2,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.antialiasing=!0,this.shadows=!0,this.stencil=!0,this.shadowsType=t.PCFSoftShadowMap,this.shadowsAutoUpdate=!0,this.toneMapping=t.NoToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.precision="highp",this.alpha=!0,this.premultipliedAlpha=!0,this.preserveDrawingBuffer=!1,this.powerPreference="high-performance",this.logarithmicDepthBuffer=!1,this.physicallyCorrectLights=!1,this.checkShaderErrors=!0}n.d(e,"a",(function(){return i})),i.WEBGL=1,i.WEBGL2=2,i.prototype.createRenderer=function(e){var n=null;if(this.backend===i.WEBGL2)try{n=e.getContext("webgl2")}catch(t){}var r=new t.WebGLRenderer({canvas:e,context:n,precision:this.precision,alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,antialias:this.antialiasing,stencil:this.stencil,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:this.powerPreference,logarithmicDepthBuffer:this.logarithmicDepthBuffer});return r.autoClear=this.autoClear,r.autoClearColor=this.autoClearColor,r.autoClearDepth=this.autoClearDepth,r.autoClearStencil=this.autoClearStencil,r.shadowMap.enabled=this.shadows,r.shadowMap.type=this.shadowsType,r.shadowMap.autoUpdate=this.shadowsAutoUpdate,r.shadowMap.needsUpdate=!1,r.toneMapping=this.toneMapping,r.toneMappingExposure=this.toneMappingExposure,r.toneMappingWhitePoint=this.toneMappingWhitePoint,r.debug.checkShaderErrors=this.checkShaderErrors,r.sortObjects=this.sortObjects,r.gammaFactor=this.gammaFactor,r.gammaInput=this.gammaInput,r.gammaOutput=this.gammaOutput,r.physicallyCorrectLights=this.physicallyCorrectLights,r},i.prototype.toJSON=function(){return{backend:this.backend,autoClear:this.autoClear,autoClearColor:this.autoClearColor,autoClearDepth:this.autoClearDepth,autoClearStencil:this.autoClearStencil,antialiasing:this.antialiasing,shadows:this.shadows,stencil:this.stencil,shadowsType:this.shadowsType,shadowsAutoUpdate:this.shadowsAutoUpdate,toneMapping:this.toneMapping,toneMappingExposure:this.toneMappingExposure,toneMappingWhitePoint:this.toneMappingWhitePoint,sortObjects:this.sortObjects,checkShaderErrors:this.checkShaderErrors,gammaFactor:this.gammaFactor,gammaInput:this.gammaInput,gammaOutput:this.gammaOutput,precision:this.precision,alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:this.powerPreference,logarithmicDepthBuffer:this.logarithmicDepthBuffer,physicallyCorrectLights:this.physicallyCorrectLights}},i.prototype.fromJSON=function(t){this.backend=t.backend,this.autoClear=t.autoClear,this.autoClearColor=t.autoClearColor,this.autoClearDepth=t.autoClearDepth,this.autoClearStencil=t.autoClearStencil,this.antialiasing=t.antialiasing,this.shadows=t.shadows,this.stencil=t.stencil,this.shadowsType=t.shadowsType,this.shadowsAutoUpdate=t.shadowsAutoUpdate,this.toneMapping=t.toneMapping,this.toneMappingExposure=t.toneMappingExposure,this.toneMappingWhitePoint=t.toneMappingWhitePoint,this.sortObjects=t.sortObjects,this.checkShaderErrors=t.checkShaderErrors,this.gammaFactor=t.gammaFactor,this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.precision=t.precision,this.alpha=t.alpha,this.premultipliedAlpha=t.premultipliedAlpha,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.powerPreference=t.powerPreference,this.logarithmicDepthBuffer=t.logarithmicDepthBuffer,this.physicallyCorrectLights=t.physicallyCorrectLights}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=[].slice;function r(){}r.extend=function(){var t,e,n,r,o,a,s;for(r=arguments[0],a=0,s=(n=2<=arguments.length?i.call(arguments,1):[]).length;a<s;a++)for(t in e=n[a])o=e[t],r[t]=o}},function(t,e,n){"use strict";var i,r,o=n(0),a=n(102),s=n(134),l=function(t,e){o.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new a.a,this.material=void 0!==e?e:new s.a({color:16777215*Math.random()})};l.prototype=Object.assign(Object.create(o.Mesh.prototype),{constructor:l,isLineSegments2:!0,computeLineDistances:(i=new o.Vector3,r=new o.Vector3,function(){for(var t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,a=new Float32Array(2*e.data.count),s=0,l=0,c=e.data.count;s<c;s++,l+=2)i.fromBufferAttribute(e,s),r.fromBufferAttribute(n,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+i.distanceTo(r);var u=new o.InstancedInterleavedBuffer(a,2,1);return t.setAttribute("instanceDistanceStart",new o.InterleavedBufferAttribute(u,1,0)),t.setAttribute("instanceDistanceEnd",new o.InterleavedBufferAttribute(u,1,1)),this}),raycast:function(){var t=new o.Vector4,e=new o.Vector4,n=new o.Vector4,i=new o.Vector3,r=new o.Matrix4,a=new o.Line3,s=new o.Vector3;return function(l,c){null===l.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=l.ray,h=l.camera,f=h.projectionMatrix,d=this.geometry,p=this.material,m=p.resolution,g=p.linewidth,v=d.attributes.instanceStart,y=d.attributes.instanceEnd;u.at(1,n),n.w=1,n.applyMatrix4(h.matrixWorldInverse),n.applyMatrix4(f),n.multiplyScalar(1/n.w),n.x*=m.x/2,n.y*=m.y/2,n.z=0,i.copy(n);var x=this.matrixWorld;r.multiplyMatrices(h.matrixWorldInverse,x);for(var b=0,w=v.count;b<w;b++){t.fromBufferAttribute(v,b),e.fromBufferAttribute(y,b),t.w=1,e.w=1,t.applyMatrix4(r),e.applyMatrix4(r),t.applyMatrix4(f),e.applyMatrix4(f),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w);var _=t.z<-1&&e.z<-1,M=t.z>1&&e.z>1;if(!_&&!M){t.x*=m.x/2,t.y*=m.y/2,e.x*=m.x/2,e.y*=m.y/2,a.start.copy(t),a.start.z=0,a.end.copy(e),a.end.z=0;var S=a.closestPointToPointParameter(i,!0);a.at(S,s);var T=o.MathUtils.lerp(t.z,e.z,S),A=T>=-1&&T<=1,E=i.distanceTo(s)<.5*g;if(A&&E){a.start.fromBufferAttribute(v,b),a.end.fromBufferAttribute(y,b),a.start.applyMatrix4(x),a.end.applyMatrix4(x);var q=new o.Vector3,C=new o.Vector3;u.distanceSqToSegment(a.start,a.end,C,q),c.push({point:C,pointOnLine:q,distance:u.origin.distanceTo(C),object:this,face:null,faceIndex:b,uv:null,uv2:null})}}}}}()});var c=n(85);n.d(e,"a",(function(){return u}));var u=function(t,e){l.call(this),this.type="Line2",this.geometry=void 0!==t?t:new c.a,this.material=void 0!==e?e:new s.a({color:16777215*Math.random()})};u.prototype=Object.assign(Object.create(l.prototype),{constructor:u,isLine2:!0})},function(t,e,n){"use strict";var i=n(111),r=Object(i.mixin)(i);r._=r;n.d(e,"d",(function(){return i.keys})),n.d(e,"b",(function(){return i.isElement})),n.d(e,"a",(function(){return i.isArray})),n.d(e,"c",(function(){return i.isUndefined}))},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return l}));var i=n(436),r=n(34),o=n(79),a=n(17),s=n(3);function l(e,n){this.group=new i.a(void 0!==e?e:l.defaultGroup),this.emitter=new o.a(void 0!==n?n:r.a.defaultEmitter),this.group.addEmitter(this.emitter),t.Points.call(this,this.group.geometry,this.group.material),this.type="ParticlePoints",this.name="particle",this.frustumCulled=!1,this.dynamicEmitter=!1,this.temp=new t.Vector4,this.clock=new t.Clock;var a=this;Object.defineProperties(this,{texture:{get:function(){return a.group.texture},set:function(t){a.group.texture=t}}})}n(237),l.prototype=Object.create(t.Points.prototype),l.defaultGroup={texture:{value:new a.a(s.a.get("Particle"))},maxParticleCount:200,blending:t.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},l.snowGroup={texture:{value:new a.a(s.a.get("Snow"))},maxParticleCount:200,blending:t.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},l.rainGroup={texture:{value:new a.a(s.a.get("Raindrop"))},maxParticleCount:200,blending:t.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},l.leafGroup={texture:{value:new a.a(s.a.get("Leaf"))},maxParticleCount:200,blending:t.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},l.fountainGroup={texture:{value:new a.a(s.a.get("Raindrop"))},maxParticleCount:1e3,blending:t.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!0,hasPerspective:!0},l.prototype.raycast=function(e,n){null===this.geometry.boundingBox&&this.geometry.computeBoundingBox();var i=new t.Box3;i.copy(this.geometry.boundingBox),i.applyMatrix4(this.matrixWorld),null!==e.ray.intersectBox(i,new t.Vector3)&&n.push({object:this})},l.prototype.updateMatrix=function(){this.dynamicEmitter?(this.matrix.makeRotationFromQuaternion(this.quaternion),this.matrix.scale(this.scale)):this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},l.prototype.onBeforeRender=function(t,e,n,i){this.group.uniforms.scale.value=t.getCurrentViewport(this.temp).w,this.group.tick(this.clock.getDelta(),this.clock.getElapsedTime()),!0===this.dynamicEmitter&&(this.emitter.position.value=this.position)},l.prototype.toJSON=function(e){var n=this.material,i=this.geometry;this.material=void 0,this.geometry=void 0;var r=this.group.texture,o=t.Object3D.prototype.toJSON.call(this,e,(function(t,e){r=r.toJSON(t)}));return this.material=n,this.geometry=i,o.object.group=this.group.toJSON(e),o.object.emitter=this.emitter.toJSON(e),o},l.prototype.dispose=function(){this.group.dispose(),t.Object3D.prototype.dispose.call(this)}}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n,o,a,s,l){var c=r.call(this,e);this.className="LineEntity",this.name="Line",this.type="Line",this.lineWidth=1|l,this.vertices=[],this.loop=!1|a,this.dashed=!1|s,this.color=o||16777215;var u=null;(u=this.dashed?new t.LineDashedMaterial({color:this.color,dashSize:1,gapSize:.5}):new t.LineBasicMaterial({color:this.color,linewidth:this.lineWidth})).name="line",void 0===n?(this.vertices.push(new t.Vector3(-1,0,0)),this.vertices.push(new t.Vector3(0,0,0)),this.vertices.push(new t.Vector3(1,0,0))):this.vertices=n;var h,f=(new t.BufferGeometry).setFromPoints(this.vertices);(h=this.loop?new t.LineLoop(f,u):new t.Line(f,u)).computeLineDistances();var d=new i.default(this,h);return c.addComponent(d),this.object3D=d.object3D,c}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getMesh=function(){return this.object3D},e.default=o("LineEntity",a)}.call(this,n(0))},,,function(t,e,n){"use strict";var i={uniforms:{tDiffuse:{value:null},resolution:{value:new(n(0).Vector2)(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},r=n(62);function o(){r.a.call(this,i),this.type="FXAA"}n.d(e,"a",(function(){return o})),o.prototype=Object.create(r.a.prototype),o.prototype.setSize=function(t,e){this.uniforms.resolution.value.set(1/t,1/e)}},function(t,e,n){"use strict";n.r(e),function(t){n(239),n(88),n(29);var i=n(135),r=n(44),o=n(26),a=n(5).Component,s=n(5).registerComponent;function l(t,e,n,i){var r=a.call(this,t,e);return this.name="physics",this.type="Physics",this.coordSystem=l.LOCAL,this.body=new CANNON.Body,this.body.type=CANNON.Body.DYNAMIC,this.body.mass=1,this.shape=null,this.merge=!0,this.system=n,this.world=void 0!==n?n.world:void 0,this.material=void 0!==i?i:void 0,this.shapeType,this.friction=.4,this.restitution=.3,this.upforcePerVolume=100,this.viscosity=.8,r}l.prototype=Object.create(a.prototype),l.prototype.init=function(){var e=this,n=this.entity.object3D;if(!(n instanceof t.Mesh||n instanceof t.SkinnedMesh||n instanceof t.Group||n instanceof t.Scene))return TDS_RT.alert("Physics can only be applied to scene or meshes"),null;if(this.body.entity=this.entity,void 0===this.world){var o=TDS_RT.program.getScene(this.entity);o&&(this.system=o.physics,this.world=this.system.world)}"Water"==this.entity.type&&(-1==this.system.waters.indexOf(this.body)&&this.system.waters.push(this.body),this.body.collisionResponse=!1);var a=this.system.materials.ground;if(void 0===this.material){if(this.material=this.body.material=new CANNON.Material(n.name),this.body.material.id!=a.id){var s=new CANNON.ContactMaterial(a,this.body.material,{friction:this.friction,restitution:this.restitution});this.world.addContactMaterial(s)}}else this.body.material=this.material,(s=this.world.getContactMaterial(a,this.material)).friction=this.friction,s.restitution=this.restitution;if(this.body.shapes=[],n instanceof t.Group||n.isScene?n.traverse((function(n){n instanceof t.Mesh&&e.addShape(i.a.createShape(n,void 0,e.coordSystem))})):this.addShape(i.a.createShape(n,this.shapeType)),this.coordSystem===l.WORLD)this.body.position.copy(n.position),this.body.quaternion.copy(n.quaternion);else if(this.coordSystem===l.LOCAL){var c=new t.Vector3;n.getWorldPosition(c),this.body.position.copy(c);var u=new t.Quaternion;n.getWorldQuaternion(u),this.body.quaternion.copy(u)}return this.world.addBody(this.body),r.levent.bind(this.entity,"child-reloaded",()=>{}),r.levent.bind(TDS_RT,"object3d_removed",()=>{let t=e.world.bodies.indexOf(e.body);t>-1&&e.world.bodies.splice(t,1)}),this},l.prototype.reload=function(){this.dispose(),this.init()},l.prototype.attached=function(){},l.prototype.update=function(e){if(this.enabled&&TDS_RT.program.mode!==o.a.MODE_EDITING)if(this.coordSystem===l.WORLD)this.entity.position.copy(this.body.position),this.body.fixedRotation||this.entity.quaternion.copy(this.body.quaternion);else if(this.coordSystem===l.LOCAL){var n=new t.Matrix4;if(this.body.fixedRotation)n.setPosition(this.body.position.x,this.body.position.y,this.body.position.z);else{var i=new t.Quaternion;i.copy(this.body.quaternion),n.makeRotationFromQuaternion(i),n.setPosition(this.body.position.x,this.body.position.y,this.body.position.z)}var r=new t.Matrix4;r.getInverse(this.entity.parent.matrixWorld);var a=new t.Vector3;r.multiply(n),r.decompose(this.entity.position,this.entity.quaternion,a)}},l.prototype.addShape=function(t){t instanceof CANNON.Shape&&this.body.addShape(t)},l.prototype.dispose=function(){this.body.shapes=[];var t=this.world.bodies.indexOf(this.body);t>-1&&this.world.bodies.splice(t,1)},l.prototype.toJSON=function(t){var e=a.prototype.toJSON.call(this,t);e.object.body={},e.object.body.type=this.body.type,e.object.body.mass=this.body.mass,e.object.body.linearDamping=this.body.linearDamping,e.object.body.angularDamping=this.body.angularDamping,e.object.body.allowSleep=this.body.allowSleep,e.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit,e.object.body.sleepTimeLimit=this.body.sleepTimeLimit,e.object.body.collisionFilterGroup=this.body.collisionFilterGroup,e.object.body.collisionFilterMask=this.body.collisionFilterMask,e.object.body.fixedRotation=this.body.fixedRotation,e.object.body.shapes=[];for(var n=this.body.shapes,i=0;i<n.length;i++){var r=n[i],o={};o.type=r.type,r.type===CANNON.Shape.types.SPHERE?o.radius=r.radius:r.type===CANNON.Shape.types.BOX?(o.halfExtents={},o.halfExtents.x=r.halfExtents.x,o.halfExtents.y=r.halfExtents.y,o.halfExtents.z=r.halfExtents.z):r.type===CANNON.Shape.types.CONVEXPOLYHEDRON?(o.vertices=r.vertices,o.faces=r.faces):r.type===CANNON.Shape.types.TRIMESH&&(o.vertices=r.vertices,o.normals=r.normals,o.edges=r.edges,o.indices=r.indices),e.object.body.shapes[i]=o}return e},l.WORLD=100,l.LOCAL=101,e.default=s("physics",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n,o){var a,s=r.call(this,e);if(this.className="PlaneEntity",this.name=n||"Plane",this.type="Plane",this.isPrimitive=!0,this.width=10,this.height=10,e)a=new i.default(this,e);else{var l=new t.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.1});l.name="default",(a=new i.default(this,e,new t.PlaneBufferGeometry(this.width,this.height,10,10),l)).position.set(0,0,0),a.rotation.x=-Math.PI/2}return s.addComponent(a),this.object3D=a.object3D,s}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getMesh=function(){return this.object3D},e.default=o("PlaneEntity",a)}.call(this,n(0))},,function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i,r,o=n(0),a=function(){o.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new o.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new o.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};a.prototype=Object.assign(Object.create(o.InstancedBufferGeometry.prototype),{constructor:a,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new o.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new o.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new o.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new o.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new o.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new o.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new o.WireframeGeometry(t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},computeBoundingBox:(r=new o.Box3,function(){null===this.boundingBox&&(this.boundingBox=new o.Box3);var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),r.setFromBufferAttribute(e),this.boundingBox.union(r))}),computeBoundingSphere:(i=new o.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var r=0,a=0,s=t.count;a<s;a++)i.fromBufferAttribute(t,a),r=Math.max(r,n.distanceToSquared(i)),i.fromBufferAttribute(e,a),r=Math.max(r,n.distanceToSquared(i));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}})},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(83),r=n(91);function o(t,e){i.a.call(this,t,e),this.targetData=t,this.particles,this.container=this.targetData.container,this.validPixelArrayOffsets=[],this.maxW=0,this.maxH=0,this.offsetX=0,this.offsetY=0,this.imageData,this.aspectFillImageScaleX=1,this.aspectFillImageScaleY=1,this.opts={numParticles:1e4,respondsToMouse:!1,size:.01,sort:null},r.a.extend(this.opts,e)}o.prototype=Object.create(i.a.prototype),o.prototype.init=function(){return this.resize()},o.prototype.destroy=function(){},o.prototype.resize=function(t,e){var n=this.container;if(n||(n=TDS_RT.program.getActiveCanvas()),n)return t&&e?(this.maxW=t,this.maxH=e):(this.maxW=n.width,this.maxH=n.height),this.imageData&&(this.updatePositionAdjustments(),this.particles)?this.updateParticlePositions():void 0},o.prototype.updatePositionAdjustments=function(){var t,e,n;n=this.maxW,t=this.maxH,this.maxW/this.maxH>(e=this.imageData.width/this.imageData.height)?t=(n=this.maxW)/e:n=(t=this.maxH)*e,this.aspectFillImageScaleX=n/this.imageData.width,this.aspectFillImageScaleY=t/this.imageData.height,this.offsetX=(this.maxW-this.imageData.width)/2,this.offsetY=-(this.maxH-this.imageData.height)/2},o.prototype.updateParticlePositions=function(){var t,e,n,i,r,o;for(o=[],n=0,i=(r=this.particles.geometry.vertices).length;n<i;n++)e=r[n],t=this.getVertexForPixelDataOffset(e.userData.pixelOffset),e.x=t.x,e.y=t.y,o.push(e.z=t.z);return o},o.prototype.load=function(e){return i.a.prototype.load.call(this,e),this.onLoad=t=>{this.processImage(t),i.a.prototype.onLoad.call(this)},(new t.ImageLoader).load(this.targetData.url,this.onLoad)},o.prototype.processImage=function(t){var e=this.getImageDataFromImg(t);this.processImageData(e)},o.prototype.processImageData=function(e){var n,i,r,o,a,s,l,c;for(this.imageData=e,this.updatePositionAdjustments(),i=a=3,l=this.imageData.data.length;a<l;i=a+=4)this.imageData.data[i]>0&&this.validPixelArrayOffsets.push(i-3);for(n=new t.Geometry,i=s=0,c=this.opts.numParticles;s<c;i=s+=1)o=this.randomVertexInImage(),n.vertices.push(o);null!=this.opts.sort&&n.vertices.sort(this.opts.sort),r=new t.PointsMaterial({size:this.opts.size}),this.particles=new t.Points(n,r)},o.prototype.getImageDataFromImg=function(t){var e,n;return(e=document.createElement("canvas")).width=t.width,e.height=t.height,(n=e.getContext("2d")).drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)},o.prototype.randomVertexInImage=function(){var t,e;return e=Math.floor(Math.random()*this.validPixelArrayOffsets.length),t=this.validPixelArrayOffsets[e],this.getVertexForPixelDataOffset(t)},o.prototype.getVertexForPixelDataOffset=function(e){var n,i,r,o,a,s,l;return o=this.imageData.data[e],r=this.imageData.data[e+1],n=this.imageData.data[e+2],i=4*this.imageData.width,s=Math.ceil(e%i/4),l=Math.ceil(e/i),(a=new t.Vector3(s,l,0)).userData={color:{r:o/255,g:r/255,b:n/255},pixelOffset:e},this.centerVertex(a),this.scalevertex(a),a},o.prototype.centerVertex=function(t){return t.x-=this.maxW/2,t.y=-t.y+this.maxH/2,t.x+=this.offsetX,t.y+=this.offsetY},o.prototype.scalevertex=function(t){t.x*=this.aspectFillImageScaleX/512,t.y*=this.aspectFillImageScaleY/512},o.prototype.getParticles=function(){return this.particles}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return l}));var i=n(32),r=n(107),o=n(65),a=n(40),s=(n(156),n(28));n(190);function l(){t.Object3D.call(this),l.Resources.call(this)}l.Resources=function(){this.images=[],this.videos=[],this.audio=[],this.fonts=[],this.materials=[],this.textures=[],this.geometries=[],this.models=[],this.resources=[],this.shapes=[],this.skeletons=[]},l.prototype=Object.create(t.Object3D.prototype),l.prototype.reset=function(){},l.prototype.dispose=function(){for(var t in this.geometries)this.geometries[t].dispose();for(var t in this.textures)this.textures[t].dispose();for(var t in this.materials)this.materials[t].dispose()},l.prototype.removeGeometry=function(t,e){this.traverse((function(n){void 0!==n.geometry&&n.geometry.uuid===t.uuid&&(n.geometry=e)})),delete this.geometries[t.uuid]},l.prototype.getResourceByName=function(t){for(var e in this.resources)if(this.resources[e].name===t)return this.resources[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.addResource=function(t){t instanceof s.a&&(this.resources[t.uuid]=t)},l.prototype.removeResource=function(t){delete this.resources[t.uuid]},l.prototype.getImageByName=function(t){for(var e in this.images)if(this.images[e].name===t)return this.images[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.removeImage=function(t){t instanceof i.a&&delete this.images[t.uuid]},l.prototype.getVideoByName=function(t){for(var e in this.videos)if(this.videos[e].name===t)return this.videos[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.removeVideo=function(t){t instanceof a.a&&delete this.videos[t.uuid]},l.prototype.getMaterialByName=function(t){for(var e in this.materials)if(this.materials[e].name===t)return this.materials[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.addMaterial=function(e){e instanceof t.Material&&(this.materials[e.uuid]=e)},l.prototype.removeMaterial=function(e,n,i){void 0===n&&(n=new t.MeshBasicMaterial),void 0===i&&(i=new t.SpriteMaterial),e instanceof t.Material&&(delete this.materials[e.uuid],this.traverse((function(r){void 0!==r.material&&r.material.uuid===e.uuid&&(r instanceof t.Sprite?r.material=i:r.material=n)})))},l.prototype.getTextureByName=function(t){for(var e in this.textures)if(this.textures[e].name===t)return this.textures[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.addTexture=function(e){material instanceof t.Texture&&(this.textures[e.uuid]=e)},l.prototype.removeTexture=function(e,n){void 0===n&&(n=new t.Texture),e instanceof t.Texture&&(delete this.textures[e.uuid],this.traverse((function(t){if(void 0!==t.material){var i=t.material;null!=i.map&&i.map.uuid===e.uuid&&(i.map=n,i.needsUpdate=!0),null!=i.bumpMap&&i.bumpMap.uuid===e.uuid&&(i.bumpMap=n,i.needsUpdate=!0),null!=i.normalMap&&i.normalMap.uuid===e.uuid&&(i.normalMap=n,i.needsUpdate=!0),null!=i.displacementMap&&i.displacementMap.uuid===e.uuid&&(i.displacementMap=n,i.needsUpdate=!0),null!=i.specularMap&&i.specularMap.uuid===e.uuid&&(i.specularMap=n,i.needsUpdate=!0),null!=i.emissiveMap&&i.emissiveMap.uuid===e.uuid&&(i.emissiveMap=n,i.needsUpdate=!0),null!=i.alphaMap&&i.alphaMap.uuid===e.uuid&&(i.alphaMap=n,i.needsUpdate=!0),null!=i.roughnessMap&&i.roughnessMap.uuid===e.uuid&&(i.roughnessMap=n,i.needsUpdate=!0),null!=i.metalnessMap&&i.metalnessMap.uuid===e.uuid&&(i.metalnessMap=n,i.needsUpdate=!0),null!=i.envMap&&i.envMap.uuid===e.uuid&&(i.envMap=null,i.needsUpdate=!0)}else t instanceof ParticleEmitter&&t.group.texture.uuid===e.uuid&&(t.group.texture=n)})))},l.prototype.getFontByName=function(t){for(var e in this.fonts)if(this.fonts[e].name===t)return this.fonts[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.addFont=function(t){t instanceof r.a&&(this.fonts[t.uuid]=t)},l.prototype.removeFont=function(t,e){void 0===e&&(e=new r.a),t instanceof r.a&&(delete this.fonts[t.uuid],this.traverse((function(n){void 0!==n.font&&n.font.uuid===t.uuid&&n.setFont(e)})))},l.prototype.getAudioByName=function(t){for(var e in this.audio)if(this.audio[e].name===t)return this.audio[e];return console.warn("TDS: Resource "+t+" not found"),null},l.prototype.addAudio=function(t){t instanceof o.a&&(this.audio[t.uuid]=t)},l.prototype.removeAudio=function(t,e){void 0===e&&(e=new o.a),t instanceof o.a&&(delete this.audio[t.uuid],this.traverse((function(n){void 0!==n.audio&&n.audio.uuid===t.uuid&&n.setAudio(e)})))}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(52),r=n(87),o=n(80),a=n(5).Component,s=n(5).registerComponent,l=function(t,e,n,s,c,u,h){var f=a.call(this,t,e);this.mode=void 0!==c?c:l.RESIZE_HORIZONTAL,this.viewport=new i.a,this.composer=new r.a;var d=new o.a;return d.renderToScreen=!0,this.composer.addPass(d),e||this.createObject3D(n,s,c,u,h),f};l.IS_EXPOSED=!1,l.RESIZE_HORIZONTAL=0,l.RESIZE_VERTICAL=1,l.prototype=Object.create(a.prototype),l.prototype.createObject3D=function(e,n,i,r,o){n=(n=e||10)||1,r=r||.1,o=o||1e3;(i=i||l.RESIZE_HORIZONTAL)===l.RESIZE_HORIZONTAL?this.object3D=new t.OrthographicCamera(e*n/-2,e*n/2,e/2,e/-2,r,o):this.object3D=new t.OrthographicCamera(e/-2,e/2,e*n/2,e*n/-2,r,o)},l.prototype.init=function(){this.name="o-camera",this.type="OrthographicCamera"},l.prototype.remove=function(){this.entity.removeObject3D("camera")},l.prototype.resize=function(t,e){this.aspect=t/e,this.update()},l.prototype.update=function(){var t=this.object3D;t.left=-this.size*this.aspect/2,t.right=this.size*this.aspect/2,t.top=this.size/2,t.bottom=-this.size/2,t.updateProjectionMatrix(),this.composer.setSize(this.size*this.aspect,this.size)},l.prototype.setupRenderer=function(t){},l.prototype.render=function(t,e){this.composer.render(t,e.object3D,this.object3D,.016)},l.prototype.destroy=function(){var e=TDS_RT.program.getScene(this.entity);null!==e&&e.removeCamera(this.entity),t.Object3D.prototype.destroy.call(this)},l.prototype.fromJSON=function(t,e){return a.prototype.fromJSON.call(this,t,e),this.order=t.object.order,this.viewport=(new i.a).fromJSON(t.object.viewport,e),this},l.prototype.toJSON=function(t){var e=a.prototype.toJSON.call(this,t),n=this.object3D;return e.object.viewport=n.viewport.toJSON(),e.object.order=this.order,e},e.a=s("o-camera",l)}).call(this,n(0))},,function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(16),r=n(28);function o(t){r.a.call(this,"font","Font"),this.reversed=!1,this.font=null,void 0!==t&&(t instanceof ArrayBuffer?(this.data=t,this.format="arraybuffer",this.loadTTF()):"object"==typeof t?(this.data=t,this.font=t,this.format="json",this.encoding="json"):(this.encoding=i.a.getFileExtension(t),this.name=i.a.getFileName(t),"json"===this.encoding?(this.data=JSON.parse(i.a.readFile(t)),this.format="json",this.font=this.data):"ttf"!==this.encoding&&"otf"!==this.encoding&&"ttc"!==this.encoding&&"otc"!==this.encoding||(this.data=i.a.readFileArrayBuffer(t),this.format="arraybuffer",this.loadTTF())))}o.prototype=Object.create(r.a.prototype),o.fileIsFont=function(t){return void 0!==t&&((t=t.name.toLocaleLowerCase()).endsWith("ttf")||t.endsWith("otf")||t.endsWith("ttc")||t.endsWith("otc")||t.endsWith("json"))},o.prototype.isFont=!0,o.prototype.reverseGlyphs=function(){this.reversed=!this.reversed,this.loadTTF()},o.prototype.loadTTF=function(){var e=new t.TTFLoader;e.reversed=this.reversed,this.font=e.parse(this.data)},o.prototype.toJSON=function(t){if(void 0!==t.fonts[this.uuid])return t.fonts[this.uuid];var e=r.a.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.reversed=this.reversed,"arraybuffer"===this.format?(e.data=this.data,e.format=this.format):"base64"===this.format?(e.data=ArraybufferUtils.fromBase64(this.data),e.format="arraybuffer"):(e.data=this.data,e.format=this.format),t.fonts[this.uuid]=e,e},o.prototype.generateShapes=function(e,n,i){void 0===n&&(n=100),void 0===i&&(i=10);for(var r=this.font,o=function(t){for(var e=String(t).split(""),i=n/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin)*i,a=0,s=0,c=[],u=0;u<e.length;u++){var h=e[u];if("\n"===h)s-=o,a=0;else{var f=l(h,i,a,s);a+=f.width,c.push(f.path)}}return c}(e),a=[],s=0;s<o.length;s++)Array.prototype.push.apply(a,o[s].toShapes());return a;function l(e,n,o,a){var s=r.glyphs[e]||r.glyphs["?"];if(s){var l,c,u,h,f,d,p,m,g,v,y,x=new t.ShapePath,b=[],w=t.ShapeUtils.b2,_=t.ShapeUtils.b3;if(s.o)for(var M=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),S=0,T=M.length;S<T;){var A=M[S++];if("m"===A&&(l=M[S++]*n+o,c=M[S++]*n+a,x.moveTo(l,c)),"l"===A)l=M[S++]*n+o,c=M[S++]*n+a,x.lineTo(l,c);else if("q"===A){if(u=M[S++]*n+o,h=M[S++]*n+a,p=M[S++]*n+o,m=M[S++]*n+a,x.quadraticCurveTo(p,m,u,h),y=b[b.length-1]){f=y.x,d=y.y;for(var E=1;E<=i;E++){w(q=E/i,f,p,u),w(q,d,m,h)}}}else if("b"===A&&(u=M[S++]*n+o,h=M[S++]*n+a,p=M[S++]*n+o,m=M[S++]*n+a,g=M[S++]*n+o,v=M[S++]*n+a,x.bezierCurveTo(p,m,g,v,u,h),y=b[b.length-1])){f=y.x,d=y.y;for(E=1;E<=i;E++){var q;_(q=E/i,f,p,g,u),_(q,d,m,v,h)}}}return{width:s.ha*n,path:x}}}}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(53),r=n(88);function o(t,e){i.a.call(this),this.object=t,this.parent=void 0!==e?e:t.parent,this.index=-1}o.prototype.apply=function(){if(this.object.isCamera){var t=TDS_RT.program.getScene(this.object);null!==t&&t.removeCamera(this.object)}this.index=this.parent.children.indexOf(this.object),this.parent.remove(this.object),o.updateInterface(this.object,this.parent)},o.prototype.revert=function(){-1===this.index?this.parent.add(this.object):(this.parent.children.splice(this.index,0,this.object),this.parent.object3D.add(this.object.object3D),this.object.parent=this.parent),r.a.updateInterface(this.object,this.parent,this.index)},o.updateInterface=function(t,e){Editor.isSelected(t)&&Editor.unselectObject(t),GUI.sceneTree.removeObject(t,e)}},,function(t,e,n){"use strict";(function(t){var n={getRoot:function(t){for(var e=t;null!==e.parent;)e=e.parent;return e},scaleAndCenterObject:function(e){var i=n.calculateBoundingBox(e);if(null!==i){var r=new t.Vector3;i.getSize(r);var o=1/(r.x>r.y?r.x>r.z?r.x:r.z:r.y>r.z?r.y:r.z),a=new t.Vector3;i.getCenter(a),a.multiplyScalar(o),e.scale.set(o,o,o),e.position.set(-a.x,-o*i.min.y,-a.z)}},calculateBoundingBox:function(t){var e=null;return t.traverse((function(t){if(void 0!==t.geometry){t.geometry.computeBoundingBox();var n=t.geometry.boundingBox;null===e?e=n.clone():(n.min.x<e.min.x&&(e.min.x=n.min.x),n.max.x>e.max.x&&(e.max.x=n.max.x),n.min.y<e.min.y&&(e.min.y=n.min.y),n.max.y>e.max.y&&(e.max.y=n.max.y),n.min.z<e.min.z&&(e.min.z=n.min.z),n.max.z>e.max.z&&(e.max.z=n.max.z))}})),e},recalculateGeometryOrigin:function(e){e.traverse((function(e){if(void 0!==e.geometry){e.geometry.computeBoundingBox();var n=e.geometry.boundingBox.clone().getCenter(new t.Vector3);e.position.add(n);var i=new t.Matrix4;i.makeTranslation(-n.x,-n.y,-n.z),e.geometry.applyMatrix(i)}}))},convertToBufferGeometry:function(e){e.traverse((function(e){void 0!==e.geometry&&!0===e.geometry.isGeometry&&(e.geometry=(new t.BufferGeometry).fromGeometry(e.geometry))}))}};e.a=n}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return v})),n.d(e,"VERSION",(function(){return y})),n.d(e,"iteratee",(function(){return w})),n.d(e,"restArguments",(function(){return M})),n.d(e,"each",(function(){return R})),n.d(e,"forEach",(function(){return R})),n.d(e,"map",(function(){return L})),n.d(e,"collect",(function(){return L})),n.d(e,"reduce",(function(){return D})),n.d(e,"foldl",(function(){return D})),n.d(e,"inject",(function(){return D})),n.d(e,"reduceRight",(function(){return O})),n.d(e,"foldr",(function(){return O})),n.d(e,"find",(function(){return N})),n.d(e,"detect",(function(){return N})),n.d(e,"filter",(function(){return F})),n.d(e,"select",(function(){return F})),n.d(e,"reject",(function(){return B})),n.d(e,"every",(function(){return z})),n.d(e,"all",(function(){return z})),n.d(e,"some",(function(){return U})),n.d(e,"any",(function(){return U})),n.d(e,"contains",(function(){return k})),n.d(e,"includes",(function(){return k})),n.d(e,"include",(function(){return k})),n.d(e,"invoke",(function(){return j})),n.d(e,"pluck",(function(){return V})),n.d(e,"where",(function(){return G})),n.d(e,"findWhere",(function(){return H})),n.d(e,"max",(function(){return W})),n.d(e,"min",(function(){return X})),n.d(e,"shuffle",(function(){return Y})),n.d(e,"sample",(function(){return Z})),n.d(e,"sortBy",(function(){return Q})),n.d(e,"groupBy",(function(){return K})),n.d(e,"indexBy",(function(){return $})),n.d(e,"countBy",(function(){return tt})),n.d(e,"toArray",(function(){return nt})),n.d(e,"size",(function(){return it})),n.d(e,"partition",(function(){return rt})),n.d(e,"first",(function(){return ot})),n.d(e,"head",(function(){return ot})),n.d(e,"take",(function(){return ot})),n.d(e,"initial",(function(){return at})),n.d(e,"last",(function(){return st})),n.d(e,"rest",(function(){return lt})),n.d(e,"tail",(function(){return lt})),n.d(e,"drop",(function(){return lt})),n.d(e,"compact",(function(){return ct})),n.d(e,"flatten",(function(){return ht})),n.d(e,"without",(function(){return ft})),n.d(e,"uniq",(function(){return dt})),n.d(e,"unique",(function(){return dt})),n.d(e,"union",(function(){return pt})),n.d(e,"intersection",(function(){return mt})),n.d(e,"difference",(function(){return gt})),n.d(e,"unzip",(function(){return vt})),n.d(e,"zip",(function(){return yt})),n.d(e,"object",(function(){return xt})),n.d(e,"findIndex",(function(){return wt})),n.d(e,"findLastIndex",(function(){return _t})),n.d(e,"sortedIndex",(function(){return Mt})),n.d(e,"indexOf",(function(){return Tt})),n.d(e,"lastIndexOf",(function(){return At})),n.d(e,"range",(function(){return Et})),n.d(e,"chunk",(function(){return qt})),n.d(e,"bind",(function(){return Pt})),n.d(e,"partial",(function(){return Rt})),n.d(e,"bindAll",(function(){return Lt})),n.d(e,"memoize",(function(){return It})),n.d(e,"delay",(function(){return Dt})),n.d(e,"defer",(function(){return Ot})),n.d(e,"throttle",(function(){return Nt})),n.d(e,"debounce",(function(){return Ft})),n.d(e,"wrap",(function(){return Bt})),n.d(e,"negate",(function(){return zt})),n.d(e,"compose",(function(){return Ut})),n.d(e,"after",(function(){return kt})),n.d(e,"before",(function(){return jt})),n.d(e,"once",(function(){return Vt})),n.d(e,"keys",(function(){return Xt})),n.d(e,"allKeys",(function(){return Yt})),n.d(e,"values",(function(){return Zt})),n.d(e,"mapObject",(function(){return Qt})),n.d(e,"pairs",(function(){return Jt})),n.d(e,"invert",(function(){return Kt})),n.d(e,"functions",(function(){return $t})),n.d(e,"methods",(function(){return $t})),n.d(e,"extend",(function(){return ee})),n.d(e,"extendOwn",(function(){return ne})),n.d(e,"assign",(function(){return ne})),n.d(e,"findKey",(function(){return ie})),n.d(e,"pick",(function(){return oe})),n.d(e,"omit",(function(){return ae})),n.d(e,"defaults",(function(){return se})),n.d(e,"create",(function(){return le})),n.d(e,"clone",(function(){return ce})),n.d(e,"tap",(function(){return ue})),n.d(e,"isMatch",(function(){return he})),n.d(e,"isEqual",(function(){return de})),n.d(e,"isEmpty",(function(){return pe})),n.d(e,"isElement",(function(){return me})),n.d(e,"isArray",(function(){return ve})),n.d(e,"isObject",(function(){return ye})),n.d(e,"isArguments",(function(){return xe})),n.d(e,"isFunction",(function(){return be})),n.d(e,"isString",(function(){return we})),n.d(e,"isNumber",(function(){return _e})),n.d(e,"isDate",(function(){return Me})),n.d(e,"isRegExp",(function(){return Se})),n.d(e,"isError",(function(){return Te})),n.d(e,"isSymbol",(function(){return Ae})),n.d(e,"isMap",(function(){return Ee})),n.d(e,"isWeakMap",(function(){return qe})),n.d(e,"isSet",(function(){return Ce})),n.d(e,"isWeakSet",(function(){return Pe})),n.d(e,"isFinite",(function(){return Le})),n.d(e,"isNaN",(function(){return Ie})),n.d(e,"isBoolean",(function(){return De})),n.d(e,"isNull",(function(){return Oe})),n.d(e,"isUndefined",(function(){return Ne})),n.d(e,"has",(function(){return Fe})),n.d(e,"identity",(function(){return Be})),n.d(e,"constant",(function(){return ze})),n.d(e,"noop",(function(){return Ue})),n.d(e,"property",(function(){return ke})),n.d(e,"propertyOf",(function(){return je})),n.d(e,"matcher",(function(){return Ve})),n.d(e,"matches",(function(){return Ve})),n.d(e,"times",(function(){return Ge})),n.d(e,"random",(function(){return He})),n.d(e,"now",(function(){return We})),n.d(e,"escape",(function(){return Qe})),n.d(e,"unescape",(function(){return Je})),n.d(e,"result",(function(){return Ke})),n.d(e,"uniqueId",(function(){return tn})),n.d(e,"templateSettings",(function(){return en})),n.d(e,"template",(function(){return sn})),n.d(e,"chain",(function(){return ln})),n.d(e,"mixin",(function(){return un}));var i="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||Function("return this")()||{},r=Array.prototype,o=Object.prototype,a="undefined"!=typeof Symbol?Symbol.prototype:null,s=r.push,l=r.slice,c=o.toString,u=o.hasOwnProperty,h=Array.isArray,f=Object.keys,d=Object.create,p=i.isNaN,m=i.isFinite,g=function(){};function v(t){return t instanceof v?t:this instanceof v?void(this._wrapped=t):new v(t)}var y=v.VERSION="1.10.2";function x(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return null==t?Be:be(t)?x(t,e,n):ye(t)&&!ve(t)?Ve(t):ke(t)}function w(t,e){return b(t,e,1/0)}function _(t,e,n){return v.iteratee!==w?v.iteratee(t,e):b(t,e,n)}function M(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}}function S(t){if(!ye(t))return{};if(d)return d(t);g.prototype=t;var e=new g;return g.prototype=null,e}function T(t){return function(e){return null==e?void 0:e[t]}}function A(t,e){return null!=t&&u.call(t,e)}function E(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}v.iteratee=w;var q=Math.pow(2,53)-1,C=T("length");function P(t){var e=C(t);return"number"==typeof e&&e>=0&&e<=q}function R(t,e,n){var i,r;if(e=x(e,n),P(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=Xt(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t}function L(t,e,n){e=_(e,n);for(var i=!P(t)&&Xt(t),r=(i||t).length,o=Array(r),a=0;a<r;a++){var s=i?i[a]:a;o[a]=e(t[s],s,t)}return o}function I(t){var e=function(e,n,i,r){var o=!P(e)&&Xt(e),a=(o||e).length,s=t>0?0:a-1;for(r||(i=e[o?o[s]:s],s+=t);s>=0&&s<a;s+=t){var l=o?o[s]:s;i=n(i,e[l],l,e)}return i};return function(t,n,i,r){var o=arguments.length>=3;return e(t,x(n,r,4),i,o)}}var D=I(1),O=I(-1);function N(t,e,n){var i=(P(t)?wt:ie)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function F(t,e,n){var i=[];return e=_(e,n),R(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function B(t,e,n){return F(t,zt(_(e)),n)}function z(t,e,n){e=_(e,n);for(var i=!P(t)&&Xt(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(!e(t[a],a,t))return!1}return!0}function U(t,e,n){e=_(e,n);for(var i=!P(t)&&Xt(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(e(t[a],a,t))return!0}return!1}function k(t,e,n,i){return P(t)||(t=Zt(t)),("number"!=typeof n||i)&&(n=0),Tt(t,e,n)>=0}var j=M((function(t,e,n){var i,r;return be(e)?r=e:ve(e)&&(i=e.slice(0,-1),e=e[e.length-1]),L(t,(function(t){var o=r;if(!o){if(i&&i.length&&(t=E(t,i)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))}));function V(t,e){return L(t,ke(e))}function G(t,e){return F(t,Ve(e))}function H(t,e){return N(t,Ve(e))}function W(t,e,n){var i,r,o=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,l=(t=P(t)?t:Zt(t)).length;s<l;s++)null!=(i=t[s])&&i>o&&(o=i);else e=_(e,n),R(t,(function(t,n,i){((r=e(t,n,i))>a||r===-1/0&&o===-1/0)&&(o=t,a=r)}));return o}function X(t,e,n){var i,r,o=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,l=(t=P(t)?t:Zt(t)).length;s<l;s++)null!=(i=t[s])&&i<o&&(o=i);else e=_(e,n),R(t,(function(t,n,i){((r=e(t,n,i))<a||r===1/0&&o===1/0)&&(o=t,a=r)}));return o}function Y(t){return Z(t,1/0)}function Z(t,e,n){if(null==e||n)return P(t)||(t=Zt(t)),t[He(t.length-1)];var i=P(t)?ce(t):Zt(t),r=C(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,a=0;a<e;a++){var s=He(a,o),l=i[a];i[a]=i[s],i[s]=l}return i.slice(0,e)}function Q(t,e,n){var i=0;return e=_(e,n),V(L(t,(function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")}function J(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=_(i,r),R(n,(function(e,r){var a=i(e,r,n);t(o,e,a)})),o}}var K=J((function(t,e,n){A(t,n)?t[n].push(e):t[n]=[e]})),$=J((function(t,e,n){t[n]=e})),tt=J((function(t,e,n){A(t,n)?t[n]++:t[n]=1})),et=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function nt(t){return t?ve(t)?l.call(t):we(t)?t.match(et):P(t)?L(t,Be):Zt(t):[]}function it(t){return null==t?0:P(t)?t.length:Xt(t).length}var rt=J((function(t,e,n){t[n?0:1].push(e)}),!0);function ot(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[0]:at(t,t.length-e)}function at(t,e,n){return l.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function st(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[t.length-1]:lt(t,Math.max(0,t.length-e))}function lt(t,e,n){return l.call(t,null==e||n?1:e)}function ct(t){return F(t,Boolean)}function ut(t,e,n,i){for(var r=(i=i||[]).length,o=0,a=C(t);o<a;o++){var s=t[o];if(P(s)&&(ve(s)||xe(s)))if(e)for(var l=0,c=s.length;l<c;)i[r++]=s[l++];else ut(s,e,n,i),r=i.length;else n||(i[r++]=s)}return i}function ht(t,e){return ut(t,e,!1)}var ft=M((function(t,e){return gt(t,e)}));function dt(t,e,n,i){De(e)||(i=n,n=e,e=!1),null!=n&&(n=_(n,i));for(var r=[],o=[],a=0,s=C(t);a<s;a++){var l=t[a],c=n?n(l,a,t):l;e&&!n?(a&&o===c||r.push(l),o=c):n?k(o,c)||(o.push(c),r.push(l)):k(r,l)||r.push(l)}return r}var pt=M((function(t){return dt(ut(t,!0,!0))}));function mt(t){for(var e=[],n=arguments.length,i=0,r=C(t);i<r;i++){var o=t[i];if(!k(e,o)){var a;for(a=1;a<n&&k(arguments[a],o);a++);a===n&&e.push(o)}}return e}var gt=M((function(t,e){return e=ut(e,!0,!0),F(t,(function(t){return!k(e,t)}))}));function vt(t){for(var e=t&&W(t,C).length||0,n=Array(e),i=0;i<e;i++)n[i]=V(t,i);return n}var yt=M(vt);function xt(t,e){for(var n={},i=0,r=C(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n}function bt(t){return function(e,n,i){n=_(n,i);for(var r=C(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}}var wt=bt(1),_t=bt(-1);function Mt(t,e,n,i){for(var r=(n=_(n,i,1))(e),o=0,a=C(t);o<a;){var s=Math.floor((o+a)/2);n(t[s])<r?o=s+1:a=s}return o}function St(t,e,n){return function(i,r,o){var a=0,s=C(i);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return i[o=n(i,r)]===r?o:-1;if(r!=r)return(o=e(l.call(i,a,s),Ie))>=0?o+a:-1;for(o=t>0?a:s-1;o>=0&&o<s;o+=t)if(i[o]===r)return o;return-1}}var Tt=St(1,wt,Mt),At=St(-1,_t);function Et(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r}function qt(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(l.call(t,i,i+=e));return n}function Ct(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=S(t.prototype),a=t.apply(o,r);return ye(a)?a:o}var Pt=M((function(t,e,n){if(!be(t))throw new TypeError("Bind must be called on a function");var i=M((function(r){return Ct(t,i,e,this,n.concat(r))}));return i})),Rt=M((function(t,e){var n=Rt.placeholder,i=function(){for(var r=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===n?arguments[r++]:e[s];for(;r<arguments.length;)a.push(arguments[r++]);return Ct(t,i,this,this,a)};return i}));Rt.placeholder=v;var Lt=M((function(t,e){var n=(e=ut(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=Pt(t[i],t)}}));function It(t,e){var n=function(i){var r=n.cache,o=""+(e?e.apply(this,arguments):i);return A(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n}var Dt=M((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),Ot=Rt(Dt,v,1);function Nt(t,e,n){var i,r,o,a,s=0;n||(n={});var l=function(){s=!1===n.leading?0:We(),i=null,a=t.apply(r,o),i||(r=o=null)},c=function(){var c=We();s||!1!==n.leading||(s=c);var u=e-(c-s);return r=this,o=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),s=c,a=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(l,u)),a};return c.cancel=function(){clearTimeout(i),s=0,i=r=o=null},c}function Ft(t,e,n){var i,r,o=function(e,n){i=null,n&&(r=t.apply(e,n))},a=M((function(a){if(i&&clearTimeout(i),n){var s=!i;i=setTimeout(o,e),s&&(r=t.apply(this,a))}else i=Dt(o,e,this,a);return r}));return a.cancel=function(){clearTimeout(i),i=null},a}function Bt(t,e){return Rt(e,t)}function zt(t){return function(){return!t.apply(this,arguments)}}function Ut(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}}function kt(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function jt(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var Vt=Rt(jt,2),Gt=!{toString:null}.propertyIsEnumerable("toString"),Ht=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function Wt(t,e){var n=Ht.length,i=t.constructor,r=be(i)&&i.prototype||o,a="constructor";for(A(t,a)&&!k(e,a)&&e.push(a);n--;)(a=Ht[n])in t&&t[a]!==r[a]&&!k(e,a)&&e.push(a)}function Xt(t){if(!ye(t))return[];if(f)return f(t);var e=[];for(var n in t)A(t,n)&&e.push(n);return Gt&&Wt(t,e),e}function Yt(t){if(!ye(t))return[];var e=[];for(var n in t)e.push(n);return Gt&&Wt(t,e),e}function Zt(t){for(var e=Xt(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i}function Qt(t,e,n){e=_(e,n);for(var i=Xt(t),r=i.length,o={},a=0;a<r;a++){var s=i[a];o[s]=e(t[s],s,t)}return o}function Jt(t){for(var e=Xt(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i}function Kt(t){for(var e={},n=Xt(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e}function $t(t){var e=[];for(var n in t)be(t[n])&&e.push(n);return e.sort()}function te(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],a=t(o),s=a.length,l=0;l<s;l++){var c=a[l];e&&void 0!==n[c]||(n[c]=o[c])}return n}}var ee=te(Yt),ne=te(Xt);function ie(t,e,n){e=_(e,n);for(var i,r=Xt(t),o=0,a=r.length;o<a;o++)if(e(t[i=r[o]],i,t))return i}function re(t,e,n){return e in n}var oe=M((function(t,e){var n={},i=e[0];if(null==t)return n;be(i)?(e.length>1&&(i=x(i,e[1])),e=Yt(t)):(i=re,e=ut(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var a=e[r],s=t[a];i(s,a,t)&&(n[a]=s)}return n})),ae=M((function(t,e){var n,i=e[0];return be(i)?(i=zt(i),e.length>1&&(n=e[1])):(e=L(ut(e,!1,!1),String),i=function(t,n){return!k(e,n)}),oe(t,i,n)})),se=te(Yt,!0);function le(t,e){var n=S(t);return e&&ne(n,e),n}function ce(t){return ye(t)?ve(t)?t.slice():ee({},t):t}function ue(t,e){return e(t),t}function he(t,e){var n=Xt(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var a=n[o];if(e[a]!==r[a]||!(a in r))return!1}return!0}function fe(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&function(t,e,n,i){t instanceof v&&(t=t._wrapped);e instanceof v&&(e=e._wrapped);var r=c.call(t);if(r!==c.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return a.valueOf.call(t)===a.valueOf.call(e)}var o="[object Array]"===r;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,l=e.constructor;if(s!==l&&!(be(s)&&s instanceof s&&be(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];var u=(n=n||[]).length;for(;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),o){if((u=t.length)!==e.length)return!1;for(;u--;)if(!fe(t[u],e[u],n,i))return!1}else{var h,f=Xt(t);if(u=f.length,Xt(e).length!==u)return!1;for(;u--;)if(h=f[u],!A(e,h)||!fe(t[h],e[h],n,i))return!1}return n.pop(),i.pop(),!0}(t,e,n,i)}function de(t,e){return fe(t,e)}function pe(t){return null==t||(P(t)&&(ve(t)||we(t)||xe(t))?0===t.length:0===Xt(t).length)}function me(t){return!(!t||1!==t.nodeType)}function ge(t){return function(e){return c.call(e)==="[object "+t+"]"}}var ve=h||ge("Array");function ye(t){var e=typeof t;return"function"===e||"object"===e&&!!t}var xe=ge("Arguments"),be=ge("Function"),we=ge("String"),_e=ge("Number"),Me=ge("Date"),Se=ge("RegExp"),Te=ge("Error"),Ae=ge("Symbol"),Ee=ge("Map"),qe=ge("WeakMap"),Ce=ge("Set"),Pe=ge("WeakSet");!function(){xe(arguments)||(xe=function(t){return A(t,"callee")})}();var Re=i.document&&i.document.childNodes;function Le(t){return!Ae(t)&&m(t)&&!p(parseFloat(t))}function Ie(t){return _e(t)&&p(t)}function De(t){return!0===t||!1===t||"[object Boolean]"===c.call(t)}function Oe(t){return null===t}function Ne(t){return void 0===t}function Fe(t,e){if(!ve(e))return A(t,e);for(var n=e.length,i=0;i<n;i++){var r=e[i];if(null==t||!u.call(t,r))return!1;t=t[r]}return!!n}function Be(t){return t}function ze(t){return function(){return t}}function Ue(){}function ke(t){return ve(t)?function(e){return E(e,t)}:T(t)}function je(t){return null==t?function(){}:function(e){return ve(e)?E(t,e):t[e]}}function Ve(t){return t=ne({},t),function(e){return he(e,t)}}function Ge(t,e,n){var i=Array(Math.max(0,t));e=x(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i}function He(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}"object"!=typeof Int8Array&&"function"!=typeof Re&&(be=function(t){return"function"==typeof t||!1});var We=Date.now||function(){return(new Date).getTime()},Xe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ye=Kt(Xe);function Ze(t){var e=function(e){return t[e]},n="(?:"+Xt(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}}var Qe=Ze(Xe),Je=Ze(Ye);function Ke(t,e,n){ve(e)||(e=[e]);var i=e.length;if(!i)return be(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=be(o)?o.call(t):o}return t}var $e=0;function tn(t){var e=++$e+"";return t?t+e:e}var en=v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},nn=/(.)^/,rn={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},on=/\\|'|\r|\n|\u2028|\u2029/g,an=function(t){return"\\"+rn[t]};function sn(t,e,n){!e&&n&&(e=n),e=se({},e,v.templateSettings);var i,r=RegExp([(e.escape||nn).source,(e.interpolate||nn).source,(e.evaluate||nn).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(r,(function(e,n,i,r,s){return a+=t.slice(o,s).replace(on,an),o=s+e.length,n?a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var s=function(t){return i.call(this,t,v)},l=e.variable||"obj";return s.source="function("+l+"){\n"+a+"}",s}function ln(t){var e=v(t);return e._chain=!0,e}function cn(t,e){return t._chain?v(e).chain():e}function un(t){return R($t(t),(function(e){var n=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),cn(this,n.apply(v,t))}})),v}R(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=r[t];v.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],cn(this,n)}})),R(["concat","join","slice"],(function(t){var e=r[t];v.prototype[t]=function(){return cn(this,e.apply(this._wrapped,arguments))}})),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return String(this._wrapped)}}.call(this,n(186))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(169),o=n(12).Entity,a=n(12).registerEntity;function s(e,n){var i=o.call(this,e);return this.className="SplineEntity",this.name=n||"Spline",this.type="Spline",this.spline=null,this.points=[new t.Vector3(-2,0,0),new t.Vector3(-1,.5,0),new t.Vector3(1,-.5,0),new t.Vector3(2,0,0)],e||this.createSpline(),i}s.prototype=Object.create(o.prototype),s.prototype.init=function(){return o.prototype.init.call(this),this},s.prototype.createSpline=function(){var e=new r.a;e.load(this.points);var n=new t.BufferGeometry;n.setAttribute("position",new t.BufferAttribute(new Float32Array(3*r.a.ARC_SEGMENTS),3));var o=new t.CatmullRomCurve3(e.positions);o.curveType="centripetal";var a=new t.LineBasicMaterial({color:16777215});o.mesh=new t.Line(n.clone(),a),o.mesh.castShadow=!1,e.curve=o,e.updateOutline();var s=new i.default(this,o.mesh);o.mesh.entity=this,this.addComponent(s),this.object3D=s.object3D,this.spline=e,e.entity=this},s.prototype.addPoint=function(){this.spline.addPoint(),this.spline.updateOutline()},s.prototype.removePoint=function(){this.spline.removePoint(),this.spline.updateOutline()},s.prototype.dispose=function(){this.spline&&this.spline.clear()},s.prototype.destroy=function(){this.dispose()},e.default=a("SplineEntity",s)}.call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return v}));var i=n(191),r=n(439),o=n(440),a=n(441),s=n(442),l=n(443),c=(n(192),n(444)),u=n(94),h=n(165),f=n(92),d=(n(85),n(26)),p=n(156),m=n(159),g=n(65);n(40),n(32);function v(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.texturePath=""}v.prototype.load=function(e,n,i,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var o=this;new t.FileLoader(this.manager).load(e,(function(t){o.parse(JSON.parse(t),n)}),i,r)},v.prototype.parse=function(t,e){var n=this.parseResources(t.resources),i=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,i),o=this.parseImages(t.images),a=this.parseVideos(t.videos),s=this.parseAudio(t.audio),l=this.parseFonts(t.fonts),c=this.parseTextures(t.textures,o,a),u=this.parseMaterials(t.materials,c),h=this.parseObject(t.object,r,u,c,s,l,n,o,a,i,f);if(t.skeletons){var f=this.parseSkeletons(t.skeletons,h);this.bindSkeletons(h,f)}return t.animations&&(h.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(h),h},v.prototype.setTexturePath=function(t){this.texturePath=t},v.prototype.setCrossOrigin=function(t){this.crossOrigin=t},v.prototype.parseResources=function(t){var e=[];if(void 0!==t)for(var n in t){var i=new p.a(t[n].data,t[n].encoding);i.format=t[n].format,i.name=t[n].name,i.uuid=t[n].uuid,e[i.uuid]=i}return e},v.prototype.parseShape=function(e){var n={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var o=(new t.Shape).fromJSON(e[i]);n[o.uuid]=o}return n},v.prototype.parseGeometries=function(t,e){var n=new l.a;n.setShapes(e);var i=[];if(void 0!==t)for(var r=0;r<t.length;r++)i[t[r].uuid]=n.parse(t[r]);return i},v.prototype.parseMaterials=function(t,e){var n=[],i=new s.a;if(i.setTextures(e),void 0!==t)for(var r in t)n[t[r].uuid]=i.parse(t[r]);return n},v.prototype.parseAnimations=function(e){for(var n=[],i=0;i<e.length;i++){var r=t.AnimationClip.parse(e[i]);void 0!==e[i].uuid&&(r.uuid=e[i].uuid),n.push()}return n},v.prototype.parseImages=function(t){var e=new r.a,n=[];if(void 0!==t)for(var i in t)n[t[i].uuid]=e.parse(t[i]);return n},v.prototype.parseVideos=function(t){var e=new o.a,n=[];if(void 0!==t)for(var i in t)n[t[i].uuid]=e.parse(t[i]);return n},v.prototype.parseAudio=function(t){var e=new a.a,n=[];if(void 0!==t)for(var i in t)n[t[i].uuid]=e.parse(t[i]);return n},v.prototype.parseFonts=function(t){var e=new c.a,n=[];if(void 0!==t)for(var i in t)n[t[i].uuid]=e.parse(t[i]);return n},v.prototype.parseTextures=function(t,e,n){var r=[],o=new i.a;if(o.setImages(e),o.setVideos(n),void 0!==t)for(var a in t)r[t[a].uuid]=o.parse(t[a]);return r},v.prototype.parseSkeletons=function(e,n){var i={};if(void 0===e)return i;for(var r=0;r<e.length;r++){for(var o=e[r],a=o.uuid,s=o.bones,l=o.boneInverses,c=[],u=[],h=0,f=s.length;h<f;h++){var d=n.getObjectByProperty("uuid",s[h]);void 0===d&&(console.warn("THREE.ObjectLoader: Not found Bone whose uuid is "+s[h]),d=new t.Bone),c.push(d),u.push((new t.Matrix4).fromArray(l[h]))}i[a]=new m.default(c,u)}return i},v.prototype.bindSkeletons=function(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeletonUUID){var n=e[t.skeletonUUID];void 0===n?console.warn("THREE.ObjectLoader: Not found Skeleton whose uuid is "+t.skeletonUUID):t.bind(n,t.bindMatrix),delete t.skeletonUUID}}))},v.prototype.parseObject=function(e,n,i,r,o,a,s,l,c,p,m){var v,y;function x(t){return void 0===r[t]&&console.warn("ObjectLoader: Undefined texture",t),r[t]}function b(t){return void 0===n[t]&&console.warn("ObjectLoader: Undefined geometry",t),n[t]}function w(t){if(t instanceof Array){for(var e=[],n=0;n<t.length;n++)e.push(i[t[n]]);return e}return void 0===i[t]&&console.warn("ObjectLoader: Undefined material",t),i[t]}try{switch(e.type){case"Program":var _=new d.a(e.name);v=_.object3D,_.description=e.description,_.author=e.author,_.version=e.version,_.ar=!0===e.ar,_.vr=e.vr,_.vrScale=e.vrScale,void 0!==e.rendererConfig?_.rendererConfig.fromJSON(e.rendererConfig):(_.rendererConfig.antialiasing=e.antialiasing,_.rendererConfig.shadows=e.shadows,_.rendererConfig.shadowsType=e.shadowsType,_.rendererConfig.toneMapping=e.toneMapping,_.rendererConfig.toneMappingWhitePoint=e.toneMappingWhitePoint,_.rendererConfig.toneMappingExposure=e.toneMappingExposure),void 0!==e.lockPointer&&(_.lockPointer=e.lockPointer),void 0!==e.defaultScene&&(_.defaultScene=e.defaultScene),void 0!==e.handlePixelRatio&&(_.handlePixelRatio=e.handlePixelRatio);break;case"Scene":v=new t.Scene,void 0!==e.background&&(Number.isInteger(e.background)?v.background=new t.Color(e.background):v.background=x(e.background.uuid)),void 0!==e.fog&&("Fog"===e.fog.type?v.fog=new t.Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(v.fog=new t.FogExp2(e.fog.color,e.fog.density))),void 0!==e.defaultCamera&&(v.defaultCamera=this.parse(e.defaultCamera)),void 0!==e.cameras&&(v.cameras=e.cameras),void 0!==e.usePhysics&&(v.usePhysics=e.usePhysics),void 0!==e.world&&(v.world.gravity.set(e.world.gravity.x,e.world.gravity.y,e.world.gravity.z),v.world.quatNormalizeSkip=e.world.quatNormalizeSkip,v.world.quatNormalizeFast=e.world.quatNormalizeFast,v.world.solver.tolerance=e.world.solver.tolerance,v.world.solver.iterations=e.world.solver.iterations);break;case"Audio":var M=(y=e.audio,void 0===o[y]&&console.warn("ObjectLoader: Undefined audio",y),o[y]);o=new g.a(M.data);(v=new h.a(o)).autoplay=e.autoplay,v.startTime=e.startTime,v.playbackRate=e.playbackRate,v.loop=void 0!==e.source?e.source.loop:e.loop,void 0!==e.volume&&(v.volume=e.volume);break;case"PositionalAudio":break;case"ParticlePoints":function S(e){return Array.isArray(e)?(new t.Vector3).fromArray(e):new t.Vector3(e.x,e.y,e.z)}if(void 0!==e.group){var T=e.group;T.texture.value=x(T.texture.value),T.texture.frames=(new t.Vector2).fromArray(T.texture.frames||[1,1])}if(void 0!==e.emitter){var A=e.emitter;A.position.value=S(A.position.value),A.position.spread=S(A.position.spread),A.velocity.value=S(A.velocity.value),A.velocity.spread=S(A.velocity.spread),A.acceleration.value=S(A.acceleration.value),A.acceleration.spread=S(A.acceleration.spread);for(var E=0;E<A.color.value.length;E++)A.color.value[E]=new t.Color(A.color.value[E]),A.color.spread[E]=S(A.color.spread[E])}v=new u.default(e.group,e.emitter);break;case"CubeCamera":const n=new t.WebGLCubeRenderTarget(1,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding});v=new t.CubeCamera(.1,5e3,n);break;case"PerspectiveCamera":v=new t.PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(v.focus=e.focus),void 0!==e.zoom&&(v.zoom=e.zoom),void 0!==e.filmGauge&&(v.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(v.filmOffset=e.filmOffset),void 0!==e.view&&(v.view=Object.assign({},e.view));break;case"OrthographicCamera":v=new t.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(v.zoom=e.zoom),void 0!==e.view&&(v.view=Object.assign({},e.view));break;case"RectAreaLight":v=new t.RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"AmbientLight":v=new t.AmbientLight(e.color,e.intensity);break;case"DirectionalLight":v=new t.DirectionalLight(e.color,e.intensity);break;case"PointLight":v=new t.PointLight(e.color,e.intensity,e.distance,e.decay);break;case"SpotLight":v=new t.SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":v=new t.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":var q,C=b(e.geometry),P=w(e.material);void 0!==e.skeleton&&void 0!==C.bones&&(q=C.bones,C.bones=void 0),v=new t.SkinnedMesh(C,P),void 0!==e.skeleton&&(v.skeletonUUID=e.skeleton),void 0!==e.bindMode&&(v.bindMode=e.bindMode),void 0!==e.bindMatrix&&v.bindMatrix.fromArray(e.bindMatrix),v.updateMatrixWorld(!0),void 0!==q&&(C.bones=q);break;case"InstancedMesh":C=b(e.geometry),P=w(e.material);(v=new t.InstancedMesh(C,P,e.count)).instanceMatrix=new t.BufferAttribute(new Float32Array(e.instanceMatrix.array),16);break;case"HTMLView":(v=new t.HTMLView).height=e.height,v.width=e.width,v.url=e.url;break;case"LightProbe":(v=new t.LightProbe).sh.fromArray(e.sh);break;case"Mesh":C=b(e.geometry),P=w(e.material);v=C.bones&&C.bones.length>0?new t.SkinnedMesh(C,P):new t.Mesh(C,P);break;case"LOD":v=new t.LOD;break;case"Line":v=new t.Line(b(e.geometry),w(e.material),e.mode);break;case"Line2":v=new f.a(b(e.geometry),w(e.material));break;case"LineLoop":v=new t.LineLoop(b(e.geometry),w(e.material));break;case"LineSegments":v=new t.LineSegments(b(e.geometry),w(e.material));break;case"PointCloud":case"Points":v=new t.Points(b(e.geometry),w(e.material));break;case"Sprite":v=new t.Sprite(w(e.material));break;case"Group":v=new t.Group;break;case"Bone":v=new t.Bone;break;case"Halo":case"SpineAnimation":break;default:v=new t.Group}}catch(n){console.error("TDS: Error parsing and creating object "+e.uuid+", object skiped.",n,e),v=new t.Group}if(v.locked=!0===e.locked||!0===e.hidden,v.folded=!0===e.folded,void 0!==e.renderOrder&&(v.renderOrder=e.renderOrder),void 0!==e.animations){v.animations=[];for(E=0;E<e.animations.length;E++)v.animations.push(t.AnimationClip.parse(e.animations[E]))}if(v.uuid=e.uuid,void 0!==e.name&&(v.name=e.name),void 0!==e.matrix?(v.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(v.matrixAutoUpdate=e.matrixAutoUpdate),v.matrixAutoUpdate&&v.matrix.decompose(v.position,v.quaternion,v.scale)):(void 0!==e.position&&v.position.fromArray(e.position),void 0!==e.rotation&&v.rotation.fromArray(e.rotation),void 0!==e.quaternion&&v.quaternion.fromArray(e.quaternion),void 0!==e.scale&&v.scale.fromArray(e.scale)),void 0!==e.castShadow&&(v.castShadow=e.castShadow),void 0!==e.receiveShadow&&(v.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(v.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(v.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&v.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(v.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(v.visible=e.visible),void 0!==e.frustumCulled&&(v.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(v.renderOrder=e.renderOrder),void 0!==e.userData&&(v.userData=e.userData),void 0!==e.layers&&(v.layers.mask=e.layers),void 0!==e.children)for(var R in e.children)v.add(this.parseObject(e.children[R],n,i,r,o,a,l,c,p,m));return void 0!==e.matrixAutoUpdate&&(v.matrixAutoUpdate=e.matrixAutoUpdate,v.matrixAutoUpdate||(v.updateMatrix(),v.updateMatrixWorld(!0))),"Program"===e.type&&(v.materials=i,v.textures=r,v.resources=s,v.fonts=a,v.audio=o,v.geometries=n,v.images=l,v.videos=c,v.shapes=p,v.skeletons=m),v}}).call(this,n(0))},function(t,e,n){"use strict";function i(){}i.list=[];i.prototype.register=function(t){0===i.list.length&&t,i.list.push(t)},i.prototype.setLocale=function(t){var e;if("string"==typeof t)for(var n=0;n<i.list.length;n++)i.list[n].meta.language===t&&(e=i.list[n]);else i.list.indexOf(t)<0&&i.register(t),e=t;return e},e.a=new i},function(t,e,n){"use strict";var i=n(0),r=function(t,e,n){var r=this;this.volume=t,e=e||0,Object.defineProperty(this,"index",{get:function(){return e},set:function(t){return e=t,r.geometryNeedsUpdate=!0,e}}),this.axis=n||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var o=new i.Texture(this.canvas);o.minFilter=i.LinearFilter,o.wrapS=o.wrapT=i.ClampToEdgeWrapping;var a=new i.MeshBasicMaterial({map:o,side:i.DoubleSide,transparent:!0});this.mesh=new i.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()};r.prototype={constructor:r,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var t=this.iLength,e=this.jLength,n=this.sliceAccess,i=this.volume,r=this.canvasBuffer,o=this.ctxBuffer,a=o.getImageData(0,0,t,e),s=a.data,l=i.data,c=i.upperThreshold,u=i.lowerThreshold,h=i.windowLow,f=i.windowHigh,d=0;if("label"===i.dataType)for(var p=0;p<e;p++)for(var m=0;m<t;m++){var g=l[n(m,p)];g=g>=this.colorMap.length?g%this.colorMap.length+1:g;var v=this.colorMap[g];s[4*d]=v>>24&255,s[4*d+1]=v>>16&255,s[4*d+2]=v>>8&255,s[4*d+3]=255&v,d++}else for(p=0;p<e;p++)for(m=0;m<t;m++){var y=l[n(m,p)],x=255;x=c>=y&&u<=y?x:0,y=(y=Math.floor(255*(y-h)/(f-h)))>255?255:y<0?0:0|y,s[4*d]=y,s[4*d+1]=y,s[4*d+2]=y,s[4*d+3]=x,d++}o.putImageData(a,0,0),this.ctx.drawImage(r,0,0,t,e,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var t=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=t.sliceAccess,this.jLength=t.jLength,this.iLength=t.iLength,this.matrix=t.matrix,this.canvas.width=t.planeWidth,this.canvas.height=t.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new i.PlaneBufferGeometry(t.planeWidth,t.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}},n.d(e,"a",(function(){return o}));var o=function(t,e,n,r,o){if(arguments.length>0){switch(this.xLength=Number(t)||1,this.yLength=Number(e)||1,this.zLength=Number(n)||1,r){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(o);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(o);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(o);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(o);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(o);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(o);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(o);break;case"Float64":case"float64":case"double":this.data=new Float64Array(o);break;default:this.data=new Uint8Array(o)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new i.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(t){a=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}});var s=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return s},set:function(t){s=t,this.sliceList.forEach((function(t){t.geometryNeedsUpdate=!0}))}}),this.sliceList=[]};o.prototype={constructor:o,getData:function(t,e,n){return this.data[n*this.xLength*this.yLength+e*this.xLength+t]},access:function(t,e,n){return n*this.xLength*this.yLength+e*this.xLength+t},reverseAccess:function(t){var e=Math.floor(t/(this.yLength*this.xLength)),n=Math.floor((t-e*this.yLength*this.xLength)/this.xLength);return[t-e*this.yLength*this.xLength-n*this.xLength,n,e]},map:function(t,e){var n=this.data.length;e=e||this;for(var i=0;i<n;i++)this.data[i]=t.call(e,this.data[i],i,this.data);return this},extractPerpendicularPlane:function(t,e){var n,r,o,a,s,l,c,u,h=(new i.Matrix4).identity(),f=this,d=new i.Vector3,p=new i.Vector3,m=new i.Vector3,g=new i.Vector3(this.xLength,this.yLength,this.zLength);switch(t){case"x":d.set(1,0,0),p.set(0,0,-1),m.set(0,-1,0),s=this.spacing[2],l=this.spacing[1],u=new i.Vector3(e,0,0),h.multiply((new i.Matrix4).makeRotationY(Math.PI/2)),c=(f.RASDimensions[0]-1)/2,h.setPosition(new i.Vector3(e-c,0,0));break;case"y":d.set(0,1,0),p.set(1,0,0),m.set(0,0,1),s=this.spacing[0],l=this.spacing[2],u=new i.Vector3(0,e,0),h.multiply((new i.Matrix4).makeRotationX(-Math.PI/2)),c=(f.RASDimensions[1]-1)/2,h.setPosition(new i.Vector3(0,e-c,0));break;case"z":default:d.set(0,0,1),p.set(1,0,0),m.set(0,-1,0),s=this.spacing[0],l=this.spacing[1],u=new i.Vector3(0,0,e),c=(f.RASDimensions[2]-1)/2,h.setPosition(new i.Vector3(0,0,e-c))}p.applyMatrix4(f.inverseMatrix).normalize(),p.argVar="i",m.applyMatrix4(f.inverseMatrix).normalize(),m.argVar="j",d.applyMatrix4(f.inverseMatrix).normalize(),n=Math.floor(Math.abs(p.dot(g))),r=Math.floor(Math.abs(m.dot(g))),o=Math.abs(n*s),a=Math.abs(r*l),u=Math.abs(Math.round(u.applyMatrix4(f.inverseMatrix).dot(d)));var v=[new i.Vector3(1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,0,1)],y=[p,m,d].find((function(t){return Math.abs(t.dot(v[0]))>.9})),x=[p,m,d].find((function(t){return Math.abs(t.dot(v[1]))>.9})),b=[p,m,d].find((function(t){return Math.abs(t.dot(v[2]))>.9}));return{iLength:n,jLength:r,sliceAccess:function(t,e){var n=y===d?u:"i"===y.argVar?t:e,i=x===d?u:"i"===x.argVar?t:e,r=b===d?u:"i"===b.argVar?t:e,o=y.dot(v[0])>0?n:f.xLength-1-n,a=x.dot(v[1])>0?i:f.yLength-1-i,s=b.dot(v[2])>0?r:f.zLength-1-r;return f.access(o,a,s)},matrix:h,planeWidth:o,planeHeight:a}},extractSlice:function(t,e){var n=new r(this,e,t);return this.sliceList.push(n),n},repaintAllSlices:function(){return this.sliceList.forEach((function(t){t.repaint()})),this},computeMinMax:function(){var t=1/0,e=-1/0,n=this.data.length,i=0;for(i=0;i<n;i++)if(!isNaN(this.data[i])){var r=this.data[i];t=Math.min(t,r),e=Math.max(e,r)}return this.min=t,this.max=e,[t,e]}}},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent;function o(t,e,n,r){var o=i.call(this,t,e);return this.name="text-image",this.type="TextImage",this.singleTon=!1,this.text=n||TDS_RT.locale.techbrood,this.size=2e3,this.autoFit=!0,this.autoWrap=!0,this.styles=r||{color:"#ffffff",backgroundColor:"#ffffff00",fontFamily:"Noto Sans SC",fontSize:22,textAlign:"center",border:!0,borderSize:3,borderColor:"#931fe0",borderRadius:10,padding:10},this.debug=!1,this.scale=1,this.imageData=null,this.needsUpdate=!1,e||this.createObject3D(),o}o.LEFT="left",o.CENTER="center",o.RIGHT="right",o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(){this.createText()},o.prototype.init=function(){i.prototype.init.call(this);var e=this.entity.object3D;return this.entity.isText||e instanceof t.Mesh?this:(TDS_RT.alert("Text image can only be applied to texts or meshes"),this)},o.prototype.createText=function(e){if(this.entity&&this.entity.object3D){var n=this.text.split("\n"),i=this.styles.fontSize;this.autoFit&&(i=function(t,e,n){for(var i=999,r=0;r<t.length;r++){var o=f(t[r],e,n);i>o&&(i=o)}return i}(n,this.styles.fontFamily,this.size-2*this.styles.padding));var r=(n.length*i+2*this.styles.padding)/this.size,a=document.createElement("canvas");a.width=this.size,this.entity.isText?a.height=this.size*r:a.height=this.size;var s=a.getContext("2d");s.clearRect(0,0,a.width,a.height),this.styles.border?(this.roundRect(s,this.styles.borderSize,this.styles.borderSize,a.width-2*this.styles.borderSize,a.height-2*this.styles.borderSize,this.styles.backgroundColor,0,this.styles.borderColor,this.styles.borderRadius,!0,!1),this.roundRect(s,0,0,a.width,a.height,this.styles.backgroundColor,this.styles.borderSize,this.styles.borderColor,this.styles.borderRadius,!1,!0)):(s.rect(0,0,a.width,a.height),s.fillStyle=this.styles.backgroundColor,s.fill()),s.fillStyle=this.styles.color,s.textAlign=this.styles.textAlign,s.textBaseline="middle";for(var l=0;l<n.length;l++){let t=n[l];s.font=i+"px "+this.styles.fontFamily;let e=0;this.entity.isText||(e=a.height*(1-r)/2),s.textAlign===o.CENTER&&s.fillText(t,a.width/2,(l+.5)*i+this.styles.padding+e),s.textAlign===o.LEFT&&s.fillText(t,this.styles.padding,(l+.5)*i+this.styles.padding+e),s.textAlign===o.RIGHT&&s.fillText(t,a.width-this.styles.padding,(l+.5)*i+this.styles.padding+e)}if(this.debug)a.style.zIndex=99,a.style.position="absolute",a.style.top="0",a.style.left="0",document.getElementsByTagName("body")[0].appendChild(a);this.imageData=s.getImageData(0,0,a.width,a.height),this.imageUrl=a.toDataURL();var c=new t.CanvasTexture(a);if(c.anisotropy=2,this.entity.isText){if(void 0===e){var u=new t.MeshBasicMaterial({transparent:!0,map:c}),h=new t.PlaneBufferGeometry(this.size/1e3,this.size/1e3,10,5);this.object3D=new t.Mesh(h,u),this.object3D.position.y=.5}this.object3D.geometry.scale(1,r/this.scale,1)}else this.object3D=this.entity.object3D;this.object3D.material.map=c,this.object3D.material.needsUpdate=!0,this.scale=r}function f(t,e,n){const i=document.createElement("canvas").getContext("2d");return i.font=`1px ${e}`,n/i.measureText(t).width}},o.prototype.refreshText=function(){this.text&&""!==this.text&&(this.createText(!0),this.entity.componentChanged())},o.prototype.roundRect=function(t,e,n,i,r,o,a,s,l,c,u){if(void 0===u&&(u=!0),void 0===l&&(l=5),"number"==typeof l)l={tl:l,tr:l,br:l,bl:l};else{for(var h in{tl:0,tr:0,br:0,bl:0})l[h]=l[h]||l[h]}t.beginPath(),t.moveTo(e+l.tl,n),t.lineTo(e+i-l.tr,n),t.quadraticCurveTo(e+i,n,e+i,n+l.tr),t.lineTo(e+i,n+r-l.br),t.quadraticCurveTo(e+i,n+r,e+i-l.br,n+r),t.lineTo(e+l.bl,n+r),t.quadraticCurveTo(e,n+r,e,n+r-l.bl),t.lineTo(e,n+l.tl),t.quadraticCurveTo(e,n,e+l.tl,n),t.closePath(),t.lineWidth=a,c&&(t.fillStyle=o,t.fill()),u&&(t.strokeStyle=s,t.stroke())},o.prototype.getSize=function(){var e=(new t.Box3).setFromObject(this.object3D),n=new t.Vector3;return e.getSize(n)},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={text:this.text,size:this.size,styles:this.styles,autoFit:this.autoFit,autoWrap:this.autoWrap,scale:this.scale},t.imageUrl=this.imageUrl,t},o.prototype.fromJSON=function(t,e){if(i.prototype.fromJSON.call(this,t,e),t.imageUrl){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=this.size,n.height=this.size*this.scale;var o=document.createElement("img");o.src=t.imageUrl,o.width=n.width,o.height=n.height,o.onload=()=>{r.drawImage(o,0,0),this.imageData=r.getImageData(0,0,o.width,o.height),this.refreshText()}}return this},e.a=r("text-image",o)}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(e,n,i){this.bufferScene=new t.Scene,this.bufferMaterial=new t.ShaderMaterial(e),this.bufferScene.add(new t.Mesh(new t.PlaneGeometry(n,i,n,i),this.bufferMaterial))}n.d(e,"a",(function(){return i})),i.prototype.render=function(t,e,n,i,r){this.updateUniform(r,n.texture),t.setRenderTarget(i),t.render(this.bufferScene,e),t.setRenderTarget(null)},i.prototype.regularRender=function(t,e,n){t.setRenderTarget(n),t.render(this.bufferScene,e),t.setRenderTarget(null)},i.prototype.updateUniform=function(t,e){this.bufferMaterial.uniforms[t].value=e}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(34),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n){var i=r.call(this,t);return this.name=name||"Particle",this.className="ParticleEntity",this.type="Particle",this.isPrimitive=!0,t||i.createComponents(e,n),i}a.prototype=Object.create(r.prototype),a.prototype.createComponents=function(t,e){var n=new i.a(this,void 0,t,e);this.addComponent(n),this.object3D=n.object3D},a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getParticle=function(){return this.object3D},e.default=o("ParticleEntity",a)},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return s}));var i=n(0),r={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},o={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new i.Vector3}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec3 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace.xy - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tfloat f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) );","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},a={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},s={uniforms:{vSunPositionScreenSpace:{value:new i.Vector3},fAspect:{value:1},sunColor:{value:new i.Color(16772608)},bgColor:{value:new i.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec3 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace.xy;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;","\tgl_FragColor.w = 1.0;","}"].join("\n")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(6),r=n(55);n(3);function o(t){i.a.call(this,t,"div");var e=this;this.element.classList.add("loader_modal"),this.element.innerHTML="<div class='loading_cube'> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t    <div class='loading__square'></div> \t</div>",this.manager=new r.a,this.manager.add(window,"resize",(function(t){e.updateInterface()}))}o.prototype=Object.create(i.a.prototype),o.prototype.show=function(){this.manager.create(),this.visible=!0,this.updateInterface()},o.prototype.hide=function(t){this.manager.destroy(),this.setVisibility(!1)},o.prototype.destroy=function(){i.a.prototype.destroy.call(this),this.manager.destroy()},o.prototype.updateSize=function(){this.size.copy(this.parent.size),i.a.prototype.updateSize.call(this)}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(40);function r(e,n,i,r,o,a){t.Texture.call(this,document.createElement("video"),n,i,r,t.LinearFilter,t.LinearFilter,t.RGBFormat,o,a),this.disposed=!1,this.generateMipmaps=!1,this.name="video",this.category="Video",this.autoplay=!0,this.loop=!0,this.playbackRate=1,this.volume=1,this.image.crossOrigin="anonymous",this.image.autoplay=this.autoplay,this.image.playbackRate=this.playbackRate,this.image.loop=this.loop,this.image.volume=this.volume,this.video=null,this.setVideo(e);var s=this;!function t(){s.disposed||(s.image.readyState>=s.image.HAVE_CURRENT_DATA&&(s.needsUpdate=!0),requestAnimationFrame(t))}()}r.prototype=Object.create(t.Texture.prototype),r.prototype.setVideo=function(t){if(null==t)return this.video=null,void(this.image.src=null);"string"==typeof t?this.video=new i.a(t):t instanceof i.a&&(this.video=t),this.image.src=this.video.data},r.prototype.setTime=function(t){this.image.currentTime=t},r.prototype.setLoop=function(t){this.loop=t,this.image.loop=t},r.prototype.setVolume=function(t){this.volume=t>=0&&t<=1?t:t>=0?1:0,this.image.volume=this.volume},r.prototype.setAutoPlay=function(t){this.autoplay=t,this.image.autoplay=this.autoplay},r.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.image.playbackRate=t},r.prototype.pause=function(){this.image.paused||this.image.pause()},r.prototype.play=function(){this.image.paused&&this.image.play()},r.prototype.dispose=function(){t.Texture.prototype.dispose.call(this),this.disposed=!0,this.image.pause(),this.image.src="",this.image.load()},r.prototype.toJSON=function(e){var n=t.Texture.prototype.toJSON.call(this,e),i=this.video.toJSON(e);return n.video=i.uuid,n.loop=this.loop,n.autoplay=this.autoplay,n.playbackRate=this.playbackRate,n.volume=this.volume,n}}).call(this,n(0))},,function(t,e,n){"use strict";(function(t){function i(e,n,r,o,a,s,l,c,u,h){void 0===n&&(n=t.CubeReflectionMapping);for(var f=[],d=0;d<6;d++)f.push(document.createElement("canvas"));t.Texture.call(this,f,n,r,o,a,s,l,c,u,h),this.images=void 0!==e?e:[],this.size=512,this.flipY=!1,this.mode=6===this.images.length?i.CUBE:i.CROSS,this.images.length>0&&this.updateImages(),this.name="cubetexture",this.category="Cube"}n.d(e,"a",(function(){return i})),i.prototype=Object.create(t.Texture.prototype),i.prototype.isCubeTexture=!0,i.RIGHT=0,i.LEFT=1,i.TOP=2,i.BOTTOM=3,i.FRONT=4,i.BACK=5,i.CUBE=20,i.CROSS=21,i.EQUIRECTANGULAR=22,i.prototype.setSize=function(t){0==(t&t-1)?this.size=t:console.warn("TDS: CubeTexture new size is not a power of two.")},i.prototype.setImages=function(t,e){this.mode=void 0!==e?e:i.CUBE,this.images=t},i.prototype.updateImages=function(){var t=this;if(this.mode===i.CUBE)for(var e=0;e<this.images.length;e++){"string"==typeof this.images[e]&&(this.images[e]=new Image(this.images[e])),(n=document.createElement("img")).crossOrigin="anonymous",n.index=e,n.src=this.images[e].data,n.onload=function(){t.image[this.index].width=t.size,t.image[this.index].height=t.size,t.image[this.index].getContext("2d").drawImage(this,0,0,t.size,t.size),t.needsUpdate=!0}}else if(this.mode===i.CROSS){for(e=0;e<this.image.length;e++)this.image[e].width=this.size,this.image[e].height=this.size;(n=document.createElement("img")).src=this.images[0].data,n.onload=function(){var e=this.naturalWidth/4,n=this.naturalHeight/3;t.image[i.LEFT].getContext("2d").drawImage(this,0,n,e,n,0,0,t.size,t.size),t.image[i.FRONT].getContext("2d").drawImage(this,e,n,e,n,0,0,t.size,t.size),t.image[i.RIGHT].getContext("2d").drawImage(this,2*e,n,e,n,0,0,t.size,t.size),t.image[i.BACK].getContext("2d").drawImage(this,3*e,n,e,n,0,0,t.size,t.size),t.image[i.TOP].getContext("2d").drawImage(this,e,0,e,n,0,0,t.size,t.size),t.image[i.BOTTOM].getContext("2d").drawImage(this,e,2*n,e,n,0,0,t.size,t.size),t.needsUpdate=!0}}else if(this.mode===i.EQUIRECTANGULAR){for(e=0;e<this.image.length;e++)this.image[e].width=this.size,this.image[e].height=this.size;var n;(n=document.createElement("img")).src=this.images[0].data,n.onload=function(){var e=document.createElement("canvas");e.width=n.naturalWidth,e.height=n.naturalHeight;var r=e.getContext("2d");r.drawImage(n,0,0);for(var o=r.getImageData(0,0,e.width,e.height),a=0;a<6;a++){var s=i.renderEquirectFace(o,a,Math.PI,t.size);t.image[a].getContext("2d").putImageData(s,0,0)}t.needsUpdate=!0}}},i.resampleBilinear=function(e,n,i,r,o){for(var a=e.width,s=e.height,l=e.data,c=t.Math.clamp(Math.floor(i),0,a-1),u=t.Math.clamp(Math.ceil(i),0,a-1),h=i-c,f=t.Math.clamp(Math.floor(r),0,s-1),d=t.Math.clamp(Math.ceil(r),0,s-1),p=r-f,m=4*(f*a+c),g=4*(f*a+u),v=4*(d*a+c),y=4*(d*a+u),x=0;x<3;x++){var b=l[m+x]*(1-h)+l[g+x]*h,w=l[v+x]*(1-h)+l[y+x]*h;n.data[o+x]=Math.ceil(b*(1-p)+w*p)}},i.renderEquirectFace=function(e,n,r,o){for(var a=new ImageData(o,o),s=i.faces[n],l=0;l<o;l++)for(var c=0;c<o;c++){var u=4*(c*o+l);a.data[u+3]=255;var h=s(2*(l+.5)/o-1,2*(c+.5)/o-1),f=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),d=t.Math.euclideanModulo(Math.atan2(h.y,h.x)+r,2*Math.PI),p=Math.acos(h.z/f),m=e.width*d/Math.PI/2-.5,g=e.height*p/Math.PI-.5;i.resampleBilinear(e,a,m,g,u)}return a},i.faces=[function(e,n){return new t.Vector3(e,-1,-n)},function(e,n){return new t.Vector3(-e,1,-n)},function(e,n){return new t.Vector3(-n,-e,1)},function(e,n){return new t.Vector3(n,-e,-1)},function(e,n){return new t.Vector3(-1,-e,-n)},function(e,n){return new t.Vector3(1,e,-n)}],i.prototype.toJSON=function(e){var n=t.Texture.prototype.toJSON.call(this,e);if(n.size=this.size,n.mode=this.mode,n.images=[],this.mode===i.EQUIRECTANGULAR||this.mode===i.CROSS){var r=this.images[0].toJSON(e);n.images.push(r.uuid)}else for(var o=0;o<this.images.length;o++){r=this.images[o].toJSON(e);n.images.push(r.uuid)}return n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return u}));var r=n(107),o=n(65),a=n(40),s=n(32),l=(n(28),n(104)),c=n(136);function u(){}u.traverseDeep=function(t,e){if(void 0!==e)for(var n in t){var i=t[n];"object"==typeof i?!1!==e(i,t,n)&&u.traverseDeep(i,e):e(i,t,n)}},u.swapResource=function(t,e,n){void 0===RM[t][e.uuid]&&TDS_RT.alert("Old resource not found in the resource."),delete RM[t][e.uuid],u.traverseDeep(manager,(function(t,i,r){return t!==e||(i[r]=n,!1)})),RM[t][n.uuid]=n},u.removeDuplicated=function(e){u.traverseDeep(e,(function(e){e instanceof t.Texture||t.Materials}))},u.addResource=function(t,e){void 0!==e&&(RM[e][t.uuid]=t)},u.removeResource=function(t,e){"materials"===e?RM.removeMaterial(t,Editor.defaultMaterial,Editor.defaultSpriteMaterial):"textures"===e?RM.removeTexture(t,Editor.defaultTexture):"fonts"===e?RM.removeFont(t,Editor.defaultFont):"audio"===e?RM.removeAudio(t,Editor.defaultAudio):"geometries"===e?RM.removeGeometry(t,Editor.defaultGeometry):"videos"===e?RM.removeVideo(t):void 0!==RM[e]&&void 0!==RM[e][t.uuid]&&delete RM[e][t.uuid]},u.getResourceByName=function(t){for(var e in manager)for(var n in e)if(n[i].name===t)return n[i];return null},u.searchObject=function(e,n){var i;function u(t){h(t),void 0===RM.materials[t.uuid]&&(i.materials[t.uuid]=t)}function h(t){f(t.map),f(t.bumpMap),f(t.normalMap),f(t.displacementMap),f(t.specularMap),f(t.emissiveMap),f(t.alphaMap),f(t.roughnessMap),f(t.metalnessMap),f(t.envMap)}function f(t){null!=t&&(p(t),void 0===RM.textures[t.uuid]&&(i.textures[t.uuid]=t))}function d(t){void 0===RM.images[t.uuid]&&(i.images[t.uuid]=t)}function p(t){if(t.img instanceof s.a&&d(t.img),t.video instanceof a.a&&void 0===RM.videos[t.video.uuid]&&(i.videos[t.video.uuid]=t.video),void 0!==t.images)for(var e=0;e<t.images.length;e++)d(t.images[e])}for(var m in i=void 0!==n?n:new l.a.Resources,e.traverse((function(e){if(!e.locked){if(e.font instanceof r.a&&void 0===RM.fonts[e.font.uuid]&&(i.fonts[e.font.uuid]=e.font),e.audio instanceof o.a&&void 0===RM.audio[e.audio.uuid]&&(i.audio[e.audio.uuid]=e.audio),void 0!==e.material)if(e.material instanceof t.Material)u(e.material);else if(e.material instanceof Array)for(var n=0;n<e.material.length;n++)u(e.material[n]);else if(e.materials instanceof Array)for(n=0;n<e.materials.length;n++)u(e.materials[n]);else if(e.material instanceof t.MultiMaterial){var a=e.material.materials;for(n=0;n<a.length;n++)u(a[n])}if((e instanceof t.Mesh||e instanceof t.SkinnedMesh)&&(e.geometry instanceof t.BufferGeometry||e.geometry instanceof t.Geometry)&&void 0===RM.geometries[e.geometry.uuid]&&(i.geometries[e.geometry.uuid]=e.geometry),void 0!==e.texture&&f(e.texture),e instanceof c.a)for(var s=0;s<e.elements.length;s++)f(e.elements[s].texture)}})),RM.materials)h(RM.materials[m]);for(var m in RM.textures)p(RM.textures[m]);return i}}).call(this,n(0))},,function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var l,c=[],u=!1,h=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&d())}function d(){if(!u){var t=s(f);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||u||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){var i;!function(){"use strict";var r=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,a=1/6,s=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;function c(t){var e;e="function"==typeof t?t:t?function(){var t=0,e=0,n=0,i=1,r=h();t=r(" "),e=r(" "),n=r(" ");for(var o=0;o<arguments.length;o++)(t-=r(arguments[o]))<0&&(t+=1),(e-=r(arguments[o]))<0&&(e+=1),(n-=r(arguments[o]))<0&&(n+=1);return r=null,function(){var r=2091639*t+2.3283064365386963e-10*i;return t=e,e=n,n=r-(i=0|r)}}(t):Math.random,this.p=u(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}function u(t){var e,n=new Uint8Array(256);for(e=0;e<256;e++)n[e]=e;for(e=0;e<255;e++){var i=e+~~(t()*(256-e)),r=n[e];n[e]=n[i],n[i]=r}return n}function h(){var t=4022871197;return function(e){e=e.toString();for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)}}c.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,e){var n,i,a=this.permMod12,s=this.perm,l=this.grad3,c=0,u=0,h=0,f=(t+e)*r,d=Math.floor(t+f),p=Math.floor(e+f),m=(d+p)*o,g=t-(d-m),v=e-(p-m);g>v?(n=1,i=0):(n=0,i=1);var y=g-n+o,x=v-i+o,b=g-1+2*o,w=v-1+2*o,_=255&d,M=255&p,S=.5-g*g-v*v;if(S>=0){var T=3*a[_+s[M]];c=(S*=S)*S*(l[T]*g+l[T+1]*v)}var A=.5-y*y-x*x;if(A>=0){var E=3*a[_+n+s[M+i]];u=(A*=A)*A*(l[E]*y+l[E+1]*x)}var q=.5-b*b-w*w;if(q>=0){var C=3*a[_+1+s[M+1]];h=(q*=q)*q*(l[C]*b+l[C+1]*w)}return 70*(c+u+h)},noise3D:function(t,e,n){var i,r,o,s,l,c,u,h,f,d,p=this.permMod12,m=this.perm,g=this.grad3,v=(t+e+n)*(1/3),y=Math.floor(t+v),x=Math.floor(e+v),b=Math.floor(n+v),w=(y+x+b)*a,_=t-(y-w),M=e-(x-w),S=n-(b-w);_>=M?M>=S?(l=1,c=0,u=0,h=1,f=1,d=0):_>=S?(l=1,c=0,u=0,h=1,f=0,d=1):(l=0,c=0,u=1,h=1,f=0,d=1):M<S?(l=0,c=0,u=1,h=0,f=1,d=1):_<S?(l=0,c=1,u=0,h=0,f=1,d=1):(l=0,c=1,u=0,h=1,f=1,d=0);var T=_-l+a,A=M-c+a,E=S-u+a,q=_-h+2*a,C=M-f+2*a,P=S-d+2*a,R=_-1+.5,L=M-1+.5,I=S-1+.5,D=255&y,O=255&x,N=255&b,F=.6-_*_-M*M-S*S;if(F<0)i=0;else{var B=3*p[D+m[O+m[N]]];i=(F*=F)*F*(g[B]*_+g[B+1]*M+g[B+2]*S)}var z=.6-T*T-A*A-E*E;if(z<0)r=0;else{var U=3*p[D+l+m[O+c+m[N+u]]];r=(z*=z)*z*(g[U]*T+g[U+1]*A+g[U+2]*E)}var k=.6-q*q-C*C-P*P;if(k<0)o=0;else{var j=3*p[D+h+m[O+f+m[N+d]]];o=(k*=k)*k*(g[j]*q+g[j+1]*C+g[j+2]*P)}var V=.6-R*R-L*L-I*I;if(V<0)s=0;else{var G=3*p[D+1+m[O+1+m[N+1]]];s=(V*=V)*V*(g[G]*R+g[G+1]*L+g[G+2]*I)}return 32*(i+r+o+s)},noise4D:function(t,e,n,i){var r,o,a,c,u,h,f,d,p,m,g,v,y,x,b,w,_,M=this.perm,S=this.grad4,T=(t+e+n+i)*s,A=Math.floor(t+T),E=Math.floor(e+T),q=Math.floor(n+T),C=Math.floor(i+T),P=(A+E+q+C)*l,R=t-(A-P),L=e-(E-P),I=n-(q-P),D=i-(C-P),O=0,N=0,F=0,B=0;R>L?O++:N++,R>I?O++:F++,R>D?O++:B++,L>I?N++:F++,L>D?N++:B++,I>D?F++:B++;var z=R-(h=O>=3?1:0)+l,U=L-(f=N>=3?1:0)+l,k=I-(d=F>=3?1:0)+l,j=D-(p=B>=3?1:0)+l,V=R-(m=O>=2?1:0)+2*l,G=L-(g=N>=2?1:0)+2*l,H=I-(v=F>=2?1:0)+2*l,W=D-(y=B>=2?1:0)+2*l,X=R-(x=O>=1?1:0)+3*l,Y=L-(b=N>=1?1:0)+3*l,Z=I-(w=F>=1?1:0)+3*l,Q=D-(_=B>=1?1:0)+3*l,J=R-1+4*l,K=L-1+4*l,$=I-1+4*l,tt=D-1+4*l,et=255&A,nt=255&E,it=255&q,rt=255&C,ot=.6-R*R-L*L-I*I-D*D;if(ot<0)r=0;else{var at=M[et+M[nt+M[it+M[rt]]]]%32*4;r=(ot*=ot)*ot*(S[at]*R+S[at+1]*L+S[at+2]*I+S[at+3]*D)}var st=.6-z*z-U*U-k*k-j*j;if(st<0)o=0;else{var lt=M[et+h+M[nt+f+M[it+d+M[rt+p]]]]%32*4;o=(st*=st)*st*(S[lt]*z+S[lt+1]*U+S[lt+2]*k+S[lt+3]*j)}var ct=.6-V*V-G*G-H*H-W*W;if(ct<0)a=0;else{var ut=M[et+m+M[nt+g+M[it+v+M[rt+y]]]]%32*4;a=(ct*=ct)*ct*(S[ut]*V+S[ut+1]*G+S[ut+2]*H+S[ut+3]*W)}var ht=.6-X*X-Y*Y-Z*Z-Q*Q;if(ht<0)c=0;else{var ft=M[et+x+M[nt+b+M[it+w+M[rt+_]]]]%32*4;c=(ht*=ht)*ht*(S[ft]*X+S[ft+1]*Y+S[ft+2]*Z+S[ft+3]*Q)}var dt=.6-J*J-K*K-$*$-tt*tt;if(dt<0)u=0;else{var pt=M[et+1+M[nt+1+M[it+1+M[rt+1]]]]%32*4;u=(dt*=dt)*dt*(S[pt]*J+S[pt+1]*K+S[pt+2]*$+S[pt+3]*tt)}return 27*(r+o+a+c+u)}},c._buildPermutationTable=u,void 0===(i=function(){return c}.call(e,n,e,t))||(t.exports=i),e.SimplexNoise=c,t.exports=c}()},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return s}));const i={};function r(e,n,r,o,a){!function(e,n,r,o=16776960,a=10){if(i.hasOwnProperty(e)&&window.debug.scene.remove(i[e]),!window.debug.show)return;const s=new t.Vector3(r[0],r[1],r[2]),l=new t.Vector3(n[0],n[1],n[2]);i[e]=new t.ArrowHelper(s.sub(l).normalize(),l,a,o,2,1),window.debug.scene.add(i[e])}(e,n,[n[0]+r[0],n[1]+r[1],n[2]+r[2]],o,a)}const o={};function a(e,n,i=16776960,r=1){if(o.hasOwnProperty(e)&&window.debug.scene.remove(o[e]),!window.debug.show)return;const a=new t.SphereGeometry(r,32,32),s=new t.MeshBasicMaterial({color:i});o[e]=new t.Mesh(a,s),o[e].position.set(n[0],n[1],n[2]),window.debug.scene.add(o[e])}class s{constructor(t){this.OK=0,this.OUT_OF_RANGE=1,this.OUT_OF_BOUNDS=2,this.V1_length_x_z=Math.sqrt(Math.pow(t[1][0],2)+Math.pow(t[1][2],2)),this.V4_length_x_y_z=Math.sqrt(Math.pow(t[4][0],2)+Math.pow(t[4][2],2)+Math.pow(-t[4][1],2)),this.J_initial_absolute=[];const e=[0,0,0];for(let n=0;n<t.length;n++)this.J_initial_absolute.push([e[0],e[1],e[2]]),e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];this.R_corrected=[0,0,0,0,0,0],this.R_corrected[1]+=Math.PI/2,this.R_corrected[1]-=Math.atan2(t[1][0],t[1][2]),this.R_corrected[2]+=Math.PI/2,this.R_corrected[2]+=Math.atan2(t[2][2]+t[3][2],t[2][0]+t[3][0]),this.R_corrected[2]+=Math.atan2(t[1][0],t[1][2]),this.R_corrected[4]+=Math.PI,this.geometry=t}calculateAngles(t,e,n,i,o,s,l,c=[!1,!1,!1]){const u=Math.cos(s),h=Math.sin(s),f=Math.cos(o),d=Math.sin(o),p=Math.cos(i),m=Math.sin(i),g=[d,-m*f,p*f],v=[this.R_corrected[0],this.R_corrected[1],this.R_corrected[2],this.R_corrected[3],this.R_corrected[4],this.R_corrected[5]],y=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];y[5][0]=t,y[5][1]=e,y[5][2]=n,a("J5",y[5]),y[4][0]=t-this.V4_length_x_y_z*g[0],y[4][1]=e-this.V4_length_x_y_z*g[1],y[4][2]=n-this.V4_length_x_y_z*g[2],a("J4",y[4]);const x=Math.asin(this.J_initial_absolute[4][1]/this.length2(y[4][1],y[4][0]));v[0]+=Math.atan2(y[4][1],y[4][0]),v[0]+=-x,c[0]&&(v[0]+=2*x-Math.PI),-this.J_initial_absolute[4][1]>this.length2(y[4][2],y[4][0])&&Serial.println("out of reach"),y[1][0]=Math.cos(v[0])*this.geometry[0][0]+Math.sin(v[0])*-this.geometry[0][1],y[1][1]=Math.sin(v[0])*this.geometry[0][0]+Math.cos(v[0])*this.geometry[0][1],y[1][2]=this.geometry[0][2],a("J1",y[1],65280);const b=[];b[0]=Math.cos(v[0])*y[4][0]+Math.sin(v[0])*y[4][1],b[1]=Math.sin(v[0])*y[4][0]+Math.cos(v[0])*-y[4][1],b[2]=y[4][2],a("J4_x_z",b,16711680);const w=Math.pow(b[0]-this.J_initial_absolute[1][0],2)+Math.pow(b[2]-this.J_initial_absolute[1][2],2),_=this.length2(this.geometry[2][0]+this.geometry[3][0],this.geometry[2][2]+this.geometry[3][2]);v[2]+=((c[1]?!c[0]:c[0])?1:-1)*Math.acos((-w+Math.pow(_,2)+Math.pow(this.V1_length_x_z,2))/(2*_*this.V1_length_x_z)),v[2]-=2*Math.PI,v[2]=(v[2]+3*Math.PI)%(2*Math.PI)-Math.PI;const M=Math.sqrt(w);v[1]-=Math.atan2(b[2]-this.J_initial_absolute[1][2],b[0]-this.J_initial_absolute[1][0]),v[1]+=((c[1]?!c[0]:c[0])?1:-1)*Math.acos((w-Math.pow(_,2)+Math.pow(this.V1_length_x_z,2))/(2*M*this.V1_length_x_z)),v[1]=(v[1]+3*Math.PI)%(2*Math.PI)-Math.PI;const S=Math.cos(v[0]),T=Math.sin(v[0]),A=this.geometry[0][0],E=this.geometry[0][2],q=-this.geometry[0][1],C=Math.cos(v[1]),P=Math.sin(v[1]),R=this.geometry[1][0],L=this.geometry[1][2],I=-this.geometry[1][1],D=Math.cos(v[2]),O=Math.sin(v[2]),N=this.geometry[2][0],F=this.geometry[2][2],B=-this.geometry[2][1];y[2][0]=S*A+T*q+S*C*R-S*-P*L+T*I,y[2][1]=-(-T*A+S*q-T*C*R+T*-P*L+S*I),y[2][2]=E+-P*R+C*L,a("J2",y[2],255),y[3][0]=y[2][0]+S*C*D*N-S*-P*-O*N-S*-P*D*F-S*C*-O*F+T*B,y[3][1]=y[2][1]-(-T*C*D*N+T*-P*-O*N+T*-P*D*F+T*C*-O*F+S*B),y[3][2]=y[2][2]+-P*D*N+C*-O*N+C*D*F+P*-O*F,a("J3",y[3],255);const z=[y[5][0]-y[4][0],y[5][1]-y[4][1],y[5][2]-y[4][2]],U=[y[3][0]-y[4][0],y[3][1]-y[4][1],y[3][2]-y[4][2]],k=this.cross(z,U);r("normal J4",y[4],k,12245589,8);const j=[10*-Math.sin(v[0]),10*Math.cos(v[0]),0],V=this.cross(j,U);r("normal J4 Y_vectors",y[4],V,16711935),r("XZ_parallel_aligned_vector",y[4],j,1179409),v[3]=this.angleBetween(k,j,V),c[2]&&(v[3]+=Math.PI),v[3]=(v[3]+3*Math.PI)%(2*Math.PI)-Math.PI,v[4]+=(c[2]?1:-1)*this.angleBetween2(z,U),v[4]=(v[4]+3*Math.PI)%(2*Math.PI)-Math.PI;const G=[-f*h,p*u-m*d*h,m*u+p*d*h];v[5]-=this.angleBetween(k,G,this.cross(g,G)),c[2]&&(v[5]+=Math.PI),v[5]=(v[5]+3*Math.PI)%(2*Math.PI)-Math.PI;l[0]=v[0],l[1]=v[1],l[2]=v[2],l[3]=v[3],l[4]=v[4],l[5]=v[5]}calculateTCP(t,e,n,i,r,o,a){const s=[[],[],[],[],[],[]];this.calculateCoordinates(t,e,n,i,r,o,s),a[0]=s[5][0],a[1]=s[5][1],a[2]=s[5][2],a[3]=s[5][3],a[4]=s[5][4],a[5]=s[5][5]}calculateCoordinates(t,e,n,i,r,o,a,s=[!1,!1,!1]){const l=Math.cos(t),c=Math.sin(t),u=this.geometry[0][0],h=this.geometry[0][1],f=this.geometry[0][2],d=Math.cos(e),p=Math.sin(e),m=this.geometry[1][0],g=this.geometry[1][1],v=this.geometry[1][2],y=Math.cos(n),x=Math.sin(n),b=this.geometry[2][0],w=this.geometry[2][1],_=this.geometry[2][2],M=Math.cos(i),S=Math.sin(i),T=this.geometry[3][0],A=this.geometry[3][1],E=this.geometry[3][2],q=Math.cos(r),C=Math.sin(r),P=this.geometry[4][0],R=this.geometry[4][1],L=this.geometry[4][2],I=Math.cos(o),D=Math.sin(o);a[0][0]=0,a[0][1]=0,a[0][2]=0,a[1][0]=a[0][0]+l*u-c*h,a[1][1]=a[0][1]+c*u+l*h,a[1][2]=a[0][2]+f,a[2][0]=a[1][0]+l*d*m-c*g+l*p*v,a[2][1]=a[1][1]+c*d*m+l*g+c*p*v,a[2][2]=a[1][2]+-p*m+d*v,a[3][0]=a[2][0]+l*d*y*b-l*p*x*b-c*w+l*p*y*_+l*d*x*_,a[3][1]=a[2][1]+c*d*y*b-c*p*x*b+l*w+c*p*y*_+c*d*x*_,a[3][2]=a[2][2]-p*y*b-d*x*b+d*y*_-p*x*_,a[4][0]=a[3][0]+l*d*y*T-l*p*x*T-c*M*A+l*p*y*S*A+l*d*x*S*A+l*p*y*M*E+l*d*x*M*E+c*S*E,a[4][1]=a[3][1]+c*d*y*T-c*p*x*T+l*M*A+c*p*y*S*A+c*d*x*S*A+c*p*y*M*E+c*d*x*M*E-l*S*E,a[4][2]=a[3][2]-p*y*T-d*x*T+d*y*S*A-p*x*S*A+d*y*M*E-p*x*M*E,a[5][0]=a[4][0]+l*d*y*q*P-l*p*x*q*P-l*p*y*M*C*P-l*d*x*M*C*P-c*S*C*P-c*M*R+l*p*y*S*R+l*d*x*S*R+l*p*y*M*q*L+l*d*x*M*q*L+c*S*q*L+l*d*y*C*L-l*p*x*C*L,a[5][1]=a[4][1]+c*d*y*q*P-c*p*x*q*P-c*p*y*M*C*P-c*d*x*M*C*P+l*S*C*P+l*M*R+c*p*y*S*R+c*d*x*S*R+c*p*y*M*q*L+c*d*x*M*q*L-l*S*q*L+c*d*y*C*L-c*p*x*C*L,a[5][2]=a[4][2]-p*y*q*P-d*x*q*P-d*y*M*C*P+p*x*M*C*P+d*y*S*R-p*x*S*R+d*y*M*q*L-p*x*M*q*L-p*y*C*L-d*x*C*L;const O=[[-D*c*M+D*l*p*y*S+D*l*d*x*S-I*l*p*y*M*q-I*l*d*x*M*q-I*c*S*q-I*l*d*y*C+I*l*p*x*C,-I*c*M+I*l*p*y*S+I*l*d*x*S+D*l*p*y*M*q+D*l*d*x*M*q+D*c*S*q+D*l*d*y*C-D*l*p*x*C,l*d*y*q-l*p*x*q-l*p*y*M*C-l*d*x*M*C-c*S*C],[D*l*M+D*c*p*y*S+D*c*d*x*S-I*c*p*y*M*q-I*c*d*x*M*q+I*l*S*q-I*c*d*y*C+I*c*p*x*C,I*l*M+I*c*p*y*S+I*c*d*x*S+D*c*p*y*M*q+D*c*d*x*M*q-D*l*S*q+D*c*d*y*C-D*c*p*x*C,c*d*y*q-c*p*x*q-c*p*y*M*C-c*d*x*M*C+l*S*C],[D*d*y*S-D*p*x*S-I*d*y*M*q+I*p*x*M*q+I*p*y*C+I*d*x*C,I*d*y*S-I*p*x*S+D*d*y*M*q-D*p*x*M*q-D*p*y*C-D*d*x*C,-p*y*q-d*x*q-d*y*M*C+p*x*M*C]];let N,F,B;O[0][2]<1?O[0][2]>-1?(N=Math.asin(O[0][2]),F=Math.atan2(-O[1][2],O[2][2]),B=Math.atan2(-O[0][1],O[0][0])):(N=-Math.PI/2,F=-Math.atan2(O[1][0],O[1][1]),B=0):(N=+Math.PI/2,F=Math.atan2(O[1][0],O[1][1]),B=0),a[5][3]=F,a[5][4]=N,a[5][5]=B}cross(t,e,n=[]){return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n}dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}angleBetween(t,e,n){const i=this.length3(this.cross(t,e));return Math.atan2(i,e[0]*t[0]+e[1]*t[1]+e[2]*t[2])*(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]>1e-4?1:-1)}length3(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))}length2(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}angleBetween2(t,e){const n=this.cross(t,e);return Math.atan2(this.length3(n),this.dot(t,e))}normalize(t,e){const n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n}}}.call(this,n(0))},function(t,e,n){t.exports=n.p+"assets/scene.png"},function(t,e,n){"use strict";n.r(e);var i=n(446),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n){var o=r.call(this,t);this.name="Directional Light",this.className="DirectionalLightEntity",this.type="DirectionalLight";var a=new i.a(this,t,e,n);return o.addComponent(a),this.object3D=a.object3D,o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getLight=function(){return this.object3D},e.default=o("DirectionalLightEntity",a)},function(t,e,n){"use strict";n.r(e);var i=n(447),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n){var o=r.call(this,t);this.name="Ambient Light",this.className="AmbientLightEntity",this.type="AmbientLight",this.isLight=!0;var a=new i.a(this,t,e,n);return o.addComponent(a),this.object3D=a.object3D,o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getLight=function(){return this.object3D},e.default=o("AmbientLightEntity",a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(){var t=r.SkyShader,e=new i.ShaderMaterial({name:"SkyShader",fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i.UniformsUtils.clone(t.uniforms),side:i.BackSide,depthWrite:!1});i.Mesh.call(this,new i.BoxBufferGeometry(1,1,1),e)};r.prototype=Object.create(i.Mesh.prototype),r.SkyShader={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new i.Vector3},up:{value:new i.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}},function(t,e,n){"use strict";(function(t){function i(e,n,i,r,o,a,s,l,c,u,h,f){t.CanvasTexture.call(this,e||document.createElement("canvas"),r,o,a,s,l,c,u,h,f),this.name="canvas",this.category="Canvas",this.format=t.RGBAFormat,Object.defineProperties(this,{width:{get:function(){return this.image.width},set:function(t){this.image.width=t}},height:{get:function(){return this.image.height},set:function(t){this.image.height=t}}}),this.width=void 0!==n?n:1,this.height=void 0!==i?i:1,this.context=this.image.getContext("2d")}n.d(e,"a",(function(){return i})),i.prototype=Object.create(t.CanvasTexture.prototype),i.prototype.isCanvasTexture=!0,i.prototype.placeholder=function(){this.context.fillStyle="#000000",this.context.fillRect(0,0,this.width,this.height),this.context.font="Normal "+Math.round(this.width/12)+"px Arial",this.context.textAlign="center",this.context.fillStyle="#FF0000",this.context.fillText("Canvas Texture",this.width/2,this.height/2),this.needsUpdate=!0},i.prototype.clear=function(t){void 0===t?this.context.clearRect(0,0,width,height):(this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height))},i.prototype.toJSON=function(e){var n=t.Texture.prototype.toJSON.call(this,e);return n.width=this.width,n.height=this.height,n}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);i.UniformsLib.line={linewidth:{value:1},resolution:{value:new i.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}},i.ShaderLib.line={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var r=function(t){i.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:i.UniformsUtils.clone(i.ShaderLib.line.uniforms),vertexShader:i.ShaderLib.line.vertexShader,fragmentShader:i.ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};r.prototype=Object.create(i.ShaderMaterial.prototype),r.prototype.constructor=r,r.prototype.isLineMaterial=!0},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(448),r=n(99);function o(){}o.Type={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron"},o.createShape=function(t,e,n){var i=e||(t.geometry?t.geometry.type:"BufferGeometry"),r=o.getGeometry(t,n);if(!r)return null;switch(i){case"BoxGeometry":case"BoxBufferGeometry":return o.createBoundingBoxShape(t);case"CylinderGeometry":case"CylinderBufferGeometry":return o.createBoundingCylinderShape(t);case"SphereGeometry":case"SphereBufferGeometry":return o.createBoundingSphereShape(t);case"PlaneGeometry":case"PlaneBufferGeometry":return o.createPlaneShape(r);case"TubeGeometry":return o.createTubeShape(r);case"Geometry":case"BufferGeometry":return o.createBoundingBoxShape(t);case"Compound":return o.createTrimeshShape(r);default:return o.createBoxShape(r)}},o.createBoxShape=function(t){if(!o.getVertices(t).length)return null;t.computeBoundingBox();var e=t.boundingBox;return new CANNON.Box(new CANNON.Vec3((e.max.x-e.min.x)/2,(e.max.y-e.min.y)/2,(e.max.z-e.min.z)/2))},o.createBoundingBoxShape=function(t){var e=new CANNON.Vec3;if(t.geometry.parameters){var n=t.geometry.parameters;e.x=void 0!==n.width?n.width/2:.5,e.y=void 0!==n.height?n.height/2:.5,e.z=void 0!==n.depth?n.depth/2:.5}else{t.geometry.boundingBox||t.geometry.computeBoundingBox();var i=t.geometry.boundingBox;e.x=(i.max.x-i.min.x)/2,e.y=(i.max.y-i.min.y)/2,e.z=(i.max.z-i.min.z)/2}return e.x*=t.scale.x,e.y*=t.scale.y,e.z*=t.scale.z,new CANNON.Box(e)},o.createConvexPolyhedron=function(e){function n(t,e,n){return function(t,e,n,i){var r=new CANNON.Vec3,o=new CANNON.Vec3;e.vsub(t,o),n.vsub(e,r),r.cross(o,i),i.isZero()||i.normalize()}(t[e[0]],t[e[1]],t[e[2]],n)}function r(t,e){var i=new CANNON.Vec3;n(t,e,i),i.negate(i);var r=t[e[0]];return!(i.dot(r)<0)}var o=new i.a,a=new t.Mesh(e);o.setFromObject(a);for(var s=[],l=[],c=[],u=0;u<o.faces.length;u++){var h=o.faces[u],f=h.edge;do{var d=f.head().point;s.push(new CANNON.Vec3(d.x,d.y,d.z)),f=f.next}while(f!==h.edge);var p=[s.length-3,s.length-2,s.length-1];r(s,p)&&l.push(p),c.push(new CANNON.Vec3(h.normal.x,h.normal.y,h.normal.z))}return new CANNON.ConvexPolyhedron(s,l)},o.createCylinderShape=function(t){var e=t.parameters,n=new CANNON.Cylinder(e.radiusTop,e.radiusBottom,e.height,e.radialSegments);return n.orientation=new CANNON.Quaternion,n.orientation.setFromEuler(0,0,0,"XYZ").normalize(),n},o.createBoundingCylinderShape=function(t){var e=["x","y","z"],n=e.splice(e.indexOf("y"),1)&&e,i=o.getGeometry(t);i.computeBoundingBox(),i.computeBoundingSphere();var r=i.boundingBox.max.y-i.boundingBox.min.y,a=.5*Math.max(i.boundingBox.max[n[0]]-i.boundingBox.min[n[0]],i.boundingBox.max[n[1]]-i.boundingBox.min[n[1]]),s=new CANNON.Cylinder(a,a,r,12);return s.orientation=new CANNON.Quaternion,s.orientation.setFromEuler(Math.PI/2,0,0,"XYZ").normalize(),s},o.createPlaneShape=function(t){if(!o.getVertices(t).length)return null;t.computeBoundingBox();var e=t.boundingBox;return new CANNON.Box(new CANNON.Vec3((e.max.x-e.min.x)/2,(e.max.y-e.min.y)/2,.01))},o.createSphereShape=function(t){return new CANNON.Sphere(t.parameters.radius)},o.createBoundingSphereShape=function(t){var e=1,n=t.geometry;return n.computeBoundingSphere(),e=n.boundingSphere.radius,e*=t.scale.x,new CANNON.Sphere(e)},o.createTubeShape=function(e){var n=new t.BufferGeometry;return n.fromGeometry(e),createTrimeshShape(n)},o.createTrimeshShape=function(t){var e,n=o.getVertices(t);return n.length?(e=Object.keys(n).map(Number),new CANNON.Trimesh(n,e)):null},o.getGeometry=function(e,n){var i=o.getMeshes(e);if(0===i.length)return null;var a=new t.Geometry;if(1===i.length){var s=new t.Vector3,l=new t.Quaternion,c=new t.Vector3(1,1,1);return a=i[0].geometry.clone(),i[0].updateMatrixWorld(),i[0].matrixWorld.decompose(s,l,c),a.scale(c.x,c.y,c.z)}for(var u,h=new t.Geometry;u=i.pop();)n==r.default.WORLD&&u.updateMatrixWorld(),u.geometry instanceof t.BufferGeometry?(a.fromBufferGeometry(u.geometry),n==r.default.WORLD?h.merge(a,u.matrixWorld):h.merge(a)):n==r.default.WORLD?h.merge(u.geometry,u.matrixWorld):h.merge(u.geometry);return h.scale(e.scale.x,e.scale.y,e.scale.z),h},o.getVertices=function(e){return e.attributes||(e=(new t.BufferGeometry).fromGeometry(e)),e.attributes.position.array},o.getMeshes=function(e){var n=[];return e.traverse((function(e){e instanceof t.Mesh&&n.push(e)})),n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(){t.Mesh.call(this,t.Lensflare.Geometry,new t.MeshBasicMaterial({opacity:0,transparent:!0})),this.name="lensflare",this.type="Flare",this.renderOrder=1/0,this.frustumCulled=!1,this.receiveShadow=!1,this.castShadow=!1,this.elements=[];var e=new t.Vector3,n=new t.DataTexture(new Uint8Array(768),16,16,t.RGBFormat);n.minFilter=t.NearestFilter,n.magFilter=t.NearestFilter,n.wrapS=t.ClampToEdgeWrapping,n.wrapT=t.ClampToEdgeWrapping,n.needsUpdate=!0;var i=new t.DataTexture(new Uint8Array(768),16,16,t.RGBFormat);i.minFilter=t.NearestFilter,i.magFilter=t.NearestFilter,i.wrapS=t.ClampToEdgeWrapping,i.wrapT=t.ClampToEdgeWrapping,i.needsUpdate=!0;var r=t.Lensflare.Geometry,o=t.Lensflare.Shader,a=new t.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\n\t\t\tuniform vec3 screenPosition;\n\t\t\tuniform vec2 scale;\n\t\t\tattribute vec3 position;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_Position = vec4(position.xy * scale + screenPosition.xy, screenPosition.z, 1.0);\n\t\t\t}",fragmentShader:"precision highp float;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n\t\t\t}",depthTest:!0,depthWrite:!1,transparent:!1}),s=new t.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:"precision highp float;\n\t\t\tuniform vec3 screenPosition;\n\t\t\tuniform vec2 scale;\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\t\t\tvarying vec2 vUV;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tvUV = uv;\n\t\t\t\tgl_Position = vec4(position.xy * scale + screenPosition.xy, screenPosition.z, 1.0);\n\t\t\t}",fragmentShader:"precision highp float;\n\t\t\tuniform sampler2D map;\n\t\t\tvarying vec2 vUV;\n\t\t\tvoid main()\n\t\t\t{\n\t\t\t\tgl_FragColor = texture2D(map, vUV);\n\t\t\t}",depthTest:!1,depthWrite:!1,transparent:!1}),l=new t.Mesh(r,a),c=(o=t.LensflareElement.Shader,new t.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new t.Color(16777215)},scale:{value:new t.Vector2},screenPosition:{value:new t.Vector3}},vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:t.AdditiveBlending,transparent:!0,depthWrite:!1})),u=new t.Mesh(r,c),h=new t.Vector2,f=new t.Vector2,d=new t.Box2,p=new t.Vector4;this.onBeforeRender=function(t,o,m){t.getCurrentViewport(p);var g=p.w/p.z,v=p.z/2,y=p.w/2,x=16/p.w;if(h.set(x*g,x),d.min.set(p.x,p.y),d.max.set(p.x+(p.z-16),p.y+(p.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(m.matrixWorldInverse),e.applyMatrix4(m.projectionMatrix),f.x=p.x+e.x*v+v-8,f.y=p.y+e.y*y+y-8,d.containsPoint(f)){t.copyFramebufferToTexture(f,n),(S=a.uniforms).scale.value=h,S.screenPosition.value=e,t.renderBufferDirect(m,null,r,a,l,null),t.copyFramebufferToTexture(f,i),(S=s.uniforms).scale.value=h,S.screenPosition.value=e,t.renderBufferDirect(m,null,r,s,l,null);for(var b=2*-e.x,w=2*-e.y,_=0,M=this.elements.length;_<M;_++){var S,T=this.elements[_];(S=c.uniforms).color.value.copy(T.color),S.map.value=T.texture,S.screenPosition.value.x=e.x+b*T.distance,S.screenPosition.value.y=e.y+w*T.distance;x=T.size/p.w,g=p.w/p.z;S.scale.value.set(x*g,x),c.uniformsNeedUpdate=!0,t.renderBufferDirect(m,null,r,c,u,null)}}},this.dispose=function(){a.dispose(),s.dispose(),c.dispose(),n.dispose(),i.dispose();for(var t=0;t<this.elements.length;t++)this.elements[t].texture.dispose()}}n.d(e,"a",(function(){return i})),n(533),i.prototype=Object.create(t.Mesh.prototype),i.prototype.addFlare=function(e,n,i,r){void 0===n&&(n=-1),void 0===i&&(i=0),void 0===r&&(r=new t.Color(16777215)),i=Math.min(i,Math.max(0,i)),this.addElement(new t.LensflareElement(e,n,i,r))},i.prototype.addElement=function(t){this.elements.push(t)},i.prototype.toJSON=function(e){var n=this,i=[],r=t.Object3D.prototype.toJSON.call(this,e,(function(t,e){for(var r=0;r<n.elements.length;r++){var o={};o.texture=n.elements[r].texture.toJSON(t).uuid,o.size=n.elements[r].size,o.distance=n.elements[r].distance,o.color=n.elements[r].color.getHex(),i.push(o)}}));return r.object.elements=i,r}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e){i.Mesh.call(this,t),this.type="Reflector";var n=this,o=void 0!==(e=e||{}).color?new i.Color(e.color):new i.Color(8355711),a=e.textureWidth||512,s=e.textureHeight||512,l=e.clipBias||0,c=e.shader||r.ReflectorShader,u=new i.Plane,h=new i.Vector3,f=new i.Vector3,d=new i.Vector3,p=new i.Matrix4,m=new i.Vector3(0,0,-1),g=new i.Vector4,v=new i.Vector3,y=new i.Vector3,x=new i.Vector4,b=new i.Matrix4,w=new i.PerspectiveCamera,_={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBFormat},M=new i.WebGLRenderTarget(a,s,_);i.MathUtils.isPowerOfTwo(a)&&i.MathUtils.isPowerOfTwo(s)||(M.texture.generateMipmaps=!1);var S=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(c.uniforms),fragmentShader:c.fragmentShader,vertexShader:c.vertexShader});S.uniforms.tDiffuse.value=M.texture,S.uniforms.color.value=o,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(t,e,i){if(f.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(i.matrixWorld),p.extractRotation(n.matrixWorld),h.set(0,0,1),h.applyMatrix4(p),v.subVectors(f,d),!(v.dot(h)>0)){v.reflect(h).negate(),v.add(f),p.extractRotation(i.matrixWorld),m.set(0,0,-1),m.applyMatrix4(p),m.add(d),y.subVectors(f,m),y.reflect(h).negate(),y.add(f),w.position.copy(v),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(h),w.lookAt(y),w.far=i.far,w.updateMatrixWorld(),w.projectionMatrix.copy(i.projectionMatrix),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(n.matrixWorld),u.setFromNormalAndCoplanarPoint(h,f),u.applyMatrix4(w.matrixWorldInverse),g.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var r=w.projectionMatrix;x.x=(Math.sign(g.x)+r.elements[8])/r.elements[0],x.y=(Math.sign(g.y)+r.elements[9])/r.elements[5],x.z=-1,x.w=(1+r.elements[10])/r.elements[14],g.multiplyScalar(2/g.dot(x)),r.elements[2]=g.x,r.elements[6]=g.y,r.elements[10]=g.z+1-l,r.elements[14]=g.w,M.texture.encoding=t.outputEncoding,n.visible=!1;var o=t.getRenderTarget(),a=t.xr.enabled,s=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(M),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,w),t.xr.enabled=a,t.shadowMap.autoUpdate=s,t.setRenderTarget(o);var c=i.viewport;void 0!==c&&t.state.viewport(c),n.visible=!0}},this.getRenderTarget=function(){return M}};r.prototype=Object.create(i.Mesh.prototype),r.prototype.constructor=r,r.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e){i.Mesh.call(this,t),this.type="Refractor";var n=this,o=void 0!==(e=e||{}).color?new i.Color(e.color):new i.Color(8355711),a=e.textureWidth||512,s=e.textureHeight||512,l=e.clipBias||0,c=e.shader||r.RefractorShader,u=new i.PerspectiveCamera;u.matrixAutoUpdate=!1,u.userData.refractor=!0;var h=new i.Plane,f=new i.Matrix4,d={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBFormat},p=new i.WebGLRenderTarget(a,s,d);i.MathUtils.isPowerOfTwo(a)&&i.MathUtils.isPowerOfTwo(s)||(p.texture.generateMipmaps=!1),this.material=new i.ShaderMaterial({uniforms:i.UniformsUtils.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,transparent:!0}),this.material.uniforms.color.value=o,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=f;var m,g,v,y,x,b,w,_,M=(m=new i.Vector3,g=new i.Vector3,v=new i.Matrix4,y=new i.Vector3,x=new i.Vector3,function(t){return m.setFromMatrixPosition(n.matrixWorld),g.setFromMatrixPosition(t.matrixWorld),y.subVectors(m,g),v.extractRotation(n.matrixWorld),x.set(0,0,1),x.applyMatrix4(v),y.dot(x)<0}),S=function(){var t=new i.Vector3,e=new i.Vector3,r=new i.Quaternion,o=new i.Vector3;return function(){n.matrixWorld.decompose(e,r,o),t.set(0,0,1).applyQuaternion(r).normalize(),t.negate(),h.setFromNormalAndCoplanarPoint(t,e)}}(),T=(b=new i.Plane,w=new i.Vector4,_=new i.Vector4,function(t){u.matrixWorld.copy(t.matrixWorld),u.matrixWorldInverse.getInverse(u.matrixWorld),u.projectionMatrix.copy(t.projectionMatrix),u.far=t.far,b.copy(h),b.applyMatrix4(u.matrixWorldInverse),w.set(b.normal.x,b.normal.y,b.normal.z,b.constant);var e=u.projectionMatrix;_.x=(Math.sign(w.x)+e.elements[8])/e.elements[0],_.y=(Math.sign(w.y)+e.elements[9])/e.elements[5],_.z=-1,_.w=(1+e.elements[10])/e.elements[14],w.multiplyScalar(2/w.dot(_)),e.elements[2]=w.x,e.elements[6]=w.y,e.elements[10]=w.z+1-l,e.elements[14]=w.w});this.onBeforeRender=function(t,e,i){p.texture.encoding=t.outputEncoding,!0!==i.userData.refractor&&!0!=!M(i)&&(S(),function(t){f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(t.projectionMatrix),f.multiply(t.matrixWorldInverse),f.multiply(n.matrixWorld)}(i),T(i),function(t,e,i){n.visible=!1;var r=t.getRenderTarget(),o=t.xr.enabled,a=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(p),!1===t.autoClear&&t.clear(),t.render(e,u),t.xr.enabled=o,t.shadowMap.autoUpdate=a,t.setRenderTarget(r);var s=i.viewport;void 0!==s&&t.state.viewport(s),n.visible=!0}(t,e,i))},this.getRenderTarget=function(){return p}};r.prototype=Object.create(i.Mesh.prototype),r.prototype.constructor=r,r.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvReflect = reflect( I, worldNormal );","\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\tvec4 refractedColor = vec4( 1.0 );","\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));var i={uniforms:{time:{type:"f",value:1},resolution:{type:"v2",value:new t.Vector2},refractionIndex:{type:"f",value:2.42},dispersion:{type:"f",value:.3},roughness:{type:"f",value:.1},glitters:{type:"v2v",value:[new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2,new t.Vector2]},color:{value:new t.Color(16777215)},envMap:{type:"t",value:null},backNormals:{type:"t",value:null}},vertexShader:"\n    varying vec3 vWorldCameraDir;\n    varying vec3 vWorldNormal;\n    varying vec3 vViewNormal;\n  \n    void main() {\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0);\n\n        vWorldCameraDir = worldPosition.xyz - cameraPosition;\n        vWorldCameraDir = normalize(vec3(-vWorldCameraDir.x, vWorldCameraDir.yz));\n\n        vWorldNormal = (modelMatrix * vec4(normal, 0.0)).xyz;\n        vWorldNormal = normalize(vec3(-vWorldNormal.x, vWorldNormal.yz));\n\n        vViewNormal = normalize( modelViewMatrix * vec4(normal, 0.0)).xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }",fragmentShader:"\n    #define REF_WAVELENGTH 579.0\n    #define RED_WAVELENGTH 650.0\n    #define GREEN_WAVELENGTH 525.0\n    #define BLUE_WAVELENGTH 440.0\n  \n    uniform float time;\n    uniform vec2 resolution;\n    uniform sampler2D backNormals;\n    uniform samplerCube envMap;\n    uniform float refractionIndex;\n    uniform vec3 color;\n    uniform vec2 glitters[24];\n    uniform float dispersion;\n    uniform float roughness;\n    varying vec3 vWorldCameraDir;\n    varying vec3 vWorldNormal;\n    varying vec3 vViewNormal;\n\n    const vec2 light_dir = vec2(0.1, 1.0);\n    const float bevelMul = 1.8760002;\n    const float lineMul = 1.06;\n    const float line1Mul = -1.0;\n    const float line2Mul = -1.0;\n    const float bevelExp = 0.772;\n    const float lineExp = 8.776;\n    const float glareMul = 0.736;\n    const float sparkleMul = -2.0;\n    const float displaceAmount = -2.17;\n    const float ptMul = 0.188;\n    const float ptDiv = 20.715;\n    const float distMul = 7.2980003;\n    const float distDiv = 1.02;    \n    const float bevel_size = 0.1;\n    const float spokes = 5.0;\n    const float PI = 3.1415926535897932384626433832795;\n    const float HALF_PI = 1.5707963267948966192313216916398;    \n    float spin0;\n\n    vec4 refractLight(float wavelength, vec3 backFaceNormal) {\n      float index = 1.0 / mix(refractionIndex, refractionIndex * REF_WAVELENGTH / wavelength, dispersion);\n      vec3 dir = vWorldCameraDir;\n      dir = refract(dir, vWorldNormal, index);\n      dir = refract(dir, backFaceNormal, index);\n      return textureCube(envMap, dir);\n    }\n  \n    //for sparkles\n    // Subpixel dithering by CeeJayDK\n    vec3 dither() {\n        float px = 1.0/ 255.0;\n        float fpx = px* fract(dot(gl_FragCoord.xy- .5, vec2(5./ 16., 19./ 36.)));\n        return vec3(px- fpx, fpx, px- fpx);\n    }    \n    mat2 rot2(float T) {\n        mat2 R = mat2(vec2(cos(T), sin(T)), vec2( -sin(T), cos(T)));\n        return R;\n    }    \n    vec3 fresnelSchlick(float cosTheta, vec3 F0)\n    {\n      return F0 + (1.0 - F0) * pow(1.0 + cosTheta, 5.0);\n    }\n\n    float udLine(vec2 p, vec2 a, vec2 b) {\n        vec2 pa = p- a, ba = b- a;\n        return length(pa- ba* dot(pa, ba)/ dot(ba, ba));\n    }\n    float glyph_dist2(in vec2 pt, float angle) {\n        float len = length(pt);\n        float rad = 1.0- len;\n        return rad- abs(sin(angle* spokes/ 2.0))* 0.6;\n    }\n    float glyph_dist(in vec2 pt) {\n        float angle = atan(pt.y, pt.x)- spin0* 2.0* PI;\n        return glyph_dist2(pt, angle);\n    }\n    vec2 sparklyPosition(float progress) {\n        vec2 pt = vec2(1, 0);\n        float angle = 2.0* PI* progress;\n        float glyph = glyph_dist2(pt, angle);\n        vec2 adjust = vec2(1.0- 0.5* bevel_size, 0);\n        vec2 trace = pt* glyph+ adjust;\n        vec2 pos = trace* rot2( -angle+ -2.0* PI* spin0);\n        return pos;\n    }\n    vec2 gradient(vec2 pt, float dist) {\n        float dfdu = glyph_dist(pt+ vec2(0.01, 0.0))- dist/ 1.01;\n        float dfdv = glyph_dist(pt+ vec2(0.0, 0.01))- dist/ 1.01;\n        vec2 grad = normalize(vec2(dfdu, -dfdv));\n        return grad;\n    }\n    float bevelShade(vec2 pt) {\n        return clamp(1.0* dot(gradient(pt, glyph_dist(pt)), light_dir)* 0.5+ 0.5, 0.0, 1.0);\n    }\n\n    //sobel edge detection\n    float sobel(sampler2D tex, vec2 vUv) {\n        vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );\n        //kernel definition (in glsl matrices are filled in column-major order)\n        const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 ); // x direction kernel\n        const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 ); // y direction kernel\n    \n        // fetch the 3x\n        // first column\n        float tx0y0 = texture2D( tex, vUv + texel * vec2( -1, -1 ) ).r;\n        float tx0y1 = texture2D( tex, vUv + texel * vec2( -1,  0 ) ).r;\n        float tx0y2 = texture2D( tex, vUv + texel * vec2( -1,  1 ) ).r;\n        \n        //second column\n        float tx1y0 = texture2D( tex, vUv + texel * vec2(  0, -1 ) ).r;\n        float tx1y1 = texture2D( tex, vUv + texel * vec2(  0,  0 ) ).r;\n        float tx1y2 = texture2D( tex, vUv + texel * vec2(  0,  1 ) ).r;\n        \n        //third column\n        float tx2y0 = texture2D( tex, vUv + texel * vec2(  1, -1 ) ).r;\n        float tx2y1 = texture2D( tex, vUv + texel * vec2(  1,  0 ) ).r;\n        float tx2y2 = texture2D( tex, vUv + texel * vec2(  1,  1 ) ).r;\n        \n        //gradient value in x direction\n        float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + \n            Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + \n            Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; \n        \n            //gradient value in y direction\n        float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + \n            Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + \n            Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; \n        \n        //magnitute of the total gradient\n        float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );\n        \n        return G;\n    }\n\n    void main() {\n      spin0 = time * 0.2;\n      vec2 uv = gl_FragCoord.xy / resolution.xy;\n      float aspect = resolution.x / resolution.y;\n      vec2 pt = (uv* 2.0- 1.0)* vec2(aspect, 1.0)* 1.0;\n\n      vec3 backFaceNormal = texture2D(backNormals, gl_FragCoord.xy / resolution).rgb;\n\n      float r = refractLight(RED_WAVELENGTH, backFaceNormal).r;\n      float g = refractLight(GREEN_WAVELENGTH, backFaceNormal).g;\n      float b = refractLight(BLUE_WAVELENGTH, backFaceNormal).b;\n  \n      vec3 fresnel = fresnelSchlick(dot(vec3(0.0,0.0,-1.0), vViewNormal), vec3(0.4));\n      vec3 reflectedColor = textureCube(envMap, reflect(vWorldCameraDir, vWorldNormal)).rgb * clamp((1.0 - roughness) + fresnel, 0.0, 1.0);\n\n      //sparkles\n      vec3 glareColor;\n      float dist;\n      for(float i = 0.0; i< 24.0; i++) {\n          //vec2 glintPos = sparklyPosition((i+ 1.0)/ 16.0);\n          vec2 glintPos = glitters[int(i)].xy / resolution.xy;\n          glintPos = (glintPos* 2.0- 1.0)* vec2(aspect, 1.0)* 1.0;\n          dist = distance(pt, glintPos);\n          float sparkle = dist* 2.0;\n          //sparkle = sobel(backNormals, uv);\n          if(sparkle< 1.0) {\n              float line1 = udLine(pt, glintPos, glintPos+ vec2(1, +1))* line1Mul;\n              float line2 = udLine(pt, glintPos, glintPos+ vec2(1, -1))* line2Mul;\n              float bevel = bevelShade(glintPos)* bevelMul;\n              float lines = 1.0+ (line1+ line2)* lineMul;\n              float glare = pow(bevel, bevelExp* 0.3)* pow(lines, lineExp* 5.0);\n              glareColor = vec3(0.,0.,0.) + glare* glareMul* (1.0- sparkle* sparkleMul);\n          }\n      }\n      glareColor += dither();\n      gl_FragColor.rgb = vec3(r,g,b) * color * 0.7 + glareColor + reflectedColor;\n      //gl_FragColor.rgb = vec3(dist);\n    }"}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(3),r=n(5).Component,o=n(5).registerComponent;function a(t,e,n,i,o,a){var s=r.call(this,t,e);return this.name="text",this.type="Text",this.singleTon=!1,this.text=n||"techbrood",this.words=[this.text],this.sliding=!1,this.params={color:i||16777215,size:o||1,height:a||.1,bevelEnabled:!1,bevelThickness:.01,bevelSize:.01,curveSegments:20},this.mirror=!1,this.textMesh1=null,this.textMesh2=null,this.group=null,e||this.createObject3D(),s}a.prototype=Object.create(r.prototype),a.prototype.createObject3D=function(){this.group=new t.Group,this.createText()},a.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return t.properties={text:this.text,sliding:this.sliding,mirror:this.mirror,params:this.params},t},a.prototype.fromJSON=function(t,e){return r.prototype.fromJSON.call(this,t,e),this.object3D.remove(...this.object3D.children),this.createObject3D(),this},a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.createText=function(){var e=[new t.MeshPhongMaterial({color:this.params.color,flatShading:!0}),new t.MeshPhongMaterial({color:this.params.color})],n=new t.TextGeometry(this.text,{font:new t.Font(i.a.getFont("Default")),size:this.params.size,height:this.params.height,bevelEnabled:this.params.bevelEnabled,bevelThickness:this.params.bevelThickness,bevelSize:this.params.bevelSize,curveSegments:this.params.curveSegments});n.computeBoundingBox(),n.computeVertexNormals();var r=-.5*(n.boundingBox.max.x-n.boundingBox.min.x);n=(new t.BufferGeometry).fromGeometry(n);var o=this.textMesh1=new t.Mesh(n,e);if(o.position.x=r,o.position.y=.5,o.position.z=0,o.rotation.x=0,o.rotation.y=2*Math.PI,this.group.add(o),this.mirror){var a=this.textMesh2=new t.Mesh(n,e);a.position.x=r,a.position.y=-.5,a.position.z=0,a.rotation.x=Math.PI,a.rotation.y=2*Math.PI,this.group.add(a)}this.object3D=this.group},a.prototype.refreshText=function(){this.group.remove(this.textMesh1),this.textMesh2&&this.group.remove(this.textMesh2),this.text&&""!==this.text&&(this.createText(),this.entity.componentChanged())},a.prototype.getSize=function(){var e=(new t.Box3).setFromObject(this.textMesh1),n=new t.Vector3;return e.getSize(n)},e.a=o("text",a)}).call(this,n(0))},,function(t,e,n){"use strict";function i(){}n.d(e,"a",(function(){return i})),i.webXRAvailable=!1,i.webXRSession=null,i.webVRAvailable=!1,i.webVRDisplay=null,i.vrAvailable=function(){return i.webXRAvailable||i.webVRAvailable},i.enterVR=function(t,e){i.webXRAvailable?i.getWebXRSession().then((function(n){t.xr.enabled=!0,t.xr.setSession(n),i.webXRSession=n,void 0!==e&&e()})):i.webVRAvailable?i.getWebVRDisplay().then((function(n){displays.length>0&&(i.webVRDisplay=displays[0],i.webVRDisplay.isPresenting||(t.xr.enabled=!0,t.xr.setDevice(i.webVRDisplay),i.webVRDisplay.requestPresent([{source:t.domElement}]),void 0!==e&&e()))})):console.warn("TDS: VR support is not available.")},i.exitVR=function(t){i.webXRAvailable&&null!==i.webXRSession?(t.xr.enabled=!1,t.xr.setSession(null),i.webXRSession.end(),i.webXRSession=null):i.webVRAvailable&&null!==i.webVRDisplay&&i.webVRDisplay.isPresenting&&(t.xr.enabled=!1,t.xr.setDevice(null),i.webVRDisplay.exitPresent(),i.webVRDisplay=null)},i.getWebXRSession=function(){if(!i.webXRAvailable)return Promise.reject("WebXR support is not available.");return navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]})},i.getWebVRDisplay=function(t){return i.webVRAvailable?navigator.getVRDisplays():Promise.reject("WebVR support is not available.")},void 0!==navigator.xr&&void 0!==navigator.xr.isSessionSupported?navigator.xr.isSessionSupported("immersive-vr").then((function(t){i.webXRAvailable=t})):void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then((function(t){i.webVRAvailable=t.length>0}))},,function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e){void 0===e&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),i.Object3D.call(this),this.visible=!1,this.domElement=e;var n=new o;this.add(n);var r=new a;this.add(r);var s=this;V("camera",t),V("object",void 0),V("enabled",!0),V("axis",null),V("mode","translate"),V("translationSnap",null),V("rotationSnap",null),V("scaleSnap",null),V("space","world"),V("size",1),V("dragging",!1),V("showX",!0),V("showY",!0),V("showZ",!0);var l={type:"change"},c={type:"mouseDown"},u={type:"mouseUp",mode:s.mode},h={type:"objectChange"},f=new i.Raycaster;function d(t,e,n){for(var i=e.intersectObject(t,!0),r=0;r<i.length;r++)if(i[r].object.visible||n)return i[r];return!1}var p=new i.Vector3,m=new i.Vector3,g=new i.Quaternion,v={X:new i.Vector3(1,0,0),Y:new i.Vector3(0,1,0),Z:new i.Vector3(0,0,1)},y=new i.Vector3,x=new i.Vector3,b=new i.Vector3,w=new i.Vector3,_=new i.Vector3,M=new i.Vector3,S=0,T=new i.Vector3,A=new i.Quaternion,E=new i.Vector3,q=new i.Vector3,C=new i.Quaternion,P=new i.Quaternion,R=new i.Vector3,L=new i.Vector3,I=new i.Quaternion,D=new i.Vector3,O=new i.Vector3,N=new i.Quaternion,F=new i.Quaternion,B=new i.Vector3,z=new i.Vector3,U=new i.Vector3,k=new i.Quaternion,j=new i.Vector3;function V(t,e){var i=e;Object.defineProperty(s,t,{get:function(){return void 0!==i?i:e},set:function(e){i!==e&&(i=e,r[t]=e,n[t]=e,s.dispatchEvent({type:t+"-changed",value:e}),s.dispatchEvent(l))}}),s[t]=e,r[t]=e,n[t]=e}function G(t){if(s.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:t.button};var n=t.changedTouches?t.changedTouches[0]:t,i=e.getBoundingClientRect();return{x:(n.clientX-i.left)/i.width*2-1,y:-(n.clientY-i.top)/i.height*2+1,button:t.button}}function H(t){if(s.enabled)switch(t.pointerType){case"mouse":s.pointerHover(G(t))}}function W(t){s.enabled&&(s.domElement.ownerDocument.addEventListener("pointermove",X,!1),s.pointerHover(G(t)),s.pointerDown(G(t)))}function X(t){s.enabled&&s.pointerMove(G(t))}function Y(t){s.enabled&&(s.domElement.ownerDocument.removeEventListener("pointermove",X,!1),s.pointerUp(G(t)))}function Z(t){!1!==s.enabled&&t.preventDefault()}V("worldPosition",O),V("worldPositionStart",L),V("worldQuaternion",N),V("worldQuaternionStart",I),V("cameraPosition",T),V("cameraQuaternion",A),V("pointStart",y),V("pointEnd",x),V("rotationAxis",w),V("rotationAngle",S),V("eye",z),e.addEventListener("touchstart",Z,!1),e.addEventListener("pointerdown",W,!1),e.addEventListener("pointermove",H,!1),s.domElement.ownerDocument.addEventListener("pointerup",Y,!1),this.dispose=function(){e.removeEventListener("touchstart",Z),e.removeEventListener("pointerdown",W),e.removeEventListener("pointermove",H),s.domElement.ownerDocument.removeEventListener("pointermove",X),s.domElement.ownerDocument.removeEventListener("pointerup",Y),this.traverse((function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},this.attach=function(t){return this.object=t,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(q,C,R),this.object.matrixWorld.decompose(O,N,B),P.copy(C).inverse(),F.copy(N).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(T,A,E),z.copy(T).sub(O).normalize(),i.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(t){if(void 0!==this.object&&!0!==this.dragging){f.setFromCamera(t,this.camera);var e=d(n.picker[this.mode],f);this.axis=e?e.object.name:null}},this.pointerDown=function(t){if(void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis){f.setFromCamera(t,this.camera);var e=d(r,f,!0);if(e){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),U.copy(this.object.position),k.copy(this.object.quaternion),j.copy(this.object.scale),this.object.matrixWorld.decompose(L,I,D),y.copy(e.point).sub(L)}this.dragging=!0,c.mode=this.mode,this.dispatchEvent(c)}},this.pointerMove=function(t){var e=this.axis,n=this.mode,i=this.object,o=this.space;if("scale"===n?o="local":"E"!==e&&"XYZE"!==e&&"XYZ"!==e||(o="world"),void 0!==i&&null!==e&&!1!==this.dragging&&-1===t.button){f.setFromCamera(t,this.camera);var a=d(r,f,!0);if(a){if(x.copy(a.point).sub(L),"translate"===n)b.copy(x).sub(y),"local"===o&&"XYZ"!==e&&b.applyQuaternion(F),-1===e.indexOf("X")&&(b.x=0),-1===e.indexOf("Y")&&(b.y=0),-1===e.indexOf("Z")&&(b.z=0),"local"===o&&"XYZ"!==e?b.applyQuaternion(k).divide(R):b.applyQuaternion(P).divide(R),i.position.copy(b).add(U),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(g.copy(k).inverse()),-1!==e.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(k)),"world"===o&&(i.parent&&i.position.add(p.setFromMatrixPosition(i.parent.matrixWorld)),-1!==e.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(p.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==e.search("XYZ")){var s=x.length()/y.length();x.dot(y)<0&&(s*=-1),m.set(s,s,s)}else p.copy(y),m.copy(x),p.applyQuaternion(F),m.applyQuaternion(F),m.divide(p),-1===e.search("X")&&(m.x=1),-1===e.search("Y")&&(m.y=1),-1===e.search("Z")&&(m.z=1);i.scale.copy(j).multiply(m),this.scaleSnap&&(-1!==e.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){b.copy(x).sub(y);var c=20/O.distanceTo(p.setFromMatrixPosition(this.camera.matrixWorld));"E"===e?(w.copy(z),S=x.angleTo(y),_.copy(y).normalize(),M.copy(x).normalize(),S*=M.cross(_).dot(z)<0?1:-1):"XYZE"===e?(w.copy(b).cross(z).normalize(),S=b.dot(p.copy(w).cross(this.eye))*c):"X"!==e&&"Y"!==e&&"Z"!==e||(w.copy(v[e]),p.copy(v[e]),"local"===o&&p.applyQuaternion(N),S=b.dot(p.cross(z).normalize())*c),this.rotationSnap&&(S=Math.round(S/this.rotationSnap)*this.rotationSnap),this.rotationAngle=S,"local"===o&&"E"!==e&&"XYZE"!==e?(i.quaternion.copy(k),i.quaternion.multiply(g.setFromAxisAngle(w,S)).normalize()):(w.applyQuaternion(P),i.quaternion.copy(g.setFromAxisAngle(w,S)),i.quaternion.multiply(k).normalize())}this.dispatchEvent(l),this.dispatchEvent(h)}}},this.pointerUp=function(t){0===t.button&&(this.dragging&&null!==this.axis&&(u.mode=this.mode,this.dispatchEvent(u)),this.dragging=!1,this.axis=null)},this.getMode=function(){return s.mode},this.setMode=function(t){s.mode=t},this.setTranslationSnap=function(t){s.translationSnap=t},this.setRotationSnap=function(t){s.rotationSnap=t},this.setScaleSnap=function(t){s.scaleSnap=t},this.setSize=function(t){s.size=t},this.setSpace=function(t){s.space=t},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};r.prototype=Object.assign(Object.create(i.Object3D.prototype),{constructor:r,isTransformControls:!0});var o=function(){i.Object3D.call(this),this.type="TransformControlsGizmo";var t=new i.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:i.DoubleSide,fog:!1,toneMapped:!1}),e=new i.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=t.clone();n.opacity=.15;var r=t.clone();r.opacity=.33;var o=t.clone();o.color.set(16711680);var a=t.clone();a.color.set(65280);var s=t.clone();s.color.set(255);var l=t.clone();l.opacity=.25;var c=l.clone();c.color.set(16776960);var u=l.clone();u.color.set(65535);var h=l.clone();h.color.set(16711935),t.clone().color.set(16776960);var f=e.clone();f.color.set(16711680);var d=e.clone();d.color.set(65280);var p=e.clone();p.color.set(255);var m=e.clone();m.color.set(65535);var g=e.clone();g.color.set(16711935);var v=e.clone();v.color.set(16776960);var y=e.clone();y.color.set(7895160);var x=v.clone();x.opacity=.25;var b=new i.CylinderBufferGeometry(0,.05,.2,12,1,!1),w=new i.BoxBufferGeometry(.125,.125,.125),_=new i.BufferGeometry;_.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,0,0],3));var M,S=function(t,e){for(var n=new i.BufferGeometry,r=[],o=0;o<=64*e;++o)r.push(0,Math.cos(o/32*Math.PI)*t,Math.sin(o/32*Math.PI)*t);return n.setAttribute("position",new i.Float32BufferAttribute(r,3)),n},T={X:[[new i.Mesh(b,o),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new i.Mesh(b,o),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new i.Line(_,f)]],Y:[[new i.Mesh(b,a),[0,1,0],null,null,"fwd"],[new i.Mesh(b,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new i.Line(_,d),null,[0,0,Math.PI/2]]],Z:[[new i.Mesh(b,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new i.Mesh(b,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new i.Line(_,p),null,[0,-Math.PI/2,0]]],XYZ:[[new i.Mesh(new i.OctahedronBufferGeometry(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new i.Mesh(new i.PlaneBufferGeometry(.295,.295),c.clone()),[.15,.15,0]],[new i.Line(_,v),[.18,.3,0],null,[.125,1,1]],[new i.Line(_,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new i.Mesh(new i.PlaneBufferGeometry(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new i.Line(_,m),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new i.Line(_,m),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new i.Mesh(new i.PlaneBufferGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new i.Line(_,g),[.18,0,.3],null,[.125,1,1]],[new i.Line(_,g),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},A={X:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.OctahedronBufferGeometry(.2,0),n)]],XY:[[new i.Mesh(new i.PlaneBufferGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new i.Mesh(new i.PlaneBufferGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.PlaneBufferGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},E={START:[[new i.Mesh(new i.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new i.Mesh(new i.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new i.Line((M=new i.BufferGeometry,M.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,1,1],3)),M),r),null,null,null,"helper"]],X:[[new i.Line(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},q={X:[[new i.Line(S(1,.5),f)],[new i.Mesh(new i.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[1,3,1]]],Y:[[new i.Line(S(1,.5),d),null,[0,0,-Math.PI/2]],[new i.Mesh(new i.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new i.Line(S(1,.5),p),null,[0,Math.PI/2,0]],[new i.Mesh(new i.OctahedronBufferGeometry(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new i.Line(S(1.25,1),x),null,[0,Math.PI/2,0]],[new i.Mesh(new i.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new i.Mesh(new i.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new i.Mesh(new i.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new i.Mesh(new i.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new i.Line(S(1,1),y),null,[0,Math.PI/2,0]]]},C={AXIS:[[new i.Line(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={X:[[new i.Mesh(new i.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i.Mesh(new i.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i.Mesh(new i.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i.Mesh(new i.TorusBufferGeometry(1.25,.1,2,24),n)]],XYZE:[[new i.Mesh(new i.SphereBufferGeometry(.7,10,8),n)]]},R={X:[[new i.Mesh(w,o),[.8,0,0],[0,0,-Math.PI/2]],[new i.Line(_,f),null,null,[.8,1,1]]],Y:[[new i.Mesh(w,a),[0,.8,0]],[new i.Line(_,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new i.Mesh(w,s),[0,0,.8],[Math.PI/2,0,0]],[new i.Line(_,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new i.Mesh(w,c),[.85,.85,0],null,[2,2,.2]],[new i.Line(_,v),[.855,.98,0],null,[.125,1,1]],[new i.Line(_,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new i.Mesh(w,u),[0,.85,.85],null,[.2,2,2]],[new i.Line(_,m),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new i.Line(_,m),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new i.Mesh(w,h),[.85,0,.85],null,[2,.2,2]],[new i.Line(_,g),[.855,0,.98],null,[.125,1,1]],[new i.Line(_,g),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new i.Mesh(new i.BoxBufferGeometry(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new i.Mesh(new i.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new i.Mesh(new i.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,0,1.1]]]},L={X:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new i.Mesh(new i.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new i.Mesh(w,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new i.Mesh(w,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new i.Mesh(w,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new i.Mesh(new i.BoxBufferGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new i.Mesh(new i.BoxBufferGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new i.Mesh(new i.BoxBufferGeometry(.2,.2,.2),n),[0,0,1.1]]]},I={X:[[new i.Line(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D=function(t){var e=new i.Object3D;for(var n in t)for(var r=t[n].length;r--;){var o=t[n][r][0].clone(),a=t[n][r][1],s=t[n][r][2],l=t[n][r][3],c=t[n][r][4];o.name=n,o.tag=c,a&&o.position.set(a[0],a[1],a[2]),s&&o.rotation.set(s[0],s[1],s[2]),l&&o.scale.set(l[0],l[1],l[2]),o.updateMatrix();var u=o.geometry.clone();u.applyMatrix4(o.matrix),o.geometry=u,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),e.add(o)}return e},O=new i.Vector3(0,0,0),N=new i.Euler,F=new i.Vector3(0,1,0),B=new i.Vector3(0,0,0),z=new i.Matrix4,U=new i.Quaternion,k=new i.Quaternion,j=new i.Quaternion,V=new i.Vector3(1,0,0),G=new i.Vector3(0,1,0),H=new i.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(T)),this.add(this.gizmo.rotate=D(q)),this.add(this.gizmo.scale=D(R)),this.add(this.picker.translate=D(A)),this.add(this.picker.rotate=D(P)),this.add(this.picker.scale=D(L)),this.add(this.helper.translate=D(E)),this.add(this.helper.rotate=D(C)),this.add(this.helper.scale=D(I)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var t=this.space;"scale"===this.mode&&(t="local");var e="local"===t?this.worldQuaternion:j;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<n.length;r++){var o,a=n[r];if(a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==a.tag){if(a.quaternion.copy(e),"translate"===this.mode||"scale"===this.mode){"X"!==a.name&&"XYZX"!==a.name||Math.abs(F.copy(V).applyQuaternion(e).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Y"!==a.name&&"XYZY"!==a.name||Math.abs(F.copy(G).applyQuaternion(e).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Z"!==a.name&&"XYZZ"!==a.name||Math.abs(F.copy(H).applyQuaternion(e).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XY"===a.name&&Math.abs(F.copy(H).applyQuaternion(e).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"YZ"===a.name&&Math.abs(F.copy(V).applyQuaternion(e).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XZ"===a.name&&Math.abs(F.copy(G).applyQuaternion(e).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),-1!==a.name.search("X")&&(F.copy(V).applyQuaternion(e).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.x*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Y")&&(F.copy(G).applyQuaternion(e).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.y*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Z")&&(F.copy(H).applyQuaternion(e).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.z*=-1:"bwd"===a.tag&&(a.visible=!1))}else"rotate"===this.mode&&(k.copy(e),F.copy(this.eye).applyQuaternion(U.copy(e).inverse()),-1!==a.name.search("E")&&a.quaternion.setFromRotationMatrix(z.lookAt(this.eye,B,G)),"X"===a.name&&(U.setFromAxisAngle(V,Math.atan2(-F.y,F.z)),U.multiplyQuaternions(k,U),a.quaternion.copy(U)),"Y"===a.name&&(U.setFromAxisAngle(G,Math.atan2(F.x,F.z)),U.multiplyQuaternions(k,U),a.quaternion.copy(U)),"Z"===a.name&&(U.setFromAxisAngle(H,Math.atan2(F.y,F.x)),U.multiplyQuaternions(k,U),a.quaternion.copy(U)));a.visible=a.visible&&(-1===a.name.indexOf("X")||this.showX),a.visible=a.visible&&(-1===a.name.indexOf("Y")||this.showY),a.visible=a.visible&&(-1===a.name.indexOf("Z")||this.showZ),a.visible=a.visible&&(-1===a.name.indexOf("E")||this.showX&&this.showY&&this.showZ),a.material._opacity=a.material._opacity||a.material.opacity,a.material._color=a.material._color||a.material.color.clone(),a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled?this.axis&&(a.name===this.axis?(a.material.opacity=1,a.material.color.lerp(new i.Color(1,1,1),.5)):this.axis.split("").some((function(t){return a.name===t}))?(a.material.opacity=1,a.material.color.lerp(new i.Color(1,1,1),.5)):(a.material.opacity*=.25,a.material.color.lerp(new i.Color(1,1,1),.5))):(a.material.opacity*=.5,a.material.color.lerp(new i.Color(1,1,1),.5))}else a.visible=!1,"AXIS"===a.name?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(N.set(0,0,0)),a.quaternion.copy(e).multiply(U),Math.abs(F.copy(V).applyQuaternion(e).dot(this.eye))>.9&&(a.visible=!1)),"Y"===this.axis&&(U.setFromEuler(N.set(0,0,Math.PI/2)),a.quaternion.copy(e).multiply(U),Math.abs(F.copy(G).applyQuaternion(e).dot(this.eye))>.9&&(a.visible=!1)),"Z"===this.axis&&(U.setFromEuler(N.set(0,Math.PI/2,0)),a.quaternion.copy(e).multiply(U),Math.abs(F.copy(H).applyQuaternion(e).dot(this.eye))>.9&&(a.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(N.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(z.lookAt(B,F,G)),a.quaternion.multiply(U),a.visible=this.dragging),"E"===this.axis&&(a.visible=!1)):"START"===a.name?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):"END"===a.name?(a.position.copy(this.worldPosition),a.visible=this.dragging):"DELTA"===a.name?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),a.scale.copy(O),a.visible=this.dragging):(a.quaternion.copy(e),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=-1!==this.axis.search(a.name)))}i.Object3D.prototype.updateMatrixWorld.call(this)}};o.prototype=Object.assign(Object.create(i.Object3D.prototype),{constructor:o,isTransformControlsGizmo:!0});var a=function(){i.Mesh.call(this,new i.PlaneBufferGeometry(1e5,1e5,2,2),new i.MeshBasicMaterial({visible:!1,wireframe:!0,side:i.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var t=new i.Vector3(1,0,0),e=new i.Vector3(0,1,0),n=new i.Vector3(0,0,1),r=new i.Vector3,o=new i.Vector3,a=new i.Vector3,s=new i.Matrix4,l=new i.Quaternion;this.updateMatrixWorld=function(){var c=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(c="local"),t.set(1,0,0).applyQuaternion("local"===c?this.worldQuaternion:l),e.set(0,1,0).applyQuaternion("local"===c?this.worldQuaternion:l),n.set(0,0,1).applyQuaternion("local"===c?this.worldQuaternion:l),a.copy(e),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(t),o.copy(t).cross(a);break;case"Y":a.copy(this.eye).cross(e),o.copy(e).cross(a);break;case"Z":a.copy(this.eye).cross(n),o.copy(n).cross(a);break;case"XY":o.copy(n);break;case"YZ":o.copy(t);break;case"XZ":a.copy(n),o.copy(e);break;case"XYZ":case"E":o.set(0,0,0)}break;case"rotate":default:o.set(0,0,0)}0===o.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(r.set(0,0,0),o,a),this.quaternion.setFromRotationMatrix(s)),i.Object3D.prototype.updateMatrixWorld.call(this)}};a.prototype=Object.assign(Object.create(i.Mesh.prototype),{constructor:a,isTransformControlsPlane:!0})},function(t,e,n){"use strict";n.r(e),function(t){var i=n(87),r=n(80),o=n(62),a=n(172),s=n(98),l=n(5).Component,c=n(5).registerComponent;function u(t){var e=l.call(this,t);return this.name="glow",this.type="Glow",this.params={exposure:1,bloomStrength:5,bloomThreshold:0,bloomRadius:0},this.highlightOnHover=!1,this.scene=null,this.camera=null,this.composer=null,this.combineComposer=null,this.glowPass=null,this.fxaaPass=null,this.renderPass=null,this.combinePass=null,e}u.ENTIRE_LAYER=0,u.BLOOM_LAYER=1,u.prototype=Object.create(l.prototype),u.prototype.init=function(){if(!this.entity.isScene)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var e=this.scene=this.entity,n=this.camera=e.camera,l=e.root.renderer;return n?(this.composer=n.composer,this.glowPass||(this.glowPass=new a.a(new t.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85),this.glowPass.threshold=this.params.bloomThreshold,this.glowPass.strength=this.params.bloomStrength,this.glowPass.radius=this.params.bloomRadius,this.composer.addPass(this.glowPass),this.composer.renderToScreen=!1,this.composer.layer=u.BLOOM_LAYER,this.composer.ignoreSceneBackground=!0,this.renderPass=new r.a(e,n),this.combineComposer=new i.a(l),this.combinePass=new o.a(new t.ShaderMaterial({uniforms:{baseTexture:{value:null},bloomTexture:{value:this.composer.renderTarget2.texture}},vertexShader:"varying vec2 vUv;\n                    void main() {\n                        vUv = uv;\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                    }",fragmentShader:"uniform sampler2D baseTexture;\n                    uniform sampler2D bloomTexture;\n                    varying vec2 vUv;\n                    void main() {\n                        gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n                    }",defines:{}}),"baseTexture"),this.combinePass.needsSwap=!0,this.combineComposer.addPass(this.renderPass),this.combineComposer.addPass(this.combinePass),n.composers.push(this.combineComposer),this.fxaaPass=new s.a,this.fxaaPass.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),this.updateComposer(this.combineComposer,this.fxaaPass)),this):this},u.prototype.resize=function(t,e){t*e!=0&&(this.glowPass&&this.glowPass.setSize(t,e),this.fxaaPass&&this.fxaaPass.setSize(t,e),this.renderPass&&this.renderPass.setSize(t,e),this.combinePass&&this.combinePass.setSize(t,e))},u.prototype.updateComposer=function(t,e){e.renderToScreen=!0;for(var n=0;n<t.passes.length;n++)t.passes[n].renderToScreen=!1;t.addPass(e)},u.prototype.update=function(t){this.glowPass&&(this.glowPass.threshold=this.params.bloomThreshold,this.glowPass.strength=this.params.bloomStrength,this.glowPass.radius=this.params.bloomRadius)},u.prototype.dispose=function(){if(this.composer){var t=this.composer.passes;(e=t.indexOf(this.glowPass))>-1&&t.splice(e,1),(e=t.indexOf(this.fxaaPass))>-1&&t.splice(e,1)}if(this.camera){var e,n=this.camera.composers;(e=n.indexOf(this.combineComposer))>-1&&n.splice(e,1)}this.glowPass=null,this.combineComposer=null},u.prototype.toJSON=function(){var t=l.prototype.toJSON.call(this);return t.properties={params:{exposure:this.params.exposure,bloomThreshold:this.params.bloomThreshold,bloomStrength:this.params.bloomStrength,bloomRadius:this.params.bloomRadius}},t},u.prototype.fromJSON=function(t,e){var n=l.prototype.fromJSON.call(t,e);return this.params=n.properties.params,n},e.default=c("glow",u)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(0);var i=n(20),r=n(92),o=n(168),a=n(85),s=(n(557),n(461)),l=n(3),c=n(12).Entity,u=n(12).registerEntity;function h(t,e,n,i,r,o,a,s){var l=c.call(this,t);return this.className="Line2Entity",this.name="FatLine",this.type="FatLine",this.lineWidth=10|i,this.vertices=e||[-1,0,0,0,0,0,1,0,0],this.colors=n||[],this.counters=[],this.dashed=r||!1,this.gradient=o||!1,this.attenuation=a||!1,this.strokes=s||!1,this.local=!1,t||l.createComponents(),l}r.a.prototype.raycast=function(e,n){null===this.geometry.boundingBox&&this.geometry.computeBoundingBox();var i=new t.Box3;i.copy(this.geometry.boundingBox),i.applyMatrix4(this.matrixWorld);var r=e.ray.intersectBox(i,new t.Vector3);if(null!==r){var o=r.distanceTo(e.ray.origin);n.push({distance:o,object:this,point:r})}},h.prototype=Object.create(c.prototype),h.prototype.createComponents=function(){var e,n=new t.LoadingManager((function(){e.visible=!0})),c=new t.TextureLoader(n).load(l.a.getImg("Stroke"));if(this.material2=new o.a({color:16777215,linewidth:this.lineWidth,vertexColors:!0,dashed:!1|this.dashed,dashSize:1,dashScale:10,attenuation:!1|this.attenuation,map:c,useMap:!1|this.strokes}),this.dashed?this.material2.defines.USE_DASH="":delete this.material2.defines.USE_DASH,this.material2.resolution.set(window.innerWidth,window.innerHeight),this.colors.length<=0)this.vertices.forEach(t=>{this.colors.push(t%1)});else if(3===this.colors.length)for(var u=0;u<this.vertices.length;u++){if(u<=2)continue;let t=1;this.gradient&&(t*=1+Object(s.a)(u/this.vertices.length)),this.colors.push(this.colors[0]/t,this.colors[1]/t,this.colors[2]/t),u++}var h=this.vertices.length/3;for(u=0;u<h-1;u++){var f=1-u/h;this.counters.push(f)}var d=new a.a;d.setPositions(this.vertices),d.setColors(this.colors);var p=new t.InstancedBufferAttribute(new Float32Array(this.counters),1);if(d.setAttribute("counter",p),this.local){var m=new t.Vector3;m=d.boundingBox.getCenter();var g=[];for(u=0;u<this.vertices.length;u+=3){let t=this.vertices[u]-m.x,e=this.vertices[u+1]-m.y,n=this.vertices[u+2]-m.z;g.push(t,e,n)}d.setPositions(g),d.verticesNeedUpdate=!0,e.position.copy(m)}(e=new r.a(d,this.material2)).computeLineDistances(),e.scale.set(1,1,1);var v=new i.default(this,e);this.addComponent(v),this.object3D=v.object3D,this.object3D.isStorable=!1},h.prototype.dashed=function(t){this.material2.dashed=t,t?this.material2.defines.USE_DASH="":delete this.material2.defines.USE_DASH,this.material2.needsUpdate=!0},h.prototype.init=function(){return c.prototype.init.call(this),this},h.prototype.update=function(t){},h.prototype.getMesh=function(){return this.object3D},h.prototype.toJSON=function(){var t=c.prototype.toJSON.call(this);return t.properties={vertices:this.vertices,colors:this.colors,dashed:this.dashed,gradient:this.gradient,attenuation:this.attenuation,strokes:this.strokes},t},h.prototype.fromJSON=function(t,e){return c.prototype.fromJSON.call(this,t,e),this.createComponents(),this},e.default=u("Line2Entity",h)}.call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return U}));
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var i={},r=void 0,o=i;function a(t,e){var n,i=t.split("."),a=o;!(i[0]in a)&&a.execScript&&a.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||e===r?a=a[n]?a[n]:a[n]={}:a[n]=e}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function l(t){var e,n,i,r,o,a,l,c,u,h,f=t.length,d=0,p=Number.POSITIVE_INFINITY;for(c=0;c<f;++c)t[c]>d&&(d=t[c]),t[c]<p&&(p=t[c]);for(e=1<<d,n=new(s?Uint32Array:Array)(e),i=1,r=0,o=2;i<=d;){for(c=0;c<f;++c)if(t[c]===i){for(a=0,l=r,u=0;u<i;++u)a=a<<1|1&l,l>>=1;for(h=i<<16|c,u=a;u<e;u+=o)n[u]=h;++r}++i,r<<=1,o<<=1}return[n,d,p]}function c(t,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=s?new Uint8Array(t):t,this.m=!1,this.i=h,this.r=!1,!e&&(e={})||(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case u:this.b=32768,this.c=new(s?Uint8Array:Array)(32768+this.h+258);break;case h:this.b=0,this.c=new(s?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var u=0,h=1,f={t:u,s:h};c.prototype.k=function(){for(;!this.m;){var t=R(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var e=this.input,n=this.a,i=this.c,o=this.b,a=e.length,c=r,f=i.length,d=r;if(this.d=this.f=0,n+1>=a)throw Error("invalid uncompressed block header: LEN");if(c=e[n++]|e[n++]<<8,n+1>=a)throw Error("invalid uncompressed block header: NLEN");if(c===~(e[n++]|e[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+c>e.length)throw Error("input buffer is broken");switch(this.i){case u:for(;o+c>i.length;){if(c-=d=f-o,s)i.set(e.subarray(n,n+d),o),o+=d,n+=d;else for(;d--;)i[o++]=e[n++];this.b=o,i=this.e(),o=this.b}break;case h:for(;o+c>i.length;)i=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(s)i.set(e.subarray(n,n+c),o),o+=c,n+=c;else for(;c--;)i[o++]=e[n++];this.a=n,this.b=o,this.c=i;break;case 1:this.j(q,P);break;case 2:var p,m,v,y,x=R(this,5)+257,b=R(this,5)+1,w=R(this,4)+4,_=new(s?Uint8Array:Array)(g.length),M=r,S=r,T=r,A=r,E=r;for(E=0;E<w;++E)_[g[E]]=R(this,3);if(!s)for(E=w,w=_.length;E<w;++E)_[g[E]]=0;for(p=l(_),M=new(s?Uint8Array:Array)(x+b),E=0,y=x+b;E<y;)switch(S=L(this,p),S){case 16:for(A=3+R(this,2);A--;)M[E++]=T;break;case 17:for(A=3+R(this,3);A--;)M[E++]=0;T=0;break;case 18:for(A=11+R(this,7);A--;)M[E++]=0;T=0;break;default:T=M[E++]=S}m=l(s?M.subarray(0,x):M.slice(0,x)),v=l(s?M.subarray(x):M.slice(x)),this.j(m,v);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var d,p,m=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g=s?new Uint16Array(m):m,v=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],y=s?new Uint16Array(v):v,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],b=s?new Uint8Array(x):x,w=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],_=s?new Uint16Array(w):w,M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=s?new Uint8Array(M):M,T=new(s?Uint8Array:Array)(288);for(d=0,p=T.length;d<p;++d)T[d]=143>=d?8:255>=d?9:279>=d?7:8;var A,E,q=l(T),C=new(s?Uint8Array:Array)(30);for(A=0,E=C.length;A<E;++A)C[A]=5;var P=l(C);function R(t,e){for(var n,i=t.f,r=t.d,o=t.input,a=t.a,s=o.length;r<e;){if(a>=s)throw Error("input buffer is broken");i|=o[a++]<<r,r+=8}return n=i&(1<<e)-1,t.f=i>>>e,t.d=r-e,t.a=a,n}function L(t,e){for(var n,i,r=t.f,o=t.d,a=t.input,s=t.a,l=a.length,c=e[0],u=e[1];o<u&&!(s>=l);)r|=a[s++]<<o,o+=8;if((i=(n=c[r&(1<<u)-1])>>>16)>o)throw Error("invalid code length: "+i);return t.f=r>>i,t.d=o-i,t.a=s,65535&n}function I(t,e){var n,i;switch(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),n=t[this.a++],i=t[this.a++],15&n){case D:this.method=D;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+i)%31)throw Error("invalid fcheck flag:"+((n<<8)+i)%31);if(32&i)throw Error("fdict flag is not supported");this.q=new c(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}c.prototype.j=function(t,e){var n=this.c,i=this.b;this.o=t;for(var r,o,a,s,l=n.length-258;256!==(r=L(this,t));)if(256>r)i>=l&&(this.b=i,n=this.e(),i=this.b),n[i++]=r;else for(s=y[o=r-257],0<b[o]&&(s+=R(this,b[o])),r=L(this,e),a=_[r],0<S[r]&&(a+=R(this,S[r])),i>=l&&(this.b=i,n=this.e(),i=this.b);s--;)n[i]=n[i++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=i},c.prototype.w=function(t,e){var n=this.c,i=this.b;this.o=t;for(var r,o,a,s,l=n.length;256!==(r=L(this,t));)if(256>r)i>=l&&(l=(n=this.e()).length),n[i++]=r;else for(s=y[o=r-257],0<b[o]&&(s+=R(this,b[o])),r=L(this,e),a=_[r],0<S[r]&&(a+=R(this,S[r])),i+s>l&&(l=(n=this.e()).length);s--;)n[i]=n[i++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=i},c.prototype.e=function(){var t,e,n=new(s?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.c;if(s)n.set(r.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=r[t+32768];if(this.g.push(n),this.l+=n.length,s)r.set(r.subarray(i,i+32768));else for(t=0;32768>t;++t)r[t]=r[i+t];return this.b=32768,r},c.prototype.z=function(t){var e,n,i,r=this.input.length/this.a+1|0,o=this.input,a=this.c;return t&&("number"==typeof t.p&&(r=t.p),"number"==typeof t.u&&(r+=t.u)),2>r?n=(i=(o.length-this.a)/this.o[2]/2*258|0)<a.length?a.length+i:a.length<<1:n=a.length*r,s?(e=new Uint8Array(n)).set(a):e=a,this.c=e},c.prototype.n=function(){var t,e,n,i,r,o=0,a=this.c,l=this.g,c=new(s?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return s?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(e=0,n=l.length;e<n;++e)for(i=0,r=(t=l[e]).length;i<r;++i)c[o++]=t[i];for(e=32768,n=this.b;e<n;++e)c[o++]=a[e];return this.g=[],this.buffer=c},c.prototype.v=function(){var t,e=this.b;return s?this.r?(t=new Uint8Array(e)).set(this.c.subarray(0,e)):t=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),t=this.c),this.buffer=t},I.prototype.k=function(){var t,e,n=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var i=t;if("string"==typeof i){var r,o,a=i.split("");for(r=0,o=a.length;r<o;r++)a[r]=(255&a[r].charCodeAt(0))>>>0;i=a}for(var s,l=1,c=0,u=i.length,h=0;0<u;){u-=s=1024<u?1024:u;do{c+=l+=i[h++]}while(--s);l%=65521,c%=65521}if(e!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return t};var D=8;a("Zlib.Inflate",I),a("Zlib.Inflate.prototype.decompress",I.prototype.k);var O,N,F,B,z={ADAPTIVE:f.s,BLOCK:f.t};if(Object.keys)O=Object.keys(z);else for(N in O=[],F=0,z)O[F++]=N;for(F=0,B=O.length;F<B;++F)a("Zlib.Inflate.BufferType."+(N=O[F]),z[N]);var U=i.Zlib.Inflate},,function(t,e,n){"use strict";var i=n(0),r={findSpan:function(t,e,n){var i=n.length-t-1;if(e>=n[i])return i-1;if(e<=n[t])return t;for(var r=t,o=i,a=Math.floor((r+o)/2);e<n[a]||e>=n[a+1];)e<n[a]?o=a:r=a,a=Math.floor((r+o)/2);return a},calcBasisFunctions:function(t,e,n,i){var r=[],o=[],a=[];r[0]=1;for(var s=1;s<=n;++s){o[s]=e-i[t+1-s],a[s]=i[t+s]-e;for(var l=0,c=0;c<s;++c){var u=a[c+1],h=o[s-c],f=r[c]/(u+h);r[c]=l+u*f,l=h*f}r[s]=l}return r},calcBSplinePoint:function(t,e,n,r){for(var o=this.findSpan(t,r,e),a=this.calcBasisFunctions(o,r,t,e),s=new i.Vector4(0,0,0,0),l=0;l<=t;++l){var c=n[o-t+l],u=a[l],h=c.w*u;s.x+=c.x*h,s.y+=c.y*h,s.z+=c.z*h,s.w+=c.w*u}return s},calcBasisFunctionDerivatives:function(t,e,n,i,r){for(var o=[],a=0;a<=n;++a)o[a]=0;var s=[];for(a=0;a<=i;++a)s[a]=o.slice(0);var l=[];for(a=0;a<=n;++a)l[a]=o.slice(0);l[0][0]=1;for(var c=o.slice(0),u=o.slice(0),h=1;h<=n;++h){c[h]=e-r[t+1-h],u[h]=r[t+h]-e;for(var f=0,d=0;d<h;++d){var p=u[d+1],m=c[h-d];l[h][d]=p+m;var g=l[d][h-1]/l[h][d];l[d][h]=f+p*g,f=m*g}l[h][h]=f}for(h=0;h<=n;++h)s[0][h]=l[h][n];for(d=0;d<=n;++d){var v=0,y=1,x=[];for(a=0;a<=n;++a)x[a]=o.slice(0);x[0][0]=1;for(var b=1;b<=i;++b){var w=0,_=d-b,M=n-b;d>=b&&(x[y][0]=x[v][0]/l[M+1][_],w=x[y][0]*l[_][M]);var S=d-1<=M?b-1:n-d;for(h=_>=-1?1:-_;h<=S;++h)x[y][h]=(x[v][h]-x[v][h-1])/l[M+1][_+h],w+=x[y][h]*l[_+h][M];d<=M&&(x[y][b]=-x[v][b-1]/l[M+1][d],w+=x[y][b]*l[d][M]),s[b][d]=w;h=v;v=y,y=h}}for(d=n,b=1;b<=i;++b){for(h=0;h<=n;++h)s[b][h]*=d;d*=n-b}return s},calcBSplineDerivatives:function(t,e,n,r,o){for(var a=o<t?o:t,s=[],l=this.findSpan(t,r,e),c=this.calcBasisFunctionDerivatives(l,r,t,a,e),u=[],h=0;h<n.length;++h){var f=(p=n[h].clone()).w;p.x*=f,p.y*=f,p.z*=f,u[h]=p}for(var d=0;d<=a;++d){for(var p=u[l-t].clone().multiplyScalar(c[d][0]),m=1;m<=t;++m)p.add(u[l-t+m].clone().multiplyScalar(c[d][m]));s[d]=p}for(d=a+1;d<=o+1;++d)s[d]=new i.Vector4(0,0,0);return s},calcKoverI:function(t,e){for(var n=1,i=2;i<=t;++i)n*=i;var r=1;for(i=2;i<=e;++i)r*=i;for(i=2;i<=t-e;++i)r*=i;return n/r},calcRationalCurveDerivatives:function(t){for(var e=t.length,n=[],r=[],o=0;o<e;++o){var a=t[o];n[o]=new i.Vector3(a.x,a.y,a.z),r[o]=a.w}for(var s=[],l=0;l<e;++l){var c=n[l].clone();for(o=1;o<=l;++o)c.sub(s[l-o].clone().multiplyScalar(this.calcKoverI(l,o)*r[o]));s[l]=c.divideScalar(r[0])}return s},calcNURBSDerivatives:function(t,e,n,i,r){var o=this.calcBSplineDerivatives(t,e,n,i,r);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(t,e,n,r,o,a,s,l){for(var c=this.findSpan(t,a,n),u=this.findSpan(e,s,r),h=this.calcBasisFunctions(c,a,t,n),f=this.calcBasisFunctions(u,s,e,r),d=[],p=0;p<=e;++p){d[p]=new i.Vector4(0,0,0,0);for(var m=0;m<=t;++m){var g=o[c-t+m][u-e+p].clone(),v=g.w;g.x*=v,g.y*=v,g.z*=v,d[p].add(g.multiplyScalar(h[m]))}}var y=new i.Vector4(0,0,0,0);for(p=0;p<=e;++p)y.add(d[p].multiplyScalar(f[p]));y.divideScalar(y.w),l.set(y.x,y.y,y.z)}};n.d(e,"a",(function(){return o}));var o=function(t,e,n,r,o){i.Curve.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(var a=0;a<n.length;++a){var s=n[a];this.controlPoints[a]=new i.Vector4(s.x,s.y,s.z,s.w)}};o.prototype=Object.create(i.Curve.prototype),o.prototype.constructor=o,o.prototype.getPoint=function(t,e){var n=e||new i.Vector3,o=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=r.calcBSplinePoint(this.degree,this.knots,this.controlPoints,o);return 1!=a.w&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)},o.prototype.getTangent=function(t,e){var n=e||new i.Vector3,o=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),a=r.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,o,1);return n.copy(a[1]).normalize(),n}},,,,function(t,e,n){n(5);var i=n(44);window.utils=i,window.levent=i.levent;var r=t.exports.systems={};(t.exports.System=function(t){this.name="",this.scene=t,this.components=[]}).prototype={init:function(){},update:function(t){},tick:function(){},tock:function(){},play:function(){},pause:function(){},dispose:function(){}},t.exports.registerSystem=function(t,e){return r[t]=e,e}},function(t,e,n){"use strict";var i=n(174),r=n.n(i);window.Promise=window.Promise||r.a;"function"==typeof fetch&&fetch.bind();class o{constructor(){this.server_url="",this.proxy=""}request(t,e={},n=null,i=null){const r=this.get("contentTypeJson"),o=this.get("headers")||{},a=this.get("params"),s=e.body||{};let l,c;for(let t in a)s[t]=a[t];if(isUndefined(o["X-Requested-With"])&&(o["X-Requested-With"]="XMLHttpRequest"),isUndefined(o["Content-Type"])&&r&&(o["Content-Type"]="application/json; charset=utf-8"),r)c=JSON.stringify(s);else{c=new FormData;for(let t in s)c.append(t,s[t])}l={method:e.method||"post",credentials:this.get("credentials"),headers:o},"post"===l.method&&(l.body=c);const u=this.get("fetchOptions")||{},h=isFunction(u)?u(l):l;this.onStart(),this.fetch(t,{...l,...h||{}}).then(t=>1==(t.status/200|0)?t.text():t.text().then(t=>Promise.reject(t))).then(t=>this.onResponse(t,n)).catch(t=>this.onError(t,i))}getQueryParameters(){for(var t=location.search.substring(1).split("&"),e={},n=0;n<t.length;n++){var i=t[n].split("=");if(i.length>1){var r=unescape(i[0]).replace(new RegExp('"',"g"),""),o=unescape(i[1]).replace(new RegExp('"',"g"),"");e[r]=o}}return e}}e.a=new o;window.Network=o},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(28);function r(t,e){i.a.call(this,"text","TextFile"),this.format="string",this.encoding=void 0!==e?e:"txt",this.data=void 0!==t?t:""}r.prototype=Object.create(i.a.prototype),r.extensions=[".js",".txt",".glsl",".json",".xml",".yaml",".csv",".css",".html"],r.fileIsText=function(t){t=t.name.toLocaleLowerCase();for(var e=0;e<r.extensions.length;e++)if(t.endsWith(r.extensions[e]))return!0;return!1},r.prototype.toJSON=function(t){if(void 0!==t.resources[this.uuid])return t.resources[this.uuid];var e=i.a.prototype.toJSON.call(this,t);return e.encoding=this.encoding,e.data=this.data,e.format=this.format,t.resources[this.uuid]=e,e}},function(t,e,n){"use strict";n.r(e);var i=n(4),r=n(205),o=n(12).Entity,a=n(12).registerEntity;function s(t){var e=o.call(this,t);this.className="PerspectiveCameraEntity",this.name="Perspective Camera",this.type="PerspectiveCamera",this.isCamera=!0,this.camera=null;var n=new r.a(this,t,60,1,.1,1e5);e.addComponent(n),this.camera=n,this.object3D=this.camera.object3D;var a=i.default.program.getActiveScene();return a.cameras.push(this),a.setActiveCamera(this.camera),e}s.prototype=Object.create(o.prototype),s.prototype.init=function(){return o.prototype.init.call(this),this},s.prototype.resize=function(t,e){this.camera.resize(t,e)},s.prototype.getCamera=function(){return this.camera},e.default=a("PerspectiveCameraEntity",s)},function(t,e,n){"use strict";n.r(e);var i=n(449),r=n(12).Entity,o=n(12).registerEntity;function a(t){var e=r.call(this,t);this.className="SkyEntity",this.name="Sky",this.type="Sky";var n=new i.a(this,t);return e.addComponent(n),this.object3D=n.object3D,e}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getSky=function(){return this.object3D},e.default=o("SkyEntity",a)},function(t,e,n){"use strict";n.r(e),function(t){t._Skeleton=t.Skeleton.prototype;var n=function(e,n){if(this.uuid=t.Math.generateUUID(),void 0===e&&(e=[]),this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===n)this.calculateInverses();else if(this.bones.length===n.length)this.boneInverses=n.slice(0);else{console.warn("TDS: Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0;i<this.bones.length;i++)this.boneInverses.push(new Matrix4)}};(n.prototype=t._Skeleton).toJSON=function(e){this.uuid=t.Math.generateUUID();for(var n={},i=[],r=[],o=0;o<this.bones.length;o++)i.push(this.bones[o].uuid);for(o=0;o<this.boneInverses.length;o++)r.push(this.boneInverses[o].toArray());return n.uuid=this.uuid,n.bones=i,n.boneInverses=r,n},e.default=n}.call(this,n(0))},function(t,e,n){t.exports=n.p+"assets/probe.png"},function(t,e,n){t.exports=n.p+"assets/script.png"},function(t,e,n){t.exports=n.p+"assets/image.png"},function(t,e,n){t.exports=n.p+"assets/cube.png"},function(t,e,n){"use strict";function i(){}n.d(e,"a",(function(){return i})),i.fromBinaryString=function(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),r=0;r<e;r++)i[r]=t.charCodeAt(r);return n},i.fromBase64=function(t){for(var e,n,i,r,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=t.length/4*3,s=new ArrayBuffer(a),l=new Uint8Array(s),c=0,u=0;c<a;c+=3)e=o.indexOf(t.charAt(u++)),n=o.indexOf(t.charAt(u++)),i=o.indexOf(t.charAt(u++)),r=o.indexOf(t.charAt(u++)),l[c]=e<<2|n>>4,64!==i&&(l[c+1]=(15&n)<<4|i>>2),64!==r&&(l[c+2]=(3&i)<<6|r);return s},i.fromBuffer=function(t){return t}},function(t,e,n){"use strict";(function(t){function i(e){t.Object3D.call(this),this.name="audio",this.type="Audio",this.listener=new t.AudioListener,this.context=this.listener.context,this.matrixAutoUpdate=!1,this.gain=this.context.createGain(),this.gain.connect(this.listener.getInput()),this.buffer=null,this.filters=[],this.sourceType="empty",this.audio=void 0!==e?e:null,this.autoplay=!1,this.volume=1,this.playbackRate=1,this.startTime=0,this.loop=!0,this.detune=0,this.isPlaying=!1,this.hasPlaybackControl=!0,this.filters=[]}n.d(e,"a",(function(){return i})),i.prototype=Object.create(t.Object3D.prototype),i.SOURCE={EMPTY:"empty",BUFFER:"buffer",NODE:"audioNode"},i.prototype.onEnded=function(){this.isPlaying=!1},i.prototype.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},i.prototype.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},i.prototype.init=function(){if(null!==this.audio){var e=this;this.audio.getAudioBuffer(this.context,(function(t){e.setBuffer(t)}))}else console.warn("TDS: AudioEmitter audio is null.");this.setVolume(this.volume),this.setPlaybackRate(this.playbackRate),t.Object3D.prototype.initialize.call(this)},i.prototype.setBuffer=function(t){return this.buffer=t,this.sourceType="buffer",!0===this.autoplay&&this.play(),this},i.prototype.play=function(){if(null!==this.buffer){if(this.isPlaying&&console.warn("TDS: Audio is already playing, its only possible to control the last playing instance."),!this.source){var t=this.context.createBufferSource();t.buffer=this.buffer,t.detune.value=this.detune,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.source=t}return this.isPlaying=!0,this.connect()}console.warn("TDS: Audio buffer not ready, audio will not play.")},i.prototype.pause=function(){return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},i.prototype.stop=function(){return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},i.prototype.setAudio=function(t){this.audio=t,null!==this.buffer&&(this.isPlaying&&this.stop(),this.disconnect());var e=this;this.audio.getAudioBuffer(this.context,(function(t){e.setBuffer(t)}))},i.prototype.getVolume=function(){return this.gain.gain.value},i.prototype.setVolume=function(t){return this.volume=t,this.gain.gain.value=t,this},i.prototype.setLoop=function(t){return this.loop=t,this.isPlaying&&(this.source.loop=this.loop),this},i.prototype.setDetune=function(t){return this.detune=t,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},i.prototype.getLoop=function(){return this.loop},i.prototype.setPlaybackRate=function(t){return this.playbackRate=t,this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},i.prototype.getPlaybackRate=function(){return this.playbackRate},i.prototype.getFilters=function(){return this.filters},i.prototype.setFilters=function(t){return t||(t=[]),this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},i.prototype.getFilter=function(t){return this.getFilters()[void 0!==t?t:0]},i.prototype.setFilter=function(t){return this.setFilters(t?[t]:[])},i.prototype.setNodeSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},i.prototype.getOutput=function(){return this.gain},i.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect(),this.source=null),t.Object3D.prototype.dispose.call(this)},i.prototype.toJSON=function(e){var n=this.audio,i=t.Object3D.prototype.toJSON.call(this,e,(function(t,e){n=n.toJSON(t)}));return i.object.audio=n.uuid,i.object.volume=this.volume,i.object.autoplay=this.autoplay,i.object.startTime=this.startTime,i.object.playbackRate=this.playbackRate,i.object.loop=this.loop,i}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(20),r=n(218),o=n(12).Entity,a=n(12).registerEntity;function s(t,e){var n=o.call(this,t);this.name=e||"Arrow",this.className="ArrowEntity",this.type="Arrow";TDS_RT.program.getActiveScene();return(new r.a).load("assets/models/arrow.fbx",(function(t){t.traverse((function(e){if(e!==t&&e.isMesh){var r=new i.default(n,e);n.addComponent(r),n.object3D=e}}))})),n}s.prototype=Object.create(o.prototype),s.prototype.init=function(){return o.prototype.init.call(this),this},e.default=a("ArrowEntity",s)},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={isWebGLAvailable:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},isWebGL2Available:function(){try{var t=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(t){var e={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',i=document.createElement("div");return i.id="webglmessage",i.style.fontFamily="monospace",i.style.fontSize="13px",i.style.fontWeight="normal",i.style.textAlign="center",i.style.background="#fff",i.style.color="#000",i.style.padding="1.5em",i.style.width="400px",i.style.margin="5em auto 0",n=(n=e[t]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[t]),i.innerHTML=n,i}}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(0);i.UniformsLib.line={linewidth:{value:1},resolution:{value:new i.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},attenuation:{value:1},useMap:{value:1},map:{type:"t",value:null}},i.ShaderLib.line={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform bool attenuation;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tattribute float counter;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\t\t\tif(attenuation)\n\t\t\t\toffset *= counter;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform sampler2D map;\n\t\tuniform bool useMap;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t\tif( useMap ) diffuseColor *= texture2D( map, vUv );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var r=function(e){i.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:i.UniformsUtils.clone(i.ShaderLib.line.uniforms),vertexShader:i.ShaderLib.line.vertexShader,fragmentShader:i.ShaderLib.line.fragmentShader,clipping:!0,transparent:!0,side:t.DoubleSide}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},attenuation:{enumerable:!0,get:function(){return this.uniforms.attenuation.value},set:function(t){this.uniforms.attenuation.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}}}),this.setValues(e)};r.prototype=Object.create(i.ShaderMaterial.prototype),r.prototype.constructor=r,r.prototype.isLineMaterial=!0}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(4),r=(n(26),n(12).Entity);function o(){this.positions=[],this.splineHelperObjects=[],this.splinePointsLength=0,this.controlTargets=[],this.transformControl=null,this.dragControl=null,this.hoveronCallback,this.curve={},this.entity=null}o.ARC_SEGMENTS=200,o.prototype.addSplineObject=function(e){var n=new t.SphereGeometry(.1),o=new t.MeshLambertMaterial({color:16777215*Math.random()}),a=new t.Mesh(n,o);if(e)a.position.copy(e);else{var s=this.positions[this.positions.length-1];a.position.x=s.x+.5,a.position.y=s.y+.5,a.position.z=s.z+.5}a.castShadow=!0,a.receiveShadow=!0,this.controlTargets.push(a);i.default.program.getActiveScene();var l=new r(a,"Target");return this.entity&&"undefined"!=typeof Editor&&Editor.addObject(l,this.entity,!1),this.splineHelperObjects.push(a),a},o.prototype.load=function(t){this.positions=[];for(var e=0;e<t.length;e++)this.addPoint(t[e])},o.prototype.addPoint=function(t){this.splinePointsLength++,this.positions.push(this.addSplineObject(t).position)},o.prototype.removePoint=function(){this.splinePointsLength<=4||(this.splinePointsLength--,this.positions.pop(),this.splineHelperObjects.pop())},o.prototype.updateOutline=function(){for(var e=new t.Vector3,n=this.curve.mesh.geometry.attributes.position,i=0;i<o.ARC_SEGMENTS;i++){var r=i/(o.ARC_SEGMENTS-1);this.curve.getPoint(r,e),n.setXYZ(i,e.x,e.y,e.z)}n.needsUpdate=!0},o.prototype.initControlTargets=function(){var t=this;this.controlTargets.forEach(e=>{i.default.program.getActiveScene();var n=new r(e,"Target");t.entity&&"undefined"!=typeof Editor&&t.entity.add(n)})},o.prototype.toggleControlTargets=function(t){this.controlTargets.forEach(e=>{e.visible=!0|t})},o.prototype.clear=function(){this.controlTargets.forEach(t=>{this.transformControl.detach(t)}),this.transformControl.receiveRayCast=!1,this.transformControl.enabled=!1,this.dragControl.removeEventListener("hoveron",this.hoveronCallback),this.dragControl.receiveRayCast=!1,this.dragControl.dispose(),this.controlTargets=[]}}).call(this,n(0))},,,function(t,e,n){"use strict";var i=n(0),r={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new i.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},o=n(47),a=n(30);n.d(e,"a",(function(){return s}));var s=function(t,e,n,s){a.a.call(this),this.strength=void 0!==e?e:1,this.radius=n,this.threshold=s,this.resolution=void 0!==t?new i.Vector2(t.x,t.y):new i.Vector2(256,256),this.clearColor=new i.Color(0,0,0);var l={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var c=Math.round(this.resolution.x/2),u=Math.round(this.resolution.y/2);this.renderTargetBright=new i.WebGLRenderTarget(c,u,l),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var h=0;h<this.nMips;h++){var f=new i.WebGLRenderTarget(c,u,l);f.texture.name="UnrealBloomPass.h"+h,f.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(f);var d=new i.WebGLRenderTarget(c,u,l);d.texture.name="UnrealBloomPass.v"+h,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),c=Math.round(c/2),u=Math.round(u/2)}void 0===r&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var p=r;this.highPassUniforms=i.UniformsUtils.clone(p.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new i.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var m=[3,5,7,9,11];for(c=Math.round(this.resolution.x/2),u=Math.round(this.resolution.y/2),h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(m[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new i.Vector2(c,u),c=Math.round(c/2),u=Math.round(u/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new i.Vector3(1,1,1),new i.Vector3(1,1,1),new i.Vector3(1,1,1),new i.Vector3(1,1,1),new i.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===o.a&&console.error("UnrealBloomPass relies on CopyShader");var g=o.a;this.copyUniforms=i.UniformsUtils.clone(g.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new i.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new i.Color,this.oldClearAlpha=1,this.basic=new i.MeshBasicMaterial,this.fsQuad=new a.a.FullScreenQuad(null)};s.prototype=Object.assign(Object.create(a.a.prototype),{constructor:s,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var n=Math.round(t/2),r=Math.round(e/2);this.renderTargetBright.setSize(n,r);for(var o=0;o<this.nMips;o++)this.renderTargetsHorizontal[o].setSize(n,r),this.renderTargetsVertical[o].setSize(n,r),this.separableBlurMaterials[o].uniforms.texSize.value=new i.Vector2(n,r),n=Math.round(n/2),r=Math.round(r/2)},render:function(t,e,n,i,r,o,a){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var l=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),r&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);for(var c=this.renderTargetBright,u=0;u<this.nMips;u++)this.fsQuad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[u].uniforms.direction.value=s.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[u]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=s.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[u]),t.clear(),this.fsQuad.render(t),c=this.renderTargetsVertical[u];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=l},getSeperableBlurMaterial:function(t){return new i.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new i.Vector2(.5,.5)},direction:{value:new i.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new i.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),s.BlurDirectionX=new i.Vector2(1,0),s.BlurDirectionY=new i.Vector2(0,1)},function(t,e,n){t.exports=n.p+"assets/vr.png"},function(t,e,n){(function(e){!function(n){var i=setTimeout,r="function"==typeof e&&e||function(t){i(t,1)};function o(t,e){return function(){t.apply(e,arguments)}}var a=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function s(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],d(t,o(c,this),o(u,this))}function l(t){var e=this;null!==this._state?r((function(){var n=e._state?t.onFulfilled:t.onRejected;if(null!==n){var i;try{i=n(e._value)}catch(e){return void t.reject(e)}t.resolve(i)}else(e._state?t.resolve:t.reject)(e._value)})):this._deferreds.push(t)}function c(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void d(o(e,t),o(c,this),o(u,this))}this._state=!0,this._value=t,h.call(this)}catch(t){u.call(this,t)}}function u(t){this._state=!1,this._value=t,h.call(this)}function h(){for(var t=0,e=this._deferreds.length;t<e;t++)l.call(this,this._deferreds[t]);this._deferreds=null}function f(t,e,n,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=i}function d(t,e,n){var i=!1;try{t((function(t){i||(i=!0,e(t))}),(function(t){i||(i=!0,n(t))}))}catch(t){if(i)return;i=!0,n(t)}}s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var n=this;return new s((function(i,r){l.call(n,new f(t,e,i,r))}))},s.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&a(arguments[0])?arguments[0]:arguments);return new s((function(e,n){if(0===t.length)return e([]);var i=t.length;function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(t){r(o,t)}),n)}t[o]=a,0==--i&&e(t)}catch(t){n(t)}}for(var o=0;o<t.length;o++)r(o,t[o])}))},s.resolve=function(t){return t&&"object"==typeof t&&t.constructor===s?t:new s((function(e){e(t)}))},s.reject=function(t){return new s((function(e,n){n(t)}))},s.race=function(t){return new s((function(e,n){for(var i=0,r=t.length;i<r;i++)t[i].then(e,n)}))},s._setImmediateFn=function(t){r=t},t.exports?t.exports=s:n.Promise||(n.Promise=s)}(this)}).call(this,n(525).setImmediate)},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}));var i=n(43),r=function(t,e){i.a.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};r.prototype=Object.assign(Object.create(i.a.prototype),{constructor:r,render:function(t,e,n){var i,r,o=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(i=0,r=1):(i=1,r=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,i,4294967295),a.buffers.stencil.setClear(r),a.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var o=function(){i.a.call(this),this.needsSwap=!1};o.prototype=Object.create(i.a.prototype),Object.assign(o.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}})},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));var i={uniforms:{u_time:{type:"f",value:1},u_resolution:{type:"v2",value:new t.Vector2},u_noise:{type:"t",value:null},u_mouse:{type:"v2",value:new t.Vector2}},vertexShader:"\n    varying vec2 vUv;    \n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 );\n    }\n    ",fragmentShader:"    \n    uniform vec2 u_resolution;\n    uniform vec2 u_mouse;\n    uniform float u_time;\n    uniform sampler2D u_noise;\n\n    varying vec2 vUv;    \n    \n    #define PI 3.141592653589793\n    #define TAU 6.283185307179586\n    \n    const int octaves = 2;\n    const float seed = 43758.5453123;\n    const float seed2 = 73156.8473192;\n        \n    // float r1 = 0.1 + ((u_mouse.y + 0.5) * .1);\n    // float r2 = 0.4 + (u_mouse.x * .2);\n    float r1 = 0.2;\n    float r2 = 0.9;\n    \n    // These awesome complex Math functions curtesy of \n    // https://github.com/mkovacs/reim/blob/master/reim.glsl\n    vec2 cCis(float r);\n    vec2 cLog(vec2 c); // principal value\n    vec2 cInv(vec2 c);\n    float cArg(vec2 c);\n    float cAbs(vec2 c);\n    \n    vec2 cMul(vec2 a, vec2 b);\n    vec2 cDiv(vec2 a, vec2 b);\n    \n    vec2 cCis(float r)\n    {\n        return vec2( cos(r), sin(r) );\n    }\n    vec2 cExp(vec2 c)\n    {\n        return exp(c.x) * cCis(c.y);\n    }\n    vec2 cConj(vec2 c)\n    {\n        return vec2(c.x, -c.y);\n    }\n    vec2 cInv(vec2 c)\n    {\n        return cConj(c) / dot(c, c);\n    }\n    vec2 cLog(vec2 c)\n    {\n        return vec2( log( cAbs(c) ), cArg(c) );\n    }\n    float cArg(vec2 c)\n    {\n        return atan(c.y, c.x);\n    }\n    float cAbs(vec2 c)\n    {\n        return length(c);\n    }\n    vec2 cMul(vec2 a, vec2 b)\n    {\n        return vec2(a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x);\n    }\n    vec2 cDiv(vec2 a, vec2 b)\n    {\n        return cMul(a, cInv(b));\n    }\n    \n    float hash(float p)\n    {\n        vec2 o = texture2D( u_noise, vec2((p+0.5)/256.0), -100.0 ).xy;\n        return o.x;\n    }\n    vec2 hash(vec2 p)\n    {\n        vec2 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).xy;\n        return o - .5;\n    }\n    vec3 hash3(vec2 p)\n    {\n        vec3 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).xyz;\n        return o;\n    }\n    vec4 hash4(vec2 p)\n    {\n        vec4 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 );\n        return o;\n    }\n    \n    // LUT Noise by Inigo Quilez - iq/2013\n    // https://www.shadertoy.com/view/4sfGzS\n    float noiseLUT( in vec3 x )\n    {\n        vec3 p = floor(x);\n        vec3 f = fract(x);\n        f = f*f*(3.0-2.0*f);\n        vec2 uv = (p.xy+vec2(37.0,17.0)*p.z) + f.xy;\n        vec2 rg = texture2D(u_noise, (uv+0.5)/256.0).yx - .5;\n        return mix( rg.x, rg.y, f.z );\n    }\n    \n    float fbm1(in vec2 _st, float seed) {\n        float v = 0.0;\n        float a = 0.5;\n        vec2 shift = vec2(100.0);\n        // Rotate to reduce axial bias\n        mat2 rot = mat2(cos(0.5), sin(0.5),\n                        -sin(0.5), cos(0.50));\n        for (int i = 0; i < octaves; ++i) {\n            v += a * noiseLUT(vec3(_st, 1.));\n            // v += a * noise(_st, seed);\n            _st = rot * _st * 2.0 + shift;\n            a *= 0.4;\n        }\n        return v;\n    }\n    \n    float pattern(vec2 uv, float seed, float time, inout vec2 q, inout vec2 r) {\n    \n        q = vec2( fbm1( uv + vec2(0.0,0.0), seed ),\n                        fbm1( uv + vec2(5.2,1.3), seed ) );\n    \n        r = vec2( fbm1( uv + 4.0*q + vec2(1.7 - time / 2.,9.2), seed ),\n                        fbm1( uv + 4.0*q + vec2(8.3 - time / 2.,2.8), seed ) );\n    \n        return fbm1( uv + 4.0*r, seed );\n    }\n    \n    vec2 hash2(vec2 p)\n    {\n        vec2 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).xy;\n        return o;\n    }\n    \n    vec3 hsb2rgb( in vec3 c ){\n        vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),\n                                6.0)-3.0)-1.0,\n                        0.0,\n                        1.0 );\n        rgb = rgb*rgb*(3.0-2.0*rgb);\n        return c.z * mix( vec3(1.0), rgb, c.y);\n    }\n    \n    vec3 domain(vec2 z){\n        return vec3(hsb2rgb(vec3(atan(z.y,z.x)/TAU,1.,1.)));\n    }\n    vec3 colour(vec2 z) {\n        return domain(z);\n    }\n    \n    vec2 Droste(vec2 uv) {\n        \n        // 5. Take the tiled strips back to ordinary space.\n        uv = cLog(uv); \n        // 4. Scale and rotate the strips\n        float scale = log(r2/r1);\n        float angle = atan(scale/(2.0*PI));\n        uv = cDiv(uv, cExp(vec2(0,angle))*cos(angle)); \n        // 3. this simulates zooming in the tile\n        uv -= u_time * .2;\n        // 2. Tile the strips\n        uv.x = mod(uv.x,log(r2/r1)); \n        // 1. Take the annulus to a strip\n        uv = cExp(uv)*r1;\n        \n        return uv;\n    }\n    \n    void main() {\n        //vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy) / min(u_resolution.y, u_resolution.x);\n\n        vec2 uv = vUv - vec2(0.5, 0.5);\n        uv *= 2.;        \n        vec2 _uv = uv;\n\n        vec2 polar = vec2(length(_uv), atan(uv.y, uv.x));\n        \n        uv = Droste(uv);\n        \n        float rInv = 1./length(uv);\n        uv = uv * rInv - vec2(rInv, 1.);\n        \n        vec2 p;\n        vec2 q;\n        float pat = pattern(uv * 5., seed, u_time * 5., p, q);\n        \n        vec3 fragcolour = mix(\n        mix(\n            vec3(.9, .7, 0.),\n            vec3(1., .55, 0.1),\n            abs(q.x*p.y)*20.),\n        vec3(.5, .3, 0.),\n        pat\n        );\n        fragcolour -= smoothstep(-.1, .9, p.x) * .5;\n        fragcolour += smoothstep(-.1, .5, p.y) * .5;\n        \n        fragcolour += (1. - length(_uv * 2.)) *.5 ;\n        float lcol = clamp(length((_uv) * 4.) - .2, 0., 1.);\n        \n        float raynoise = fbm1(polar*10.-u_time*2., seed);\n        \n        fragcolour = mix(\n        fragcolour, \n        vec3(sin(p.y * 10.), cos(q.y * 10.), pat * 2.) * .5 + 1.5, \n        clamp(\n            abs(\n            sin(polar.y * 50.)\n            ) * 1. / length(_uv * _uv * 3.) * raynoise - .2, \n            0., \n            1.) * .2);\n        \n        fragcolour = mix(vec3(1.), fragcolour, lcol);\n        \n    \n        gl_FragColor = vec4(fragcolour,1.0);\n    }\n    "}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));var i={uniforms:{u_time:{type:"f",value:1},u_resolution:{type:"v2",value:new t.Vector2},u_tex:{value:null}},vertexShader:"\n    varying vec2 vUv;    \n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 );\n    }\n    ",fragmentShader:"\n    uniform float u_time;\n    uniform sampler2D u_tex;\n    varying vec2 vUv;\n    \n    void main( void ) {\n      float t = u_time;\n      vec2 uv = vUv * 2.0 - 1.0;\n      vec2 puv = vec2(length(uv.xy), atan(uv.x, uv.y));\n      vec4 col = texture2D(u_tex, vec2(log(puv.x + 1.) + t / 5.0, abs(puv.y / 3.1415926) ));\n      float glow = (1.0 - puv.x) * (0.5 + (sin(t) + 2.0 ) / 4.0);\n      // blue glow\n      col += vec4(250.0/255.0, 150.0/255.0, 160.0/255.0, 1.0) * (0.4 + glow * 1.0);\n      // white glow\n      col += vec4(0.2) * smoothstep(0.0, 2.0, glow * glow);\n      gl_FragColor = col;\n    \n    }\n    "}}).call(this,n(0))},,,function(t,e,n){"use strict";n.r(e);var i=n(116),r=(n(3),n(12).Entity),o=n(12).registerEntity;function a(t,e,n,i){var o=r.call(this,t);return this.className="TextImageEntity",this.name=e||"TextImage",this.type="TextImage",this.isText=!0,t||o.createComponents(n,i),o}a.prototype=Object.create(r.prototype),a.prototype.createComponents=function(t,e){var n=new i.a(this,void 0,t,e);this.addComponent(n),this.object3D=n.object3D},a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getMesh=function(){return this.object3D},e.default=o("TextImageEntity",a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e,n){var r=new i.Plane,o=new i.Raycaster,a=new i.Vector2,s=new i.Vector3,l=new i.Vector3,c=new i.Vector3,u=new i.Matrix4,h=[],f=null,d=null,p=this;function m(){n.addEventListener("mousemove",v,!1),n.addEventListener("mousedown",y,!1),n.addEventListener("mouseup",x,!1),n.addEventListener("mouseleave",x,!1),n.addEventListener("touchmove",b,!1),n.addEventListener("touchstart",w,!1),n.addEventListener("touchend",_,!1)}function g(){n.removeEventListener("mousemove",v,!1),n.removeEventListener("mousedown",y,!1),n.removeEventListener("mouseup",x,!1),n.removeEventListener("mouseleave",x,!1),n.removeEventListener("touchmove",b,!1),n.removeEventListener("touchstart",w,!1),n.removeEventListener("touchend",_,!1),n.style.cursor=""}function v(i){i.preventDefault();var m=n.getBoundingClientRect();if(a.x=(i.clientX-m.left)/m.width*2-1,a.y=-(i.clientY-m.top)/m.height*2+1,o.setFromCamera(a,e),f&&p.enabled)return o.ray.intersectPlane(r,l)&&f.position.copy(l.sub(s).applyMatrix4(u)),void p.dispatchEvent({type:"drag",object:f});if(h.length=0,o.setFromCamera(a,e),o.intersectObjects(t,!0,h),h.length>0){var g=h[0].object;r.setFromNormalAndCoplanarPoint(e.getWorldDirection(r.normal),c.setFromMatrixPosition(g.matrixWorld)),d!==g&&(p.dispatchEvent({type:"hoveron",object:g}),n.style.cursor="pointer",d=g)}else null!==d&&(p.dispatchEvent({type:"hoveroff",object:d}),n.style.cursor="auto",d=null)}function y(i){i.preventDefault(),h.length=0,o.setFromCamera(a,e),o.intersectObjects(t,!0,h),h.length>0&&(f=!0===p.transformGroup?t[0]:h[0].object,o.ray.intersectPlane(r,l)&&(u.getInverse(f.parent.matrixWorld),s.copy(l).sub(c.setFromMatrixPosition(f.matrixWorld))),n.style.cursor="move",p.dispatchEvent({type:"dragstart",object:f}))}function x(t){t.preventDefault(),f&&(p.dispatchEvent({type:"dragend",object:f}),f=null),n.style.cursor=d?"pointer":"auto"}function b(t){t.preventDefault(),t=t.changedTouches[0];var i=n.getBoundingClientRect();if(a.x=(t.clientX-i.left)/i.width*2-1,a.y=-(t.clientY-i.top)/i.height*2+1,o.setFromCamera(a,e),f&&p.enabled)return o.ray.intersectPlane(r,l)&&f.position.copy(l.sub(s).applyMatrix4(u)),void p.dispatchEvent({type:"drag",object:f})}function w(i){i.preventDefault(),i=i.changedTouches[0];var d=n.getBoundingClientRect();a.x=(i.clientX-d.left)/d.width*2-1,a.y=-(i.clientY-d.top)/d.height*2+1,h.length=0,o.setFromCamera(a,e),o.intersectObjects(t,!0,h),h.length>0&&(f=!0===p.transformGroup?t[0]:h[0].object,r.setFromNormalAndCoplanarPoint(e.getWorldDirection(r.normal),c.setFromMatrixPosition(f.matrixWorld)),o.ray.intersectPlane(r,l)&&(u.getInverse(f.parent.matrixWorld),s.copy(l).sub(c.setFromMatrixPosition(f.matrixWorld))),n.style.cursor="move",p.dispatchEvent({type:"dragstart",object:f}))}function _(t){t.preventDefault(),f&&(p.dispatchEvent({type:"dragend",object:f}),f=null),n.style.cursor="auto"}m(),this.enabled=!0,this.transformGroup=!1,this.activate=m,this.deactivate=g,this.dispose=function(){g()},this.getObjects=function(){return t}};r.prototype=Object.create(i.EventDispatcher.prototype),r.prototype.constructor=r},function(t,e,n){"use strict";n.r(e);var i=n(78),r=n(10),o=n(5).Component,a=n(5).registerComponent;function s(t,e){var n=o.call(this,t,e);return this.name="explosion",this.type="Explosion",this.time=0,this.old=null,this.mode=s.HORIZONTAL,this.scale=2,this.duration=3,n}s.HORIZONTAL=0,s.VERTICAL=1,s.ALLSIDES=2,s.RANDOM=3,s.prototype=Object.create(o.prototype),s.prototype.init=function(){return this.old=this.entity.object3D.clone(),this},s.prototype.update=function(t){if(!this.enabled)return;var e=this.entity.object3D;this.time+=t;let n=Math.sin(this.time)/150;e.children.forEach((t,o)=>{if(this.mode===s.HORIZONTAL&&i.a.to(t.position,this.duration,{x:this.old.children[o].position.x*this.scale,yoyo:!0,repeat:-1,repeatDelay:.5,ease:r.b.easeOut}),this.mode===s.VERTICAL&&i.a.to(t.position,this.duration,{y:this.old.children[o].position.y*this.scale,yoyo:!0,repeat:-1,repeatDelay:.5,ease:r.b.easeOut}),this.mode===s.ALLSIDES&&i.a.to(t.position,this.duration,{x:this.old.children[o].position.x*this.scale,y:this.old.children[o].position.y*this.scale,z:this.old.children[o].position.z*this.scale,yoyo:!0,repeat:-1,repeatDelay:.5,ease:r.b.easeOut}),this.mode===s.RANDOM){let i=t.position.clone().sub(e.position).normalize();t.position.add(i.multiplyScalar(n*o/5));let r=(1*Math.sin(this.time-Math.PI/2)/2+.5)*o/e.children.length;t.rotation.set(r*t.position.x,r*t.position.y,r*t.position.z),e.rotation.y=-this.time/2}})},e.default=a("explosion",s)},,function(t,e,n){(function(e){var i=n(235),r=n(185),o={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},a=function(t){var e=i(t);return e.color=function(t){var e=function(t){var e=t.split(":");return e[e.length-1]}(t);return o.colors&&o.colors[e]||null}(t),e};r(a,i);var s=function(){try{return window.localStorage}catch(t){}}();s&&(parseInt(s.logs,10)||"true"===s.logs)?a.enable("*"):a.enable("*:error,*:info,*:warn"),e.browser&&(window.logs=a),t.exports=a}).call(this,n(126))},function(t,e,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,s,l=a(t),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))r.call(n,u)&&(l[u]=n[u]);if(i){s=i(n);for(var h=0;h<s.length;h++)o.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),function(t){var i=n(4),r=n(26),o=n(133),a=n(451),s=n(5).Component,l=n(5).registerComponent;function c(t,e,n,i){var r=s.call(this,t,e);return this.name="annotation",this.type="Annotation2D",this.camera=null,this.canvas=null,this.sprite=null,this.anno=null,this.annoRunning=null,this.title=n||"Put title here",this.text=i||"Say something here...",this.color="#eee",this.borderColor="#fff",this.backgroundColor="#000000cc",this.fontSize=12,this.needsUpdate=!1,this.visible=!0,this.isReplicable=!1,this.draggable=!0,this.draggableControl=new a.a,this.cont=null,r}c.prototype=Object.create(s.prototype),c.prototype.init=function(e){if(!this.entity.hasComponent("Mesh")&&!this.entity.object3D instanceof t.Group)return i.default.alert("Annotation can only be applied to a mesh or a group of meshes."),null;var n=i.default.program.getActiveScene();return this.camera=i.default.program.getActiveCamera(n),this.canvas=i.default.program.getActiveCanvas(n),this.needsUpdate=!0,this},c.prototype.lazyLoad=function(t,e){e||(e=this.canvas),e&&(this.createAnno(e),levent.bind(i.default,"canvas_destroyed",this.destroy,this))},c.prototype.getAnno=function(){return i.default.program.isInRunner()?this.annoRunning:this.anno},c.prototype.setAnno=function(t){i.default.program.mode===r.a.MODE_RUNNING?this.annoRunning=t:this.anno=t},c.prototype.createAnno=function(t){var e=this,n=document.createElement("canvas");n.setAttribute("zIndex","-1"),this.drawIndexer(n);var r=document.createElement("div");r.classList.add("annotation2d");var o=document.createElement("h4");o.innerHTML=this.title,o.onkeydown=t=>{t.stopPropagation()},o.onmousedown=t=>{t.stopPropagation(),o.setAttribute("contenteditable",!0),o.onblur=t=>{o.setAttribute("contenteditable",!1)},$(o).focusin(t=>{t.stopPropagation(),e.toggleDraggable(!1,r)}),$(o).focusout(t=>{this.title=o.innerHTML,e.toggleDraggable(!0,r)})},r.appendChild(o);var a=document.createElement("p");a.innerHTML=this.text,a.setAttribute("contenteditable",!0),a.onkeydown=t=>{t.stopPropagation()},$(a).focusin(t=>{t.stopPropagation(),e.toggleDraggable(!1,r)}),$(a).focusout(t=>{this.text=a.innerHTML,e.toggleDraggable(!0,r)}),r.appendChild(a);var s=t?t.parentElement:null;if(s)return s.appendChild(r),this.setAnno(r),this.draggable&&this.draggableControl.setup(r),levent.bind(i.default,"orbit_controls_updated",(function(t,n){e.controlsUpdated(n)})),levent.bind(i.default,"object_transformed",(function(t,n){e.objectUpdated(n)})),levent.bind(i.default,"scene_deactivated",(function(t,n){e.anno&&(e.visible=!1)})),levent.bind(i.default,"scene_activated",(function(t,n){e.anno&&(e.visible=!0)})),this.updateStyles(),r},c.prototype.resize=function(t,e){this.update()},c.prototype.update=function(t){var e=this.getAnno();if(e){var n=i.default.program.getActiveScene();this.camera=i.default.program.getActiveCamera(n),this.canvas=i.default.program.getActiveCanvas(n),this.camera&&(this.visible=this.entity.visible,this.visible?(e.style.display="block",this.updatePosition(),this.needsUpdate&&(this.updateOpacity(),this.updateStyles(),this.updateInfo(),this.needsUpdate=!1)):e.style.display="none")}},c.prototype.controlsUpdated=function(t){t.controls;this.update()},c.prototype.objectUpdated=function(t){t.controls;this.update()},c.prototype.updateOpacity=function(){var t=this.getAnno(),e=this.camera.position.distanceTo(this.entity.position),n=this.camera.position.distanceTo(this.sprite.position)>e;this.sprite.material.opacity=n?.8:1,t.style.opacity=n?.8:1},c.prototype.updateStyles=function(){var t=this.getAnno();t&&(t.style.color=this.color,t.style.backgroundColor=this.backgroundColor,t.style.fontSize=this.fontSize+"px")},c.prototype.updatePosition=function(){var e=this.getAnno(),n=this.entity.geometry.boundingBox;n||(this.entity.geometry.computeBoundingBox(),n=this.entity.geometry.boundingBox);var r=new t.Vector3;n.getSize(r);var o=new t.Vector3;this.entity.getWorldPosition(o),this.sprite.position.set(o.x+r.x/2,o.y+r.y/2,o.z+r.z/2);var a=new t.Vector3;if(this.sprite.updateMatrixWorld(!0,!1),this.sprite.getWorldPosition(a),a.project(this.camera),a.x=(.5+a.x/2)*(this.canvas.width/i.default.getDPI()),a.y=(.5-a.y/2)*(this.canvas.height/i.default.getDPI()),e){var s=a.y;this.draggableControl&&this.draggableControl.offsetTop&&(s+=this.draggableControl.offsetTop),e.style.top=s+"px";var l=a.x;this.draggableControl&&this.draggableControl.offsetLeft&&(l+=this.draggableControl.offsetLeft),e.style.left=l+"px"}},c.prototype.updateInfo=function(){var t=this.getAnno();t.firstChild.innerHTML=this.title,t.children[1].innerHTML=this.text},c.prototype.drawIndexer=function(e,n,i,r,a,s,l,c){var u=e.getContext("2d"),h=(n=n||32,i=i||32,r=r||30,2*Math.PI);u.fillStyle=a||"rgb(0, 0, 0)",u.beginPath(),u.arc(n,i,r,0,h),u.fill(),u.strokeStyle=s||"rgb(255, 255, 255)",u.lineWidth=3,u.beginPath(),u.arc(n,i,r,0,h),u.stroke(),u.fillStyle=l||"rgb(255, 255, 255)",u.font="32px sans-serif",u.textAlign="center",u.textBaseline="middle";c=c||"?";u.fillText(c,n,i);var f=new o.a(e),d=new t.SpriteMaterial({map:f,alphaTest:.5,transparent:!0,depthTest:!1,depthWrite:!1});this.sprite=new t.Sprite(d),this.sprite.scale.set(60,60,1)},c.prototype.drawArrowLineInCanvas=function(t,e,n,i,r,o,a,s,l){var c=t.getContext("2d"),u=(e=e||32,n=n||32,(i=i||e+100)-e),h=(r=r||n+100)-n,f=Math.atan2(h,u),d=Math.sqrt(u*u+h*h);c.translate(e,n),c.rotate(f),c.beginPath(),c.moveTo(0,0),c.lineTo(d,0),s&&(c.moveTo(a,-o),c.lineTo(0,0),c.lineTo(a,o)),l&&(c.moveTo(d-a,-o),c.lineTo(d,0),c.lineTo(d-a,o)),c.stroke(),c.setTransform(1,0,0,1,0,0)},c.prototype.drawArrowLine=function(t,e,n,i,r,o,a,s,l){},c.prototype.toggleDraggable=function(t){var e=this.getAnno();this.draggableControl.toggle(t,e)},c.prototype.dispose=function(){this.annoRunning&&this.annoRunning.parentElement&&this.annoRunning.parentElement.removeChild(this.annoRunning),this.annoRunning=null},c.prototype.destroy=function(){this.anno&&this.anno.parentElement.removeChild(this.anno),this.annoRunning&&this.annoRunning.parentElement.removeChild(this.annoRunning),this.anno=this.annoRunning=null},c.prototype.toJSON=function(){var t=s.prototype.toJSON.call(this);return t.properties={title:this.title,text:this.text,color:this.color,borderColor:this.borderColor,backgroundColor:this.backgroundColor,fontSize:this.fontSize,draggable:this.draggable,offsetLeft:this.draggableControl.offsetLeft,offsetTop:this.draggableControl.offsetTop},t},c.prototype.fromJSON=function(t,e){return s.prototype.fromJSON.call(this,t,e),t.properties.offsetLeft&&(this.draggableControl.offsetLeft=t.properties.offsetLeft),t.properties.offsetTop&&(this.draggableControl.offsetTop=t.properties.offsetTop),this},e.default=l("annotation",c)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(105),r=n(12).Entity,o=n(12).registerEntity;function a(t,e){var n=r.call(this,t);this.className="OrthographicCameraEntity",this.name="Orthographic Camera",this.type="OrthographicCamera",this.isCamera=!0,this.frustumSize=e||10,this.mode=i.a.RESIZE_HORIZONTAL;var o=window.innerWidth/window.innerHeight,a=new i.a(this,t,this.frustumSize,o,this.mode,.1,1e3);return n.addComponent(a),this.camera=a,this.object3D=this.camera.object3D,n}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getCamera=function(){return this.camera},e.default=o("OrthographicCameraEntity",a)},function(t,e,n){t.exports=n.p+"assets/container.png"},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(69),n(67),n(110),n(16);var i=n(28);function r(){i.a.call(this,"model","Model")}r.prototype=Object.create(i.a.prototype),r.extensions=["gcode","drc","assimp","assimp.json","blend","amf","babylon","prwm","svg","obj","3ds","dae","gltf","glb","3mf","awd","ply","vtk","vtp","wrl","vrml","fbx","pcd","stl","json","x"],r.fileIsModel=function(t){if(void 0!==t){t=t.name.toLocaleLowerCase();for(var e=0;e<r.extensions.length;e++)if(t.endsWith(r.extensions[e]))return!0}return!1}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var i=n(17),r=n(121),o=n(133),a=n(123);function s(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.path="",this.crossOrigin="anonymous",this.images=[],this.videos=[]}s.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},s.prototype.setPath=function(t){return this.path=t,this},s.prototype.setImages=function(t){return this.images=t,this},s.prototype.setVideos=function(t){return this.videos=t,this},s.prototype.load=function(t,e,n,r){try{var o=new i.a(this.path+t);return void 0!==e&&e(o),o}catch(t){return void 0!==r&&r(t),console.warn("TDS: Texture not found",t),new i.a}},s.prototype.loadAsArrayBuffer=function(t,e,n,r){try{return fetch(this.path+t).then((function(t){return t.ok||TDS_RT.alert("TDS: HTTP error, status = "+t.status),t.arrayBuffer()})).then((function(t){var n=new i.a(t);return void 0!==e&&e(n),n})).catch((function(t){console.log(t)}))}catch(t){return void 0!==r&&r(t),console.warn("TDS: Texture not found",t),new i.a}},s.prototype.loadJSON=function(e,n,i,r){var o=this;new t.FileLoader(this.manager).load(e,(function(t){o.parse(JSON.parse(t),n)}),i,r)},s.prototype.parse=function(t,e){var n=null,s=t.category;if("Video"===s)void 0===t.video&&console.warn("TextureLoader: No video specified for",t.uuid),void 0===this.videos[t.video]&&console.warn("TextureLoader: Undefined video",t.video),(n=new r.a(this.videos[t.video])).setLoop(t.loop),n.setAutoPlay(t.autoplay),n.setPlaybackRate(t.playbackRate),n.setVolume(t.volume);else if("Webcam"===s)n=new WebcamTexture,void 0!==t.mode&&(n.mode=t.mode);else if("Compressed"===s)if(t.isCubeTexture){(n=new CompressedTexture).image=[],n.isCubeTexture=!0;for(var l=0;l<t.image.length;l++){for(var c=0;c<t.image[l].mipmaps.length;c++)void 0!==t.image[l].mipmaps[c].data.toArrayBuffer&&(t.image[l].mipmaps[c].data=new Uint8Array(t.image[l].mipmaps[c].data.toArrayBuffer()));n.image.push(t.image[l])}}else{for(c=0;c<t.mipmaps.length;c++)void 0!==t.mipmaps[c].data.toArrayBuffer&&(t.mipmaps[c].data=new Uint8Array(t.mipmaps[c].data.toArrayBuffer()));n=new CompressedTexture(t.mipmaps,t.width,t.height)}else if("Cube"===s){var u=[];for(c=0;c<t.images.length;c++)void 0===this.images[t.images[c]]&&console.warn("TDS: TextureLoader, undefined image",t.images[c]),u.push(this.images[t.images[c]]);(n=new a.a).setImages(u,t.mode),n.setSize(t.size),n.updateImages()}else"Canvas"===s?n=new o.a(t.width,t.height):(void 0===t.image&&console.warn("TDS: TextureLoader, no image specified for",t.uuid),void 0===this.images[t.image]&&console.warn("TDS: TextureLoader, undefined image",t.image),"SpriteSheet"===s?((n=new SpriteSheetTexture(this.images[t.image],t.framesHorizontal,t.framesVertical,t.totalFrames)).loop=t.loop,n.animationSpeed=t.animationSpeed,n.beginFrame=t.beginFrame,n.endFrame=t.endFrame):n=new i.a(this.images[t.image]));return n.needsUpdate=!0,n.uuid=t.uuid,n.name=t.name,n.mapping=t.mapping,n.offset.set(t.offset[0],t.offset[1]),n.repeat.set(t.repeat[0],t.repeat[1]),void 0!==t.center&&n.center.set(t.center[0],t.center[1]),void 0!==t.rotation&&(n.rotation=t.rotation),void 0!==t.format&&(n.format=t.format),n.wrapS=t.wrap[0],n.wrapT=t.wrap[1],n.minFilter=t.minFilter,n.magFilter=t.magFilter,n.anisotropy=t.anisotropy,n.flipY=t.flipY,void 0!==e&&e(n),n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.withCredentials=!1}n.d(e,"a",(function(){return i})),i.prototype.load=function(t,e,n,i){var r=this,o=void 0===this.path?LoaderUtils.extractUrlBase(t):this.path,a=new FileLoader(this.manager);a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){var i=JSON.parse(n),a=i.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("TDS: LegacyGeometryLoader: "+t+" should be loaded with ObjectLoader instead.")}var l=r.parse(i,o);e(l.geometry,l.materials)}),n,i)},i.prototype.setPath=function(t){return this.path=t,this},i.prototype.setResourcePath=function(t){return this.resourcePath=t,this},i.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},i.prototype.parse=function(e,n){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var i=new t.Geometry;return function(e,n){function i(t,e){return t&1<<e}var r,o,a,s,l,c,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,T,A,E,q,C,P,R=e.faces,L=e.vertices,I=e.normals,D=e.colors,O=e.scale,N=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&N++;for(r=0;r<N;r++)n.faceVertexUvs[r]=[]}for(s=0,l=L.length;s<l;)(w=new t.Vector3).x=L[s++]*O,w.y=L[s++]*O,w.z=L[s++]*O,n.vertices.push(w);for(s=0,l=R.length;s<l;)if(p=i(d=R[s++],0),m=i(d,1),g=i(d,3),v=i(d,4),y=i(d,5),x=i(d,6),b=i(d,7),p){if((M=new t.Face3).a=R[s],M.b=R[s+1],M.c=R[s+3],(S=new t.Face3).a=R[s+1],S.b=R[s+2],S.c=R[s+3],s+=4,m&&(f=R[s++],M.materialIndex=f,S.materialIndex=f),a=n.faces.length,g)for(r=0;r<N;r++)for(E=e.uvs[r],n.faceVertexUvs[r][a]=[],n.faceVertexUvs[r][a+1]=[],o=0;o<4;o++)C=E[2*(h=R[s++])],P=E[2*h+1],q=new t.Vector2(C,P),2!==o&&n.faceVertexUvs[r][a].push(q),0!==o&&n.faceVertexUvs[r][a+1].push(q);if(v&&(u=3*R[s++],M.normal.set(I[u++],I[u++],I[u]),S.normal.copy(M.normal)),y)for(r=0;r<4;r++)u=3*R[s++],A=new t.Vector3(I[u++],I[u++],I[u]),2!==r&&M.vertexNormals.push(A),0!==r&&S.vertexNormals.push(A);if(x&&(T=D[c=R[s++]],M.color.setHex(T),S.color.setHex(T)),b)for(r=0;r<4;r++)T=D[c=R[s++]],2!==r&&M.vertexColors.push(new Color(T)),0!==r&&S.vertexColors.push(new Color(T));n.faces.push(M),n.faces.push(S)}else{if((_=new t.Face3).a=R[s++],_.b=R[s++],_.c=R[s++],m&&(f=R[s++],_.materialIndex=f),a=n.faces.length,g)for(r=0;r<N;r++)for(E=e.uvs[r],n.faceVertexUvs[r][a]=[],o=0;o<3;o++)C=E[2*(h=R[s++])],P=E[2*h+1],q=new t.Vector2(C,P),n.faceVertexUvs[r][a].push(q);if(v&&(u=3*R[s++],_.normal.set(I[u++],I[u++],I[u])),y)for(r=0;r<3;r++)u=3*R[s++],A=new t.Vector3(I[u++],I[u++],I[u]),_.vertexNormals.push(A);if(x&&(c=R[s++],_.color.setHex(D[c])),b)for(r=0;r<3;r++)c=R[s++],_.vertexColors.push(new Color(D[c]));n.faces.push(_)}}(e,i),function(t,e){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,r=t.skinWeights.length;i<r;i+=n){var o=t.skinWeights[i],a=n>1?t.skinWeights[i+1]:0,s=n>2?t.skinWeights[i+2]:0,l=n>3?t.skinWeights[i+3]:0;e.skinWeights.push(new Vector4(o,a,s,l))}if(t.skinIndices)for(i=0,r=t.skinIndices.length;i<r;i+=n){var c=t.skinIndices[i],u=n>1?t.skinIndices[i+1]:0,h=n>2?t.skinIndices[i+2]:0,f=n>3?t.skinIndices[i+3]:0;e.skinIndices.push(new Vector4(c,u,h,f))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(e,i),function(e,n){var i=e.scale;if(void 0!==e.morphTargets)for(var r=0,o=e.morphTargets.length;r<o;r++){n.morphTargets[r]={},n.morphTargets[r].name=e.morphTargets[r].name,n.morphTargets[r].vertices=[];for(var a=n.morphTargets[r].vertices,s=e.morphTargets[r].vertices,l=0,c=s.length;l<c;l+=3){var u=new t.Vector3;u.x=s[l]*i,u.y=s[l+1]*i,u.z=s[l+2]*i,a.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){var h=n.faces,f=e.morphColors[0].colors;for(r=0,o=h.length;r<o;r++)h[r].color.fromArray(f,3*r)}}(e,i),function(e,n){var i=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var o=0;o<r.length;o++){var a=t.AnimationClip.parseAnimation(r[o],n.bones);a&&i.push(a)}if(n.morphTargets){var s=t.AnimationClip.CreateClipsFromMorphTargetSequences(n.morphTargets,10);i=i.concat(s)}i.length>0&&(n.animations=i)}(e,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:i}:{geometry:i,materials:Loader.prototype.initMaterials(e.materials,this.resourcePath||n,this.crossOrigin)}}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(450),r=(n(26),n(27),n(56),n(31),n(105),n(5).Component),o=n(5).registerComponent,a=function(e,n){var i=r.call(this,e,n);return this.name="orbit-controls",this.type="OrbitControls",this.controls=n,this.target=new t.Vector3(0,.5,0),this.params={enableDamping:!0,dampingFactor:.03,enablePan:!0,enableRotate:!0,rotateSpeed:1,autoRotate:!0,autoRotateSpeed:.1,enableZoom:!0,zoomSpeed:1,minDistance:0,maxDistance:500,minPolarAngle:0,maxPolarAngle:Math.PI/2},i};a.UP=new t.Vector3(0,1,0),a.ZERO=new t.Vector3(0,0,0),(a.prototype=Object.create(r.prototype)).init=function(t){return"Scene"!==this.entity.type?(TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null):this},a.prototype.resize=function(t,e){var n=this.entity.root.canvas;if(!n)return this;var r=this.entity.defaultCamera,o=this.entity.camera;o&&o.isComponent&&(r=o.object3D),this.controls=new i.a(r,n),Object.assign(this.controls,this.params),this.controls.target.set(this.target.x,this.target.y,this.target.z),this.object3D=this.controls},a.prototype.updateParams=function(){this.params.enablePan=this.controls.enablePan,this.params.enableDamping=this.controls.enableDamping,this.params.enableRotate=this.controls.enableRotate,this.params.enableZoom=this.controls.enableZoom,this.params.minDistance=this.controls.minDistance,this.params.maxDistance=this.controls.maxDistance,this.params.minPolarAngle=this.controls.minPolarAngle,this.params.maxPolarAngle=this.controls.maxPolarAngle,this.params.zoomSpeed=this.controls.zoomSpeed,this.params.rotateSpeed=this.controls.rotateSpeed,this.params.autoRotate=this.controls.autoRotate,this.params.autoRotateSpeed=this.controls.autoRotateSpeed},a.prototype.update=function(t){this.controls&&this.controls.update(t)},a.prototype.updateControls=function(){},a.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return t.properties={params:{}},Object.assign(t.properties.params,this.params),t},a.prototype.fromJSON=function(t,e){return r.prototype.fromJSON.call(this,t,e),Object.assign(this.params,t.params),this},e.default=o("orbit-controls",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(145),r=n(26),o=(n(27),n(56),n(44),n(4)),a=n(5).Component,s=n(5).registerComponent,l=function(e,n){var i=a.call(this,e,n);return this.name="transform-controls",this.type="TransformControls",this.raycaster=new t.Raycaster,this.controls=null,this.scene=null,i};l.UP=new t.Vector3(0,1,0),l.ZERO=new t.Vector3(0,0,0),(l.prototype=Object.create(a.prototype)).init=function(){return!this.entity.object3D instanceof t.Object3D?(o.default.alert(o.default.locale.hintAttachedToScene),null):this},l.prototype.resize=function(t,e){t*e!=0&&this.setupControls()},l.prototype.intersectObjects=function(e,n,i){var r=n.getBoundingClientRect(),o=new t.Vector2(i.clientX-r.left,i.clientY-r.top),a=new t.Vector2(o.x/n.width*2-1,-2*o.y/n.height+1);this.raycaster.setFromCamera(a,e);var s=this.raycaster.intersectObjects(this.scene.children,!0);return s.length>0&&s[0]},l.prototype.setupControls=function(){var e=this;if(o.default.program.mode!==r.a.MODE_EDITING){var n=this.scene=o.default.program.getScene(this.entity);if(n){var a=n.getComponent("OrbitControls"),s=n.root.canvas;s||(s=document.createElement("canvas"));var l=n.camera?n.camera:n.defaultCamera;this.controls=new i.a(l.object3D,s),this.controls.attach(this.entity.object3D),this.controls.addEventListener("change",(function(){e.updateControls()})),this.controls.addEventListener("dragging-changed",(function(t){a&&(a.controls.enabled=!t.value)})),n.add(this.controls);var c=this.controls;s.setAttribute("tabindex",1),s.addEventListener("mousedown",(function(t){var n=e.intersectObjects(l,s,t);if(!n||n.object!=e.entity)return e.controls.visible=!1,e.controls.enabled=!1,void(a&&(a.controls.enabled=!0));n&&n.object==e.entity&&(e.controls.visible=!0,e.controls.enabled=!0,a&&(a.controls.enabled=!1))})),s.addEventListener("keydown",(function(e){switch(e.keyCode){case 81:c.setSpace("local"===c.space?"world":"local");break;case 16:c.setTranslationSnap(100),c.setRotationSnap(t.Math.degToRad(15)),c.setScaleSnap(.25);break;case 87:c.setMode("translate");break;case 69:c.setMode("rotate");break;case 82:c.setMode("scale");break;case 86:const e=Math.random()+.1,n=Math.random()+.1;cameraPersp.fov=160*e,cameraOrtho.bottom=500*-e,cameraOrtho.top=500*e,cameraPersp.zoom=5*n,cameraOrtho.zoom=5*n,onWindowResize();break;case 187:case 107:c.setSize(c.size+.1);break;case 189:case 109:c.setSize(Math.max(c.size-.1,.1));break;case 88:c.showX=!c.showX;break;case 89:c.showY=!c.showY;break;case 90:c.showZ=!c.showZ;break;case 32:c.enabled=!c.enabled}})),s.addEventListener("keyup",(function(t){switch(t.keyCode){case 16:c.setTranslationSnap(null),c.setRotationSnap(null),c.setScaleSnap(null)}}))}}},l.prototype.update=function(t){},l.prototype.updateControls=function(){this.entity.updateControls&&this.entity.updateControls()},l.prototype.dispose=function(){this.controls&&(this.controls.detach(),this.controls.dispose())},e.default=s("transform-controls",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(454),r=n(3),o=n(17),a=n(5).Component,s=n(5).registerComponent;function l(t,e,n,i,r){var o=a.call(this,t,e);return this.name="water",this.type="Water",this.width=n||10,this.depth=i||10,this.defaultParams={color:"#ffffff",scale:4,speed:.3,reflectivity:.7,flowX:1,flowY:1},this.params=r||this.defaultParams,this.water=null,this.parent=null,this.entity.hasComponent("Mesh")||"Water"===this.entity.type?(this.createWater(),o):(TDS_RT.alert("Water can only be applied to mesh."),null)}l.IS_EXPOSED=!0,l.prototype=Object.create(a.prototype),l.prototype.init=function(){return this},l.prototype.createWater=function(){var e=this.params,n=this.entity.geometry?this.entity.geometry.clone():new t.PlaneBufferGeometry(this.width,this.depth),a=null;this.entity.hasComponent("Mesh")&&(a=this.entity.getComponent("Mesh")),this.water=new i.a(n,{color:e.color,scale:e.scale,flowSpeed:e.speed,flowDirection:new t.Vector2(e.flowX,e.flowY),reflectivity:e.reflectivity,textureWidth:1024,textureHeight:1024,flowMap:new o.a(r.a.getImg("WaterMap1")),normalMap0:new o.a(r.a.getImg("Water1")),normalMap1:new o.a(r.a.getImg("Water2"))}),this.object3D&&(this.water.position.copy(this.object3D.position),this.water.scale.copy(this.object3D.scale),this.water.quaternion.copy(this.object3D.quaternion)),a&&(a.object3D.visible=!1,this.water.position.copy(a.object3D.position),this.water.scale.copy(a.object3D.scale),this.water.quaternion.copy(a.object3D.quaternion)),this.entity.parent&&this.entity.parent.object3D.add(this.water),this.entity.object3D=this.object3D=this.water},l.prototype.updateParams=function(){this.refreshWater()},l.prototype.refreshWater=function(){this.destroy(),this.createWater()},l.prototype.destroy=function(){if(this.entity.hasComponent("Mesh")){var t=this.entity.getComponent("Mesh");t.object3D.visible=!0,this.entity.object3D=t}this.entity.parent&&this.entity.parent.object3D.remove(this.water),this.water=null},l.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);if(t.properties={width:this.width,depth:this.depth,params:{color:this.params.color,speed:this.params.speed,scale:this.params.scale,reflectivity:this.params.reflectivity,flowX:this.params.flowX,flowY:this.params.flowY}},this.entity.hasComponent("Mesh")){var e=this.entity.getComponent("Mesh");t.oldObject={uuid:e.uuid}}return t},l.prototype.fromJSON=function(t,e){(a.prototype.fromJSON.call(this,t,e),t.oldObject)&&(this.entity.hasComponent("Mesh")&&(this.entity.getComponent("Mesh").object3D=e.object3D.getObjectByProperty("uuid",t.oldObject.uuid)));return this.refreshWater(),this},e.default=s("water",l)}.call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent,o=function(t,e){var n=i.call(this,t,e);return this.name="animation",this.type="Animation",this.animations=[],this.mixer=null,this.playing=!1,this.createObject3D(e),n};o.IS_EXPOSED=!1,(o.prototype=Object.create(i.prototype)).createObject3D=function(e){e||(e=this.entity.object3D),e.animations&&(this.animations=e.animations,this.mixer=new t.AnimationMixer(e),this.object3D=this.mixer)},o.prototype.init=function(){return void 0!==this.mixer&&this.createActions(this.animations),this},o.prototype.createActions=function(t){for(var e=0;e<t.length;e++){this.mixer.clipAction(t[e]).play()}},o.prototype.setTime=function(t){this.mixer.time=t;for(var e=0;e<this._actions.length;e++)this.mixer._actions[e].time=t;this.update(0,!0)},o.prototype.play=function(){this.playing=!0},o.prototype.stop=function(){this.setTime(0),this.playing=!1},o.prototype.pause=function(){this.playing=!1},o.prototype.dispose=function(){this.stop(),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this.mixer._root)},o.prototype.update=function(t,e){this.mixer&&this.mixer.update(t)},e.a=r("animation",o)}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(462),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n,o,a){var s=r.call(this,t);this.className="PointLightEntity",this.name="Point Light",this.type="PointLight";var l=new i.a(this,t,e,n,o,a);return s.addComponent(l),this.object3D=l.object3D,s}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getLight=function(){return this.object3D},e.default=o("PointLightEntity",a)},function(t,e,n){"use strict";n.r(e),function(t){n(128),n(50),n(145);var i=n(44),r=n(194),o=n(12).Entity,a=n(12).registerEntity;n(128);function s(t,e,n){var i=o.call(this,t);return this.className="Target",this.name=n||"Target",this.type="Target",t||this.createObject3D(e,n),this.robot=e,i.addComponent(new r.default(i)),i}s.prototype=Object.create(o.prototype),s.prototype.createObject3D=function(){const e={x:10,y:10,z:10},n=new t.CylinderGeometry(1,1,2,32),i=new t.Mesh(n,new t.MeshBasicMaterial({transparent:!0,opacity:.7,color:11184810}));i.position.set(e.x,e.y,e.z),i.rotation.x=Math.PI/2,i.position.z+=1,this.object3D=i},s.prototype.init=function(){return o.prototype.init.call(this),this},s.prototype.updateControls=function(){i.levent.trigger(TDS_RT,"ROBOT_CHANGE_TARGET",{position:this.object3D.position,rotation:this.object3D.quaternion})},e.default=a("Target",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n,o){var a=r.call(this);this.className="SphereEntity",this.name=n||"Sphere",this.type="Sphere",this.isPrimitive=!0;var s=new t.MeshStandardMaterial({color:16777215,roughness:.6,metalness:.2});s.name="default";var l=o||.5,c=new i.default(this,e,new t.SphereBufferGeometry(l,30,30),s);return a.addComponent(c),this.object3D=c.object3D,a}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getSphere=function(){return this.object3D},e.default=o("SphereEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(466),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n,o,a,s,l){var c=r.call(this,t);this.className="SpotLightEntity",this.name="Spot Light",this.type="SpotLight";var u=new i.a(this,t,e,n,o,a,s,l);return c.addComponent(u),this.object3D=u.object3D,c}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getLight=function(){return this.object3D},e.default=o("SpotLightEntity",a)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(141),r=n(3),o=n(12).Entity,a=n(12).registerEntity;function s(t,e,n,i,r,a,s){var l=o.call(this,t);return this.className="TextEntity",this.name=e||"Text",this.type="Text",this.font_url="",t||l.createComponents(n,i,r,a,s),l}s.prototype=Object.create(o.prototype),s.prototype.createComponents=function(e,n,a,s,l){if(o.prototype.init.call(this),""!==this.font_url)!function(){(new t.FontLoader).load(this.font_url,(function(t){let r=t;var o=new i.a(this,void 0,e,n,a,s,r);this.addComponent(o),this.object3D=o.object3D}))}();else{l=new t.Font(r.a.getFont("Default"));var c=new i.a(this,void 0,e,n,a,s,l);this.addComponent(c),this.object3D=c.object3D}return this},s.prototype.getMesh=function(){return this.object3D},e.default=a("TextEntity",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(116),r=n(19),o=(n(3),n(44)),a=n(12).registerEntity;function s(e,n,i){var o=r.a.call(this,e);return this.className="TextImageSlider",this.name=n||"TextImageSlider",this.type="Slider",this.size=new t.Vector2,this.words=i||["techbrood","online","studio"],this.textComps=[],this.wordIndex=0,this.isText=!0,this.arrowSize=.3,this.arrowLeft=this.arrowRight=null,this.times=0,this._transitionMap={},this._transitionIntialPositions={},this._isInTransition=!1,this._particleParams={verticesDown:0,verticesUp:0,direction:0,speed:.5},this.needsUpdate=!1,e||o.createComponents(),o}s.prototype=Object.create(r.a.prototype),s.prototype.createComponents=function(){this.words.forEach(t=>{let e=new i.a(this,void 0,t);this.addComponent(e,!0),this.textComps.push(e);let n=e.getSize();n.x>this.size.x&&(this.size=n)})},s.prototype.init=function(){r.a.prototype.init.call(this),this.textComps.forEach(t=>{t===this.textComps[0]?t.visible=!0:t.visible=!1}),this.setupTransitionMap(),this.createNavigator(),this.arrowLeft.position.y=this.arrowRight.position.y=.5,o.levent.bind(TDS_RT,"entity_component_added",(t,e)=>{e.object.entity===this&&(this.addSlide(e.object),this.needsUpdate=!0,this.setupTransitionMap())}),o.levent.bind(TDS_RT,"entity_component_removed",(t,e)=>{e.object.entity===this&&(this.removeSlide(e.object),this.needsUpdate=!0,this.setupTransitionMap())})},s.prototype.change=function(t){"forward"==(t||"forward")?(this.transitionMode===r.a.TRANSITION_NONE&&this.wordIndex++,this.transitionMode===r.a.TRANSITION_FADEOUT&&(this.wordIndex=Math.floor(this.wordIndex+this.times/this.transitionSteps)),this.wordIndex%=this.words.length):(this.transitionMode===r.a.TRANSITION_NONE&&this.wordIndex--,this.transitionMode===r.a.TRANSITION_FADEOUT&&(this.wordIndex=Math.ceil(this.wordIndex-this.times/this.transitionSteps)),this.wordIndex<=0&&(this.wordIndex=this.words.length-1)),this.textComps.forEach(t=>{if(this.transitionMode===r.a.TRANSITION_NONE)if(t===this.textComps[this.wordIndex]){t.visible=!0;let e=t.getSize();this.arrowLeft.position.x=t.position.x-(e.x/2+2*this.arrowSize),this.arrowRight.position.x=t.position.x+(e.x/2+2*this.arrowSize)}else t.visible=!1;if(this.transitionMode===r.a.TRANSITION_FADEOUT)if(t===this.textComps[this.wordIndex]){t.visible=!0,t.material.transparent=!0,t.material.opacity-=1/this.transitionSteps;let e=t.getSize();this.arrowLeft.position.x=t.position.x-(e.x/2+2*this.arrowSize),this.arrowRight.position.x=t.position.x+(e.x/2+2*this.arrowSize)}else t.visible=!1,t.material.opacity=1}),this.times++,this.times>this.transitionSteps&&(this.times=0)},s.prototype.addSlide=function(t){this.words.push(t.text),this.textComps.push(t)},s.prototype.removeSlide=function(t){let e=t.text;var n=this.words.indexOf(e);n>-1&&this.words.splice(n,1),(n=this.textComps.indexOf(t))>-1&&this.textComps.splice(n,1)},s.prototype.update=function(t){if(this.transitionMode===r.a.TRANSITION_PARTICLE){this.textComps.forEach(t=>{t.visible=!1}),this.arrowLeft.visible=this.arrowRight.visible=!1;var e,n={verticesDown:this._particleParams.verticesDown,verticesUp:this._particleParams.verticesUp,direction:this._particleParams.direction,speed:this._particleParams.speed};t=t<2?t:2;var i=0;for(e in this._transitionMap){var o=this._transitionMap[e];if(i==this.wordIndex){o.visible=!0,i++;for(var a=n.speed?n.speed:1,s=n.direction?n.direction:-1,l=o.geometry.attributes.position,c=this._transitionIntialPositions[e],u=l.count,h=0;h<u;h++){var f=l.getX(h),d=l.getY(h),p=l.getZ(h);if(s<0&&(this._isInTransition=!0,d>-.5?l.setXYZ(h,f+1.5*(.5-Math.random())*a*t,d+3*(.25-Math.random())*a*t,p+1.5*(.5-Math.random())*a*t):n.verticesDown+=1),s>0){var m=c.getX(h),g=c.getY(h),v=c.getZ(h),y=Math.abs(f-m),x=Math.abs(d-g),b=Math.abs(p-v);y+x+b>.005*a?l.setXYZ(h,f-(f-m)/y*a*t*(.85-Math.random()),d-(d-g)/x*a*t*(1+Math.random()),p-(p-v)/b*a*t*(.85-Math.random())):n.verticesUp+=1}if(n.verticesDown>=u)return this._particleParams.direction=1,this._particleParams.speed=.5,this._particleParams.verticesDown=n.verticesDown=0,this.wordIndex++,this.wordIndex%=this.words.length,void(this._isInTransition=!1);n.verticesUp>=u&&(this._particleParams.direction=-1,this._particleParams.speed=1,this._particleParams.verticesUp=n.verticesUp=0)}l.needsUpdate=!0}else o.visible=!1,i++}}else for(e in this.arrowLeft.visible=this.arrowRight.visible=!0,this._transitionMap){(o=this._transitionMap[e]).visible=!1}},s.prototype.setupTransitionMap=function(){if(this.transitionMode===r.a.TRANSITION_PARTICLE){this._transitionMap={},this._transitionIntialPositions={};var e=!0;if(this.textComps.forEach(t=>{t.imageData||(e=!1)}),!e)return;this.textComps.forEach(e=>{e.pointsMesh&&this.remove(e.pointsMesh);var n=e.object3D.material.color.getHex(),i=e.imageData,r=new t.PointsMaterial({color:n||16777215,size:.01,vertexColors:!0}),o=new t.Points(e.object3D.geometry.clone(),r);o.position.x+=e.object3D.position.x,o.position.y+=e.object3D.position.y,this._transitionMap[e.uuid]=o;var a=o.geometry.attributes.position,s=o.geometry.attributes.uv,l=a.clone();this._transitionIntialPositions[e.uuid]=l,e.visible=!1,e.pointsMesh=o,this.add(o);var c=new Float32Array(3*a.count);function u(t,e){return(t%e+e)%e}n=new t.Color(16777215);for(var h=0;h<a.count;h++){var f=s.getX(h),d=1-s.getY(h+1),p=Math.min(u(f,1)*i.width|0,i.width-1),m=4*(Math.min(u(d,1)*i.height|0,i.height-1)*i.width+p),g=i.data[m+0]/255,v=i.data[m+1]/255,y=i.data[m+2]/255;0==g&&0==v&&0==y&&(g=.1,v=.1,y=.1),n.setRGB(g,v,y),n.toArray(c,3*h)}o.geometry.setAttribute("color",new t.BufferAttribute(c,3)),e.needsUpdate&&(o.material.needsUpdate=!0,o.geometry.attributes.color.needsUpdate=!0),e.needsUpdate=!1,e.visible=!1,e.pointsMesh.visible=!0}),this.needsUpdate=!1}},s.prototype.resetTransitionMap=function(){this.textComps.forEach(t=>{t.pointsMesh.visible=!1,t.object3D.visible=!0})},s.prototype.fromJSON=function(t,e){r.a.prototype.fromJSON.call(this,t,e),this.object3D.remove(...this.object3D.children);for(var n=0;n<this.components.length;n++){var i=this.components[n];"TextImage"===i.type&&(this.textComps.push(i),this.object3D.add(i.object3D),this.transitionMode===r.a.TRANSITION_PARTICLE&&(i.visible=!1))}return r.a.prototype.resetArrows.call(this),this},e.default=a("TextImageSlider",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(141),r=n(19),o=n(3),a=(n(12).Entity,n(12).registerEntity);function s(e,n,i){var a=r.a.call(this,e);this.className="TextSlider",this.name=n||"TextSlider",this.type="Slider",this.size=new t.Vector2,this.words=i||["techbrood","online","studio"],this.textComps=[],this.wordIndex=0;var s=new t.Font(o.a.getFont("Default"));return e||a.createComponents(s),this.autoArrow=!0,this.arrowSize=.5,this.arrowLeft=this.arrowRight=null,this.times=0,this.clock=new t.Clock,this._transitionMap={},this._transitionIntialPositions={},this._isInTransition=!1,this._particleParams={verticesDown:0,verticesUp:0,direction:0,speed:1,precision:.003},a}s.prototype=Object.create(r.a.prototype),s.prototype.createComponents=function(t){this.textComps=[],this.words.forEach(e=>{let n=new i.a(this,void 0,e,16777215,1,.1,t);this.addComponent(n),this.textComps.push(n);let r=n.getSize();r.x>this.size.x&&(this.size=r)})},s.prototype.init=function(){r.a.prototype.init.call(this),this.textComps.forEach(t=>{t===this.textComps[0]?t.visible=!0:t.visible=!1,this.setupTransitionMap()}),levent.bind(TDS_RT,"entity_component_added",(t,e)=>{"Text"===e.object.type&&(this.addSlide(e.object),this.needsUpdate=!0,this.setupTransitionMap())}),levent.bind(TDS_RT,"entity_component_removed",(t,e)=>{"Text"===e.object.type&&(this.removeSlide(e.object),this.needsUpdate=!0,this.setupTransitionMap())}),this.createNavigator()},s.prototype.addSlide=function(t){this.words.push(t.text),this.textComps.push(t)},s.prototype.removeSlide=function(t){let e=t.text;var n=this.words.indexOf(e);n>-1&&this.words.splice(n,1),(n=this.textComps.indexOf(t))>-1&&this.textComps.splice(n,1)},s.prototype.change=function(t,e){var n=this;function i(t){let e=t.getSize();n.arrowLeft.position.x=t.position.x-(e.x/2*1.1+2*n.arrowSize),n.arrowLeft.position.y=t.position.y+e.y/2+.2,n.arrowRight.position.x=t.position.x+(e.x/2*1.1+2*n.arrowSize),n.arrowRight.position.y=n.arrowLeft.position.y}e=e||!1;"forward"==(t||"forward")?((this.transitionMode===r.a.TRANSITION_NONE||e)&&this.wordIndex++,this.transitionMode===r.a.TRANSITION_FADEOUT&&(this.wordIndex=Math.floor(this.wordIndex+this.times/this.transitionSteps)),this.wordIndex%=this.words.length):((this.transitionMode===r.a.TRANSITION_NONE||e)&&this.wordIndex--,this.transitionMode===r.a.TRANSITION_FADEOUT&&(this.wordIndex=Math.ceil(this.wordIndex-this.times/this.transitionSteps)),this.wordIndex<=0&&(this.wordIndex=this.words.length-1)),this.textComps.forEach(t=>{this.transitionMode===r.a.TRANSITION_NONE&&(t===this.textComps[this.wordIndex]?(t.visible=!0,t.textMesh1.material.forEach(t=>{t.opacity=1}),this.autoArrow&&i(t)):t.visible=!1),this.transitionMode===r.a.TRANSITION_FADEOUT&&(t===this.textComps[this.wordIndex]?(t.visible=!0,t.textMesh1.material.forEach(t=>{t.transparent=!0,t.opacity-=1/this.transitionSteps}),this.autoArrow&&i(t)):(t.visible=!1,t.textMesh1.material.forEach(t=>{t.opacity=1})))}),this.times++,this.times>this.transitionSteps&&(this.times=0)},s.prototype.update=function(t){if(this.transitionMode===r.a.TRANSITION_PARTICLE){var e,n={verticesDown:this._particleParams.verticesDown,verticesUp:this._particleParams.verticesUp,direction:this._particleParams.direction,speed:this._particleParams.speed,precision:this._particleParams.precision};t=t<2?t:2;var i=0;for(e in this._transitionMap){var o=this._transitionMap[e];if(i==this.wordIndex){o.visible=!0,i++;for(var a=n.speed?n.speed:1,s=n.direction?n.direction:-1,l=o.geometry.attributes.position,c=this._transitionIntialPositions[e],u=l.count,h=0;h<u;h++){this._isInTransition=!0;var f=l.getX(h),d=l.getY(h),p=l.getZ(h);if(s<0&&(d>n.precision?l.setXYZ(h,f+1.5*(.5-Math.random())*a*t,d+3*(.25-Math.random())*a*t,p+1.5*(.5-Math.random())*a*t):n.verticesDown+=1),s>0){var m=c.getX(h),g=c.getY(h),v=c.getZ(h),y=Math.abs(f-m),x=Math.abs(d-g),b=Math.abs(p-v);y+x+b>n.precision?l.setXYZ(h,f-(f-m)/y*a*t*(.85-Math.random()),d-(d-g)/x*a*t*(1+Math.random()),p-(p-v)/b*a*t*(.85-Math.random())):n.verticesUp+=1}if(n.verticesDown>=u&&(this._particleParams.direction=1,this._particleParams.speed=.5,this._particleParams.verticesDown=0),n.verticesUp>=u)return this._particleParams.direction=-1,this._particleParams.speed=1,this._particleParams.verticesUp=0,this.wordIndex++,void(this.wordIndex%=this.words.length)}l.needsUpdate=!0}else o.visible=!1,i++}}},s.prototype.setupTransitionMap=function(){this.transitionMode===r.a.TRANSITION_PARTICLE&&(this._transitionMap={},this._transitionIntialPositions={},this.textComps.forEach(e=>{e.pointsMesh&&this.remove(e.pointsMesh);var n=e.textMesh1.material[0].color.getHex(),i=new t.PointsMaterial({color:n||16777215,size:.01}),r=new t.Points(e.textMesh1.geometry.clone(),i);r.position.x+=e.textMesh1.position.x,r.position.y+=e.textMesh1.position.y,this._transitionMap[e.uuid]=r,this.add(r);var o=r.geometry.attributes.position.clone();this._transitionIntialPositions[e.uuid]=o,e.pointsMesh=r,e.visible=!1,e.pointsMesh.visible=!0}))},s.prototype.resetTransitionMap=function(){this.textComps.forEach(t=>{t.visible=!0,t.pointsMesh&&(t.pointsMesh.visible=!1)}),this.setupInterval()},s.prototype.fromJSON=function(t,e){r.a.prototype.fromJSON.call(this,t,e),this.object3D.remove(...this.object3D.children);for(var n=0;n<this.components.length;n++){var i=this.components[n];"Text"===i.type&&(this.textComps.push(i),this.object3D.add(i.object3D),this.transitionMode===r.a.TRANSITION_PARTICLE&&(i.visible=!1))}return r.a.prototype.resetArrows.call(this),this},e.default=a("TextSlider",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(19),r=n(91),o=n(470),a=n(103),s=n(471),l=n(3),c=n(5).Component,u=n(5).registerComponent;function h(t,e,n){var i=c.call(this,t,e);return this.name="image-slide",this.type="ImageSlide",this.singleTon=!1,this.targetData={type:a.a,url:l.a.getImg("Demo1"),options:{respondsToMouse:!0,size:.01}},this.debug=!1,this.target=n,this.needsUpdate=!1,this.target&&(this.target.component=this),i}h.prototype=Object.create(c.prototype),h.prototype.init=function(){return"ParticleSlider"!=this.entity.type?(TDS_RT.alert("ImageSlide can only be attached to image slider"),null):this},h.prototype.createSlide=function(){},h.prototype.refreshSlide=function(){this.slide&&""!==this.slide&&(this.createSlide(),this.needsUpdate=!0)},h.prototype.toJSON=function(){var t=c.prototype.toJSON.call(this);return t.properties={targetData:{url:this.targetData.url}},t.imageUrl=this.imageUrl,t},h.prototype.fromJSON=function(t,e){return c.prototype.fromJSON.call(this,t,e),t.properties.targetData.type=a.a,this.targetData.url=t.properties.targetData.url,this};var f=u("image-slide",h),d=(n(12).Entity,n(12).registerEntity);function p(t,e){var n=i.a.call(this,t);return this.className="ParticleSlider",this.name=name||"ParticleSlider",this.type="ParticleSlider",this.raf,this.pool,this.respondingToMouse=!1,this.sceneReady=!1,this.numTargetsLoaded=0,this.currentTargetIndex,this.targets=[],this.destinationSceneRotationY=0,this.dirty=!0,this.slideshowInterval=null,this.onAssetsLoad=null,this.opts={maxMouseRotation:Math.PI/6,mouseRotationFriction:.2,numFloatingParticles:10,numParticles:65536,particleRevertDelay:.01,revertDuration:800,sizeAttenuation:!0,slideshowDuration:3e3,sort:null},r.a.extend(this.opts,e),this.targetsData=[{type:a.a,url:l.a.getImg("Demo4"),options:{respondsToMouse:!0,size:.01}},{type:a.a,url:l.a.getImg("Demo5"),options:{respondsToMouse:!0,size:.01}},{type:a.a,url:l.a.getImg("Demo6"),options:{respondsToMouse:!0,size:.01}}],t||n.createComponents(),n}p.prototype=Object.create(i.a.prototype),p.prototype.createComponents=function(){this.components=[];0===this.targets.length&&this.load((()=>{this.setTarget(0),this.startSlideshow()})())},p.prototype.init=function(){this.scene=TDS_RT.program.getActiveScene(),this.camera=TDS_RT.program.getActiveCamera(this.scene),this.renderer=TDS_RT.program.getActiveRenderer(this.scene),this.context=TDS_RT.program.getActiveCanvas(this.scene),this.context&&(this.halfW=this.context.offsetWidth/2,this.halfH=this.context.offsetHeight/2,this.mouseX=this.halfW,this.resize(this.context.offsetWidth,this.context.offsetHeight),this.context.addEventListener("mousemove",this.onMouseMove),levent.bind(TDS_RT,"entity_component_added",(t,e)=>{e.object.entity===this&&(this.addSlide(e.object),this.needsUpdate=!0)}),levent.bind(TDS_RT,"entity_component_removed",(t,e)=>{e.object.entity===this&&(this.removeSlide(e.object),this.needsUpdate=!0)}))},p.prototype.update=function(t){var e;this.pool&&(e=this.pool.getRotationY(),this.setSceneMouseRotation(this.mouseX),(e!==this.pool.getRotationY()||this.pool.morphing)&&(this.dirty=!0),this.pool.morphing&&this.pool.morph(),this.dirty&&(this.dirty=!1))},p.prototype.dispose=function(){},p.prototype.stop=function(){this.stopSlideshow()},p.prototype.destroy=function(){var t,e,n,i;for(this.stop(),this.context.removeEventListener("mousemove",this.onMouseMove),clearInterval(this.slideshowInterval),e=0,n=(i=this.targets).length;e<n;e++)(t=i[e])&&t.destroy();this.renderer=null,this.scene=null,this.camera=null,this.pool&&this.pool.destroy(),this.pool=null,this.targets=[]},p.prototype.addSlide=function(t){var e=t.targetData,n=new e.type(e,e.options);n.entity=this,t.target=n,this.targets.push(n),n.init(),n.load(()=>{this.onTargetLoad()})},p.prototype.removeSlide=function(t){var e=t.target,n=this.targets.indexOf(e);n>-1&&this.targets.splice(n,1),e.destroy(),this.numTargetsLoaded--,this.resetSlideshow()},p.prototype.setTarget=function(t,e){var n;if(null==e&&(e=!0),this.currentTargetIndex=t,this.sceneReady&&void 0!==this.currentTargetIndex)return this.targets[this.currentTargetIndex].opts.respondsToMouse?(this.respondingToMouse=!0,this.setSceneMouseRotation(this.mouseX)):(this.respondingToMouse=!1,this.setSceneMouseRotation(this.halfW)),n=this.targets[t].getParticles(),this.pool.setTarget(n,e)},p.prototype.nextTarget=function(t){var e;return null==t&&(t=!0),this.resetSlideshow(),e=this.currentTargetIndex,++e>=this.targets.length&&(e=0),this.setTarget(e,t)},p.prototype.prevTarget=function(t){var e;return null==t&&(t=!0),this.resetSlideshow(),e=this.currentTargetIndex,--e<0&&(e=this.targets.length-1),this.setTarget(e,t)},p.prototype.resetSlideshow=function(){if(null!=this.slideshowInterval)return this.startSlideshow()},p.prototype.startSlideshow=function(){return clearInterval(this.slideshowInterval),this.slideshowInterval=setInterval(()=>{this.nextTarget()},this.opts.slideshowDuration)},p.prototype.stopSlideshow=function(){return clearInterval(this.slideshowInterval),this.slideshowInterval=null},p.prototype.resize=function(t,e){var n,i,r,o;for(this.dirty=!0,this.halfW=t/2,this.halfH=e/2,this.pool&&this.pool.resize(this.halfW,this.halfH,this.camera.position.z),n=i=0,r=(o=this.targets).length;i<r;n=++i)o[n].resize(t,e);return this.setTarget(this.currentTargetIndex,!1)},p.prototype.load=function(t,e){var n,i,r,o,a;for(this.onAssetsLoad=t,a=[],i=0,r=(o=this.targetsData).length;i<r;i++)n=o[i],a.push(this.loadTarget(n,()=>{this.onTargetLoad()},e));return a},p.prototype.onTargetLoad=function(){if(this.numTargetsLoaded++,this.numTargetsLoaded>0&&this.numTargetsLoaded===this.targetsData.length)return this.onTargetsReady()},p.prototype.loadTarget=function(t,e,n){var i;if(null==t.container&&(t.container=this.context),null==t.options&&(t.options={}),t.type!==s.a&&(t.options.numParticles=this.opts.numParticles),t.options.sort=this.opts.sort,(i=new t.type(t,t.options)).entity=this,this.targets.push(i),i.init(),i.load(e),!i.component&&!1!==n){var r=new f(this,i);r.targetData=t,i.component=r,this.addComponent(r)}return this.resetSlideshow()},p.prototype.onTargetsReady=function(){if(this.setupPool(),"function"==typeof this.onAssetsLoad)return this.onAssetsLoad()},p.prototype.setupPool=function(){if(this.pool=new o.a(this.opts),this.pool.resize(this.halfW,this.halfH,this.camera.position.z),this.pool.init(),this.add(this.pool.getParticles()),this.sceneReady=!0,null!=this.currentTargetIndex)return this.setTarget(this.currentTargetIndex)},p.prototype.onMouseMove=function(t){this.mouseX=t.clientX},p.prototype.setSceneMouseRotation=function(t){var e,n,i,r;return this.destinationSceneRotationY=0,r=this.pool.getRotationY(),this.halfW>0&&this.respondingToMouse&&(n=(t-this.halfW)/this.halfW,this.destinationSceneRotationY=this.opts.maxMouseRotation*n),.01>Math.abs(r-this.destinationSceneRotationY)?this.pool.setRotationY(this.destinationSceneRotationY):(e=this.destinationSceneRotationY-r,i=r+this.opts.mouseRotationFriction*e,this.pool.setRotationY(i))},p.prototype.toJSON=function(){var t=i.a.prototype.toJSON.call(this),e={meta:{className:this.className,name:this.name,type:this.type,isEntity:!0},targetsData:[]};Object.assign(t,e);for(var n=0;n<this.targetsData.length;n++){var r={type:this.targetsData[n].type.name,url:this.targetsData[n].url,options:{respondsToMouse:this.targetsData[n].respondsToMouse,size:this.targetsData[n].size}};t.targetsData.push(r)}return t},p.prototype.fromJSON=function(t,e){i.a.prototype.fromJSON.call(this,t,e),this.object3D.remove(...this.object3D.children),this.targetsData=[],this.targets=[];for(var n=0;n<this.components.length;n++){var r=this.components[n];"ImageSlide"===r.type&&(Object.assign(r.targetData,{options:{respondsToMouse:!0,size:.01}}),this.targetsData.push(r.targetData))}return this.createComponents(),i.a.prototype.resetArrows.call(this),this};e.default=d("ParticleSlider",p)},function(t,e,n){"use strict";(function(t){var i=n(52),r=n(87),o=n(80),a=n(5).Component,s=n(5).registerComponent,l=function(t,e,n,s,l,c){var u=a.call(this,t,e);this.viewport=new i.a,this.order=0,this.composer=new r.a,this.composers=[this.composer];var h=new o.a;return h.renderToScreen=!0,this.composer.addPass(h),e||this.createObject3D(n,s,l,c),u};l.IS_EXPOSED=!1,(l.prototype=Object.create(a.prototype)).createObject3D=function(e,n,i,r){this.object3D=new t.PerspectiveCamera(e,n,i,r)},l.prototype.init=function(){this.name="p-camera",this.type="PerspectiveCamera"},l.prototype.update=function(){var e=this.object3D,n=e.near*Math.tan(.5*t.Math.DEG2RAD*e.fov)/e.zoom,i=2*n,r=e.aspect*i,o=-.5*r;0!==e.filmOffset&&(o+=e.near*e.filmOffset/e.getFilmWidth()),e.projectionMatrix.makePerspective(o,o+r,n,n-i,e.near,e.far),e.projectionMatrixInverse.getInverse(e.projectionMatrix)},l.prototype.remove=function(){this.entity.removeObject3D("camera")},l.prototype.resize=function(t,e,n){this.viewport.width=t,this.viewport.height=e,this.viewport.update(n),this.aspect=this.viewport.getAspectRatio(),this.updateProjectionMatrix(),this.composers.forEach(t=>{t.setSize(this.viewport.width,this.viewport.height)})},l.prototype.setupRenderer=function(t){this.viewport.enable(t),t.clear(this.clearColor,this.clearDepth,this.clearStencil)},l.prototype.render=function(t,e){this.composers.forEach(n=>{n.render(t,e.object3D,this.object3D,.016)})},l.prototype.destroy=function(){var e=TDS_RT.program.getScene(this.entity);null!==e&&e.removeCamera(this.entity),t.Object3D.prototype.destroy.call(this)},l.prototype.updateProjectionMatrix=function(){var e=this.object3D,n=e.near*Math.tan(.5*t.Math.DEG2RAD*e.fov)/e.zoom,i=2*n,r=e.aspect*i,o=-.5*r;0!==e.filmOffset&&(o+=e.near*e.filmOffset/e.getFilmWidth()),e.projectionMatrix.makePerspective(o,o+r,n,n-i,e.near,e.far),e.projectionMatrixInverse.getInverse(e.projectionMatrix)},l.prototype.fromJSON=function(t,e){return a.prototype.fromJSON.call(this,t,e),this.order=t.object.order,this.viewport=(new i.a).fromJSON(t.object.viewport,e),this},l.prototype.toJSON=function(t){var e=a.prototype.toJSON.call(this,t);return e.object.viewport=this.viewport.toJSON(),e.object.order=this.order,e},e.a=s("p-camera",l)}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t){this.subdivisions=void 0===t?1:t};r.prototype.modify=function(t){(t=t.isBufferGeometry?(new i.Geometry).fromBufferGeometry(t):t.clone()).mergeVertices();for(var e=this.subdivisions;e-- >0;)this.smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t},function(){var t=["a","b","c"];function e(t,e,n){return n[Math.min(t,e)+"_"+Math.max(t,e)]}function n(t,e,n,i,r,o){var a,s=Math.min(t,e),l=Math.max(t,e),c=s+"_"+l;c in i?a=i[c]:(a={a:n[s],b:n[l],newEdge:null,faces:[]},i[c]=a);a.faces.push(r),o[t].edges.push(a),o[e].edges.push(a)}function o(t,e,n,r,o){t.push(new i.Face3(e,n,r,void 0,void 0,o))}function a(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function s(t,e,n,i){t.push([e.clone(),n.clone(),i.clone()])}r.prototype.smooth=function(r){var l,c,u,h,f,d,p,m,g,v,y,x,b,w=new i.Vector3,_=[];l=r.vertices,c=r.faces;var M,S,T,A,E,q,C,P,R,L,I,D,O,N,F=void 0!==(u=r.faceVertexUvs)[0]&&u[0].length>0;if(F)for(var B=0;B<u.length;B++)_.push([]);for(p in function(t,e,i,r){var o,a,s;for(o=0,a=t.length;o<a;o++)i[o]={edges:[]};for(o=0,a=e.length;o<a;o++)n((s=e[o]).a,s.b,t,r,s,i),n(s.b,s.c,t,r,s,i),n(s.c,s.a,t,r,s,i)}(l,c,v=new Array(l.length),y={}),x=[],y){for(S=y[p],T=new i.Vector3,E=3/8,q=1/8,2!=(C=S.faces.length)&&(E=.5,q=0),T.addVectors(S.a,S.b).multiplyScalar(E),w.set(0,0,0),B=0;B<C;B++){for(A=S.faces[B],g=0;g<3&&((M=l[A[t[g]]])===S.a||M===S.b);g++);w.add(M)}w.multiplyScalar(q),T.add(w),S.newEdge=x.length,x.push(T)}for(b=[],p=0,m=l.length;p<m;p++){for(O=l[p],3==(d=(D=v[p].edges).length)?P=3/16:d>3&&(P=3/(8*d)),R=1-d*P,L=P,d<=2&&2==d&&(R=.75,L=1/8),N=O.clone().multiplyScalar(R),w.set(0,0,0),B=0;B<d;B++)M=(I=D[B]).a!==O?I.a:I.b,w.add(M);w.multiplyScalar(L),N.add(w),b.push(N)}h=b.concat(x);var z,U,k,j,V,G,H,W=b.length;f=[];var X=new i.Vector2,Y=new i.Vector2,Z=new i.Vector2;for(p=0,m=c.length;p<m;p++)if(o(f,z=e((A=c[p]).a,A.b,y).newEdge+W,U=e(A.b,A.c,y).newEdge+W,k=e(A.c,A.a,y).newEdge+W,A.materialIndex),o(f,A.a,z,k,A.materialIndex),o(f,A.b,U,z,A.materialIndex),o(f,A.c,k,U,A.materialIndex),F)for(B=0;B<u.length;B++)V=(j=u[B][p])[0],G=j[1],H=j[2],X.set(a(V.x,G.x),a(V.y,G.y)),Y.set(a(G.x,H.x),a(G.y,H.y)),Z.set(a(V.x,H.x),a(V.y,H.y)),s(_[B],X,Y,Z),s(_[B],V,X,Z),s(_[B],G,Y,X),s(_[B],H,Z,Y);r.vertices=h,r.faces=f,F&&(r.faceVertexUvs=_)}}()},function(t,e,n){"use strict";var i=n(165),r=n(5).Component,o=n(5).registerComponent;function a(t,e,n){var i=r.call(this,t,e);return this.name="audio",this.type="AudioEmitter",e||this.createObject3D(n),i}a.IS_EXPOSED=!1,a.prototype=Object.create(r.prototype),a.prototype.createObject3D=function(t){this.object3D=new i.a(t)},a.prototype.init=function(){return this.object3D.init(),this},a.prototype.dispose=function(){this.object3D&&this.object3D.dispose()},e.a=o("audio",a)},function(t,e,n){t.exports=n.p+"assets/points.png"},function(t,e,n){t.exports=n.p+"assets/line.png"},function(t,e,n){t.exports=n.p+"assets/2d.png"},function(t,e,n){"use strict";function i(){}n.d(e,"a",(function(){return i})),i.webXRAvailable=!1,i.webXRSession=null,i.arAvailable=function(){return i.webXRAvailable},i.enterAR=function(t,e){i.webXRAvailable?i.getWebXRSession().then((function(n){t.xr.enabled=!0,t.xr.setReferenceSpaceType("local"),t.xr.setSession(n),i.webXRSession=n,void 0!==e&&e()})):console.warn("TDS: AR support is not available.")},i.exitAR=function(t){i.webXRAvailable&&null!==i.webXRSession&&(t.xr.enabled=!1,t.xr.setSession(null),i.webXRSession.end(),i.webXRSession=null)},i.getWebXRSession=function(){return i.webXRAvailable?navigator.xr.requestSession("immersive-ar",{}):Promise.reject("WebXR support is not available.")},void 0!==navigator.xr&&void 0!==navigator.xr.isSessionSupported&&navigator.xr.isSessionSupported("immersive-ar").then((function(t){i.webXRAvailable=t}))},function(t,e,n){"use strict";(function(t){var i=n(39),r={vertex:[i.a.defines,i.a.uniforms,i.a.attributes,i.a.varyings,t.ShaderChunk.common,t.ShaderChunk.logdepthbuf_pars_vertex,t.ShaderChunk.fog_pars_vertex,i.a.branchAvoidanceFunctions,i.a.unpackColor,i.a.unpackRotationAxis,i.a.floatOverLifetime,i.a.colorOverLifetime,i.a.paramFetchingFunctions,i.a.forceFetchingFunctions,i.a.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt(alive, 0.0);","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin(wiggleAmount);","        float wiggleCos = isAlive * cos(wiggleAmount);","    #endif","    vec3 vel = getVelocity(age);","    vec3 accel = getAcceleration(age);","    vec3 force = vec3(0.0);","    vec3 pos = vec3(position);","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation(pos, positionInTime);","    #endif","    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);","    highp float pointSize = getFloatOverLifetime(positionInTime, size) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length(mvPosition.xyz);","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor(color.x),","           unpackColor(color.y),","           unpackColor(color.z),","           unpackColor(color.w)","      );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime(positionInTime, opacity);","    vColor = vec4(c, o);","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime(positionInTime, angle);","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod((positionInTime * loopCount) * totalFrames, totalFrames);","        float column = floor(mod(frameNumber, framesX));","        float row = floor((frameNumber - column) / framesX);","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[i.a.uniforms,t.ShaderChunk.common,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,i.a.varyings,i.a.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if(vColor.w < float(ALPHATEST)) discard;","    #endif",i.a.rotateTexture,t.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4(outgoingLight.xyz, rotatedTexture.w * vColor.w);",t.ShaderChunk.fog_fragment,"}"].join("\n")};e.a=r}).call(this,n(0))},,,,,function(t,e,n){"use strict";n.r(e),function(t){var i=n(198),r=n(128),o=n(50),a=n(12).Entity,s=n(12).registerEntity;n(128);const l=90/(180*Math.PI)/1e3,c=[11184810,12303291,12369084,13355979,13421772,0],u=[[4.8,0,7.3],[0,0,13],[1,0,2],[12.6,0,0],[3.6,0,0],[0,0,0]],h={target:{position:{x:10,y:10,z:10},rotation:{x:Math.PI,y:0,z:0}},angles:{A0:0,A1:0,A2:0,A3:0,A4:0,A5:0},jointOutOfBound:[!1,!1,!1,!1,!1,!1],maxAngleVelocities:{J0:l,J1:l,J2:l,J3:l,J4:l,J5:l},jointLimits:{J0:[-190/180*Math.PI,190/180*Math.PI],J1:[-.5*Math.PI,.5*Math.PI],J2:[-.75*Math.PI,.25*Math.PI],J3:[-.5*Math.PI,75/180*Math.PI],J4:[-139/180*Math.PI,.5*Math.PI],J5:[-188/180*Math.PI,181/180*Math.PI]},configuration:[!1,!1,!1],geometry:{V0:{x:u[0][0],y:u[0][1],z:u[0][2]},V1:{x:u[1][0],y:u[1][1],z:u[1][2]},V2:{x:u[2][0],y:u[2][1],z:u[2][2]},V3:{x:u[3][0],y:u[3][1],z:u[3][2]},V4:{x:u[4][0],y:u[4][1],z:u[4][2]}}};function f(t,e,n){var o=a.call(this,t);this.className="RobotEntity",this.name=name||"Robot",this.type="Robot",this.robotBones=[],this.joints=[],this.geometry=e||h.geometry,this.limits=n||h.jointLimits,this.angles=h.angles;const s=Object.values(this.geometry).map((t,e,n)=>[t.x,t.y,t.z]),l=Object.values(this.limits);return levent.unbindAllEvent(TDS,"ROBOT_CHANGE_TARGET"),t||this.createObject3D(s,l),this.target=new i.default(void 0,o),this.IK=new r.default(s),window.debug={show:!0,scene:TDS_RT.program.getActiveScene()}.show=!0,this.initReducer(),o}f.prototype=Object.create(a.prototype),f.prototype.createObject3D=function(t,e){this.build(t,e)},f.prototype.postRestore=function(){this.traverse(t=>{"Link"===t.type&&this.robotBones.push(t)})},f.prototype.calculateAngles=function(t,e,n){let i=[];this.IK.calculateAngles(t.x,t.y,t.z,e.x,e.y,e.z,i,n);let r=[!1,!1,!1,!1,!1,!1],o=0;for(const t in this.limits)(i[o]<this.limits[t][0]||i[o]>this.limits[t][1])&&(r[o]=!0),o++;return{angles:i,outOfBounds:r}},f.prototype.initReducer=function(){var t=this;levent.bind(TDS_RT,"ROBOT_CHANGE_TARGET",(e,n)=>{const{angles:i,outOfBounds:r}=t.calculateAngles(n.position,n.rotation,h.configuration);t.setAngles(i)})},f.prototype.build=function(t,e){a.prototype.init.call(this);let n=this,i=0,r=0,o=0;t.push([0,0,0]);for(let a=0;a<t.length;a++){const s=t[a],l=this.createLink(i,r,o,s[0],s[1],s[2],e[a][0],e[a][1],a);i=s[0],r=s[1],o=s[2],n.add(l),n=l,this.robotBones.push(l)}},f.prototype.createLink=function(e,n,i,r,s,l,u,h,f){const d=Math.abs(r)+1,p=Math.abs(s)+1,m=Math.abs(l)+1,g=new t.MeshLambertMaterial({color:c[f]}),v=new t.CubeGeometry(d,p,m),y=new t.Mesh(v,g);y.position.set(r/2,s/2,l/2);var x=new a(void 0,"Link");x.type="Link",x.position.set(e,n,i),x.add(new o.default(y));const b=new t.CylinderGeometry(.8,.8,1.6,32,32,!1,-u,2*Math.PI-h+u),w=new t.CylinderGeometry(.8,.8,1.6,32,32,!1,-h,h),_=new t.CylinderGeometry(.8,.8,1.6,32,32,!1,0,-u),M=new t.Mesh(b,new t.MeshBasicMaterial({color:16759552})),S=new t.Mesh(w,new t.MeshBasicMaterial({color:39168})),T=new t.Mesh(_,new t.MeshBasicMaterial({color:14492160})),A=new a;switch(A.add(new o.default(S)).add(new o.default(T)).add(new o.default(M)),this.joints.push(A),f){case 0:A.rotation.x=Math.PI/2;break;case 1:case 2:break;case 3:A.rotation.z=Math.PI/2;break;case 4:A.rotation.y=Math.PI/2;break;case 5:A.rotation.x=Math.PI/2,x.rotation.y=Math.PI/2;const e=new t.ArrowHelper(new t.Vector3(0,0,1),new t.Vector3(0,0,0),3,255);e.line.material.linewidth=4,x.add(e);const n=new t.ArrowHelper(new t.Vector3(0,1,0),new t.Vector3(0,0,0),3,65280);n.line.material.linewidth=4,x.add(n);const i=new t.ArrowHelper(new t.Vector3(1,0,0),new t.Vector3(0,0,0),3,16711680);i.line.material.linewidth=4,x.add(i)}return x.add(A),x},f.prototype.setAngles=function(t){this.angles=t,this.robotBones[0].rotation.z=t[0],this.robotBones[1].rotation.y=t[1],this.robotBones[2].rotation.y=t[2],this.robotBones[3].rotation.x=t[3],this.robotBones[4].rotation.y=t[4]},f.prototype.setAngle=function(t,e){this.angles[t]=e,this.setAngles(this.angles)},f.prototype.highlightJoint=function(t,e){t>=this.joints.length&&console.warn(`cannot highlight joint: ${t} (out of index: ${this.joints.length})`),e?this._colorObjectAndChildren(this.joints[t],e):this._resetObjectAndChildrenColor(this.joints[t])},f.prototype._colorObjectAndChildren=function(t,e){const n=this;t.traverse(t=>{n._colorObject(t,e)})},f.prototype._colorObject=function(t,e){t.material&&(t.initalMaterial||(t.initalMaterial=t.material),t.material=t.material.clone(),t.material.color.setHex(e))},f.prototype._resetObjectAndChildrenColor=function(t,e){const n=this;t.traverse(t=>{n._resetObjectColor(t)})},f.prototype._resetObjectColor=function(t){t.initalMaterial&&(t.material=t.initalMaterial)},e.default=s("RobotEntity",f)}.call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),r=n(148),o=n(150),a=function(){var t,e,n;function a(t){i.Loader.call(this,t)}function s(t,e){this.textureLoader=t,this.manager=e}function l(){}function c(){}function u(){}function h(){}function f(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function d(){}function p(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function m(t){return t/46186158e3}a.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:a,load:function(t,e,n,r){var o=this,a=""===o.path?i.LoaderUtils.extractUrlBase(t):o.path,s=new i.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.load(t,(function(n){try{e(o.parse(n,a))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)},parse:function(e,n){if(a="Kaydara FBX Binary  \0",(o=e).byteLength>=a.length&&a===M(o,0,a.length))t=(new h).parse(e);else{var r=M(e);if(!function(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;for(var i=0;i<e.length;++i){if((o=void 0,o=t[(r=1)-1],t=t.slice(n+r),n++,o)===e[i])return!1}var r,o;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(p(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+p(r));t=(new u).parse(r)}var o,a;return new s(new i.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),this.manager).parse(t)}}),s.prototype={constructor:s,parse:function(){e=this.parseConnections();var t=this.parseImages(),i=this.parseTextures(t),r=this.parseMaterials(i),o=this.parseDeformers(),a=(new l).parse(o);return this.parseScene(o,a,r),n},parseConnections:function(){var e=new Map;"Connections"in t&&t.Connections.connections.forEach((function(t){var n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:i,relationship:r};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});var a={ID:n,relationship:r};e.get(i).children.push(a)}));return e},parseImages:function(){var e={},n={};if("Video"in t.Objects){var i=t.Objects.Video;for(var r in i){var o=i[r];if(e[c=parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,s="string"==typeof o.Content&&""!==o.Content;if(a||s){var l=this.parseImage(i[r]);n[o.RelativeFilename||o.Filename]=l}}}}for(var c in e){var u=e[c];void 0!==n[u]?e[c]=n[u]:e[c]=e[c].split("\\").pop()}return e},parseImage:function(t){var e,n=t.Content,i=t.RelativeFilename||t.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))},parseTextures:function(e){var n=new Map;if("Texture"in t.Objects){var i=t.Objects.Texture;for(var r in i){var o=this.parseTexture(i[r],e);n.set(parseInt(r),o)}}return n},parseTexture:function(t,e){var n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;var r=t.WrapModeU,o=t.WrapModeV,a=void 0!==r?r.value:0,s=void 0!==o?o.value:0;if(n.wrapS=0===a?i.RepeatWrapping:i.ClampToEdgeWrapping,n.wrapT=0===s?i.RepeatWrapping:i.ClampToEdgeWrapping,"Scaling"in t){var l=t.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n},loadTexture:function(t,n){var r,o,a=this.textureLoader.path,s=e.get(t.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(0!==(r=n[s[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var l=t.FileName.slice(-3).toLowerCase();if("tga"===l){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new i.Texture):o=c.load(r)}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new i.Texture):o=this.textureLoader.load(r);return this.textureLoader.setPath(a),o},parseMaterials:function(e){var n=new Map;if("Material"in t.Objects){var i=t.Objects.Material;for(var r in i){var o=this.parseMaterial(i[r],e);null!==o&&n.set(parseInt(r),o)}}return n},parseMaterial:function(t,n){var r=t.id,o=t.attrName,a=t.ShadingModel;if("object"==typeof a&&(a=a.value),!e.has(r))return null;var s,l=this.parseParameters(t,n,r);switch(a.toLowerCase()){case"phong":s=new i.MeshPhongMaterial;break;case"lambert":s=new i.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new i.MeshPhongMaterial}return s.setValues(l),s.name=o,s},parseParameters:function(t,n,r){var o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value),t.Diffuse?o.color=(new i.Color).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(o.color=(new i.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value),t.Emissive?o.emissive=(new i.Color).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(o.emissive=(new i.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(o.opacity=parseFloat(t.Opacity.value)),o.opacity<1&&(o.transparent=!0),t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value),t.Shininess&&(o.shininess=t.Shininess.value),t.Specular?o.specular=(new i.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(o.specular=(new i.Color).fromArray(t.SpecularColor.value));var a=this;return e.get(r).children.forEach((function(t){var e=t.relationship;switch(e){case"Bump":o.bumpMap=a.getTexture(n,t.ID);break;case"Maya|TEX_ao_map":o.aoMap=a.getTexture(n,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=a.getTexture(n,t.ID),o.map.encoding=i.sRGBEncoding;break;case"DisplacementColor":o.displacementMap=a.getTexture(n,t.ID);break;case"EmissiveColor":o.emissiveMap=a.getTexture(n,t.ID),o.emissiveMap.encoding=i.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=a.getTexture(n,t.ID);break;case"ReflectionColor":o.envMap=a.getTexture(n,t.ID),o.envMap.mapping=i.EquirectangularReflectionMapping,o.envMap.encoding=i.sRGBEncoding;break;case"SpecularColor":o.specularMap=a.getTexture(n,t.ID),o.specularMap.encoding=i.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=a.getTexture(n,t.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",e)}})),o},getTexture:function(n,i){return"LayeredTexture"in t.Objects&&i in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=e.get(i).children[0].ID),n.get(i)},parseDeformers:function(){var n={},i={};if("Deformer"in t.Objects){var r=t.Objects.Deformer;for(var o in r){var a=r[o],s=e.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,r);l.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,n[o]=l}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,r),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[o]=c}}}return{skeletons:n,morphTargets:i}},parseSkeleton:function(t,e){var n=[];return t.children.forEach((function(t){var r=e[t.ID];if("Cluster"===r.attrType){var o={ID:t.ID,indices:[],weights:[],transformLink:(new i.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),n.push(o)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(t,n){for(var i=[],r=0;r<t.children.length;r++){var o=t.children[r],a=n[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=e.get(parseInt(o.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,i.push(s)}return i},parseScene:function(r,o,a){n=new i.Group;var s=this.parseModels(r.skeletons,o,a),l=t.Objects.Model,u=this;s.forEach((function(t){var i=l[t.ID];u.setLookAtProperties(t,i),e.get(t.ID).parents.forEach((function(e){var n=s.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&n.add(t)})),this.bindSkeleton(r.skeletons,o,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var e=b(t.userData.transformData);t.applyMatrix4(e)}}));var h=(new c).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=h,n=n.children[0]),n.animations=h},parseModels:function(n,r,o){var a=new Map,s=t.Objects.Model;for(var l in s){var c=parseInt(l),u=s[l],h=e.get(c),f=this.buildSkeleton(h,n,c,u.attrName);if(!f){switch(u.attrType){case"Camera":f=this.createCamera(h);break;case"Light":f=this.createLight(h);break;case"Mesh":f=this.createMesh(h,r,o);break;case"NurbsCurve":f=this.createCurve(h,r);break;case"LimbNode":case"Root":f=new i.Bone;break;case"Null":default:f=new i.Group}f.name=u.attrName?i.PropertyBinding.sanitizeNodeName(u.attrName):"",f.ID=c}this.getTransformData(f,u),a.set(c,f)}return a},buildSkeleton:function(t,e,n,r){var o=null;return t.parents.forEach((function(t){for(var a in e){var s=e[a];s.rawBones.forEach((function(e,a){if(e.ID===t.ID){var l=o;(o=new i.Bone).matrixWorld.copy(e.transformLink),o.name=r?i.PropertyBinding.sanitizeNodeName(r):"",o.ID=n,s.bones[a]=o,null!==l&&o.add(l)}}))}})),o},createCamera:function(e){var n,r;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)})),void 0===r)n=new i.Object3D;else{var o=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(o=1);var a=1;void 0!==r.NearPlane&&(a=r.NearPlane.value/1e3);var s=1e3;void 0!==r.FarPlane&&(s=r.FarPlane.value/1e3);var l=window.innerWidth,c=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(l=r.AspectWidth.value,c=r.AspectHeight.value);var u=l/c,h=45;void 0!==r.FieldOfView&&(h=r.FieldOfView.value);var f=r.FocalLength?r.FocalLength.value:null;switch(o){case 0:n=new i.PerspectiveCamera(h,u,a,s),null!==f&&n.setFocalLength(f);break;case 1:n=new i.OrthographicCamera(-l/2,l/2,c/2,-c/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),n=new i.Object3D}}return n},createLight:function(e){var n,r;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(r=n)})),void 0===r)n=new i.Object3D;else{var o;o=void 0===r.LightType?0:r.LightType.value;var a=16777215;void 0!==r.Color&&(a=(new i.Color).fromArray(r.Color.value));var s=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(s=0);var l=0;void 0!==r.FarAttenuationEnd&&(l=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);switch(o){case 0:n=new i.PointLight(a,s,l,1);break;case 1:n=new i.DirectionalLight(a,s);break;case 2:var c=Math.PI/3;void 0!==r.InnerAngle&&(c=i.MathUtils.degToRad(r.InnerAngle.value));var u=0;void 0!==r.OuterAngle&&(u=i.MathUtils.degToRad(r.OuterAngle.value),u=Math.max(u,1)),n=new i.SpotLight(a,s,l,c,u,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new i.PointLight(a,s)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(t,e,n){var r,o=null,a=null,s=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new i.MeshPhongMaterial({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(s.forEach((function(t){t.skinning=!0})),(r=new i.SkinnedMesh(o,a)).normalizeSkinWeights()):r=new i.Mesh(o,a),r},createCurve:function(t,e){var n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),r=new i.LineBasicMaterial({color:3342591,linewidth:1});return new i.Line(n,r)},getTransformData:function(t,e){var n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?w(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n},setLookAtProperties:function(r,o){"LookAtProperty"in o&&e.get(r.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){var o=t.Objects.Model[e.ID];if("Lcl_Translation"in o){var a=o.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(a),n.add(r.target)):r.lookAt((new i.Vector3).fromArray(a))}}}))},bindSkeleton:function(t,n,r){var o=this.parsePoseNodes();for(var a in t){var s=t[a];e.get(parseInt(s.ID)).parents.forEach((function(t){if(n.has(t.ID)){var a=t.ID;e.get(a).parents.forEach((function(t){r.has(t.ID)&&r.get(t.ID).bind(new i.Skeleton(s.bones),o[t.ID])}))}}))}},parsePoseNodes:function(){var e={};if("Pose"in t.Objects){var n=t.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var o=n[r].PoseNode;Array.isArray(o)?o.forEach((function(t){e[t.Node]=(new i.Matrix4).fromArray(t.Matrix.a)})):e[o.Node]=(new i.Matrix4).fromArray(o.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var e=t.GlobalSettings.AmbientColor.value,r=e[0],o=e[1],a=e[2];if(0!==r||0!==o||0!==a){var s=new i.Color(r,o,a);n.add(new i.AmbientLight(s,1))}}},setupMorphMaterials:function(){var t=this;n.traverse((function(e){e.isMesh&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length&&(Array.isArray(e.material)?e.material.forEach((function(n,i){t.setupMorphMaterial(e,n,i)})):t.setupMorphMaterial(e,e.material))}))},setupMorphMaterial:function(t,e,i){var r=t.uuid,o=e.uuid,a=!1;if(n.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(e){e.uuid===o&&t.uuid!==r&&(a=!0)})):t.material.uuid===o&&t.uuid!==r&&(a=!0))})),!0===a){var s=e.clone();s.morphTargets=!0,void 0===i?t.material=s:t.material[i]=s}else e.morphTargets=!0}},l.prototype={constructor:l,parse:function(n){var i=new Map;if("Geometry"in t.Objects){var r=t.Objects.Geometry;for(var o in r){var a=e.get(parseInt(o)),s=this.parseGeometry(a,r[o],n);i.set(parseInt(o),s)}}return i},parseGeometry:function(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}},parseMeshGeometry:function(e,n,i){var r=i.skeletons,o=[],a=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==a.length){var s=e.children.reduce((function(t,e){return void 0!==r[e.ID]&&(t=r[e.ID]),t}),null);e.children.forEach((function(t){void 0!==i.morphTargets[t.ID]&&o.push(i.morphTargets[t.ID])}));var l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=w(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);var u=b(c);return this.genGeometry(n,s,o,u)}},genGeometry:function(t,e,n,r){var o=new i.BufferGeometry;t.attrName&&(o.name=t.attrName);var a=this.parseGeoNode(t,e),s=this.genBuffers(a),l=new i.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(r),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new i.Float32BufferAttribute(s.colors,3)),e&&(o.setAttribute("skinIndex",new i.Uint16BufferAttribute(s.weightsIndices,4)),o.setAttribute("skinWeight",new i.Float32BufferAttribute(s.vertexWeights,4)),o.FBX_Deformer=e),s.normal.length>0){var c=(new i.Matrix3).getNormalMatrix(r),u=new i.Float32BufferAttribute(s.normal,3);u.applyNormalMatrix(c),o.setAttribute("normal",u)}if(s.uvs.forEach((function(t,e){var n="uv"+(e+1).toString();0===e&&(n="uv"),o.setAttribute(n,new i.Float32BufferAttribute(s.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){var h=s.materialIndex[0],f=0;if(s.materialIndex.forEach((function(t,e){t!==h&&(o.addGroup(f,e-f,h),h=t,f=e)})),o.groups.length>0){var d=o.groups[o.groups.length-1],p=d.start+d.count;p!==s.materialIndex.length&&o.addGroup(p,s.materialIndex.length-p,h)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,t,n,r),o},parseGeoNode:function(t,e){var n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];for(var i=0;t.LayerElementUV[i];)t.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[i])),i++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:e,weight:t.weights[r]})}))}))),n},genBuffers:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,i=0,r=!1,o=[],a=[],s=[],l=[],c=[],u=[],h=this;return t.vertexIndices.forEach((function(f,d){var p=!1;f<0&&(f^=-1,p=!0);var m=[],g=[];if(o.push(3*f,3*f+1,3*f+2),t.color){var y=v(d,n,f,t.color);s.push(y[0],y[1],y[2])}if(t.skeleton){if(void 0!==t.weightTable[f]&&t.weightTable[f].forEach((function(t){g.push(t.weight),m.push(t.id)})),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);var x=[0,0,0,0],b=[0,0,0,0];g.forEach((function(t,e){var n=t,i=m[e];b.forEach((function(t,e,r){if(n>t){r[e]=n,n=t;var o=x[e];x[e]=i,i=o}}))})),m=x,g=b}for(;g.length<4;)g.push(0),m.push(0);for(var w=0;w<4;++w)c.push(g[w]),u.push(m[w])}if(t.normal){y=v(d,n,f,t.normal);a.push(y[0],y[1],y[2])}if(t.material&&"AllSame"!==t.material.mappingType)var _=v(d,n,f,t.material)[0];t.uv&&t.uv.forEach((function(t,e){var i=v(d,n,f,t);void 0===l[e]&&(l[e]=[]),l[e].push(i[0]),l[e].push(i[1])})),i++,p&&(h.genFace(e,t,o,_,a,s,l,c,u,i),n++,i=0,o=[],a=[],s=[],l=[],c=[],u=[])})),e},genFace:function(t,e,n,i,r,o,a,s,l,c){for(var u=2;u<c;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(u-1)]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(u-1)]),t.vertexWeights.push(s[4*(u-1)+1]),t.vertexWeights.push(s[4*(u-1)+2]),t.vertexWeights.push(s[4*(u-1)+3]),t.vertexWeights.push(s[4*u]),t.vertexWeights.push(s[4*u+1]),t.vertexWeights.push(s[4*u+2]),t.vertexWeights.push(s[4*u+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(u-1)]),t.weightsIndices.push(l[4*(u-1)+1]),t.weightsIndices.push(l[4*(u-1)+2]),t.weightsIndices.push(l[4*(u-1)+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[3*(u-1)]),t.colors.push(o[3*(u-1)+1]),t.colors.push(o[3*(u-1)+2]),t.colors.push(o[3*u]),t.colors.push(o[3*u+1]),t.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(i),t.materialIndex.push(i),t.materialIndex.push(i)),e.normal&&(t.normal.push(r[0]),t.normal.push(r[1]),t.normal.push(r[2]),t.normal.push(r[3*(u-1)]),t.normal.push(r[3*(u-1)+1]),t.normal.push(r[3*(u-1)+2]),t.normal.push(r[3*u]),t.normal.push(r[3*u+1]),t.normal.push(r[3*u+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(a[n][0]),t.uvs[n].push(a[n][1]),t.uvs[n].push(a[n][2*(u-1)]),t.uvs[n].push(a[n][2*(u-1)+1]),t.uvs[n].push(a[n][2*u]),t.uvs[n].push(a[n][2*u+1])}))},addMorphTargets:function(e,n,i,r){if(0!==i.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var o=this;i.forEach((function(i){i.rawTargets.forEach((function(i){var a=t.Objects.Geometry[i.geoID];void 0!==a&&o.genMorphGeometry(e,n,a,r,i.name)}))}))}},genMorphGeometry:function(t,e,n,r,o){for(var a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*t.attributes.position.count,u=new Float32Array(c),h=0;h<l.length;h++){var f=3*l[h];u[f]=s[3*h],u[f+1]=s[3*h+1],u[f+2]=s[3*h+2]}var d={vertexIndices:a,vertexPositions:u},p=this.genBuffers(d),m=new i.Float32BufferAttribute(p.vertex,3);m.name=o||n.attrName,m.applyMatrix4(r),t.morphAttributes.position.push(m)},parseNormals:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Normals.a,r=[];return"IndexToDirect"===n&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:e,referenceType:n}},parseUVs:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.UV.a,r=[];return"IndexToDirect"===n&&(r=t.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:e,referenceType:n}},parseVertexColors:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Colors.a,r=[];return"IndexToDirect"===n&&(r=t.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:e,referenceType:n}},parseMaterialIndices:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var i=t.Materials.a,r=[],o=0;o<i.length;++o)r.push(o);return{dataSize:1,buffer:i,indices:r,mappingType:e,referenceType:n}},parseNurbsGeometry:function(t){if(void 0===o.a)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.BufferGeometry;var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new i.BufferGeometry;for(var n,r,a=e-1,s=t.KnotVector.a,l=[],c=t.Points.a,u=0,h=c.length;u<h;u+=4)l.push((new i.Vector4).fromArray(c,u));if("Closed"===t.Form)l.push(l[0]);else if("Periodic"===t.Form){n=a,r=s.length-1-n;for(u=0;u<a;++u)l.push(l[u])}var f=new o.a(a,s,l,n,r).getPoints(7*l.length),d=new Float32Array(3*f.length);f.forEach((function(t,e){t.toArray(d,3*e)}));var p=new i.BufferGeometry;return p.setAttribute("position",new i.BufferAttribute(d,3)),p}},c.prototype={constructor:c,parse:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var n in e){var i=e[n],r=this.addClip(i);t.push(r)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,n=new Map;for(var i in e){var r=e[i];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var o={id:r.id,attr:r.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var i=t.Objects.AnimationCurve;for(var r in i){var o={id:i[r].id,times:i[r].KeyTime.a.map(m),values:i[r].KeyValueFloat.a},a=e.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?n.get(s).curves.x=o:l.match(/Y/)?n.get(s).curves.y=o:l.match(/Z/)?n.get(s).curves.z=o:l.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves.morph=o)}}},parseAnimationLayers:function(r){var o=t.Objects.AnimationLayer,a=new Map;for(var s in o){var l=[],c=e.get(parseInt(s));if(void 0!==c)c.children.forEach((function(o,a){if(r.has(o.ID)){var s=r.get(o.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===l[a])if(void 0!==(p=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID)){if(void 0===(u=t.Objects.Model[p.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",o);var c={modelName:u.attrName?i.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(t){t.ID===u.id&&(c.transform=t.matrix,t.userData.transformData&&(c.eulerOrder=t.userData.transformData.eulerOrder))})),c.transform||(c.transform=new i.Matrix4),"PreRotation"in u&&(c.preRotation=u.PreRotation.value),"PostRotation"in u&&(c.postRotation=u.PostRotation.value),l[a]=c}l[a]&&(l[a][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===l[a]){var u,h=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,f=e.get(h).parents[0].ID,d=e.get(f).parents[0].ID,p=e.get(d).parents[0].ID;c={modelName:(u=t.Objects.Model[p]).attrName?i.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:t.Objects.Deformer[h].attrName};l[a]=c}l[a][s.attr]=s}}})),a.set(parseInt(s),l)}return a},parseAnimStacks:function(n){var i=t.Objects.AnimationStack,r={};for(var o in i){var a=e.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(a[0].ID);r[o]={name:i[o].attrName,layer:s}}return r},addClip:function(t){var e=[],n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new i.AnimationClip(t.name,-1,e)},generateTracks:function(t){var e=[],n=new i.Vector3,r=new i.Quaternion,o=new i.Vector3;if(t.transform&&t.transform.decompose(n,r,o),n=n.toArray(),r=(new i.Euler).setFromQuaternion(r,t.eulerOrder).toArray(),o=o.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var a=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==a&&e.push(a)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var s=this.generateRotationTrack(t.modelName,t.R.curves,r,t.preRotation,t.postRotation,t.eulerOrder);void 0!==s&&e.push(s)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var l=this.generateVectorTrack(t.modelName,t.S.curves,o,"scale");void 0!==l&&e.push(l)}if(void 0!==t.DeformPercent){var c=this.generateMorphTrack(t);void 0!==c&&e.push(c)}return e},generateVectorTrack:function(t,e,n,r){var o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);return new i.VectorKeyframeTrack(t+"."+r,o,a)},generateRotationTrack:function(t,e,n,r,o,a){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(i.MathUtils.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(i.MathUtils.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(i.MathUtils.degToRad));var s=this.getTimesForAllAxes(e),l=this.getKeyframeTrackValues(s,e,n);void 0!==r&&((r=r.map(i.MathUtils.degToRad)).push(a),r=(new i.Euler).fromArray(r),r=(new i.Quaternion).setFromEuler(r)),void 0!==o&&((o=o.map(i.MathUtils.degToRad)).push(a),o=(new i.Euler).fromArray(o),o=(new i.Quaternion).setFromEuler(o).inverse());for(var c=new i.Quaternion,u=new i.Euler,h=[],f=0;f<l.length;f+=3)u.set(l[f],l[f+1],l[f+2],a),c.setFromEuler(u),void 0!==r&&c.premultiply(r),void 0!==o&&c.multiply(o),c.toArray(h,f/3*4);return new i.QuaternionKeyframeTrack(t+".quaternion",s,h)},generateMorphTrack:function(t){var e=t.DeformPercent.curves.morph,r=e.values.map((function(t){return t/100})),o=n.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new i.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+o+"]",e.times,r)},getTimesForAllAxes:function(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})).filter((function(t,e,n){return n.indexOf(t)==e}))},getKeyframeTrackValues:function(t,e,n){var i=n,r=[],o=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];r.push(n),i[0]=n}else r.push(i[0]);if(-1!==a){var l=e.y.values[a];r.push(l),i[1]=l}else r.push(i[1]);if(-1!==s){var c=e.z.values[s];r.push(c),i[2]=c}else r.push(i[2])})),r},interpolateRotations:function(t){for(var e=1;e<t.values.length;e++){var n=t.values[e-1],i=t.values[e]-n,r=Math.abs(i);if(r>=180){for(var o=r/180,a=i/o,s=n+a,l=t.times[e-1],c=(t.times[e]-l)/o,u=l+c,h=[],f=[];u<t.times[e];)h.push(u),u+=c,f.push(s),s+=a;t.times=S(t.times,e,h),t.values=S(t.values,e,f)}}}},u.prototype={constructor:u,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new d,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,i){var r=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!r&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++i]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),i=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},o=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=r)):"number"==typeof o.id?(a[n]={},a[n][o.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",i="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:n,type:i}},parseNodeProperty:function(t,e,n){var i=e[1].replace(/^"/,"").replace(/"$/,"").trim(),r=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===i){var a=r.split(",").slice(1),s=parseInt(a[0]),l=parseInt(a[1]),c=r.split(",").slice(3);i="connections",function(t,e){for(var n=0,i=t.length,r=e.length;n<r;n++,i++)t[i]=e[n]}(r=[s,l],c=c.map((function(t){return t.trim().replace(/^"/,"")}))),void 0===o[i]&&(o[i]=[])}"Node"===i&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):"a"!==i?o[i]=r:o.a=r,this.setCurrentProp(o,i),"a"===i&&","!==r.slice(-1)&&(o.a=_(r))}else this.parseNodeSpecialProperty(t,i,r)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=_(e.a))},parseNodeSpecialProperty:function(t,e,n){var i=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],o=i[1],a=i[2],s=i[3],l=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=_(l)}this.getPrevNode()[r]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),r)}},h.prototype={constructor:h,parse:function(t){var e=new f(t);e.skip(23);var n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var i=new d;!this.endOfContent(e);){var r=this.parseNode(e,n);null!==r&&i.add(r.name,r)}return i},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var n={},i=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var o=t.getUint8(),a=t.getString(o);if(0===i)return null;for(var s=[],l=0;l<r;l++)s.push(this.parseProperty(t));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===r&&t.getOffset()===i;i>t.getOffset();){var f=this.parseNode(t,e);null!==f&&this.parseSubNode(a,n,f)}return n.propertyList=s,"number"==typeof c&&(n.id=c),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(t,e,n){if(!0===n.singleProperty){var i=n.propertyList[0];Array.isArray(i)?(e[n.name]=n,n.a=i):e[n.name]=i}else if("Connections"===t&&"C"===n.name){var r=[];n.propertyList.forEach((function(t,e){0!==e&&r.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(r)}else if("Properties70"===n.name){Object.keys(n).forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){var o,a=n.propertyList[0],s=n.propertyList[1],l=n.propertyList[2],c=n.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[a]={type:s,type2:l,flag:c,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var n=t.getUint32();return t.getArrayBuffer(n);case"S":n=t.getUint32();return t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=t.getUint32(),o=t.getUint32(),a=t.getUint32();if(0===o)switch(e){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}void 0===r.a&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new f(new r.a(new Uint8Array(t.getArrayBuffer(a))).decompress().buffer);switch(e){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}},f.prototype={constructor:f,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295===(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=[],n=0;n<t;n++)e[n]=this.getUint8();var r=e.indexOf(0);return r>=0&&(e=e.slice(0,r)),i.LoaderUtils.decodeText(new Uint8Array(e))}},d.prototype={constructor:d,add:function(t,e){this[t]=e}};var g=[];function v(t,e,n,i){var r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);var o=r*i.dataSize,a=o+i.dataSize;return function(t,e,n,i){for(var r=n,o=0;r<i;r++,o++)t[o]=e[r];return t}(g,i.buffer,o,a)}var y=new i.Euler,x=new i.Vector3;function b(t){var e,n=new i.Matrix4,r=new i.Matrix4,o=new i.Matrix4,a=new i.Matrix4,s=new i.Matrix4,l=new i.Matrix4,c=new i.Matrix4,u=new i.Matrix4,h=new i.Matrix4,f=new i.Matrix4,d=new i.Matrix4,p=t.inheritType?t.inheritType:0;(t.translation&&n.setPosition(x.fromArray(t.translation)),t.preRotation)&&((e=t.preRotation.map(i.MathUtils.degToRad)).push(t.eulerOrder),r.makeRotationFromEuler(y.fromArray(e)));t.rotation&&((e=t.rotation.map(i.MathUtils.degToRad)).push(t.eulerOrder),o.makeRotationFromEuler(y.fromArray(e)));t.postRotation&&((e=t.postRotation.map(i.MathUtils.degToRad)).push(t.eulerOrder),a.makeRotationFromEuler(y.fromArray(e)));t.scale&&s.scale(x.fromArray(t.scale)),t.scalingOffset&&c.setPosition(x.fromArray(t.scalingOffset)),t.scalingPivot&&l.setPosition(x.fromArray(t.scalingPivot)),t.rotationOffset&&u.setPosition(x.fromArray(t.rotationOffset)),t.rotationPivot&&h.setPosition(x.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(f=t.parentMatrixWorld);var m=r.multiply(o).multiply(a),g=new i.Matrix4;f.extractRotation(g),(new i.Matrix4).copyPosition(f);var v=new i.Matrix4;v.getInverse(g).multiply(f);var b=new i.Matrix4;if(0===p)b.copy(g).multiply(m).multiply(v).multiply(s);else if(1===p)b.copy(g).multiply(v).multiply(m).multiply(s);else{var w=(new i.Matrix4).getInverse(s),_=(new i.Matrix4).multiply(v).multiply(w);b.copy(g).multiply(m).multiply(_).multiply(s)}var M=(new i.Matrix4).getInverse(h),S=(new i.Matrix4).getInverse(l),T=new i.Matrix4;T.copy(n).multiply(u).multiply(h).multiply(r).multiply(o).multiply(a).multiply(M).multiply(c).multiply(l).multiply(s).multiply(S);var A=(new i.Matrix4).copyPosition(T),E=(new i.Matrix4).copy(f).multiply(A);return d.copyPosition(E),T=(new i.Matrix4).multiply(d).multiply(b)}function w(t){var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function _(t){return t.split(",").map((function(t){return parseFloat(t)}))}function M(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),i.LoaderUtils.decodeText(new Uint8Array(t,e,n))}function S(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}return a}()},function(t,e,n){"use strict";n.r(e);n(93);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="rotation",this.type="Rotation",this.speed=1,this.direction=o.CLOCKWISE,this.time=0,n}o.CLOCKWISE=-1,o.COUNTER_CLOCKWISE=1,o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this},o.prototype.update=function(t){this.enabled&&(this.time+=t,this.entity.rotation.y+=this.direction*t*this.speed)},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={speed:this.speed,direction:this.direction},t},e.default=r("rotation",o)},function(t,e,n){"use strict";n.r(e);var i=n(207),r=(n(0),n(12).Entity),o=n(12).registerEntity;function a(t,e){var n=r.call(this,t);this.name=name||"Audio",this.className="AudioEntity",this.type="Audio";var o=new i.a(this,t,e);return n.addComponent(o),this.object3D=o.object3D,n}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getAudio=function(){return this.object3D},e.default=o("AudioEntity",a)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(196),o=n(12).Entity,a=n(12).registerEntity;function s(e,n){var a=o.call(this,e);if(this.className="FBXEntity",this.name=e.name?e.name:"FBXModel",this.type="Model",void 0!==e.animations&&e.animations.length>0){var s=new r.a(this,e);this.addComponent(s)}!1!==n&&e.traverse((function(n){if(n!==e){var r=new o(n);if(void 0!==e.animations&&e.animations.length>0&&n instanceof t.SkinnedMesh&&(n.animations=e.animations),n.isMesh){var a=new i.default(r,n);r.addComponent(a)}n.parent.entity.add(r,!1)}}));var l=(new t.Box3).setFromObject(this.object3D),c=Math.ceil(l.size().x),u=Math.ceil(l.size().y),h=Math.ceil(l.size().z);u>h&&(u=h),c>u&&(c=u),c>h&&(c=h);var f=1;return c>10&&(f=Math.floor(1/(c/10)*100)/100),this.object3D.scale.multiplyScalar(f),a}s.prototype=Object.create(o.prototype),s.prototype.init=function(){return o.prototype.init.call(this),this},e.default=a("FBXEntity",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n){var o=r.call(this,e);if(this.className="OBJEntity",this.name=e.name?e.name:"OBJModel",this.type="Model",e.isMesh){var a=new i.default(this,e);this.addComponent(a)}!1!==n&&e.traverse((function(t){if(t!==e){var n=new r(t);if(t.isMesh||void 0!==t.geometry){var o=new i.default(n,t);n.addComponent(o)}t.parent.entity.add(n,!1)}}));var s=(new t.Box3).setFromObject(this.object3D),l=Math.ceil(s.size().x),c=Math.ceil(s.size().y),u=Math.ceil(s.size().z);c>u&&(c=u),l>c&&(l=c),l>u&&(l=u);var h=1;return l>10&&(h=Math.floor(1/(l/10)*100)/100),this.object3D.scale.multiplyScalar(h),o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},e.default=o("OBJEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n){var o=r.call(this,e);if(this.className="STLEntity",this.name=e.name?e.name:"STLModel",this.type="Model",e.isMesh){var a=new i.default(this,e);this.addComponent(a)}!1!==n&&e.traverse((function(t){if(t!==e){var n=new r(t);if(t.isMesh){var o=new i.default(n,t);n.addComponent(o)}t.parent.entity.add(n,!1)}}));var s=(new t.Box3).setFromObject(this.object3D),l=Math.ceil(s.size().x),c=Math.ceil(s.size().y),u=Math.ceil(s.size().z);c>u&&(c=u),l>c&&(l=c),l>u&&(l=u);var h=1;return l>10&&(h=Math.floor(1/(l/10)*100)/100),this.object3D.scale.multiplyScalar(h),o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},e.default=o("STLEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=(n(196),n(12).Entity),o=n(12).registerEntity;function a(e,n){var o=r.call(this,e);this.type="Model",this.className="GLTFEntity",this.name=e.name?e.name:"GLTFModel",e.type="Group";var a=e.animations;return!1!==n&&e.traverse((function(n){if(a&&a.length>0&&n instanceof t.SkinnedMesh&&(n.animations=a),n!==e&&""!==n.name){var o=new r(n);if(n.isMesh){var s=new i.default(o,n);o.addComponent(s)}n.parent.entity.add(o,!1)}})),o}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},e.default=o("GLTFEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(12).Entity,r=n(12).registerEntity;function o(t,e,n,r){var o=i.call(this,t);return this.className="SVGEntity",this.name=e||"SVGModel",this.type="Shape",this.shapes=n,this.materialMaps=r,o}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return i.prototype.init.call(this),this.object3D.scale.set(.01,.01,.01),this.object3D.rotation.z=3.14,this},o.prototype.getShapes=function(){return this.shapes},o.prototype.getColors=function(){return this.materialMaps},e.default=r("SVGEntity",o)},,,,,,,function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var i,r,o;
/**
 * @license Long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/Long.js for details
 */r=[],void 0===(o="function"==typeof(i=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}t.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=function(t){return!0===(t&&t.__isLong__)};var e={},n={};t.fromInt=function(i,r){var o,a;return r?0<=(i>>>=0)&&i<256&&(a=n[i])?a:(o=new t(i,(0|i)<0?-1:0,!0),0<=i&&i<256&&(n[i]=o),o):-128<=(i|=0)&&i<128&&(a=e[i])?a:(o=new t(i,i<0?-1:0,!1),-128<=i&&i<128&&(e[i]=o),o)},t.fromNumber=function(e,n){return n=!!n,isNaN(e)||!isFinite(e)?t.ZERO:!n&&e<=-o?t.MIN_VALUE:!n&&e+1>=o?t.MAX_VALUE:n&&e>=r?t.MAX_UNSIGNED_VALUE:e<0?t.fromNumber(-e,n).negate():new t(e%i|0,e/i|0,n)},t.fromBits=function(e,n,i){return new t(e,n,i)},t.fromString=function(e,n,i){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t.ZERO;if("number"==typeof n&&(i=n,n=!1),(i=i||10)<2||36<i)throw Error("radix out of range: "+i);var r;if((r=e.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+e);if(0===r)return t.fromString(e.substring(1),n,i).negate();for(var o=t.fromNumber(Math.pow(i,8)),a=t.ZERO,s=0;s<e.length;s+=8){var l=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+l),i);if(l<8){var u=t.fromNumber(Math.pow(i,l));a=a.multiply(u).add(t.fromNumber(c))}else a=(a=a.multiply(o)).add(t.fromNumber(c))}return a.unsigned=n,a},t.fromValue=function(e){return e instanceof t?e:"number"==typeof e?t.fromNumber(e):"string"==typeof e?t.fromString(e):new t(e.low,e.high,e.unsigned)};var i=4294967296,r=i*i,o=r/2,a=t.fromInt(1<<24);return t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*i+(this.low>>>0):this.high*i+(this.low>>>0)},t.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var n;if(this.isNegative()){if(this.equals(t.MIN_VALUE)){var i=t.fromNumber(e),r=this.divide(i);return n=r.multiply(i).subtract(this),r.toString(e)+n.toInt().toString(e)}return"-"+this.negate().toString(e)}var o=t.fromNumber(Math.pow(e,6),this.unsigned);n=this;for(var a="";;){var s=n.divide(o),l=(n.subtract(s.multiply(o)).toInt()>>>0).toString(e);if((n=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(t.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,n=31;n>0&&0==(e&1<<n);n--);return 0!=this.high?n+33:n+1},t.prototype.isZero=function(){return 0===this.high&&0===this.low},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isOdd=function(){return 1==(1&this.low)},t.prototype.isEven=function(){return 0==(1&this.low)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},t.eq=t.prototype.equals,t.prototype.notEquals=function(t){return!this.equals(t)},t.neq=t.prototype.notEquals,t.prototype.lessThan=function(t){return this.compare(t)<0},t.prototype.lt=t.prototype.lessThan,t.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},t.prototype.lte=t.prototype.lessThanOrEqual,t.prototype.greaterThan=function(t){return this.compare(t)>0},t.prototype.gt=t.prototype.greaterThan,t.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},t.prototype.gte=t.prototype.greaterThanOrEqual,t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.equals(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},t.prototype.negate=function(){return!this.unsigned&&this.equals(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=t.prototype.negate,t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,l=e.low>>>16,c=0,u=0,h=0,f=0;return h+=(f+=o+(65535&e.low))>>>16,f&=65535,u+=(h+=r+l)>>>16,h&=65535,c+=(u+=i+s)>>>16,u&=65535,c+=n+a,c&=65535,t.fromBits(h<<16|f,c<<16|u,this.unsigned)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.negate())},t.prototype.sub=t.prototype.subtract,t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())return t.ZERO;if(this.equals(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.equals(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(a)&&e.lessThan(a))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,c=e.low>>>16,u=65535&e.low,h=0,f=0,d=0,p=0;return d+=(p+=o*u)>>>16,p&=65535,f+=(d+=r*u)>>>16,d&=65535,f+=(d+=o*c)>>>16,d&=65535,h+=(f+=i*u)>>>16,f&=65535,h+=(f+=r*c)>>>16,f&=65535,h+=(f+=o*l)>>>16,f&=65535,h+=n*u+i*c+r*l+o*s,h&=65535,t.fromBits(d<<16|p,h<<16|f,this.unsigned)},t.prototype.mul=t.prototype.multiply,t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,i,r;if(this.equals(t.MIN_VALUE))return e.equals(t.ONE)||e.equals(t.NEG_ONE)?t.MIN_VALUE:e.equals(t.MIN_VALUE)?t.ONE:(n=this.shiftRight(1).divide(e).shiftLeft(1)).equals(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(i=this.subtract(e.multiply(n)),r=n.add(i.divide(e)));if(e.equals(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(r=t.ZERO,i=this;i.greaterThanOrEqual(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),a=o<=48?1:Math.pow(2,o-48),s=t.fromNumber(n),l=s.multiply(e);l.isNegative()||l.greaterThan(i);)n-=a,l=(s=t.fromNumber(n,this.unsigned)).multiply(e);s.isZero()&&(s=t.ONE),r=r.add(s),i=i.subtract(l)}return r},t.prototype.div=t.prototype.divide,t.prototype.modulo=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.subtract(this.divide(e).multiply(e))},t.prototype.mod=t.prototype.modulo,t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=t.prototype.shiftLeft,t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=t.prototype.shiftRight,t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),0==(e&=63))return this;var n=this.high;if(e<32){var i=this.low;return t.fromBits(i>>>e|n<<32-e,n>>>e,this.unsigned)}return 32===e?t.fromBits(n,0,this.unsigned):t.fromBits(n>>>e-32,0,this.unsigned)},t.prototype.shru=t.prototype.shiftRightUnsigned,t.prototype.toSigned=function(){return this.unsigned?new t(this.low,this.high,!1):this},t.prototype.toUnsigned=function(){return this.unsigned?this:new t(this.low,this.high,!0)},t})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){var i,r,o;
/**
 * @license Long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/Long.js for details
 */r=[],void 0===(o="function"==typeof(i=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}t.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=function(t){return!0===(t&&t.__isLong__)};var e={},n={};t.fromInt=function(i,r){var o,a;return r?0<=(i>>>=0)&&i<256&&(a=n[i])?a:(o=new t(i,(0|i)<0?-1:0,!0),0<=i&&i<256&&(n[i]=o),o):-128<=(i|=0)&&i<128&&(a=e[i])?a:(o=new t(i,i<0?-1:0,!1),-128<=i&&i<128&&(e[i]=o),o)},t.fromNumber=function(e,n){return n=!!n,isNaN(e)||!isFinite(e)?t.ZERO:!n&&e<=-o?t.MIN_VALUE:!n&&e+1>=o?t.MAX_VALUE:n&&e>=r?t.MAX_UNSIGNED_VALUE:e<0?t.fromNumber(-e,n).negate():new t(e%i|0,e/i|0,n)},t.fromBits=function(e,n,i){return new t(e,n,i)},t.fromString=function(e,n,i){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t.ZERO;if("number"==typeof n&&(i=n,n=!1),(i=i||10)<2||36<i)throw Error("radix out of range: "+i);var r;if((r=e.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+e);if(0===r)return t.fromString(e.substring(1),n,i).negate();for(var o=t.fromNumber(Math.pow(i,8)),a=t.ZERO,s=0;s<e.length;s+=8){var l=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+l),i);if(l<8){var u=t.fromNumber(Math.pow(i,l));a=a.multiply(u).add(t.fromNumber(c))}else a=(a=a.multiply(o)).add(t.fromNumber(c))}return a.unsigned=n,a},t.fromValue=function(e){return e instanceof t?e:"number"==typeof e?t.fromNumber(e):"string"==typeof e?t.fromString(e):new t(e.low,e.high,e.unsigned)};var i=4294967296,r=i*i,o=r/2,a=t.fromInt(1<<24);return t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*i+(this.low>>>0):this.high*i+(this.low>>>0)},t.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var n;if(this.isNegative()){if(this.equals(t.MIN_VALUE)){var i=t.fromNumber(e),r=this.divide(i);return n=r.multiply(i).subtract(this),r.toString(e)+n.toInt().toString(e)}return"-"+this.negate().toString(e)}var o=t.fromNumber(Math.pow(e,6),this.unsigned);n=this;for(var a="";;){var s=n.divide(o),l=(n.subtract(s.multiply(o)).toInt()>>>0).toString(e);if((n=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(t.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,n=31;n>0&&0==(e&1<<n);n--);return 0!=this.high?n+33:n+1},t.prototype.isZero=function(){return 0===this.high&&0===this.low},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isOdd=function(){return 1==(1&this.low)},t.prototype.isEven=function(){return 0==(1&this.low)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},t.eq=t.prototype.equals,t.prototype.notEquals=function(t){return!this.equals(t)},t.neq=t.prototype.notEquals,t.prototype.lessThan=function(t){return this.compare(t)<0},t.prototype.lt=t.prototype.lessThan,t.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},t.prototype.lte=t.prototype.lessThanOrEqual,t.prototype.greaterThan=function(t){return this.compare(t)>0},t.prototype.gt=t.prototype.greaterThan,t.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},t.prototype.gte=t.prototype.greaterThanOrEqual,t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.equals(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},t.prototype.negate=function(){return!this.unsigned&&this.equals(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=t.prototype.negate,t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,l=e.low>>>16,c=0,u=0,h=0,f=0;return h+=(f+=o+(65535&e.low))>>>16,f&=65535,u+=(h+=r+l)>>>16,h&=65535,c+=(u+=i+s)>>>16,u&=65535,c+=n+a,c&=65535,t.fromBits(h<<16|f,c<<16|u,this.unsigned)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.negate())},t.prototype.sub=t.prototype.subtract,t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())return t.ZERO;if(this.equals(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.equals(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(a)&&e.lessThan(a))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,c=e.low>>>16,u=65535&e.low,h=0,f=0,d=0,p=0;return d+=(p+=o*u)>>>16,p&=65535,f+=(d+=r*u)>>>16,d&=65535,f+=(d+=o*c)>>>16,d&=65535,h+=(f+=i*u)>>>16,f&=65535,h+=(f+=r*c)>>>16,f&=65535,h+=(f+=o*l)>>>16,f&=65535,h+=n*u+i*c+r*l+o*s,h&=65535,t.fromBits(d<<16|p,h<<16|f,this.unsigned)},t.prototype.mul=t.prototype.multiply,t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,i,r;if(this.equals(t.MIN_VALUE))return e.equals(t.ONE)||e.equals(t.NEG_ONE)?t.MIN_VALUE:e.equals(t.MIN_VALUE)?t.ONE:(n=this.shiftRight(1).divide(e).shiftLeft(1)).equals(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(i=this.subtract(e.multiply(n)),r=n.add(i.divide(e)));if(e.equals(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(r=t.ZERO,i=this;i.greaterThanOrEqual(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),a=o<=48?1:Math.pow(2,o-48),s=t.fromNumber(n),l=s.multiply(e);l.isNegative()||l.greaterThan(i);)n-=a,l=(s=t.fromNumber(n,this.unsigned)).multiply(e);s.isZero()&&(s=t.ONE),r=r.add(s),i=i.subtract(l)}return r},t.prototype.div=t.prototype.divide,t.prototype.modulo=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.subtract(this.divide(e).multiply(e))},t.prototype.mod=t.prototype.modulo,t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=t.prototype.shiftLeft,t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=t.prototype.shiftRight,t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),0==(e&=63))return this;var n=this.high;if(e<32){var i=this.low;return t.fromBits(i>>>e|n<<32-e,n>>>e,this.unsigned)}return 32===e?t.fromBits(n,0,this.unsigned):t.fromBits(n>>>e-32,0,this.unsigned)},t.prototype.shru=t.prototype.shiftRightUnsigned,t.prototype.toSigned=function(){return this.unsigned?new t(this.low,this.high,!1):this},t.prototype.toUnsigned=function(){return this.unsigned?this:new t(this.low,this.high,!0)},t})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){(function(i){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let i=0,r=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(i++,"%c"===t&&(r=i))}),e.splice(r,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=n(509)(e);const{formatters:r}=t.exports;r.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,n(126))},function(t,e){var n={bind:function(t,e,n,i){if(!t)throw"cannot bind event to null";if(!n)throw"cannot bind to null callback";if(t.constructor===String)throw"cannot bind event to a string";var r=t.__levents;r||(Object.defineProperty(t,"__levents",{value:{},enumerable:!1}),r=t.__levents),r.hasOwnProperty(e)?r[e].push([n,i]):r[e]=[[n,i]],t.onleventBinded&&t.onleventBinded(e,n,i)},unbind:function(t,e,n,i){if(!t)throw"cannot unbind event to null";if(!n)throw"cannot unbind from null callback";if(t.constructor===String)throw"cannot bind event to a string";var r=t.__levents;if(r&&r.hasOwnProperty(e)){for(var o=0,a=r[e].length;o<a;++o){var s=r[e][o];if(s[0]===n&&s[1]===i){r[e].splice(o,1);break}}0==r[e].length&&delete r[e],t.onleventUnbinded&&t.onleventUnbinded(e,n,i)}},unbindAll:function(t,e,n){if(!t)throw"cannot unbind events in null";var i=t.__levents;if(i)if(t.onleventUnbindAll&&t.onleventUnbindAll(e,n),e)for(var r in i)for(var o=i[r],a=o.length-1;a>=0;--a)o[a][1]!=e||n&&n!==o[a][0]||o.splice(a,1);else delete t.__levents},unbindAllEvent:function(t,e){if(!t)throw"cannot unbind events in null";var n=t.__levents;n&&(delete n[e],t.onleventUnbindAll&&t.onleventUnbindAll(e,target_instance,callback))},isBind:function(t,e,n,i){if(!t)throw"levent cannot have null as instance";var r=t.__levents;if(r){if(!r.hasOwnProperty(e))return!1;for(var o=0,a=r[e].length;o<a;++o){var s=r[e][o];if(s[0]===n&&s[1]===i)return!0}return!1}},hasBind:function(t,e){if(!t)throw"levent cannot have null as instance";var n=t.__levents;return!!(n&&n.hasOwnProperty(e)&&n[e].length)},hasBindTo:function(t,e){if(!t)throw"levent cannot have null as instance";var n=t.__levents;if(!n)return!1;for(var i in n)for(var r=n[i],o=0;o<r.length;++o)if(r[o][1]===e)return!0;return!1},trigger:function(t,e,n,i,r){if(!t)throw"cannot trigger event from null";if(t.constructor===String)throw"cannot bind event to a string";var o=t.__levents;if(!o||!o.hasOwnProperty(e))return!1;var a=o[e];if(i)for(var s=a.length-1;s>=0;--s){var l=a[s];if(r){if(l&&!0===l[0].apply(l[1],n))return!0}else if(l&&!0===l[0].call(l[1],e,n))return!0}else{s=0;for(var c=a.length;s<c;++s){l=a[s];if(r){if(l&&!0===l[0].apply(l[1],n))return!0}else if(l&&!0===l[0].call(l[1],e,n))return!0}}return!1},triggerArray:function(t,e,n,i,r){for(var o=!1,a=0,s=t.length;a<s;++a){var l=t[a];if(!l)throw"cannot trigger event from null";if(l.constructor===String)throw"cannot bind event to a string";var c=l.__levents;if(c&&c.hasOwnProperty(e))if(i)for(var u=c[e].length-1;u>=0;--u){var h=c[e][u];if(r){if(!0===h[0].apply(h[1],n)){o=!0;break}}else if(!0===h[0].call(h[1],e,n)){o=!0;break}}else{u=0;for(var f=c[e].length;u<f;++u){h=c[e][u];if(r){if(!0===h[0].apply(h[1],n)){o=!0;break}}else if(!0===h[0].call(h[1],e,n)){o=!0;break}}}}return o},extendObject:function(t){t.bind=function(t,e,i){return n.bind(this,t,e,i)},t.trigger=function(t,e){return n.trigger(this,t,e)},t.unbind=function(t,e,i){return n.unbind(this,t,e,instance)},t.unbindAll=function(t,e){return n.unbindAll(this,t,e)}},extendClass:function(t){this.extendObject(t.prototype)}};t.exports=n},function(t,e,n){"use strict";n.r(e),function(t){var e=n(4),i=n(104);t.Object3D.prototype.folded=!1,t.Object3D.prototype.locked=!1,t.Object3D.prototype.isStorable=!0,t.Object3D.prototype.contains=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].uuid===t.uuid||this.children[e].contains(t))return!0;return!1},t.Object3D.prototype.playAnimation=function(){void 0!==this.mixer&&this.mixer.play()},t.Object3D.prototype.stopAnimation=function(){void 0!==this.mixer&&this.mixer.stop()},t.Object3D.prototype.initialize=function(){void 0!==this.animations&&(this.mixer=new t.AnimationMixer(this),this.mixer.createActions(this.animations),this.mixer.play())},t.Object3D.prototype.update=function(t){void 0!==this.mixer&&this.mixer.update(t)},t.Object3D.prototype.resize=function(t,e){},t.Object3D.prototype.dispose=function(){void 0!==this.mixer&&this.mixer.dispose()},t.Object3D.prototype.addAbove=function(t,e){if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this;if(t&&t.isObject3D){null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"});var n=this.children.indexOf(e);this.children.splice(n,0,t)}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},t.Object3D.prototype.addBellow=function(t,e){if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this;if(t&&t.isObject3D){null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"});var n=this.children.indexOf(e)+1;this.children.splice(n,0,t)}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},t.Object3D.prototype.getScene=function(){for(var e=this;null!==e.parent;)if((e=e.parent)instanceof t.Scene)return e;return null},t.Object3D.prototype.removeAll=function(){for(;this.children.length>0;)this.remove(this.children[0])},t.Object3D.prototype.isEmpty=function(){return 0===this.children.length},t.Object3D.prototype.destroy=function(){for(;this.children.length>0;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this),this.parent=null)},t.Object3D.prototype.toJSON=function(n,r,o){if(!this.isStorable)return{object:{uuid:this.uuid,type:"Object"}};var a=void 0===n,s={};a&&(n=new i.a.Resources,s.metadata={version:e.default.VERSION,type:e.default.NAME});var l={};if(l.uuid=this.uuid,l.type=this.type,l.name=this.name,l.folded=this.folded,l.locked=this.locked,l.castShadow=this.castShadow,l.receiveShadow=this.receiveShadow,l.visible=this.visible,l.matrixAutoUpdate=this.matrixAutoUpdate,l.frustumCulled=this.frustumCulled,l.renderOrder=this.renderOrder,l.position=this.position.toArray(),l.quaternion=this.quaternion.toArray(),l.scale=this.scale.toArray(),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),void 0!==this.geometry){l.geometry=m(n.geometries,this.geometry);var c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){var u=c.shapes;if(Array.isArray(u))for(var h=0,f=u.length;h<f;h++){var d=u[h];m(n.shapes,d)}else m(n.shapes,u)}}if(void 0!==this.material)if(this.material instanceof t.Material)l.material=m(n.materials,this.material);else if(this.material instanceof Array){var p=[];for(h=0;h<this.material.length;h++)p.push(m(n.materials,this.material[h]));l.material=p}if(void 0!==this.animations&&this.animations.length>0){l.animations=[];for(h=0;h<this.animations.length;h++)l.animations.push(t.AnimationClip.toJSON(this.animations[h]))}if(void 0!==r&&r(n,l),!1!==o&&this.children.length>0){l.children=[];for(h=0;h<this.children.length;h++)this.children[h].locked||l.children.push(this.children[h].toJSON(n).object)}return a&&(s.geometries=g(n.geometries),s.materials=g(n.materials),s.textures=g(n.textures),s.images=g(n.images),s.videos=g(n.videos),s.audio=g(n.audio),s.fonts=g(n.fonts),s.skeletons=g(n.skeletons),s.resources=g(n.resources),s.shapes=g(n.shapes)),s.object=l,s;function m(t,e){return void 0===t[e.uuid]&&(t[e.uuid]=e.toJSON(n)),e.uuid}function g(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}}}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(99),o=n(12).Entity,a=n(12).registerEntity;function s(e,n,a,s,l,c){var u=o.call(this,e);this.className="GroundEntity",this.name=n||"Ground",this.type="Ground";var h=new t.MeshStandardMaterial({color:16777215,roughness:.6,metalness:.2});h.name="default";s=s||10,l=l||.5,c=c||10;var f=new i.default(this,e,new t.BoxBufferGeometry(s,l,c),h);f.position.set(0,-l/2,0),u.addComponent(f),this.object3D=f.object3D;var d=a.materials.ground,p=new r.default(a,d);return p.body.type=CANNON.Body.STATIC,u.addComponent(p),u}s.prototype=Object.create(o.prototype),s.prototype.init=function(){return o.prototype.init.call(this),this},s.prototype.getGround=function(){return this.object3D},e.default=a("GroundEntity",s)}.call(this,n(0))},function(t,e,n){"use strict";var i=n(53),r=n(88),o=n(108);function a(t,e,n){i.a.call(this),this.originalObject=t,this.newObject=e,this.parent=this.originalObject.parent,this.index=-1,this.moveChildren=void 0===n||n}a.prototype.apply=function(){if(this.index=this.parent.children.indexOf(this.originalObject),this.parent.remove(this.originalObject),this.newObject.parent=this.parent,this.parent.children.splice(this.index,0,this.newObject),this.moveChildren)for(;this.originalObject.children.length>0;){var t=this.originalObject.children[0];this.originalObject.remove(t),this.newObject.add(t)}o.a.updateInterface(this.originalObject,this.parent),r.a.updateInterface(this.newObject,this.parent,this.index)},a.prototype.revert=function(){if(this.parent.remove(this.newObject),this.originalObject.parent=this.parent,this.parent.children.splice(this.index,0,this.originalObject),this.moveChildren)for(;this.newObject.children.length>0;){var t=this.newObject.children[0];this.newObject.remove(t),this.originalObject.add(t)}o.a.updateInterface(this.newObject,this.parent),r.a.updateInterface(this.originalObject,this.parent,this.index)}},function(t,e,n){"use strict";n.r(e),function(t){n(140),n(87),n(80),n(98);var i=n(455),r=n(5).Component,o=n(5).registerComponent;function a(t,e){var n=r.call(this,t,e);return this.name="glass",this.type="Glass",this.glass=null,this.scene=null,this.camera=null,this.composer=null,this.glassPass=null,this.oldMaterial=null,this.params={refractionIndex:2.42,dispersion:.044,roughness:.98},n}a.prototype=Object.create(r.prototype),a.prototype.init=function(){if(!(this.entity.object3D instanceof t.Mesh))return TDS_RT.alert("Glass can only be applied to meshes"),null;var e=this.scene=TDS_RT.program.getScene(this.entity);if(!e)return this;var n=this.camera=e.camera;e.root.renderer;return n?(this.composer=n.composer,this.oldMaterial=this.entity.material,this.glassPass||(this.glassPass=new i.a(this.entity,this.params.refractionIndex,this.params.dispersion,this.params.roughness),this.composer.addPass(this.glassPass)),this):this},a.prototype.update=function(t){},a.prototype.dispose=function(){if(this.composer){var t=this.composer.passes,e=t.indexOf(this.glassPass);e>-1&&t.splice(e,1)}this.glassPass=null,this.oldMaterial&&(this.entity.material=this.oldMaterial)},a.prototype.destroy=function(){this.dispose()},a.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return t.properties={params:{refractionIndex:this.params.refractionIndex,dispersion:this.params.dispersion,roughness:this.params.roughness}},this.entity.material=this.oldMaterial,t},a.prototype.fromJSON=function(t,e){var n=r.prototype.fromJSON.call(t,e);return this.params=n.properties.params,n},e.default=o("glass",a)}.call(this,n(0))},function(t,e,n){"use strict";n(23)},function(t,e,n){var i=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";n=t}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),e(++n%r.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=t(new i.Panel("FPS","#fff","#222")),c=t(new i.Panel("MS","#fff","#222"));if(self.performance&&self.performance.memory)var u=t(new i.Panel("MB","#fff","#222"));return e(0),{REVISION:17,dom:r,addPanel:t,showPanel:e,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(c.update(t-o,200),t>a+1e3&&(l.update(1e3*s/(t-a),100),a=t,s=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:r,setMode:e}};i.Panel=function(t,e,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,f=15*a,d=74*a,p=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=e,g.fillText(t,c,u),g.fillRect(h,f,d,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,f,d,p),{dom:m,update:function(l,v){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,f),g.fillStyle=e,g.fillText(o(l)+" "+t+" ("+o(i)+"-"+o(r)+")",c,u),g.drawImage(m,h+a,f,d-a,p,h,f,d-a,p),g.fillRect(h+d-a,f,a,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-a,f,a,o((1-l/v)*p))}}},t.exports=i},function(t,e,n){"use strict";n.r(e),function(t){var i=n(4),r=n(26);const o=Object.assign({},n(488),n(536));var a=n(5).Component,s=n(5).registerComponent;function l(e,n,r,o){var s=a.call(this,e,n);return this.name="annotation-with-connector",this.type="AnnotationSVG",this.camera=null,this.canvas=null,this.sprite=null,this.anno=null,this.annoRunning=null,this.needsUpdate=!1,this.visible=!0,this.isReplicable=!1,this.uuid=t.MathUtils.generateUUID(),this.cont=null,this.anno=null,this.annoRunning=null,this.annotationsData={startColor:"#999",stopColor:"#eee",titleSize:16,labelSize:13,note:{label:o||i.default.locale.putLabelHere,title:r||i.default.locale.putTitleHere},x:0,y:0,dy:100,dx:120,subject:{radius:50,radiusPadding:10},connector:{end:"dot"}},this.makeAnnotations=null,s}l.prototype=Object.create(a.prototype),l.prototype.init=function(){if("Scene"===this.entity.type||"Sky"===this.entity.type)return i.default.alert("Invalid entity type for annotation."),null;if(!this.entity.hasComponent("Mesh")&&!this.entity.object3D instanceof t.Group)return i.default.alert("Annotation can only be applied to a mesh or a group."),null;var e=i.default.program.getActiveScene();return this.camera=i.default.program.getActiveCamera(e),this.canvas=i.default.program.getActiveCanvas(e),this},l.prototype.lazyLoad=function(t,e){e||(e=this.canvas),e&&(this.createAnno(e),levent.bind(i.default,"canvas_destroyed",this.destroy,this))},l.prototype.getAnno=function(){return i.default.program.isInRunner()?this.annoRunning:this.anno},l.prototype.setAnno=function(t){i.default.program.mode===r.a.MODE_RUNNING?this.annoRunning=t:this.anno=t},l.prototype.getAnnoGradientId=function(){var t="annoGradient-"+this.uuid;return i.default.program.mode===r.a.MODE_RUNNING&&(t+="running"),t},l.prototype.createAnnotations=function(){var t=[],e=this.annotationsData;return e.color="url(#"+this.getAnnoGradientId()+")",t.push(e),t},l.prototype.createAnno=function(t){var e=this,n=t?t.parentElement:null;if(!n)return;const r="http://www.w3.org/2000/svg";var a=document.createElementNS(r,"svg");a.style.position="absolute",a.style.pointerEvents="none",a.setAttribute("width","100%"),a.setAttribute("height","100%");var s=document.createElementNS(r,"defs"),l=document.createElementNS(r,"linearGradient"),c=this.getAnnoGradientId();l.setAttribute("id",c),l.setAttribute("x1","0%"),l.setAttribute("x2","100%"),l.setAttribute("y1","0%"),l.setAttribute("y2","0%");var u=document.createElementNS(r,"stop");u.setAttribute("class","annoStop1"),u.setAttribute("offset","0%"),u.setAttribute("style","stop-color: "+this.annotationsData.startColor+";"),l.appendChild(u);var h=document.createElementNS(r,"stop");h.setAttribute("class","annoStop2"),h.setAttribute("offset","100%"),h.setAttribute("style","stop-color: "+this.annotationsData.stopColor+";"),l.appendChild(h),s.appendChild(l),a.appendChild(s),n.appendChild(a);const f=o.annotationCalloutElbow,d=this.createAnnotations();return this.makeAnnotations=o.annotation(a).editMode(!0).notePadding(15).textWrap(120).type(f).annotations(d).on("dragend",(function(t){e.annotationsData.x=t.x,e.annotationsData.y=t.y,e.annotationsData.dx=t.dx,e.annotationsData.dy=t.dy})).on("textclick",(function(t){var n=this;o.select("g.annotation-note").on("mousedown.drag",null);var i=this.node().getBBox(),r="";o.select(this.node()).selectChildren().each((function(t){r+=this.textContent+"\n"})),r=function(t,e){for(;t.charAt(0)==e;)t=t.substring(1);for(;t.charAt(t.length-1)==e;)t=t.substring(0,t.length-1);return t}(r,"\n"),o.select(this.node().parentNode).append("foreignObject").attr("x",i.x).attr("y",i.y).attr("width",2*i.width).attr("height",2*i.height).append("xhtml:div").attr("class","annoInlineEdit").attr("contenteditable",!0).text(r).on("keydown",(function(t,e){})).on("keyup",(function(t,e){27===t.keyCode&&this.blur()})).on("focusout",(function(t,i){this.parentNode.remove();var o=n.node().getAttribute("class");r=this.innerHTML.replace(/\<div\>/g,"\n").replace(/\<\/div\>/g,""),"annotation-note-title"===o&&(e.annotationsData.note.title=r),"annotation-note-label"===o&&(e.annotationsData.note.label=r),n.node().setAttribute("visibility","visible"),e.updateAnno()})).node().focus(),this.node().setAttribute("visibility","hidden")})),o.select(a).append("g").attr("class","annotation-group").call(this.makeAnnotations),this.setAnno(a),this.update(),levent.bind(i.default,"orbit_controls_updated",(function(t,n){e.controlsUpdated(n)})),levent.bind(i.default,"object_transformed",(function(t,n){e.objectUpdated(n)})),levent.bind(i.default,"scene_deactivated",(function(t,e){})),levent.bind(i.default,"scene_activated",(function(t,e){})),a},l.prototype.updateAnno=function(){this.update();const t=this.createAnnotations();this.makeAnnotations.annotations(t).updateText()},l.prototype.updateStyles=function(){var t=this.getAnno();t&&(o.select(t).select(".annoStop1").node().setAttribute("style","stop-color: "+this.annotationsData.startColor),o.select(t).select(".annoStop2").node().setAttribute("style","stop-color: "+this.annotationsData.stopColor),o.select(t).select(".annotation-note-title tspan").node().setAttribute("font-size",this.annotationsData.titleSize),o.select(t).select(".annotation-note-label tspan").node().setAttribute("font-size",this.annotationsData.labelSize))},l.prototype.updatePosition=function(){var e=this.getAnno();if(e){var n=new t.Vector3;this.entity.updateMatrixWorld(!0,!1),this.entity.getWorldPosition(n),n.project(this.camera),n.x=(.5+n.x/2)*(this.canvas.width/i.default.getDPI()),n.y=(.5-n.y/2)*(this.canvas.height/i.default.getDPI());var r="translate("+n.x+", "+n.y+")";o.select(e).select(".annotation-group").attr("transform",r)}},l.prototype.play=function(){},l.prototype.resize=function(t,e){t*e>0&&(this.update(),this.makeAnnotations.updateText())},l.prototype.update=function(t){var e=this.getAnno();if(e){var n=i.default.program.getActiveScene();this.camera=i.default.program.getActiveCamera(n),this.canvas=i.default.program.getActiveCanvas(n),this.camera&&(this.visible=this.entity.visible,this.visible?(e.style.display="block",this.updatePosition(),this.updateStyles()):e.style.display="none")}},l.prototype.controlsUpdated=function(t){t.controls;this.update()},l.prototype.objectUpdated=function(t){t.controls;this.update()},l.prototype.dispose=function(){this.annoRunning&&this.annoRunning.parentElement&&this.annoRunning.parentElement.removeChild(this.annoRunning),this.annoRunning=null},l.prototype.destroy=function(){this.anno&&this.anno.parentElement.removeChild(this.anno),this.annoRunning&&this.annoRunning.parentElement.removeChild(this.annoRunning),this.anno=this.annoRunning=null},l.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.annoData=JSON.stringify(this.annotationsData),t},l.prototype.fromJSON=function(t,e){return a.prototype.fromJSON.call(this,t,e),t.annoData&&(this.annotationsData=JSON.parse(t.annoData)),this},e.default=s("annotation-with-connector",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(3),r=n(17),o=(n(58),n(100)),a=n(12).Entity,s=n(12).registerEntity;function l(t,e){var n=o.default.call(this,t,e);return this.name=e||"Board",this.className="BoardEntity",this.type="Board",this.isWhiteBoard=!0,this.boardImageUrl="",t||this.createObject3D(),n}l.prototype=Object.create(o.default.prototype),l.prototype.createObject3D=function(){var e=new r.a(i.a.getImg("WhiteBoard")),n=new t.PlaneBufferGeometry(10,10),o=new t.MeshBasicMaterial({visible:!0,color:16777215,transparent:!0,opacity:.8,map:e});this.object3D=new t.Mesh(n,o)},l.prototype.init=function(){return o.default.prototype.init.call(this),this},l.prototype.getMesh=function(){return this.object3D},l.prototype.toJSON=function(){return a.prototype.toJSON.call(this)},e.default=s("BoardEntity",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(20),r=n(12).Entity,o=n(12).registerEntity;function a(e,n,o){var a=r.call(this,e);this.className="PointEntity",this.name=name||"Points",this.type="Points",this.color=16777215|n,this.size=1|o;let s=document.createElement("canvas");s.width=100,s.height=100;let l=s.getContext("2d");l.fillStyle="#ffff00",l.arc(50,50,45,0,2*Math.PI),l.fill();let c=new t.Texture(s);c.needsUpdate=!0;let u=new t.PointsMaterial({transparent:!0,color:this.color,size:this.size,map:c}),h=new t.Geometry;h.vertices.push(new t.Vector3(0,0,0));let f=new t.Points(h,u);var d=new i.default(this,f);return a.addComponent(d),this.object3D=d.object3D,a}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getPoint=function(){return this.object3D},e.default=o("PointEntity",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(195),r=n(12).Entity,o=n(12).registerEntity;function a(t,e,n,o){var a=r.call(this,t);this.className="WaterEntity",this.name=e||"Water",this.type="Water";n=n||10,o=o||10;var s=new i.default(this,t,n,o);return a.addComponent(s),this.object3D=s.object3D,this.object3D.rotation.x=-.5*Math.PI,a}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},e.default=o("WaterEntity",a)},function(t,e,n){t.exports=n.p+"assets/about.png"},function(t,e,n){t.exports=n.p+"assets/new.png"},function(t,e,n){t.exports=n.p+"assets/save.png"},function(t,e,n){t.exports=n.p+"assets/publish.png"},function(t,e,n){t.exports=n.p+"assets/load.png"},function(t,e,n){t.exports=n.p+"assets/settings.png"},function(t,e,n){t.exports=n.p+"assets/web.png"},function(t,e,n){t.exports=n.p+"assets/import.png"},function(t,e,n){t.exports=n.p+"assets/export.png"},function(t,e,n){t.exports=n.p+"assets/undo.png"},function(t,e,n){t.exports=n.p+"assets/redo.png"},function(t,e,n){t.exports=n.p+"assets/copy.png"},function(t,e,n){t.exports=n.p+"assets/paste.png"},function(t,e,n){t.exports=n.p+"assets/delete.png"},function(t,e,n){t.exports=n.p+"assets/cut.png"},function(t,e,n){t.exports=n.p+"assets/add.png"},function(t,e,n){t.exports=n.p+"assets/intersect.png"},function(t,e,n){t.exports=n.p+"assets/subtract.png"},function(t,e,n){t.exports=n.p+"assets/union.png"},function(t,e,n){t.exports=n.p+"assets/figures.png"},function(t,e,n){t.exports=n.p+"assets/move.png"},function(t,e,n){t.exports=n.p+"assets/gltf.png"},function(t,e,n){t.exports=n.p+"assets/question.png"},function(t,e,n){t.exports=n.p+"assets/padlock.png"},function(t,e,n){t.exports=n.p+"assets/kinect.png"},function(t,e,n){t.exports=n.p+"assets/leap.png"},function(t,e,n){t.exports=n.p+"assets/sky.png"},function(t,e,n){t.exports=n.p+"assets/spot.png"},function(t,e,n){t.exports=n.p+"assets/point.png"},function(t,e,n){t.exports=n.p+"assets/hemisphere.png"},function(t,e,n){t.exports=n.p+"assets/directional.png"},function(t,e,n){t.exports=n.p+"assets/ambient.png"},function(t,e,n){t.exports=n.p+"assets/rectarea.png"},function(t,e,n){t.exports=n.p+"assets/perspective.png"},function(t,e,n){t.exports=n.p+"assets/orthographic.png"},function(t,e,n){t.exports=n.p+"assets/spine.png"},function(t,e,n){t.exports=n.p+"assets/skeleton.png"},function(t,e,n){t.exports=n.p+"assets/particles.png"},function(t,e,n){t.exports=n.p+"assets/particle.png"},function(t,e,n){t.exports=n.p+"assets/audio.png"},function(t,e,n){t.exports=n.p+"assets/nodes.png"},function(t,e,n){t.exports=n.p+"assets/audio_positional.png"},function(t,e,n){t.exports=n.p+"assets/bone.png"},function(t,e,n){t.exports=n.p+"assets/orbit.png"},function(t,e,n){t.exports=n.p+"assets/crosshair.png"},function(t,e,n){t.exports=n.p+"assets/physics.png"},function(t,e,n){t.exports=n.p+"assets/flare.png"},function(t,e,n){t.exports=n.p+"assets/search.png"},function(t,e,n){t.exports=n.p+"assets/camera.png"},function(t,e,n){t.exports=n.p+"assets/pointer.png"},function(t,e,n){t.exports=n.p+"assets/arrow_right.png"},function(t,e,n){t.exports=n.p+"assets/arrow_left.png"},function(t,e,n){t.exports=n.p+"assets/arrow_down.png"},function(t,e,n){t.exports=n.p+"assets/check.png"},function(t,e,n){t.exports=n.p+"assets/alpha.png"},function(t,e,n){t.exports=n.p+"assets/icon.png"},function(t,e,n){t.exports=n.p+"assets/pause.png"},function(t,e,n){t.exports=n.p+"assets/play.png"},function(t,e,n){t.exports=n.p+"assets/close.png"},function(t,e,n){t.exports=n.p+"assets/logo.png"},function(t,e,n){t.exports=n.p+"assets/fullscreen.png"},function(t,e,n){t.exports=n.p+"assets/sphere.png"},function(t,e,n){t.exports=n.p+"assets/plane.png"},function(t,e,n){t.exports=n.p+"assets/select.png"},function(t,e,n){t.exports=n.p+"assets/resize.png"},function(t,e,n){t.exports=n.p+"assets/rotate.png"},function(t,e,n){t.exports=n.p+"assets/font.png"},function(t,e,n){t.exports=n.p+"assets/file.png"},function(t,e,n){t.exports=n.p+"assets/video.png"},function(t,e,n){t.exports=n.p+"assets/grid.png"},function(t,e,n){t.exports=n.p+"assets/canvas.png"},function(t,e,n){t.exports=n.p+"assets/material.png"},function(t,e,n){t.exports=n.p+"assets/webcam.png"},function(t,e,n){t.exports=n.p+"assets/menu.png"},function(t,e,n){t.exports=n.p+"assets/magnifier.png"},function(t,e,n){t.exports=n.p+"assets/tree.png"},function(t,e,n){t.exports=n.p+"assets/assets.png"},function(t,e,n){t.exports=n.p+"assets/edit.png"},function(t,e,n){t.exports=n.p+"assets/stop.png"},function(t,e,n){t.exports=n.p+"assets/create.png"},function(t,e,n){t.exports=n.p+"assets/loading.png"},function(t,e,n){t.exports=n.p+"assets/entity.png"},function(t,e,n){t.exports=n.p+"assets/empty.png"},function(t,e,n){t.exports=n.p+"assets/ground.png"},function(t,e,n){t.exports=n.p+"assets/annotation.png"},function(t,e,n){t.exports=n.p+"assets/model.png"},function(t,e,n){t.exports=n.p+"assets/fbx.png"},function(t,e,n){t.exports=n.p+"assets/misc.png"},function(t,e,n){t.exports=n.p+"assets/water.png"},function(t,e,n){t.exports=n.p+"assets/robot.png"},function(t,e,n){t.exports=n.p+"assets/pool.png"},function(t,e,n){t.exports=n.p+"assets/terrain.png"},function(t,e,n){t.exports=n.p+"assets/tool.png"},function(t,e,n){t.exports=n.p+"assets/sculpt.png"},function(t,e,n){t.exports=n.p+"assets/target.png"},function(t,e,n){t.exports=n.p+"assets/brush.png"},function(t,e,n){t.exports=n.p+"assets/lineloop.png"},function(t,e,n){t.exports=n.p+"assets/circle.png"},function(t,e,n){t.exports=n.p+"assets/spline.png"},function(t,e,n){t.exports=n.p+"assets/pen.png"},function(t,e,n){t.exports=n.p+"assets/fat_line.png"},function(t,e,n){t.exports=n.p+"assets/line-dashed.png"},function(t,e,n){t.exports=n.p+"assets/grid-hide.png"},function(t,e,n){t.exports=n.p+"assets/eraser.png"},function(t,e,n){t.exports=n.p+"assets/clean.png"},function(t,e,n){t.exports=n.p+"assets/world.png"},function(t,e,n){t.exports=n.p+"assets/local.png"},function(t,e,n){t.exports=n.p+"assets/board.png"},function(t,e,n){t.exports=n.p+"assets/text.png"},function(t,e,n){t.exports=n.p+"assets/text-image.png"},function(t,e,n){t.exports=n.p+"assets/extruder.png"},function(t,e,n){t.exports=n.p+"assets/annotation2.png"},function(t,e,n){t.exports=n.p+"assets/code.png"},function(t,e,n){t.exports=n.p+"assets/slider.png"},function(t,e,n){t.exports=n.p+"assets/image-slider.png"},function(t,e,n){t.exports=n.p+"assets/particle-slider.png"},function(t,e,n){t.exports=n.p+"assets/doorfx.basis"},function(t,e,n){t.exports=n.p+"assets/xPos.png"},function(t,e,n){t.exports=n.p+"assets/xNeg.png"},function(t,e,n){t.exports=n.p+"assets/yPos.png"},function(t,e,n){t.exports=n.p+"assets/yNeg.png"},function(t,e,n){t.exports=n.p+"assets/zPos.png"},function(t,e,n){t.exports=n.p+"assets/zNeg.png"},function(t,e,n){t.exports=n.p+"assets/link.png"},function(t,e,n){t.exports=n.p+"assets/sticky-note.png"},function(t,e,n){t.exports=n.p+"assets/running.png"},function(t,e,n){t.exports=n.p+"assets/standing.png"},function(t,e,n){t.exports=n.p+"assets/splitter.png"},function(t,e,n){t.exports=n.p+"assets/particle1.png"},function(t,e,n){t.exports=n.p+"assets/flame.png"},function(t,e,n){t.exports=n.p+"assets/leaves.png"},function(t,e,n){t.exports=n.p+"assets/drop_solid.png"},function(t,e,n){t.exports=n.p+"assets/drop.png"},function(t,e,n){t.exports=n.p+"assets/snow_l.png"},function(t,e,n){t.exports=n.p+"assets/fountain.png"},function(t,e,n){t.exports=n.p+"assets/fireworks.png"},function(t,e,n){t.exports=n.p+"assets/inspector.png"},function(t,e,n){t.exports=n.p+"assets/brush3.png"},function(t,e,n){t.exports=n.p+"assets/transparent.png"},function(t,e,n){t.exports=n.p+"assets/plus.png"},function(t,e,n){t.exports=n.p+"assets/template.png"},function(t,e,n){t.exports=n.p+"assets/sort.png"},function(t,e,n){t.exports=n.p+"assets/polygon.png"},function(t,e,n){t.exports=n.p+"assets/pipeline.png"},function(t,e,n){t.exports=n.p+"assets/connector.png"},function(t,e,n){t.exports=n.p+"assets/snap.png"},function(t,e,n){t.exports=n.p+"assets/unsnap.png"},function(t,e,n){t.exports=n.p+"assets/subdivide.png"},function(t,e,n){t.exports=n.p+"assets/simplify.png"},function(t,e,n){t.exports=n.p+"assets/flare0.png"},function(t,e,n){t.exports=n.p+"assets/flare1.png"},function(t,e,n){t.exports=n.p+"assets/flare2.png"},function(t,e,n){t.exports=n.p+"assets/flare3.png"},function(t,e,n){t.exports=n.p+"assets/Water_1_M_Normal.jpg"},function(t,e,n){t.exports=n.p+"assets/Water_2_M_Normal.jpg"},function(t,e,n){t.exports=n.p+"assets/Water_1_M_Flow.jpg"},function(t,e,n){t.exports=n.p+"assets/Water_2_M_Flow.jpg"},function(t,e,n){t.exports=n.p+"assets/Water_3_M_Flow.jpg"},function(t,e,n){t.exports=n.p+"assets/Water_7_M_Flow.jpg"},function(t,e,n){t.exports=n.p+"assets/pano1.jpg"},function(t,e,n){t.exports=n.p+"assets/pano2.jpg"},function(t,e,n){t.exports=n.p+"assets/cloud1.png"},function(t,e,n){t.exports=n.p+"assets/cloud2.png"},function(t,e,n){t.exports=n.p+"assets/dark-cloud.png"},function(t,e,n){t.exports=n.p+"assets/cm_viridis.png"},function(t,e,n){t.exports=n.p+"assets/cm_gray.png"},function(t,e,n){t.exports=n.p+"assets/noise.jpg"},function(t,e,n){t.exports=n.p+"assets/tile0.jpg"},function(t,e,n){t.exports=n.p+"assets/tile1.jpg"},function(t,e,n){t.exports=n.p+"assets/posx.jpg"},function(t,e,n){t.exports=n.p+"assets/posy.jpg"},function(t,e,n){t.exports=n.p+"assets/posz.jpg"},function(t,e,n){t.exports=n.p+"assets/negx.jpg"},function(t,e,n){t.exports=n.p+"assets/negy.jpg"},function(t,e,n){t.exports=n.p+"assets/negz.jpg"},function(t,e,n){t.exports=n.p+"assets/terrain.jpg"},function(t,e,n){t.exports=n.p+"assets/terrainBg.jpg"},function(t,e,n){t.exports=n.p+"assets/terrainNormal.jpg"},function(t,e,n){t.exports=n.p+"assets/whiteboard.png"},function(t,e,n){t.exports=n.p+"assets/stroke.png"},function(t,e,n){t.exports=n.p+"assets/noise.png"},function(t,e,n){t.exports=n.p+"assets/1.jpg"},function(t,e,n){t.exports=n.p+"assets/2.jpg"},function(t,e,n){t.exports=n.p+"assets/3.jpg"},function(t,e,n){t.exports=n.p+"assets/4.jpg"},function(t,e,n){t.exports=n.p+"assets/5.jpg"},function(t,e,n){t.exports=n.p+"assets/6.jpg"},function(t,e,n){t.exports=n.p+"assets/jade.jpg"},function(t){t.exports=JSON.parse('{"glyphs":{"0":{"x_min":34,"x_max":709,"ha":749,"o":"m 367 -19 q 104 104 175 -19 q 34 436 34 228 q 109 777 34 644 q 377 910 184 910 q 640 785 572 910 q 709 443 709 660 q 635 108 709 236 q 367 -19 561 -19 m 260 447 q 261 330 260 382 q 269 213 262 279 q 296 101 276 147 q 374 56 316 56 q 453 108 430 56 q 477 221 477 160 q 480 287 478 254 q 483 458 483 365 q 480 590 483 543 q 477 665 478 637 q 452 779 477 727 q 372 832 428 832 q 281 765 299 832 q 263 598 263 698 q 261 505 263 561 q 260 447 260 448 "},"1":{"x_min":55,"x_max":502,"ha":749,"o":"m 276 616 q 273 680 276 637 q 271 747 271 723 q 197 713 223 726 q 112 666 172 700 l 55 754 q 471 940 291 848 l 498 927 l 492 454 l 493 465 l 493 202 l 493 216 q 497 102 493 178 q 502 0 502 26 l 383 6 q 314 3 362 6 q 264 0 266 0 q 270 359 264 127 q 276 616 276 591 "},"2":{"x_min":33,"x_max":706.625,"ha":749,"o":"m 33 75 q 236 249 152 168 q 379 431 321 330 q 438 652 438 533 q 413 772 438 723 q 325 822 389 822 q 220 767 251 822 q 170 616 189 712 l 155 616 q 44 743 107 691 q 189 867 105 823 q 373 911 273 911 q 586 847 500 911 q 673 658 673 783 q 619 480 673 548 q 304 196 566 411 l 430 195 l 553 195 l 706 201 q 689 94 689 148 q 696 38 689 66 q 706 0 703 11 q 514 3 630 0 q 380 7 399 7 q 181 3 302 7 q 44 0 60 0 l 33 75 "},"3":{"x_min":30,"x_max":680,"ha":749,"o":"m 365 908 q 561 853 479 908 q 643 691 643 799 q 593 565 643 612 q 457 485 544 517 l 457 476 q 617 410 555 463 q 680 260 680 356 q 573 50 680 122 q 318 -21 466 -21 q 30 58 155 -21 q 90 161 67 120 q 137 250 113 202 l 154 250 q 185 109 154 167 q 292 51 216 51 q 404 109 367 51 q 442 245 442 167 q 397 376 442 327 q 271 425 353 425 l 231 425 l 231 505 l 268 504 q 392 549 345 504 q 439 670 439 594 q 408 785 439 738 q 313 833 377 833 q 213 776 244 833 q 183 644 183 719 l 170 634 q 121 690 145 665 q 43 767 97 716 q 179 874 94 840 q 365 908 265 908 "},"4":{"x_min":43,"x_max":708.265625,"ha":749,"o":"m 706 383 l 701 299 q 704 248 701 271 q 708 211 706 225 q 592 221 650 221 l 592 176 q 594 83 592 127 q 606 0 597 40 q 540 3 579 0 q 497 6 501 6 q 433 3 473 6 q 384 0 393 0 q 393 104 390 44 q 396 219 396 165 l 309 221 q 169 216 262 221 q 43 212 76 212 l 44 296 l 44 379 q 174 568 113 477 q 287 738 235 658 q 396 909 338 818 q 503 902 444 902 q 553 902 527 902 q 606 909 589 907 q 599 720 606 843 q 592 534 592 596 l 592 370 q 650 375 614 370 q 706 383 686 380 m 396 370 l 396 752 l 141 370 l 396 370 "},"5":{"x_min":46,"x_max":670,"ha":749,"o":"m 284 60 q 397 118 360 60 q 434 258 434 176 q 404 391 434 333 q 307 450 375 450 q 183 388 238 450 l 118 422 q 128 525 126 467 q 131 606 131 583 q 126 749 131 684 q 108 878 121 814 l 118 888 q 268 883 173 888 q 387 878 362 878 q 635 888 519 878 l 630 793 q 636 696 630 739 q 479 702 579 696 q 365 709 378 709 l 225 709 q 213 501 213 608 q 399 548 301 548 q 591 480 513 548 q 670 300 670 413 q 559 59 670 139 q 280 -21 449 -21 q 156 -7 222 -21 q 46 32 90 5 q 94 133 74 84 q 131 238 115 182 l 152 237 q 180 109 152 158 q 284 60 208 60 "},"6":{"x_min":40,"x_max":716,"ha":749,"o":"m 463 545 q 646 475 576 545 q 716 293 716 405 q 628 65 716 150 q 398 -19 541 -19 q 133 84 226 -19 q 40 362 40 187 q 160 750 40 590 q 501 911 280 911 q 582 903 544 911 q 670 879 620 895 q 658 812 663 845 q 652 748 652 779 l 643 747 q 579 804 612 784 q 502 825 546 825 q 330 716 383 825 q 278 475 278 608 q 359 528 309 511 q 463 545 409 545 m 383 449 q 297 393 317 449 q 278 257 278 337 q 296 113 278 174 q 381 52 315 52 q 469 110 449 52 q 490 256 490 169 q 469 393 490 337 q 383 449 449 449 "},"7":{"x_min":96,"x_max":760,"ha":749,"o":"m 333 343 l 549 689 q 439 693 511 689 q 329 697 366 697 q 221 694 272 697 q 98 689 171 691 q 105 755 104 734 q 105 787 105 775 q 102 844 105 808 q 98 888 98 881 l 401 883 l 741 887 l 760 849 q 312 0 491 452 l 216 0 l 105 0 l 96 18 q 229 187 177 119 q 333 343 280 255 "},"8":{"x_min":34,"x_max":710,"ha":749,"o":"m 511 492 q 654 412 598 471 q 710 266 710 352 q 607 53 710 128 q 360 -21 504 -21 q 131 50 229 -21 q 34 248 34 122 q 88 406 34 341 q 235 492 143 471 l 235 502 q 117 568 164 516 q 71 689 71 620 q 165 855 71 802 q 382 908 259 908 q 584 857 498 908 q 671 696 671 806 q 628 574 671 621 q 511 502 586 526 l 511 492 m 373 528 q 456 573 432 528 q 481 684 481 618 q 458 792 481 748 q 376 836 435 836 q 290 791 316 836 q 264 683 264 747 q 291 575 264 622 q 373 528 318 528 m 369 55 q 464 117 439 55 q 489 259 489 180 q 465 396 489 335 q 379 457 441 457 q 285 393 314 457 q 256 256 256 329 q 278 114 256 174 q 369 55 301 55 "},"9":{"x_min":30,"x_max":705,"ha":749,"o":"m 281 343 q 98 414 167 343 q 30 601 30 486 q 121 827 30 744 q 359 911 213 911 q 618 801 532 911 q 705 515 705 692 q 583 135 705 291 q 243 -21 461 -21 q 158 -12 193 -21 q 74 9 123 -4 q 87 74 82 42 q 92 140 92 106 l 102 143 q 163 84 127 105 q 243 64 199 64 q 414 172 362 64 q 467 414 467 280 q 386 359 435 376 q 281 343 337 343 m 360 440 q 446 495 426 440 q 467 630 467 551 q 447 775 467 714 q 361 837 427 837 q 274 778 293 837 q 256 631 256 720 q 276 496 256 553 q 360 440 296 440 "},"ο":{"x_min":30,"x_max":741,"ha":774,"o":"m 395 683 q 645 587 550 683 q 741 337 741 492 q 646 79 741 173 q 385 -15 552 -15 q 127 78 225 -15 q 30 333 30 172 q 129 590 30 498 q 395 683 228 683 m 269 174 q 305 85 275 119 q 386 52 335 52 q 464 85 436 52 q 503 172 491 119 q 510 237 506 194 q 515 336 515 279 q 510 431 515 391 q 503 494 506 472 q 464 581 491 548 q 385 615 436 615 q 291 563 315 615 q 261 459 267 512 q 256 333 256 407 q 269 174 256 248 "},"S":{"x_min":55,"x_max":687,"ha":742,"o":"m 95 251 l 116 251 q 188 116 145 158 q 322 75 231 75 q 438 113 385 75 q 491 211 491 151 q 382 350 491 294 q 168 461 273 407 q 55 664 55 539 q 159 875 55 801 q 409 949 264 949 q 653 891 535 949 q 622 805 635 848 q 598 712 609 762 l 583 712 q 509 818 559 779 q 391 857 459 857 q 283 827 328 857 q 238 738 238 797 q 349 609 238 666 q 570 497 461 551 q 687 295 687 416 q 570 62 687 143 q 292 -18 453 -18 q 171 -8 229 -18 q 55 26 113 1 q 72 116 64 68 q 95 251 80 165 "},"/":{"x_min":-32.953125,"x_max":420,"ha":383,"o":"m 339 1023 l 420 1024 l 47 -126 l -32 -126 l 339 1023 "},"Τ":{"x_min":8,"x_max":738,"ha":749,"o":"m 493 818 q 490 723 493 790 q 487 652 487 656 q 490 427 487 529 q 498 201 494 326 q 503 0 503 77 q 438 2 482 0 q 374 5 395 5 q 317 3 351 5 q 244 0 284 1 q 252 266 244 88 q 261 476 261 444 q 258 670 261 533 q 255 818 255 808 q 158 815 188 818 q 8 801 128 813 l 12 872 l 8 932 q 198 927 70 932 q 373 922 327 922 q 572 927 445 922 q 738 932 700 932 l 733 870 l 738 801 q 493 818 614 818 "},"ϕ":{"x_min":32,"x_max":997,"ha":1028,"o":"m 418 -6 q 146 79 261 -6 q 32 322 32 165 q 143 560 32 474 q 418 664 254 646 q 411 819 418 715 q 404 978 404 923 q 483 970 445 970 q 622 977 556 970 q 616 829 622 938 q 611 664 611 719 q 882 573 768 664 q 997 328 997 483 q 886 90 997 171 q 611 -6 776 9 q 616 -197 611 -68 q 622 -374 622 -326 l 544 -365 q 471 -366 503 -365 q 404 -373 438 -368 q 411 -183 404 -315 q 418 -6 418 -51 m 611 328 l 611 61 q 742 147 704 72 q 780 328 780 222 q 741 510 780 433 q 612 601 703 588 l 611 328 m 418 601 q 287 510 326 588 q 249 328 249 433 q 286 147 249 223 q 416 61 324 72 l 418 328 l 418 601 "},"y":{"x_min":0,"x_max":669.453125,"ha":653,"o":"m 269 -16 l 76 481 q 37 579 58 529 q 0 667 16 629 q 66 664 22 667 q 134 661 111 661 q 201 664 154 661 q 251 667 248 667 q 308 465 277 561 q 380 256 338 368 l 452 463 q 482 562 462 493 q 512 667 502 631 l 577 661 q 623 664 593 661 q 669 667 654 667 q 438 139 536 375 q 244 -373 341 -97 q 165 -368 206 -368 q 132 -368 145 -368 q 86 -373 119 -368 q 145 -277 119 -323 q 195 -176 170 -230 l 269 -16 "},"≈":{"x_min":118.0625,"x_max":1019.453125,"ha":1139,"o":"m 1019 527 q 894 458 956 483 q 766 433 831 433 q 570 477 698 433 q 373 522 443 522 q 238 489 297 522 q 118 417 179 457 l 118 563 q 254 632 187 607 q 391 658 320 658 q 577 614 450 658 q 761 571 704 571 q 886 596 826 571 q 1019 671 945 622 l 1019 527 m 1019 251 q 892 182 952 207 q 766 158 831 158 q 568 202 697 158 q 373 246 440 246 q 251 219 308 246 q 118 140 194 192 l 118 286 q 252 358 187 331 q 387 385 318 385 q 575 339 447 385 q 761 294 704 294 q 886 321 825 294 q 1019 397 947 348 l 1019 251 "},"Π":{"x_min":91,"x_max":957,"ha":1049,"o":"m 105 284 l 105 461 q 102 651 105 534 q 99 784 99 768 l 91 932 q 210 926 129 932 q 331 921 290 921 l 711 921 q 833 926 751 921 q 957 932 915 932 q 948 692 957 857 q 939 465 939 527 q 942 221 939 315 q 957 0 945 127 l 829 5 q 756 2 808 5 q 698 0 703 0 q 707 63 704 33 q 710 130 710 93 l 713 504 l 710 813 l 515 818 l 336 813 q 333 643 336 762 q 331 516 331 523 l 336 130 q 345 0 336 59 q 278 2 322 0 q 215 5 234 5 l 91 0 q 98 146 91 40 q 105 284 105 252 "},"ΐ":{"x_min":-147,"x_max":552,"ha":396,"o":"m 92 126 l 92 543 l 80 666 q 139 661 105 663 q 197 658 173 658 q 265 660 239 658 q 315 666 292 663 q 305 586 308 616 q 302 523 302 557 l 302 113 q 303 72 302 88 q 315 0 305 56 l 196 4 l 82 0 q 88 67 85 30 q 92 126 92 104 m -65 961 q -7 935 -31 961 q 17 877 17 909 q -8 820 17 844 q -65 797 -33 797 q -121 820 -96 797 q -147 879 -147 844 q -123 935 -147 910 q -65 961 -99 961 m 275 1017 q 316 998 298 1017 q 334 957 334 980 q 321 919 334 935 q 283 886 307 903 l 94 755 l 36 755 l 182 950 q 225 998 204 980 q 275 1017 247 1017 m 470 961 q 528 935 504 961 q 552 877 552 910 q 528 820 552 844 q 471 797 504 797 q 413 820 438 797 q 388 879 388 844 q 412 936 388 912 q 470 961 436 961 "},"g":{"x_min":23,"x_max":714.671875,"ha":700,"o":"m 213 272 q 93 331 142 278 q 45 456 45 384 q 128 623 45 563 q 322 683 211 683 l 382 683 l 534 664 l 606 660 q 666 662 641 660 q 714 666 692 665 l 714 585 l 581 589 q 623 543 610 570 q 637 477 637 515 q 541 300 637 353 q 310 248 446 248 q 258 236 281 248 q 236 199 236 225 q 386 142 236 150 q 623 102 536 134 q 711 -68 711 71 q 591 -296 711 -218 q 313 -374 471 -374 q 111 -326 199 -374 q 23 -175 23 -279 q 63 -64 23 -110 q 171 -7 104 -19 l 171 0 q 103 39 130 7 q 76 112 76 70 q 117 201 76 163 q 213 251 159 239 l 213 272 m 169 -143 q 221 -255 169 -215 q 351 -295 274 -295 q 483 -254 427 -295 q 540 -139 540 -214 q 524 -81 540 -107 q 472 -40 508 -54 q 383 -19 437 -25 q 269 -13 330 -13 l 239 -12 q 169 -143 169 -54 m 332 304 q 411 351 392 304 q 431 472 431 399 q 413 581 431 536 q 341 626 395 626 q 267 578 287 626 q 247 466 247 530 q 262 350 247 396 q 332 304 277 304 "},"²":{"x_min":22,"x_max":465.0625,"ha":494,"o":"m 22 401 q 156 502 102 456 q 248 607 210 548 q 287 742 287 667 q 267 825 287 802 q 216 848 248 848 q 146 816 167 848 q 110 725 126 785 l 102 725 l 30 800 q 245 901 116 901 q 385 864 327 901 q 444 751 444 827 q 411 643 444 681 q 201 471 378 604 l 284 471 q 387 473 314 471 q 465 476 459 476 q 456 413 456 439 q 459 383 456 401 q 465 354 462 365 q 331 356 412 354 q 249 358 251 358 l 27 354 l 22 401 "},"Κ":{"x_min":90,"x_max":892.78125,"ha":856,"o":"m 334 716 l 334 515 l 569 787 q 635 866 619 845 q 682 932 651 886 l 767 926 q 817 929 784 926 q 870 932 851 932 q 687 746 790 851 q 503 554 585 641 l 623 377 q 892 0 753 179 l 753 5 q 664 2 727 5 q 595 0 600 0 q 484 190 545 98 q 334 404 424 281 l 334 193 q 348 0 334 94 q 270 2 325 0 q 212 5 215 5 l 90 0 q 99 236 90 69 q 108 461 108 402 q 103 623 108 515 q 99 787 99 731 l 90 932 q 157 927 113 932 q 219 922 201 922 q 282 925 252 922 q 342 932 312 927 q 338 831 342 907 q 334 716 334 755 "},"ë":{"x_min":41,"x_max":684.046875,"ha":729,"o":"m 482 98 q 566 112 532 98 q 643 160 600 126 l 661 151 q 643 96 652 125 q 628 40 634 66 q 521 -1 577 11 q 403 -15 466 -15 q 141 79 241 -15 q 41 336 41 173 q 137 586 41 490 q 386 683 234 683 q 608 601 532 683 q 684 373 684 520 l 684 332 l 267 332 q 325 165 267 232 q 482 98 383 98 m 233 976 q 300 948 272 976 q 328 878 328 920 q 303 811 328 839 q 236 784 278 784 q 166 811 194 784 q 138 878 138 838 q 166 947 138 918 q 233 976 194 976 m 493 976 q 560 948 532 976 q 588 878 588 920 q 562 811 588 838 q 496 784 536 784 q 427 811 455 784 q 399 878 399 838 q 426 946 399 917 q 493 976 454 976 m 478 411 q 481 444 481 422 q 459 566 481 513 q 377 620 438 620 q 292 562 318 620 q 267 437 267 505 l 267 411 l 478 411 "},"e":{"x_min":43,"x_max":686.046875,"ha":729,"o":"m 484 95 q 566 110 531 95 q 644 161 601 125 l 662 154 q 640 84 647 105 q 629 40 634 62 q 522 -1 577 11 q 404 -15 468 -15 q 141 77 240 -15 q 43 336 43 170 q 138 585 43 488 q 387 683 234 683 q 609 602 533 683 q 686 375 686 522 l 684 332 l 269 332 q 326 162 269 230 q 484 95 384 95 m 480 411 l 482 444 q 459 567 482 513 q 379 622 437 622 q 293 565 318 622 q 269 438 269 509 l 269 411 l 480 411 "},"ό":{"x_min":30,"x_max":741,"ha":774,"o":"m 395 683 q 645 587 550 683 q 741 337 741 492 q 646 79 741 173 q 385 -15 552 -15 q 127 78 225 -15 q 30 333 30 172 q 129 590 30 498 q 395 683 228 683 m 538 953 q 591 1001 571 986 q 639 1017 611 1017 q 692 994 671 1017 q 713 943 713 972 q 694 897 713 915 q 643 863 675 878 l 420 755 l 352 755 l 538 953 m 269 174 q 305 85 275 119 q 386 52 335 52 q 464 85 436 52 q 503 172 491 119 q 510 237 506 194 q 515 336 515 279 q 510 431 515 391 q 503 494 506 472 q 464 581 491 548 q 385 615 436 615 q 291 563 315 615 q 261 459 267 512 q 256 333 256 407 q 269 174 256 248 "},"J":{"x_min":-37,"x_max":356,"ha":447,"o":"m 214 926 q 293 929 237 926 q 356 932 349 932 q 349 680 356 857 q 342 450 342 502 q 344 314 342 411 q 346 213 346 218 l 346 105 q 249 -128 346 -36 q 10 -221 153 -221 l -24 -216 l -37 -143 l 13 -145 q 97 -94 76 -145 q 118 28 118 -44 l 118 219 q 110 619 118 352 q 103 931 103 886 l 214 926 "},"»":{"x_min":54.5625,"x_max":587.890625,"ha":629,"o":"m 187 330 l 54 604 l 110 656 l 339 333 l 110 9 l 54 66 l 187 330 m 437 330 l 304 604 l 358 656 l 587 333 l 358 9 l 304 66 l 437 330 "},"©":{"x_min":72,"x_max":1064,"ha":1138,"o":"m 1064 486 q 918 139 1064 285 q 570 -6 772 -6 q 220 139 369 -6 q 72 488 72 285 q 219 836 72 688 q 568 985 367 985 q 916 836 769 985 q 1064 486 1064 687 m 155 490 q 276 199 155 323 q 566 75 398 75 q 858 197 734 75 q 982 487 982 319 q 861 781 982 659 q 567 904 740 904 q 276 781 398 904 q 155 490 155 658 m 683 597 q 649 666 683 637 q 573 696 616 696 q 470 636 501 696 q 439 499 439 577 q 468 354 439 421 q 563 288 497 288 q 687 397 664 288 l 815 397 q 735 247 805 303 q 570 191 666 191 q 374 273 448 191 q 301 481 301 356 q 371 696 301 604 q 559 788 441 788 q 726 737 655 788 q 808 597 796 686 l 683 597 "},"ώ":{"x_min":30,"x_max":1059,"ha":1093,"o":"m 335 -15 q 111 79 192 -15 q 30 320 30 173 q 72 504 30 420 q 192 666 114 588 q 297 661 237 661 q 347 663 319 661 q 390 666 374 665 q 247 280 247 498 q 269 123 247 194 q 358 52 291 52 q 421 86 399 52 q 443 165 443 121 l 443 291 q 441 415 443 379 q 435 512 440 451 q 511 505 499 505 q 544 505 522 505 q 608 508 579 505 q 657 512 636 511 q 648 402 652 465 q 644 289 644 340 q 644 237 644 258 q 650 165 644 215 q 669 85 650 119 q 730 52 688 52 q 821 122 798 52 q 844 279 844 192 q 807 481 844 386 q 700 666 771 576 q 746 662 724 663 q 793 661 767 661 q 846 663 812 661 q 898 666 881 666 q 1016 508 974 594 q 1059 322 1059 422 q 974 83 1059 182 q 753 -15 890 -15 q 630 13 685 -15 q 545 100 575 41 q 459 14 516 44 q 335 -15 402 -15 m 684 953 q 737 1001 717 986 q 786 1017 757 1017 q 838 994 817 1017 q 859 943 859 972 q 840 897 859 915 q 790 863 821 878 l 567 755 l 498 755 l 684 953 "},"≥":{"x_min":170.828125,"x_max":965,"ha":1139,"o":"m 965 571 l 965 455 l 173 199 l 173 338 l 732 514 l 173 690 l 173 830 l 965 571 m 965 132 l 965 0 l 170 0 l 170 132 l 965 132 "},"^":{"x_min":-3,"x_max":425,"ha":438,"o":"m 148 1003 l 270 1003 l 425 755 l 357 755 l 210 878 l 62 755 l -3 755 l 148 1003 "},"«":{"x_min":40.28125,"x_max":575,"ha":629,"o":"m 193 336 l 326 62 l 272 9 l 40 333 l 272 656 l 325 599 l 193 336 m 443 336 l 575 62 l 520 9 l 288 333 l 520 656 l 575 599 l 443 336 "},"D":{"x_min":87,"x_max":987,"ha":1032,"o":"m 104 221 l 104 465 q 100 742 104 650 q 89 932 97 834 l 216 929 l 283 929 l 442 929 q 532 929 488 929 q 622 929 576 929 q 894 797 802 912 q 987 496 987 682 q 832 110 987 221 q 389 -1 677 -1 l 201 -1 l 87 -1 q 98 119 93 60 q 104 221 104 178 m 415 89 q 659 192 580 89 q 738 468 738 296 q 663 746 738 653 q 407 839 588 839 l 334 839 l 330 605 l 334 98 q 374 91 353 94 q 415 89 394 89 "},"w":{"x_min":6.9375,"x_max":1048.625,"ha":1042,"o":"m 302 6 q 270 5 281 6 q 215 0 258 4 l 6 667 q 77 663 33 667 q 129 659 120 659 q 197 663 154 659 q 248 667 240 667 q 359 238 293 457 l 440 505 l 484 667 q 540 663 502 667 q 580 659 577 659 q 637 663 598 659 q 677 667 676 667 q 712 520 695 586 q 748 383 729 454 l 790 238 l 855 475 q 875 555 862 501 q 899 667 888 609 q 939 662 917 665 q 973 659 961 659 q 1017 662 998 659 q 1048 667 1036 665 l 956 423 l 812 0 q 759 4 776 3 q 727 6 743 6 q 678 3 712 6 q 643 0 644 0 l 562 288 l 522 423 q 391 0 455 221 q 336 4 354 3 q 302 6 318 6 "},"$":{"x_min":43,"x_max":697,"ha":749,"o":"m 43 79 q 104 254 76 165 l 128 254 q 202 128 150 177 q 331 79 254 79 l 331 365 q 108 474 168 409 q 49 623 49 539 q 130 807 49 737 q 331 889 211 878 q 322 1010 331 949 q 344 1006 329 1008 q 371 1002 360 1004 q 393 1004 382 1004 q 417 1010 403 1005 q 410 955 412 983 q 409 892 409 926 q 555 868 502 880 q 662 823 607 855 q 601 665 626 746 l 570 665 q 409 817 538 789 l 409 554 q 637 445 577 511 q 697 289 697 379 q 615 91 697 168 q 409 0 534 15 l 409 -62 q 409 -97 409 -84 q 411 -136 410 -109 l 368 -133 l 325 -136 q 328 -69 328 -112 q 331 0 329 -26 q 43 79 173 0 m 331 817 q 243 778 278 817 q 209 686 209 739 q 245 615 209 644 q 331 577 282 586 l 331 817 m 534 212 q 499 299 534 267 q 405 347 464 330 l 405 78 q 497 123 461 89 q 534 212 534 157 "},"‧":{"x_min":105,"x_max":343,"ha":447,"o":"m 223 654 q 306 617 270 654 q 343 533 343 581 q 306 451 343 486 q 223 417 270 417 q 139 450 174 417 q 105 534 105 483 q 139 619 105 584 q 223 654 174 654 "},"\\\\":{"x_min":-31.953125,"x_max":422,"ha":383,"o":"m -31 1024 l 49 1024 l 422 -126 l 338 -126 l -31 1024 "},"Ι":{"x_min":94,"x_max":354,"ha":447,"o":"m 111 402 q 107 716 111 609 q 94 932 103 822 q 161 925 124 929 q 220 922 198 922 q 292 927 245 922 q 353 931 339 932 q 340 716 343 819 q 337 465 337 613 q 340 221 337 326 q 354 0 344 116 q 273 2 330 0 q 214 5 216 5 l 95 0 q 107 199 103 88 q 111 402 111 311 "},"Ύ":{"x_min":-28,"x_max":1295.609375,"ha":1247,"o":"m 635 650 q 566 772 622 672 q 469 931 509 872 l 591 926 q 683 929 619 926 q 755 931 748 931 q 844 740 803 825 q 941 554 885 656 q 1040 730 991 636 q 1135 931 1088 825 l 1210 926 q 1252 929 1224 926 q 1295 931 1280 931 q 1142 689 1213 812 q 997 420 1072 566 l 1001 143 l 1007 0 l 913 5 l 755 0 q 761 138 755 50 q 768 237 768 226 l 768 402 l 635 650 m 158 953 q 211 1001 191 986 q 259 1017 231 1017 q 312 994 291 1017 q 333 943 333 972 q 314 897 333 916 q 264 863 295 878 l 40 755 l -28 755 l 158 953 "},"’":{"x_min":70.828125,"x_max":337.5,"ha":374,"o":"m 70 528 l 151 848 q 183 919 158 889 q 244 949 208 949 q 310 924 283 949 q 337 862 337 900 q 331 829 337 845 q 316 797 326 813 l 111 511 l 70 528 "},"Ν":{"x_min":86,"x_max":930.453125,"ha":1010,"o":"m 101 444 q 97 645 101 523 q 94 787 94 768 l 90 931 l 177 926 l 268 934 q 526 623 395 775 q 792 327 657 470 l 792 584 q 787 766 792 643 q 782 931 782 888 q 825 927 811 929 q 854 926 838 926 q 890 927 876 926 q 930 934 904 929 q 919 838 923 889 q 915 738 915 788 q 913 461 915 600 q 911 184 912 322 q 913 106 911 147 q 920 0 915 66 q 876 4 901 2 q 838 6 851 6 q 794 4 812 6 q 756 0 777 2 q 495 309 631 151 q 220 618 359 466 l 220 241 l 227 0 q 194 4 213 1 q 159 6 175 6 q 119 4 134 6 q 86 0 103 2 q 97 208 94 105 q 101 444 101 311 "},"-":{"x_min":58.71875,"x_max":386.5,"ha":447,"o":"m 65 334 q 62 383 65 352 q 58 422 58 415 l 386 422 l 379 333 l 386 247 l 58 247 q 62 296 58 265 q 65 334 65 327 "},"Q":{"x_min":40,"x_max":1098.328125,"ha":1129,"o":"m 40 456 q 190 819 40 689 q 577 949 340 949 q 945 829 804 949 q 1086 486 1086 709 q 1004 185 1086 313 q 759 10 922 56 l 883 -72 q 1098 -182 979 -129 l 1098 -200 q 1005 -241 1053 -216 q 906 -294 956 -265 q 737 -160 824 -226 q 533 -13 649 -94 q 174 110 308 -13 q 40 456 40 233 m 562 72 q 773 193 706 72 q 840 472 840 315 q 773 741 840 623 q 566 860 706 860 q 354 741 421 860 q 287 465 287 622 q 353 192 287 312 q 562 72 420 72 "},"ς":{"x_min":48,"x_max":647,"ha":689,"o":"m 421 600 q 306 538 350 600 q 263 404 263 477 q 357 244 263 304 q 532 151 445 197 q 627 -17 627 88 q 527 -214 627 -140 q 302 -288 427 -288 q 291 -198 302 -247 q 318 -203 296 -198 q 353 -207 341 -207 q 440 -176 402 -207 q 484 -95 478 -145 q 324 60 484 -17 q 106 179 164 139 q 48 353 48 219 q 153 590 48 500 q 409 681 259 681 q 527 666 470 681 q 647 623 584 651 q 616 532 626 561 q 597 465 606 504 l 559 465 q 513 563 546 526 q 421 600 479 600 "},"M":{"x_min":32,"x_max":1165,"ha":1217,"o":"m 105 465 l 168 932 q 211 927 190 929 q 261 926 231 926 q 309 929 277 926 q 358 932 341 932 q 441 709 409 790 q 503 559 473 629 q 608 316 533 488 l 778 690 q 872 932 834 808 q 919 929 887 932 q 966 926 951 926 q 1027 929 1006 926 q 1059 932 1048 932 l 1105 473 q 1130 240 1117 354 q 1165 0 1144 127 q 1095 3 1140 0 q 1041 6 1051 6 q 969 3 1015 6 q 915 0 924 0 q 895 291 915 142 l 865 616 q 731 317 802 480 q 597 0 661 153 l 551 0 l 500 0 q 409 218 465 87 q 317 426 352 349 q 236 605 282 504 l 196 229 q 185 108 190 173 q 180 0 180 44 q 134 3 165 0 q 100 6 102 6 q 60 4 77 6 q 32 0 43 1 q 105 465 77 258 "},"Ψ":{"x_min":84,"x_max":1097.890625,"ha":1185,"o":"m 307 708 q 307 639 307 686 q 307 569 307 593 q 342 407 307 462 q 478 353 377 353 l 480 484 q 472 735 480 568 q 464 932 464 903 q 530 925 494 929 q 587 922 566 922 q 658 927 612 922 q 719 931 705 932 q 712 777 719 877 q 706 666 706 677 l 702 353 q 800 378 761 353 q 853 457 839 404 q 871 582 868 511 q 875 670 875 652 q 868 811 875 720 q 861 931 861 901 q 926 927 881 931 q 984 922 970 922 q 1039 926 1002 922 q 1097 930 1077 930 q 1093 869 1094 904 q 1092 801 1092 834 l 1092 738 l 1092 687 l 1092 610 q 992 354 1092 432 q 702 261 892 277 q 710 126 702 219 q 719 0 719 33 q 646 3 691 0 q 591 6 601 6 q 516 3 562 6 q 464 0 470 0 q 472 134 464 40 q 480 261 480 229 q 188 358 287 261 q 90 651 90 455 l 90 804 l 90 820 q 84 930 90 881 q 139 926 102 930 q 196 922 177 922 q 257 927 219 922 q 322 931 295 931 q 311 813 316 876 q 307 708 307 750 "},"C":{"x_min":43,"x_max":891.84375,"ha":900,"o":"m 587 856 q 363 744 442 856 q 285 479 285 632 q 361 202 285 322 q 586 82 437 82 q 740 108 668 82 q 855 194 812 135 l 877 184 q 861 120 868 152 q 846 45 854 88 q 710 -2 786 12 q 555 -18 634 -18 q 184 109 326 -18 q 43 464 43 236 q 190 819 43 690 q 569 949 338 949 q 723 932 652 949 q 891 876 793 915 q 866 793 879 840 q 846 710 852 746 l 827 710 q 734 818 799 781 q 587 856 669 856 "},"œ":{"x_min":36,"x_max":1154.0625,"ha":1197,"o":"m 387 -15 q 131 79 227 -15 q 36 334 36 173 q 131 586 36 490 q 383 683 226 683 q 630 606 515 683 q 735 664 677 645 q 859 683 792 683 q 1076 600 999 683 q 1154 377 1154 517 l 1152 332 l 736 332 q 793 165 736 232 q 951 98 851 98 q 1111 160 1042 98 l 1127 151 q 1111 101 1116 119 q 1094 40 1105 83 q 990 -1 1049 11 q 870 -15 931 -15 q 735 2 794 -15 q 628 68 676 20 q 521 4 584 23 q 387 -15 458 -15 m 949 411 l 949 445 q 921 580 949 541 q 844 620 893 620 q 756 557 777 620 q 736 411 736 494 l 949 411 m 276 171 q 315 80 286 115 q 395 45 344 45 q 453 62 424 45 q 498 115 481 79 q 520 204 514 151 q 526 329 526 257 q 516 475 526 408 q 476 577 506 542 q 394 612 445 612 q 294 552 327 612 q 271 470 279 520 q 264 329 264 420 q 266 244 264 269 q 276 171 268 219 "},"!":{"x_min":103,"x_max":341,"ha":444,"o":"m 222 221 q 306 187 271 221 q 341 104 341 154 q 306 19 341 54 q 222 -15 271 -15 q 138 19 173 -15 q 103 103 103 53 q 137 186 103 151 q 222 221 172 221 m 113 818 q 142 910 113 872 q 224 949 171 949 q 304 921 274 949 q 334 847 334 894 q 325 741 334 796 q 306 628 317 687 l 276 462 q 253 296 259 369 l 193 296 q 113 818 153 557 "},"ç":{"x_min":36,"x_max":622,"ha":660,"o":"m 423 600 q 306 528 346 600 q 267 373 267 457 q 313 176 267 265 q 459 88 359 88 q 542 99 500 88 q 612 133 584 111 l 622 126 l 590 19 q 502 -6 551 1 q 406 -15 453 -15 q 141 76 247 -15 q 36 325 36 168 q 140 583 36 485 q 408 681 245 681 q 622 637 519 681 q 590 459 602 550 l 565 459 q 519 561 555 522 q 423 600 483 600 m 175 -203 q 276 -231 251 -226 q 332 -236 301 -236 q 381 -223 361 -236 q 402 -184 402 -211 q 384 -144 402 -161 q 341 -128 366 -128 q 319 -130 328 -128 q 301 -135 310 -132 l 301 2 l 358 2 l 358 -77 l 418 -75 q 496 -108 465 -80 q 527 -183 527 -136 q 487 -274 527 -239 q 388 -310 448 -310 q 268 -299 326 -310 q 151 -265 211 -289 l 175 -203 "},"{":{"x_min":104,"x_max":587.328125,"ha":683,"o":"m 587 844 l 540 844 q 468 821 487 844 q 446 785 449 798 q 443 752 443 773 l 443 712 l 443 552 q 416 424 443 464 q 304 353 390 383 q 413 287 383 335 q 443 155 443 238 l 443 -5 q 465 -105 443 -74 q 555 -136 488 -136 l 587 -136 l 587 -277 l 481 -275 q 343 -234 396 -268 q 280 -122 289 -200 l 280 -50 l 280 116 q 246 238 280 194 q 137 283 212 283 l 104 283 l 104 422 q 240 458 201 422 q 280 588 280 494 l 280 756 l 280 831 q 355 951 292 919 q 517 983 417 983 l 587 983 l 587 844 "},"X":{"x_min":-1.390625,"x_max":801.390625,"ha":782,"o":"m 169 241 l 301 436 l 15 932 q 94 929 38 932 q 155 926 150 926 q 235 929 179 926 q 298 932 291 932 q 314 893 308 907 q 358 802 320 880 l 445 638 q 547 805 513 748 q 613 932 581 862 q 655 929 627 932 q 698 926 683 926 q 740 929 712 926 q 783 932 768 932 q 685 800 709 833 q 616 701 661 766 l 502 531 l 801 0 q 713 2 776 0 q 647 5 651 5 l 516 0 l 470 108 l 356 326 q 265 174 316 263 q 170 0 215 84 q 118 3 154 0 q 77 6 81 6 q 31 4 52 6 q -1 0 11 1 l 169 241 "},"ô":{"x_min":32,"x_max":743,"ha":775,"o":"m 395 683 q 647 588 551 683 q 743 337 743 494 q 648 79 743 173 q 387 -15 554 -15 q 129 78 227 -15 q 32 333 32 172 q 130 590 32 497 q 395 683 229 683 m 325 1003 l 450 1003 l 601 755 l 534 755 l 387 878 l 238 755 l 174 755 l 325 1003 m 269 174 q 307 85 277 120 q 387 50 337 50 q 466 84 437 50 q 500 156 494 119 q 511 215 507 194 q 517 335 517 271 q 511 450 517 395 q 500 509 507 471 q 466 582 494 548 q 387 616 439 616 q 294 564 319 616 q 263 459 269 513 q 258 333 258 406 q 260 244 258 270 q 269 174 262 217 "},"#":{"x_min":30,"x_max":1019,"ha":1049,"o":"m 619 974 l 522 698 l 684 698 l 781 974 l 930 975 l 831 698 l 1019 699 l 970 564 l 783 563 l 725 403 l 920 403 l 873 271 l 678 271 l 579 -5 l 432 -5 l 530 271 l 367 271 l 270 -5 l 121 -5 l 220 270 l 30 271 l 79 403 l 268 403 l 326 563 l 127 564 l 174 699 l 374 698 l 472 975 l 619 974 m 414 402 l 582 402 l 639 563 l 470 563 l 414 402 "},"ι":{"x_min":80,"x_max":314.71875,"ha":396,"o":"m 91 126 l 91 543 l 80 667 q 139 661 105 664 q 196 658 173 658 q 264 661 238 658 q 314 666 291 663 q 304 587 307 616 q 301 523 301 558 l 301 113 q 302 72 301 88 q 314 0 304 56 l 195 4 l 81 0 q 87 67 84 30 q 91 126 91 104 "},"Ά":{"x_min":-28,"x_max":983.109375,"ha":963,"o":"m 242 322 q 326 529 276 400 q 411 751 377 659 q 484 948 445 843 l 553 944 l 623 948 q 805 450 717 684 q 983 0 892 215 l 849 4 l 713 0 l 684 91 l 630 259 q 531 261 581 259 q 433 264 481 262 l 335 259 q 245 0 295 134 l 155 4 l 103 0 l 242 322 m 158 953 q 211 1001 191 986 q 259 1017 231 1017 q 312 994 291 1017 q 333 943 333 972 q 314 897 333 916 q 265 863 295 878 l 40 755 l -28 755 l 158 953 m 487 368 l 597 368 q 549 509 573 446 q 488 662 526 572 q 376 370 428 519 l 487 368 "},")":{"x_min":72.21875,"x_max":383,"ha":449,"o":"m 227 366 q 191 656 227 521 q 76 906 156 792 l 120 949 q 317 691 252 826 q 383 382 383 555 q 317 63 383 201 q 115 -201 252 -75 l 72 -158 q 191 81 156 -48 q 227 366 227 211 "},"ε":{"x_min":55,"x_max":599,"ha":657,"o":"m 512 502 q 472 579 502 548 q 396 611 442 611 q 323 577 352 611 q 295 499 295 544 q 317 429 295 460 q 377 394 340 399 l 449 394 l 449 373 q 449 336 449 349 q 449 316 449 323 q 413 319 438 319 q 322 281 362 319 q 283 195 283 244 q 323 101 283 144 q 412 59 363 59 q 498 88 461 59 q 571 167 535 117 l 599 155 q 593 130 595 144 q 592 104 592 115 q 592 82 592 90 q 599 53 592 74 q 351 -15 485 -15 q 145 30 236 -15 q 55 176 55 75 q 105 289 55 244 q 232 360 155 335 q 127 421 166 385 q 88 516 88 456 q 165 643 88 603 q 340 683 243 683 q 592 612 479 683 q 565 556 576 583 q 551 502 554 530 l 512 502 "},"Δ":{"x_min":11,"x_max":958.328125,"ha":972,"o":"m 490 926 q 531 928 509 926 q 566 932 554 930 q 690 599 633 746 q 815 296 747 452 q 958 0 884 140 q 720 3 879 0 q 481 8 562 8 q 247 3 404 8 q 11 0 90 0 q 234 470 126 223 q 415 932 342 716 q 448 928 429 930 q 490 926 468 926 m 314 373 q 217 127 262 259 q 425 118 314 118 q 542 122 468 118 q 636 127 616 127 q 598 232 616 184 q 538 391 580 280 l 433 645 l 314 373 "},"â":{"x_min":44,"x_max":706.78125,"ha":706,"o":"m 237 -15 q 98 35 153 -15 q 44 169 44 86 q 212 352 44 301 q 401 421 380 403 q 410 439 410 432 q 373 539 410 502 q 275 577 337 577 q 140 511 185 577 l 135 511 l 115 585 q 230 657 164 632 q 365 683 296 683 q 543 623 479 683 q 608 452 608 564 l 604 213 q 604 166 604 184 q 608 123 604 148 q 625 87 612 99 q 658 76 638 76 q 679 80 666 76 q 702 90 691 84 l 706 40 q 643 1 676 14 q 566 -15 610 -10 q 482 5 520 -15 q 421 64 443 25 q 237 -15 351 -15 m 291 1003 l 413 1003 l 566 755 l 501 755 l 350 878 l 203 755 l 138 755 l 291 1003 m 240 200 q 261 128 240 158 q 321 99 282 99 q 388 131 367 99 q 410 211 410 164 l 410 352 q 287 302 335 338 q 240 200 240 267 "},"}":{"x_min":93,"x_max":579,"ha":683,"o":"m 126 983 q 323 955 243 983 q 403 831 403 927 l 403 756 l 403 588 q 423 478 403 512 q 473 434 443 444 q 539 423 504 424 q 579 422 574 422 l 579 283 q 442 249 481 283 q 403 116 403 216 l 403 -50 q 373 -204 403 -147 q 284 -267 343 -260 q 179 -275 225 -274 q 93 -277 133 -277 l 93 -137 q 201 -121 163 -137 q 240 -43 240 -105 l 240 -4 l 240 155 q 269 285 240 241 q 380 353 298 328 q 268 421 296 378 q 240 553 240 463 l 240 713 q 227 805 240 771 q 166 844 215 838 l 93 844 l 93 983 l 126 983 "},"‰":{"x_min":28,"x_max":1618,"ha":1647,"o":"m 265 910 q 434 844 369 910 q 500 672 500 779 q 435 496 500 562 q 258 431 370 431 q 91 498 154 431 q 28 669 28 565 q 93 843 28 776 q 265 910 158 910 m 831 1015 l 917 1014 l 272 -125 l 184 -125 l 831 1015 m 850 463 q 1020 401 955 463 q 1085 230 1085 339 q 1023 51 1085 117 q 846 -15 961 -15 q 678 51 743 -15 q 613 222 613 118 q 676 398 613 333 q 850 463 739 463 m 1383 463 q 1554 400 1490 463 q 1618 229 1618 337 q 1556 51 1618 117 q 1378 -15 1494 -15 q 1209 51 1274 -15 q 1144 222 1144 118 q 1209 396 1144 329 q 1383 463 1274 463 m 780 112 q 798 57 780 83 q 847 31 817 31 q 895 59 874 31 q 916 114 916 87 q 922 222 922 162 q 922 275 922 248 q 915 338 917 312 q 896 389 912 364 q 848 414 880 414 q 813 404 828 414 q 792 375 797 394 q 777 312 781 347 q 773 241 773 276 l 773 222 q 773 183 773 201 q 780 112 774 165 m 196 561 q 214 505 196 532 q 261 478 232 478 q 297 489 280 478 q 323 525 314 501 q 335 586 332 548 q 339 669 339 625 q 337 723 339 697 q 332 780 336 749 q 311 836 327 811 q 264 861 296 861 q 204 820 222 861 q 191 752 194 786 q 188 669 188 719 q 196 561 188 615 m 1315 112 q 1333 56 1315 82 q 1381 31 1351 31 q 1417 42 1402 31 q 1442 76 1433 53 q 1454 138 1451 100 q 1458 222 1458 176 q 1458 275 1458 248 q 1449 344 1453 312 q 1426 395 1445 376 q 1383 414 1408 414 q 1327 379 1338 414 q 1311 301 1315 344 q 1307 222 1307 258 q 1308 164 1307 190 q 1315 112 1309 139 "},"Ä":{"x_min":-28,"x_max":848.390625,"ha":829,"o":"m 109 323 q 187 512 148 413 q 274 740 225 611 q 350 948 323 870 l 420 945 l 492 948 q 666 463 583 687 q 848 0 749 240 l 718 2 l 579 0 l 551 91 l 497 259 q 399 261 448 259 q 300 264 349 262 l 202 259 l 113 0 q 74 2 95 2 q 42 2 53 2 l 21 2 l -28 0 l 109 323 m 284 1242 q 351 1214 323 1242 q 380 1148 380 1187 q 353 1079 380 1108 q 286 1050 327 1050 q 216 1077 245 1050 q 187 1148 187 1105 q 215 1214 187 1187 q 284 1242 243 1242 m 543 1242 q 611 1215 583 1242 q 639 1148 639 1189 q 613 1078 639 1107 q 546 1050 587 1050 q 478 1077 507 1050 q 449 1148 449 1105 q 476 1214 449 1186 q 543 1242 504 1242 m 352 368 l 462 368 q 414 511 437 450 q 350 662 390 571 q 243 370 296 516 l 352 368 "},"a":{"x_min":47,"x_max":708.15625,"ha":706,"o":"m 237 -15 q 100 35 154 -15 q 47 169 47 86 q 213 352 47 301 q 403 422 380 404 q 410 440 410 433 q 373 541 410 504 q 273 579 337 579 q 197 561 232 579 q 140 509 162 544 l 135 509 l 114 585 q 364 683 218 683 q 541 624 478 683 q 604 452 604 566 l 604 214 q 604 169 604 191 q 606 119 604 148 q 656 76 616 76 q 677 79 665 76 q 702 89 690 83 l 708 40 q 563 -11 644 -11 q 479 7 516 -11 q 421 64 441 26 q 339 4 387 23 q 237 -15 291 -15 m 240 198 q 261 127 240 158 q 322 97 282 97 q 388 131 367 97 q 410 212 410 165 l 410 351 q 287 301 334 337 q 240 198 240 266 "},"—":{"x_min":226.390625,"x_max":1138.890625,"ha":1365,"o":"m 226 421 l 1138 421 l 1138 278 l 226 278 l 226 421 "},"=":{"x_min":169.4375,"x_max":968.0625,"ha":1138,"o":"m 968 615 l 968 484 l 169 484 l 169 615 l 968 615 m 968 329 l 968 196 l 169 196 l 169 329 l 968 329 "},"N":{"x_min":86,"x_max":930.453125,"ha":1010,"o":"m 101 444 q 97 645 101 523 q 94 787 94 768 l 90 931 l 177 926 l 268 934 q 526 623 395 775 q 792 327 657 470 l 792 584 q 787 766 792 643 q 782 931 782 888 q 825 927 811 929 q 854 926 838 926 q 890 927 876 926 q 930 934 904 929 q 919 838 923 889 q 915 738 915 788 q 913 461 915 600 q 911 184 912 322 q 913 106 911 147 q 920 0 915 66 q 876 4 901 2 q 838 6 851 6 q 794 4 812 6 q 756 0 777 2 q 495 309 631 151 q 220 618 359 466 l 220 241 l 227 0 q 194 4 213 1 q 159 6 175 6 q 119 4 134 6 q 86 0 103 2 q 97 208 94 105 q 101 444 101 311 "},"ρ":{"x_min":48,"x_max":759,"ha":793,"o":"m 160 -366 q 48 -374 109 -366 q 52 -291 48 -343 q 56 -223 56 -239 l 56 169 l 48 314 q 139 585 48 488 q 403 683 231 683 q 661 589 563 683 q 759 336 759 495 q 681 89 759 194 q 465 -15 603 -15 q 266 65 346 -15 l 264 -208 q 265 -268 264 -241 q 275 -373 267 -295 q 197 -367 220 -368 q 160 -366 173 -366 m 275 347 q 284 196 275 264 q 324 109 295 142 q 404 77 352 77 q 494 120 473 77 q 522 212 514 164 q 531 347 531 260 q 526 431 531 388 q 517 511 522 473 q 483 582 512 549 q 401 615 453 615 q 309 566 340 615 q 279 452 279 517 q 275 372 275 412 l 275 347 "},"ü":{"x_min":75,"x_max":722,"ha":808,"o":"m 292 -15 q 142 41 202 -15 q 83 188 83 98 l 83 337 q 79 508 83 394 q 75 666 75 623 q 134 660 108 662 q 185 658 160 658 q 240 660 209 658 q 300 666 271 663 q 290 454 290 569 l 290 384 l 290 279 q 316 146 290 181 q 394 111 343 111 q 467 147 441 111 q 501 234 493 184 l 501 330 q 498 498 501 385 q 495 666 495 610 q 554 660 518 663 q 613 658 589 658 q 671 660 640 658 q 722 666 701 663 q 717 479 722 598 q 712 326 712 359 q 717 156 712 270 q 722 1 722 43 l 617 4 l 511 1 l 511 96 q 410 15 468 46 q 292 -15 353 -15 m 273 976 q 338 948 310 976 q 366 878 366 920 q 339 811 366 839 q 274 784 313 784 q 205 811 234 784 q 176 878 176 839 q 204 947 176 918 q 273 976 232 976 m 531 976 q 599 948 571 976 q 627 878 627 920 q 599 812 627 841 q 533 784 572 784 q 464 811 495 784 q 434 878 434 839 q 462 947 434 918 q 531 976 490 976 "},"Z":{"x_min":25,"x_max":831.953125,"ha":831,"o":"m 25 54 q 186 311 81 142 q 354 582 291 480 q 495 813 418 685 l 294 813 q 98 801 186 813 l 105 852 q 98 932 105 894 l 444 926 q 657 928 509 926 q 815 931 805 931 l 815 903 q 573 517 695 715 q 331 119 451 320 l 566 119 q 706 122 654 119 q 831 136 758 125 q 826 43 826 96 l 827 0 q 606 3 761 0 q 443 6 451 6 q 203 3 370 6 q 25 0 36 0 l 25 54 "},"u":{"x_min":75,"x_max":722,"ha":808,"o":"m 292 -15 q 141 41 200 -15 q 83 189 83 97 l 83 336 q 79 508 83 393 q 75 667 75 624 q 140 659 109 662 q 185 656 171 656 q 251 661 218 656 q 299 666 285 665 l 290 454 l 290 382 l 290 279 q 316 147 290 182 q 393 112 343 112 q 464 146 441 112 q 497 234 488 181 l 501 331 q 497 498 501 387 q 493 667 493 610 q 563 659 531 662 q 612 656 594 656 q 672 661 640 656 q 722 666 703 665 q 716 495 722 609 q 711 326 711 381 q 716 163 711 272 q 722 1 722 55 l 616 4 l 511 1 l 511 94 q 411 15 470 45 q 292 -15 353 -15 "},"k":{"x_min":80,"x_max":732.765625,"ha":756,"o":"m 93 550 q 86 827 93 648 q 80 1024 80 1005 q 184 1018 125 1018 q 307 1023 252 1018 q 301 812 307 959 q 296 602 296 665 l 296 389 q 424 511 368 445 q 545 666 481 576 q 595 665 562 666 q 645 663 628 663 l 709 666 l 714 656 l 628 576 l 475 425 q 636 154 543 304 l 732 0 q 661 3 706 0 q 607 6 616 6 q 537 3 580 6 q 487 0 494 0 q 386 174 441 83 q 296 329 332 266 q 299 141 296 273 q 302 0 302 9 l 191 4 l 80 0 q 86 320 80 113 q 93 550 93 526 "},"Η":{"x_min":91,"x_max":955,"ha":1049,"o":"m 105 286 l 105 459 q 101 650 105 533 q 98 784 98 766 l 91 932 q 156 926 125 929 q 214 923 187 923 q 277 926 241 923 q 344 931 314 929 q 339 818 344 894 q 334 713 334 741 l 334 563 l 514 561 l 710 561 l 710 712 q 707 812 710 778 q 697 932 705 846 q 764 926 727 929 q 828 923 800 923 q 889 926 854 923 q 955 931 924 929 q 948 690 955 856 q 941 465 941 523 q 948 225 941 391 q 955 0 955 58 l 828 5 q 764 2 807 5 q 698 0 721 0 q 707 99 704 47 q 710 202 710 152 l 710 444 q 595 447 665 444 q 514 451 525 451 q 411 447 475 451 q 334 444 346 444 l 334 202 q 339 97 334 167 q 344 0 344 26 q 270 2 323 0 q 214 5 218 5 l 91 0 q 98 146 91 40 q 105 286 105 252 "},"Α":{"x_min":-29.171875,"x_max":850,"ha":829,"o":"m 109 322 q 193 530 143 400 q 278 751 244 660 q 351 949 312 843 l 420 944 l 490 949 q 672 450 584 685 q 850 0 759 215 l 716 4 l 580 0 l 551 91 l 497 259 q 398 261 448 259 q 300 264 348 262 l 202 259 q 112 0 162 134 l 22 4 l -29 0 l 109 322 m 354 368 l 464 368 q 416 509 440 446 q 355 662 393 572 q 243 370 295 519 l 354 368 "},"ß":{"x_min":84,"x_max":776,"ha":811,"o":"m 198 4 l 84 1 q 87 120 84 45 q 91 212 91 195 l 91 352 l 91 651 q 167 928 91 832 q 420 1024 243 1024 q 603 985 522 1024 q 684 854 684 946 q 607 713 684 786 q 530 601 530 640 q 543 563 530 583 q 574 533 556 543 l 688 447 q 776 275 776 379 q 690 67 776 150 q 478 -15 605 -15 q 373 8 428 -15 l 403 161 l 417 161 q 461 88 435 113 q 535 64 488 64 q 600 91 574 64 q 626 157 626 118 q 504 316 626 219 q 377 476 383 413 q 459 650 377 547 q 542 822 542 754 q 511 908 542 873 q 428 943 481 943 q 327 892 361 943 q 294 770 294 841 q 296 495 294 602 q 301 238 298 387 q 304 1 304 88 l 198 4 "},"é":{"x_min":41,"x_max":684.046875,"ha":729,"o":"m 482 98 q 566 112 532 98 q 643 160 600 126 l 661 151 q 643 96 652 125 q 628 40 634 66 q 521 -1 577 11 q 403 -15 466 -15 q 141 79 241 -15 q 41 336 41 173 q 137 586 41 490 q 386 683 234 683 q 608 601 532 683 q 684 373 684 520 l 684 332 l 267 332 q 325 165 267 232 q 482 98 383 98 m 409 951 q 459 1000 436 983 q 511 1017 481 1017 q 563 994 542 1017 q 585 943 585 971 q 565 895 585 915 q 515 861 545 875 l 292 754 l 223 754 l 409 951 m 478 411 q 481 444 481 422 q 459 566 481 513 q 377 620 438 620 q 292 562 318 620 q 267 437 267 505 l 267 411 l 478 411 "},"s":{"x_min":43,"x_max":543,"ha":583,"o":"m 95 197 q 155 95 115 133 q 256 57 195 57 q 338 77 300 57 q 376 140 376 98 q 213 259 376 195 q 51 456 51 323 q 129 623 51 563 q 319 683 208 683 q 411 671 366 683 q 515 638 455 660 l 464 485 l 450 485 q 397 575 433 542 q 303 608 362 608 q 234 588 264 608 q 205 530 205 569 q 374 417 205 478 q 543 227 543 356 q 464 48 543 112 q 266 -15 386 -15 q 148 -6 201 -15 q 43 26 95 3 l 76 197 l 95 197 "},"B":{"x_min":91,"x_max":773,"ha":815,"o":"m 109 208 l 109 465 q 105 714 109 605 q 91 932 102 823 l 250 929 l 417 929 q 655 881 560 929 q 751 707 751 834 q 692 566 751 618 q 542 503 634 515 l 542 491 q 704 431 636 491 q 773 276 773 372 q 678 69 773 138 q 438 0 584 0 l 250 4 q 152 2 211 4 q 91 0 92 0 q 103 104 97 51 q 109 208 109 158 m 519 698 q 479 803 519 763 q 374 844 440 844 l 335 839 q 331 687 331 766 l 331 540 q 466 578 413 540 q 519 698 519 617 m 380 87 q 490 137 450 87 q 531 258 531 187 q 484 392 531 338 q 360 446 437 446 l 331 446 l 331 276 l 335 91 l 380 87 "},"…":{"x_min":93,"x_max":1053,"ha":1182,"o":"m 195 191 q 268 160 236 191 q 300 88 300 129 q 268 16 300 46 q 195 -13 237 -13 q 123 16 154 -13 q 93 88 93 45 q 123 160 93 129 q 195 191 154 191 m 575 191 q 647 160 615 191 q 679 88 679 129 q 647 16 679 46 q 575 -13 616 -13 q 501 16 532 -13 q 471 88 471 45 q 501 160 471 129 q 575 191 532 191 m 948 191 q 1021 160 989 191 q 1053 88 1053 129 q 1021 16 1053 46 q 948 -13 990 -13 q 876 16 907 -13 q 846 88 846 45 q 876 160 846 129 q 948 191 907 191 "},"?":{"x_min":93,"x_max":539,"ha":597,"o":"m 295 221 q 377 186 340 221 q 414 104 414 152 q 378 23 414 61 q 295 -15 343 -15 q 210 19 245 -15 q 175 103 175 53 q 211 183 175 146 q 295 221 247 221 m 433 288 q 378 277 411 280 q 339 275 344 275 q 201 329 261 275 q 142 459 142 383 q 238 620 142 530 q 335 777 335 709 q 310 838 335 812 q 252 864 286 864 q 175 838 211 864 q 119 775 138 813 l 101 777 q 93 891 101 843 q 294 949 181 949 q 467 890 395 949 q 539 730 539 832 q 429 554 539 644 q 320 407 320 464 q 338 363 320 378 q 386 349 357 349 q 421 353 403 349 q 448 358 439 357 l 433 288 "},"H":{"x_min":91,"x_max":957,"ha":1049,"o":"m 105 284 l 105 461 q 101 651 105 534 q 98 787 98 768 l 91 932 q 153 927 107 932 q 222 922 200 922 q 288 926 252 922 q 345 932 324 930 q 336 827 339 886 q 334 712 334 769 l 334 564 l 515 560 l 710 564 l 710 712 q 699 932 710 833 q 767 927 721 932 q 829 922 813 922 q 895 927 851 922 q 956 932 940 932 q 943 702 947 829 q 939 461 939 576 q 942 217 939 306 q 957 0 945 128 q 883 3 930 0 q 829 6 837 6 q 755 3 804 6 q 698 0 706 0 q 707 97 704 35 q 710 201 710 158 l 710 445 q 599 447 676 445 q 515 450 522 450 l 334 445 l 334 201 q 336 88 334 120 q 345 0 338 56 q 278 2 322 0 q 215 5 234 5 q 153 2 194 5 q 91 0 111 0 q 98 146 91 40 q 105 284 105 252 "},"ν":{"x_min":9,"x_max":658,"ha":694,"o":"m 470 438 q 463 504 470 477 q 422 642 457 532 q 641 671 528 660 q 658 582 658 626 q 614 412 658 494 l 541 270 q 462 107 487 161 q 417 0 438 53 q 374 3 403 0 q 331 8 345 8 q 289 3 317 8 q 246 0 261 0 q 165 236 209 110 q 85 458 121 361 q 9 667 49 555 q 72 661 40 664 q 128 659 103 659 q 184 661 152 659 q 245 666 217 664 q 403 184 300 449 q 454 328 438 275 q 470 438 470 381 "},"î":{"x_min":-15,"x_max":413,"ha":396,"o":"m 93 126 l 93 543 q 87 602 93 558 q 82 666 82 645 q 141 661 111 664 q 198 659 172 659 q 255 661 223 659 q 316 666 287 664 q 311 621 315 658 q 303 544 307 584 l 303 319 q 305 144 303 212 q 316 0 307 76 l 196 2 l 81 0 q 93 126 93 66 m 136 1003 l 258 1003 l 413 755 l 345 755 l 198 878 l 50 755 l -15 755 l 136 1003 "},"c":{"x_min":36,"x_max":623.109375,"ha":660,"o":"m 421 600 q 306 530 344 600 q 268 376 268 461 q 313 177 268 266 q 459 88 359 88 q 539 99 498 88 q 608 135 580 111 l 617 126 l 587 21 q 500 -5 546 3 q 404 -15 454 -15 q 140 76 245 -15 q 36 324 36 168 q 140 583 36 484 q 406 683 245 683 q 623 638 514 683 q 607 570 617 620 q 587 462 596 520 l 562 462 q 515 561 550 522 q 421 600 480 600 "},"¶":{"x_min":18,"x_max":531,"ha":590,"o":"m 298 968 l 531 968 l 531 910 l 473 910 l 473 4 l 415 4 l 415 910 l 305 910 l 305 4 l 247 4 l 247 558 q 99 601 163 558 q 27 690 36 645 q 18 744 18 734 q 90 896 18 824 q 298 968 163 968 "},"β":{"x_min":82,"x_max":753,"ha":828,"o":"m 91 -115 q 86 188 91 -19 q 82 493 82 397 q 85 654 82 597 q 102 796 88 711 q 205 951 115 882 q 421 1021 294 1021 q 626 953 540 1021 q 713 770 713 886 q 671 634 713 690 q 553 542 629 579 q 700 438 647 506 q 753 273 753 369 q 680 68 753 152 q 490 -15 608 -15 q 390 0 435 -15 q 298 50 345 16 l 298 -105 l 306 -371 q 246 -365 278 -368 q 192 -362 214 -362 q 138 -365 169 -362 q 82 -370 108 -368 q 86 -238 82 -327 q 91 -115 91 -148 m 372 572 q 474 623 445 572 q 503 757 503 674 q 484 897 503 839 q 403 956 466 956 q 332 908 354 956 q 305 807 310 861 q 299 683 300 752 q 298 551 298 613 l 298 269 q 320 131 298 188 q 412 75 343 75 q 501 135 477 75 q 525 273 525 195 q 496 431 525 377 q 372 486 467 486 l 372 572 "},"Μ":{"x_min":32,"x_max":1165,"ha":1217,"o":"m 105 465 l 168 932 q 211 927 190 929 q 261 926 231 926 q 309 929 277 926 q 358 932 341 932 q 441 709 409 790 q 503 559 473 629 q 608 316 533 488 l 778 690 q 872 932 834 808 q 919 929 887 932 q 966 926 951 926 q 1027 929 1006 926 q 1059 932 1048 932 l 1105 473 q 1130 240 1117 354 q 1165 0 1144 127 q 1095 3 1140 0 q 1041 6 1051 6 q 969 3 1015 6 q 915 0 924 0 q 895 291 915 142 l 865 616 q 731 317 802 480 q 597 0 661 153 l 551 0 l 500 0 q 409 218 465 87 q 317 426 352 349 q 236 605 282 504 l 196 229 q 185 108 190 173 q 180 0 180 44 q 134 3 165 0 q 100 6 102 6 q 60 4 77 6 q 32 0 43 1 q 105 465 77 258 "},"Ό":{"x_min":-28,"x_max":1364,"ha":1407,"o":"m 855 949 q 1223 829 1082 949 q 1364 486 1364 710 q 1220 114 1364 244 q 830 -15 1076 -15 q 454 107 591 -15 q 318 465 318 229 q 466 823 318 697 q 855 949 615 949 m 158 953 q 211 1001 191 986 q 259 1017 231 1017 q 312 994 291 1017 q 333 943 333 972 q 314 897 333 916 q 265 863 295 878 l 40 755 l -28 755 l 158 953 m 840 73 q 1051 194 984 73 q 1118 472 1118 315 q 1051 742 1118 624 q 844 860 984 860 q 631 742 698 860 q 565 465 565 624 q 631 193 565 313 q 840 73 698 73 "},"Ή":{"x_min":-28,"x_max":1333.109375,"ha":1424,"o":"m 482 284 l 482 460 q 478 651 482 534 q 474 787 474 768 l 468 931 q 530 927 484 931 q 599 922 577 922 q 665 926 629 922 q 722 931 701 930 q 713 827 716 886 q 711 711 711 769 l 711 563 l 891 560 l 1086 564 l 1086 712 q 1075 931 1086 833 q 1143 927 1097 931 q 1205 922 1190 922 q 1272 927 1227 922 q 1333 931 1316 931 q 1319 702 1323 829 q 1315 460 1315 576 q 1318 217 1315 306 q 1333 0 1321 128 q 1260 3 1306 0 q 1205 6 1213 6 q 1131 3 1180 6 q 1074 0 1083 0 q 1083 97 1080 35 q 1086 201 1086 158 l 1086 444 q 975 447 1052 444 q 891 450 898 450 l 711 444 l 711 201 q 713 88 711 120 q 722 0 715 56 q 655 2 699 0 q 592 5 611 5 q 530 2 571 5 q 468 0 488 0 q 475 146 468 40 q 482 284 482 252 m 158 953 q 211 1001 191 986 q 259 1017 231 1017 q 312 994 291 1017 q 333 943 333 972 q 314 897 333 916 q 265 863 295 878 l 40 755 l -28 755 l 158 953 "},"•":{"x_min":215.28125,"x_max":805.5625,"ha":1024,"o":"m 512 803 q 718 714 631 803 q 805 505 805 626 q 719 299 805 387 q 512 212 633 212 q 301 298 387 212 q 215 505 215 384 q 303 714 215 626 q 512 803 391 803 "},"¥":{"x_min":8,"x_max":752,"ha":764,"o":"m 38 252 l 38 336 l 160 332 l 277 332 l 277 417 q 140 413 225 417 q 38 410 55 410 l 38 494 q 131 486 87 486 l 228 486 l 143 644 q 87 751 114 704 q 8 888 60 799 q 82 884 34 888 q 138 881 130 881 q 213 884 167 881 q 265 888 258 888 q 433 529 349 696 q 524 707 478 613 q 608 888 571 802 q 640 888 624 888 q 674 888 657 888 l 752 888 q 602 642 653 729 q 516 486 551 554 l 722 494 l 722 410 q 583 413 668 410 q 485 417 497 417 l 485 331 l 722 336 l 722 252 q 604 255 690 252 q 485 258 518 258 q 490 123 485 213 q 495 0 495 33 l 386 5 q 316 2 364 5 q 264 0 268 0 q 274 126 271 59 q 277 258 277 194 q 140 255 235 258 q 38 252 45 252 "},"(":{"x_min":91,"x_max":403.5,"ha":449,"o":"m 249 479 l 249 379 l 249 277 q 287 54 249 161 q 402 -158 326 -53 l 356 -201 q 158 57 225 -80 q 91 365 91 195 q 158 683 91 541 q 359 949 225 825 l 403 906 q 288 701 328 808 q 249 479 249 594 "},"U":{"x_min":82,"x_max":910,"ha":999,"o":"m 211 926 q 275 929 232 926 q 338 932 318 932 q 325 681 329 826 q 321 421 321 536 q 373 175 321 241 q 521 110 425 110 q 678 161 611 110 q 755 278 746 212 q 768 419 765 344 q 771 547 771 494 q 754 931 771 761 l 812 926 l 910 932 q 903 769 910 882 q 896 615 896 655 l 896 480 q 896 427 896 462 q 896 375 896 391 q 793 82 896 180 q 494 -15 691 -15 q 211 55 323 -15 q 100 286 100 126 q 91 616 100 383 q 82 932 82 850 q 154 929 102 932 q 211 926 207 926 "},"γ":{"x_min":0,"x_max":713.890625,"ha":700,"o":"m 523 199 q 486 87 498 128 q 474 -62 474 47 q 477 -246 474 -135 q 481 -374 481 -357 q 407 -366 442 -368 q 326 -365 373 -365 l 250 -370 q 258 -204 250 -315 q 267 -72 267 -93 q 246 138 267 52 q 189 344 225 224 q 130 512 154 463 q 50 561 105 561 q 25 558 38 561 q 0 553 11 555 l 0 635 q 79 669 38 656 q 159 683 119 683 q 329 593 293 683 q 433 233 365 503 q 519 456 482 349 q 576 666 555 562 l 644 663 l 713 666 q 633 490 665 572 q 523 199 601 408 "},"α":{"x_min":30,"x_max":827.21875,"ha":878,"o":"m 669 665 l 749 662 l 827 665 q 763 499 782 551 q 720 377 743 447 l 818 0 q 763 6 792 2 q 717 10 733 10 q 662 5 692 10 q 615 0 632 1 l 594 101 q 361 -15 501 -15 q 120 83 210 -15 q 30 334 30 182 q 123 583 30 484 q 368 683 217 683 q 515 647 449 683 q 633 547 582 612 q 651 601 640 563 q 669 665 662 638 m 383 614 q 313 588 343 614 q 276 523 283 562 q 260 434 265 484 q 256 333 256 385 q 269 174 256 249 q 305 87 275 122 q 385 52 335 52 q 509 144 473 52 q 546 340 546 236 q 522 504 546 428 q 455 597 498 580 q 383 614 411 614 "},"F":{"x_min":91,"x_max":645.15625,"ha":686,"o":"m 109 465 q 105 710 109 620 q 91 932 102 800 l 357 926 q 520 929 406 926 q 645 932 635 932 l 638 871 q 645 810 638 844 q 524 815 607 810 q 415 820 442 820 l 339 820 q 337 663 339 778 q 335 546 335 548 l 634 557 l 629 494 l 634 431 q 462 437 573 431 q 335 443 350 443 l 335 236 q 337 106 335 149 q 348 0 339 62 l 219 2 l 91 0 q 105 209 102 102 q 109 465 109 316 "},"­":{"x_min":0,"x_max":683.328125,"ha":683,"o":"m 0 421 l 683 421 l 683 278 l 0 278 l 0 421 "},":":{"x_min":105,"x_max":343,"ha":447,"o":"m 223 221 q 307 185 272 221 q 343 103 343 150 q 306 19 343 54 q 223 -15 270 -15 q 139 18 174 -15 q 105 103 105 51 q 139 186 105 151 q 223 221 174 221 m 223 654 q 306 617 270 654 q 343 532 343 581 q 306 450 343 485 q 223 416 270 416 q 139 449 174 416 q 105 534 105 482 q 139 619 105 584 q 223 654 174 654 "},"Χ":{"x_min":-1.390625,"x_max":801.390625,"ha":782,"o":"m 169 241 l 301 436 l 15 932 q 94 929 38 932 q 155 926 150 926 q 235 929 179 926 q 298 932 291 932 q 314 893 308 907 q 358 802 320 880 l 445 638 q 547 805 513 748 q 613 932 581 862 q 655 929 627 932 q 698 926 683 926 q 740 929 712 926 q 783 932 768 932 q 685 800 709 833 q 616 701 661 766 l 502 531 l 801 0 q 713 2 776 0 q 647 5 651 5 l 516 0 l 470 108 l 356 326 q 265 174 316 263 q 170 0 215 84 q 118 3 154 0 q 77 6 81 6 q 31 4 52 6 q -1 0 11 1 l 169 241 "},"*":{"x_min":91,"x_max":588,"ha":683,"o":"m 154 520 q 128 571 139 550 q 91 634 117 593 q 186 665 139 650 q 284 698 234 680 q 190 734 242 716 q 91 765 139 751 q 154 879 125 816 l 310 750 l 298 808 l 275 949 l 339 947 l 405 948 l 368 745 l 525 879 q 588 765 553 822 q 398 698 499 737 q 490 664 441 680 q 588 634 539 648 q 557 581 574 612 q 525 520 540 551 l 370 650 q 389 528 381 580 q 404 443 397 476 l 337 446 l 273 446 l 310 650 l 154 520 "},"°":{"x_min":165,"x_max":519,"ha":683,"o":"m 165 913 q 221 1032 165 980 q 351 1084 278 1084 q 469 1040 420 1084 q 519 926 519 996 q 464 804 519 853 q 335 755 409 755 q 214 799 264 755 q 165 913 165 844 m 241 905 q 268 832 241 863 q 338 801 295 801 q 414 837 388 801 q 441 927 441 874 q 416 1009 441 977 q 345 1042 392 1042 q 281 1018 310 1042 q 247 962 253 994 q 241 905 241 930 "},"V":{"x_min":-19.4375,"x_max":856.953125,"ha":818,"o":"m 255 230 l -19 932 q 61 929 4 932 q 120 926 117 926 l 247 932 q 298 768 270 840 l 476 296 l 646 770 q 673 852 662 812 q 692 932 685 891 l 766 926 q 812 929 781 926 q 856 932 843 932 q 752 706 801 819 l 566 231 q 488 0 520 123 q 445 4 463 2 q 413 6 427 6 q 368 3 397 6 q 336 0 340 0 q 304 97 322 46 q 255 230 286 147 "},"Ξ":{"x_min":58.328125,"x_max":816.671875,"ha":876,"o":"m 438 190 q 653 193 518 190 q 816 197 788 197 q 812 124 812 160 l 812 99 q 812 51 812 74 q 816 0 812 27 q 629 4 754 0 q 438 8 504 8 q 248 4 375 8 q 58 0 122 0 l 63 98 l 58 197 q 281 193 145 197 q 438 190 418 190 m 438 747 q 258 743 379 747 q 77 739 137 739 q 84 804 83 784 q 84 834 84 823 q 77 932 84 879 q 267 927 140 932 q 438 922 394 922 q 626 927 500 922 q 797 932 752 932 l 793 835 l 797 739 q 619 743 738 739 q 438 747 500 747 m 708 467 l 713 375 q 577 379 669 375 q 438 383 486 383 q 300 379 391 383 q 162 375 208 375 q 165 418 163 397 q 168 468 168 440 q 165 523 168 484 q 162 567 162 562 q 438 554 300 554 q 713 566 577 554 l 708 467 "}," ":{"x_min":0,"x_max":0,"ha":375},"Ϋ":{"x_min":-32,"x_max":797,"ha":747,"o":"m 133 650 q 52 795 94 720 q -32 931 11 869 l 91 928 l 256 932 q 365 700 329 773 q 441 554 401 627 q 541 731 491 634 q 636 932 590 827 l 711 928 l 797 932 q 644 689 714 812 q 498 420 573 566 l 502 143 l 509 0 l 413 5 l 256 0 q 261 118 256 38 q 267 236 267 197 l 267 402 l 133 650 m 242 1242 q 309 1215 281 1242 q 337 1148 337 1189 q 311 1078 337 1107 q 243 1050 285 1050 q 173 1078 203 1050 q 144 1148 144 1107 q 173 1214 144 1186 q 242 1242 202 1242 m 502 1242 q 571 1214 542 1242 q 600 1148 600 1187 q 572 1078 600 1107 q 505 1050 545 1050 q 435 1077 463 1050 q 408 1148 408 1105 q 435 1214 408 1186 q 502 1242 463 1242 "},"”":{"x_min":72.21875,"x_max":615.28125,"ha":654,"o":"m 72 528 l 152 848 q 183 920 159 891 q 245 949 206 949 q 311 926 286 949 q 337 861 337 903 q 315 797 337 827 l 112 511 l 72 528 m 351 528 l 430 848 q 462 919 437 889 q 525 949 487 949 q 588 925 562 949 q 615 864 615 901 q 609 829 615 845 q 594 797 604 813 l 391 511 l 351 528 "},"@":{"x_min":59,"x_max":1305,"ha":1365,"o":"m 581 72 q 418 131 475 72 q 362 298 362 191 q 455 554 362 437 q 684 672 548 672 q 771 650 734 672 q 843 586 808 629 l 877 653 l 998 653 l 897 254 l 893 229 q 912 193 893 205 q 957 181 931 181 q 1119 290 1056 181 q 1183 504 1183 399 q 1060 772 1183 668 q 771 877 937 877 q 354 735 526 877 q 183 353 183 594 q 327 20 183 140 q 689 -100 471 -100 q 898 -66 792 -100 q 1092 25 1004 -33 l 1143 -51 q 689 -204 945 -204 q 244 -54 429 -204 q 59 348 59 94 q 261 804 59 621 q 739 988 464 988 q 1134 856 964 988 q 1305 505 1305 725 q 1195 206 1305 340 q 920 72 1085 72 l 895 72 q 818 90 846 72 q 777 180 791 108 q 691 99 739 127 q 581 72 643 72 m 693 578 q 552 487 600 578 q 505 294 505 397 q 532 207 505 245 q 606 169 560 169 q 712 212 668 169 q 772 322 756 256 l 808 466 q 773 546 804 515 q 693 578 742 578 "},"Ί":{"x_min":-28,"x_max":728,"ha":822,"o":"m 485 402 q 481 715 485 609 q 468 931 477 822 q 535 925 498 929 q 594 922 572 922 q 666 927 620 922 q 727 931 713 931 q 714 716 717 819 q 711 465 711 613 q 714 221 711 326 q 728 0 718 116 q 647 2 704 0 q 588 5 590 5 l 469 0 q 481 199 477 88 q 485 402 485 310 m 157 953 q 210 1001 190 986 q 258 1017 230 1017 q 311 994 290 1017 q 332 943 332 972 q 313 897 332 916 q 264 863 294 878 l 40 755 l -28 755 l 157 953 "},"ö":{"x_min":32,"x_max":743,"ha":775,"o":"m 395 683 q 647 588 551 683 q 743 337 743 494 q 648 79 743 173 q 387 -15 554 -15 q 129 78 227 -15 q 32 333 32 172 q 130 590 32 497 q 395 683 229 683 m 257 976 q 324 948 296 976 q 352 878 352 920 q 325 811 352 839 q 258 784 299 784 q 190 811 221 784 q 160 878 160 839 q 188 947 160 918 q 257 976 217 976 m 517 976 q 585 948 557 976 q 613 878 613 920 q 586 811 613 839 q 519 784 560 784 q 450 811 479 784 q 421 878 421 839 q 449 947 421 918 q 517 976 478 976 m 269 174 q 307 85 277 120 q 387 50 337 50 q 466 84 437 50 q 500 156 494 119 q 511 215 507 194 q 517 335 517 271 q 511 450 517 395 q 500 509 507 471 q 466 582 494 548 q 387 616 439 616 q 294 564 319 616 q 263 459 269 513 q 258 333 258 406 q 260 244 258 270 q 269 174 262 217 "},"i":{"x_min":80,"x_max":314.71875,"ha":396,"o":"m 196 1014 q 273 980 240 1014 q 307 902 307 947 q 274 825 307 858 q 196 793 241 793 q 118 824 151 793 q 85 902 85 856 q 118 980 85 947 q 196 1014 151 1014 m 91 127 l 91 543 l 80 666 q 140 660 109 663 q 196 658 171 658 q 253 660 223 658 q 314 666 284 663 l 301 545 l 301 319 q 302 145 301 206 q 312 0 304 84 l 194 4 l 81 0 q 88 64 85 33 q 91 127 91 95 "},"Β":{"x_min":91,"x_max":773,"ha":815,"o":"m 109 208 l 109 465 q 105 714 109 605 q 91 932 102 823 l 250 929 l 417 929 q 655 881 560 929 q 751 707 751 834 q 692 566 751 618 q 542 503 634 515 l 542 491 q 704 431 636 491 q 773 276 773 372 q 678 69 773 138 q 438 0 584 0 l 250 4 q 152 2 211 4 q 91 0 92 0 q 103 104 97 51 q 109 208 109 158 m 519 698 q 479 803 519 763 q 374 844 440 844 l 335 839 q 331 687 331 766 l 331 540 q 466 578 413 540 q 519 698 519 617 m 380 87 q 490 137 450 87 q 531 258 531 187 q 484 392 531 338 q 360 446 437 446 l 331 446 l 331 276 l 335 91 l 380 87 "},"≤":{"x_min":170.984375,"x_max":962.28125,"ha":1139,"o":"m 960 690 l 403 514 l 960 338 l 960 200 l 171 455 l 170 572 l 960 830 l 960 690 m 962 132 l 962 0 l 171 0 l 171 132 l 962 132 "},"υ":{"x_min":82,"x_max":765,"ha":843,"o":"m 765 416 q 663 115 765 245 q 401 -15 562 -15 q 162 56 243 -15 q 82 284 82 128 l 86 479 q 84 590 86 523 q 82 666 82 656 q 145 663 99 666 q 195 661 191 661 q 263 663 216 661 q 311 666 309 666 q 295 477 301 566 q 290 294 290 387 q 310 122 290 193 q 402 52 330 52 q 515 146 487 52 q 544 351 544 240 q 525 502 544 433 q 469 656 507 570 q 580 659 528 656 q 684 673 632 662 q 743 548 721 614 q 765 416 765 482 "},"]":{"x_min":76,"x_max":385.71875,"ha":454,"o":"m 80 -129 l 76 -85 l 227 -88 q 231 134 227 -14 q 235 356 235 282 q 231 605 235 438 q 227 855 227 771 l 164 855 l 76 855 l 80 885 q 80 908 80 896 q 76 931 77 925 l 230 926 l 385 933 l 373 566 l 373 359 l 373 199 l 383 -164 l 227 -157 q 141 -160 195 -157 q 76 -164 86 -164 l 80 -129 "},"m":{"x_min":80,"x_max":1135,"ha":1217,"o":"m 91 329 q 85 517 91 394 q 80 667 80 640 l 184 662 l 293 666 l 293 571 q 392 651 334 619 q 511 683 450 683 q 628 653 579 683 q 700 559 676 623 q 791 651 733 620 q 921 683 849 683 q 1068 624 1011 683 q 1125 477 1125 566 l 1125 331 q 1130 158 1125 274 q 1135 0 1135 41 q 1070 2 1116 0 q 1019 5 1024 5 q 954 2 999 5 q 905 0 909 0 q 910 155 905 51 q 915 298 915 259 l 915 385 q 896 506 915 458 q 818 554 877 554 q 755 528 779 554 q 719 460 730 502 q 712 381 714 426 q 710 319 710 335 q 715 153 710 265 q 720 0 720 41 q 656 3 694 0 q 608 6 617 6 q 544 3 585 6 q 496 0 504 0 q 501 155 496 51 q 506 298 506 259 l 506 385 q 487 505 506 456 q 409 554 469 554 q 346 528 370 554 q 310 460 321 502 q 303 381 305 426 q 301 319 301 335 q 306 153 301 265 q 311 0 311 41 q 243 3 284 0 q 195 6 202 6 q 128 3 170 6 q 80 0 86 0 q 85 163 80 53 q 91 329 91 273 "},"χ":{"x_min":15.28125,"x_max":730.5625,"ha":731,"o":"m 569 380 l 472 204 l 545 31 q 631 -159 586 -62 q 729 -368 676 -255 l 600 -363 q 475 -371 537 -363 q 404 -147 438 -259 l 350 1 l 268 -155 q 218 -260 242 -204 q 176 -371 194 -316 q 105 -363 143 -363 q 16 -371 62 -363 q 97 -240 52 -319 q 197 -66 141 -162 l 298 111 l 168 423 q 130 509 148 466 q 63 568 101 563 l 15 564 l 15 638 q 166 683 83 683 q 286 628 252 683 q 367 445 320 573 l 422 318 l 499 479 q 572 665 544 582 l 634 662 q 697 665 674 662 q 730 668 719 668 l 569 380 "},"ί":{"x_min":80,"x_max":478.609375,"ha":396,"o":"m 91 126 l 91 543 l 80 666 q 139 660 105 663 q 196 658 173 658 q 264 660 238 658 q 314 666 291 663 q 304 586 307 616 q 301 523 301 557 l 301 113 q 302 72 301 88 q 314 0 304 56 l 195 4 l 81 0 q 87 67 84 30 q 91 126 91 104 m 303 953 q 357 1001 337 986 q 406 1017 377 1017 q 457 994 437 1017 q 478 943 478 972 q 459 897 478 915 q 410 863 441 878 l 187 755 l 118 755 l 303 953 "},"Ζ":{"x_min":25,"x_max":831.953125,"ha":831,"o":"m 25 54 q 186 311 81 142 q 354 582 291 480 q 495 813 418 685 l 294 813 q 98 801 186 813 l 105 852 q 98 932 105 894 l 444 926 q 657 928 509 926 q 815 931 805 931 l 815 903 q 573 517 695 715 q 331 119 451 320 l 566 119 q 706 122 654 119 q 831 136 758 125 q 826 43 826 96 l 827 0 q 606 3 761 0 q 443 6 451 6 q 203 3 370 6 q 25 0 36 0 l 25 54 "},"R":{"x_min":87,"x_max":860.609375,"ha":836,"o":"m 106 398 q 96 663 106 486 q 87 931 87 841 l 182 927 q 295 932 207 927 q 420 938 382 938 q 699 874 625 938 q 773 697 773 811 q 713 538 773 603 q 560 465 654 474 q 701 235 627 350 q 860 0 775 120 l 753 5 l 578 0 q 469 202 531 100 q 320 438 408 304 l 320 258 q 322 114 320 154 q 331 0 324 75 q 261 3 304 0 q 211 6 217 6 q 140 3 184 6 q 87 0 95 0 q 96 198 87 65 q 106 398 106 331 m 544 689 q 505 805 544 760 q 397 850 467 850 l 324 850 l 320 696 l 320 506 q 483 548 422 506 q 544 689 544 590 "},"×":{"x_min":183.828125,"x_max":970.171875,"ha":1139,"o":"m 577 501 l 877 800 l 970 706 l 670 408 l 970 106 l 876 13 l 577 314 l 277 13 l 184 106 l 483 408 l 183 706 l 277 800 l 577 501 "},"o":{"x_min":30,"x_max":741,"ha":774,"o":"m 395 683 q 645 587 550 683 q 741 337 741 492 q 646 79 741 173 q 385 -15 552 -15 q 127 78 225 -15 q 30 333 30 172 q 129 590 30 498 q 395 683 228 683 m 269 174 q 305 85 275 119 q 386 52 335 52 q 464 85 436 52 q 503 172 491 119 q 510 237 506 194 q 515 336 515 279 q 510 431 515 391 q 503 494 506 472 q 464 581 491 548 q 385 615 436 615 q 291 563 315 615 q 261 459 267 512 q 256 333 256 407 q 269 174 256 248 "},"K":{"x_min":90,"x_max":892.78125,"ha":856,"o":"m 334 716 l 334 515 l 569 787 q 635 866 619 845 q 682 932 651 886 l 767 926 q 817 929 784 926 q 870 932 851 932 q 687 746 790 851 q 503 554 585 641 l 623 377 q 892 0 753 179 l 753 5 q 664 2 727 5 q 595 0 600 0 q 484 190 545 98 q 334 404 424 281 l 334 193 q 348 0 334 94 q 270 2 325 0 q 212 5 215 5 l 90 0 q 99 236 90 69 q 108 461 108 402 q 103 623 108 515 q 99 787 99 731 l 90 932 q 157 927 113 932 q 219 922 201 922 q 282 925 252 922 q 342 932 312 927 q 338 831 342 907 q 334 716 334 755 "},",":{"x_min":25,"x_max":319.4375,"ha":375,"o":"m 109 121 q 146 203 119 168 q 218 238 173 238 q 289 208 259 238 q 319 136 319 178 q 313 101 319 118 q 294 64 306 85 l 62 -253 l 25 -238 l 109 121 "},"d":{"x_min":54,"x_max":744,"ha":825,"o":"m 318 -15 q 115 84 177 -15 q 54 336 54 184 q 124 583 54 483 q 336 683 194 683 q 525 584 451 683 l 525 738 l 518 1024 q 581 1016 554 1019 q 630 1013 609 1013 q 678 1015 653 1013 q 744 1023 703 1018 q 740 900 744 983 q 736 775 736 816 q 738 403 736 627 q 740 176 740 179 l 744 0 q 680 3 721 0 q 630 6 638 6 q 568 3 608 6 q 520 0 528 0 q 523 39 522 16 q 525 85 525 62 q 430 8 477 32 q 318 -15 383 -15 m 396 587 q 328 562 355 587 q 289 499 300 538 q 273 409 277 460 q 269 316 269 358 q 295 158 269 227 q 396 89 321 89 q 501 167 473 89 q 530 338 530 245 q 503 511 530 435 q 396 587 477 587 "},"¨":{"x_min":65.28125,"x_max":609.71875,"ha":654,"o":"m 251 613 q 218 541 243 570 q 154 512 194 512 q 90 537 116 512 q 65 601 65 563 q 87 665 65 634 l 291 949 l 331 933 l 251 613 m 530 613 q 498 542 525 573 q 433 512 472 512 q 371 536 397 512 q 345 598 345 560 q 366 665 345 633 l 570 949 l 609 933 l 530 613 "},"E":{"x_min":90,"x_max":644.15625,"ha":703,"o":"m 108 222 l 108 465 q 104 710 108 620 q 91 932 101 800 l 357 926 q 520 929 405 926 q 644 932 634 932 q 640 903 641 916 q 638 872 638 890 q 639 848 638 857 q 644 810 640 840 q 530 815 606 810 q 414 820 453 820 l 338 820 l 334 545 l 634 557 q 630 527 631 541 q 628 494 628 514 l 633 431 q 459 437 571 431 q 334 444 347 444 l 334 296 q 336 190 334 264 q 338 113 338 115 q 638 129 489 113 l 634 63 l 638 0 q 433 3 562 0 q 278 7 305 7 q 169 3 235 7 q 90 0 102 0 q 102 114 96 54 q 108 222 108 175 "},"Y":{"x_min":-30,"x_max":797,"ha":747,"o":"m 136 650 q 67 772 123 672 q -30 932 10 872 l 92 926 q 184 929 120 926 q 256 931 249 931 q 345 740 304 825 q 442 554 386 656 q 541 730 492 636 q 637 931 589 825 l 712 926 q 753 929 726 926 q 797 931 781 931 q 644 689 714 812 q 498 420 573 566 l 502 143 l 508 0 l 414 5 l 256 0 q 262 138 256 50 q 269 237 269 226 l 269 402 l 136 650 "},"\\"":{"x_min":53,"x_max":399,"ha":451,"o":"m 181 958 l 181 586 l 53 586 l 53 958 l 181 958 m 399 958 l 399 586 l 271 586 l 271 958 l 399 958 "},"ê":{"x_min":41,"x_max":684.046875,"ha":729,"o":"m 482 98 q 566 112 532 98 q 643 160 600 126 l 661 151 q 643 96 652 125 q 628 40 634 66 q 521 -1 577 11 q 403 -15 466 -15 q 141 79 241 -15 q 41 336 41 173 q 137 586 41 490 q 386 683 234 683 q 608 601 532 683 q 684 373 684 520 l 684 332 l 267 332 q 325 165 267 232 q 482 98 383 98 m 302 1001 l 426 1001 l 577 754 l 512 754 l 364 876 l 216 754 l 149 754 l 302 1001 m 478 411 q 481 444 481 422 q 459 566 481 513 q 377 620 438 620 q 292 562 318 620 q 267 437 267 505 l 267 411 l 478 411 "},"δ":{"x_min":30,"x_max":688,"ha":719,"o":"m 543 794 q 498 889 531 854 q 407 924 465 924 q 329 895 362 924 q 296 822 296 867 q 393 671 296 739 q 585 539 490 603 q 688 308 688 444 q 600 71 688 157 q 359 -15 513 -15 q 119 70 209 -15 q 30 305 30 155 q 88 503 30 419 q 256 614 147 586 q 130 696 178 650 q 82 812 82 743 q 173 968 82 916 q 374 1021 263 1021 q 629 946 510 1021 q 606 875 617 912 q 582 788 596 839 l 543 794 m 269 163 q 296 83 276 114 q 360 52 317 52 q 435 95 414 52 q 462 204 456 139 l 462 306 l 462 407 q 438 513 462 464 q 363 561 415 561 q 298 529 321 561 q 269 449 274 496 q 260 382 263 421 q 258 306 258 343 q 260 227 258 249 q 269 163 262 206 "},"έ":{"x_min":55,"x_max":667.5,"ha":657,"o":"m 512 501 q 472 579 502 548 q 396 611 442 611 q 323 577 352 611 q 295 498 295 544 q 316 429 295 458 q 375 394 337 399 l 450 394 l 450 373 q 450 336 450 349 q 450 316 450 323 q 414 319 438 319 q 322 280 361 319 q 283 194 283 242 q 323 101 283 144 q 413 59 363 59 q 498 88 461 59 q 572 167 536 117 l 600 155 q 594 130 596 144 q 593 104 593 115 q 593 82 593 90 q 600 53 593 74 q 351 -15 486 -15 q 145 30 236 -15 q 55 176 55 75 q 105 289 55 244 q 233 360 156 335 q 127 421 167 385 q 88 516 88 456 q 165 643 88 603 q 340 683 243 683 q 593 612 480 683 q 565 556 576 583 q 551 501 555 530 l 512 501 m 492 955 q 545 1003 525 988 q 595 1019 566 1019 q 646 996 625 1019 q 667 945 667 974 q 648 899 667 917 q 600 865 630 880 l 375 757 l 306 757 l 492 955 "},"ω":{"x_min":30,"x_max":1059,"ha":1093,"o":"m 335 -15 q 111 79 192 -15 q 30 321 30 173 q 72 505 30 421 q 192 667 114 589 q 297 661 237 661 q 347 663 319 661 q 390 667 374 665 q 247 281 247 499 q 269 123 247 195 q 358 52 291 52 q 421 86 399 52 q 443 165 443 121 l 443 291 q 441 415 443 379 q 435 512 440 451 q 510 505 499 505 q 544 505 522 505 q 608 508 579 505 q 657 512 636 511 q 648 402 652 465 q 644 289 644 340 q 644 237 644 258 q 650 165 644 215 q 669 85 650 119 q 730 52 688 52 q 821 122 798 52 q 844 279 844 192 q 807 481 844 386 q 700 666 771 576 q 746 662 724 663 q 793 661 767 661 q 846 664 812 661 q 898 667 881 667 q 1016 508 974 595 q 1059 322 1059 422 q 974 83 1059 182 q 753 -15 890 -15 q 630 13 685 -15 q 545 100 575 41 q 459 14 516 44 q 335 -15 402 -15 "},"´":{"x_min":70.828125,"x_max":337.5,"ha":374,"o":"m 70 528 l 151 848 q 183 919 158 889 q 244 949 208 949 q 310 924 283 949 q 337 862 337 900 q 331 829 337 845 q 316 797 326 813 l 111 511 l 70 528 "},"±":{"x_min":169,"x_max":969,"ha":1139,"o":"m 636 815 l 636 597 l 969 597 l 969 465 l 636 465 l 636 246 l 501 246 l 501 465 l 169 465 l 169 597 l 501 597 l 501 815 l 636 815 m 969 132 l 969 0 l 169 0 l 169 132 l 969 132 "},"|":{"x_min":272,"x_max":411,"ha":683,"o":"m 411 956 l 411 447 l 272 447 l 272 956 l 411 956 m 411 272 l 411 -233 l 272 -233 l 272 272 l 411 272 "},"ϋ":{"x_min":82,"x_max":765,"ha":843,"o":"m 765 415 q 663 114 765 244 q 401 -15 562 -15 q 162 56 243 -15 q 82 284 82 127 l 86 478 q 84 589 86 523 q 82 666 82 656 q 145 663 99 666 q 195 661 191 661 q 263 663 216 661 q 311 666 309 666 q 295 476 301 566 q 290 294 290 387 q 310 122 290 193 q 402 52 330 52 q 515 146 487 52 q 544 351 544 240 q 525 502 544 433 q 469 657 507 570 q 580 659 528 657 q 684 672 632 662 q 743 547 721 613 q 765 415 765 482 m 262 975 q 329 947 301 975 q 357 879 357 919 q 331 811 357 840 q 265 783 305 783 q 195 810 226 783 q 165 879 165 838 q 192 947 165 919 q 262 975 220 975 m 522 975 q 589 947 561 975 q 617 879 617 919 q 591 811 617 840 q 525 783 565 783 q 456 811 486 783 q 427 879 427 840 q 454 947 427 919 q 522 975 482 975 "},"§":{"x_min":61,"x_max":685,"ha":743,"o":"m 118 39 l 136 38 q 207 -72 149 -32 q 341 -113 265 -113 q 441 -84 398 -113 q 485 -1 485 -56 q 378 121 485 73 q 170 213 272 169 q 61 386 61 277 q 95 495 61 437 q 175 584 129 554 q 133 649 148 615 q 118 721 118 683 q 206 887 118 825 q 406 949 295 949 q 531 937 479 949 q 630 895 583 926 q 598 826 613 860 q 570 754 583 791 l 558 754 q 499 848 548 812 q 388 884 451 884 q 300 858 340 884 q 261 785 261 832 q 366 672 261 717 q 575 583 472 626 q 685 414 685 519 q 657 302 685 354 q 580 216 630 250 q 622 149 602 197 q 643 68 643 101 q 545 -116 643 -51 q 322 -182 447 -182 q 197 -171 255 -182 q 86 -135 138 -161 q 118 39 106 -38 m 197 478 q 310 346 197 400 q 521 249 423 293 q 546 312 546 274 q 433 432 546 379 q 224 528 320 485 q 197 478 201 508 "},"b":{"x_min":79,"x_max":772,"ha":825,"o":"m 89 647 q 84 844 89 712 q 79 1024 79 977 q 136 1018 105 1021 q 192 1015 167 1015 q 249 1018 217 1015 q 306 1023 280 1020 l 299 724 l 299 578 q 389 656 339 630 q 505 683 439 683 q 704 581 637 683 q 772 340 772 479 q 694 88 772 191 q 470 -15 617 -15 q 340 15 400 -15 q 237 104 280 45 q 202 74 215 87 q 136 1 190 62 l 79 1 q 84 357 79 132 q 89 647 89 583 m 430 586 q 318 512 346 586 q 291 338 291 438 q 316 162 291 238 q 424 86 342 86 q 528 159 503 86 q 554 331 554 233 q 531 510 554 434 q 430 586 508 586 "},"q":{"x_min":51,"x_max":741,"ha":825,"o":"m 331 -15 q 121 81 191 -15 q 51 323 51 177 q 117 576 51 469 q 323 683 184 683 q 523 580 446 683 l 523 605 q 516 666 523 631 q 586 660 568 661 q 627 659 604 659 q 741 666 675 659 q 738 416 741 561 q 732 125 735 271 q 730 -124 730 -19 q 735 -246 730 -164 q 741 -371 741 -328 q 687 -363 718 -366 q 628 -361 656 -361 q 563 -363 581 -361 q 514 -372 545 -365 l 523 -58 l 523 85 q 437 10 482 35 q 331 -15 392 -15 m 386 81 q 484 135 452 81 q 523 261 516 189 l 523 300 q 523 351 523 330 q 523 392 523 372 q 490 518 523 460 q 393 576 458 576 q 290 502 314 576 q 266 327 266 429 q 288 155 266 229 q 386 81 310 81 "},"Ω":{"x_min":36,"x_max":1174.890625,"ha":1211,"o":"m 1173 129 q 1170 103 1170 116 q 1170 83 1170 90 l 1170 70 q 1170 36 1170 52 q 1174 0 1170 19 l 953 4 l 715 0 l 715 103 q 848 251 813 162 q 883 473 883 340 q 815 741 883 623 q 607 860 747 860 q 396 738 461 860 q 331 457 331 616 q 369 245 331 339 q 496 102 407 152 l 496 0 l 256 4 l 36 0 l 38 80 l 36 129 q 264 113 151 113 q 128 258 172 167 q 85 464 85 350 q 235 821 85 693 q 622 949 386 949 q 988 830 846 949 q 1130 491 1130 712 q 1082 272 1130 363 q 928 112 1034 180 q 1173 129 1049 112 "},"ύ":{"x_min":82,"x_max":765,"ha":843,"o":"m 765 415 q 663 114 765 244 q 400 -15 561 -15 q 162 56 242 -15 q 82 284 82 128 l 86 479 q 84 590 86 523 q 82 666 82 656 q 145 663 99 666 q 195 661 191 661 q 263 663 216 661 q 311 666 309 666 q 295 477 301 566 q 290 294 290 387 q 310 122 290 193 q 402 52 330 52 q 515 146 487 52 q 544 351 544 240 q 525 502 544 433 q 469 656 507 570 q 580 659 528 656 q 684 672 632 662 q 743 547 721 613 q 765 415 765 482 m 548 953 q 601 1001 581 986 q 651 1017 621 1017 q 702 994 681 1017 q 723 943 723 972 q 704 897 723 916 q 655 863 685 878 l 431 755 l 362 755 l 548 953 "},"Ö":{"x_min":40,"x_max":1087,"ha":1129,"o":"m 577 949 q 946 829 805 949 q 1087 486 1087 710 q 942 115 1087 246 q 552 -15 798 -15 q 176 107 313 -15 q 40 465 40 229 q 188 823 40 697 q 577 949 337 949 m 434 1242 q 501 1215 473 1242 q 529 1148 529 1189 q 502 1079 529 1108 q 435 1050 476 1050 q 366 1079 396 1050 q 337 1148 337 1109 q 366 1214 337 1186 q 434 1242 395 1242 m 693 1242 q 761 1215 733 1242 q 789 1148 789 1189 q 762 1079 789 1108 q 695 1050 736 1050 q 627 1079 655 1050 q 600 1148 600 1108 q 627 1214 600 1186 q 693 1242 655 1242 m 562 71 q 774 194 706 71 q 843 470 843 318 q 774 742 843 623 q 563 861 706 861 q 353 741 420 861 q 287 465 287 622 q 354 191 287 312 q 562 71 421 71 "},"z":{"x_min":19.4375,"x_max":640.28125,"ha":664,"o":"m 19 75 q 118 216 33 94 q 257 415 204 337 q 359 567 311 493 l 255 568 q 151 562 205 568 q 65 552 97 556 l 68 608 l 65 667 l 337 660 q 507 663 404 660 q 627 666 611 666 l 627 588 q 515 441 573 519 q 399 276 458 362 q 280 98 340 190 l 375 96 q 506 101 418 96 q 640 107 595 107 q 638 76 638 93 q 637 51 637 59 l 637 34 l 640 0 q 459 3 568 0 q 333 7 351 7 q 147 3 259 7 q 19 0 36 0 l 19 75 "},"™":{"x_min":136,"x_max":964,"ha":1138,"o":"m 461 975 l 461 900 l 350 900 l 350 610 l 249 610 l 249 900 l 136 900 l 136 975 l 461 975 m 666 974 l 751 751 l 833 974 l 964 975 l 964 610 l 874 610 l 874 882 l 772 610 l 730 610 l 625 881 l 625 610 l 535 610 l 535 975 l 666 974 "},"ή":{"x_min":80,"x_max":727,"ha":808,"o":"m 91 339 q 85 512 91 391 q 80 667 80 632 q 137 661 125 662 q 180 661 149 661 q 244 663 199 661 q 293 666 290 666 l 293 568 q 391 651 338 622 q 511 681 443 681 q 660 622 602 681 q 719 471 719 564 l 719 327 l 719 -50 q 723 -219 719 -107 q 727 -374 727 -332 q 618 -365 670 -365 q 502 -373 562 -365 l 512 16 l 512 251 l 512 368 q 491 499 512 446 q 408 552 471 552 q 319 488 342 552 q 302 419 305 457 q 299 330 299 382 q 304 148 299 264 q 309 0 309 33 q 243 3 278 0 q 195 6 207 6 q 127 3 163 6 q 80 0 92 0 q 85 188 80 65 q 91 339 91 311 m 552 953 q 605 1001 585 986 q 654 1017 625 1017 q 706 994 685 1017 q 727 943 727 972 q 708 897 727 916 q 658 863 689 878 l 435 756 l 366 756 l 552 953 "},"Θ":{"x_min":40,"x_max":1087,"ha":1129,"o":"m 51 585 q 235 855 85 761 q 577 949 385 949 q 944 829 802 949 q 1087 487 1087 710 q 941 116 1087 247 q 552 -15 796 -15 q 176 107 313 -15 q 40 465 40 229 q 41 510 40 492 q 51 585 42 528 m 559 73 q 771 194 703 73 q 840 472 840 315 q 773 742 840 624 q 566 860 706 860 q 353 742 420 860 q 287 465 287 624 q 353 193 287 314 q 559 73 419 73 m 566 525 q 678 528 610 525 q 755 532 745 532 l 754 539 l 754 472 l 754 403 l 755 407 l 563 414 l 373 407 l 373 469 l 373 531 q 484 528 416 531 q 566 525 553 525 "},"®":{"x_min":72,"x_max":1065,"ha":1138,"o":"m 1065 488 q 917 139 1065 285 q 567 -6 770 -6 q 219 139 366 -6 q 72 488 72 285 q 219 836 72 688 q 567 985 367 985 q 917 839 770 985 q 1065 488 1065 693 m 155 488 q 276 197 155 320 q 566 75 398 75 q 858 197 734 75 q 983 487 983 320 q 860 780 983 656 q 567 904 738 904 q 277 780 399 904 q 155 488 155 656 m 577 774 q 741 740 670 774 q 812 625 812 707 q 778 527 812 569 q 692 468 745 484 l 811 223 l 666 222 l 561 447 l 497 447 l 497 223 l 361 223 l 361 774 l 577 774 m 497 528 l 562 528 q 641 546 609 528 q 673 608 673 564 q 655 660 673 638 q 607 685 638 682 q 555 691 584 691 l 497 691 l 497 528 "},"É":{"x_min":90,"x_max":644.15625,"ha":703,"o":"m 108 223 l 108 465 q 104 713 108 622 q 91 933 101 804 l 357 929 l 644 933 l 640 872 l 644 811 q 530 816 606 811 q 415 822 453 822 l 340 822 q 337 663 340 774 q 334 545 334 551 l 634 557 q 631 521 634 546 q 628 493 628 496 q 630 458 628 477 q 634 429 633 440 q 476 436 587 429 q 334 444 365 444 l 334 294 q 335 203 334 249 q 340 111 336 156 q 483 114 419 111 q 640 128 546 118 q 634 65 634 100 q 635 37 634 47 q 640 0 635 27 q 427 3 556 0 q 280 7 298 7 q 169 3 242 7 q 90 0 95 0 q 102 117 97 59 q 108 223 108 175 m 410 1222 q 465 1272 445 1257 q 515 1288 485 1288 q 566 1265 545 1288 q 587 1215 587 1243 q 568 1169 587 1189 q 519 1133 549 1148 l 294 1025 l 225 1025 l 410 1222 "},"~":{"x_min":266,"x_max":1091,"ha":1367,"o":"m 1091 938 q 1033 721 1091 807 q 847 636 975 636 q 661 720 757 636 q 518 805 564 805 q 427 756 453 805 q 402 636 402 708 l 266 636 q 327 849 266 761 q 510 938 388 938 q 696 853 599 938 q 846 768 793 768 q 933 815 911 768 q 956 938 956 863 l 1091 938 "},"Ε":{"x_min":90,"x_max":644.15625,"ha":703,"o":"m 108 222 l 108 465 q 104 710 108 620 q 91 932 101 800 l 357 926 q 520 929 405 926 q 644 932 634 932 q 640 903 641 916 q 638 872 638 890 q 639 848 638 857 q 644 810 640 840 q 530 815 606 810 q 414 820 453 820 l 338 820 l 334 545 l 634 557 q 630 527 631 541 q 628 494 628 514 l 633 431 q 459 437 571 431 q 334 444 347 444 l 334 296 q 336 190 334 264 q 338 113 338 115 q 638 129 489 113 l 634 63 l 638 0 q 433 3 562 0 q 278 7 305 7 q 169 3 235 7 q 90 0 102 0 q 102 114 96 54 q 108 222 108 175 "},"³":{"x_min":18,"x_max":448,"ha":494,"o":"m 242 899 q 370 867 315 899 q 425 770 425 836 q 399 699 425 730 q 301 645 373 667 q 403 605 359 642 q 448 512 448 569 q 375 384 448 426 q 210 342 303 342 q 108 352 152 342 q 18 391 65 362 q 88 505 60 451 l 98 505 q 119 420 98 452 q 191 388 141 388 q 263 421 237 388 q 290 501 290 454 q 262 580 290 549 q 186 612 235 612 l 151 612 l 151 660 l 181 658 q 259 684 228 658 q 290 759 290 710 q 268 828 290 800 q 207 856 246 856 q 141 821 163 856 q 119 742 119 787 l 110 736 q 26 815 75 777 q 120 876 53 854 q 242 899 187 899 "},"[":{"x_min":104,"x_max":415.109375,"ha":454,"o":"m 409 883 l 415 852 l 261 855 l 257 541 q 261 212 257 433 q 266 -86 266 -8 l 327 -88 l 415 -88 l 409 -117 q 415 -162 409 -142 l 261 -157 l 104 -164 q 110 154 104 -50 q 117 383 117 359 q 110 703 117 496 q 104 933 104 909 q 194 929 138 933 q 258 926 249 926 q 347 929 284 926 q 415 933 410 933 q 409 883 409 911 "},"L":{"x_min":91,"x_max":639.609375,"ha":650,"o":"m 109 465 q 105 710 109 620 q 91 932 102 800 l 216 927 l 350 931 q 337 618 337 783 l 337 296 q 337 201 337 249 q 341 113 337 153 q 639 129 491 113 l 635 63 l 639 0 q 434 3 563 0 q 279 7 306 7 q 170 3 236 7 q 91 0 103 0 q 105 209 102 102 q 109 465 109 316 "},"σ":{"x_min":30,"x_max":832,"ha":826,"o":"m 679 557 q 730 451 724 495 q 738 384 736 407 q 741 339 741 361 q 738 277 741 295 q 726 190 736 259 q 617 53 716 121 q 385 -15 518 -15 q 126 78 223 -15 q 30 336 30 172 q 127 588 30 494 q 384 683 224 683 q 536 671 432 683 q 677 660 639 660 q 765 663 705 660 q 831 666 825 666 q 827 611 827 637 l 827 594 l 832 552 l 702 557 l 679 557 m 256 333 q 269 174 256 248 q 304 88 275 124 q 381 52 332 52 q 475 104 443 52 q 508 221 508 156 q 512 258 509 235 q 515 323 515 282 q 512 411 515 370 q 508 444 509 427 q 479 563 508 511 q 389 615 450 615 q 299 565 327 615 q 263 450 271 516 q 256 333 256 384 "},"ζ":{"x_min":64,"x_max":667,"ha":656,"o":"m 231 360 l 231 340 l 231 314 q 343 192 231 217 q 554 162 448 176 q 667 24 667 133 q 628 -103 667 -42 q 525 -221 589 -164 l 458 -181 q 505 -114 493 -134 q 521 -63 516 -95 q 375 13 521 -6 q 146 71 229 33 q 64 260 64 110 q 123 495 64 382 q 257 692 182 608 q 467 905 333 776 q 278 903 353 905 q 122 893 204 901 l 126 958 l 122 1024 q 255 1019 166 1024 q 389 1015 344 1015 q 511 1019 429 1015 q 635 1024 593 1024 l 630 978 l 634 934 q 433 764 520 848 q 288 578 346 680 q 231 360 231 476 "},"θ":{"x_min":34,"x_max":710,"ha":749,"o":"m 710 450 q 636 110 710 240 q 367 -19 562 -19 q 104 103 175 -19 q 34 434 34 226 q 106 774 34 641 q 368 908 178 908 q 637 785 565 908 q 710 450 710 662 m 370 416 q 305 413 351 416 q 255 410 259 410 q 257 322 255 371 q 266 208 259 273 q 292 96 272 143 q 370 49 312 49 q 429 72 406 49 q 463 135 452 96 q 479 263 474 192 q 484 410 484 335 q 418 413 464 410 q 370 416 372 416 m 484 601 q 464 769 484 698 q 372 840 445 840 q 277 759 300 840 q 255 560 255 679 l 255 492 l 372 488 l 488 492 l 484 601 "},"Ο":{"x_min":40,"x_max":1086,"ha":1129,"o":"m 577 949 q 945 829 804 949 q 1086 486 1086 710 q 942 114 1086 244 q 552 -15 798 -15 q 176 107 313 -15 q 40 465 40 229 q 188 823 40 697 q 577 949 337 949 m 562 73 q 773 194 706 73 q 840 472 840 315 q 773 742 840 624 q 566 860 706 860 q 353 742 420 860 q 287 465 287 624 q 353 193 287 313 q 562 73 420 73 "},"Γ":{"x_min":91,"x_max":639.609375,"ha":650,"o":"m 232 926 l 449 926 l 639 932 l 635 866 l 639 802 q 485 815 548 812 q 341 819 423 819 q 338 769 339 805 q 337 681 337 734 l 337 635 l 337 312 q 339 138 337 195 q 351 0 341 81 l 216 4 l 91 0 q 100 238 91 70 q 109 465 109 406 q 105 713 109 613 q 91 932 102 813 q 161 929 114 932 q 232 926 209 926 "}," ":{"x_min":0,"x_max":0,"ha":375},"%":{"x_min":28,"x_max":1085,"ha":1122,"o":"m 265 910 q 434 844 369 910 q 500 672 500 779 q 435 496 500 562 q 258 431 370 431 q 91 498 154 431 q 28 669 28 565 q 93 843 28 776 q 265 910 158 910 m 831 1015 l 917 1014 l 272 -125 l 184 -125 l 831 1015 m 849 463 q 1020 401 955 463 q 1085 230 1085 339 q 1023 51 1085 117 q 845 -15 961 -15 q 677 51 742 -15 q 612 222 612 118 q 675 398 612 333 q 849 463 738 463 m 196 561 q 214 505 196 532 q 261 478 232 478 q 297 489 280 478 q 323 525 314 501 q 335 586 332 548 q 339 669 339 625 q 337 723 339 697 q 332 780 336 749 q 311 836 327 811 q 264 861 296 861 q 204 820 222 861 q 191 752 194 786 q 188 669 188 719 q 196 561 188 615 m 779 112 q 797 57 779 83 q 847 31 816 31 q 895 59 873 31 q 916 114 916 87 q 922 222 922 162 q 922 275 922 248 q 915 338 917 312 q 896 389 912 364 q 848 414 880 414 q 812 404 827 414 q 791 375 797 394 q 776 312 780 347 q 772 241 772 276 l 772 222 q 772 183 772 201 q 779 112 773 165 "},"P":{"x_min":91,"x_max":765,"ha":801,"o":"m 334 201 q 335 129 334 148 q 348 0 336 110 q 272 3 317 0 q 219 6 226 6 q 143 3 189 6 q 91 0 97 0 q 104 212 100 112 q 108 462 108 313 q 99 725 108 549 q 91 933 91 900 q 161 929 111 933 q 215 925 211 925 l 395 933 l 445 933 q 677 876 590 933 q 765 681 765 819 q 691 486 765 565 q 544 400 618 408 q 423 390 470 391 q 334 389 375 389 l 334 201 m 536 669 q 498 788 536 741 q 390 836 461 836 l 334 836 l 334 694 l 334 486 q 485 529 435 486 q 536 669 536 572 "},"Ώ":{"x_min":-28,"x_max":1452.5625,"ha":1489,"o":"m 1451 129 q 1448 104 1448 117 q 1448 83 1448 90 l 1448 70 q 1448 36 1448 52 q 1452 0 1448 19 l 1231 4 l 993 0 l 993 103 q 1126 251 1091 162 q 1161 473 1161 340 q 1092 741 1161 623 q 884 860 1024 860 q 673 738 738 860 q 608 457 608 616 q 646 245 608 339 q 774 102 684 152 l 774 0 l 534 4 l 314 0 l 316 80 l 313 129 q 542 113 429 113 q 405 258 449 167 q 362 464 362 350 q 512 821 362 693 q 899 949 663 949 q 1266 830 1124 949 q 1408 491 1408 712 q 1360 272 1408 363 q 1206 112 1312 180 q 1451 129 1327 112 m 158 953 q 211 1001 191 986 q 259 1017 231 1017 q 312 994 291 1017 q 333 943 333 972 q 314 897 333 916 q 265 863 295 878 l 40 755 l -28 755 l 158 953 "},"Έ":{"x_min":-28,"x_max":1020.609375,"ha":1078,"o":"m 485 222 l 485 465 q 481 710 485 620 q 467 931 478 800 l 733 926 q 896 929 781 926 q 1020 932 1010 932 q 1016 903 1017 916 q 1015 872 1015 890 q 1015 848 1015 857 q 1020 810 1016 839 q 906 815 983 810 q 791 820 830 820 l 715 820 l 711 544 l 1010 556 q 1006 527 1008 540 q 1005 493 1005 513 l 1009 430 q 836 436 948 430 q 711 443 724 443 l 711 296 q 713 189 711 264 q 715 113 715 115 q 1015 129 865 113 l 1010 63 l 1015 0 q 810 3 938 0 q 655 7 681 7 q 545 3 612 7 q 466 0 478 0 q 478 114 472 54 q 485 222 485 175 m 158 953 q 212 1001 191 986 q 260 1017 232 1017 q 313 994 292 1017 q 334 943 334 972 q 315 897 334 916 q 265 863 296 878 l 40 755 l -28 755 l 158 953 "},"_":{"x_min":0,"x_max":683.328125,"ha":683,"o":"m 683 -184 l 683 -322 l 0 -322 l 0 -184 l 683 -184 "},"Ϊ":{"x_min":-1,"x_max":450,"ha":449,"o":"m 110 402 q 103 709 110 511 q 97 932 97 908 q 161 926 130 929 q 220 923 192 923 q 287 927 242 923 q 351 931 331 931 q 343 688 351 859 q 336 465 336 516 q 343 221 336 391 q 351 0 351 51 q 283 2 330 0 q 212 5 236 5 l 97 0 q 103 233 97 83 q 110 402 110 383 m 93 1242 q 160 1215 132 1242 q 188 1148 188 1189 q 162 1078 188 1107 q 97 1050 136 1050 q 28 1079 57 1050 q -1 1148 -1 1108 q 26 1214 -1 1186 q 93 1242 54 1242 m 352 1242 q 421 1214 393 1242 q 450 1148 450 1187 q 423 1079 450 1108 q 356 1050 397 1050 q 286 1078 316 1050 q 257 1148 257 1107 q 286 1214 257 1186 q 352 1242 315 1242 "},"+":{"x_min":169,"x_max":968,"ha":1138,"o":"m 636 813 l 636 473 l 968 473 l 968 340 l 636 340 l 636 0 l 501 0 l 501 340 l 169 340 l 169 473 l 501 473 l 501 813 l 636 813 "},"½":{"x_min":68,"x_max":1145.765625,"ha":1171,"o":"m 207 481 l 207 736 l 207 808 q 150 784 180 798 q 103 763 120 770 l 68 813 q 195 860 131 834 q 331 918 259 886 l 348 909 q 346 744 348 844 q 344 644 344 645 l 345 650 l 345 505 l 345 511 q 345 458 345 480 q 349 391 345 437 l 299 394 q 247 392 281 394 q 198 391 213 391 l 207 481 m 844 1014 l 928 1014 l 326 -124 l 243 -124 l 844 1014 m 721 42 q 908 194 839 122 q 977 365 977 266 q 962 434 977 408 q 905 460 947 460 q 840 427 864 460 q 805 345 816 395 l 795 345 q 768 379 789 358 q 727 418 747 400 q 822 487 773 465 q 936 510 870 510 q 1068 474 1012 510 q 1124 365 1124 439 q 1035 209 1124 271 q 890 110 947 147 l 970 109 q 1070 111 999 109 q 1145 114 1140 114 q 1134 48 1134 80 q 1138 23 1134 37 q 1144 0 1143 9 l 1006 3 l 729 3 l 721 42 "},"Ρ":{"x_min":91,"x_max":765,"ha":801,"o":"m 334 201 q 335 129 334 148 q 348 0 336 110 q 272 3 317 0 q 219 6 226 6 q 143 3 189 6 q 91 0 97 0 q 104 212 100 112 q 108 462 108 313 q 99 725 108 549 q 91 933 91 900 q 161 929 111 933 q 215 925 211 925 l 395 933 l 445 933 q 677 876 590 933 q 765 681 765 819 q 691 486 765 565 q 544 400 618 408 q 423 390 470 391 q 334 389 375 389 l 334 201 m 536 669 q 498 788 536 741 q 390 836 461 836 l 334 836 l 334 694 l 334 486 q 485 529 435 486 q 536 669 536 572 "},"\'":{"x_min":72.21875,"x_max":337.5,"ha":375,"o":"m 72 528 l 152 848 q 184 919 159 889 q 245 949 209 949 q 311 923 284 949 q 337 861 337 898 q 315 797 337 827 l 112 511 l 72 528 "},"T":{"x_min":8,"x_max":738,"ha":749,"o":"m 493 818 q 490 723 493 790 q 487 652 487 656 q 490 427 487 529 q 498 201 494 326 q 503 0 503 77 q 438 2 482 0 q 374 5 395 5 q 317 3 351 5 q 244 0 284 1 q 252 266 244 88 q 261 476 261 444 q 258 670 261 533 q 255 818 255 808 q 158 815 188 818 q 8 801 128 813 l 12 872 l 8 932 q 198 927 70 932 q 373 922 327 922 q 572 927 445 922 q 738 932 700 932 l 733 870 l 738 801 q 493 818 614 818 "},"Φ":{"x_min":36,"x_max":1093,"ha":1129,"o":"m 445 960 q 513 952 484 955 q 566 950 543 950 q 634 954 599 950 q 683 960 669 958 q 676 909 680 943 q 672 858 672 876 l 751 851 q 998 732 904 829 q 1093 484 1093 634 q 980 206 1093 301 q 672 72 867 112 q 673 31 672 44 q 683 -26 674 19 q 619 -20 653 -23 q 566 -17 585 -17 q 500 -20 535 -17 q 445 -26 465 -24 q 453 17 449 -5 q 458 72 458 40 l 380 82 q 133 205 231 103 q 36 454 36 307 q 150 732 36 636 q 458 858 265 828 q 452 911 458 879 q 445 960 447 943 m 668 700 l 668 467 l 668 234 l 672 171 q 817 266 774 182 q 861 468 861 351 q 817 666 861 583 q 669 764 773 750 l 668 700 m 419 755 q 301 654 336 739 q 267 469 267 570 q 309 267 267 351 q 455 171 351 183 l 458 234 l 462 424 l 458 700 l 458 764 l 419 755 "},"j":{"x_min":-62,"x_max":313,"ha":396,"o":"m 196 660 q 235 660 215 660 q 307 666 254 661 l 306 490 q 309 182 306 369 q 313 -31 313 -4 q 217 -278 313 -195 q -49 -361 121 -361 l -62 -305 q 59 -240 24 -305 q 95 -81 95 -175 l 95 255 q 89 459 95 322 q 84 666 84 597 q 196 660 143 660 m 195 1014 q 272 980 239 1014 q 306 902 306 947 q 273 825 306 858 q 195 793 240 793 q 117 824 150 793 q 84 902 84 856 q 117 980 84 947 q 195 1014 150 1014 "},"Σ":{"x_min":18.0625,"x_max":801.390625,"ha":843,"o":"m 747 865 l 751 804 q 641 808 715 804 q 527 813 568 813 l 369 813 q 481 664 427 733 q 594 519 534 594 q 402 315 496 419 l 304 203 l 544 203 q 672 208 586 203 q 801 214 758 214 l 794 112 q 801 0 794 59 l 456 4 l 18 0 l 18 57 q 261 330 138 181 l 365 461 q 222 657 298 559 q 55 865 147 755 l 55 932 q 243 928 118 932 q 431 924 368 924 q 630 928 511 924 q 751 932 750 932 l 747 865 "},"ä":{"x_min":44,"x_max":706.78125,"ha":706,"o":"m 236 -15 q 98 35 153 -15 q 44 169 44 86 q 212 352 44 301 q 401 421 380 403 q 410 439 410 432 q 373 539 410 502 q 275 577 337 577 q 140 511 185 577 l 135 511 l 115 585 q 230 657 164 632 q 365 683 296 683 q 543 623 479 683 q 608 452 608 564 l 604 213 q 604 166 604 184 q 608 123 604 148 q 625 87 612 99 q 658 76 638 76 q 679 80 666 76 q 702 90 691 84 l 706 40 q 643 1 676 14 q 563 -15 610 -10 q 480 5 518 -15 q 419 64 442 25 q 236 -15 350 -15 m 221 976 q 289 948 261 976 q 317 878 317 920 q 290 811 317 839 q 223 784 264 784 q 155 811 186 784 q 125 878 125 839 q 154 946 125 917 q 221 976 183 976 m 481 976 q 549 948 521 976 q 577 878 577 920 q 550 811 577 839 q 483 784 524 784 q 414 812 444 784 q 385 878 385 841 q 412 946 385 917 q 481 976 440 976 m 240 200 q 261 128 240 158 q 321 99 282 99 q 388 131 367 99 q 410 211 410 164 l 410 352 q 287 302 335 338 q 240 200 240 267 "},"<":{"x_min":175,"x_max":959.75,"ha":1138,"o":"m 959 650 l 362 406 l 959 162 l 959 17 l 175 340 l 175 471 l 959 796 l 959 650 "},"£":{"x_min":48,"x_max":734.109375,"ha":749,"o":"m 56 88 q 52 142 56 117 q 48 181 49 167 q 138 198 100 181 q 185 254 177 215 q 193 315 193 292 l 191 429 l 153 429 q 99 425 128 429 q 56 421 70 421 l 61 467 l 56 512 q 113 506 81 508 q 184 504 145 504 q 172 598 172 552 q 259 829 172 748 q 499 910 346 910 q 734 848 623 910 q 710 778 718 809 q 691 695 702 747 l 658 695 q 613 795 645 758 q 523 833 581 833 q 417 787 455 833 q 379 671 379 741 q 384 582 379 637 q 391 504 390 527 l 463 504 l 480 504 q 519 504 500 504 q 598 512 538 505 l 593 466 l 598 422 l 493 429 l 391 429 q 343 288 382 340 q 219 184 303 236 l 542 189 l 724 195 q 716 146 720 174 q 711 98 711 117 q 713 62 711 78 q 724 0 716 45 q 557 3 667 0 q 391 8 448 8 q 220 3 334 8 q 48 0 106 0 q 52 46 49 16 q 56 88 56 77 "},"¹":{"x_min":66,"x_max":360,"ha":494,"o":"m 212 726 l 212 802 q 158 781 187 795 q 102 755 129 768 l 66 808 q 206 857 157 838 q 342 919 256 876 l 356 910 l 356 627 l 356 638 l 356 477 l 356 484 q 356 429 356 451 q 360 354 356 408 l 307 358 l 202 354 q 210 520 209 418 q 212 634 212 623 l 212 726 "},"t":{"x_min":9,"x_max":468.71875,"ha":463,"o":"m 9 584 l 10 627 l 10 671 q 54 667 25 668 q 102 667 84 667 l 102 687 l 102 704 q 95 823 102 765 q 192 859 147 839 q 298 914 237 880 l 327 914 q 319 853 323 890 q 315 791 315 816 l 315 667 l 344 667 q 433 670 387 667 l 430 629 l 430 582 l 309 584 l 309 226 q 322 107 309 149 q 393 65 335 65 q 468 72 427 65 l 463 9 q 381 -11 425 -4 q 292 -18 336 -18 q 145 25 196 -18 q 95 165 95 69 q 98 410 95 260 q 102 583 102 559 l 9 584 "},"λ":{"x_min":22.609375,"x_max":662.890625,"ha":686,"o":"m 550 0 l 433 0 q 394 177 417 79 q 360 323 372 275 q 318 490 349 372 q 234 238 269 359 q 179 0 199 116 l 103 0 l 22 0 q 109 214 69 109 q 182 416 149 318 q 264 662 215 514 q 214 834 247 760 q 111 909 180 909 q 80 903 99 909 q 51 895 61 898 l 32 964 q 121 1008 76 993 q 215 1024 167 1024 q 384 925 342 1024 q 458 718 426 826 l 529 459 l 662 0 l 550 0 "},"ù":{"x_min":75,"x_max":722,"ha":808,"o":"m 474 757 l 249 865 q 198 900 216 883 q 181 946 181 917 q 203 998 181 977 q 256 1019 225 1019 q 303 1003 282 1019 q 356 955 324 987 l 542 757 l 474 757 m 292 -15 q 142 41 202 -15 q 83 189 83 98 l 83 337 q 79 509 83 394 q 75 668 75 624 q 134 661 108 663 q 185 659 160 659 q 240 662 209 659 q 300 668 271 665 q 290 455 290 570 l 290 384 l 290 279 q 316 146 290 181 q 394 111 343 111 q 467 147 441 111 q 501 234 493 184 l 501 330 q 499 488 501 415 q 495 668 497 562 q 554 662 518 665 q 613 659 589 659 q 671 662 640 659 q 722 668 701 665 q 717 505 722 625 q 712 326 712 386 q 717 156 712 270 q 722 1 722 43 l 617 4 l 511 1 l 511 96 q 410 15 468 46 q 292 -15 353 -15 "},"W":{"x_min":-8.328125,"x_max":1325,"ha":1326,"o":"m -8 932 q 67 929 13 932 q 125 926 120 926 q 190 929 147 926 q 255 932 233 932 q 300 737 277 829 q 357 519 323 644 q 419 298 391 394 q 504 548 455 403 q 576 759 554 693 q 633 932 598 825 l 711 926 q 756 929 726 926 q 802 932 787 932 q 859 729 836 807 q 913 557 881 651 q 998 297 944 462 q 1166 932 1094 604 l 1248 926 q 1298 929 1280 926 q 1325 932 1316 932 l 1230 643 l 1019 0 q 972 4 983 4 q 937 5 962 5 q 884 2 904 5 q 855 0 865 0 q 793 200 831 80 q 740 363 754 319 l 652 623 q 543 325 594 476 q 441 0 493 175 q 393 3 423 0 q 359 6 363 6 q 308 4 330 6 q 272 0 286 1 q 184 320 222 191 q 107 576 147 450 q -8 932 68 703 "},"ï":{"x_min":-26,"x_max":422,"ha":396,"o":"m 93 126 l 93 542 q 87 601 93 557 q 82 666 82 645 q 141 660 111 663 q 198 658 172 658 q 255 661 223 658 q 316 666 287 663 q 311 621 315 658 q 303 544 307 584 l 303 319 l 303 115 l 315 0 l 195 2 l 81 0 q 93 126 93 66 m 68 976 q 134 947 107 976 q 162 878 162 918 q 136 811 162 839 q 71 784 111 784 q 2 811 31 784 q -26 878 -26 838 q 1 946 -26 917 q 68 976 29 976 m 327 976 q 394 948 366 976 q 422 878 422 920 q 396 811 422 838 q 329 784 370 784 q 260 811 288 784 q 232 878 232 838 q 260 947 232 918 q 327 976 288 976 "},">":{"x_min":174.984375,"x_max":961,"ha":1138,"o":"m 961 472 l 961 340 l 175 17 l 175 162 l 773 406 l 174 650 l 174 796 l 961 472 "},"v":{"x_min":0,"x_max":669.453125,"ha":667,"o":"m 0 667 q 75 663 26 667 q 131 659 123 659 q 202 663 156 659 q 255 667 247 667 l 293 528 l 387 223 q 526 667 473 447 l 595 659 q 637 663 611 659 q 669 667 663 667 q 541 343 602 505 q 418 0 480 181 q 368 4 395 2 q 330 6 341 6 q 279 3 311 6 q 244 0 248 0 q 129 340 184 186 q 0 667 73 494 "},"τ":{"x_min":9,"x_max":654.84375,"ha":661,"o":"m 446 557 l 445 521 l 445 108 q 456 0 445 55 l 338 4 l 225 0 q 234 69 231 40 q 237 125 237 98 l 237 320 l 237 516 l 237 557 q 59 459 115 557 l 24 459 q 20 516 24 490 q 9 581 17 543 q 122 641 59 625 q 263 658 185 658 l 440 656 q 654 667 556 656 q 649 610 649 641 q 654 554 649 580 q 525 555 603 554 q 446 557 447 557 "},"û":{"x_min":75,"x_max":722,"ha":808,"o":"m 339 1004 l 463 1004 l 616 757 l 549 757 l 400 879 l 254 757 l 186 757 l 339 1004 m 292 -15 q 142 41 202 -15 q 83 189 83 98 l 83 337 q 79 509 83 394 q 75 668 75 625 q 134 662 108 664 q 185 660 160 660 q 240 662 209 660 q 300 668 271 665 q 290 455 290 570 l 290 384 l 290 279 q 316 146 290 181 q 394 111 343 111 q 467 147 441 111 q 501 234 493 184 l 501 330 q 499 488 501 415 q 495 668 497 562 q 554 662 518 665 q 613 660 589 660 q 671 662 640 660 q 722 668 701 665 q 717 505 722 625 q 712 326 712 386 q 717 156 712 270 q 722 1 722 43 l 617 4 l 511 1 l 511 96 q 410 15 468 46 q 292 -15 353 -15 "},"ξ":{"x_min":53,"x_max":675,"ha":675,"o":"m 559 813 q 508 904 534 873 q 432 936 482 936 q 335 887 372 936 q 299 776 299 838 q 372 648 299 683 q 550 614 446 614 l 546 569 l 546 525 l 455 528 q 320 498 379 528 q 251 432 261 469 q 240 386 241 396 q 239 360 239 376 q 240 322 239 335 q 244 304 241 310 q 363 205 258 226 q 569 165 469 183 q 675 25 675 130 q 647 -83 675 -27 q 536 -221 619 -139 l 468 -181 q 514 -114 498 -141 q 531 -55 531 -88 q 380 23 531 -5 q 141 98 229 53 q 53 287 53 143 q 113 467 53 390 q 274 586 173 544 q 144 666 196 615 q 92 790 92 716 q 180 962 92 901 q 389 1024 269 1024 q 515 1009 455 1024 q 640 963 575 994 q 620 886 632 936 q 604 809 608 836 l 559 813 "},"&":{"x_min":50,"x_max":948.609375,"ha":974,"o":"m 316 -18 q 128 44 206 -18 q 50 215 50 107 q 115 388 50 315 q 281 502 180 462 q 216 609 243 547 q 190 723 190 670 q 266 877 190 823 q 446 932 342 932 q 604 889 537 932 q 672 761 672 847 q 621 631 672 687 q 495 541 571 576 q 709 295 593 412 q 786 421 751 348 q 845 567 822 494 q 880 517 861 538 q 934 463 899 495 q 851 336 888 387 q 761 233 813 285 q 856 123 811 174 q 948 26 902 71 l 948 1 q 860 7 887 6 q 817 8 833 8 q 756 6 779 8 q 690 1 734 5 l 612 92 q 469 11 545 40 q 316 -18 394 -18 m 232 284 q 284 160 232 214 q 408 106 337 106 q 484 118 449 106 q 562 155 519 130 q 421 323 469 264 q 330 443 373 382 q 258 373 284 411 q 232 284 232 336 m 547 759 q 522 831 547 802 q 453 860 498 860 q 419 854 435 860 q 379 823 394 850 q 365 769 365 797 q 383 697 365 740 q 449 597 402 654 q 520 668 493 627 q 547 759 547 709 "},"Λ":{"x_min":-19.4375,"x_max":856.953125,"ha":836,"o":"m 583 700 l 856 0 q 781 3 823 0 q 723 6 740 6 q 645 3 688 6 q 587 0 602 0 q 563 90 579 43 q 538 163 547 137 l 359 637 l 189 161 q 142 0 163 87 l 72 5 q 35 4 48 5 q -19 0 23 4 q 25 92 -2 33 q 83 226 52 151 l 272 698 q 311 810 290 747 q 348 932 331 873 q 394 927 379 929 q 423 926 409 926 q 474 929 456 926 q 501 932 491 932 q 583 700 536 819 "},"I":{"x_min":94,"x_max":354,"ha":447,"o":"m 111 402 q 107 716 111 609 q 94 932 103 822 q 161 925 124 929 q 220 922 198 922 q 292 927 245 922 q 353 931 339 932 q 340 716 343 819 q 337 465 337 613 q 340 221 337 326 q 354 0 344 116 q 273 2 330 0 q 214 5 216 5 l 95 0 q 107 199 103 88 q 111 402 111 311 "},"G":{"x_min":43,"x_max":948,"ha":1015,"o":"m 552 -15 q 183 110 324 -15 q 43 461 43 236 q 195 823 43 693 q 583 954 347 954 q 763 932 679 954 q 929 865 848 911 q 879 697 895 784 l 862 697 q 749 816 818 772 q 595 860 680 860 q 390 769 471 860 q 300 608 309 679 q 289 513 291 536 q 287 469 287 490 q 289 404 287 426 q 294 375 292 382 q 389 167 310 250 q 590 84 468 84 q 713 100 651 84 q 699 430 713 272 q 824 423 768 423 q 948 431 886 423 q 942 323 948 395 q 937 214 937 251 q 939 118 937 185 q 942 47 942 51 q 746 1 839 17 q 552 -15 652 -15 "},"ΰ":{"x_min":39,"x_max":768,"ha":843,"o":"m 768 415 q 666 114 768 244 q 404 -15 565 -15 q 165 56 246 -15 q 85 284 85 127 l 89 478 q 87 589 89 523 q 85 666 85 656 q 148 663 102 666 q 198 661 194 661 q 266 663 219 661 q 314 666 312 666 q 298 476 304 566 q 293 294 293 387 q 313 122 293 193 q 405 52 333 52 q 518 146 490 52 q 547 351 547 240 q 528 502 547 433 q 472 656 510 570 q 583 659 531 656 q 687 672 636 662 q 746 547 725 613 q 768 415 768 481 m 121 961 q 179 935 155 961 q 203 877 203 910 q 179 820 203 844 q 121 797 155 797 q 64 820 89 797 q 39 879 39 844 q 62 935 39 910 q 121 961 86 961 m 462 1017 q 504 998 486 1017 q 522 957 522 980 q 508 919 522 935 q 470 886 494 903 l 282 755 l 224 755 l 368 950 q 413 998 391 979 q 462 1017 434 1017 m 657 961 q 713 935 688 961 q 739 877 739 910 q 715 820 739 844 q 658 797 691 797 q 600 820 625 797 q 575 879 575 844 q 599 936 575 912 q 657 961 623 961 "},"`":{"x_min":65.671875,"x_max":330.9375,"ha":375,"o":"m 251 613 q 217 540 240 569 q 153 512 193 512 q 92 537 118 512 q 65 598 65 562 q 87 665 65 634 l 292 949 l 330 933 l 251 613 "},"Υ":{"x_min":-30,"x_max":797,"ha":747,"o":"m 136 650 q 67 772 123 672 q -30 932 10 872 l 92 926 q 184 929 120 926 q 256 931 249 931 q 345 740 304 825 q 442 554 386 656 q 541 730 492 636 q 637 931 589 825 l 712 926 q 753 929 726 926 q 797 931 781 931 q 644 689 714 812 q 498 420 573 566 l 502 143 l 508 0 l 414 5 l 256 0 q 262 138 256 50 q 269 237 269 226 l 269 402 l 136 650 "},"r":{"x_min":80,"x_max":505,"ha":521,"o":"m 91 326 q 85 495 91 381 q 80 666 80 609 l 181 661 q 246 663 201 661 q 297 666 291 666 q 283 592 287 630 q 280 504 280 554 l 288 504 q 357 632 311 581 q 474 683 403 683 l 505 683 q 495 571 498 631 q 492 457 492 511 q 448 477 471 468 q 406 486 424 486 q 320 439 343 486 q 298 323 298 392 q 300 147 298 208 q 311 0 302 85 q 247 3 288 0 q 195 6 206 6 q 130 3 171 6 q 80 0 88 0 q 85 162 80 53 q 91 326 91 270 "},"x":{"x_min":-4.5625,"x_max":646.828125,"ha":644,"o":"m 155 0 l 84 5 q 28 4 46 5 q -4 0 6 0 q 110 148 55 75 q 223 307 164 222 l 113 498 l 7 667 q 86 663 38 667 q 141 659 134 659 q 215 663 169 659 q 271 667 262 667 l 366 473 q 419 555 398 521 q 481 667 439 590 l 553 659 q 601 663 571 659 q 637 667 631 667 q 537 542 580 598 q 419 384 494 486 l 537 177 q 646 0 588 88 q 571 3 620 0 q 516 6 523 6 q 441 3 489 6 q 385 0 392 0 l 276 218 l 155 0 "},"è":{"x_min":41,"x_max":684.046875,"ha":729,"o":"m 482 98 q 566 112 532 98 q 643 160 600 126 l 661 151 q 643 96 652 125 q 628 40 634 66 q 521 -1 577 11 q 403 -15 466 -15 q 141 79 241 -15 q 41 336 41 173 q 137 586 41 490 q 386 683 234 683 q 608 601 532 683 q 684 373 684 520 l 684 332 l 267 332 q 325 165 267 232 q 482 98 383 98 m 436 754 l 211 862 q 162 896 181 877 q 143 946 143 915 q 165 996 143 976 q 217 1017 186 1017 q 274 996 250 1017 q 320 952 298 975 l 508 754 l 436 754 m 478 411 q 481 444 481 422 q 459 566 481 513 q 377 620 438 620 q 292 562 318 620 q 267 437 267 505 l 267 411 l 478 411 "},"μ":{"x_min":79,"x_max":729,"ha":808,"o":"m 717 322 q 723 136 717 256 q 729 0 729 15 l 629 5 q 564 2 609 5 q 518 0 519 0 l 518 81 q 448 4 479 23 q 384 -15 417 -15 q 333 -4 352 -15 q 288 25 313 7 l 288 34 l 287 -57 l 288 -190 l 287 -180 q 292 -278 287 -212 q 297 -368 297 -344 q 221 -361 240 -361 q 189 -361 201 -361 q 150 -361 168 -361 q 79 -368 131 -362 q 86 -277 83 -323 q 90 -187 90 -231 l 90 116 q 90 303 90 177 q 90 491 90 428 q 86 593 90 530 q 82 667 82 655 q 190 659 139 659 q 255 663 214 659 q 305 666 296 666 q 301 506 305 613 q 297 360 297 398 l 297 260 q 315 142 297 189 q 396 95 334 95 q 486 153 466 95 q 507 299 507 211 q 503 517 507 385 q 500 667 500 650 q 619 659 566 659 q 683 663 645 659 q 729 666 722 666 q 723 465 729 594 q 717 322 717 336 "},"÷":{"x_min":169,"x_max":969,"ha":1139,"o":"m 669 667 q 638 597 669 626 q 566 568 608 568 q 497 597 526 568 q 468 669 468 626 q 497 739 468 710 q 567 769 526 769 q 639 739 610 769 q 669 667 669 710 m 969 474 l 969 342 l 169 342 l 169 474 l 969 474 m 669 144 q 638 73 669 103 q 568 44 608 44 q 497 73 526 44 q 468 142 468 102 q 498 214 468 184 q 568 244 528 244 q 639 216 610 244 q 669 144 669 188 "},"h":{"x_min":80,"x_max":729,"ha":808,"o":"m 509 683 q 660 626 601 683 q 719 477 719 570 l 719 403 l 719 246 q 720 109 719 148 q 729 0 722 70 q 665 2 709 0 q 617 5 620 5 q 551 2 598 5 q 501 0 505 0 q 510 147 508 73 q 513 333 513 221 l 509 426 q 482 516 503 482 q 411 551 461 551 q 356 534 380 551 q 322 489 332 517 q 306 428 312 462 q 301 331 301 394 q 304 166 301 277 q 308 0 308 55 q 244 3 284 0 q 194 6 204 6 q 129 3 171 6 q 80 0 88 0 q 85 255 80 84 q 91 513 91 426 q 85 769 91 598 q 80 1024 80 940 l 180 1018 l 197 1018 q 308 1023 259 1018 q 304 902 308 976 q 301 815 301 827 l 301 583 q 509 683 379 683 "},".":{"x_min":68,"x_max":306,"ha":375,"o":"m 187 221 q 268 186 230 221 q 306 104 306 151 q 270 23 306 61 q 187 -15 235 -15 q 102 18 137 -15 q 68 103 68 51 q 102 186 68 151 q 187 221 137 221 "},"φ":{"x_min":32,"x_max":1012,"ha":1044,"o":"m 418 388 q 477 605 418 528 q 671 683 537 683 q 913 589 814 683 q 1012 352 1012 495 q 902 94 1012 180 q 612 -7 793 9 q 617 -198 612 -69 q 622 -374 622 -326 l 544 -365 q 471 -366 503 -365 q 404 -373 438 -368 q 411 -183 404 -315 q 418 -5 418 -51 q 359 1 377 0 q 320 8 341 2 q 112 118 193 29 q 32 334 32 206 q 123 568 32 488 q 374 669 215 648 q 381 643 376 656 q 393 612 386 629 q 278 504 311 576 q 246 329 246 431 q 285 142 246 223 q 418 61 325 61 l 418 276 l 418 388 m 612 61 q 707 88 670 66 q 763 157 743 109 q 788 255 782 205 q 794 377 794 305 q 791 450 794 416 q 779 528 788 484 q 748 593 770 572 q 696 614 725 614 q 631 564 650 614 q 612 459 612 515 l 612 276 l 612 61 "},";":{"x_min":51.390625,"x_max":347,"ha":447,"o":"m 226 654 q 310 619 274 654 q 347 534 347 584 q 312 450 347 485 q 227 416 277 416 q 142 449 177 416 q 108 534 108 482 q 142 619 108 584 q 226 654 177 654 m 134 120 q 172 203 145 170 q 244 237 200 237 q 313 207 284 237 q 343 137 343 178 q 337 100 343 116 q 319 63 331 84 l 88 -254 l 51 -238 l 134 120 "},"f":{"x_min":8,"x_max":463.5625,"ha":425,"o":"m 381 1024 q 433 1019 413 1024 q 463 1010 453 1012 q 443 934 456 987 q 419 826 430 880 l 412 826 q 362 862 384 850 q 310 874 339 874 q 233 812 233 874 q 258 729 233 773 q 300 658 284 685 l 317 658 q 354 658 336 658 q 428 665 372 659 l 425 669 l 425 641 q 425 607 425 625 q 425 576 425 590 l 356 583 l 306 583 l 306 273 q 308 166 306 200 q 323 0 310 133 q 258 3 299 0 q 209 6 217 6 q 144 3 185 6 q 92 0 102 0 q 102 127 99 51 q 105 272 105 203 l 105 580 l 56 583 l 8 583 l 9 622 l 9 665 q 52 659 29 660 q 105 658 74 658 q 183 904 105 784 q 381 1024 262 1024 "},"“":{"x_min":65.28125,"x_max":609.71875,"ha":654,"o":"m 251 613 q 218 541 243 570 q 154 512 194 512 q 90 537 116 512 q 65 601 65 563 q 87 665 65 634 l 291 949 l 331 933 l 251 613 m 530 613 q 498 542 525 573 q 433 512 472 512 q 371 536 397 512 q 345 598 345 560 q 366 665 345 633 l 570 949 l 609 933 l 530 613 "},"A":{"x_min":-29.171875,"x_max":850,"ha":829,"o":"m 109 322 q 193 530 143 400 q 278 751 244 660 q 351 949 312 843 l 420 944 l 490 949 q 672 450 584 685 q 850 0 759 215 l 716 4 l 580 0 l 551 91 l 497 259 q 398 261 448 259 q 300 264 348 262 l 202 259 q 112 0 162 134 l 22 4 l -29 0 l 109 322 m 354 368 l 464 368 q 416 509 440 446 q 355 662 393 572 q 243 370 295 519 l 354 368 "},"‘":{"x_min":68.0625,"x_max":331.9375,"ha":374,"o":"m 251 613 q 218 540 241 569 q 151 512 194 512 q 92 537 116 512 q 68 599 68 563 q 75 632 68 612 q 90 663 81 652 l 293 949 l 331 935 l 251 613 "},"ϊ":{"x_min":-28,"x_max":423,"ha":396,"o":"m 91 126 l 91 543 l 80 666 q 139 661 105 663 q 196 658 173 658 q 264 660 238 658 q 314 666 290 663 q 304 586 307 616 q 301 523 301 557 l 301 113 q 302 72 301 88 q 314 0 304 56 l 195 4 l 81 0 q 87 67 84 30 q 91 126 91 104 m 68 975 q 136 947 108 975 q 164 879 164 919 q 138 811 164 840 q 72 783 112 783 q 2 810 33 783 q -28 879 -28 838 q 0 947 -28 919 q 68 975 27 975 m 328 975 q 395 947 367 975 q 423 879 423 919 q 397 811 423 840 q 331 783 371 783 q 261 810 292 783 q 231 879 231 838 q 258 947 231 919 q 328 975 286 975 "},"π":{"x_min":19,"x_max":957.890625,"ha":965,"o":"m 802 521 l 802 108 l 812 0 l 696 4 l 582 0 q 585 61 582 19 q 589 125 589 102 l 594 320 l 589 557 l 504 563 l 421 557 l 421 520 l 421 108 q 432 0 421 55 l 314 4 l 200 0 q 209 64 206 37 q 213 115 213 91 l 213 315 l 213 514 l 213 557 q 129 531 165 557 q 68 461 93 505 l 33 461 q 31 510 33 497 q 19 603 30 523 q 136 645 75 634 q 273 657 196 657 l 531 657 l 792 657 l 957 667 l 955 612 l 957 552 l 803 557 l 802 521 "},"ά":{"x_min":30,"x_max":827.21875,"ha":878,"o":"m 669 665 l 749 662 l 827 665 q 763 499 782 551 q 720 377 743 447 l 818 0 q 763 6 792 2 q 717 10 733 10 q 662 5 692 10 q 615 0 632 1 l 594 101 q 361 -15 501 -15 q 120 83 210 -15 q 30 334 30 182 q 123 583 30 484 q 368 683 217 683 q 515 647 449 683 q 633 547 582 612 q 651 601 640 563 q 669 665 662 638 m 523 952 q 576 1001 556 986 q 625 1017 596 1017 q 677 994 656 1017 q 698 943 698 972 q 679 896 698 915 q 629 862 660 877 l 406 754 l 337 754 l 523 952 m 383 614 q 313 588 343 614 q 276 523 283 562 q 260 434 265 484 q 256 333 256 385 q 269 174 256 249 q 305 87 275 122 q 385 52 335 52 q 509 144 473 52 q 546 340 546 236 q 522 504 546 428 q 455 597 498 580 q 383 614 411 614 "},"O":{"x_min":40,"x_max":1086,"ha":1129,"o":"m 577 949 q 945 829 804 949 q 1086 486 1086 710 q 942 114 1086 244 q 552 -15 798 -15 q 176 107 313 -15 q 40 465 40 229 q 188 823 40 697 q 577 949 337 949 m 562 73 q 773 194 706 73 q 840 472 840 315 q 773 742 840 624 q 566 860 706 860 q 353 742 420 860 q 287 465 287 624 q 353 193 287 313 q 562 73 420 73 "},"n":{"x_min":80,"x_max":727,"ha":808,"o":"m 91 338 q 85 512 91 391 q 80 667 80 632 q 137 661 125 662 q 180 661 149 661 q 249 661 215 661 q 293 666 279 665 l 293 568 q 391 648 333 616 q 508 681 449 681 q 659 624 600 681 q 719 475 719 567 l 719 329 q 723 172 719 287 q 727 0 727 58 q 673 2 709 0 q 617 5 637 5 q 552 2 598 5 q 502 0 506 0 q 507 175 502 58 q 512 333 512 291 l 512 358 q 508 426 512 393 q 483 514 508 476 q 411 552 459 552 q 355 534 379 552 q 318 487 331 517 q 302 419 305 457 q 299 330 299 382 q 304 148 299 264 q 309 0 309 33 q 244 3 285 0 q 195 6 203 6 q 128 3 170 6 q 80 0 86 0 q 85 188 80 65 q 91 338 91 311 "},"l":{"x_min":86,"x_max":316,"ha":407,"o":"m 99 501 q 95 701 99 579 q 92 843 92 823 l 86 1024 q 154 1016 125 1019 q 201 1013 183 1013 q 265 1018 232 1013 q 316 1023 297 1022 q 309 719 316 915 q 303 501 303 523 l 307 180 l 316 0 q 263 5 309 1 q 201 10 218 10 q 138 6 169 10 q 86 0 108 2 q 92 292 86 104 q 99 501 99 480 "},"κ":{"x_min":80,"x_max":732.765625,"ha":756,"o":"m 184 659 q 306 667 239 659 l 301 509 l 295 461 l 295 389 q 422 510 367 447 q 545 667 478 573 l 618 667 l 709 667 l 714 657 l 628 576 l 475 425 q 552 292 510 364 q 636 154 595 220 l 732 0 q 661 3 706 0 q 607 6 616 6 q 536 3 579 6 q 486 0 493 0 q 386 174 440 83 q 295 329 331 266 l 295 249 q 298 106 295 206 q 301 0 301 6 l 190 4 l 80 0 q 85 127 80 43 q 91 255 91 212 q 85 461 91 323 q 80 666 80 598 l 184 659 "},"p":{"x_min":82,"x_max":772,"ha":825,"o":"m 502 683 q 704 574 636 683 q 772 322 772 466 q 701 82 772 179 q 491 -15 630 -15 q 302 85 371 -15 l 302 -71 l 309 -385 q 249 -379 278 -382 q 196 -376 221 -376 q 139 -379 171 -376 q 82 -384 108 -381 q 87 -252 82 -341 q 92 -131 92 -162 l 88 487 l 82 666 q 195 659 141 659 q 235 660 216 659 q 307 666 254 661 q 302 580 302 618 q 391 656 343 630 q 502 683 440 683 m 430 79 q 472 86 453 79 q 515 122 491 94 q 548 204 539 151 q 557 337 557 258 q 532 503 557 431 q 430 576 507 576 q 324 501 350 576 q 298 327 298 427 q 323 152 298 226 q 430 79 349 79 "},"ψ":{"x_min":59,"x_max":1025,"ha":1064,"o":"m 1025 437 q 919 131 1025 249 q 625 -7 813 13 q 630 -190 625 -68 q 636 -374 636 -312 l 558 -365 q 483 -366 516 -365 q 418 -373 451 -368 q 424 -159 418 -297 q 431 -5 431 -22 q 374 0 401 -2 q 271 20 348 2 q 127 124 195 37 q 59 331 59 211 l 60 484 l 59 666 l 168 663 l 277 666 q 269 506 277 619 q 261 358 261 392 q 293 144 261 228 q 431 51 325 60 l 431 253 q 424 572 431 367 q 418 800 418 777 l 536 795 l 636 798 q 630 650 636 748 q 625 501 625 551 l 625 254 l 625 51 q 767 146 726 51 q 808 359 808 241 q 798 498 808 440 q 762 650 788 556 q 867 654 821 650 q 980 666 913 658 q 1025 437 1025 552 "},"Ü":{"x_min":82,"x_max":910,"ha":997,"o":"m 210 927 l 338 931 q 329 643 338 836 q 321 421 321 451 q 360 197 321 284 q 521 110 400 110 q 678 162 609 110 q 756 279 747 214 q 768 420 765 344 q 771 548 771 495 q 756 931 771 755 l 814 927 l 910 931 q 903 770 910 883 q 896 616 896 657 l 896 480 l 896 375 q 794 81 896 178 q 493 -15 692 -15 q 210 56 321 -15 q 100 287 100 128 q 91 619 100 386 q 82 931 82 852 l 210 927 m 394 1242 q 461 1215 433 1242 q 489 1148 489 1189 q 463 1078 489 1107 q 396 1050 437 1050 q 327 1078 355 1050 q 299 1148 299 1107 q 326 1214 299 1186 q 394 1242 354 1242 m 654 1242 q 721 1214 694 1242 q 749 1148 749 1187 q 724 1079 749 1108 q 658 1050 699 1050 q 588 1077 617 1050 q 559 1148 559 1105 q 587 1214 559 1187 q 654 1242 615 1242 "},"à":{"x_min":44,"x_max":706.78125,"ha":706,"o":"m 237 -15 q 98 35 153 -15 q 44 169 44 86 q 212 352 44 301 q 401 421 380 403 q 410 439 410 432 q 373 539 410 502 q 275 577 337 577 q 140 511 185 577 l 135 511 l 115 585 q 230 657 164 632 q 365 683 296 683 q 543 623 479 683 q 608 452 608 564 l 604 213 q 604 166 604 184 q 608 123 604 148 q 625 87 612 99 q 658 76 638 76 q 679 80 666 76 q 702 90 691 84 l 706 40 q 643 1 676 14 q 563 -15 610 -10 q 481 5 520 -15 q 421 64 441 26 q 237 -15 351 -15 m 425 755 l 201 863 q 145 902 159 883 q 131 944 131 921 q 153 996 131 975 q 206 1017 175 1017 q 253 1002 232 1017 q 309 953 273 987 l 494 755 l 425 755 m 240 200 q 261 128 240 158 q 321 99 282 99 q 388 131 367 99 q 410 211 410 164 l 410 352 q 287 302 335 338 q 240 200 240 267 "},"η":{"x_min":80,"x_max":727,"ha":808,"o":"m 91 339 q 85 512 91 391 q 80 667 80 632 q 137 661 125 662 q 180 661 149 661 q 244 663 199 661 q 293 666 290 666 l 293 568 q 391 651 338 622 q 511 681 443 681 q 660 622 602 681 q 719 471 719 564 l 719 328 l 719 -49 q 723 -219 719 -106 q 727 -373 727 -332 q 618 -365 670 -365 q 502 -373 562 -365 l 512 16 l 512 251 l 512 368 q 491 499 512 446 q 408 552 471 552 q 319 488 342 552 q 302 419 305 457 q 299 330 299 382 q 304 148 299 264 q 309 0 309 33 q 243 3 278 0 q 195 6 207 6 q 127 3 163 6 q 80 0 92 0 q 85 188 80 65 q 91 339 91 311 "}},"cssFontWeight":"bold","ascender":1288,"underlinePosition":-133,"cssFontStyle":"normal","boundingBox":{"yMin":-385,"xMin":-147,"yMax":1288,"xMax":1618},"resolution":1000,"original_font_information":{"postscript_name":"Optimer-Bold","version_string":"Version 1.00 2004 initial release","vendor_url":"http://www.magenta.gr/","full_font_name":"Optimer Bold","font_family_name":"Optimer","copyright":"Copyright (c) Magenta Ltd., 2004.","description":"","trademark":"","designer":"","designer_url":"","unique_font_identifier":"Magenta Ltd.:Optimer Bold:22-10-104","license_url":"http://www.ellak.gr/fonts/MgOpen/license.html","license_description":"Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\\r\\n\\r\\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license (\\"Fonts\\") and associated documentation files (the \\"Font Software\\"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \\r\\n\\r\\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\\r\\n\\r\\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word \\"MgOpen\\", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\\r\\n\\r\\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the \\"MgOpen\\" name.\\r\\n\\r\\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \\r\\n\\r\\nTHE FONT SOFTWARE IS PROVIDED \\"AS IS\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.","manufacturer_name":"Magenta Ltd.","font_sub_family_name":"Bold"},"descender":-385,"familyName":"Optimer","lineHeight":1672,"underlineThickness":20}')},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return l}));var i=n(71),r=n(2),o=n(34),a=n(212),s=n(79);function l(e){(e=r.a.ensureTypedArg(e,r.a.types.OBJECT,{})).texture=r.a.ensureTypedArg(e.texture,r.a.types.OBJECT,{}),this.uuid=t.Math.generateUUID(),this.fixedTimeStep=r.a.ensureTypedArg(e.fixedTimeStep,r.a.types.NUMBER,.016),this.texture=r.a.ensureInstanceOf(e.texture.value,t.Texture,null),this.textureFrames=r.a.ensureInstanceOf(e.texture.frames,t.Vector2,new t.Vector2(1,1)),this.textureFrameCount=r.a.ensureTypedArg(e.texture.frameCount,r.a.types.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=r.a.ensureTypedArg(e.texture.loop,r.a.types.NUMBER,1),this.textureFrames.max(new t.Vector2(1,1)),this.hasPerspective=r.a.ensureTypedArg(e.hasPerspective,r.a.types.BOOLEAN,!0),this.colorize=r.a.ensureTypedArg(e.colorize,r.a.types.BOOLEAN,!0),this.maxParticleCount=r.a.ensureTypedArg(e.maxParticleCount,r.a.types.NUMBER,null),this.blending=r.a.ensureTypedArg(e.blending,r.a.types.NUMBER,t.AdditiveBlending),this.transparent=r.a.ensureTypedArg(e.transparent,r.a.types.BOOLEAN,!0),this.alphaTest=parseFloat(r.a.ensureTypedArg(e.alphaTest,r.a.types.NUMBER,0)),this.depthWrite=r.a.ensureTypedArg(e.depthWrite,r.a.types.BOOLEAN,!1),this.depthTest=r.a.ensureTypedArg(e.depthTest,r.a.types.BOOLEAN,!0),this.fog=r.a.ensureTypedArg(e.fog,r.a.types.BOOLEAN,!0),this.scale=r.a.ensureTypedArg(e.scale,r.a.types.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.pool=[],this.poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={textureSampler:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new t.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:o.a.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new i.a("v3",!0),acceleration:new i.a("v4",!0),velocity:new i.a("v3",!0),rotation:new i.a("v4",!0),rotationCenter:new i.a("v3",!0),params:new i.a("v4",!0),size:new i.a("v4",!0),angle:new i.a("v4",!0),color:new i.a("v4",!0),opacity:new i.a("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.a.vertex,fragmentShader:a.a.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new t.BufferGeometry,null===this.maxParticleCount&&console.warn("TDS: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")}l.constructor=l,l.prototype._updateDefines=function(){for(var t,e=this.emitters,n=this.defines,i=e.length-1;i>=0;--i)t=e[i],n.SHOULD_CALCULATE_SPRITE||(n.SHOULD_ROTATE_TEXTURE=n.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,t.angle.value),Math.max.apply(null,t.angle.spread))),n.SHOULD_ROTATE_PARTICLES=n.SHOULD_ROTATE_PARTICLES||!!Math.max(t.rotation.angle,t.rotation.angleSpread),n.SHOULD_WIGGLE_PARTICLES=n.SHOULD_WIGGLE_PARTICLES||!!Math.max(t.wiggle.value,t.wiggle.spread);this.material.needsUpdate=!0},l.prototype._applyAttributesToGeometry=function(){var t,e,n=this.attributes,i=this.geometry,r=i.attributes;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],(e=r[o])?e.array=t.typedArray.array:i.addAttribute(o,t.bufferAttribute),t.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},l.prototype.addEmitter=function(t){if(t instanceof s.a!=!1)if(this.emitterIDs.indexOf(t.uuid)>-1)console.error("TDS: ParticleEmitterControl already exists in this group.");else{if(null===t.group){var e=this.attributes,n=this.particleCount,i=n+t.particleCount;for(var r in this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("TDS: ParticleGroup maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),t._calculatePPSValue(t.maxAge._value+t.maxAge._spread),t._setBufferUpdateRanges(this.attributeKeys),t._setAttributeOffset(n),t.group=this,t.attributes=this.attributes,e)e.hasOwnProperty(r)&&e[r]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=n;o<i;++o)t._assignPositionValue(o),t._assignForceValue(o,"velocity"),t._assignForceValue(o,"acceleration"),t._assignAbsLifetimeValue(o,"opacity"),t._assignAbsLifetimeValue(o,"size"),t._assignAngleValue(o),t._assignRotationValue(o),t._assignParamsValue(o),t._assignColorValue(o);return this._applyAttributesToGeometry(),this.emitters.push(t),this.emitterIDs.push(t.uuid),this._updateDefines(t),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("TDS: ParticleEmitterControl already belongs to another group.")}else console.error("TDS: emitter argument must be instance of ParticleEmitterControl.",t)},l.prototype.removeEmitter=function(t){var e=this.emitterIDs.indexOf(t.uuid);if(t instanceof s.a!=!1)if(-1!==e){for(var n=t.attributeOffset,i=n+t.particleCount,r=this.attributes.params.typedArray,o=n;o<i;++o)r.array[4*o]=0,r.array[4*o+1]=0;for(var a in this.emitters.splice(e,1),this.emitterIDs.splice(e,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(n,i);this.particleCount-=t.particleCount,t._onRemove(),this._attributesNeedRefresh=!0}else console.error("TDS: ParticleEmitterControl does not exist in this group. Will not remove.");else console.error("TDS: emitter argument must be instance of ParticleEmitterControl. Was provided with:",t)},l.prototype.getFromPool=function(){var t=this.pool,e=this._createNewWhenPoolEmpty;if(t.length)return t.pop();if(e){var n=new s.a(this.poolCreationSettings);return this.addEmitter(n),n}return null},l.prototype.releaseIntoPool=function(t){if(t instanceof s.a!=!1)return t.reset(),this.pool.unshift(t),this;console.error("TDS: Argument is not instanceof ParticleEmitterControl:",t)},l.prototype.getPool=function(){return this.pool},l.prototype.addPool=function(t,e,n){var i;this.poolCreationSettings=e,this._createNewWhenPoolEmpty=!!n;for(var r=0;r<t;++r)i=Array.isArray(e)?new s.a(e[r]):new s.a(e),this.addEmitter(i),this.releaseIntoPool(i);return this},l.prototype._triggerSingleEmitter=function(e){var n=this.getFromPool(),i=this;if(null!==n)return e instanceof t.Vector3&&(n.position.value.copy(e),n.position.value=n.position.value),n.enable(),setTimeout((function(){n.disable(),i.releaseIntoPool(n)}),1e3*Math.max(n.duration,n.maxAge.value+n.maxAge.spread)),this;console.log("ParticleGroup pool ran out.")},l.prototype.triggerEmitter=function(t,e){if("number"==typeof t&&t>1)for(var n=0;n<t;++n)this._triggerSingleEmitter(e);else this._triggerSingleEmitter(e);return this},l.prototype._updateUniforms=function(t){this.uniforms.runTime.value+=t,this.uniforms.deltaTime.value=t},l.prototype._resetBufferRanges=function(){for(var t=this.attributeKeys,e=this.attributeCount-1;e>=0;--e)this.attributes[t[e]].resetUpdateRange()},l.prototype._updateBuffers=function(t){for(var e,n,i,r=this.attributeKeys,o=this.attributes,a=t.bufferUpdateRanges,s=this.attributeCount-1;s>=0;--s)n=a[e=r[s]],(i=o[e]).setUpdateRange(n.min,n.max),i.flagUpdate()},l.prototype.tick=function(t,e){var n=this.emitters,i=n.length,r=t||this.fixedTimeStep,o=this.attributeKeys,a=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==i||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var s,l=0;l<i;++l)(s=n[l]).tick(r,e),this._updateBuffers(s);if(!0===this._attributesNeedDynamicReset){for(l=this.attributeCount-1;l>=0;--l)a[o[l]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(l=this.attributeCount-1;l>=0;--l)a[o[l]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},l.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this},l.prototype.toJSON=function(t){var e={texture:{}};return e.texture.value=this.texture.uuid,e.texture.frames=this.textureFrames.toArray(),e.texture.frameCount=this.textureFrameCount,e.texture.loop=this.textureLoop,e.fixedTimeStep=this.fixedTimeStep,e.hasPerspective=this.hasPerspective,e.colorize=this.colorize,e.maxParticleCount=this.maxParticleCount,e.transparent=this.transparent,e.blending=this.blending,e.alphaTest=this.alphaTest,e.depthWrite=this.depthWrite,e.depthTest=this.depthTest,e.fog=this.fog,e.scale=this.scale,e}}).call(this,n(0))},function(t,e,n){"use strict";function i(t,e,n,i){this.componentSize=n||1,this.size=e||1,this.TypedArrayConstructor=t||Float32Array,this.array=new t(e*this.componentSize),this.indexOffset=i||0}n.d(e,"a",(function(){return i})),i.constructor=i,i.prototype.setSize=function(t,e){var n=this.array.length;return e||(t*=this.componentSize),t<n?this.shrink(t):t>n?this.grow(t):void 0},i.prototype.shrink=function(t){return this.array=this.array.subarray(0,t),this.size=t,this},i.prototype.grow=function(t){var e=this.array,n=new this.TypedArrayConstructor(t);return n.set(e),this.array=n,this.size=t,this},i.prototype.splice=function(t,e){t*=this.componentSize,e*=this.componentSize;for(var n=[],i=this.array,r=i.length,o=0;o<r;++o)(o<t||o>=e)&&n.push(i[o]);return this.setFromArray(0,n),this},i.prototype.setFromArray=function(t,e){var n=t+e.length;return n>this.array.length?this.grow(n):n<this.array.length&&this.shrink(n),this.array.set(e,this.indexOffset+t),this},i.prototype.setVec2=function(t,e){return this.setVec2Components(t,e.x,e.y)},i.prototype.setVec2Components=function(t,e,n){var i=this.array,r=this.indexOffset+t*this.componentSize;return i[r]=e,i[r+1]=n,this},i.prototype.setVec3=function(t,e){return this.setVec3Components(t,e.x,e.y,e.z)},i.prototype.setVec3Components=function(t,e,n,i){var r=this.array,o=this.indexOffset+t*this.componentSize;return r[o]=e,r[o+1]=n,r[o+2]=i,this},i.prototype.setVec4=function(t,e){return this.setVec4Components(t,e.x,e.y,e.z,e.w)},i.prototype.setVec4Components=function(t,e,n,i,r){var o=this.array,a=this.indexOffset+t*this.componentSize;return o[a]=e,o[a+1]=n,o[a+2]=i,o[a+3]=r,this},i.prototype.setMat3=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},i.prototype.setMat4=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},i.prototype.setColor=function(t,e){return this.setVec3Components(t,e.r,e.g,e.b)},i.prototype.setNumber=function(t,e){return this.array[this.indexOffset+t*this.componentSize]=e,this},i.prototype.getValueAtIndex=function(t){return this.array[this.indexOffset+t]},i.prototype.getComponentValueAtIndex=function(t){return this.array.subarray(this.indexOffset+t*this.componentSize)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(){var t=new i.Triangle;function e(t){var e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.positionAttribute=this.geometry.getAttribute("position"),this.weightAttribute=null,this.distribution=null}return e.prototype={constructor:e,setWeightAttribute:function(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this},build:function(){for(var e=this.positionAttribute,n=this.weightAttribute,i=new Float32Array(e.count/3),r=0;r<e.count;r+=3){var o=1;n&&(o=n.getX(r)+n.getX(r+1)+n.getX(r+2)),t.a.fromBufferAttribute(e,r),t.b.fromBufferAttribute(e,r+1),t.c.fromBufferAttribute(e,r+2),o*=t.getArea(),i[r/3]=o}this.distribution=new Float32Array(e.count/3);var a=0;for(r=0;r<i.length;r++)a+=i[r],this.distribution[r]=a;return this},sample:function(t,e){var n=this.distribution[this.distribution.length-1],i=this.binarySearch(Math.random()*n);return this.sampleFace(i,t,e)},binarySearch:function(t){for(var e=this.distribution,n=0,i=e.length-1,r=-1;n<=i;){var o=Math.ceil((n+i)/2);if(0===o||e[o-1]<=t&&e[o]>t){r=o;break}t<e[o]?i=o-1:n=o+1}return r},sampleFace:function(e,n,i){var r=Math.random(),o=Math.random();return r+o>1&&(r=1-r,o=1-o),t.a.fromBufferAttribute(this.positionAttribute,3*e),t.b.fromBufferAttribute(this.positionAttribute,3*e+1),t.c.fromBufferAttribute(this.positionAttribute,3*e+2),n.set(0,0,0).addScaledVector(t.a,r).addScaledVector(t.b,o).addScaledVector(t.c,1-(r+o)),t.getNormal(i),this}},e}()},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(32);function r(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.path="",this.crossOrigin="Anonymous"}r.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},r.prototype.setPath=function(t){return this.path=t,this},r.prototype.loadJSON=function(e,n,i,r){var o=this;new t.FileLoader(this.manager).load(e,(function(t){n(o.parse(JSON.parse(t)))}),i,r)},r.prototype.parse=function(t){var e="";t.data&&(e=void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data),t.url&&(e=t.url),Array.isArray(e)&&(e=e[0]);var n=new i.a(e,t.encoding);return n.name=t.name,n.uuid=t.uuid,void 0!==t.width&&(n.width=t.width,n.height=t.height),n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(40);function r(e){this.manager=void 0!==e?e:t.DefaultLoadingManager}r.prototype.load=function(e,n,i,r){var o=this;new t.FileLoader(this.manager).load(e,(function(t){n(o.parse(JSON.parse(t)))}),i,r)},r.prototype.parse=function(t){var e=new i.a(void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data,t.encoding);return e.name=t.name,e.uuid=t.uuid,e}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(e){this.manager=void 0!==e?e:t.DefaultLoadingManager}n.d(e,"a",(function(){return i})),i.prototype.load=function(e,n,i,r){new t.FileLoader(this.manager).load(e,(function(t){n(self.parse(JSON.parse(t)))}),i,r)},i.prototype.parse=function(t){var e=new Audio;return e.name=t.name,e.uuid=t.uuid,e.encoding=t.encoding,"base64"===t.format?(e.format="arraybuffer",e.data=ArraybufferUtils.fromBase64(t.data)):"arraybuffer"===t.format?(e.format=t.format,e.data=void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data):(e.format=t.format,e.data=t.data),e}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.textures={}}n.d(e,"a",(function(){return i})),i.prototype.load=function(t,e,n,i){var r=this;new FileLoader(r.manager).load(t,(function(t){e(r.parse(JSON.parse(t)))}),n,i)},i.prototype.setTextures=function(t){this.textures=t},i.prototype.parse=function(e){this.textures;var n=t.MaterialLoader.prototype.parse.call(this,e);if(void 0!==e.specular&&(void 0===n.specular&&(n.specular=new t.Color),n.specular.setHex(e.specular)),void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.normalScale){var i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new t.Vector2).fromArray(i)}if(void 0!==e.materials)for(var r=0,o=e.materials.length;r<o;r++)n.materials.push(this.parse(e.materials[r]));return n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(192);function r(e){this.manager=void 0!==e?e:t.DefaultLoadingManager,this.geometryLoader=new i.a,this.bufferGeometryLoader=new t.BufferGeometryLoader,this.shapes={}}r.prototype.setShapes=function(t){return this.shapes=t,this},r.prototype.load=function(e,n,i,r){new t.FileLoader(this.manager).load(e,(function(t){n(self.parse(JSON.parse(t)))}),i,r)},r.prototype.parse=function(e){var n;switch(e.type){case"PlaneGeometry":case"PlaneBufferGeometry":n=new t[e.type](e.width,e.height,e.widthSegments,e.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":n=new t[e.type](e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":n=new t[e.type](e.radius,e.segments,e.thetaStart,e.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":n=new t[e.type](e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":n=new t[e.type](e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":n=new t[e.type](e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronBufferGeometry":case"OctahedronBufferGeometry":case"TetrahedronBufferGeometry":n=new t[e.type](e.radius,e.detail);break;case"RingGeometry":case"RingBufferGeometry":n=new t[e.type](e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":n=new t[e.type](e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":n=new t[e.type](e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q);break;case"LatheGeometry":case"LatheBufferGeometry":n=new t[e.type](e.points,e.segments,e.phiStart,e.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":n=new t[e.type](e.radius,e.indices,e.radius,e.detail);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var i=[],r=0,o=e.shapes.length;r<o;r++){var a=this.shapes[e.shapes[r]];i.push(a)}n=new t[e.type](i,e.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(i=[],r=0;r<e.shapes.length;r++){a=this.shapes[e.shapes[r]];i.push(a)}var s=e.options.extrudePath;void 0!==s&&(e.options.extrudePath=(new Curves[s.type]).fromJSON(s)),n=new t[e.type](i,e.options);break;case"CapsuleBufferGeometry":n=new CapsuleBufferGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.capsTopSegments,e.capsBottomSegments,e.thetaStart,e.thetaLength);break;case"BufferGeometry":case"InstancedBufferGeometry":n=this.bufferGeometryLoader.parse(e);break;case"Geometry":n=this.geometryLoader.parse(e.data).geometry;break;default:console.warn("GeometryLoader: Unsupported geometry type "+e.type+".",e),n=new t.Geometry}return n.uuid=e.uuid,void 0!==e.name?n.name=e.name:n.name="geometry",n}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){function i(e){this.manager=void 0!==e?e:t.DefaultLoadingManager}n.d(e,"a",(function(){return i})),i.prototype.load=function(e,n,i,r){new t.FileLoader(this.manager).load(e,(function(t){n(new Font(JSON.parse(t)))}),i,r)},i.prototype.parse=function(t){if(void 0!==t.data){var e=new Font;return e.name=t.name,e.uuid=t.uuid,e.encoding=t.encoding,void 0!==t.reversed&&(e.reversed=t.reversed),"arraybuffer"===t.format?(e.format=t.format,e.data=void 0!==t.data.toArrayBuffer?t.data.toArrayBuffer():t.data,e.loadTTF()):"base64"===t.format?(e.format="arraybuffer",e.data=ArraybufferUtils.fromBase64(t.data),e.loadTTF()):(e.format=t.format,e.data=t.data,e.font=t.data),e}return new Font(t)}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(47),r=n(62);function o(){r.a.call(this,i.a),this.type="Copy"}o.prototype=Object.create(r.a.prototype)},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent;function o(t,e,n,r){var o=i.call(this,t,e);return this.name="directional-light",this.type="DirectionalLight",e||this.createObject3D(n,r),o}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(e,n){this.object3D=new t.DirectionalLight(e||12632256,n||1),this.object3D.castShadow=!0,this.object3D.shadow.camera.near=.5,this.object3D.shadow.camera.far=1e4},o.prototype.init=function(){return i.prototype.init.call(this),this},o.prototype.updateShadowMap=function(){this.object3D.shadow.map.dispose(),this.object3D.shadow.map=null,this.object3D.shadow.camera.updateProjectionMatrix()},e.a=r("directional-light",o)}).call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent;function o(t,e,n,r){var o=i.call(this,t,e);return this.name="ambient-light",this.type="AmbientLight",this.matrixAutoUpdate=!1,e||this.createObject3D(n,r),o}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(e,n){this.object3D=new t.AmbientLight(e||4210752,n||1)},e.a=r("ambient-light",o)}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(){var t,e,n,r,o=new i.Vector3;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new u,this.unassigned=new u,this.vertices=[]}function s(){this.normal=new i.Vector3,this.midpoint=new i.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function l(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function c(t){this.point=t,this.prev=null,this.next=null,this.face=null}function u(){this.head=null,this.tail=null}return Object.assign(a.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.vertices.push(new c(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){var n,r,o,a=t.geometry;if(void 0!==a)if(a.isGeometry){var s=a.vertices;for(n=0,r=s.length;n<r;n++)(o=s[n].clone()).applyMatrix4(t.matrixWorld),e.push(o)}else if(a.isBufferGeometry){var l=a.attributes.position;if(void 0!==l)for(n=0,r=l.count;n<r;n++)(o=new i.Vector3).fromBufferAttribute(l,n).applyMatrix4(t.matrixWorld),e.push(o)}})),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,n=0,i=e.length;n<i;n++){if(e[n].distanceToPoint(t)>this.tolerance)return!1}return!0},intersectRay:function(t,e){for(var n=this.faces,i=-1/0,r=1/0,o=0,a=n.length;o<a;o++){var s=n[o],l=s.distanceToPoint(t.origin),c=s.normal.dot(t.direction);if(l>0&&c>=0)return null;var u=0!==c?-l/c:0;if(!(u<=0)&&(c>0?r=Math.min(u,r):i=Math.max(u,i),i>r))return null}return i!==-1/0?t.at(i,e):t.at(r,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,n=t.outside;null!==n.next&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{var i=n;do{var r=i.next;e.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,e):this.unassigned.append(i),i=r}while(null!==i)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var n=e.next,i=this.tolerance,r=null,o=0;o<t.length;o++){var a=t[o];if(0===a.mark){var s=a.distanceToPoint(e.point);if(s>i&&(i=s,r=a),i>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(e,r),e=n}while(null!==e)}return this},computeExtremes:function(){var t,e,n,r=new i.Vector3,o=new i.Vector3,a=[],s=[];for(t=0;t<3;t++)a[t]=s[t]=this.vertices[0];for(r.copy(this.vertices[0].point),o.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var l=this.vertices[t],c=l.point;for(n=0;n<3;n++)c.getComponent(n)<r.getComponent(n)&&(r.setComponent(n,c.getComponent(n)),a[n]=l);for(n=0;n<3;n++)c.getComponent(n)>o.getComponent(n)&&(o.setComponent(n,c.getComponent(n)),s[n]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(o.x))+Math.max(Math.abs(r.y),Math.abs(o.y))+Math.max(Math.abs(r.z),Math.abs(o.z))),{min:a,max:s}},computeInitialHull:function(){void 0===t&&(t=new i.Line3,e=new i.Plane,n=new i.Vector3);var r,o,a,l,c,u,h,f,d,p=this.vertices,m=this.computeExtremes(),g=m.min,v=m.max,y=0,x=0;for(u=0;u<3;u++)(d=v[u].point.getComponent(u)-g[u].point.getComponent(u))>y&&(y=d,x=u);for(o=g[x],a=v[x],y=0,t.set(o.point,a.point),u=0,h=this.vertices.length;u<h;u++)(r=p[u])!==o&&r!==a&&(t.closestPointToPoint(r.point,!0,n),(d=n.distanceToSquared(r.point))>y&&(y=d,l=r));for(y=-1,e.setFromCoplanarPoints(o.point,a.point,l.point),u=0,h=this.vertices.length;u<h;u++)(r=p[u])!==o&&r!==a&&r!==l&&(d=Math.abs(e.distanceToPoint(r.point)))>y&&(y=d,c=r);var b=[];if(e.distanceToPoint(c.point)<0)for(b.push(s.create(o,a,l),s.create(c,a,o),s.create(c,l,a),s.create(c,o,l)),u=0;u<3;u++)f=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge(f)),b[u+1].getEdge(1).setTwin(b[f+1].getEdge(0));else for(b.push(s.create(o,l,a),s.create(c,o,a),s.create(c,a,l),s.create(c,l,o)),u=0;u<3;u++)f=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge((3-u)%3)),b[u+1].getEdge(0).setTwin(b[f+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(b[u]);for(u=0,h=p.length;u<h;u++)if((r=p[u])!==o&&r!==a&&r!==l&&r!==c){y=this.tolerance;var w=null;for(f=0;f<4;f++)(d=this.faces[f].distanceToPoint(r.point))>y&&(y=d,w=this.faces[f]);null!==w&&this.addVertexToFace(r,w)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var n=this.faces[e];0===n.mark&&t.push(n)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,n=this.assigned.first().face,i=n.outside;do{var r=n.distanceToPoint(i.point);r>e&&(e=r,t=i),i=i.next}while(null!==i&&i.face===n);return t}},computeHorizon:function(t,e,n,i){var r;this.deleteFaceVertices(n),n.mark=1,r=null===e?e=n.getEdge(0):e.next;do{var o=r.twin,a=o.face;0===a.mark&&(a.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,a,i):i.push(r)),r=r.next}while(r!==e);return this},addAdjoiningFace:function(t,e){var n=s.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var n=null,i=null,r=0;r<e.length;r++){var o=e[r],a=this.addAdjoiningFace(t,o);null===n?n=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return n.next.setTwin(i),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(s,{create:function(t,e,n){var i=new s,r=new l(t,i),o=new l(e,i),a=new l(n,i);return r.next=a.prev=o,o.next=r.prev=a,a.next=o.prev=r,i.edge=r,i.compute()}}),Object.assign(s.prototype,{getEdge:function(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===r&&(r=new i.Triangle);var t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return r.set(t.point,e.point,n.point),r.getNormal(this.normal),r.getMidpoint(this.midpoint),this.area=r.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(l.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return this.twin=t,t.twin=this,this}}),Object.assign(u.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),a}()},function(t,e,n){"use strict";(function(t){var i=n(132),r=(n(12),n(5).Component),o=n(5).registerComponent;function a(e,n){var i=r.call(this,e,n);return this.name="sky",this.type="Sky",this.time=(new Date).getHours(),this.autoUpdate=!0,this.params={turbidity:.5,rayleigh:.05,mieCoefficient:.005,mieDirectionalG:.07,inclination:.49,azimuth:.25,exposure:1},this.sun=new t.Vector3,n||this.createObject3D(),i}a.IS_EXPOSED=!1,a.prototype=Object.create(r.prototype),a.prototype.createObject3D=function(){this.sky=new i.a,this.sky.scale.setScalar(45e4),this.object3D=this.sky},a.prototype.init=function(){return r.prototype.init.call(this),"Sky"!==this.entity.type?(TDS_RT.alert("Sky can only be attached to a sky entity."),null):(this.updateSky(),this)},a.prototype.update=function(t){this.autoUpdate&&(this.time+=t,this.time>this.dayTime&&(this.time-=this.dayTime),this.updateSky())},a.prototype.updateSky=function(){if(!this.sky)return;const t=this.sky.material.uniforms;if(t){t.turbidity.value=this.params.turbidity,t.rayleigh.value=this.params.rayleigh,t.mieCoefficient.value=this.params.mieCoefficient,t.mieDirectionalG.value=this.params.mieDirectionalG;var e=TDS_RT.program.getActiveRenderer();e&&(e.toneMappingExposure=this.params.exposure);var n=Math.PI*(this.params.inclination-.5),i=2*Math.PI*(this.params.azimuth-.5);this.sun.x=Math.cos(i),this.sun.y=Math.sin(i)*Math.sin(n),this.sun.z=Math.sin(i)*Math.cos(n),this.sky&&t.sunPosition.value.copy(this.sun)}},a.prototype.toJSON=function(t){return r.prototype.toJSON.call(this,t)},e.a=o("sky",a)}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e){var n,r,o,a,s,l;void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN},this.touches={ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(u),c.update(),p=d.NONE},this.update=(n=new i.Vector3,r=(new i.Quaternion).setFromUnitVectors(t.up,new i.Vector3(0,1,0)),o=r.clone().inverse(),a=new i.Vector3,s=new i.Quaternion,l=2*Math.PI,function(){var t=c.object.position;n.copy(t).sub(c.target),n.applyQuaternion(r),g.setFromVector3(n),c.autoRotate&&p===d.NONE&&R(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(g.theta+=v.theta*c.dampingFactor,g.phi+=v.phi*c.dampingFactor):(g.theta+=v.theta,g.phi+=v.phi);var e=c.minAzimuthAngle,i=c.maxAzimuthAngle;return isFinite(e)&&isFinite(i)&&(e<-Math.PI?e+=l:e>Math.PI&&(e-=l),i<-Math.PI?i+=l:i>Math.PI&&(i-=l),g.theta=e<i?Math.max(e,Math.min(i,g.theta)):g.theta>(e+i)/2?Math.max(e,g.theta):Math.min(i,g.theta)),g.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=y,g.radius=Math.max(c.minDistance,Math.min(c.maxDistance,g.radius)),!0===c.enableDamping?c.target.addScaledVector(x,c.dampingFactor):c.target.add(x),n.setFromSpherical(g),n.applyQuaternion(o),t.copy(c.target).add(n),c.object.lookAt(c.target),!0===c.enableDamping?(v.theta*=1-c.dampingFactor,v.phi*=1-c.dampingFactor,x.multiplyScalar(1-c.dampingFactor)):(v.set(0,0,0),x.set(0,0,0)),y=1,!!(b||a.distanceToSquared(c.object.position)>m||8*(1-s.dot(c.object.quaternion))>m)&&(c.dispatchEvent(u),a.copy(c.object.position),s.copy(c.object.quaternion),b=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",et,!1),c.domElement.removeEventListener("pointerdown",X,!1),c.domElement.removeEventListener("wheel",Q,!1),c.domElement.removeEventListener("touchstart",K,!1),c.domElement.removeEventListener("touchend",tt,!1),c.domElement.removeEventListener("touchmove",$,!1),c.domElement.ownerDocument.removeEventListener("pointermove",Y,!1),c.domElement.ownerDocument.removeEventListener("pointerup",Z,!1),c.domElement.removeEventListener("keydown",J,!1)};var c=this,u={type:"change"},h={type:"start"},f={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,m=1e-6,g=new i.Spherical,v=new i.Spherical,y=1,x=new i.Vector3,b=!1,w=new i.Vector2,_=new i.Vector2,M=new i.Vector2,S=new i.Vector2,T=new i.Vector2,A=new i.Vector2,E=new i.Vector2,q=new i.Vector2,C=new i.Vector2;function P(){return Math.pow(.95,c.zoomSpeed)}function R(t){v.theta-=t}function L(t){v.phi-=t}var I,D=(I=new i.Vector3,function(t,e){I.setFromMatrixColumn(e,0),I.multiplyScalar(-t),x.add(I)}),O=function(){var t=new i.Vector3;return function(e,n){!0===c.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(c.object.up,t)),t.multiplyScalar(e),x.add(t)}}(),N=function(){var t=new i.Vector3;return function(e,n){var i=c.domElement;if(c.object.isPerspectiveCamera){var r=c.object.position;t.copy(r).sub(c.target);var o=t.length();o*=Math.tan(c.object.fov/2*Math.PI/180),D(2*e*o/i.clientHeight,c.object.matrix),O(2*n*o/i.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(D(e*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),O(n*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function F(t){c.object.isPerspectiveCamera?y/=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function B(t){c.object.isPerspectiveCamera?y*=t:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/t)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function z(t){w.set(t.clientX,t.clientY)}function U(t){S.set(t.clientX,t.clientY)}function k(t){if(1==t.touches.length)w.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);w.set(e,n)}}function j(t){if(1==t.touches.length)S.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);S.set(e,n)}}function V(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);E.set(0,i)}function G(t){if(1==t.touches.length)_.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);_.set(e,n)}M.subVectors(_,w).multiplyScalar(c.rotateSpeed);var i=c.domElement;R(2*Math.PI*M.x/i.clientHeight),L(2*Math.PI*M.y/i.clientHeight),w.copy(_)}function H(t){if(1==t.touches.length)T.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);T.set(e,n)}A.subVectors(T,S).multiplyScalar(c.panSpeed),N(A.x,A.y),S.copy(T)}function W(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);q.set(0,i),C.set(0,Math.pow(q.y/E.y,c.zoomSpeed)),F(C.y),E.copy(q)}function X(t){if(!1!==c.enabled)switch(t.pointerType){case"mouse":!function(t){var e;switch(t.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),t.button){case 0:e=c.mouseButtons.LEFT;break;case 1:e=c.mouseButtons.MIDDLE;break;case 2:e=c.mouseButtons.RIGHT;break;default:e=-1}switch(e){case i.MOUSE.DOLLY:if(!1===c.enableZoom)return;!function(t){E.set(t.clientX,t.clientY)}(t),p=d.DOLLY;break;case i.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===c.enablePan)return;U(t),p=d.PAN}else{if(!1===c.enableRotate)return;z(t),p=d.ROTATE}break;case i.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===c.enableRotate)return;z(t),p=d.ROTATE}else{if(!1===c.enablePan)return;U(t),p=d.PAN}break;default:p=d.NONE}p!==d.NONE&&(c.domElement.ownerDocument.addEventListener("pointermove",Y,!1),c.domElement.ownerDocument.addEventListener("pointerup",Z,!1),c.dispatchEvent(h))}(t)}}function Y(t){if(!1!==c.enabled)switch(t.pointerType){case"mouse":!function(t){if(!1===c.enabled)return;switch(t.preventDefault(),p){case d.ROTATE:if(!1===c.enableRotate)return;!function(t){_.set(t.clientX,t.clientY),M.subVectors(_,w).multiplyScalar(c.rotateSpeed);var e=c.domElement;R(2*Math.PI*M.x/e.clientHeight),L(2*Math.PI*M.y/e.clientHeight),w.copy(_),c.update()}(t);break;case d.DOLLY:if(!1===c.enableZoom)return;!function(t){q.set(t.clientX,t.clientY),C.subVectors(q,E),C.y>0?F(P()):C.y<0&&B(P()),E.copy(q),c.update()}(t);break;case d.PAN:if(!1===c.enablePan)return;!function(t){T.set(t.clientX,t.clientY),A.subVectors(T,S).multiplyScalar(c.panSpeed),N(A.x,A.y),S.copy(T),c.update()}(t)}}(t)}}function Z(t){if(!1!==c.enabled)switch(t.pointerType){case"mouse":!function(t){if(!1===c.enabled)return;c.domElement.ownerDocument.removeEventListener("pointermove",Y,!1),c.domElement.ownerDocument.removeEventListener("pointerup",Z,!1),c.dispatchEvent(f),p=d.NONE}()}}function Q(t){!1===c.enabled||!1===c.enableZoom||p!==d.NONE&&p!==d.ROTATE||(t.preventDefault(),t.stopPropagation(),c.dispatchEvent(h),function(t){t.deltaY<0?B(P()):t.deltaY>0&&F(P()),c.update()}(t),c.dispatchEvent(f))}function J(t){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(t){var e=!1;switch(t.keyCode){case c.keys.UP:N(0,c.keyPanSpeed),e=!0;break;case c.keys.BOTTOM:N(0,-c.keyPanSpeed),e=!0;break;case c.keys.LEFT:N(c.keyPanSpeed,0),e=!0;break;case c.keys.RIGHT:N(-c.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),c.update())}(t)}function K(t){if(!1!==c.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(c.touches.ONE){case i.TOUCH.ROTATE:if(!1===c.enableRotate)return;k(t),p=d.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===c.enablePan)return;j(t),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(c.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(t){c.enableZoom&&V(t),c.enablePan&&j(t)}(t),p=d.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(t){c.enableZoom&&V(t),c.enableRotate&&k(t)}(t),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}p!==d.NONE&&c.dispatchEvent(h)}}function $(t){if(!1!==c.enabled)switch(t.preventDefault(),t.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===c.enableRotate)return;G(t),c.update();break;case d.TOUCH_PAN:if(!1===c.enablePan)return;H(t),c.update();break;case d.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(t){c.enableZoom&&W(t),c.enablePan&&H(t)}(t),c.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(t){c.enableZoom&&W(t),c.enableRotate&&G(t)}(t),c.update();break;default:p=d.NONE}}function tt(t){!1!==c.enabled&&(c.dispatchEvent(f),p=d.NONE)}function et(t){!1!==c.enabled&&t.preventDefault()}c.domElement.addEventListener("contextmenu",et,!1),c.domElement.addEventListener("pointerdown",X,!1),c.domElement.addEventListener("wheel",Q,!1),c.domElement.addEventListener("touchstart",K,!1),c.domElement.addEventListener("touchend",tt,!1),c.domElement.addEventListener("touchmove",$,!1),c.domElement.addEventListener("keydown",J,!1),-1===c.domElement.tabIndex&&(c.domElement.tabIndex=0),this.update()};r.prototype=Object.create(i.EventDispatcher.prototype),r.prototype.constructor=r;var o=function(t,e){r.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=i.MOUSE.PAN,this.mouseButtons.RIGHT=i.MOUSE.ROTATE,this.touches.ONE=i.TOUCH.PAN,this.touches.TWO=i.TOUCH.DOLLY_ROTATE};(o.prototype=Object.create(i.EventDispatcher.prototype)).constructor=o},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=0,r=0,o=0,a=0;function s(){this.element=null,this.offsetTop=0,this.offsetLeft=0}s.prototype.setup=function(t){t.onmousedown=e=>{e=e||window.event,o=e.clientX,a=e.clientY,this.start(t,e)}},s.prototype.start=function(t,e){document.onmouseup=e=>{this.stop(t)},document.onmousemove=e=>{this.dragging(t,e)},t.onmouseleave=t=>{}},s.prototype.dragging=function(t,e){e=e||window.event,i=o-e.clientX,r=a-e.clientY,o=e.clientX,a=e.clientY;var n=function(t){var e=t.currentStyle||window.getComputedStyle(t),n=e.getPropertyValue("margin-left").match(/\d+/),i=e.getPropertyValue("margin-top").match(/\d+/);return{left:t.offsetLeft-n,top:t.offsetTop-i}}(t);this.offsetTop+=-r,this.offsetLeft+=-i,t.style.top=n.top-r+"px",t.style.left=n.left-i+"px"},s.prototype.stop=function(t){document.onmouseup=null,document.onmousemove=null},s.prototype.dispose=function(t){this.stop(t),t.onmousedown=null},s.prototype.toggle=function(t,e){t?this.setup(e):this.dispose(e)}},function(t,e,n){"use strict";function i(){var t=function(t){this.element=t,this.next=null,this.prev=null},e=0,n=null,i=null;this.append=function(r){var o,a=new t(r);if(n){for(o=n;o.next!==n;)o,o=o.next;o.next=a,a.next=n,a.prev=o}else i=a,(n=a).prev=i,i.next=n;return e++,!0},this.insert=function(r,o){if(r>=0&&r<=e){var a,s=new t(o),l=0,c=n;if(0===r)n?(c.prev=s,s.next=c,n=s,s.prev=i):(s.next=s,s.tail=s,n=s,i=s);else if(r===e)(c=i).next=s,s.prev=c,i=s,s.next=n;else{for(;l++<r;)a=c,c=c.next;c.prev=s,s.next=c,a.next=s,s.prev=a}return e++,!0}return!1},this.removeAt=function(t){if(t>-1&&t<e){var r,o=n,a=0;if(0===t)o.next.previous=i,n=o.next;else if(t===e-1)(o=i).prev.next=n,n.prev=o.prev,i=o.prev;else{for(;a++<t;)r=o,o=o.next;r.next=o.next,o.next.prev=r}return e--,!0}return!1},this.remove=function(t){for(var r,o=n,a=0;o&&a<e;){if(o.element===t)return 0===a?(o.next.prev=i,n=o.next):(o.next.prev=r,r.next=o.next),e--,!0;r=o,o=o.next,a++}return!1},this.remove=function(){if(0===e)return!1;var t,r=n,o=0;if(1===e)return n=null,i=null,e--,r.element;for(;o++<e;)t=r,r=r.next;return t.next=n,i=t.next,e--,r.element},this.indexOf=function(t){for(var i=n,r=0;i&&r++<e;){if(i.element===t)return r;i=i.next}return!1},this.next=function(t){for(var i=n,r=0;i&&r++<e;){if(i.element===t)return i.next.element;i=i.next}return!1},this.prev=function(t){for(var i=n,r=0;i&&r++<e;){if(i.element===t)return i.prev.element;i=i.next}return!1},this.toString=function(){for(var t=n,i=0,r="";t&&i<e;)r+=t.element,i++,t=t.next;return r},this.isEmpty=function(){return 0===e},this.getHead=function(){return n},this.getTail=function(){return i},this.size=function(){return e}}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t,e){void 0===e&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),e=document),this.object=t,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var n,r=0,o=0,a=new i.Vector3,s=new i.Spherical,l=new i.Vector3;function c(t){t.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(t){if(this.domElement!==document&&this.domElement.focus(),t.preventDefault(),t.stopPropagation(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(t){if(t.preventDefault(),t.stopPropagation(),this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(t){this.domElement===document?(this.mouseX=t.pageX-this.viewHalfX,this.mouseY=t.pageY-this.viewHalfY):(this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(t){switch(t.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(t,e,n){return t.isVector3?l.copy(t):l.set(t,e,n),this.object.lookAt(l),g(this),this},this.update=(n=new i.Vector3,function(t){if(!1!==this.enabled){if(this.heightSpeed){var e=i.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*(e*this.heightCoef)}else this.autoSpeedFactor=0;var a=t*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var s=t*this.lookSpeed;this.activeLook||(s=0);var l=1;this.constrainVertical&&(l=Math.PI/(this.verticalMax-this.verticalMin)),o-=this.mouseX*s,this.lookVertical&&(r-=this.mouseY*s*l),r=Math.max(-85,Math.min(85,r));var c=i.MathUtils.degToRad(90-r),u=i.MathUtils.degToRad(o);this.constrainVertical&&(c=i.MathUtils.mapLinear(c,0,Math.PI,this.verticalMin,this.verticalMax));var h=this.object.position;n.setFromSphericalCoords(1,c,u).add(h),this.object.lookAt(n)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",c,!1),this.domElement.removeEventListener("mousedown",h,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",f,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",p,!1)};var u=m(this,this.onMouseMove),h=m(this,this.onMouseDown),f=m(this,this.onMouseUp),d=m(this,this.onKeyDown),p=m(this,this.onKeyUp);function m(t,e){return function(){e.apply(t,arguments)}}function g(t){var e=t.object.quaternion;a.set(0,0,-1).applyQuaternion(e),s.setFromVector3(a),r=90-i.MathUtils.radToDeg(s.phi),o=i.MathUtils.radToDeg(s.theta)}this.domElement.addEventListener("contextmenu",c,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mousedown",h,!1),this.domElement.addEventListener("mouseup",f,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",p,!1),this.handleResize(),g(this)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),r=n(137),o=n(138),a=function(t,e){i.Mesh.call(this,t),this.type="Water";var n=this,s=void 0!==(e=e||{}).color?new i.Color(e.color):new i.Color(16777215),l=e.textureWidth||512,c=e.textureHeight||512,u=e.clipBias||0,h=e.flowDirection||new i.Vector2(1,0),f=e.flowSpeed||.03,d=e.reflectivity||.02,p=e.scale||1,m=e.shader||a.WaterShader,g=void 0!==e.encoding?e.encoding:i.LinearEncoding,v=new i.TextureLoader,y=e.flowMap||void 0,x=e.normalMap0||v.load("textures/water/Water_1_M_Normal.jpg"),b=e.normalMap1||v.load("textures/water/Water_2_M_Normal.jpg"),w=new i.Matrix4,_=new i.Clock;if(void 0!==r.a)if(void 0!==o.a){var M=new r.a(t,{textureWidth:l,textureHeight:c,clipBias:u,encoding:g}),S=new o.a(t,{textureWidth:l,textureHeight:c,clipBias:u,encoding:g});M.matrixAutoUpdate=!1,S.matrixAutoUpdate=!1,this.material=new i.ShaderMaterial({uniforms:i.UniformsUtils.merge([i.UniformsLib.fog,m.uniforms]),vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,transparent:!0,fog:!0}),void 0!==y?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:y}):this.material.uniforms.flowDirection={type:"v2",value:h},x.wrapS=x.wrapT=i.RepeatWrapping,b.wrapS=b.wrapT=i.RepeatWrapping,this.material.uniforms.tReflectionMap.value=M.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=S.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=x,this.material.uniforms.tNormalMap1.value=b,this.material.uniforms.color.value=s,this.material.uniforms.reflectivity.value=d,this.material.uniforms.textureMatrix.value=w,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=p,this.onBeforeRender=function(t,e,i){var r,o;!function(t){w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(t.projectionMatrix),w.multiply(t.matrixWorldInverse),w.multiply(n.matrixWorld)}(i),r=_.getDelta(),(o=n.material.uniforms.config).value.x+=f*r,o.value.y=o.value.x+.075,o.value.x>=.15?(o.value.x=0,o.value.y=.075):o.value.y>=.15&&(o.value.y=o.value.y-.15),n.visible=!1,M.matrixWorld.copy(n.matrixWorld),S.matrixWorld.copy(n.matrixWorld),M.onBeforeRender(t,e,i),S.onBeforeRender(t,e,i),n.visible=!0}}else console.error("THREE.Water: Required component Refractor not found.");else console.error("THREE.Water: Required component Reflector not found.")};a.prototype=Object.create(i.Mesh.prototype),a.prototype.constructor=a,a.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new i.Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));n(0),n(47);var i=n(30),r=n(140);n(240);function o(e,n,o,a,s){i.a.call(this),this.type="Glass",this.copyToScreen=!0,this.useCubeMap=!0,this.fsQuad=new i.a.FullScreenQuad,this.refractionIndex=void 0!==n?n:2.42,this.dispersion=void 0!==o?o:.044,this.roughness=void 0!==a?a:.98,this.resolution=void 0!==s?s:256,this.rtBackSide=new t.WebGLRenderTarget(window.offsetWidth,window.offsetHeight,{type:t.HalfFloatType}),this.entity=e,this.useCubeMap&&(this.cubeRenderTarget=new t.WebGLCubeRenderTarget(256,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding}),this.cubeCamera=new t.CubeCamera(.1,1e3,this.cubeRenderTarget),this.cubeCamera.position.copy(this.entity.position),this.entity.onBeforeRender=(t,e,n)=>{this.entity.visible=!1,this.cubeCamera.update(t,e),this.entity.visible=!0});const l=new t.ShaderMaterial({vertexShader:"\n\t\tvarying vec3 vWorldNormal;\n\t\t\n\t\tvoid main() {\n\t\t\tvWorldNormal = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t\t\tvWorldNormal = -normalize(vec3(-vWorldNormal.x, vWorldNormal.yz));\n\t\t\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t}",fragmentShader:"\n\t\tvarying vec3 vWorldNormal;\n\t\t\n\t\tvoid main() {\n\t\t\tgl_FragColor.rgb = vWorldNormal;\n\t\t}",side:t.BackSide});var c=new t.Mesh(this.entity.geometry,l);c.position.copy(this.entity.position),c.scale.copy(this.entity.scale),c.rotation.copy(this.entity.rotation),this.backScene=new t.Scene,this.backScene.add(c);var u=t.UniformsUtils.clone(r.a.uniforms);u.refractionIndex.value=this.refractionIndex,u.dispersion.value=this.dispersion,u.roughness.value=this.roughness,u.color.value=this.entity.material.color,this.entity.material.envMap?u.envMap.value=this.entity.material.envMap:this.useCubeMap&&(u.envMap.value=this.cubeRenderTarget.texture);var h=new t.ShaderMaterial({uniforms:u,vertexShader:r.a.vertexShader,fragmentShader:r.a.fragmentShader});this.entity.material=h;const f=new t.EdgesGeometry(this.entity.geometry),d=new t.LineSegments(f,new t.LineBasicMaterial({color:4294901777}));d.position.copy(this.entity.position),d.scale.copy(this.entity.scale),d.rotation.copy(this.entity.rotation),this.glitterGeo=(new t.Geometry).fromBufferGeometry(f),this.raycaster=new t.Raycaster,this._rdVertIndexs=this._getRandomVerticesFromEdge(),this.time=0}o.prototype=Object.create(i.a.prototype),o.prototype._getRandomVerticesFromEdge=function(){for(var t,e,n=[],i=0;i<24;i++){var r=(t=0,e=this.glitterGeo.vertices.length,t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t);n.push(r)}return n},o.prototype.render=function(e,n,i,r,o,a,s){this.time+=r,this.rtBackSide.setSize(n.width,n.height),e.setRenderTarget(this.rtBackSide),e.clear(!0,!0),e.render(this.backScene,s),this.entity.material.uniforms.resolution.value=new t.Vector2(n.width,n.height),this.entity.material.uniforms.backNormals.value=this.rtBackSide.texture,this.entity.material.uniforms.time.value+=r,this.entity.material.uniforms.refractionIndex.value=this.refractionIndex,this.entity.material.uniforms.dispersion.value=this.dispersion,this.entity.material.uniforms.roughness.value=this.roughness;for(var l=0;l<this._rdVertIndexs.length;l++){var c=this._rdVertIndexs[l],u=this.glitterGeo.vertices[c].clone().applyMatrix4(this.entity.object3D.matrixWorld),h=u.clone().sub(s.position).normalize();this.raycaster.set(s.position,h);var f=this.raycaster.intersectObjects([a],!0);if(0===f.length||u.distanceTo(s.position)-f[0].distance>1e-7){this.entity.material.uniforms.glitters.value[l]=new t.Vector2(0,0);continue}u.project(s);let e=n.width/2,i=n.height/2,r=u.x*e+e,o=-u.y*i+i;this.entity.material.uniforms.glitters.value[l]=new t.Vector2(r,o)}e.setRenderTarget(null),e.clear(!0,!0),e.render(a,s)},o.prototype.toJSON=function(t){var e=i.a.prototype.toJSON.call(this,t);return e.refractionIndex=this.refractionIndex,e.dispersion=this.dispersion,e.roughness=this.roughness,e.resolution=this.resolution,e}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),r=n(43),o=n(47),a=function(t,e,n,a){this.renderScene=e,this.renderCamera=n,this.selectedObjects=void 0!==a?a:[],this.visibleEdgeColor=new i.Color(1,1,1),this.hiddenEdgeColor=new i.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,r.a.call(this),this.resolution=void 0!==t?new i.Vector2(t.x,t.y):new i.Vector2(256,256);var s={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat},l=Math.round(this.resolution.x/this.downSampleRatio),c=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new i.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=i.DoubleSide,this.renderTargetMaskBuffer=new i.WebGLRenderTarget(this.resolution.x,this.resolution.y,s),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new i.MeshDepthMaterial,this.depthMaterial.side=i.DoubleSide,this.depthMaterial.depthPacking=i.RGBADepthPacking,this.depthMaterial.blending=i.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=i.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(t,e){var n=e.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new i.WebGLRenderTarget(this.resolution.x,this.resolution.y,s),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new i.WebGLRenderTarget(l,c,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new i.WebGLRenderTarget(l,c,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new i.WebGLRenderTarget(Math.round(l/2),Math.round(c/2),s),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new i.WebGLRenderTarget(l,c,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new i.WebGLRenderTarget(Math.round(l/2),Math.round(c/2),s),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(l,c),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(l/2),Math.round(c/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===o.a&&console.error("OutlinePass relies on CopyShader");var u=o.a;this.copyUniforms=i.UniformsUtils.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new i.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:i.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new i.Color,this.oldClearAlpha=1,this.fsQuad=new r.a.FullScreenQuad(null),this.tempPulseColor1=new i.Color,this.tempPulseColor2=new i.Color,this.textureMatrix=new i.Matrix4};a.prototype=Object.assign(Object.create(r.a.prototype),{constructor:a,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,e){this.renderTargetMaskBuffer.setSize(t,e);var n=Math.round(t/this.downSampleRatio),i=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this.separableBlurMaterial1.uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this.separableBlurMaterial2.uniforms.texSize.value.set(n,i)},changeVisibilityOfSelectedObjects:function(t){function e(e){e.isMesh&&(t?(e.visible=e.userData.oldVisible,delete e.userData.oldVisible):(e.userData.oldVisible=e.visible,e.visible=t))}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(e)}},changeVisibilityOfNonSelectedObjects:function(t){var e=[];function n(t){t.isMesh&&e.push(t)}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(n)}this.renderScene.traverse((function(n){if(n.isMesh||n.isLine||n.isSprite){for(var i=!1,r=0;r<e.length;r++){if(e[r].id===n.id){i=!0;break}}if(!i){var o=n.visible;t&&!n.bVisible||(n.visible=t),n.bVisible=o}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,e,n,i,r){if(this.selectedObjects.length>0){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,r&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=s,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var l=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=a.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=a.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=a.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=a.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(n),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,t.setRenderTarget(null),this.fsQuad.render(t))},getPrepareMaskMaterial:function(){return new i.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new i.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new i.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new i.Vector2(.5,.5)},visibleEdgeColor:{value:new i.Vector3(1,1,1)},hiddenEdgeColor:{value:new i.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new i.ShaderMaterial({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new i.Vector2(.5,.5)},direction:{value:new i.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new i.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),a.BlurDirectionX=new i.Vector2(1,0),a.BlurDirectionY=new i.Vector2(0,1)},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(62),r=n(119);function o(e){i.a.call(this,r.d),this.enabled=!0,this.type="Godrays",this.copyToScreen=!0,this.sunPosition=new t.Vector3(0,500,-1e3),this.screenSpacePosition=new t.Vector3,this.materialDepth=new t.MeshDepthMaterial,this.bgColor=1297,this.sunColor=16772608,this.godrayRenderTargetResolutionMultiplier=.25,this.renderTarget=e,this.init(window.innerWidth,window.innerHeight)}o.prototype=Object.create(i.a.prototype),o.prototype.init=function(e,n){this.scene.add(this.camera);var i={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBFormat};this.rtTextureColors=new t.WebGLRenderTarget(e,n,i),this.rtTextureDepth=new t.WebGLRenderTarget(e,n,i),this.rtTextureDepthMask=new t.WebGLRenderTarget(e,n,i);var o=e*this.godrayRenderTargetResolutionMultiplier,a=n*this.godrayRenderTargetResolutionMultiplier;this.rtTextureGodRays1=new t.WebGLRenderTarget(o,a,i),this.rtTextureGodRays2=new t.WebGLRenderTarget(o,a,i);var s=r.b;this.godrayMaskUniforms=t.UniformsUtils.clone(s.uniforms),this.materialGodraysDepthMask=new t.ShaderMaterial({uniforms:this.godrayMaskUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader});var l=r.d;this.godrayGenUniforms=t.UniformsUtils.clone(l.uniforms),this.materialGodraysGenerate=new t.ShaderMaterial({uniforms:this.godrayGenUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader});var c=r.a;this.godrayCombineUniforms=t.UniformsUtils.clone(c.uniforms),this.materialGodraysCombine=new t.ShaderMaterial({uniforms:this.godrayCombineUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader});var u=r.c;this.godraysFakeSunUniforms=t.UniformsUtils.clone(u.uniforms),this.materialGodraysFakeSun=new t.ShaderMaterial({uniforms:this.godraysFakeSunUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.godraysFakeSunUniforms.bgColor.value.setHex(this.bgColor),this.godraysFakeSunUniforms.sunColor.value.setHex(this.sunColor),this.godrayCombineUniforms.fGodRayIntensity.value=.75},o.prototype.render=function(t,e,n,i,r,o,a){if(this.enabled){this.quad.material=this.materialGodraysGenerate;var s=this,l=this.renderTarget,c=t.autoClear,u=t.getClearColor();t.autoClear=!1,t.setClearColor(16777215),t.clear(),r&&t.context.disable(t.context.STENCIL_TEST),this.screenSpacePosition.copy(this.sunPosition).project(a),this.screenSpacePosition.x=(this.screenSpacePosition.x+1)/2,this.screenSpacePosition.y=(this.screenSpacePosition.y+1)/2,this.godrayGenUniforms.vSunPositionScreenSpace.value.x=this.screenSpacePosition.x,this.godrayGenUniforms.vSunPositionScreenSpace.value.y=this.screenSpacePosition.y,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.x=this.screenSpacePosition.x,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.y=this.screenSpacePosition.y,t.setRenderTarget(this.rtTextureColors),t.clear(!0,!0,!1);var h=.74*l.height,f=.74*l.height;this.screenSpacePosition.x*=l.width,this.screenSpacePosition.y*=l.height,t.setScissor(this.screenSpacePosition.x-f/2,this.screenSpacePosition.y-h/2,f,h),t.setScissorTest(!0),this.godraysFakeSunUniforms.fAspect.value=l.width/l.height,this.scene.overrideMaterial=this.materialGodraysFakeSun,t.setRenderTarget(this.rtTextureColors),t.render(this.scene,this.camera),t.setScissorTest(!1),o.overrideMaterial=null,t.setRenderTarget(this.rtTextureColors),t.render(o,a),o.overrideMaterial=this.materialDepth,t.setRenderTarget(this.rtTextureDepth),t.clear(),t.render(o,a),o.overrideMaterial=null,this.godrayMaskUniforms.tInput.value=this.rtTextureDepth.texture,this.scene.overrideMaterial=this.materialGodraysDepthMask,t.setRenderTarget(this.rtTextureDepthMask),t.render(this.scene,this.camera);p(this.rtTextureDepthMask.texture,this.rtTextureGodRays2,d(1,6,1)),p(this.rtTextureGodRays2.texture,this.rtTextureGodRays1,d(1,6,2)),p(this.rtTextureGodRays1.texture,this.rtTextureGodRays2,d(1,6,3)),this.godrayCombineUniforms.tColors.value=this.rtTextureColors.texture,this.godrayCombineUniforms.tGodRays.value=this.rtTextureGodRays2.texture,this.scene.overrideMaterial=this.materialGodraysCombine,t.setRenderTarget(e),t.render(this.scene,this.camera),this.scene.overrideMaterial=null,r&&t.context.enable(t.context.STENCIL_TEST),o.overrideMaterial=null,t.autoClear=c,t.setClearColor(u)}function d(t,e,n){return t*Math.pow(e,-n)}function p(e,n,i){s.scene.overrideMaterial=s.materialGodraysGenerate,s.godrayGenUniforms.fStepSize.value=i,s.godrayGenUniforms.tInput.value=e,t.setRenderTarget(n),t.render(s.scene,s.camera),s.scene.overrideMaterial=null}},o.prototype.setBackgroundColor=function(t){this.godraysFakeSunUniforms.bgColor.value.setHex(t)},o.prototype.setSunColor=function(t){this.godraysFakeSunUniforms.sunColor.value.setHex(t)},o.prototype.toJSON=function(t){}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r={uniforms:{u_size:{value:new i.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new i.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tvarying vec3 v_position;","\t\tvoid main() {","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inverse(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;","\t\t\t\tpos_in_cam.z = -pos_in_cam.w;","\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;","\t\t\t\tpos_in_cam.z = pos_in_cam.w;","\t\t\t\tv_farpos = viewtransformi * pos_in_cam;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","\t\t}"].join("\n"),fragmentShader:["\t\tprecision highp float;","\t\tprecision mediump sampler3D;","\t\tuniform vec3 u_size;","\t\tuniform int u_renderstyle;","\t\tuniform float u_renderthreshold;","\t\tuniform vec2 u_clim;","\t\tuniform sampler3D u_data;","\t\tuniform sampler2D u_cmdata;","\t\tvarying vec3 v_position;","\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","\t\tconst int REFINEMENT_STEPS = 4;","\t\tconst float relative_step_size = 1.0;","\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","\t\tconst float shininess = 40.0;","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tfloat sample1(vec3 texcoords);","\t\tvec4 apply_colormap(float val);","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","\t\tvoid main() {","\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;","\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;","\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));","\t\t\t\tvec3 front = v_position + view_ray * distance;","\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);","\t\t\t\tif ( nsteps < 1 )","\t\t\t\t\t\tdiscard;","\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);","\t\t\t\tvec3 start_loc = front / u_size;","\t\t\t\tif (u_renderstyle == 0)","\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);","\t\t\t\telse if (u_renderstyle == 1)","\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);","\t\t\t\tif (gl_FragColor.a < 0.05)","\t\t\t\t\t\tdiscard;","\t\t}","\t\tfloat sample1(vec3 texcoords) {","\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */","\t\t\t\treturn texture(u_data, texcoords.xyz).r;","\t\t}","\t\tvec4 apply_colormap(float val) {","\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));","\t\t}","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tfloat max_val = -1e6;","\t\t\t\tint max_i = 100;","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > max_val) {","\t\t\t\t\t\t\t\tmax_val = val;","\t\t\t\t\t\t\t\tmax_i = iter;","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);","\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));","\t\t\t\t\t\tiloc += istep;","\t\t\t\t}","\t\t\t\tgl_FragColor = apply_colormap(max_val);","\t\t}","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent","\t\t\t\tvec4 color3 = vec4(0.0);\t// final color","\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > low_threshold) {","\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;","\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);","\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {","\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);","\t\t\t\t\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t\tiloc += istep;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t}","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","\t\t{","\t\t\t\tvec3 V = normalize(view_ray);","\t\t\t\tvec3 N;","\t\t\t\tfloat val1, val2;","\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","\t\t\t\tN[0] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));","\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));","\t\t\t\tN[1] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","\t\t\t\tN[2] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tfloat gm = length(N); // gradient magnitude","\t\t\t\tN = normalize(N);","\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);","\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tfor (int i=0; i<1; i++)","\t\t\t\t{","\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];","\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );","\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));","\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);","\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector","\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);","\t\t\t\t\t\tfloat mask1 = lightEnabled;","\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;","\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;","\t\t\t\t}","\t\t\t\tvec4 final_color;","\t\t\t\tvec4 color = apply_colormap(val);","\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;","\t\t\t\tfinal_color.a = color.a;","\t\t\t\treturn final_color;","\t\t}"].join("\n")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=(["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","\tgl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n"),new i.Vector3(1,1,1),["varying vec2 vUv;","varying vec3 v_position;","varying float noise;","uniform float time;","vec3 mod289(vec3 x)","{","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x)","{","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x)","{","  return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","vec3 fade(vec3 t) {","  return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float cnoise(vec3 P)","{","  vec3 Pi0 = floor(P); // Integer part for indexing","  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1","  Pi0 = mod289(Pi0);","  Pi1 = mod289(Pi1);","  vec3 Pf0 = fract(P); // Fractional part for interpolation","  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","  vec4 iy = vec4(Pi0.yy, Pi1.yy);","  vec4 iz0 = Pi0.zzzz;","  vec4 iz1 = Pi1.zzzz;","  vec4 ixy = permute(permute(ix) + iy);","  vec4 ixy0 = permute(ixy + iz0);","  vec4 ixy1 = permute(ixy + iz1);","  vec4 gx0 = ixy0 * (1.0 / 7.0);","  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","  gx0 = fract(gx0);","  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","  vec4 sz0 = step(gz0, vec4(0.0));","  gx0 -= sz0 * (step(0.0, gx0) - 0.5);","  gy0 -= sz0 * (step(0.0, gy0) - 0.5);","  vec4 gx1 = ixy1 * (1.0 / 7.0);","  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","  gx1 = fract(gx1);","  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","  vec4 sz1 = step(gz1, vec4(0.0));","  gx1 -= sz1 * (step(0.0, gx1) - 0.5);","  gy1 -= sz1 * (step(0.0, gy1) - 0.5);","  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","  g000 *= norm0.x;","  g010 *= norm0.y;","  g100 *= norm0.z;","  g110 *= norm0.w;","  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","  g001 *= norm1.x;","  g011 *= norm1.y;","  g101 *= norm1.z;","  g111 *= norm1.w;","  float n000 = dot(g000, Pf0);","  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","  float n111 = dot(g111, Pf1);","  vec3 fade_xyz = fade(Pf0);","  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);","  return 2.2 * n_xyz;","}","float pnoise(vec3 P, vec3 rep)","{","  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period","  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period","  Pi0 = mod289(Pi0);","  Pi1 = mod289(Pi1);","  vec3 Pf0 = fract(P); // Fractional part for interpolation","  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","  vec4 iy = vec4(Pi0.yy, Pi1.yy);","  vec4 iz0 = Pi0.zzzz;","  vec4 iz1 = Pi1.zzzz;","  vec4 ixy = permute(permute(ix) + iy);","  vec4 ixy0 = permute(ixy + iz0);","  vec4 ixy1 = permute(ixy + iz1);","  vec4 gx0 = ixy0 * (1.0 / 7.0);","  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","  gx0 = fract(gx0);","  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","  vec4 sz0 = step(gz0, vec4(0.0));","  gx0 -= sz0 * (step(0.0, gx0) - 0.5);","  gy0 -= sz0 * (step(0.0, gy0) - 0.5);","  vec4 gx1 = ixy1 * (1.0 / 7.0);","  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","  gx1 = fract(gx1);","  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","  vec4 sz1 = step(gz1, vec4(0.0));","  gx1 -= sz1 * (step(0.0, gx1) - 0.5);","  gy1 -= sz1 * (step(0.0, gy1) - 0.5);","  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","  g000 *= norm0.x;","  g010 *= norm0.y;","  g100 *= norm0.z;","  g110 *= norm0.w;","  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","  g001 *= norm1.x;","  g011 *= norm1.y;","  g101 *= norm1.z;","  g111 *= norm1.w;","  float n000 = dot(g000, Pf0);","  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","  float n111 = dot(g111, Pf1);","  vec3 fade_xyz = fade(Pf0);","  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);","  return 2.2 * n_xyz;","}","float turbulence( vec3 p ) {","  float t = -.5;","  for (float f = 1.0 ; f <= 10.0 ; f++ ){","    float power = pow( 2.0, f );","    t += abs( pnoise( vec3( power * p ), vec3( 1.0, 1.0, 1.0 ) ) / power );","  }","  return t;","}","void main() {","vUv = uv;","noise = 10.0 *  -.10 * turbulence( .5 * normal + time );","v_position = position;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),["precision mediump sampler3D;","varying vec2 vUv;","varying vec3 v_position;","varying float noise;","uniform sampler2D tDiffuse;","uniform float density;","uniform vec3 u_camera;","uniform vec3 u_object;","uniform vec3 u_size;","uniform sampler3D u_data;","const int MAX_SAMPLES = 100;","const float step_size = 0.05;","vec2 intersectAABB(vec3 rayOrigin, vec3 rayDir, vec3 boxMin, vec3 boxMax);","vec3 applyFog( vec3 rgb, float distance, float radius);","float CalcGauss( float x, float sigma );","vec4 hblur(float h);","float random( vec3 scale, float seed ){","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed ) ;","}","void main()","{","vec2 texCoord = vUv;","vec4 color = texture(tDiffuse, texCoord.xy);","vec3 rayDir = normalize(v_position - u_camera);","vec3 rayOrigin = u_camera;","vec3 boxMin = vec3(0.0);","boxMin.x = u_object.x - u_size.x / 2.0;","boxMin.y = u_object.y - u_size.y / 2.0;","boxMin.z = u_object.z + u_size.z / 2.0;","vec3 boxMax = vec3(0.0);","boxMax.x = u_object.x + u_size.x / 2.0;","boxMax.y = u_object.y + u_size.y / 2.0;","boxMax.z = u_object.z - u_size.z / 2.0;","vec2 intersects = intersectAABB(rayOrigin, rayDir, boxMin, boxMax);","vec3 nearPos = u_camera + intersects.x*rayDir;","float dist = distance(nearPos, v_position);","float radius = distance(vec3(0.,0.,0.), v_position);","vec3 sp = (nearPos - v_position) / u_size;","int nsteps = int(dist / step_size);","color.a = 1.0;","color.a = texture(u_data, v_position).r;","gl_FragColor.rgb = applyFog(color.rgb, dist, radius);","gl_FragColor.a = color.a;","}","vec3 applyFog( vec3 rgb, float distance, float radius)","{"," float density = exp( -radius*radius );"," float absorption = 0.8;"," float fogAmount = 1.0 - exp( -distance*2.0 );"," vec3  fogColor  = vec3(0.9,0.9,0.9) * density;"," vec3  rgb_decayed = rgb - absorption * distance;"," return mix( rgb_decayed, fogColor, fogAmount );","}","vec2 intersectAABB(vec3 rayOrigin, vec3 rayDir, vec3 boxMin, vec3 boxMax) {","  vec3 tMin = (boxMin - rayOrigin) / rayDir;","  vec3 tMax = (boxMax - rayOrigin) / rayDir;","  vec3 t1 = min(tMin, tMax);","  vec3 t2 = max(tMin, tMax);","  float tNear = max(max(t1.x, t1.y), t1.z);","  float tFar = min(min(t2.x, t2.y), t2.z);","  return vec2(tNear, tFar);","}","float CalcGauss( float x, float sigma )","{","if ( sigma <= 0.0 )","return 0.0;","return exp( -(x*x) / (2.0 * sigma) ) / (2.0 * 3.14157 * sigma);","}","vec4 hblur(float h)","{","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","return sum;","}"].join("\n"),{uniforms:{density:{value:.1},absorb:{value:.1},u_size:{value:new i.Vector3(1,1,1)},u_camera:{value:null},u_object:{value:null},u_data:{value:null},u_cmdata:{value:null},time:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","varying vec3 v_position;","varying vec4 v_nearpos;","varying vec4 v_farpos;","varying float noise;","uniform float time;","varying vec4 pos_in_cam;","vec3 mod289(vec3 x)","{","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x)","{","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x)","{","  return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","vec3 fade(vec3 t) {","  return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float cnoise(vec3 P)","{","  vec3 Pi0 = floor(P); // Integer part for indexing","  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1","  Pi0 = mod289(Pi0);","  Pi1 = mod289(Pi1);","  vec3 Pf0 = fract(P); // Fractional part for interpolation","  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","  vec4 iy = vec4(Pi0.yy, Pi1.yy);","  vec4 iz0 = Pi0.zzzz;","  vec4 iz1 = Pi1.zzzz;","  vec4 ixy = permute(permute(ix) + iy);","  vec4 ixy0 = permute(ixy + iz0);","  vec4 ixy1 = permute(ixy + iz1);","  vec4 gx0 = ixy0 * (1.0 / 7.0);","  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","  gx0 = fract(gx0);","  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","  vec4 sz0 = step(gz0, vec4(0.0));","  gx0 -= sz0 * (step(0.0, gx0) - 0.5);","  gy0 -= sz0 * (step(0.0, gy0) - 0.5);","  vec4 gx1 = ixy1 * (1.0 / 7.0);","  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","  gx1 = fract(gx1);","  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","  vec4 sz1 = step(gz1, vec4(0.0));","  gx1 -= sz1 * (step(0.0, gx1) - 0.5);","  gy1 -= sz1 * (step(0.0, gy1) - 0.5);","  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","  g000 *= norm0.x;","  g010 *= norm0.y;","  g100 *= norm0.z;","  g110 *= norm0.w;","  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","  g001 *= norm1.x;","  g011 *= norm1.y;","  g101 *= norm1.z;","  g111 *= norm1.w;","  float n000 = dot(g000, Pf0);","  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","  float n111 = dot(g111, Pf1);","  vec3 fade_xyz = fade(Pf0);","  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);","  return 2.2 * n_xyz;","}","float pnoise(vec3 P, vec3 rep)","{","  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period","  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period","  Pi0 = mod289(Pi0);","  Pi1 = mod289(Pi1);","  vec3 Pf0 = fract(P); // Fractional part for interpolation","  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","  vec4 iy = vec4(Pi0.yy, Pi1.yy);","  vec4 iz0 = Pi0.zzzz;","  vec4 iz1 = Pi1.zzzz;","  vec4 ixy = permute(permute(ix) + iy);","  vec4 ixy0 = permute(ixy + iz0);","  vec4 ixy1 = permute(ixy + iz1);","  vec4 gx0 = ixy0 * (1.0 / 7.0);","  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","  gx0 = fract(gx0);","  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","  vec4 sz0 = step(gz0, vec4(0.0));","  gx0 -= sz0 * (step(0.0, gx0) - 0.5);","  gy0 -= sz0 * (step(0.0, gy0) - 0.5);","  vec4 gx1 = ixy1 * (1.0 / 7.0);","  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","  gx1 = fract(gx1);","  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","  vec4 sz1 = step(gz1, vec4(0.0));","  gx1 -= sz1 * (step(0.0, gx1) - 0.5);","  gy1 -= sz1 * (step(0.0, gy1) - 0.5);","  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","  g000 *= norm0.x;","  g010 *= norm0.y;","  g100 *= norm0.z;","  g110 *= norm0.w;","  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","  g001 *= norm1.x;","  g011 *= norm1.y;","  g101 *= norm1.z;","  g111 *= norm1.w;","  float n000 = dot(g000, Pf0);","  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","  float n111 = dot(g111, Pf1);","  vec3 fade_xyz = fade(Pf0);","  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);","  return 2.2 * n_xyz;","}","float turbulence( vec3 p ) {","  float t = -.5;","  for (float f = 1.0 ; f <= 10.0 ; f++ ){","    float power = pow( 2.0, f );","    t += abs( pnoise( vec3( power * p ), vec3( 1.0, 1.0, 1.0 ) ) / power );","  }","  return t;","}","\t\tmat4 inversemat(mat4 m) {","\t\t\t\tfloat","\t\t\t\ta00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","\t\t\t\ta10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","\t\t\t\ta20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","\t\t\t\ta30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","\t\t\t\tb00 = a00 * a11 - a01 * a10,","\t\t\t\tb01 = a00 * a12 - a02 * a10,","\t\t\t\tb02 = a00 * a13 - a03 * a10,","\t\t\t\tb03 = a01 * a12 - a02 * a11,","\t\t\t\tb04 = a01 * a13 - a03 * a11,","\t\t\t\tb05 = a02 * a13 - a03 * a12,","\t\t\t\tb06 = a20 * a31 - a21 * a30,","\t\t\t\tb07 = a20 * a32 - a22 * a30,","\t\t\t\tb08 = a20 * a33 - a23 * a30,","\t\t\t\tb09 = a21 * a32 - a22 * a31,","\t\t\t\tb10 = a21 * a33 - a23 * a31,","\t\t\t\tb11 = a22 * a33 - a23 * a32,","\t\t\t\tdet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","\t\treturn mat4(","\t\t\t\ta11 * b11 - a12 * b10 + a13 * b09,","\t\t\t\ta02 * b10 - a01 * b11 - a03 * b09,","\t\t\t\ta31 * b05 - a32 * b04 + a33 * b03,","\t\t\t\ta22 * b04 - a21 * b05 - a23 * b03,","\t\t\t\ta12 * b08 - a10 * b11 - a13 * b07,","\t\t\t\ta00 * b11 - a02 * b08 + a03 * b07,","\t\t\t\ta32 * b02 - a30 * b05 - a33 * b01,","\t\t\t\ta20 * b05 - a22 * b02 + a23 * b01,","\t\t\t\ta10 * b10 - a11 * b08 + a13 * b06,","\t\t\t\ta01 * b08 - a00 * b10 - a03 * b06,","\t\t\t\ta30 * b04 - a31 * b02 + a33 * b00,","\t\t\t\ta21 * b02 - a20 * b04 - a23 * b00,","\t\t\t\ta11 * b07 - a10 * b09 - a12 * b06,","\t\t\t\ta00 * b09 - a01 * b07 + a02 * b06,","\t\t\t\ta31 * b01 - a30 * b03 - a32 * b00,","\t\t\t\ta20 * b03 - a21 * b01 + a22 * b00) / det;","\t\t}","void main() {","vUv = uv;","noise = -2.0 * turbulence( .1 * normal + 0.1 * time );","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inversemat(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tpos_in_cam = viewtransformf * position4;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","}"].join("\n"),fragmentShader:["varying vec2 vUv;","varying vec3 v_position;","varying vec4 v_nearpos;","varying vec4 v_farpos;","varying vec4 pos_in_cam;","varying float noise;","uniform float density;","uniform vec3 u_camera;","uniform vec3 u_object;","uniform vec3 u_size;","uniform mediump sampler3D u_data;","uniform highp sampler2D u_cmdata;","const int MAX_SAMPLES = 100;","const float step_size = 0.01;","vec2 intersectAABB(vec3 rayOrigin, vec3 rayDir, vec3 boxMin, vec3 boxMax);","vec3 applyFog( vec3 rgb, float distance, float radius);","float CalcGauss( float x, float sigma );","vec4 hblur(float h);","vec4 hblur3(float dt, vec3 p);","float random( vec3 scale, float seed ){","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed ) ;","}","void main()","{","vec3 rayOrigin = vec3(0., 0.5, 5.0);","vec2 texCoord = vUv;","vec4 color = vec4(0.);","vec3 rayDir = normalize( v_position - rayOrigin );","vec3 boxMin = vec3(0.0);","boxMin.x = u_object.x - u_size.x / 2.0;","boxMin.y = u_object.y - u_size.y / 2.0;","boxMin.z = u_object.z - u_size.z / 2.0;","vec3 boxMax = vec3(0.0);","boxMax.x = u_object.x + u_size.x / 2.0;","boxMax.y = u_object.y + u_size.y / 2.0;","boxMax.z = u_object.z + u_size.z / 2.0;","vec2 intersects = intersectAABB(rayOrigin, rayDir, boxMin, boxMax);","vec3 nearPos = rayOrigin + intersects.x*rayDir;","float dist = distance(nearPos, v_position);","float radius = distance(vec3(0.,0.,0.), v_position);","float height = v_position.y - boxMin.y;","vec3 p = nearPos;","int nsteps = int(dist / step_size);","for(int i=0; i < MAX_SAMPLES; i++)","{","if(i == nsteps) {","break;","}","float val = texture(u_data, abs(p)).r;","vec4 val_color = vec4(texture2D(u_cmdata, vec2(val, 0.5)).rgb, val);","val_color.rgb += vec3(cos(1.5*val_color.r), cos(1.5*val_color.g), cos(1.5*val_color.b)) / 1.5;","val_color.a = clamp(val_color.a, 0.1, 1.0);","val_color.a *= (dist / 3.0 + exp( -radius*3.0 )) * exp( -height );","color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;","color.a += (1.0 - color.a) * val_color.a;","if (color.a >= 0.9) {","  break;","}","p += rayDir * step_size;","}","gl_FragColor.rgb = color.rgb;","gl_FragColor.a = color.a * noise;","if (gl_FragColor.a <= 0.1)"," discard;","}","vec3 applyFog( vec3 rgb, float distance, float radius)","{"," float density = exp( -radius*radius );"," float absorption = 0.8;"," float fogAmount = 1.0 - exp( -distance*2.0 );"," vec3  fogColor  = vec3(0.9,0.9,0.9);"," return mix( rgb, fogColor, fogAmount );","}","vec2 intersectAABB(vec3 rayOrigin, vec3 rayDir, vec3 boxMin, vec3 boxMax) {","  vec3 tMin = (boxMin - rayOrigin) / rayDir;","  vec3 tMax = (boxMax - rayOrigin) / rayDir;","  vec3 t1 = min(tMin, tMax);","  vec3 t2 = max(tMin, tMax);","  float tNear = max(max(t1.x, t1.y), t1.z);","  float tFar = min(min(t2.x, t2.y), t2.z);","  return vec2(tNear, tFar);","}","float CalcGauss( float x, float sigma )","{","if ( sigma <= 0.0 )","return 0.0;","return exp( -(x*x) / (2.0 * sigma) ) / (2.0 * 3.14157 * sigma);","}","vec4 hblur(float h, vec2 uv)","{","vec4 sum = vec4( 0.0 );","sum += texture2D( u_cmdata, vec2( uv.x - 4.0 * h, uv.y ) ) * 0.051;","sum += texture2D( u_cmdata, vec2( uv.x - 3.0 * h, uv.y ) ) * 0.0918;","sum += texture2D( u_cmdata, vec2( uv.x - 2.0 * h, uv.y ) ) * 0.12245;","sum += texture2D( u_cmdata, vec2( uv.x - 1.0 * h, uv.y ) ) * 0.1531;","sum += texture2D( u_cmdata, vec2( uv.x, uv.y ) ) * 0.1633;","sum += texture2D( u_cmdata, vec2( uv.x + 1.0 * h, uv.y ) ) * 0.1531;","sum += texture2D( u_cmdata, vec2( uv.x + 2.0 * h, uv.y ) ) * 0.12245;","sum += texture2D( u_cmdata, vec2( uv.x + 3.0 * h, uv.y ) ) * 0.0918;","sum += texture2D( u_cmdata, vec2( uv.x + 4.0 * h, uv.y ) ) * 0.051;","return sum;","}","vec4 hblur3(float dt, vec3 p)","{","vec4 sum = vec4( 0.0 );","sum += texture( u_data, abs(p));","sum += texture( u_data, abs(vec3(p.x - dt, p.y, p.z)) );","sum += texture( u_data, abs(vec3(p.x + dt, p.y, p.z)) );","sum += texture( u_data, abs(vec3(p.x, p.y - dt, p.z)) );","sum += texture( u_data, abs(vec3(p.x, p.y + dt, p.z)) );","sum += texture( u_data, abs(vec3(p.x, p.y, p.z - dt)) );","sum += texture( u_data, abs(vec3(p.x, p.y, p.z + dt)) );","return sum / 7.0;","}"].join("\n")})},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r=function(t){i.Loader.call(this,t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={format:null,astcSupported:!1,bptcSupported:!1,etcSupported:!1,dxtSupported:!1,pvrtcSupported:!1}};r.taskCache=new WeakMap,r.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:r,setTranscoderPath:function(t){return this.transcoderPath=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},detectSupport:function(t){var e=this.workerConfig;if(e.astcSupported=t.extensions.has("WEBGL_compressed_texture_astc"),e.bptcSupported=t.extensions.has("EXT_texture_compression_bptc"),e.etcSupported=t.extensions.has("WEBGL_compressed_texture_etc1"),e.dxtSupported=t.extensions.has("WEBGL_compressed_texture_s3tc"),e.pvrtcSupported=t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc"),e.astcSupported)e.format=r.BASIS_FORMAT.cTFASTC_4x4;else if(e.bptcSupported)e.format=r.BASIS_FORMAT.cTFBC7_M5;else if(e.dxtSupported)e.format=r.BASIS_FORMAT.cTFBC3;else if(e.pvrtcSupported)e.format=r.BASIS_FORMAT.cTFPVRTC1_4_RGBA;else{if(!e.etcSupported)throw new Error("THREE.BasisTextureLoader: No suitable compressed texture format found.");e.format=r.BASIS_FORMAT.cTFETC1}return this},load:function(t,e,n,o){var a=new i.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(t,n=>{if(r.taskCache.has(n))return r.taskCache.get(n).promise.then(e).catch(o);this._createTexture(n,t).then(e).catch(o)},n,o)},_createTexture:function(t,e){var n,o,a=t.byteLength,s=this._allocateWorker(a).then(e=>(n=e,o=this.workerNextTaskID++,new Promise((e,i)=>{n._callbacks[o]={resolve:e,reject:i},n.postMessage({type:"transcode",id:o,buffer:t},[t])}))).then(t=>{var e,n=this.workerConfig,{width:o,height:a,mipmaps:s,format:l}=t;switch(l){case r.BASIS_FORMAT.cTFASTC_4x4:e=new i.CompressedTexture(s,o,a,i.RGBA_ASTC_4x4_Format);break;case r.BASIS_FORMAT.cTFBC7_M5:e=new i.CompressedTexture(s,o,a,i.RGBA_BPTC_Format);break;case r.BASIS_FORMAT.cTFBC1:case r.BASIS_FORMAT.cTFBC3:e=new i.CompressedTexture(s,o,a,r.DXT_FORMAT_MAP[n.format],i.UnsignedByteType);break;case r.BASIS_FORMAT.cTFETC1:e=new i.CompressedTexture(s,o,a,i.RGB_ETC1_Format);break;case r.BASIS_FORMAT.cTFPVRTC1_4_RGB:e=new i.CompressedTexture(s,o,a,i.RGB_PVRTC_4BPPV1_Format);break;case r.BASIS_FORMAT.cTFPVRTC1_4_RGBA:e=new i.CompressedTexture(s,o,a,i.RGBA_PVRTC_4BPPV1_Format);break;default:throw new Error("THREE.BasisTextureLoader: No supported format available.")}return e.minFilter=1===s.length?i.LinearFilter:i.LinearMipmapLinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0,e});return s.catch(()=>!0).then(()=>{n&&o&&(n._taskLoad-=a,delete n._callbacks[o])}),r.taskCache.set(t,{url:e,promise:s}),s},_initTranscoder:function(){if(!this.transcoderPending){var t=new i.FileLoader(this.manager);t.setPath(this.transcoderPath);var e=new Promise((e,n)=>{t.load("basis_transcoder.js",e,void 0,n)}),n=new i.FileLoader(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer");var o=new Promise((t,e)=>{n.load("basis_transcoder.wasm",t,void 0,e)});this.transcoderPending=Promise.all([e,o]).then(([t,e])=>{var n=r.BasisWorker.toString(),i=["/* basis_transcoder.js */",t,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=e})}return this.transcoderPending},_allocateWorker:function(t){return this._initTranscoder().then(()=>{var e;this.workerPool.length<this.workerLimit?((e=new Worker(this.workerSourceURL))._callbacks={},e._taskLoad=0,e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),e.onmessage=function(t){var n=t.data;switch(n.type){case"transcode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)):this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));return(e=this.workerPool[this.workerPool.length-1])._taskLoad+=t,e})},dispose:function(){for(var t=0;t<this.workerPool.length;t++)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),r.BASIS_FORMAT={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC4:4,cTFBC5:5,cTFBC7_M6_OPAQUE_ONLY:6,cTFBC7_M5:7,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFATC_RGB:11,cTFATC_RGBA_INTERPOLATED_ALPHA:12,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16},r.DXT_FORMAT={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},r.DXT_FORMAT_MAP={},r.DXT_FORMAT_MAP[r.BASIS_FORMAT.cTFBC1]=r.DXT_FORMAT.COMPRESSED_RGB_S3TC_DXT1_EXT,r.DXT_FORMAT_MAP[r.BASIS_FORMAT.cTFBC3]=r.DXT_FORMAT.COMPRESSED_RGBA_S3TC_DXT5_EXT,r.BasisWorker=function(){var t,e,n;onmessage=function(i){var r,o,a=i.data;switch(a.type){case"init":t=a.config,r=a.transcoderBinary,e=new Promise(t=>{o={wasmBinary:r,onRuntimeInitialized:t},BASIS(o)}).then(()=>{var{BasisFile:t,initializeBasis:e}=o;n=t,e()});break;case"transcode":e.then(()=>{try{for(var{width:e,height:i,hasAlpha:r,mipmaps:o,format:s}=function(e){var i=new n(new Uint8Array(e)),r=i.getImageWidth(0,0),o=i.getImageHeight(0,0),a=i.getNumLevels(0),s=i.getHasAlpha();function l(){i.close(),i.delete()}if(!s)switch(t.format){case 9:t.format=8}if(!r||!o||!a)throw l(),new Error("THREE.BasisTextureLoader:\tInvalid .basis file");if(!i.startTranscoding())throw l(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");for(var c=[],u=0;u<a;u++){var h=i.getImageWidth(0,u),f=i.getImageHeight(0,u),d=new Uint8Array(i.getImageTranscodedSizeInBytes(0,u,t.format));if(!i.transcodeImage(d,0,u,t.format,0,s))throw l(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");c.push({data:d,width:h,height:f})}return l(),{width:r,height:o,hasAlpha:s,mipmaps:c,format:t.format}}(a.buffer),l=[],c=0;c<o.length;++c)l.push(o[c].data.buffer);self.postMessage({type:"transcode",id:a.id,width:e,height:i,hasAlpha:r,mipmaps:o,format:s},l)}catch(t){console.error(t),self.postMessage({type:"error",id:a.id,error:t.message})}})}}}},function(t,e,n){"use strict";function i(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent;function o(t,e,n,r,o,a){var s=i.call(this,t,e);return this.name="point-light",this.type="PointLight",e||this.createObject3D(n,r,o,a),s}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(e,n,i,r){this.object3D=new t.PointLight(e,n,i,r),this.object3D.castShadow=!0,this.object3D.shadow.camera.near=.1,this.object3D.shadow.camera.far=1e3,this.object3D.shadow.bias=0},o.prototype.updateShadowMap=function(){this.object3D.shadow.map.dispose(),this.object3D.shadow.map=null,this.object3D.shadow.camera.updateProjectionMatrix()},e.a=r("point-light",o)}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(48),r=n(117);function o(e){this.renderer=e.renderer;var n=e.w,o=e.h;this.debug=e.debug;var a={minFilter:t.LinearFilter,magFilter:t.LinearFilter,type:t.FloatType,stencilBuffer:!1,depthBuffer:!1};this.targetIn=new t.WebGLRenderTarget(n,o,a),this.targetOut=new t.WebGLRenderTarget(n,o,a),this.camera=new t.OrthographicCamera(n/-2,n/2,o/2,o/-2,0,1),this.delta=new t.Vector2(.1/n,.1/o);var s={uniforms:{u_Texture:{type:"t",value:null},u_Center:{type:"v2",value:new t.Vector2(0,0)},u_Radius:{type:"f",value:0},u_Strength:{type:"f",value:0}},vertexShader:i.c.vertexShader,fragmentShader:i.c.fragmengtShaders.dropShader},l={uniforms:{u_Texture:{type:"t",value:null},u_Delta:{type:"v2",value:this.delta}},vertexShader:i.c.vertexShader,fragmentShader:i.c.fragmengtShaders.stepShader},c={uniforms:{u_Texture:{type:"t",value:null},u_Delta:{type:"v2",value:this.delta}},vertexShader:i.c.vertexShader,fragmentShader:i.c.fragmengtShaders.normalShader};this.pDrop=new r.a(s,n,o),this.pStep=new r.a(l,n,o),this.pNormal=new r.a(c,n,o)}o.prototype.render1=function(){return this.swapTargets(),this.pStep.render(this.renderer,this.camera,this.targetIn,this.targetOut,"u_Texture"),this.swapTargets(),this.pNormal.render(this.renderer,this.camera,this.targetIn,this.targetOut,"u_Texture"),this.targetOut.texture},o.prototype.swapTargets=function(){var t=this.targetIn;this.targetIn=this.targetOut,this.targetOut=t},o.prototype.addDrop=function(t,e,n){this.pDrop.updateUniform("u_Center",t),this.pDrop.updateUniform("u_Radius",e),this.pDrop.updateUniform("u_Strength",n),this.pDrop.render(this.renderer,this.camera,this.targetIn,this.targetOut,"u_Texture"),this.swapTargets()}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(48),r=n(117);function o(e){this.renderer=e.renderer;var n=e.w,o=e.h;this.debug=e.debug;var a={minFilter:t.LinearFilter,magFilter:t.LinearFilter,type:t.FloatType,stencilBuffer:!1,depthBuffer:!1};this.targetOut=new t.WebGLRenderTarget(n,o,a),this.camera=new t.OrthographicCamera(n/-2,n/2,o/2,o/-2,0,1),i.a.uniforms={u_LightDir:{type:"v3",value:null},u_CausticTex:{type:"t",value:null},rippleShader:{type:"t",value:null},u_PoolHeight:{type:"f",value:0}},this.pCaustics=new r.a(i.a,n,o),this.pCaustics.bufferMaterial.extensions.derivatives=!0}o.prototype.render1=function(t){return this.pCaustics.updateUniform("rippleShader",t),this.pCaustics.regularRender(this.renderer,this.camera,this.targetOut),this.targetOut.texture}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(67),r=n(5).Component,o=n(5).registerComponent;function a(e,n,i,o,a,s){var l=r.call(this,e,n);return this.name="sky2",this.type="Sky2",this.colorTop=[new t.Color(11393254),new t.Color(6202334),new t.Color(15420194),new t.Color(16777215)],this.colorBottom=[new t.Color(10066329),new t.Color(11184810),new t.Color(10066329),new t.Color(5592405)],this.sunColor=16768426,this.intensity=.3,this.moonColor=5592507,n||this.createObject3D(i,o,a,s),l}a.IS_EXPOSED=!1,a.prototype=Object.create(r.prototype),a.prototype.createObject3D=function(e,n,i,r){this.hemisphere=new t.HemisphereLight(10664410,16764031,.5),this.hemisphere.locked=!0,this.hemisphere.matrixAutoUpdate=!1,this.object3D.add(this.hemisphere),this.sun=new t.DirectionalLight(this.sunColor,this.intensity),this.sun.castShadow=!0,this.sun.locked=!0,this.object3D.add(this.sun);var o={topColor:{type:"c",value:new t.Color(0,.46,1)},bottomColor:{type:"c",value:new t.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.2}};o.topColor.value.copy(this.hemisphere.color);var s=new t.SphereBufferGeometry(1500,16,16),l=new t.ShaderMaterial({vertexShader:a.VERTEX,fragmentShader:a.FRAGMENT,uniforms:o,side:t.BackSide});this.sky=new t.Mesh(s,l),this.sky.locked=!0,this.sky.matrixAutoUpdate=!1,this.object3D.add(this.sky),this.sky.raycast=function(){return null},this.autoUpdate=void 0===r||r,this.sunDistance=void 0!==i?i:100,this.dayTime=void 0!==n?n:24,this.time=void 0!==e?e:10},a.VERTEX="varying vec3 vWorldPosition;\nvoid main()\n{\n\tvec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",a.FRAGMENT="uniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float offset;\nuniform float exponent;\nvarying vec3 vWorldPosition;\nvoid main()\n{\n\tfloat h = normalize(vWorldPosition + offset).y;\n\tgl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h , 0.0), exponent), 0.0)), 1.0);\n}",a.prototype.init=function(){return r.prototype.init.call(this),this.updateSky(),this},a.prototype.update=function(t){this.autoUpdate&&(this.time+=t,this.time>this.dayTime&&(this.time-=this.dayTime),this.updateSky()),this.object3D.update.call(this,t)},a.prototype.updateSky=function(){var t=this.time/this.dayTime;if(t<.25)this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,this.colorBottom[3].g,this.colorBottom[3].b);else if(t<.292){var e=1-(n=23.81*(t-.25));this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[3].r+n*this.colorTop[0].r,e*this.colorTop[3].g+n*this.colorTop[0].g,e*this.colorTop[3].b+n*this.colorTop[0].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[3].r+n*this.colorBottom[0].r,e*this.colorBottom[3].g+n*this.colorBottom[0].g,e*this.colorBottom[3].b+n*this.colorBottom[0].b)}else if(t<.4167)this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[0].r,this.colorTop[0].g,this.colorTop[0].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[0].r,this.colorBottom[0].g,this.colorBottom[0].b);else if(t<.5){e=1-(n=12*(t-.4167));this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[0].r+n*this.colorTop[1].r,e*this.colorTop[0].g+n*this.colorTop[1].g,e*this.colorTop[0].b+n*this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[0].r+n*this.colorBottom[1].r,e*this.colorBottom[0].g+n*this.colorBottom[1].g,e*this.colorBottom[0].b+n*this.colorBottom[1].b)}else if(t<.708)this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[1].r,this.colorTop[1].g,this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[1].r,this.colorBottom[1].g,this.colorBottom[1].b);else if(t<.75){e=1-(n=23.81*(t-.708));this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[1].r+n*this.colorTop[2].r,e*this.colorTop[1].g+n*this.colorTop[2].g,e*this.colorTop[1].b+n*this.colorTop[2].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[1].r+n*this.colorBottom[2].r,e*this.colorBottom[1].g+n*this.colorBottom[2].g,e*this.colorBottom[1].b+n*this.colorBottom[2].b)}else if(t<.8333){e=1-(n=12.048*(t-.75));this.sky.material.uniforms.topColor.value.setRGB(e*this.colorTop[2].r+n*this.colorTop[3].r,e*this.colorTop[2].g+n*this.colorTop[3].g,e*this.colorTop[2].b+n*this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(e*this.colorBottom[2].r+n*this.colorBottom[3].r,e*this.colorBottom[2].g+n*this.colorBottom[3].g,e*this.colorBottom[2].b+n*this.colorBottom[3].b)}else this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,this.colorBottom[3].g,this.colorBottom[3].b);if(t<.2)this.sun.intensity=this.intensity,this.sun.color.setHex(this.moonColor);else if(t<.3){e=1-(n=10*(t-.2));if(n<.5){e=2-2*n;this.sun.intensity=e*this.intensity,this.sun.color.setHex(this.moonColor)}else n*=2,this.sun.intensity=n*this.intensity,this.sun.color.setHex(this.sunColor)}else if(t<.7)this.sun.intensity=this.intensity,this.sun.color.setHex(this.sunColor);else if(t<.8){var n;if((n=10*(t-.7))<.5){e=2-2*n;this.sun.intensity=e*this.intensity,this.sun.color.setHex(this.sunColor)}else n*=2,this.sun.intensity=n*this.intensity,this.sun.color.setHex(this.moonColor)}else this.sun.intensity=this.intensity,this.sun.color.setHex(this.moonColor);var r=i.a.PI2*t-i.a.PID2;t>.25&&t<.75?(this.sun.position.x=this.sunDistance*Math.cos(r),this.sun.position.y=this.sunDistance*Math.sin(r)):(this.sun.position.x=this.sunDistance*Math.cos(r+Math.PI),this.sun.position.y=this.sunDistance*Math.sin(r+Math.PI))},a.prototype.toJSON=function(e){var n=t.Object3D.prototype.toJSON.call(this,e);n.object.colorTop=[];for(var i=0;i<this.colorTop.length;i++)n.object.colorTop.push(this.colorTop[i].toJSON());n.object.colorBottom=[];for(i=0;i<this.colorBottom.length;i++)n.object.colorBottom.push(this.colorBottom[i].toJSON());return n.object.sunColor=this.sunColor,n.object.moonColor=this.moonColor,n.object.intensity=this.intensity,n.object.autoUpdate=this.autoUpdate,n.object.sunDistance=this.sunDistance,n.object.dayTime=this.dayTime,n.object.time=this.time,n.object.sun={},n.object.sun.castShadow=this.sun.castShadow,n.object.sun.shadow=this.sun.shadow.toJSON(),n},e.a=o("sky2",a)}).call(this,n(0))},function(t,e,n){"use strict";(function(t){var i=n(5).Component,r=n(5).registerComponent;function o(t,e,n,r,o,a,s,l){var c=i.call(this,t,e);return this.name="spot-light",this.type="SpotLight",e||this.createObject3D(n,r,o,a,s,l),c}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(e,n,i,r,o,a){this.object3D=new t.SpotLight(e,n,i,r,o,a),this.object3D.castShadow=!0,this.object3D.shadow.camera.near=.05,this.object3D.shadow.camera.far=5e3,this.object3D.shadow.mapSize.width=512,this.object3D.shadow.mapSize.height=512},o.prototype.setTarget=function(t){this.object3D.target=t},o.prototype.updateShadowMap=function(){this.object3D.shadow.map.dispose(),this.object3D.shadow.map=null,this.object3D.shadow.camera.updateProjectionMatrix()},e.a=r("spot-light",o)}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));var i={uniforms:{heightMap:{value:null},resolution:{value:new t.Vector2(512,512)},scale:{value:new t.Vector2(1,1)},height:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","\tfloat val = texture2D( heightMap, vUv ).x;","\tfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","\tfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","\tgl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));var i={uniforms:t.UniformsUtils.merge([t.UniformsLib.fog,t.UniformsLib.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new t.Color(15658734)},specular:{value:new t.Color(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new t.Vector2(1,1)},uRepeatOverlay:{value:new t.Vector2(1,1)},uOffset:{value:new t.Vector2(0,0)}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",t.ShaderChunk.common,t.ShaderChunk.packing,t.ShaderChunk.bsdfs,t.ShaderChunk.lights_pars_begin,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","\t\tif ( decayExponent > 0.0 ) {","\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","\t\t}","\t\treturn 1.0;","\t}","void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 specularTex = vec3( 1.0 );","\tvec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","\tvec2 uvBase = uRepeatBase * vUv;","\tvec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","\tnormalTex.xy *= uNormalScale;","\tnormalTex = normalize( normalTex );","\tif( enableDiffuse1 && enableDiffuse2 ) {","\t\tvec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","\t\tvec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","\t\tcolDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","\t\tcolDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","\t\tdiffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );","\t } else if( enableDiffuse1 ) {","\t\tdiffuseColor *= texture2D( tDiffuse1, uvOverlay );","\t} else if( enableDiffuse2 ) {","\t\tdiffuseColor *= texture2D( tDiffuse2, uvOverlay );","\t}","\tif( enableSpecular )","\t\tspecularTex = texture2D( tSpecular, uvOverlay ).xyz;","\tmat3 tsb = mat3( vTangent, vBinormal, vNormal );","\tvec3 finalNormal = tsb * normalTex;","\tvec3 normal = normalize( finalNormal );","\tvec3 viewPosition = normalize( vViewPosition );","\tvec3 totalDiffuseLight = vec3( 0.0 );","\tvec3 totalSpecularLight = vec3( 0.0 );","\t#if NUM_POINT_LIGHTS > 0","\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","\t\t\tvec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","\t\t\tlVector = normalize( lVector );","\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );","\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","\t\t\tfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","\t\t\tfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","\t\t\ttotalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","\t\t\ttotalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","\t\t}","\t#endif","\t#if NUM_DIR_LIGHTS > 0","\t\tvec3 dirDiffuse = vec3( 0.0 );","\t\tvec3 dirSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","\t\t\tvec3 dirVector = directionalLights[ i ].direction;","\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );","\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","\t\t\tfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","\t\t\tfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","\t\t\ttotalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","\t\t\ttotalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","\t\t}","\t#endif","\t#if NUM_HEMI_LIGHTS > 0","\t\tvec3 hemiDiffuse  = vec3( 0.0 );","\t\tvec3 hemiSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","\t\t\tvec3 lVector = hemisphereLightDirection[ i ];","\t\t\tfloat dotProduct = dot( normal, lVector );","\t\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","\t\t\ttotalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","\t\t\tfloat hemiSpecularWeight = 0.0;","\t\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","\t\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","\t\t\themiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","\t\t\tvec3 lVectorGround = -lVector;","\t\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","\t\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","\t\t\themiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","\t\t\ttotalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","\t\t}","\t#endif","\toutgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );",t.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","\tuniform sampler2D tDisplacement;","\tuniform float uDisplacementScale;","\tuniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.fog_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );","\tvTangent = normalize( normalMatrix * tangent.xyz );","\tvBinormal = cross( vNormal, vTangent ) * tangent.w;","\tvBinormal = normalize( vBinormal );","\tvUv = uv;","\tvec2 uvBase = uv * uRepeatBase;","\t#ifdef VERTEX_TEXTURES","\t\tvec3 dv = texture2D( tDisplacement, uvBase ).xyz;","\t\tfloat df = uDisplacementScale * dv.x + uDisplacementBias;","\t\tvec3 displacedPosition = normal * df + position;","\t\tvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","\t\tvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","\t#else","\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#endif","\tgl_Position = projectionMatrix * mvPosition;","\tvViewPosition = -mvPosition.xyz;","\tvec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","\tvNormal = normalMatrix * normalTex;",t.ShaderChunk.shadowmap_vertex,t.ShaderChunk.fog_vertex,"}"].join("\n")}}).call(this,n(0))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0),r={computeTangents:function(t){var e=t.index,n=t.attributes;if(null!==e&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var r=e.array,o=n.position.array,a=n.normal.array,s=n.uv.array,l=o.length/3;void 0===n.tangent&&t.setAttribute("tangent",new i.BufferAttribute(new Float32Array(4*l),4));for(var c=n.tangent.array,u=[],h=[],f=0;f<l;f++)u[f]=new i.Vector3,h[f]=new i.Vector3;var d=new i.Vector3,p=new i.Vector3,m=new i.Vector3,g=new i.Vector2,v=new i.Vector2,y=new i.Vector2,x=new i.Vector3,b=new i.Vector3,w=t.groups;0===w.length&&(w=[{start:0,count:r.length}]);f=0;for(var _=w.length;f<_;++f)for(var M=I=(L=w[f]).start,S=I+L.count;M<S;M+=3)D(r[M+0],r[M+1],r[M+2]);var T,A,E,q=new i.Vector3,C=new i.Vector3,P=new i.Vector3,R=new i.Vector3;for(f=0,_=w.length;f<_;++f){var L,I;for(M=I=(L=w[f]).start,S=I+L.count;M<S;M+=3)O(r[M+0]),O(r[M+1]),O(r[M+2])}}else console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function D(t,e,n){d.fromArray(o,3*t),p.fromArray(o,3*e),m.fromArray(o,3*n),g.fromArray(s,2*t),v.fromArray(s,2*e),y.fromArray(s,2*n),p.sub(d),m.sub(d),v.sub(g),y.sub(g);var i=1/(v.x*y.y-y.x*v.y);isFinite(i)&&(x.copy(p).multiplyScalar(y.y).addScaledVector(m,-v.y).multiplyScalar(i),b.copy(m).multiplyScalar(v.x).addScaledVector(p,-y.x).multiplyScalar(i),u[t].add(x),u[e].add(x),u[n].add(x),h[t].add(b),h[e].add(b),h[n].add(b))}function O(t){P.fromArray(a,3*t),R.copy(P),A=u[t],q.copy(A),q.sub(P.multiplyScalar(P.dot(A))).normalize(),C.crossVectors(R,A),E=C.dot(h[t]),T=E<0?-1:1,c[4*t]=q.x,c[4*t+1]=q.y,c[4*t+2]=q.z,c[4*t+3]=T}},mergeBufferGeometries:function(t,e){for(var n=null!==t[0].index,r=new Set(Object.keys(t[0].attributes)),o=new Set(Object.keys(t[0].morphAttributes)),a={},s={},l=t[0].morphTargetsRelative,c=new i.BufferGeometry,u=0,h=0;h<t.length;++h){var f=t[h],d=0;if(n!==(null!==f.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var p in f.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[p]&&(a[p]=[]),a[p].push(f.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(l!==f.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var p in f.morphAttributes){if(!o.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[p]&&(s[p]=[]),s[p].push(f.morphAttributes[p])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(f.userData),e){var m;if(n)m=f.index.count;else{if(void 0===f.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;m=f.attributes.position.count}c.addGroup(u,m,h),u+=m}}if(n){var g=0,v=[];for(h=0;h<t.length;++h){for(var y=t[h].index,x=0;x<y.count;++x)v.push(y.getX(x)+g);g+=t[h].attributes.position.count}c.setIndex(v)}for(var p in a){var b=this.mergeBufferAttributes(a[p]);if(!b)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+p+" attribute."),null;c.setAttribute(p,b)}for(var p in s){var w=s[p][0].length;if(0===w)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[p]=[];for(h=0;h<w;++h){var _=[];for(x=0;x<s[p].length;++x)_.push(s[p][x][h]);var M=this.mergeBufferAttributes(_);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+p+" morphAttribute."),null;c.morphAttributes[p].push(M)}}return c},mergeBufferAttributes:function(t){for(var e,n,r,o=0,a=0;a<t.length;++a){var s=t[a];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=s.normalized),r!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=s.array.length}var l=new e(o),c=0;for(a=0;a<t.length;++a)l.set(t[a].array,c),c+=t[a].array.length;return new i.BufferAttribute(l,n,r)},interleaveAttributes:function(t){for(var e,n=0,r=0,o=0,a=t.length;o<a;++o){var s=t[o];if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=s.array.length,r+=s.itemSize}var l=new i.InterleavedBuffer(new e(n),r),c=0,u=[],h=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"],d=0;for(a=t.length;d<a;d++){var p=(s=t[d]).itemSize,m=s.count,g=new i.InterleavedBufferAttribute(l,p,c,s.normalized);u.push(g),c+=p;for(var v=0;v<m;v++)for(var y=0;y<p;y++)g[f[y]](v,s[h[y]](v))}return u},estimateBytesUsed:function(t){var e=0;for(var n in t.attributes){var i=t.getAttribute(n);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}var r=t.getIndex();return e+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0},mergeVertices:function(t,e=1e-4){e=Math.max(e,Number.EPSILON);for(var n={},r=t.getIndex(),o=t.getAttribute("position"),a=r?r.count:o.count,s=0,l=Object.keys(t.attributes),c={},u={},h=[],f=["getX","getY","getZ","getW"],d=0,p=l.length;d<p;d++){c[b=l[d]]=[],(S=t.morphAttributes[b])&&(u[b]=new Array(S.length).fill().map(()=>[]))}var m=Math.log10(1/e),g=Math.pow(10,m);for(d=0;d<a;d++){var v=r?r.getX(d):d,y="",x=0;for(p=l.length;x<p;x++)for(var b=l[x],w=(M=t.getAttribute(b)).itemSize,_=0;_<w;_++)y+=`${~~(M[f[_]](v)*g)},`;if(y in n)h.push(n[y]);else{for(x=0,p=l.length;x<p;x++){b=l[x];var M=t.getAttribute(b),S=t.morphAttributes[b],T=(w=M.itemSize,c[b]),A=u[b];for(_=0;_<w;_++){var E=f[_];if(T.push(M[E](v)),S)for(var q=0,C=S.length;q<C;q++)A[q].push(S[q][E](v))}}n[y]=s,h.push(s),s++}}const P=t.clone();for(d=0,p=l.length;d<p;d++){b=l[d];var R=t.getAttribute(b),L=new R.array.constructor(c[b]);M=new i.BufferAttribute(L,R.itemSize,R.normalized);if(P.setAttribute(b,M),b in u)for(x=0;x<u[b].length;x++){var I=t.morphAttributes[b][x],D=(L=new I.array.constructor(u[b][x]),new i.BufferAttribute(L,I.itemSize,I.normalized));P.morphAttributes[b][x]=D}}return P.setIndex(h),P},toTrianglesDrawMode:function(t,e){if(e===i.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===i.TriangleFanDrawMode||e===i.TriangleStripDrawMode){var n=t.getIndex();if(null===n){var r=[],o=t.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<o.count;a++)r.push(a);t.setIndex(r),n=t.getIndex()}var s=n.count-2,l=[];if(e===i.TriangleFanDrawMode)for(a=1;a<=s;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<s;a++)a%2==0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=t.clone();return c.setIndex(l),c.clearGroups(),c}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(91);function r(t){this.particles,this.respondingToMouse=!1,this.morphing=!1,this.morphStartTime,this.currentTargetIndex,this.targets=[],this.halfW=0,this.halfH=0,this.halfZ=0,this.opts={numFloatingParticles:40,numParticles:1e4,particleRevertDelay:.008,revertDuration:1e3,sizeAttenuation:!0},i.a.extend(this.opts,t)}r.prototype.init=function(){return this.createParticles()},r.prototype.destroy=function(){return this.particles.geometry.dispose(),this.particles.material.dispose(),this.particles=null,this.opts=null},r.prototype.setTarget=function(t,e){var n,i,r,o,a,s,l,c,u,h;null==e&&(e=!0);t=t.clone();for(this.particles.material.size=t.material.size,r=c=0,u=(h=this.particles.geometry.vertices).length;c<u;r=++c)l=h[r],i=e?this.opts.revertDuration:0,l.userData.morph.duration=i,l.userData.morph.delay=r*this.opts.particleRevertDelay,l.userData.prevV=l.clone(),l.userData.prevC=this.particles.geometry.colors[r].clone(),a=this.nextIndexForPool(r,t),o=t.geometry.vertices[a],l.userData.nextV=o.clone(),l.userData.alwaysFloating&&(s=this.makeRandomVertex(),l.userData.nextV.set(s.x,s.y,s.z)),(n=o.userData.color)||(n.r=n.b=n.g=0),l.userData.nextC.setRGB(n.r,n.g,n.b);return this.morphStartTime=new Date,this.morphing=!0},r.prototype.resize=function(t,e,n){this.halfW=t,this.halfH=e,this.halfZ=n},r.prototype.createParticles=function(){var e,n,i,r,o,a,s;for(n=new t.Geometry,this.opts.numFloatingParticles>0&&(e=Math.floor(this.opts.numParticles/this.opts.numFloatingParticles)),i=a=0,s=this.opts.numParticles;a<s;i=a+=1)n.vertices.push(new t.Vector3(0,0,0)),null!=e&&(r=i%e==0),n.vertices[i].userData={alwaysFloating:r,prevV:n.vertices[i].clone(),nextV:n.vertices[i].clone(),prevC:new t.Color(1,1,1),nextC:new t.Color(1,1,1),morph:{delay:0,duration:0}},n.colors.push(new t.Color(1,1,1));return o=new t.PointsMaterial({vertexColors:!0,transparent:!0,depthTest:!1,sizeAttenuation:this.opts.sizeAttenuation}),this.particles=new t.Points(n,o),this.particles.sortParticles=!1},r.prototype.getParticles=function(){return this.particles},r.prototype.makeRandomVertex=function(){var e;return(e=new t.Vector3(0,0,0)).x=2*Math.random()*this.halfW-this.halfW,e.y=2*Math.random()*this.halfH-this.halfH,e.z=2*Math.random()*this.halfZ/3-this.halfZ/3,e},r.prototype.nextIndexForPool=function(t,e){var n;return n=e.geometry.vertices.length/this.opts.numParticles,Math.floor(t*n)},r.prototype.morph=function(){var t,e,n,i,r,o,a,s,l,c,u,h,f,d;for(n=new Date-this.morphStartTime,e=!0,r=h=0,f=(d=this.particles.geometry.vertices).length;h<f;r=++h)o=1,(s=d[r]).userData.morph.duration>0&&(o=Math.max(0,n-s.userData.morph.delay),o=Math.min(1,o/s.userData.morph.duration),o=1- --o*o*o*o),a=s.userData.prevC.r+o*(s.userData.nextC.r-s.userData.prevC.r),i=s.userData.prevC.g+o*(s.userData.nextC.g-s.userData.prevC.g),t=s.userData.prevC.b+o*(s.userData.nextC.b-s.userData.prevC.b),this.particles.geometry.colors[r].setRGB(a,i,t),l=s.userData.prevV.x+o*(s.userData.nextV.x-s.userData.prevV.x),c=s.userData.prevV.y+o*(s.userData.nextV.y-s.userData.prevV.y),u=s.userData.prevV.z+o*(s.userData.nextV.z-s.userData.prevV.z),s.set(l,c,u),o<1&&(e=!1);return e&&(this.morphing=!1),this.particles.geometry.verticesNeedUpdate=!0,this.particles.geometry.colorsNeedUpdate=!0},r.prototype.getRotationY=function(){return this.particles.rotation.y},r.prototype.setRotationY=function(t){return this.particles.rotation.y=t}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(83),r=n(91);function o(t,e){i.a.call(this,t,e),this.targetData=t,this.particles,this.container=this.targetData.container,this.opts={color:{r:1,g:1,b:1},initialMatrices:[],respondsToMouse:!1,scale:1,size:1,sort:null},r.a.extend(this.opts,e)}o.prototype=Object.create(i.a.prototype),o.prototype.load=function(e){var n,r,o,a,s;if(i.a.prototype.load.call(this,e),this.onLoad=t=>{this.processGeometry(t)},this.processGeometry(n),null!=this.targetData.preloadedVertices){for(n=new t.Geometry,r=a=0,s=(o=this.targetData.preloadedVertices).length;a<s;r=a+=3)n.vertices.push(new t.Vector3(o[r],o[r+1],o[r+2]));return this.onLoad(n)}return(new t.JSONLoader).load(this.targetData.url,this.onLoad)},o.prototype.processGeometry=function(e){var n,i,r,o,a,s,l,c;for(e.mergeVertices(),r=0,a=(l=e.vertices).length;r<a;r++)l[r].userData={color:this.opts.color};for(o=0,s=(c=this.opts.initialMatrices).length;o<s;o++)i=c[o],e.applyMatrix(i);return e.applyMatrix((new t.Matrix4).makeScale(this.opts.scale,this.opts.scale,this.opts.scale)),null!=this.opts.sort&&e.vertices.sort(this.opts.sort),n=new t.PointsMaterial({size:this.opts.size}),this.particles=new t.Points(e,n)},o.prototype.getParticles=function(){return this.particles}}).call(this,n(0))},,,function(t,e,n){"use strict";var i=n(0);
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function r(t){throw t}var o=void 0,a={};function s(t,e){var n,i=t.split("."),r=a;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||e===o?r=r[n]?r[n]:r[n]={}:r[n]=e}var l,c="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(c?Uint8Array:Array)(256),l=0;256>l;++l)for(var u=(u=l)>>>1;u;u>>>=1)0;function h(t,e,n){var i,r="number"==typeof e?e:e=0,o="number"==typeof n?n:t.length;for(i=-1,r=7&o;r--;++e)i=i>>>8^d[255&(i^t[e])];for(r=o>>3;r--;e+=8)i=(i=(i=(i=(i=(i=(i=(i=i>>>8^d[255&(i^t[e])])>>>8^d[255&(i^t[e+1])])>>>8^d[255&(i^t[e+2])])>>>8^d[255&(i^t[e+3])])>>>8^d[255&(i^t[e+4])])>>>8^d[255&(i^t[e+5])])>>>8^d[255&(i^t[e+6])])>>>8^d[255&(i^t[e+7])];return(4294967295^i)>>>0}var f=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],d=c?new Uint32Array(f):f;function p(){}function m(t){var e,n,i,r,o,a,s,l,u,h,f=t.length,d=0,p=Number.POSITIVE_INFINITY;for(l=0;l<f;++l)t[l]>d&&(d=t[l]),t[l]<p&&(p=t[l]);for(e=1<<d,n=new(c?Uint32Array:Array)(e),i=1,r=0,o=2;i<=d;){for(l=0;l<f;++l)if(t[l]===i){for(a=0,s=r,u=0;u<i;++u)a=a<<1|1&s,s>>=1;for(h=i<<16|l,u=a;u<e;u+=o)n[u]=h;++r}++i,r<<=1,o<<=1}return[n,d,p]}p.prototype.getName=function(){return this.name},p.prototype.getData=function(){return this.data},p.prototype.H=function(){return this.I},s("Zlib.GunzipMember",p),s("Zlib.GunzipMember.prototype.getName",p.prototype.getName),s("Zlib.GunzipMember.prototype.getData",p.prototype.getData),s("Zlib.GunzipMember.prototype.getMtime",p.prototype.H);var g,v=[];for(g=0;288>g;g++)switch(!0){case 143>=g:v.push([g+48,8]);break;case 255>=g:v.push([g-144+400,9]);break;case 279>=g:v.push([g-256+0,7]);break;case 287>=g:v.push([g-280+192,8]);break;default:r("invalid literal: "+g)}var y=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:r("invalid length: "+t)}}var e,n,i=[];for(e=3;258>=e;e++)n=t(e),i[e]=n[2]<<24|n[1]<<16|n[0];return i}();function x(t,e){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=c?new Uint8Array(t):t,this.o=!1,this.k=w,this.z=!1,!e&&(e={})||(e.index&&(this.c=e.index),e.bufferSize&&(this.j=e.bufferSize),e.bufferType&&(this.k=e.bufferType),e.resize&&(this.z=e.resize)),this.k){case b:this.a=32768,this.b=new(c?Uint8Array:Array)(32768+this.j+258);break;case w:this.a=0,this.b=new(c?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:r(Error("invalid inflate mode"))}}c&&new Uint32Array(y);var b=0,w=1;x.prototype.g=function(){for(;!this.o;){var t=U(this,3);switch(1&t&&(this.o=!0),t>>>=1){case 0:var e=this.input,n=this.c,i=this.b,a=this.a,s=e.length,l=o,u=i.length,h=o;switch(this.d=this.f=0,n+1>=s&&r(Error("invalid uncompressed block header: LEN")),l=e[n++]|e[n++]<<8,n+1>=s&&r(Error("invalid uncompressed block header: NLEN")),l===~(e[n++]|e[n++]<<8)&&r(Error("invalid uncompressed block header: length verify")),n+l>e.length&&r(Error("input buffer is broken")),this.k){case b:for(;a+l>i.length;){if(l-=h=u-a,c)i.set(e.subarray(n,n+h),a),a+=h,n+=h;else for(;h--;)i[a++]=e[n++];this.a=a,i=this.e(),a=this.a}break;case w:for(;a+l>i.length;)i=this.e({t:2});break;default:r(Error("invalid inflate mode"))}if(c)i.set(e.subarray(n,n+l),a),a+=l,n+=l;else for(;l--;)i[a++]=e[n++];this.c=n,this.a=a,this.b=i;break;case 1:this.l(F,z);break;case 2:j(this);break;default:r(Error("unknown BTYPE: "+t))}}return this.q()};var _,M,S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=c?new Uint16Array(S):S,A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],E=c?new Uint16Array(A):A,q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],C=c?new Uint8Array(q):q,P=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],R=c?new Uint16Array(P):P,L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=c?new Uint8Array(L):L,D=new(c?Uint8Array:Array)(288);for(_=0,M=D.length;_<M;++_)D[_]=143>=_?8:255>=_?9:279>=_?7:8;var O,N,F=m(D),B=new(c?Uint8Array:Array)(30);for(O=0,N=B.length;O<N;++O)B[O]=5;var z=m(B);function U(t,e){for(var n,i=t.f,o=t.d,a=t.input,s=t.c,l=a.length;o<e;)s>=l&&r(Error("input buffer is broken")),i|=a[s++]<<o,o+=8;return n=i&(1<<e)-1,t.f=i>>>e,t.d=o-e,t.c=s,n}function k(t,e){for(var n,i,r=t.f,o=t.d,a=t.input,s=t.c,l=a.length,c=e[0],u=e[1];o<u&&!(s>=l);)r|=a[s++]<<o,o+=8;return i=(n=c[r&(1<<u)-1])>>>16,t.f=r>>i,t.d=o-i,t.c=s,65535&n}function j(t){function e(t,e,n){var i,r,o,a=this.w;for(o=0;o<t;)switch(i=k(this,e),i){case 16:for(r=3+U(this,2);r--;)n[o++]=a;break;case 17:for(r=3+U(this,3);r--;)n[o++]=0;a=0;break;case 18:for(r=11+U(this,7);r--;)n[o++]=0;a=0;break;default:a=n[o++]=i}return this.w=a,n}var n,i,r,o,a=U(t,5)+257,s=U(t,5)+1,l=U(t,4)+4,u=new(c?Uint8Array:Array)(T.length);for(o=0;o<l;++o)u[T[o]]=U(t,3);if(!c)for(o=l,l=u.length;o<l;++o)u[T[o]]=0;n=m(u),i=new(c?Uint8Array:Array)(a),r=new(c?Uint8Array:Array)(s),t.w=0,t.l(m(e.call(t,a,n,i)),m(e.call(t,s,n,r)))}function V(t){this.input=t,this.c=0,this.m=[],this.s=!1}x.prototype.l=function(t,e){var n=this.b,i=this.a;this.r=t;for(var r,o,a,s,l=n.length-258;256!==(r=k(this,t));)if(256>r)i>=l&&(this.a=i,n=this.e(),i=this.a),n[i++]=r;else for(s=E[o=r-257],0<C[o]&&(s+=U(this,C[o])),r=k(this,e),a=R[r],0<I[r]&&(a+=U(this,I[r])),i>=l&&(this.a=i,n=this.e(),i=this.a);s--;)n[i]=n[i++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=i},x.prototype.D=function(t,e){var n=this.b,i=this.a;this.r=t;for(var r,o,a,s,l=n.length;256!==(r=k(this,t));)if(256>r)i>=l&&(l=(n=this.e()).length),n[i++]=r;else for(s=E[o=r-257],0<C[o]&&(s+=U(this,C[o])),r=k(this,e),a=R[r],0<I[r]&&(a+=U(this,I[r])),i+s>l&&(l=(n=this.e()).length);s--;)n[i]=n[i++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=i},x.prototype.e=function(){var t,e,n=new(c?Uint8Array:Array)(this.a-32768),i=this.a-32768,r=this.b;if(c)n.set(r.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=r[t+32768];if(this.i.push(n),this.n+=n.length,c)r.set(r.subarray(i,i+32768));else for(t=0;32768>t;++t)r[t]=r[i+t];return this.a=32768,r},x.prototype.F=function(t){var e,n,i,r=this.input.length/this.c+1|0,o=this.input,a=this.b;return t&&("number"==typeof t.t&&(r=t.t),"number"==typeof t.A&&(r+=t.A)),2>r?n=(i=(o.length-this.c)/this.r[2]/2*258|0)<a.length?a.length+i:a.length<<1:n=a.length*r,c?(e=new Uint8Array(n)).set(a):e=a,this.b=e},x.prototype.q=function(){var t,e,n,i,r,o=0,a=this.b,s=this.i,l=new(c?Uint8Array:Array)(this.n+(this.a-32768));if(0===s.length)return c?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(e=0,n=s.length;e<n;++e)for(i=0,r=(t=s[e]).length;i<r;++i)l[o++]=t[i];for(e=32768,n=this.a;e<n;++e)l[o++]=a[e];return this.i=[],this.buffer=l},x.prototype.B=function(){var t,e=this.a;return c?this.z?(t=new Uint8Array(e)).set(this.b.subarray(0,e)):t=this.b.subarray(0,e):(this.b.length>e&&(this.b.length=e),t=this.b),this.buffer=t},V.prototype.G=function(){return this.s||this.g(),this.m.slice()},V.prototype.g=function(){for(var t=this.input.length;this.c<t;){var e,n,i=new p,a=o,s=o,l=o,u=o,f=o,d=o,m=o,g=this.input,v=this.c;switch(i.u=g[v++],i.v=g[v++],(31!==i.u||139!==i.v)&&r(Error("invalid file signature:"+i.u+","+i.v)),i.p=g[v++],i.p){case 8:break;default:r(Error("unknown compression method: "+i.p))}if(i.h=g[v++],n=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24,i.I=new Date(1e3*n),i.O=g[v++],i.N=g[v++],0<(4&i.h)&&(i.J=g[v++]|g[v++]<<8,v+=i.J),0<(8&i.h)){for(d=[],f=0;0<(u=g[v++]);)d[f++]=String.fromCharCode(u);i.name=d.join("")}if(0<(16&i.h)){for(d=[],f=0;0<(u=g[v++]);)d[f++]=String.fromCharCode(u);i.K=d.join("")}0<(2&i.h)&&(i.C=65535&h(g,0,v),i.C!==(g[v++]|g[v++]<<8)&&r(Error("invalid header crc16"))),a=g[g.length-4]|g[g.length-3]<<8|g[g.length-2]<<16|g[g.length-1]<<24,g.length-v-4-4<512*a&&(l=a),s=new x(g,{index:v,bufferSize:l}),i.data=e=s.g(),v=s.c,i.L=m=(g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24)>>>0,h(e,o,o)!==m&&r(Error("invalid CRC-32 checksum: 0x"+h(e,o,o).toString(16)+" / 0x"+m.toString(16))),i.M=a=(g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24)>>>0,(4294967295&e.length)!==a&&r(Error("invalid input size: "+(4294967295&e.length)+" / "+a)),this.m.push(i),this.c=v}this.s=!0;var y,b,w,_=this.m,M=0,S=0;for(y=0,b=_.length;y<b;++y)S+=_[y].data.length;if(c)for(w=new Uint8Array(S),y=0;y<b;++y)w.set(_[y].data,M),M+=_[y].data.length;else{for(w=[],y=0;y<b;++y)w[y]=_[y].data;w=Array.prototype.concat.apply([],w)}return w},s("Zlib.Gunzip",V),s("Zlib.Gunzip.prototype.decompress",V.prototype.g),s("Zlib.Gunzip.prototype.getMembers",V.prototype.G);var G=a.Zlib,H=n(115);n.d(e,"a",(function(){return W}));var W=function(t){i.Loader.call(this,t)};W.prototype=Object.assign(Object.create(i.Loader.prototype),{constructor:W,load:function(t,e,n,r){var o=this,a=new i.FileLoader(o.manager);a.setPath(o.path),a.setResponseType("arraybuffer"),a.setRequestHeader(o.requestHeader),a.load(t,(function(n){try{e(o.parse(n))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)},parse:function(t){var e=t,n=0,r=new Int8Array(new Int16Array([1]).buffer)[0]>0,o={};var a=function(t,i){null==i&&(i=1);var o=1,a=Uint8Array;switch(t){case"uchar":break;case"schar":a=Int8Array;break;case"ushort":a=Uint16Array,o=2;break;case"sshort":a=Int16Array,o=2;break;case"uint":a=Uint32Array,o=4;break;case"sint":a=Int32Array,o=4;break;case"float":a=Float32Array,o=4;break;case"complex":case"double":a=Float64Array,o=8}var s=new a(e.slice(n,n+=i*o));return 1!=r&&(s=function(t,e){for(var n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=e)for(var r=i+e-1,o=i;r>o;r--,o++){var a=n[o];n[o]=n[r],n[r]=a}return t}(s,o)),1==i?s[0]:s}("uchar",t.byteLength),s=a.length,l=null,c=0;for(f=1;f<s;f++)if(10==a[f-1]&&10==a[f]){l=this.parseChars(a,0,f-2),c=f+1;break}!function(t){var e,n,r,a,s,l,c,u,h;for(u=0,h=(l=t.split(/\r?\n/)).length;u<h;u++)(s=l[u]).match(/NRRD\d+/)?o.isNrrd=!0:s.match(/^#/)||(c=s.match(/(.*):(.*)/))&&(n=c[1].trim(),e=c[2].trim(),(r=W.prototype.fieldFunctions[n])?r.call(o,e):o[n]=e);if(!o.isNrrd)throw new Error("Not an NRRD file");if("bz2"===o.encoding||"bzip2"===o.encoding)throw new Error("Bzip is not supported");if(!o.vectors&&(o.vectors=[new i.Vector3(1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,0,1)],o.spacings))for(a=0;a<=2;a++)isNaN(o.spacings[a])||o.vectors[a].multiplyScalar(o.spacings[a])}(l);e=a.subarray(c);if("gzip"===o.encoding||"gz"===o.encoding){var u=new G.Gunzip(new Uint8Array(e));e=u.decompress()}else if("ascii"===o.encoding||"text"===o.encoding||"txt"===o.encoding||"hex"===o.encoding)e=function(t,e,n){var i,r="";e=e||0,n=n||t.length;var a=o.sizes.reduce((function(t,e){return t*e}),1),s=10;"hex"===o.encoding&&(s=16);var l=new o.__array(a),c=0,u=parseInt;o.__array!==Float32Array&&o.__array!==Float64Array||(u=parseFloat);for(var h=e;h<n;h++)((i=t[h])<9||i>13)&&32!==i?r+=String.fromCharCode(i):(""!==r&&(l[c]=u(r,s),c++),r="");return""!==r&&(l[c]=u(r,s),c++),l}(e);else if("raw"===o.encoding){for(var h=new Uint8Array(e.length),f=0;f<e.length;f++)h[f]=e[f];e=h}e=e.buffer;var d=new H.a;d.header=o,d.data=new o.__array(e);var p=d.computeMinMax(),m=p[0],g=p[1];d.windowLow=m,d.windowHigh=g,d.dimensions=[o.sizes[0],o.sizes[1],o.sizes[2]],d.xLength=d.dimensions[0],d.yLength=d.dimensions[1],d.zLength=d.dimensions[2];var v=new i.Vector3(o.vectors[0][0],o.vectors[0][1],o.vectors[0][2]).length(),y=new i.Vector3(o.vectors[1][0],o.vectors[1][1],o.vectors[1][2]).length(),x=new i.Vector3(o.vectors[2][0],o.vectors[2][1],o.vectors[2][2]).length();d.spacing=[v,y,x],d.matrix=new i.Matrix4;var b=1,w=1;if("left-posterior-superior"==o.space?(b=-1,w=-1):"left-anterior-superior"===o.space&&(b=-1),o.vectors){var _=o.vectors;d.matrix.set(b*_[0][0],b*_[1][0],b*_[2][0],0,w*_[0][1],w*_[1][1],w*_[2][1],0,1*_[0][2],1*_[1][2],1*_[2][2],0,0,0,0,1)}else d.matrix.set(b,0,0,0,0,w,0,0,0,0,1,0,0,0,0,1);return d.inverseMatrix=new i.Matrix4,d.inverseMatrix.getInverse(d.matrix),d.RASDimensions=new i.Vector3(d.xLength,d.yLength,d.zLength).applyMatrix4(d.matrix).round().toArray().map(Math.abs),d.lowerThreshold===-1/0&&(d.lowerThreshold=m),d.upperThreshold===1/0&&(d.upperThreshold=g),d},parseChars:function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.length);var i="",r=0;for(r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i},fieldFunctions:{type:function(t){switch(t){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+t)}return this.type=t},endian:function(t){return this.endian=t},encoding:function(t){return this.encoding=t},dimension:function(t){return this.dim=parseInt(t,10)},sizes:function(t){var e;return this.sizes=function(){var n,i,r,o;for(o=[],n=0,i=(r=t.split(/\s+/)).length;n<i;n++)e=r[n],o.push(parseInt(e,10));return o}()},space:function(t){return this.space=t},"space origin":function(t){return this.space_origin=t.split("(")[1].split(")")[0].split(",")},"space directions":function(t){var e,n,i;return n=t.match(/\(.*?\)/g),this.vectors=function(){var t,r,o;for(o=[],t=0,r=n.length;t<r;t++)i=n[t],o.push(function(){var t,n,r,o;for(o=[],t=0,n=(r=i.slice(1,-1).split(/,/)).length;t<n;t++)e=r[t],o.push(parseFloat(e));return o}());return o}()},spacings:function(t){var e,n;return n=t.split(/\s+/),this.spacings=function(){var t,i,r=[];for(t=0,i=n.length;t<i;t++)e=n[t],r.push(parseFloat(e));return r}()}}})},function(t,e,n){"use strict";var i=n(0),r={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new i.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-t*t/(2*e*e))}var n,i,r,o,a=2*Math.ceil(3*t)+1;for(a>25&&(a=25),o=.5*(a-1),i=new Array(a),r=0,n=0;n<a;++n)i[n]=e(n-o,t),r+=i[n];for(n=0;n<a;++n)i[n]/=r;return i}},o=n(47),a=n(30);function s(t,e,n,l){a.a.call(this),this.type="Bloom",this.copyToScreen=!0,this.fsQuad=new a.a.FullScreenQuad,t=void 0!==t?t:1,e=void 0!==e?e:25,n=void 0!==n?n:4,l=void 0!==l?l:256,this.renderTargetX=new i.WebGLRenderTarget(l,l,a.a.RGBALinear),this.renderTargetY=new i.WebGLRenderTarget(l,l,a.a.RGBALinear),this.copyUniforms=i.UniformsUtils.clone(o.a.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new i.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.a.vertexShader,fragmentShader:o.a.fragmentShader,blending:i.AdditiveBlending,transparent:!0}),this.convolutionUniforms=i.UniformsUtils.clone(r.uniforms),this.convolutionUniforms.uImageIncrement.value=s.blurX,this.convolutionUniforms.cKernel.value=r.buildKernel(n),this.materialConvolution=new i.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,defines:{KERNEL_SIZE_FLOAT:e.toFixed(1),KERNEL_SIZE_INT:e.toFixed(0)}})}n.d(e,"a",(function(){return s})),s.blurX=new i.Vector2(.001953125,0),s.blurY=new i.Vector2(0,.001953125),s.prototype=Object.create(a.a.prototype),s.prototype.render=function(t,e,n,i,r,o,a){r&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=n.texture,this.convolutionUniforms.uImageIncrement.value=s.blurX,t.setRenderTarget(this.renderTargetX),t.clear(!0,!0,!0),t.render(this.scene,this.camera),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=s.blurY,t.setRenderTarget(this.renderTargetY),t.clear(!0,!0,!0),t.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,r&&t.context.enable(t.context.STENCIL_TEST),t.setRenderTarget(e),t.render(this.scene,this.camera)},s.prototype.toJSON=function(t){var e=a.a.prototype.toJSON.call(this,t);return e.strength=this.strength,e.kernelSize=this.kernelSize,e.sigma=this.sigma,e.resolution=this.resolution,e}},,,,function(t,e,n){(function(e){var i=n(0);i.TextureLoader&&(i.TextureLoader.prototype.crossOrigin="anonymous"),i.ImageLoader&&(i.ImageLoader.prototype.crossOrigin="anonymous"),i.Cache&&(i.Cache.enabled=!0),t.exports=i}).call(this,n(0))},function(t,e,n){var i=window.CANNON=n(503);i.validateNormal=function(t,e){var n=new i.Vec3;!function(t,e,n){(function(t,e,n,r){var o=new i.Vec3,a=new i.Vec3;e.vsub(t,a),n.vsub(e,o),o.cross(a,r),r.isZero()||r.normalize()})(t[e[0]],t[e[1]],t[e[2]],n)}(t,e,n),n.negate(n);var r=t[e[0]];return!(n.dot(r)<0)};var r=i.ConvexPolyhedron,o=new i.Vec3,a=new i.Vec3,s=new i.Vec3,l=new i.Vec3,c=new i.Vec3,u=new i.Vec3,h=new i.Vec3,f=new i.Vec3;r.prototype.clipFaceAgainstHull=function(t,e,n,i,r,d,p){for(var m=o,g=a,v=s,y=l,x=c,b=u,w=h,_=f,M=i,S=[],T=-1,A=Number.MAX_VALUE,E=0;E<this.faces.length;E++){m.copy(this.faceNormals[E]),n.vmult(m,m);var q=m.dot(t);q<A&&(A=q,T=E)}if(!(T<0)){var C=this.faces[T];C.connectedFaces=[];for(var P=0;P<this.faces.length;P++)for(var R=0;R<this.faces[P].length;R++)-1!==C.indexOf(this.faces[P][R])&&P!==T&&-1===C.connectedFaces.indexOf(P)&&C.connectedFaces.push(P);M.length;for(var L=C.length,I=0;I<L;I++){var D=this.vertices[C[I]],O=this.vertices[C[(I+1)%L]];D.vsub(O,g),v.copy(g),n.vmult(v,v),e.vadd(v,v),y.copy(this.faceNormals[T]),n.vmult(y,y),e.vadd(y,y),v.cross(y,x),x.negate(x),b.copy(D),n.vmult(b,b),e.vadd(b,b);b.dot(x);var N=C.connectedFaces[I];if(void 0!==N){w.copy(this.faceNormals[N]);var F=this.getPlaneConstantOfFace(N);_.copy(w),n.vmult(_,_);var B=F-_.dot(e)}for(this.clipFaceAgainstPlane(M,S,_,B);M.length;)M.shift();for(;S.length;)M.push(S.shift())}w.copy(this.faceNormals[T]);F=this.getPlaneConstantOfFace(T);_.copy(w),n.vmult(_,_);for(B=F-_.dot(e),P=0;P<M.length;P++){var z=_.dot(M[P])+B;if(z<=r&&(console.log("clamped: depth="+z+" to minDist="+r),z=r),z<=d){var U=M[P];if(z<=0){var k={point:U,normal:_,depth:z};p.push(k)}}}}},t.exports=i},function(t,e,n){n(504);var i=n(505);t.exports=i},function(t,e,n){n(508),n(520),n(521),n(570),n(523),n(524),n(94),n(193),n(529),n(530),n(531),n(194),n(532),n(195),n(534),n(535),n(187),n(243),n(20),n(537),n(538),n(539),n(240),n(540),n(541),n(542),n(545),n(546),n(547),n(548),n(549),n(550),n(551),n(552),n(146),n(182),n(553),n(554),n(219),n(555),n(99),n(556)},function(t,e,n){n(131),n(166),n(220),n(244),n(81),n(130),n(221),n(222),n(223),n(224),n(225),n(238),n(95),n(147),n(112),n(50),n(188),n(157),n(100),n(245),n(197),n(484),n(118),n(217),n(217),n(158),n(559),n(199),n(200),n(198),n(485),n(201),n(180),n(246),n(204),n(202),n(203)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(48),r=n(463),o=n(464),a=n(3),s=(n(558),n(137)),l=n(138),c=n(12).Entity,u=n(12).registerEntity;function h(e,n,r,o){this.waterWidth=r|i.e,this.waterHeight=o|i.e;var a=c.call(this,e);return this.className="PondEntity",this.name=n||"Pond",this.type="Pond",this.defaultParams={},this.waterMaterials=[],this.waterShaders=i.d,this.waterMeshes=[],this.cubeShader=i.b,this.cubeMaterial=null,this.waterInfo=null,this.causticsInfo=null,this.scene=null,this.renderer=null,this.lightDirection=new t.Vector3(.15,-.75,.65),this.poolHeight=2,this.rippleRadius=.1,this.raycaster=new t.Raycaster,this.mouse=new t.Vector2,this.debug=!1,a}h.prototype=Object.create(c.prototype),h.prototype.init=function(){var e=this;if(c.prototype.init.call(this),this.scene=TDS_RT.program.getActiveScene(),this.renderer=TDS_RT.program.getActiveRenderer(this.scene),this.camera=TDS_RT.program.getActiveCamera(this.scene),!this.renderer)return this;var n=10*this.waterWidth,i=10*this.waterHeight,u=4*n,h=4*i;this.waterInfo=new r.a({renderer:this.renderer,w:n,h:i,debug:!1}),this.causticsInfo=new o.a({renderer:this.renderer,w:u,h:h,debug:!1});var f=(new t.TextureLoader).load(a.a.getImg("Tile0"));f.format=t.RGBFormat,this.addRandomDrops(),this.rippleTexture=this.waterInfo.render1(),this.causticsInfo.pCaustics.updateUniform("u_LightDir",this.lightDirection),this.causticsInfo.pCaustics.updateUniform("u_PoolHeight",this.poolHeight),this.causticTex=this.causticsInfo.render1(this.rippleTexture);var d=new t.PlaneGeometry(this.waterWidth,this.waterHeight,10,10);if(this.reflector=new s.a(d,{textureWidth:this.renderer.width,textureHeight:this.renderer.height,clipBias:0,encoding:t.LinearEncoding}),this.refractor=new l.a(d,{textureWidth:this.renderer.width,textureHeight:this.renderer.height,clipBias:0,encoding:t.LinearEncoding}),this.debug){this.scene.getImageData=!0;let e=this.reflector.getRenderTarget();e.format=t.RGBAFormat,Editor._setupBufferDebug(this.renderer,e)}this.reflector.matrixAutoUpdate=!1,this.refractor.matrixAutoUpdate=!1;for(var p=0;p<2;p++)this.waterShaders[p].uniforms={u_TileTexture:{type:"t",value:f},u_SkyTexture:{type:"t",value:this.reflector.getRenderTarget().texture},u_RippleShader:{type:"t",value:this.rippleTexture},u_CausticTex:{type:"t",value:this.causticTex},u_LightDir:{type:"t",value:this.lightDirection},u_PoolHeight:{type:"t",value:this.poolHeight}},this.waterMaterials[p]=new t.ShaderMaterial({vertexShader:this.waterShaders[p].vertexShader,fragmentShader:this.waterShaders[p].fragmentShader,uniforms:this.waterShaders[p].uniforms,side:t.BackSide}),this.waterMaterials[p].side=p?t.BackSide:t.FrontSide;this.waterMeshes=[];for(p=0;p<2;p++)this.waterMeshes[p]=new t.Mesh(d,this.waterMaterials[p]),this.waterMeshes[p].rotation.x=1.5*Math.PI,this.object3D.add(this.waterMeshes[p]);this.waterMeshes[0].onBeforeRender=function(t,n,i){e.object3D.visible=!1,e.reflector.matrixWorld.copy(e.waterMeshes[0].matrixWorld),e.refractor.matrixWorld.copy(e.waterMeshes[0].matrixWorld),e.reflector.onBeforeRender(t,n,i),e.refractor.onBeforeRender(t,n,i),e.object3D.visible=!0};var m=new t.MeshPhongMaterial({color:14540253,specular:0,shininess:30,shading:t.FlatShading,side:t.DoubleSide}),g=new t.Mesh(new t.OpenBoxBufferGeometry(this.waterWidth,1,this.waterHeight),m);g.position.y=-.5,this.object3D.isStorable=!1,this.object3D.add(g);var v=this.scene.root.canvas;return v&&v.parentElement.addEventListener("click",this.onClicked.bind(this,v),!1),this},h.prototype.addDrop=function(t,e,n){this.waterInfo.addDrop(t,e,n)},h.prototype.addRandomDrops=function(){function e(t,e){return Math.random()*(e-t)+t}for(var n=0;n<10;n++)this.addDrop(new t.Vector2(e(0,.5),e(0,.5)),this.rippleRadius,1&n?-.1:.1)},h.prototype.update=function(){this.renderer.clear(),this.rippleTexture=this.waterInfo.render1(),this.causticsInfo.pCaustics.updateUniform("u_LightDir",this.lightDirection),this.causticsInfo.pCaustics.updateUniform("u_PoolHeight",this.poolHeight),this.causticTex=this.causticsInfo.render1(this.rippleTexture);for(var t=0;t<2;t++)this.waterMaterials[t].uniforms.u_RippleShader.value=this.rippleTexture,this.waterMaterials[t].uniforms.u_CausticTex.value=this.causticTex,this.waterMaterials[t].uniforms.u_LightDir.value=this.lightDirection,this.waterMaterials[t].uniforms.u_PoolHeight.value=this.poolHeight},h.prototype.onClicked=function(e,n){var i=e||document.getElementsByTagName("canvas")[0],r=i.getBoundingClientRect(),o=r.left,a=r.top;this.mouse.x=(n.clientX-o)/i.width*2-1,this.mouse.y=-(n.clientY-a)/i.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);var s=this.raycaster.intersectObject(this.waterMeshes[0]),l=this.raycaster.intersectObject(this.waterMeshes[1]);if(s.length>0)var c=s[0].point;else{if(!(l.length>0))return;c=l[0].point}for(var u=this.waterWidth*this.scale.x,h=this.waterHeight*this.scale.z,f=new t.Vector2((c.x+u/2)/u,(-c.z+h/2)/h),d=0;d<2;d++)this.addDrop(f,this.rippleRadius,1&d?-.2:.2)},e.default=u("PondEntity",h)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(3),r=n(467),o=n(468),a=n(469),s=n(4),l=n(12).Entity,c=n(12).registerEntity;function u(e,n,i,r){var o=l.call(this,e);return this.className="TerrainEntity",this.name=n||"Terrain",this.type="Terrain",this.defaultParams={},this.debug=!1,this.object3D=new t.Group,this.object3D.isStorable=!1,o}u.prototype=Object.create(l.prototype),u.prototype.init=function(){l.prototype.init.call(this);var e,n=this,c=this.scene=s.default.program.getActiveScene();if(this.renderer=s.default.program.getActiveRenderer(c),this.camera=s.default.program.getActiveCamera(c),!this.renderer)return this;var u=0,h=0,f=this.mlib={};c.background=new t.Color(328965),c.fog=new t.Fog(328965,2e3,4e3),this.object3D.add(new t.AmbientLight(1118481)),(R=new t.DirectionalLight(16777215,1.15)).position.set(500,2e3,0),this.object3D.add(R),(L=new t.PointLight(16729088,1.5)).position.set(0,0,0),this.object3D.add(L);var d=r.a,p={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat};this.heightMap=new t.WebGLRenderTarget(256,256,p),this.heightMap.texture.generateMipmaps=!1,this.normalMap=new t.WebGLRenderTarget(256,256,p),this.normalMap.texture.generateMipmaps=!1;var m=this.uniformsNoise={time:{value:1},scale:{value:new t.Vector2(1.5,1.5)},offset:{value:new t.Vector2(0,0)}},g=this.uniformsNormal=t.UniformsUtils.clone(d.uniforms);g.height.value=.05,g.resolution.value.set(256,256),g.heightMap.value=this.heightMap.texture;var v=["varying vec2 vUv;","uniform vec2 scale;","uniform vec2 offset;","void main( void ) {","vUv = uv * scale + offset;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),y=new t.LoadingManager((function(){e.visible=!0})),x=new t.TextureLoader(y),b=new t.WebGLRenderTarget(256,256,p);b.texture.generateMipmaps=!1;var w=x.load(i.a.getImg("Terrain")),_=x.load(i.a.getImg("TerrainBg")),M=x.load(i.a.getImg("TerrainNormal"));w.wrapS=w.wrapT=t.RepeatWrapping,_.wrapS=_.wrapT=t.RepeatWrapping,M.wrapS=M.wrapT=t.RepeatWrapping,b.texture.wrapS=b.texture.wrapT=t.RepeatWrapping;var S=o.a,T=t.UniformsUtils.clone(S.uniforms);T.tNormal.value=this.normalMap.texture,T.uNormalScale.value=3.5,T.tDisplacement.value=this.heightMap.texture,T.tDiffuse1.value=w,T.tDiffuse2.value=_,T.tSpecular.value=b.texture,T.tDetail.value=M,T.enableDiffuse1.value=!0,T.enableDiffuse2.value=!0,T.enableSpecular.value=!0,T.diffuse.value.setHex(16777215),T.specular.value.setHex(16777215),T.shininess.value=30,T.uDisplacementScale.value=5,T.uRepeatOverlay.value.set(6,6);for(var A=[["heightmap",["uniform float time;","varying vec2 vUv;","vec4 permute( vec4 x ) {","return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 );","}","vec4 taylorInvSqrt( vec4 r ) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise( vec3 v ) {","const vec2 C = vec2( 1.0 / 6.0, 1.0 / 3.0 );","const vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );","vec3 i  = floor( v + dot( v, C.yyy ) );","vec3 x0 = v - i + dot( i, C.xxx );","vec3 g = step( x0.yzx, x0.xyz );","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + 1.0 * C.xxx;","vec3 x2 = x0 - i2 + 2.0 * C.xxx;","vec3 x3 = x0 - 1. + 3.0 * C.xxx;","i = mod( i, 289.0 );","vec4 p = permute( permute( permute(","i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )","+ i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) )","+ i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );","float n_ = 1.0 / 7.0; // N=7","vec3 ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor( p * ns.z *ns.z );  //  mod(p,N*N)","vec4 x_ = floor( j * ns.z );","vec4 y_ = floor( j - 7.0 * x_ );    // mod(j,N)","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs( x ) - abs( y );","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor( b0 ) * 2.0 + 1.0;","vec4 s1 = floor( b1 ) * 2.0 + 1.0;","vec4 sh = -step( h, vec4( 0.0 ) );","vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;","vec3 p0 = vec3( a0.xy, h.x );","vec3 p1 = vec3( a0.zw, h.y );","vec3 p2 = vec3( a1.xy, h.z );","vec3 p3 = vec3( a1.zw, h.w );","vec4 norm = taylorInvSqrt( vec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) ) );","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max( 0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), 0.0 );","m = m * m;","return 42.0 * dot( m*m, vec4( dot( p0, x0 ), dot( p1, x1 ),","dot( p2, x2 ), dot( p3, x3 ) ) );","}","float surface3( vec3 coord ) {","float n = 0.0;","n += 1.0 * abs( snoise( coord ) );","n += 0.5 * abs( snoise( coord * 2.0 ) );","n += 0.25 * abs( snoise( coord * 4.0 ) );","n += 0.125 * abs( snoise( coord * 8.0 ) );","return n;","}","void main( void ) {","vec3 coord = vec3( vUv, -time );","float n = surface3( coord );","gl_FragColor = vec4( vec3( n, n, n ), 1.0 );","}"].join("\n"),v,m,!1],["normal",d.fragmentShader,d.vertexShader,this.uniformsNormal,!1],["terrain",S.fragmentShader,S.vertexShader,T,!0]],E=0;E<A.length;E++){var q=new t.ShaderMaterial({uniforms:A[E][3],vertexShader:A[E][2],fragmentShader:A[E][1],lights:A[E][4],fog:!0});f[A[E][0]]=q}var C=new t.Scene,P=new t.OrthographicCamera(-128,128,128,-128,-1e4,1e4);P.position.z=100;var R,L,I=new t.PlaneBufferGeometry(256,256),D=new t.Mesh(I,f.heightmap);(D.position.z=-20,C.add(D),this.debug)&&(C.add(new t.AmbientLight(5592405)),(R=new t.DirectionalLight(16777215,1.15)).position.set(500,2e3,0),C.add(R),(L=new t.PointLight(16729088,1.5)).position.set(10,10,10),C.add(L),D.onAfterRender=function(t,e,i){var r=document.createElement("canvas");r.id="_debugPreview",r.width=256,r.height=256,r.style.zIndex=99,r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.border="1px solid #ff0000",document.getElementsByTagName("body")[0].appendChild(r);const o=new Uint8Array(262144),a=new Uint8ClampedArray(o.buffer);t.readRenderTargetPixels(n.heightMap,0,0,256,256,o);var s=r.getContext("2d");const l=new ImageData(a,256,256);s.putImageData(l,0,0)});var O=new t.PlaneBufferGeometry(100,100,32,32);a.a.computeTangents(O),(e=new t.Mesh(O,f.terrain)).position.set(0,-5,0),e.rotation.x=-Math.PI/2,e.visible=!1,this.object3D.add(e);var N=new t.Clock;return e.onBeforeRender=function(i,r,o){var a=N.getDelta();if(e.visible){var s=((h=t.Math.clamp(h+.5*a*1,.1,.8))-.1)/(.8-.1);r.background.setHSL(.1,.5,h),r.fog.color.setHSL(.1,.5,h),T.uNormalScale.value=t.Math.mapLinear(s,0,1,.6,3.5),u=t.Math.clamp(u+-75e-5,0,.05),m.time.value+=a*u,m.offset.value.x+=.05*a,T.uOffset.value.x=4*m.offset.value.x,D.material=f.heightmap,i.setRenderTarget(n.heightMap),i.clear(),i.render(C,P),D.material=f.normal,i.setRenderTarget(n.normalMap),i.clear(),i.render(C,P),i.setRenderTarget(null)}},this},u.prototype.update=function(t){},e.default=c("TerrainEntity",u)}.call(this,n(0))},function(t,e,n){n(237),n(560),n(561),n(562),n(563),n(564),n(565),n(566),n(567),n(159)},function(t,e,n){"use strict";let i={meta:{language:"EN",name:"English",version:1},techbrood:"Techbrood",stone:"Stone",slogan:"Stone - An easy emmersive web 3d presentation online editor",comingSoon:"Coming soon",edit:"Edit",delete:"Delete",copy:"Copy",clone:"Clone",paste:"Paste",cut:"Cut",duplicate:"Duplicate",rename:"Rename",renameObject:"Rename object",select:"Select",redo:"Redo",undo:"Undo",add:"Add",mix:"Mix",multiply:"Multiply",setTransparent:"Set transparent",tool:"Tool",hierarchy:"Hierarchy",inspector:"Inspector",assets:"Assets",templates:"Templates",enabled:"Enabled",disabled:"Disabled",computeNormals:"Compute normals",applyTransformation:"Apply transformation",sceneEditor:"Scene editor",objectEditor:"Object editor",scriptEditor:"Script editor",particleEditor:"Particle editor",recenterGeometries:"Recenter geometries",enable:"Enable",disable:"Disable",static:"Static",dynamic:"Dynamic",createScene:"Create scene",addPoint:"Add point",removePoint:"Remove point",box:"Box",plane:"Plane",sphere:"Sphere",disc:"Disc",cylinder:"Cylinder",convexHull:"ConvexHull",cube:"Cube",torus:"Torus",torusKnot:"Torus Knot",cone:"Cone",light:"Light",directionalLight:"DirectionalLight",spotLight:"SpotLight",pointLight:"PointLight",ambientLight:"AmbientLight",empty:"Empty",camera:"Camera",perspectiveCamera:"PerspectiveCamera",orthographicCamera:"OrthographicCamera",pipeline:"Pipeline",tube:"Tube",name:"Name",visible:"Visible",count:"Count",rate:"Rate",maxParticleCount:"Particle Count",particleRate:"Particle Rate",delayTime:"Delay Time",side:"Side",position:"Position",rotation:"Rotation",scale:"Scale",uuid:"UUID",repeat:"Repeat",offset:"Offset",center:"Center",wrapHor:"Wrap Hor.",wrapVert:"Wrap Vert.",clampEdge:"Clamp to Edge",repeatMirror:"Repeat Mirrored",premulAlpha:"Premul. Alpha",vector:"Vector",type:"Type",physics:"Physics",size:"Size",viewport:"Viewport",mode:"Mode",anchor:"Anchor",antialiasing:"Antialiasing",exposure:"Exposure",backend:"Back-end",whitepoint:"Whitepoint",tonemapping:"Tonemapping",shadows:"Shadows",shadowType:"Shadows type",shadowsAutoUpdate:"Shadow Auto Update",autoClear:"Auto Clear",autoClearColor:"Auto Clear Color",autoClearDepth:"Auto Clear Depth",autoClearStencil:"Auto Clear Stencil",checkShaderErrors:"Check Shaders",clearColor:"Clear color",clearDepth:"Clear depth",clearStencil:"Clear stencil",stencil:"Stencil",sortObjects:"Sort objects",gammaFactor:"Gamma Factor",gammaInput:"Gamma Input",gammaOutput:"Gamma Output",precision:"Precision",alpha:"Alpha",premultipliedAlpha:"Premultiply Alpha",preserveDrawingBuffer:"Preserver Buffers",powerPreference:"Power Preference",logarithmicDepthBuffer:"Logaritmic Depth",physicallyCorrectLights:"Physically Correct Lights",depthWrite:"Depth Write",toneMapped:"Tone Mapping",depthTest:"Depth Test",depthMode:"Depth Mode",background:"Background",fog:"Fog",color:"Color",emissiveColor:"Emissive Color",backgroundColor:"Background Color",fontSize:"Font Size",density:"Density",near:"Near",far:"Far",wireframe:"Wireframe",transparent:"Transparent",opacity:"Opacity",alphaTest:"Alpha test",blendingMode:"Blending Mode",useCamera:"Use camera",renderOrder:"Render order",fov:"FOV",clippingPlanes:"Clipping planes",iterations:"Iterations",tolerance:"Tolerance",gravity:"Gravity",usePhysics:"Use physics",useNavigator:"Use navigator",defaultScene:"Default scene",intensity:"Intensity",specular:"Specular",specularMap:"Specular Map",time:"Time",shading:"Shading",skinning:"Skinning",roughness:"Roughness",metalness:"Metalness",bias:"Bias",refraction:"Refraction",refractionRatio:"Refraction Ratio",morphTargets:"Morph targets",textureMap:"Texture map",sky:"Sky",castShadows:"Cast Shadows",sunDistance:"Sun distance",autoUpdate:"Auto update",skyColor:"Sky color",groundColor:"Ground color",mapping:"Mapping",minFilter:"Min. filter",magFilter:"Mag. filter",flipY:"Flip Y",toneMapped:"Tone mapped",text:"Text",textImage:"Text Image",mirror:"Mirror",thickness:"Thickness",bevel:"Bevel",lineHeight:"Line Height",letterSpacing:"Letter Spacing",align:"Align",smoothing:"Smoothing",threshold:"Threshold",shader:"Shader",outline:"Outline",outlineColor:"Outline Color",outlineWidth:"Outline Width",border:"Border",borderColor:"Border Color",borderSize:"Border Size",borderRadius:"Border Radius",font:"Font",direction:"Direction",forward:"Forward",backward:"Backward",duration:"Duration",emitterType:"Emitter Type",age:"Age",initial:"Initial",variation:"Variation",velocity:"Velocity",acceleration:"Acceleration",base:"Base",spread:"Spread",min:"Min",max:"Max",wiggle:"Wiggle",mass:"Mass",linearDamping:"Linear Damping",angularDamping:"Angular Damping",friction:"Friction",restitution:"Restitution",lockRotation:"Lock Rotation",gravity:"Gravity",annotation:"Annotation",title:"Title",description:"Description",rotate:"Rotate",edgeThickness:"Edge Thickness",edgeStrength:"Edge Strength",edgeGlow:"Edge Glow",pulsePeriod:"Pulse Period",hiddenColor:"Hidden Color",sunColor:"Sun Color",godrays:"God Rays",water:"Water",distance:"Distance",inclination:"Inclination",azimuth:"Azimuth",turbidity:"Turbidity",rayleigh:"Rayleigh",mieCoefficient:"MieCoefficient",mieDirectionalG:"MieDirectionalG",exposure:"Exposure",upforcePerVolume:"Upforce Per Volume",viscosity:"Viscosity",shape:"Shape",line:"Line",fatline:"Fat Line",spline:"Spline",point:"Point",palette:"Palette",pen:"Pen",penStyle:"Pen Style",painter:"Painter",toggle:"Toggle",eraser:"Eraser",strokes:"Strokes",gradient:"Gradient",autoFit:"AutoFit",padding:"Padding",margin:"Margin",paintOnMesh:"Paint on mesh",paintInSpace:"Paint in space",brush:"Brush",attenuation:"Attenuation",clockwise:"CW",counterClockwise:"CCW",speed:"Speed",on:"On",off:"Off",roughnessMap:"Roughness map",metalnessMap:"Metalness map",bumpMap:"Bump map",bumpScale:"Bump scale",normalMap:"Normal map",normalScale:"Normal scale",normalType:"Normal type",displacementMap:"Displacement map",displacementScale:"Displacement scale",emissiveMap:"Emissive map",alphaMap:"Alpha map",environmentMap:"Enviroment map",ambientOcclusionMap:"Ambient occlusion map",sceneAutoSwitching:"Auto switching scene",lockPointer:"Lock pointer",version:"Version",vrScale:"VR Scale",flowX:"Flow X",flowY:"Flow Y",flowSpeed:"Flow Speed",reflectivity:"Reflectivity",transparency:"Transparency",clearCoat:"Clear Coat",clearCoatRoughness:"Clear Coat Roughness",clearcoatNormalMap:"Clear Coat Normal Map",clearcoatNormalScale:"Clear Coat Normal Scale",useCubeCamera:"Use Cube Camera",cubeReflection:"Cube Reflection",cubeRefraction:"Cube Refraction",equirectangularReflection:"Equirectangular Reflection",equirectangularRefraction:"Equirectangular Refraction",sphericalReflection:"Spherical Reflection",cubeUVReflection:"Cube UV Reflection",cubeUVReflection:"Cube UV Refraction",useTexture:"Use Texture",wrapHor:"WrapH",wrapVert:"WrapV",castShadow:"Cast Shadow",receiveShadow:"Receive Shadow",frustumCulled:"Frustum Culled",movementSpeed:"Movement Speed",rotateSpeed:"Rotate Speed",autoRotate:"Auto Rotate",autoRotateSpeed:"Auto Rotate Speed",zoom:"Zoom",zoomSpeed:"Zoom Speed",damping:"Damping",minDistance:"Minimum Distance",maxDistance:"Maximum Distance",minPolarAngle:"Minimum Polar Angle",maxPolarAngle:"Maximum Polar Angle",putTitleHere:"Put title here",putLabelHere:"Put description here",titleSize:"Title Size",labelSize:"Label Size",startColor:"Start Color",endColor:"End Color",draggable:"Draggable",glowing:"Glowing",layers:"Layers",bloomRadius:"Bloom Radius",bloomStrength:"Bloom Strength",bloomThreshold:"Bloom Threshold",refractionIndex:"Refraction Ratio",dispersion:"Dispersion",materialType:"Material Type",relative:"Relative",absolute:"Absolute",bottomRight:"Bottom-Right",bottomLeft:"Bottom-Left",topRight:"Top-Right",topLeft:"Top-Left",firstPerson:"FPS",orbit:"Orbit",left:"Left",right:"Right",front:"Front",back:"Back",top:"Top",bottom:"Bottom",local:"Local",world:"World",highp:"High precision",mediump:"Medium precision",lowp:"Low precision",highPerformance:"High performance",lowPower:"Low power",default:"Default",never:"Never",always:"Always",double:"Double",less:"Less",lessOrEqual:"Less or equal",greater:"Greater",greaterOrEqual:"Greater or equal",notEqual:"Not equal",none:"None",linear:"Linear",exponential:"Exponential",normal:"Normal",additive:"Additive",subtractive:"Subtractive",horizontal:"Horizontal",vertical:"Vertical",smooth:"Smooth",flat:"Flat",width:"Width",height:"Height",resolution:"Resolution",webgl:"WebGL 1.0",webgl2:"WebGL 2.0",nearest:"Nearest",allSides:"All Sides",random:"Random",union:"Union",subtract:"Subtract",intersect:"Intersect",simplify:"Simplify",merge:"Merge",annotator:"Annotator",extruder:"Extruder",subdivisionModifier:"Subdivision",simplifyModifier:"Simplify",project:"Project",program:"Program",run:"Run",stop:"Stop",new:"New",save:"Save",saveAs:"Save as",load:"Load",settings:"Settings",publish:"Publish",import:"Import",export:"Export",exit:"Exit",selectAll:"Select all",render:"Render",tools:"Tools",selectShortcut:"Select",moveShortcut:"Move (T)",scaleShortcut:"Scale (S)",rotateShortcut:"Rotate (R)",space:"Space",about:"About",search:"Search",replace:"Replace",replaceAll:"Replace all",clear:"Clear",cameraNavigation:"Camera navigation mode",cameraMode:"Change camera mode",scene:"Scene",move:"Move",play:"Play",entity:"Entity",robot:"Robot",pond:"Pond",terrain:"Terrain",codeEditor:"Code",toolbox:"ToolBox",slider:"Slider",textSlider:"Text Slider",textImageSlider:"Text Image Slider",imageSlider:"Image Slider",particleSlider:"Particle Slider",transition:"Transition",fadeOut:"Fade Out",particle:"Particle",interval:"Interval",spacing:"Spacing",waveSpeed:"Wave Speed",shininess:"Shininess",movement:"Movement",sensitivity:"Sensitivity",moveSpeed:"Move Speed",heightSpeed:"Height Speed",autoForward:"Auto Forward",autoSpeedFactor:"Auto Speed Fractor",lockVertical:"Lock Vertical",flame:"Flame",raindrop:"Raindrop",snow:"Snow",leaf:"Leaf",fountain:"Fountain",fireworks:"Fireworks",addComponents:"Add Components",plus:"Plus",addScene:"Add Scene",reset:"Reset",general:"General",theme:"Theme",historySize:"History size",hintHistory:"How many changes are stored in the history.",snap:"Snap",grid:"Grid",image:"Image",video:"Video",file:"File",material:"Material",geometry:"Geometry",geometryType:"Geometry Type",texture:"Texture",toggleVR:"Toggle Virtual Reality",toggleFullscreen:"Toggle Fullscreen",augmentedReality:"Augmented Reality",virtualReality:"Virtual Reality",projectSaved:"Project saved.",projectLoaded:"Project loaded",projectExported:"Project exported",deleteObjects:"Delete objects?",loadProjectChangesLost:"All unsaved changes to the project will be lost.",loadProject:"Load project?",createProject:"Create new project?",unsavedChangesExit:"All unsaved changes to the project will be lost. Do you really wanna exit?",cannotAddItself:"Cannot add object into itself.",cannotAddToChildren:"Cannot add object into is children.",nothingToRedo:"Nothing to redo!",nothingToUndo:"Not possible to undo any further",openTabToEditContent:"Open new tab to edit content or create new project",needsObjectGeometry:"Operation needs an object that contains a geometry.",needsObjectMesh:"Operation needs a mesh object.",needsTwoObjectMesh:"Operation needs two mesh object.",needsTwoObjectGeometry:"Operation needs two objects with geometries",needsTwoObjects:"Operation needs two objects.",selectObjectEditAnimation:"Select an object to edit animation.",nothingToShow:"Select an object to view its properties.",errorExportingProject:"Error exporting project",errorLoadingFile:"Error loading file",errorSavingFile:"Error saving file",errorPaste:"Error pasting object",errorRunInitialize:"Error while initializing program.",errorRunpdate:"Error while running program.",errorRunRender:"Error while rendering program.",webglNotSupported:"WebGL is not supported or is disabled.\nBrood Studio cannot run.",unknownFileFormat:"Unknown file format.",failedLoadSpine:"Failed to load Spine animation, make sure that .json and .atlas have the same name.",noAudioData:"No audio data, you need to drag an audio into the object to add audio component.",hintCheckShaderErrors:"Defines whether material shader programs are checked for errors during compilation and linkage process.",hintStencil:"Whether the drawing buffer has a stencil buffer of at least 8 bits.",hintSortObjects:"If true the renderer sorts the objects from back to front for rendering. Important if using multiple transparent objects.",hintAlpha:"Whether the canvas contains an alpha (transparency) buffer or not.",hintAntialiasing:"Antialiasing can be used to smooth jaged edges.",hintBackend:"Prefered rendering backend API to use if available. Shader code might not be cross compatible between rendering backends.",hintPremultipliedAlpha:"Whether the renderer will assume that colors have premultiplied alpha.",hintLogarithmicDepthBuffer:"Whether to use a logarithmic depth buffer. It may be neccesary to use this if dealing with huge differences in scale in a single scene.",hintRenderOrder:"Camera with lower order gets rendered first.",hintShadowsAutoUpdate:"Enables automatic updates to the shadows in the scene. If you do not require dynamic lighting / shadows, you may set this to false.",hintPrecision:'Shader precision. Can be "highp", "mediump" or "lowp". Defaults to "highp" if supported by the device.',hintPowerPreference:"Provides a hint to the user agent indicating what configuration of GPU is suitable for this WebGL context.",hintTonemapping:"Tonemapping can be used to remap the color of the image to a diferent set giving the scene a different color mood and/or dynamic color based on global luminosity.",hintAutoClearColor:"Defines whether the renderer should clear the color buffer.",hintAutoClearDepth:"Defines whether the renderer should clear the depth buffer.",hintAutoClearStencil:"Defines whether the renderer should clear the stencil buffer.",hintPhysicallyCorrectLights:"Whether to use physically correct lighting mode.",hintCloseBrush:"You have to close brush tool before material editing",hintAttachedToScene:"This component can only be attached to scene.",hintAttachedToMesh:"Object control can only be applied to mesh.",hintOnlyBasicGeometrySupport:"Only basic geometry support brushing for now.",hintHaveToCloseBrushFirst:"You have to close brush before changing targeted mesh.",hintExtruderLimitation:"Extrude can only be applied to line or spline.",hintTwinkleAttachedToLight:"Twinkle can only be applied to point light.",hintUseGlb:"Please convert to glb format.",hintParticleNoGeometry:"The particle is not in a valid mesh.",hintNoSpline:"Please select a spline entity firstly.",hintNoEntity:"Please select a entity firstly.",hintModifierToMeshLimitation:"This modifier can only be applied to mesh.",updatedRestart:"TDS updated\nRestart the editor",alreadyUpdated:"TDS already up to date.",updateFailed:"Failed to download update files.",misc:"Misc",information:"Information",author:"Author",stoneIntroduction:"Stone, thinking about one more dimension."};n(114).a.register(i)},function(t,e,n){"use strict";n.r(e);var i=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},r=function(t){let e=t,n=t;function r(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)<0?i=o+1:r=o}return i}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>i(t(e),n)}(t)),{left:r,center:function(t,n,i,o){null==i&&(i=0),null==o&&(o=t.length);const a=r(t,n,i,o-1);return a>i&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const o=i+r>>>1;n(t[o],e)>0?r=o:i=o+1}return i}}};var o=function(t){return null===t?NaN:+t};const a=r(i),s=a.right,l=a.left,c=r(o).center;var u=s;function h(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(r=+r)>=r&&++n}return n}function f(t){return 0|t.length}function d(t){return!(t>0)}function p(t){return"object"!=typeof t||"length"in t?t:Array.from(t)}function m(...t){const e="function"==typeof t[t.length-1]&&function(t){return e=>t(...e)}(t.pop()),n=(t=t.map(p)).map(f),i=t.length-1,r=new Array(i+1).fill(0),o=[];if(i<0||n.some(d))return o;for(;;){o.push(r.map((e,n)=>t[n][e]));let a=i;for(;++r[a]===n[a];){if(0===a)return e?o.map(e):o;r[a--]=0}}}function g(t,e){var n=0,i=0;return Float64Array.from(t,void 0===e?t=>n+=+t||0:r=>n+=+e(r,i++,t)||0)}var v=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN};function y(t,e){let n,i=0,r=0,o=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-r,r+=n/++i,o+=n*(e-r));else{let a=-1;for(let s of t)null!=(s=e(s,++a,t))&&(s=+s)>=s&&(n=s-r,r+=n/++i,o+=n*(s-r))}if(i>1)return o/(i-1)}function x(t,e){const n=y(t,e);return n?Math.sqrt(n):n}var b=function(t,e){let n,i;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=i=e):(n>e&&(n=e),i<e&&(i=e)));else{let r=-1;for(let o of t)null!=(o=e(o,++r,t))&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]};class w{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=e[i],o=t+r,a=Math.abs(t)<Math.abs(r)?t-(o-r):r-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,i,r=this._n,o=0;if(r>0){for(o=t[--r];r>0&&(e=o,n=t[--r],o=e+n,i=n-(o-e),!i););r>0&&(i<0&&t[r-1]<0||i>0&&t[r-1]>0)&&(n=2*i,e=o+n,n==e-o&&(o=e))}return o}}var _=function(t,e){const n=new w;if(void 0===e)for(let e of t)(e=+e)&&n.add(e);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&n.add(r)}return+n},M=function(t){return t};function S(t,...e){return R(t,M,M,e)}function T(t,...e){return R(t,Array.from,M,e)}function A(t,e,...n){return R(t,M,e,n)}function E(t,e,...n){return R(t,Array.from,e,n)}function q(t,...e){return R(t,M,P,e)}function C(t,...e){return R(t,Array.from,P,e)}function P(t){if(1!==t.length)throw new Error("duplicate key");return t[0]}function R(t,e,n,i){return function t(r,o){if(o>=i.length)return n(r);const a=new Map,s=i[o++];let l=-1;for(const t of r){const e=s(t,++l,r),n=a.get(e);n?n.push(t):a.set(e,[t])}for(const[e,n]of a)a.set(e,t(n,o));return e(a)}(t,0)}var L=Array.prototype,I=L.slice,D=(L.map,function(t){return function(){return t}}),O=Math.sqrt(50),N=Math.sqrt(10),F=Math.sqrt(2),B=function(t,e,n){var i,r,o,a,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((i=e<t)&&(r=t,t=e,e=r),0===(a=z(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(r=Math.ceil(e-t+1));++s<r;)o[s]=(t+s)*a;else for(a=-a,t=Math.ceil(t*a),e=Math.floor(e*a),o=new Array(r=Math.ceil(e-t+1));++s<r;)o[s]=(t+s)/a;return i&&o.reverse(),o};function z(t,e,n){var i=(e-t)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=O?10:o>=N?5:o>=F?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=O?10:o>=N?5:o>=F?2:1)}function U(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=O?r*=10:o>=N?r*=5:o>=F&&(r*=2),e<t?-r:r}function k(t,e,n){let i;for(;;){const r=z(t,e,n);if(r===i||0===r||!isFinite(r))return[t,e];r>0?(t=Math.floor(t/r)*r,e=Math.ceil(e/r)*r):r<0&&(t=Math.ceil(t*r)/r,e=Math.floor(e*r)/r),i=r}}var j=function(t){return Math.ceil(Math.log(h(t))/Math.LN2)+1},V=function(){var t=M,e=b,n=j;function i(i){Array.isArray(i)||(i=Array.from(i));var r,o,a=i.length,s=new Array(a);for(r=0;r<a;++r)s[r]=t(i[r],r,i);var l=e(s),c=l[0],h=l[1],f=n(s,c,h);Array.isArray(f)||(f=+f,e===b&&([c,h]=k(c,h,f)),(f=B(c,h,f))[f.length-1]===h&&f.pop());for(var d=f.length;f[0]<=c;)f.shift(),--d;for(;f[d-1]>h;)f.pop(),--d;var p,m=new Array(d+1);for(r=0;r<=d;++r)(p=m[r]=[]).x0=r>0?f[r-1]:c,p.x1=r<d?f[r]:h;for(r=0;r<a;++r)c<=(o=s[r])&&o<=h&&m[u(f,o,0,d)].push(i[r]);return m}return i.value=function(e){return arguments.length?(t="function"==typeof e?e:D(e),i):t},i.domain=function(t){return arguments.length?(e="function"==typeof t?t:D([t[0],t[1]]),i):e},i.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?D(I.call(t)):D(t),i):n},i};function G(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function H(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function W(t,e,n=0,r=t.length-1,o=i){for(;r>n;){if(r-n>600){const i=r-n+1,a=e-n+1,s=Math.log(i),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(i-l)/i)*(a-i/2<0?-1:1);W(t,e,Math.max(n,Math.floor(e-a*l/i+c)),Math.min(r,Math.floor(e+(i-a)*l/i+c)),o)}const i=t[e];let a=n,s=r;for(X(t,n,e),o(t[r],i)>0&&X(t,n,r);a<s;){for(X(t,a,s),++a,--s;o(t[a],i)<0;)++a;for(;o(t[s],i)>0;)--s}0===o(t[n],i)?X(t,n,s):(++s,X(t,s,r)),s<=e&&(n=s+1),e<=s&&(r=s-1)}return t}function X(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Y(t,e,n){if(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n))).length){if((e=+e)<=0||i<2)return H(t);if(e>=1)return G(t);var i,r=(i-1)*e,o=Math.floor(r),a=G(W(t,o).subarray(0,o+1));return a+(H(t.subarray(o+1))-a)*(r-o)}}function Z(t,e,n=o){if(i=t.length){if((e=+e)<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,a=Math.floor(r),s=+n(t[a],a,t);return s+(+n(t[a+1],a+1,t)-s)*(r-a)}}var Q=function(t,e,n){return Math.ceil((n-e)/(2*(Y(t,.75)-Y(t,.25))*Math.pow(h(t),-1/3)))},J=function(t,e,n){return Math.ceil((n-e)/(3.5*x(t)*Math.pow(h(t),-1/3)))};function K(t,e){let n,i=-1,r=-1;if(void 0===e)for(const e of t)++r,null!=e&&(n<e||void 0===n&&e>=e)&&(n=e,i=r);else for(let o of t)null!=(o=e(o,++r,t))&&(n<o||void 0===n&&o>=o)&&(n=o,i=r);return i}function $(t,e){let n=0,i=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,i+=e);else{let r=-1;for(let o of t)null!=(o=e(o,++r,t))&&(o=+o)>=o&&(++n,i+=o)}if(n)return i/n}var tt=function(t,e){return Y(t,.5,e)};function et(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function nt(t,e){let n,i=-1,r=-1;if(void 0===e)for(const e of t)++r,null!=e&&(n>e||void 0===n&&e>=e)&&(n=e,i=r);else for(let o of t)null!=(o=e(o,++r,t))&&(n>o||void 0===n&&o>=o)&&(n=o,i=r);return i}function it(t,e=rt){const n=[];let i,r=!1;for(const o of t)r&&n.push(e(i,o)),i=o,r=!0;return n}function rt(t,e){return[t,e]}var ot=function(t,e){return Array.from(e,e=>t[e])},at=function(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(r);++i<r;)o[i]=t+i*n;return o};function st(t,e=i){let n,r=!1;if(1===e.length){let o;for(const a of t){const t=e(a);(r?i(t,o)<0:0===i(t,t))&&(n=a,o=t,r=!0)}}else for(const i of t)(r?e(i,n)<0:0===e(i,i))&&(n=i,r=!0);return n}function lt(t,e=i){if(1===e.length)return nt(t,e);let n,r=-1,o=-1;for(const i of t)++o,(r<0?0===e(i,i):e(i,n)<0)&&(n=i,r=o);return r}function ct(t,e=i){let n,r=!1;if(1===e.length){let o;for(const a of t){const t=e(a);(r?i(t,o)>0:0===i(t,t))&&(n=a,o=t,r=!0)}}else for(const i of t)(r?e(i,n)>0:0===e(i,i))&&(n=i,r=!0);return n}function ut(t,e=i){if(1===e.length)return K(t,e);let n,r=-1,o=-1;for(const i of t)++o,(r<0?0===e(i,i):e(i,n)>0)&&(n=i,r=o);return r}function ht(t,e){const n=lt(t,e);return n<0?void 0:n}var ft=dt(Math.random);function dt(t){return function(e,n=0,i=e.length){let r=i-(n=+n);for(;r;){const i=t()*r--|0,o=e[r+n];e[r+n]=e[i+n],e[i+n]=o}return e}}function pt(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}var mt=function(t){if(!(r=t.length))return[];for(var e=-1,n=H(t,gt),i=new Array(n);++e<n;)for(var r,o=-1,a=i[e]=new Array(r);++o<r;)a[o]=t[o][e];return i};function gt(t){return t.length}var vt=function(){return mt(arguments)};function yt(t,e){if("function"!=typeof e)throw new TypeError("test is not a function");let n=-1;for(const i of t)if(!e(i,++n,t))return!1;return!0}function xt(t,e){if("function"!=typeof e)throw new TypeError("test is not a function");let n=-1;for(const i of t)if(e(i,++n,t))return!0;return!1}function bt(t,e){if("function"!=typeof e)throw new TypeError("test is not a function");const n=[];let i=-1;for(const r of t)e(r,++i,t)&&n.push(r);return n}function wt(t,e){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");if("function"!=typeof e)throw new TypeError("mapper is not a function");return Array.from(t,(n,i)=>e(n,i,t))}function _t(t,e,n){if("function"!=typeof e)throw new TypeError("reducer is not a function");const i=t[Symbol.iterator]();let r,o,a=-1;if(arguments.length<3){if(({done:r,value:n}=i.next()),r)return;++a}for(;({done:r,value:o}=i.next()),!r;)n=e(n,o,++a,t);return n}function Mt(t){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(t).reverse()}function St(t,e=i){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(t).sort(e)}function Tt(t,...e){t=new Set(t);for(const n of e)for(const e of n)t.delete(e);return t}function At(t,e){const n=e[Symbol.iterator](),i=new Set;for(const e of t){if(i.has(e))return!1;let t,r;for(;({value:t,done:r}=n.next())&&!r;){if(Object.is(e,t))return!1;i.add(t)}}return!0}function Et(t){return t instanceof Set?t:new Set(t)}function qt(t,...e){t=new Set(t),e=e.map(Et);t:for(const n of t)for(const i of e)if(!i.has(n)){t.delete(n);continue t}return t}function Ct(t,e){const n=t[Symbol.iterator](),i=new Set;for(const t of e){if(i.has(t))continue;let e,r;for(;({value:e,done:r}=n.next());){if(r)return!1;if(i.add(e),Object.is(t,e))break}}return!0}function Pt(t,e){return Ct(e,t)}function Rt(...t){const e=new Set;for(const n of t)for(const t of n)e.add(t);return e}var Lt=Array.prototype.slice,It=function(t){return t};function Dt(t){return"translate("+(t+.5)+",0)"}function Ot(t){return"translate(0,"+(t+.5)+")"}function Nt(t){return e=>+t(e)}function Ft(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function Bt(){return!this.__axis}function zt(t,e){var n=[],i=null,r=null,o=6,a=6,s=3,l=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",u=1===t||3===t?Dt:Ot;function h(h){var f=null==i?e.ticks?e.ticks.apply(e,n):e.domain():i,d=null==r?e.tickFormat?e.tickFormat.apply(e,n):It:r,p=Math.max(o,0)+s,m=e.range(),g=+m[0]+.5,v=+m[m.length-1]+.5,y=(e.bandwidth?Ft:Nt)(e.copy()),x=h.selection?h.selection():h,b=x.selectAll(".domain").data([null]),w=x.selectAll(".tick").data(f,e).order(),_=w.exit(),M=w.enter().append("g").attr("class","tick"),S=w.select("line"),T=w.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(M),S=S.merge(M.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),T=T.merge(M.append("text").attr("fill","currentColor").attr(c,l*p).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),h!==x&&(b=b.transition(h),w=w.transition(h),S=S.transition(h),T=T.transition(h),_=_.transition(h).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=y(t))?u(t):this.getAttribute("transform")})),M.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return u(e&&isFinite(e=e(t))?e:y(t))}))),_.remove(),b.attr("d",4===t||2==t?a?"M"+l*a+","+g+"H0.5V"+v+"H"+l*a:"M0.5,"+g+"V"+v:a?"M"+g+","+l*a+"V0.5H"+v+"V"+l*a:"M"+g+",0.5H"+v),w.attr("opacity",1).attr("transform",(function(t){return u(y(t))})),S.attr(c+"2",l*o),T.attr(c,l*p).text(d),x.filter(Bt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),x.each((function(){this.__axis=y}))}return h.scale=function(t){return arguments.length?(e=t,h):e},h.ticks=function(){return n=Lt.call(arguments),h},h.tickArguments=function(t){return arguments.length?(n=null==t?[]:Lt.call(t),h):n.slice()},h.tickValues=function(t){return arguments.length?(i=null==t?null:Lt.call(t),h):i&&i.slice()},h.tickFormat=function(t){return arguments.length?(r=t,h):r},h.tickSize=function(t){return arguments.length?(o=a=+t,h):o},h.tickSizeInner=function(t){return arguments.length?(o=+t,h):o},h.tickSizeOuter=function(t){return arguments.length?(a=+t,h):a},h.tickPadding=function(t){return arguments.length?(s=+t,h):s},h}function Ut(t){return zt(1,t)}function kt(t){return zt(2,t)}function jt(t){return zt(3,t)}function Vt(t){return zt(4,t)}var Gt=n(61);function Ht(){}var Wt=function(t){return null==t?Ht:function(){return this.querySelector(t)}},Xt=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)};function Yt(){return[]}var Zt=function(t){return null==t?Yt:function(){return this.querySelectorAll(t)}};var Qt=function(t){return function(){return this.matches(t)}};function Jt(t){return function(e){return e.matches(t)}}var Kt=Array.prototype.find;function $t(){return this.firstElementChild}var te=Array.prototype.filter;function ee(){return this.children}var ne=function(t){return new Array(t.length)};function ie(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ie.prototype={constructor:ie,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var re=function(t){return function(){return t}};function oe(t,e,n,i,r,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new ie(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function ae(t,e,n,i,r,o,a){var s,l,c,u=new Map,h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(d[s]=c=a.call(l,l.__data__,s,e)+"",u.has(c)?r[s]=l:u.set(c,l));for(s=0;s<f;++s)c=a.call(t,o[s],s,o)+"",(l=u.get(c))?(i[s]=l,l.__data__=o[s],u.delete(c)):n[s]=new ie(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&u.get(d[s])===l&&(r[s]=l)}function se(t){return t.__data__}function le(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var ce="http://www.w3.org/1999/xhtml",ue={svg:"http://www.w3.org/2000/svg",xhtml:ce,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},he=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),ue.hasOwnProperty(e)?{space:ue[e],local:t}:t};function fe(t){return function(){this.removeAttribute(t)}}function de(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pe(t,e){return function(){this.setAttribute(t,e)}}function me(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ge(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function ve(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var ye=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function xe(t){return function(){this.style.removeProperty(t)}}function be(t,e,n){return function(){this.style.setProperty(t,e,n)}}function we(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function _e(t,e){return t.style.getPropertyValue(e)||ye(t).getComputedStyle(t,null).getPropertyValue(e)}function Me(t){return function(){delete this[t]}}function Se(t,e){return function(){this[t]=e}}function Te(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Ae(t){return t.trim().split(/^|\s+/)}function Ee(t){return t.classList||new qe(t)}function qe(t){this._node=t,this._names=Ae(t.getAttribute("class")||"")}function Ce(t,e){for(var n=Ee(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Pe(t,e){for(var n=Ee(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Re(t){return function(){Ce(this,t)}}function Le(t){return function(){Pe(this,t)}}function Ie(t,e){return function(){(e.apply(this,arguments)?Ce:Pe)(this,t)}}qe.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function De(){this.textContent=""}function Oe(t){return function(){this.textContent=t}}function Ne(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Fe(){this.innerHTML=""}function Be(t){return function(){this.innerHTML=t}}function ze(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Ue(){this.nextSibling&&this.parentNode.appendChild(this)}function ke(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function je(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===ce&&e.documentElement.namespaceURI===ce?e.createElement(t):e.createElementNS(n,t)}}function Ve(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var Ge=function(t){var e=he(t);return(e.local?Ve:je)(e)};function He(){return null}function We(){var t=this.parentNode;t&&t.removeChild(this)}function Xe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ye(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ze(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Qe(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Je(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Ke(t,e,n){var i=ye(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function $e(t,e){return function(){return Ke(this,t,e)}}function tn(t,e){return function(){return Ke(this,t,e.apply(this,arguments))}}var en=[null];function nn(t,e){this._groups=t,this._parents=e}function rn(){return new nn([[document.documentElement]],en)}nn.prototype=rn.prototype={constructor:nn,select:function(t){"function"!=typeof t&&(t=Wt(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=s[u])&&(a=t.call(o,o.__data__,u,s))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new nn(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Xt(e)}}(t):Zt(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(i.push(t.call(a,a.__data__,c,s)),r.push(a));return new nn(i,r)},selectChild:function(t){return this.select(null==t?$t:function(t){return function(){return Kt.call(this.children,t)}}("function"==typeof t?t:Jt(t)))},selectChildren:function(t){return this.selectAll(null==t?ee:function(t){return function(){return te.call(this.children,t)}}("function"==typeof t?t:Jt(t)))},filter:function(t){"function"!=typeof t&&(t=Qt(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new nn(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,se);var n=e?ae:oe,i=this._parents,r=this._groups;"function"!=typeof t&&(t=re(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],h=r[c],f=h.length,d=Xt(t.call(u,u&&u.__data__,c,i)),p=d.length,m=s[c]=new Array(p),g=a[c]=new Array(p),v=l[c]=new Array(f);n(u,h,m,g,v,d,e);for(var y,x,b=0,w=0;b<p;++b)if(y=m[b]){for(b>=w&&(w=b+1);!(x=g[w])&&++w<p;);y._next=x||null}}return(a=new nn(a,i))._enter=s,a._exit=l,a},enter:function(){return new nn(this._enter||this._groups.map(ne),this._parents)},exit:function(){return new nn(this._exit||this._groups.map(ne),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){if(!(t instanceof nn))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new nn(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=le);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,c=r[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new nn(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=he(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?de:fe:"function"==typeof e?n.local?ve:ge:n.local?me:pe)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?xe:"function"==typeof e?we:be)(t,e,null==n?"":n)):_e(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Me:"function"==typeof e?Te:Se)(t,e)):this.node()[t]},classed:function(t,e){var n=Ae(t+"");if(arguments.length<2){for(var i=Ee(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Ie:e?Re:Le)(n,e))},text:function(t){return arguments.length?this.each(null==t?De:("function"==typeof t?Ne:Oe)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Fe:("function"==typeof t?ze:Be)(t)):this.node().innerHTML},raise:function(){return this.each(Ue)},lower:function(){return this.each(ke)},append:function(t){var e="function"==typeof t?t:Ge(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Ge(t),i=null==e?He:"function"==typeof e?e:Wt(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(We)},clone:function(t){return this.select(t?Ye:Xe)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=Ze(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Je:Qe,i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(i=0,l=s[c];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?tn:$e)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,a=r.length;o<a;++o)(i=r[o])&&(yield i)}};var on=rn,an=function(t){return"string"==typeof t?new nn([[document.querySelector(t)]],[document.documentElement]):new nn([[t]],en)};var sn=function(t){t.preventDefault(),t.stopImmediatePropagation()},ln=function(t){var e=t.document.documentElement,n=an(t).on("dragstart.drag",sn,!0);"onselectstart"in e?n.on("selectstart.drag",sn,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function cn(t,e){var n=t.document.documentElement,i=an(t).on("dragstart.drag",null);e&&(i.on("click.drag",sn,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var un=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function hn(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function fn(){}var dn="\\s*([+-]?\\d+)\\s*",pn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",mn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gn=/^#([0-9a-f]{3,8})$/,vn=new RegExp("^rgb\\("+[dn,dn,dn]+"\\)$"),yn=new RegExp("^rgb\\("+[mn,mn,mn]+"\\)$"),xn=new RegExp("^rgba\\("+[dn,dn,dn,pn]+"\\)$"),bn=new RegExp("^rgba\\("+[mn,mn,mn,pn]+"\\)$"),wn=new RegExp("^hsl\\("+[pn,mn,mn]+"\\)$"),_n=new RegExp("^hsla\\("+[pn,mn,mn,pn]+"\\)$"),Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Sn(){return this.rgb().formatHex()}function Tn(){return this.rgb().formatRgb()}function An(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=gn.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?En(e):3===n?new Rn(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?qn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?qn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=vn.exec(t))?new Rn(e[1],e[2],e[3],1):(e=yn.exec(t))?new Rn(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=xn.exec(t))?qn(e[1],e[2],e[3],e[4]):(e=bn.exec(t))?qn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=wn.exec(t))?On(e[1],e[2]/100,e[3]/100,1):(e=_n.exec(t))?On(e[1],e[2]/100,e[3]/100,e[4]):Mn.hasOwnProperty(t)?En(Mn[t]):"transparent"===t?new Rn(NaN,NaN,NaN,0):null}function En(t){return new Rn(t>>16&255,t>>8&255,255&t,1)}function qn(t,e,n,i){return i<=0&&(t=e=n=NaN),new Rn(t,e,n,i)}function Cn(t){return t instanceof fn||(t=An(t)),t?new Rn((t=t.rgb()).r,t.g,t.b,t.opacity):new Rn}function Pn(t,e,n,i){return 1===arguments.length?Cn(t):new Rn(t,e,n,null==i?1:i)}function Rn(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ln(){return"#"+Dn(this.r)+Dn(this.g)+Dn(this.b)}function In(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Dn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function On(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Fn(t,e,n,i)}function Nn(t){if(t instanceof Fn)return new Fn(t.h,t.s,t.l,t.opacity);if(t instanceof fn||(t=An(t)),!t)return new Fn;if(t instanceof Fn)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),a=NaN,s=o-r,l=(o+r)/2;return s?(a=e===o?(n-i)/s+6*(n<i):n===o?(i-e)/s+2:(e-n)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new Fn(a,s,l,t.opacity)}function Fn(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Bn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function zn(t,e,n,i,r){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*i+a*r)/6}un(fn,An,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Sn,formatHex:Sn,formatHsl:function(){return Nn(this).formatHsl()},formatRgb:Tn,toString:Tn}),un(Rn,Pn,hn(fn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Rn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Rn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ln,formatHex:Ln,formatRgb:In,toString:In})),un(Fn,(function(t,e,n,i){return 1===arguments.length?Nn(t):new Fn(t,e,n,null==i?1:i)}),hn(fn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Fn(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Fn(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Rn(Bn(t>=240?t-240:t+120,r,i),Bn(t,r,i),Bn(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Un=function(t){return function(){return t}};function kn(t,e){return function(n){return t+n*e}}function jn(t){return 1==(t=+t)?Vn:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):Un(isNaN(e)?n:e)}}function Vn(t,e){var n=e-t;return n?kn(t,n):Un(isNaN(t)?e:t)}var Gn=function t(e){var n=jn(e);function i(t,e){var i=n((t=Pn(t)).r,(e=Pn(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),a=Vn(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);function Hn(t){return function(e){var n,i,r=e.length,o=new Array(r),a=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=Pn(e[n]),o[n]=i.r||0,a[n]=i.g||0,s[n]=i.b||0;return o=t(o),a=t(a),s=t(s),i.opacity=1,function(t){return i.r=o(t),i.g=a(t),i.b=s(t),i+""}}}var Wn=Hn((function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],a=i>0?t[i-1]:2*r-o,s=i<e-1?t[i+2]:2*o-r;return zn((n-i/e)*e,a,r,o,s)}})),Xn=(Hn((function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],o=t[i%e],a=t[(i+1)%e],s=t[(i+2)%e];return zn((n-i/e)*e,r,o,a,s)}})),function(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(o){for(n=0;n<i;++n)r[n]=t[n]*(1-o)+e[n]*o;return r}});function Yn(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zn(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),a=new Array(i);for(n=0;n<r;++n)o[n]=ri(t[n],e[n]);for(;n<i;++n)a[n]=e[n];return function(t){for(n=0;n<r;++n)a[n]=o[n](t);return a}}var Qn=function(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}},Jn=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},Kn=function(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=ri(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}},$n=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ti=new RegExp($n.source,"g");var ei,ni,ii=function(t,e){var n,i,r,o=$n.lastIndex=ti.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=$n.exec(t))&&(i=ti.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:Jn(n,i)})),o=ti.lastIndex;return o<e.length&&(r=e.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})},ri=function(t,e){var n,i=typeof e;return null==e||"boolean"===i?Un(e):("number"===i?Jn:"string"===i?(n=An(e))?(e=n,Gn):ii:e instanceof An?Gn:e instanceof Date?Qn:Yn(e)?Xn:Array.isArray(e)?Zn:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Kn:Jn)(t,e)},oi=function(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]},ai=0,si=0,li=0,ci=0,ui=0,hi=0,fi="object"==typeof performance&&performance.now?performance:Date,di="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function pi(){return ui||(di(mi),ui=fi.now()+hi)}function mi(){ui=0}function gi(){this._call=this._time=this._next=null}function vi(t,e,n){var i=new gi;return i.restart(t,e,n),i}function yi(){ui=(ci=fi.now())+hi,ai=si=0;try{!function(){pi(),++ai;for(var t,e=ei;e;)(t=ui-e._time)>=0&&e._call.call(null,t),e=e._next;--ai}()}finally{ai=0,function(){var t,e,n=ei,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:ei=e);ni=t,bi(i)}(),ui=0}}function xi(){var t=fi.now(),e=t-ci;e>1e3&&(hi-=e,ci=t)}function bi(t){ai||(si&&(si=clearTimeout(si)),t-ui>24?(t<1/0&&(si=setTimeout(yi,t-fi.now()-hi)),li&&(li=clearInterval(li))):(li||(ci=fi.now(),li=setInterval(xi,1e3)),ai=1,di(yi)))}gi.prototype=vi.prototype={constructor:gi,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?pi():+n)+(null==e?0:+e),this._next||ni===this||(ni?ni._next=this:ei=this,ni=this),this._call=t,this._time=n,bi()},stop:function(){this._call&&(this._call=null,this._time=1/0,bi())}};var wi=function(t,e,n){var i=new gi;return e=null==e?0:+e,i.restart((function(n){i.stop(),t(n+e)}),e,n),i},_i=Object(Gt.dispatch)("start","end","cancel","interrupt"),Mi=[],Si=function(t,e,n,i,r,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(l){var c,u,h,f;if(1!==n.state)return s();for(c in r)if((f=r[c]).name===n.name){if(3===f.state)return wi(o);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(wi((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(l))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function a(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),o=-1,a=i.length;++o<a;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=vi((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:_i,tween:Mi,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})};function Ti(t,e){var n=Ei(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ai(t,e){var n=Ei(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Ei(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var qi,Ci,Pi,Ri,Li=function(t,e){var n,i,r,o=t.__transition,a=!0;if(o){for(r in e=null==e?null:e+"",o)(n=o[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]):a=!1;a&&delete t.__transition}},Ii=180/Math.PI,Di={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Oi=function(t,e,n,i,r,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*Ii,skewX:Math.atan(l)*Ii,scaleX:a,scaleY:s}};function Ni(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,i,r,o,a,s){if(t!==r||i!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:Jn(t,r)},{i:l-2,x:Jn(i,o)})}else(r||o)&&a.push("translate("+r+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Jn(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Jn(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(o.skewX,a.skewX,s,l),function(t,e,n,i,o,a){if(t!==n||e!==i){var s=o.push(r(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Jn(t,n)},{i:s-2,x:Jn(e,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var Fi=Ni((function(t){return"none"===t?Di:(qi||(qi=document.createElement("DIV"),Ci=document.documentElement,Pi=document.defaultView),qi.style.transform=t,t=Pi.getComputedStyle(Ci.appendChild(qi),null).getPropertyValue("transform"),Ci.removeChild(qi),t=t.slice(7,-1).split(","),Oi(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),Bi=Ni((function(t){return null==t?Di:(Ri||(Ri=document.createElementNS("http://www.w3.org/2000/svg","g")),Ri.setAttribute("transform",t),(t=Ri.transform.baseVal.consolidate())?(t=t.matrix,Oi(t.a,t.b,t.c,t.d,t.e,t.f)):Di)}),", ",")",")");function zi(t,e){var n,i;return function(){var r=Ai(this,t),o=r.tween;if(o!==n)for(var a=0,s=(i=n=o).length;a<s;++a)if(i[a].name===e){(i=i.slice()).splice(a,1);break}r.tween=i}}function Ui(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var o=Ai(this,t),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}o.tween=r}}function ki(t,e,n){var i=t._id;return t.each((function(){var t=Ai(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Ei(t,i).value[e]}}var ji=function(t,e){var n;return("number"==typeof e?Jn:e instanceof An?Gn:(n=An(e))?(e=n,Gn):ii)(t,e)};function Vi(t){return function(){this.removeAttribute(t)}}function Gi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Hi(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===i?r:r=e(i=a,n)}}function Wi(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===i?r:r=e(i=a,n)}}function Xi(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttribute(t)}}function Yi(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttributeNS(t.space,t.local)}}function Zi(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Qi(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Ji(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&Qi(t,r)),n}return r._value=e,r}function Ki(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&Zi(t,r)),n}return r._value=e,r}function $i(t,e){return function(){Ti(this,t).delay=+e.apply(this,arguments)}}function tr(t,e){return e=+e,function(){Ti(this,t).delay=e}}function er(t,e){return function(){Ai(this,t).duration=+e.apply(this,arguments)}}function nr(t,e){return e=+e,function(){Ai(this,t).duration=e}}function ir(t,e){if("function"!=typeof e)throw new Error;return function(){Ai(this,t).ease=e}}function rr(t,e,n){var i,r,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Ti:Ai;return function(){var a=o(this,t),s=a.on;s!==i&&(r=(i=s).copy()).on(e,n),a.on=r}}var or=on.prototype.constructor;function ar(t){return function(){this.style.removeProperty(t)}}function sr(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function lr(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&sr(t,o,n)),i}return o._value=e,o}function cr(t){return function(e){this.textContent=t.call(this,e)}}function ur(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&cr(i)),e}return i._value=t,i}var hr=0;function fr(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function dr(){return++hr}var pr=on.prototype;function mr(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}fr.prototype=function(t){return on().transition(t)}.prototype={constructor:fr,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Wt(t));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s,l,c=i[a],u=c.length,h=o[a]=new Array(u),f=0;f<u;++f)(s=c[f])&&(l=t.call(s,s.__data__,f,c))&&("__data__"in s&&(l.__data__=s.__data__),h[f]=l,Si(h[f],e,n,f,h,Ei(s,n)));return new fr(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Zt(t));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var l,c=i[s],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var f,d=t.call(l,l.__data__,h,c),p=Ei(l,n),m=0,g=d.length;m<g;++m)(f=d[m])&&Si(f,e,n,m,d,p);o.push(d),a.push(l)}return new fr(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=Qt(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new fr(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new fr(a,this._parents,this._name,this._id)},selection:function(){return new or(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=dr(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var u=Ei(a,e);Si(a,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new fr(i,this._parents,t,n)},call:pr.call,nodes:pr.nodes,node:pr.node,size:pr.size,empty:pr.empty,each:pr.each,on:function(t,e){var n=this._id;return arguments.length<2?Ei(this.node(),n).on.on(t):this.each(rr(n,t,e))},attr:function(t,e){var n=he(t),i="transform"===n?Bi:ji;return this.attrTween(t,"function"==typeof e?(n.local?Yi:Xi)(n,i,ki(this,"attr."+t,e)):null==e?(n.local?Gi:Vi)(n):(n.local?Wi:Hi)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=he(t);return this.tween(n,(i.local?Ji:Ki)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Fi:ji;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var o=_e(this,t),a=(this.style.removeProperty(t),_e(this,t));return o===a?null:o===n&&a===i?r:r=e(n=o,i=a)}}(t,i)).on("end.style."+t,ar(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,o;return function(){var a=_e(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=_e(this,t)),a===l?null:a===i&&l===r?o:(r=l,o=e(i=a,s))}}(t,i,ki(this,"style."+t,e))).each(function(t,e){var n,i,r,o,a="style."+e,s="end."+a;return function(){var l=Ai(this,t),c=l.on,u=null==l.value[a]?o||(o=ar(e)):void 0;c===n&&r===u||(i=(n=c).copy()).on(s,r=u),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,o=n+"";return function(){var a=_e(this,t);return a===o?null:a===i?r:r=e(i=a,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,lr(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(ki(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,ur(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Ei(this.node(),n).tween,o=0,a=r.length;o<a;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?zi:Ui)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?$i:tr)(e,t)):Ei(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?er:nr)(e,t)):Ei(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(ir(e,t)):Ei(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Ai(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(o,a){var s={value:a},l={value:function(){0==--r&&o()}};n.each((function(){var n=Ai(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===r&&o()}))},[Symbol.iterator]:pr[Symbol.iterator]};var gr={time:null,delay:0,duration:250,ease:mr};function vr(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}on.prototype.interrupt=function(t){return this.each((function(){Li(this,t)}))},on.prototype.transition=function(t){var e,n;t instanceof fr?(e=t._id,t=t._name):(e=dr(),(n=gr).time=pi(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)(a=s[c])&&Si(a,t,e,c,s,n||vr(a,e));return new fr(i,this._parents,t,e)};var yr=t=>()=>t;function xr(t,{sourceEvent:e,target:n,selection:i,mode:r,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:i,enumerable:!0,configurable:!0},mode:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function br(t){t.stopImmediatePropagation()}var wr=function(t){t.preventDefault(),t.stopImmediatePropagation()},_r={name:"drag"},Mr={name:"space"},Sr={name:"handle"},Tr={name:"center"};const{abs:Ar,max:Er,min:qr}=Math;function Cr(t){return[+t[0],+t[1]]}function Pr(t){return[Cr(t[0]),Cr(t[1])]}var Rr={name:"x",handles:["w","e"].map(zr),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Lr={name:"y",handles:["n","s"].map(zr),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ir={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(zr),input:function(t){return null==t?null:Pr(t)},output:function(t){return t}},Dr={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Or={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Nr={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Fr={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Br={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function zr(t){return{type:t}}function Ur(t){return!t.ctrlKey&&!t.button}function kr(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function jr(){return navigator.maxTouchPoints||"ontouchstart"in this}function Vr(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function Gr(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function Hr(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function Wr(){return Zr(Rr)}function Xr(){return Zr(Lr)}var Yr=function(){return Zr(Ir)};function Zr(t){var e,n=kr,i=Ur,r=jr,o=!0,a=Object(Gt.dispatch)("start","brush","end"),s=6;function l(e){var n=e.property("__brush",m).selectAll(".overlay").data([zr("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Dr.overlay).merge(n).each((function(){var t=Vr(this).extent;an(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),e.selectAll(".selection").data([zr("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Dr.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var i=e.selectAll(".handle").data(t.handles,(function(t){return t.type}));i.exit().remove(),i.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return Dr[t.type]})),e.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(r).on("touchstart.brush",f).on("touchmove.brush",d).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function c(){var t=an(this),e=Vr(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-s/2:e[0][0]-s/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-s/2:e[0][1]-s/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+s:s})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+s:s}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function u(t,e,n){var i=t.__brush.emitter;return!i||n&&i.clean?new h(t,e,n):i}function h(t,e,n){this.that=t,this.args=e,this.state=t.__brush,this.active=0,this.clean=n}function f(n){if((!e||n.touches)&&i.apply(this,arguments)){var r,a,s,l,h,f,d,p,m,g,v,y=this,x=n.target.__data__.type,b="selection"===(o&&n.metaKey?x="overlay":x)?_r:o&&n.altKey?Tr:Sr,w=t===Lr?null:Fr[x],_=t===Rr?null:Br[x],M=Vr(y),S=M.extent,T=M.selection,A=S[0][0],E=S[0][1],q=S[1][0],C=S[1][1],P=0,R=0,L=w&&_&&o&&n.shiftKey,I=Array.from(n.touches||[n],t=>{const e=t.identifier;return(t=oi(t,y)).point0=t.slice(),t.identifier=e,t});if("overlay"===x){T&&(m=!0);const e=[I[0],I[1]||I[0]];M.selection=T=[[r=t===Lr?A:qr(e[0][0],e[1][0]),s=t===Rr?E:qr(e[0][1],e[1][1])],[h=t===Lr?q:Er(e[0][0],e[1][0]),d=t===Rr?C:Er(e[0][1],e[1][1])]],I.length>1&&z()}else r=T[0][0],s=T[0][1],h=T[1][0],d=T[1][1];a=r,l=s,f=h,p=d;var D=an(y).attr("pointer-events","none"),O=D.selectAll(".overlay").attr("cursor",Dr[x]);Li(y);var N=u(y,arguments,!0).beforestart();if(n.touches)N.moved=B,N.ended=U;else{var F=an(n.view).on("mousemove.brush",B,!0).on("mouseup.brush",U,!0);o&&F.on("keydown.brush",k,!0).on("keyup.brush",j,!0),ln(n.view)}c.call(y),N.start(n,b.name)}function B(t){for(const e of t.changedTouches||[t])for(const t of I)t.identifier===e.identifier&&(t.cur=oi(e,y));if(L&&!g&&!v&&1===I.length){const t=I[0];Ar(t.cur[0]-t[0])>Ar(t.cur[1]-t[1])?v=!0:g=!0}for(const t of I)t.cur&&(t[0]=t.cur[0],t[1]=t.cur[1]);m=!0,wr(t),z(t)}function z(t){const e=I[0],n=e.point0;var i;switch(P=e[0]-n[0],R=e[1]-n[1],b){case Mr:case _r:w&&(P=Er(A-r,qr(q-h,P)),a=r+P,f=h+P),_&&(R=Er(E-s,qr(C-d,R)),l=s+R,p=d+R);break;case Sr:I[1]?(w&&(a=Er(A,qr(q,I[0][0])),f=Er(A,qr(q,I[1][0])),w=1),_&&(l=Er(E,qr(C,I[0][1])),p=Er(E,qr(C,I[1][1])),_=1)):(w<0?(P=Er(A-r,qr(q-r,P)),a=r+P,f=h):w>0&&(P=Er(A-h,qr(q-h,P)),a=r,f=h+P),_<0?(R=Er(E-s,qr(C-s,R)),l=s+R,p=d):_>0&&(R=Er(E-d,qr(C-d,R)),l=s,p=d+R));break;case Tr:w&&(a=Er(A,qr(q,r-P*w)),f=Er(A,qr(q,h+P*w))),_&&(l=Er(E,qr(C,s-R*_)),p=Er(E,qr(C,d+R*_)))}f<a&&(w*=-1,i=r,r=h,h=i,i=a,a=f,f=i,x in Or&&O.attr("cursor",Dr[x=Or[x]])),p<l&&(_*=-1,i=s,s=d,d=i,i=l,l=p,p=i,x in Nr&&O.attr("cursor",Dr[x=Nr[x]])),M.selection&&(T=M.selection),g&&(a=T[0][0],f=T[1][0]),v&&(l=T[0][1],p=T[1][1]),T[0][0]===a&&T[0][1]===l&&T[1][0]===f&&T[1][1]===p||(M.selection=[[a,l],[f,p]],c.call(y),N.brush(t,b.name))}function U(t){if(br(t),t.touches){if(t.touches.length)return;e&&clearTimeout(e),e=setTimeout((function(){e=null}),500)}else cn(t.view,m),F.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);D.attr("pointer-events","all"),O.attr("cursor",Dr.overlay),M.selection&&(T=M.selection),Gr(T)&&(M.selection=null,c.call(y)),N.end(t,b.name)}function k(t){switch(t.keyCode){case 16:L=w&&_;break;case 18:b===Sr&&(w&&(h=f-P*w,r=a+P*w),_&&(d=p-R*_,s=l+R*_),b=Tr,z());break;case 32:b!==Sr&&b!==Tr||(w<0?h=f-P:w>0&&(r=a-P),_<0?d=p-R:_>0&&(s=l-R),b=Mr,O.attr("cursor",Dr.selection),z());break;default:return}wr(t)}function j(t){switch(t.keyCode){case 16:L&&(g=v=L=!1,z());break;case 18:b===Tr&&(w<0?h=f:w>0&&(r=a),_<0?d=p:_>0&&(s=l),b=Sr,z());break;case 32:b===Mr&&(t.altKey?(w&&(h=f-P*w,r=a+P*w),_&&(d=p-R*_,s=l+R*_),b=Tr):(w<0?h=f:w>0&&(r=a),_<0?d=p:_>0&&(s=l),b=Sr),O.attr("cursor",Dr[x]),z());break;default:return}wr(t)}}function d(t){u(this,arguments).moved(t)}function p(t){u(this,arguments).ended(t)}function m(){var e=this.__brush||{selection:null};return e.extent=Pr(n.apply(this,arguments)),e.dim=t,e}return l.move=function(e,n){e.tween?e.on("start.brush",(function(t){u(this,arguments).beforestart().start(t)})).on("interrupt.brush end.brush",(function(t){u(this,arguments).end(t)})).tween("brush",(function(){var e=this,i=e.__brush,r=u(e,arguments),o=i.selection,a=t.input("function"==typeof n?n.apply(this,arguments):n,i.extent),s=ri(o,a);function l(t){i.selection=1===t&&null===a?null:s(t),c.call(e),r.brush()}return null!==o&&null!==a?l:l(1)})):e.each((function(){var e=this,i=arguments,r=e.__brush,o=t.input("function"==typeof n?n.apply(e,i):n,r.extent),a=u(e,i).beforestart();Li(e),r.selection=null===o?null:o,c.call(e),a.start().brush().end()}))},l.clear=function(t){l.move(t,null)},h.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(t,e){return this.starting?(this.starting=!1,this.emit("start",t,e)):this.emit("brush",t),this},brush:function(t,e){return this.emit("brush",t,e),this},end:function(t,e){return 0==--this.active&&(delete this.state.emitter,this.emit("end",t,e)),this},emit:function(e,n,i){var r=an(this.that).datum();a.call(e,this.that,new xr(e,{sourceEvent:n,target:l,selection:t.output(this.state.selection),mode:i,dispatch:a}),r)}},l.extent=function(t){return arguments.length?(n="function"==typeof t?t:yr(Pr(t)),l):n},l.filter=function(t){return arguments.length?(i="function"==typeof t?t:yr(!!t),l):i},l.touchable=function(t){return arguments.length?(r="function"==typeof t?t:yr(!!t),l):r},l.handleSize=function(t){return arguments.length?(s=+t,l):s},l.keyModifiers=function(t){return arguments.length?(o=!!t,l):o},l.on=function(){var t=a.on.apply(a,arguments);return t===a?l:t},l}var Qr=Math.abs,Jr=Math.cos,Kr=Math.sin,$r=Math.PI,to=$r/2,eo=2*$r,no=Math.max;function io(t,e){return Array.from({length:e-t},(e,n)=>t+n)}function ro(t){return function(e,n){return t(e.source.value+e.target.value,n.source.value+n.target.value)}}var oo=function(){return lo(!1,!1)};function ao(){return lo(!1,!0)}function so(){return lo(!0,!1)}function lo(t,e){var n=0,i=null,r=null,o=null;function a(a){var s,l=a.length,c=new Array(l),u=io(0,l),h=new Array(l*l),f=new Array(l),d=0;a=Float64Array.from({length:l*l},e?(t,e)=>a[e%l][e/l|0]:(t,e)=>a[e/l|0][e%l]);for(let e=0;e<l;++e){let n=0;for(let i=0;i<l;++i)n+=a[e*l+i]+t*a[i*l+e];d+=c[e]=n}s=(d=no(0,eo-n*l)/d)?n:eo/l;{let e=0;i&&u.sort((t,e)=>i(c[t],c[e]));for(const n of u){const i=e;if(t){const t=io(1+~l,l).filter(t=>t<0?a[~t*l+n]:a[n*l+t]);r&&t.sort((t,e)=>r(t<0?-a[~t*l+n]:a[n*l+t],e<0?-a[~e*l+n]:a[n*l+e]));for(const i of t)if(i<0){(h[~i*l+n]||(h[~i*l+n]={source:null,target:null})).target={index:n,startAngle:e,endAngle:e+=a[~i*l+n]*d,value:a[~i*l+n]}}else{(h[n*l+i]||(h[n*l+i]={source:null,target:null})).source={index:n,startAngle:e,endAngle:e+=a[n*l+i]*d,value:a[n*l+i]}}f[n]={index:n,startAngle:i,endAngle:e,value:c[n]}}else{const t=io(0,l).filter(t=>a[n*l+t]||a[t*l+n]);r&&t.sort((t,e)=>r(a[n*l+t],a[n*l+e]));for(const i of t){let t;if(n<i?(t=h[n*l+i]||(h[n*l+i]={source:null,target:null}),t.source={index:n,startAngle:e,endAngle:e+=a[n*l+i]*d,value:a[n*l+i]}):(t=h[i*l+n]||(h[i*l+n]={source:null,target:null}),t.target={index:n,startAngle:e,endAngle:e+=a[n*l+i]*d,value:a[n*l+i]},n===i&&(t.source=t.target)),t.source&&t.target&&t.source.value<t.target.value){const e=t.source;t.source=t.target,t.target=e}}f[n]={index:n,startAngle:i,endAngle:e,value:c[n]}}e+=s}}return(h=Object.values(h)).groups=f,o?h.sort(o):h}return a.padAngle=function(t){return arguments.length?(n=no(0,t),a):n},a.sortGroups=function(t){return arguments.length?(i=t,a):i},a.sortSubgroups=function(t){return arguments.length?(r=t,a):r},a.sortChords=function(t){return arguments.length?(null==t?o=null:(o=ro(t))._=t,a):o&&o._},a}var co=n(652),uo=Array.prototype.slice,ho=function(t){return function(){return t}};function fo(t){return t.source}function po(t){return t.target}function mo(t){return t.radius}function go(t){return t.startAngle}function vo(t){return t.endAngle}function yo(){return 0}function xo(){return 10}function bo(t){var e=fo,n=po,i=mo,r=mo,o=go,a=vo,s=yo,l=null;function c(){var c,u=e.apply(this,arguments),h=n.apply(this,arguments),f=s.apply(this,arguments)/2,d=uo.call(arguments),p=+i.apply(this,(d[0]=u,d)),m=o.apply(this,d)-to,g=a.apply(this,d)-to,v=+r.apply(this,(d[0]=h,d)),y=o.apply(this,d)-to,x=a.apply(this,d)-to;if(l||(l=c=Object(co.a)()),f>1e-12&&(Qr(g-m)>2*f+1e-12?g>m?(m+=f,g-=f):(m-=f,g+=f):m=g=(m+g)/2,Qr(x-y)>2*f+1e-12?x>y?(y+=f,x-=f):(y-=f,x+=f):y=x=(y+x)/2),l.moveTo(p*Jr(m),p*Kr(m)),l.arc(0,0,p,m,g),m!==y||g!==x)if(t){var b=+t.apply(this,arguments),w=v-b,_=(y+x)/2;l.quadraticCurveTo(0,0,w*Jr(y),w*Kr(y)),l.lineTo(v*Jr(_),v*Kr(_)),l.lineTo(w*Jr(x),w*Kr(x))}else l.quadraticCurveTo(0,0,v*Jr(y),v*Kr(y)),l.arc(0,0,v,y,x);if(l.quadraticCurveTo(0,0,p*Jr(m),p*Kr(m)),l.closePath(),c)return l=null,c+""||null}return t&&(c.headRadius=function(e){return arguments.length?(t="function"==typeof e?e:ho(+e),c):t}),c.radius=function(t){return arguments.length?(i=r="function"==typeof t?t:ho(+t),c):i},c.sourceRadius=function(t){return arguments.length?(i="function"==typeof t?t:ho(+t),c):i},c.targetRadius=function(t){return arguments.length?(r="function"==typeof t?t:ho(+t),c):r},c.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:ho(+t),c):o},c.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:ho(+t),c):a},c.padAngle=function(t){return arguments.length?(s="function"==typeof t?t:ho(+t),c):s},c.source=function(t){return arguments.length?(e=t,c):e},c.target=function(t){return arguments.length?(n=t,c):n},c.context=function(t){return arguments.length?(l=null==t?null:t,c):l},c}var wo=function(){return bo()};function _o(){return bo(xo)}var Mo=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function So(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function To(){}var Ao="\\s*([+-]?\\d+)\\s*",Eo="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",qo="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Co=/^#([0-9a-f]{3,8})$/,Po=new RegExp("^rgb\\("+[Ao,Ao,Ao]+"\\)$"),Ro=new RegExp("^rgb\\("+[qo,qo,qo]+"\\)$"),Lo=new RegExp("^rgba\\("+[Ao,Ao,Ao,Eo]+"\\)$"),Io=new RegExp("^rgba\\("+[qo,qo,qo,Eo]+"\\)$"),Do=new RegExp("^hsl\\("+[Eo,qo,qo]+"\\)$"),Oo=new RegExp("^hsla\\("+[Eo,qo,qo,Eo]+"\\)$"),No={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Fo(){return this.rgb().formatHex()}function Bo(){return this.rgb().formatRgb()}function zo(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Co.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Uo(e):3===n?new Go(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ko(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ko(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Po.exec(t))?new Go(e[1],e[2],e[3],1):(e=Ro.exec(t))?new Go(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Lo.exec(t))?ko(e[1],e[2],e[3],e[4]):(e=Io.exec(t))?ko(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Do.exec(t))?Yo(e[1],e[2]/100,e[3]/100,1):(e=Oo.exec(t))?Yo(e[1],e[2]/100,e[3]/100,e[4]):No.hasOwnProperty(t)?Uo(No[t]):"transparent"===t?new Go(NaN,NaN,NaN,0):null}function Uo(t){return new Go(t>>16&255,t>>8&255,255&t,1)}function ko(t,e,n,i){return i<=0&&(t=e=n=NaN),new Go(t,e,n,i)}function jo(t){return t instanceof To||(t=zo(t)),t?new Go((t=t.rgb()).r,t.g,t.b,t.opacity):new Go}function Vo(t,e,n,i){return 1===arguments.length?jo(t):new Go(t,e,n,null==i?1:i)}function Go(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ho(){return"#"+Xo(this.r)+Xo(this.g)+Xo(this.b)}function Wo(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Xo(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Yo(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Jo(t,e,n,i)}function Zo(t){if(t instanceof Jo)return new Jo(t.h,t.s,t.l,t.opacity);if(t instanceof To||(t=zo(t)),!t)return new Jo;if(t instanceof Jo)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),a=NaN,s=o-r,l=(o+r)/2;return s?(a=e===o?(n-i)/s+6*(n<i):n===o?(i-e)/s+2:(e-n)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new Jo(a,s,l,t.opacity)}function Qo(t,e,n,i){return 1===arguments.length?Zo(t):new Jo(t,e,n,null==i?1:i)}function Jo(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Ko(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Mo(To,zo,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Fo,formatHex:Fo,formatHsl:function(){return Zo(this).formatHsl()},formatRgb:Bo,toString:Bo}),Mo(Go,Vo,So(To,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Go(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Go(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ho,formatHex:Ho,formatRgb:Wo,toString:Wo})),Mo(Jo,Qo,So(To,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Jo(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Jo(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Go(Ko(t>=240?t-240:t+120,r,i),Ko(t,r,i),Ko(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const $o=Math.PI/180,ta=180/Math.PI;function ea(t){if(t instanceof ra)return new ra(t.l,t.a,t.b,t.opacity);if(t instanceof fa)return da(t);t instanceof Go||(t=jo(t));var e,n,i=la(t.r),r=la(t.g),o=la(t.b),a=oa((.2225045*i+.7168786*r+.0606169*o)/1);return i===r&&r===o?e=n=a:(e=oa((.4360747*i+.3850649*r+.1430804*o)/.96422),n=oa((.0139322*i+.0971045*r+.7141733*o)/.82521)),new ra(116*a-16,500*(e-a),200*(a-n),t.opacity)}function na(t,e){return new ra(t,0,0,null==e?1:e)}function ia(t,e,n,i){return 1===arguments.length?ea(t):new ra(t,e,n,null==i?1:i)}function ra(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function oa(t){return t>6/29*(6/29)*(6/29)?Math.pow(t,1/3):t/(6/29*3*(6/29))+4/29}function aa(t){return t>6/29?t*t*t:6/29*3*(6/29)*(t-4/29)}function sa(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function la(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ca(t){if(t instanceof fa)return new fa(t.h,t.c,t.l,t.opacity);if(t instanceof ra||(t=ea(t)),0===t.a&&0===t.b)return new fa(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*ta;return new fa(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function ua(t,e,n,i){return 1===arguments.length?ca(t):new fa(n,e,t,null==i?1:i)}function ha(t,e,n,i){return 1===arguments.length?ca(t):new fa(t,e,n,null==i?1:i)}function fa(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function da(t){if(isNaN(t.h))return new ra(t.l,0,0,t.opacity);var e=t.h*$o;return new ra(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}Mo(ra,ia,So(To,{brighter:function(t){return new ra(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new ra(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Go(sa(3.1338561*(e=.96422*aa(e))-1.6168667*(t=1*aa(t))-.4906146*(n=.82521*aa(n))),sa(-.9787684*e+1.9161415*t+.033454*n),sa(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Mo(fa,ha,So(To,{brighter:function(t){return new fa(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new fa(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return da(this).rgb()}}));var pa=-.29227,ma=-1.7884503806,ga=3.5172982438,va=-.6557636667999999;function ya(t){if(t instanceof ba)return new ba(t.h,t.s,t.l,t.opacity);t instanceof Go||(t=jo(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(va*i+ma*e-ga*n)/(va+ma-ga),o=i-r,a=(1.97294*(n-r)-pa*o)/-.90649,s=Math.sqrt(a*a+o*o)/(1.97294*r*(1-r)),l=s?Math.atan2(a,o)*ta-120:NaN;return new ba(l<0?l+360:l,s,r,t.opacity)}function xa(t,e,n,i){return 1===arguments.length?ya(t):new ba(t,e,n,null==i?1:i)}function ba(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Mo(ba,xa,So(To,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new ba(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new ba(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*$o,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new Go(255*(e+n*(-.14861*i+1.78277*r)),255*(e+n*(pa*i+-.90649*r)),255*(e+n*(1.97294*i)),this.opacity)}}));var wa=Array.prototype.slice,_a=function(t,e){return t-e},Ma=t=>()=>t,Sa=function(t,e){for(var n,i=-1,r=e.length;++i<r;)if(n=Ta(t,e[i]))return n;return 0};function Ta(t,e){for(var n=e[0],i=e[1],r=-1,o=0,a=t.length,s=a-1;o<a;s=o++){var l=t[o],c=l[0],u=l[1],h=t[s],f=h[0],d=h[1];if(Aa(l,h,e))return 0;u>i!=d>i&&n<(f-c)*(i-u)/(d-u)+c&&(r=-r)}return r}function Aa(t,e,n){var i,r,o,a;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(r=t[i=+(t[0]===e[0])],o=n[i],a=e[i],r<=o&&o<=a||a<=o&&o<=r)}var Ea=function(){},qa=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],Ca=function(){var t=1,e=1,n=j,i=s;function r(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(_a);else{var i=b(t),r=i[0],a=i[1];e=U(r,a,e),e=at(Math.floor(r/e)*e,Math.floor(a/e)*e,e)}return e.map((function(e){return o(t,e)}))}function o(n,r){var o=[],s=[];return function(n,i,r){var o,s,l,c,u,h,f=new Array,d=new Array;o=s=-1,c=n[0]>=i,qa[c<<1].forEach(p);for(;++o<t-1;)l=c,c=n[o+1]>=i,qa[l|c<<1].forEach(p);qa[c<<0].forEach(p);for(;++s<e-1;){for(o=-1,c=n[s*t+t]>=i,u=n[s*t]>=i,qa[c<<1|u<<2].forEach(p);++o<t-1;)l=c,c=n[s*t+t+o+1]>=i,h=u,u=n[s*t+o+1]>=i,qa[l|c<<1|u<<2|h<<3].forEach(p);qa[c|u<<3].forEach(p)}o=-1,u=n[s*t]>=i,qa[u<<2].forEach(p);for(;++o<t-1;)h=u,u=n[s*t+o+1]>=i,qa[u<<2|h<<3].forEach(p);function p(t){var e,n,i=[t[0][0]+o,t[0][1]+s],l=[t[1][0]+o,t[1][1]+s],c=a(i),u=a(l);(e=d[c])?(n=f[u])?(delete d[e.end],delete f[n.start],e===n?(e.ring.push(l),r(e.ring)):f[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(l),d[e.end=u]=e):(e=f[u])?(n=d[c])?(delete f[e.start],delete d[n.end],e===n?(e.ring.push(l),r(e.ring)):f[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete f[e.start],e.ring.unshift(i),f[e.start=c]=e):f[c]=d[u]={start:c,end:u,ring:[i,l]}}qa[u<<3].forEach(p)}(n,r,(function(t){i(t,n,r),function(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}(t)>0?o.push([t]):s.push(t)})),s.forEach((function(t){for(var e,n=0,i=o.length;n<i;++n)if(-1!==Sa((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:r,coordinates:o}}function a(e){return 2*e[0]+e[1]*(t+1)*4}function s(n,i,r){n.forEach((function(n){var o,a=n[0],s=n[1],l=0|a,c=0|s,u=i[c*t+l];a>0&&a<t&&l===a&&(o=i[c*t+l-1],n[0]=a+(r-o)/(u-o)-.5),s>0&&s<e&&c===s&&(o=i[(c-1)*t+l],n[1]=s+(r-o)/(u-o)-.5)}))}return r.contour=o,r.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),o=Math.floor(n[1]);if(!(i>=0&&o>=0))throw new Error("invalid size");return t=i,e=o,r},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?Ma(wa.call(t)):Ma(t),r):n},r.smooth=function(t){return arguments.length?(i=t?s:Ea,r):i===s},r};function Pa(t,e,n){for(var i=t.width,r=t.height,o=1+(n<<1),a=0;a<r;++a)for(var s=0,l=0;s<i+n;++s)s<i&&(l+=t.data[s+a*i]),s>=n&&(s>=o&&(l-=t.data[s-o+a*i]),e.data[s-n+a*i]=l/Math.min(s+1,i-1+o-s,o))}function Ra(t,e,n){for(var i=t.width,r=t.height,o=1+(n<<1),a=0;a<i;++a)for(var s=0,l=0;s<r+n;++s)s<r&&(l+=t.data[a+s*i]),s>=n&&(s>=o&&(l-=t.data[a+(s-o)*i]),e.data[a+(s-n)*i]=l/Math.min(s+1,r-1+o-s,o))}function La(t){return t[0]}function Ia(t){return t[1]}function Da(){return 1}var Oa=function(){var t=La,e=Ia,n=Da,i=960,r=500,o=20,a=2,s=3*o,l=i+2*s>>a,c=r+2*s>>a,u=Ma(20);function h(i){var r=new Float32Array(l*c),h=new Float32Array(l*c);i.forEach((function(i,o,u){var h=+t(i,o,u)+s>>a,f=+e(i,o,u)+s>>a,d=+n(i,o,u);h>=0&&h<l&&f>=0&&f<c&&(r[h+f*l]+=d)})),Pa({width:l,height:c,data:r},{width:l,height:c,data:h},o>>a),Ra({width:l,height:c,data:h},{width:l,height:c,data:r},o>>a),Pa({width:l,height:c,data:r},{width:l,height:c,data:h},o>>a),Ra({width:l,height:c,data:h},{width:l,height:c,data:r},o>>a),Pa({width:l,height:c,data:r},{width:l,height:c,data:h},o>>a),Ra({width:l,height:c,data:h},{width:l,height:c,data:r},o>>a);var d=u(r);if(!Array.isArray(d)){var p=G(r);d=U(0,p,d),(d=at(0,Math.floor(p/d)*d,d)).shift()}return Ca().thresholds(d).size([l,c])(r).map(f)}function f(t){return t.value*=Math.pow(2,-2*a),t.coordinates.forEach(d),t}function d(t){t.forEach(p)}function p(t){t.forEach(m)}function m(t){t[0]=t[0]*Math.pow(2,a)-s,t[1]=t[1]*Math.pow(2,a)-s}function g(){return l=i+2*(s=3*o)>>a,c=r+2*s>>a,h}return h.x=function(e){return arguments.length?(t="function"==typeof e?e:Ma(+e),h):t},h.y=function(t){return arguments.length?(e="function"==typeof t?t:Ma(+t),h):e},h.weight=function(t){return arguments.length?(n="function"==typeof t?t:Ma(+t),h):n},h.size=function(t){if(!arguments.length)return[i,r];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))throw new Error("invalid size");return i=e,r=n,g()},h.cellSize=function(t){if(!arguments.length)return 1<<a;if(!((t=+t)>=1))throw new Error("invalid cell size");return a=Math.floor(Math.log(t)/Math.LN2),g()},h.thresholds=function(t){return arguments.length?(u="function"==typeof t?t:Array.isArray(t)?Ma(wa.call(t)):Ma(t),h):u},h.bandwidth=function(t){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*t*t+1)-1)/2),g()},h};const Na=Math.pow(2,-52),Fa=new Uint32Array(512);class Ba{static from(t,e=Wa,n=Xa){const i=t.length,r=new Float64Array(2*i);for(let o=0;o<i;o++){const i=t[o];r[2*o]=e(i),r[2*o+1]=n(i)}return new Ba(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:r}=this,o=t.length>>1;let a=1/0,s=1/0,l=-1/0,c=-1/0;for(let e=0;e<o;e++){const n=t[2*e],i=t[2*e+1];n<a&&(a=n),i<s&&(s=i),n>l&&(l=n),i>c&&(c=i),this._ids[e]=e}const u=(a+l)/2,h=(s+c)/2;let f,d,p,m=1/0;for(let e=0;e<o;e++){const n=za(u,h,t[2*e],t[2*e+1]);n<m&&(f=e,m=n)}const g=t[2*f],v=t[2*f+1];m=1/0;for(let e=0;e<o;e++){if(e===f)continue;const n=za(g,v,t[2*e],t[2*e+1]);n<m&&n>0&&(d=e,m=n)}let y=t[2*d],x=t[2*d+1],b=1/0;for(let e=0;e<o;e++){if(e===f||e===d)continue;const n=Va(g,v,y,x,t[2*e],t[2*e+1]);n<b&&(p=e,b=n)}let w=t[2*p],_=t[2*p+1];if(b===1/0){for(let e=0;e<o;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];Ga(this._ids,this._dists,0,o-1);const e=new Uint32Array(o);let n=0;for(let t=0,i=-1/0;t<o;t++){const r=this._ids[t];this._dists[r]>i&&(e[n++]=r,i=this._dists[r])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(ka(g,v,y,x,w,_)){const t=d,e=y,n=x;d=p,y=w,x=_,p=t,w=e,_=n}const M=function(t,e,n,i,r,o){const a=n-t,s=i-e,l=r-t,c=o-e,u=a*a+s*s,h=l*l+c*c,f=.5/(a*c-s*l);return{x:t+(c*u-s*h)*f,y:e+(a*h-l*u)*f}}(g,v,y,x,w,_);this._cx=M.x,this._cy=M.y;for(let e=0;e<o;e++)this._dists[e]=za(t[2*e],t[2*e+1],M.x,M.y);Ga(this._ids,this._dists,0,o-1),this._hullStart=f;let S=3;n[f]=e[p]=d,n[d]=e[f]=p,n[p]=e[d]=f,i[f]=0,i[d]=1,i[p]=2,r.fill(-1),r[this._hashKey(g,v)]=f,r[this._hashKey(y,x)]=d,r[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(f,d,p,-1,-1,-1);for(let o,a,s=0;s<this._ids.length;s++){const l=this._ids[s],c=t[2*l],u=t[2*l+1];if(s>0&&Math.abs(c-o)<=Na&&Math.abs(u-a)<=Na)continue;if(o=c,a=u,l===f||l===d||l===p)continue;let h=0;for(let t=0,e=this._hashKey(c,u);t<this._hashSize&&(h=r[(e+t)%this._hashSize],-1===h||h===n[h]);t++);h=e[h];let m,g=h;for(;m=n[g],!ka(c,u,t[2*g],t[2*g+1],t[2*m],t[2*m+1]);)if(g=m,g===h){g=-1;break}if(-1===g)continue;let v=this._addTriangle(g,l,n[g],-1,-1,i[g]);i[l]=this._legalize(v+2),i[g]=v,S++;let y=n[g];for(;m=n[y],ka(c,u,t[2*y],t[2*y+1],t[2*m],t[2*m+1]);)v=this._addTriangle(y,l,m,i[l],-1,i[y]),i[l]=this._legalize(v+2),n[y]=y,S--,y=m;if(g===h)for(;m=e[g],ka(c,u,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)v=this._addTriangle(m,l,g,-1,i[g],i[m]),this._legalize(v+2),i[m]=v,n[g]=g,S--,g=m;this._hullStart=e[l]=g,n[g]=e[y]=l,n[l]=y,r[this._hashKey(c,u)]=l,r[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let r=0,o=0;for(;;){const a=n[t],s=t-t%3;if(o=s+(t+2)%3,-1===a){if(0===r)break;t=Fa[--r];continue}const l=a-a%3,c=s+(t+1)%3,u=l+(a+2)%3,h=e[o],f=e[t],d=e[c],p=e[u];if(ja(i[2*h],i[2*h+1],i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1])){e[t]=p,e[a]=h;const i=n[u];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===u){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(a,n[o]),this._link(o,u);const s=l+(a+1)%3;r<Fa.length&&(Fa[r++]=s)}else{if(0===r)break;t=Fa[--r]}}return o}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,r,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}}function za(t,e,n,i){const r=t-n,o=e-i;return r*r+o*o}function Ua(t,e,n,i,r,o){const a=(i-e)*(r-t),s=(n-t)*(o-e);return Math.abs(a-s)>=33306690738754716e-32*Math.abs(a+s)?a-s:0}function ka(t,e,n,i,r,o){return(Ua(r,o,t,e,n,i)||Ua(t,e,n,i,r,o)||Ua(n,i,r,o,t,e))<0}function ja(t,e,n,i,r,o,a,s){const l=t-a,c=e-s,u=n-a,h=i-s,f=r-a,d=o-s,p=u*u+h*h,m=f*f+d*d;return l*(h*m-p*d)-c*(u*m-p*f)+(l*l+c*c)*(u*d-h*f)<0}function Va(t,e,n,i,r,o){const a=n-t,s=i-e,l=r-t,c=o-e,u=a*a+s*s,h=l*l+c*c,f=.5/(a*c-s*l),d=(c*u-s*h)*f,p=(a*h-l*u)*f;return d*d+p*p}function Ga(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=t[r],o=e[i];let a=r-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=i}else{let r=n+1,o=i;Ha(t,n+i>>1,r),e[t[n]]>e[t[i]]&&Ha(t,n,i),e[t[r]]>e[t[i]]&&Ha(t,r,i),e[t[n]]>e[t[r]]&&Ha(t,n,r);const a=t[r],s=e[a];for(;;){do{r++}while(e[t[r]]<s);do{o--}while(e[t[o]]>s);if(o<r)break;Ha(t,r,o)}t[n+1]=t[o],t[o]=a,i-r+1>=o-n?(Ga(t,e,r,i),Ga(t,e,n,o-1)):(Ga(t,e,n,o-1),Ga(t,e,r,i))}}function Ha(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Wa(t){return t[0]}function Xa(t){return t[1]}class Ya{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const i=(t=+t)+(n=+n),r=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>1e-6||Math.abs(this._y1-r)>1e-6)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class Za{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Qa{constructor(t,[e,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(e=+e)&&(r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,i,o=0,a=0,s=n.length;o<s;o+=3,a+=2){const s=2*n[o],l=2*n[o+1],c=2*n[o+2],u=t[s],h=t[s+1],f=t[l],d=t[l+1],p=t[c],m=t[c+1],g=f-u,v=d-h,y=p-u,x=m-h,b=g*g+v*v,w=y*y+x*x,_=2*(g*x-v*y);if(_)if(Math.abs(_)<1e-8)e=(u+p)/2,i=(h+m)/2;else{const t=1/_;e=u+(x*b-v*w)*t,i=h+(g*w-y*b)*t}else e=(u+p)/2-1e8*x,i=(h+m)/2+1e8*y;r[a]=e,r[a+1]=i}let o,a,s,l=e[e.length-1],c=4*l,u=t[2*l],h=t[2*l+1];i.fill(0);for(let n=0;n<e.length;++n)l=e[n],o=c,a=u,s=h,c=4*l,u=t[2*l],h=t[2*l+1],i[o+2]=i[c]=s-h,i[o+3]=i[c+1]=u-a}render(t){const e=null==t?t=new Ya:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:o,vectors:a}=this;if(r.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const r=2*Math.floor(e/3),a=2*Math.floor(i/3),s=o[r],l=o[r+1],c=o[a],u=o[a+1];this._renderSegment(s,l,c,u,t)}let s,l=r[r.length-1];for(let e=0;e<r.length;++e){s=l,l=r[e];const n=2*Math.floor(i[l]/3),c=o[n],u=o[n+1],h=4*s,f=this._project(c,u,a[h+2],a[h+3]);f&&this._renderSegment(c,u,f[0],f[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new Ya:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new Ya:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let t=2;t<r;t+=2)i[t]===i[t-2]&&i[t+1]===i[t-1]||e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new Za;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,r){let o;const a=this._regioncode(t,e),s=this._regioncode(n,i);0===a&&0===s?(r.moveTo(t,e),r.lineTo(n,i)):(o=this._clipSegment(t,e,n,i,a,s))&&(r.moveTo(o[0],o[1]),r.lineTo(o[2],o[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,r=e.length;i<r;i+=2)for(let o=0,a=t.length;o<a;o+=2)if(e[i]==t[o]&&e[i+1]==t[o+1]&&e[(i+2)%r]==t[(o+a-2)%a]&&e[(i+3)%r]==t[(o+a-1)%a]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,o=n[t];if(-1===o)return null;const a=[];let s=o;do{const n=Math.floor(s/3);if(a.push(e[2*n],e[2*n+1]),s=s%3==2?s-2:s+1,r[s]!==t)break;s=i[s]}while(s!==o&&-1!==s);return a}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,i=4*t;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i,r,o,a,s,l=null,c=e[n-2],u=e[n-1],h=this._regioncode(c,u);for(let f=0;f<n;f+=2)if(i=c,r=u,c=e[f],u=e[f+1],o=h,h=this._regioncode(c,u),0===o&&0===h)a=s,s=0,l?l.push(c,u):l=[c,u];else{let e,n,f,d,p;if(0===o){if(null===(e=this._clipSegment(i,r,c,u,o,h)))continue;[n,f,d,p]=e}else{if(null===(e=this._clipSegment(c,u,i,r,h,o)))continue;[d,p,n,f]=e,a=s,s=this._edgecode(n,f),a&&s&&this._edge(t,a,s,l,l.length),l?l.push(n,f):l=[n,f]}a=s,s=this._edgecode(d,p),a&&s&&this._edge(t,a,s,l,l.length),l?l.push(d,p):l=[d,p]}if(l)a=s,s=this._edgecode(l[0],l[1]),a&&s&&this._edge(t,a,s,l,l.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(t,e,n,i,r,o){for(;;){if(0===r&&0===o)return[t,e,n,i];if(r&o)return null;let a,s,l=r||o;8&l?(a=t+(n-t)*(this.ymax-e)/(i-e),s=this.ymax):4&l?(a=t+(n-t)*(this.ymin-e)/(i-e),s=this.ymin):2&l?(s=e+(i-e)*(this.xmax-t)/(n-t),a=this.xmax):(s=e+(i-e)*(this.xmin-t)/(n-t),a=this.xmin),r?(t=a,e=s,r=this._regioncode(t,e)):(n=a,i=s,o=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,r,o){let a,s=Array.from(e);if((a=this._project(s[0],s[1],n,i))&&s.unshift(a[0],a[1]),(a=this._project(s[s.length-2],s[s.length-1],r,o))&&s.push(a[0],a[1]),s=this._clipFinite(t,s))for(let e,n=0,i=s.length,r=this._edgecode(s[i-2],s[i-1]);n<i;n+=2)e=r,r=this._edgecode(s[n],s[n+1]),e&&r&&(n=this._edge(t,e,r,s,n),i=s.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(t,e,n,i,r){for(;e!==n;){let n,o;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,o=this.ymin}i[r]===n&&i[r+1]===o||!this.contains(t,n,o)||(i.splice(r,0,n,o),r+=2)}if(i.length>4)for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])&&(i.splice(e,2),t-=2)}return r}_project(t,e,n,i){let r,o,a,s=1/0;if(i<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/i)<s&&(a=this.ymin,o=t+(s=r)*n)}else if(i>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/i)<s&&(a=this.ymax,o=t+(s=r)*n)}if(n>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/n)<s&&(o=this.xmax,a=e+(s=r)*i)}else if(n<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/n)<s&&(o=this.xmin,a=e+(s=r)*i)}return[o,a]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const Ja=2*Math.PI,Ka=Math.pow;function $a(t){return t[0]}function ts(t){return t[1]}function es(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class ns{static from(t,e=$a,n=ts,i){return new ns("length"in t?function(t,e,n,i){const r=t.length,o=new Float64Array(2*r);for(let a=0;a<r;++a){const r=t[a];o[2*a]=e.call(i,r,a,t),o[2*a+1]=n.call(i,r,a,t)}return o}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let r=0;for(const o of t)yield e.call(i,o,r,t),yield n.call(i,o,r,t),++r}(t,e,n,i)))}constructor(t){this._delaunator=new Ba(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const i=2*e[t],r=2*e[t+1],o=2*e[t+2];if((n[o]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},(t,e)=>e).sort((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]);const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],r=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let t=0,n=e.length/2;t<n;++t){const n=es(e[2*t],e[2*t+1],r);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new Ba(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=r[t%3==2?t-2:t+1];-1!==n[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=i.length;t<e;++t)a[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,2===i.length&&(o[i[1]]=0))}voronoi(t){return new Qa(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:r,triangles:o,collinear:a}=this;if(a){const e=a.indexOf(t);return e>0&&(yield a[e-1]),void(e<a.length-1&&(yield a[e+1]))}const s=e[t];if(-1===s)return;let l=s,c=-1;do{if(yield c=o[l],l=l%3==2?l-2:l+1,o[l]!==t)return;if(l=r[l],-1===l){const e=n[(i[t]+1)%n.length];return void(e!==c&&(yield e))}}while(l!==s)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const i=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==i;)n=r;return r}_step(t,e,n){const{inedges:i,hull:r,_hullIndex:o,halfedges:a,triangles:s,points:l}=this;if(-1===i[t]||!l.length)return(t+1)%(l.length>>1);let c=t,u=Ka(e-l[2*t],2)+Ka(n-l[2*t+1],2);const h=i[t];let f=h;do{let i=s[f];const h=Ka(e-l[2*i],2)+Ka(n-l[2*i+1],2);if(h<u&&(u=h,c=i),f=f%3==2?f-2:f+1,s[f]!==t)break;if(f=a[f],-1===f){if(f=r[(o[t]+1)%r.length],f!==i&&Ka(e-l[2*f],2)+Ka(n-l[2*f+1],2)<u)return f;break}}while(f!==h);return c}render(t){const e=null==t?t=new Ya:void 0,{points:n,halfedges:i,triangles:r}=this;for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o<e)continue;const a=2*r[e],s=2*r[o];t.moveTo(n[a],n[a+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new Ya:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){const r=i[n],o=i[n+1];t.moveTo(r+e,o),t.arc(r,o,e,0,Ja)}return n&&n.value()}renderHull(t){const e=null==t?t=new Ya:void 0,{hull:n,points:i}=this,r=2*n[0],o=n.length;t.moveTo(i[r],i[r+1]);for(let e=1;e<o;++e){const r=2*n[e];t.lineTo(i[r],i[r+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new Za;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new Ya:void 0,{points:i,triangles:r}=this,o=2*r[t*=3],a=2*r[t+1],s=2*r[t+2];return e.moveTo(i[o],i[o+1]),e.lineTo(i[a],i[a+1]),e.lineTo(i[s],i[s+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new Za;return this.renderTriangle(t,e),e.value()}}var is={value:()=>{}};function rs(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new os(i)}function os(t){this._=t}function as(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function ss(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function ls(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=is,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}os.prototype=rs.prototype={constructor:os,on:function(t,e){var n,i=this._,r=as(t+"",i),o=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=r[o]).type)i[n]=ls(i[n],t.name,e);else if(null==e)for(n in i)i[n]=ls(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=r[o]).type)&&(n=ss(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new os(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(i=this._[t]).length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};var cs=rs;function us(){}var hs=function(t){return null==t?us:function(){return this.querySelector(t)}},fs=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)};function ds(){return[]}var ps=function(t){return null==t?ds:function(){return this.querySelectorAll(t)}};var ms=function(t){return function(){return this.matches(t)}};function gs(t){return function(e){return e.matches(t)}}var vs=Array.prototype.find;function ys(){return this.firstElementChild}var xs=Array.prototype.filter;function bs(){return this.children}var ws=function(t){return new Array(t.length)};function _s(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_s.prototype={constructor:_s,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Ms=function(t){return function(){return t}};function Ss(t,e,n,i,r,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new _s(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function Ts(t,e,n,i,r,o,a){var s,l,c,u=new Map,h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(d[s]=c=a.call(l,l.__data__,s,e)+"",u.has(c)?r[s]=l:u.set(c,l));for(s=0;s<f;++s)c=a.call(t,o[s],s,o)+"",(l=u.get(c))?(i[s]=l,l.__data__=o[s],u.delete(c)):n[s]=new _s(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&u.get(d[s])===l&&(r[s]=l)}function As(t){return t.__data__}function Es(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var qs={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Cs=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),qs.hasOwnProperty(e)?{space:qs[e],local:t}:t};function Ps(t){return function(){this.removeAttribute(t)}}function Rs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ls(t,e){return function(){this.setAttribute(t,e)}}function Is(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ds(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Os(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var Ns=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function Fs(t){return function(){this.style.removeProperty(t)}}function Bs(t,e,n){return function(){this.style.setProperty(t,e,n)}}function zs(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Us(t,e){return t.style.getPropertyValue(e)||Ns(t).getComputedStyle(t,null).getPropertyValue(e)}function ks(t){return function(){delete this[t]}}function js(t,e){return function(){this[t]=e}}function Vs(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Gs(t){return t.trim().split(/^|\s+/)}function Hs(t){return t.classList||new Ws(t)}function Ws(t){this._node=t,this._names=Gs(t.getAttribute("class")||"")}function Xs(t,e){for(var n=Hs(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Ys(t,e){for(var n=Hs(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Zs(t){return function(){Xs(this,t)}}function Qs(t){return function(){Ys(this,t)}}function Js(t,e){return function(){(e.apply(this,arguments)?Xs:Ys)(this,t)}}Ws.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ks(){this.textContent=""}function $s(t){return function(){this.textContent=t}}function tl(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function el(){this.innerHTML=""}function nl(t){return function(){this.innerHTML=t}}function il(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function rl(){this.nextSibling&&this.parentNode.appendChild(this)}function ol(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function al(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return"http://www.w3.org/1999/xhtml"===n&&"http://www.w3.org/1999/xhtml"===e.documentElement.namespaceURI?e.createElement(t):e.createElementNS(n,t)}}function sl(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var ll=function(t){var e=Cs(t);return(e.local?sl:al)(e)};function cl(){return null}function ul(){var t=this.parentNode;t&&t.removeChild(this)}function hl(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fl(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dl(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function pl(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function ml(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function gl(t,e,n){var i=Ns(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function vl(t,e){return function(){return gl(this,t,e)}}function yl(t,e){return function(){return gl(this,t,e.apply(this,arguments))}}var xl=[null];function bl(t,e){this._groups=t,this._parents=e}function wl(){return new bl([[document.documentElement]],xl)}bl.prototype=wl.prototype={constructor:bl,select:function(t){"function"!=typeof t&&(t=hs(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=s[u])&&(a=t.call(o,o.__data__,u,s))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new bl(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:fs(e)}}(t):ps(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(i.push(t.call(a,a.__data__,c,s)),r.push(a));return new bl(i,r)},selectChild:function(t){return this.select(null==t?ys:function(t){return function(){return vs.call(this.children,t)}}("function"==typeof t?t:gs(t)))},selectChildren:function(t){return this.selectAll(null==t?bs:function(t){return function(){return xs.call(this.children,t)}}("function"==typeof t?t:gs(t)))},filter:function(t){"function"!=typeof t&&(t=ms(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new bl(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,As);var n=e?Ts:Ss,i=this._parents,r=this._groups;"function"!=typeof t&&(t=Ms(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],h=r[c],f=h.length,d=fs(t.call(u,u&&u.__data__,c,i)),p=d.length,m=s[c]=new Array(p),g=a[c]=new Array(p),v=l[c]=new Array(f);n(u,h,m,g,v,d,e);for(var y,x,b=0,w=0;b<p;++b)if(y=m[b]){for(b>=w&&(w=b+1);!(x=g[w])&&++w<p;);y._next=x||null}}return(a=new bl(a,i))._enter=s,a._exit=l,a},enter:function(){return new bl(this._enter||this._groups.map(ws),this._parents)},exit:function(){return new bl(this._exit||this._groups.map(ws),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){if(!(t instanceof bl))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new bl(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Es);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,c=r[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new bl(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=Cs(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Rs:Ps:"function"==typeof e?n.local?Os:Ds:n.local?Is:Ls)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Fs:"function"==typeof e?zs:Bs)(t,e,null==n?"":n)):Us(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?ks:"function"==typeof e?Vs:js)(t,e)):this.node()[t]},classed:function(t,e){var n=Gs(t+"");if(arguments.length<2){for(var i=Hs(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Js:e?Zs:Qs)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ks:("function"==typeof t?tl:$s)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?el:("function"==typeof t?il:nl)(t)):this.node().innerHTML},raise:function(){return this.each(rl)},lower:function(){return this.each(ol)},append:function(t){var e="function"==typeof t?t:ll(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:ll(t),i=null==e?cl:"function"==typeof e?e:hs(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(ul)},clone:function(t){return this.select(t?fl:hl)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=dl(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?ml:pl,i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(i=0,l=s[c];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?yl:vl)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,a=r.length;o<a;++o)(i=r[o])&&(yield i)}};var _l=wl,Ml=function(t){return"string"==typeof t?new bl([[document.querySelector(t)]],[document.documentElement]):new bl([[t]],xl)},Sl=function(t){let e;for(;e=t.sourceEvent;)t=e;return t},Tl=function(t,e){if(t=Sl(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]};function Al(t){t.stopImmediatePropagation()}var El=function(t){t.preventDefault(),t.stopImmediatePropagation()},ql=function(t){var e=t.document.documentElement,n=Ml(t).on("dragstart.drag",El,!0);"onselectstart"in e?n.on("selectstart.drag",El,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function Cl(t,e){var n=t.document.documentElement,i=Ml(t).on("dragstart.drag",null);e&&(i.on("click.drag",El,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Pl=t=>()=>t;function Rl(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:o,x:a,y:s,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function Ll(t){return!t.ctrlKey&&!t.button}function Il(){return this.parentNode}function Dl(t,e){return null==e?{x:t.x,y:t.y}:e}function Ol(){return navigator.maxTouchPoints||"ontouchstart"in this}Rl.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Nl=function(){var t,e,n,i,r=Ll,o=Il,a=Dl,s=Ol,l={},c=cs("start","drag","end"),u=0,h=0;function f(t){t.on("mousedown.drag",d).filter(s).on("touchstart.drag",g).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(a,s){if(!i&&r.call(this,a,s)){var l=x(this,o.call(this,a,s),a,s,"mouse");l&&(Ml(a.view).on("mousemove.drag",p,!0).on("mouseup.drag",m,!0),ql(a.view),Al(a),n=!1,t=a.clientX,e=a.clientY,l("start",a))}}function p(i){if(El(i),!n){var r=i.clientX-t,o=i.clientY-e;n=r*r+o*o>h}l.mouse("drag",i)}function m(t){Ml(t.view).on("mousemove.drag mouseup.drag",null),Cl(t.view,n),El(t),l.mouse("end",t)}function g(t,e){if(r.call(this,t,e)){var n,i,a=t.changedTouches,s=o.call(this,t,e),l=a.length;for(n=0;n<l;++n)(i=x(this,s,t,e,a[n].identifier,a[n]))&&(Al(t),i("start",t,a[n]))}}function v(t){var e,n,i=t.changedTouches,r=i.length;for(e=0;e<r;++e)(n=l[i[e].identifier])&&(El(t),n("drag",t,i[e]))}function y(t){var e,n,r=t.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),e=0;e<o;++e)(n=l[r[e].identifier])&&(Al(t),n("end",t,r[e]))}function x(t,e,n,i,r,o){var s,h,d,p=c.copy(),m=Tl(o||n,e);if(null!=(d=a.call(t,new Rl("beforestart",{sourceEvent:n,target:f,identifier:r,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:p}),i)))return s=d.x-m[0]||0,h=d.y-m[1]||0,function n(o,a,c){var g,v=m;switch(o){case"start":l[r]=n,g=u++;break;case"end":delete l[r],--u;case"drag":m=Tl(c||a,e),g=u}p.call(o,t,new Rl(o,{sourceEvent:a,subject:d,target:f,identifier:r,active:g,x:m[0]+s,y:m[1]+h,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:p}),i)}}return f.filter=function(t){return arguments.length?(r="function"==typeof t?t:Pl(!!t),f):r},f.container=function(t){return arguments.length?(o="function"==typeof t?t:Pl(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:Pl(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Pl(!!t),f):s},f.on=function(){var t=c.on.apply(c,arguments);return t===c?f:t},f.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,f):Math.sqrt(h)},f},Fl={},Bl={};function zl(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Ul(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var i in t)i in e||n.push(e[i]=i)})),n}function kl(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function jl(t){var e,n=t.getUTCHours(),i=t.getUTCMinutes(),r=t.getUTCSeconds(),o=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+kl(-e,6):e>9999?"+"+kl(e,6):kl(e,4))+"-"+kl(t.getUTCMonth()+1,2)+"-"+kl(t.getUTCDate(),2)+(o?"T"+kl(n,2)+":"+kl(i,2)+":"+kl(r,2)+"."+kl(o,3)+"Z":r?"T"+kl(n,2)+":"+kl(i,2)+":"+kl(r,2)+"Z":i||n?"T"+kl(n,2)+":"+kl(i,2)+"Z":"")}var Vl=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function i(t,e){var i,r=[],o=t.length,a=0,s=0,l=o<=0,c=!1;function u(){if(l)return Bl;if(c)return c=!1,Fl;var e,i,r=a;if(34===t.charCodeAt(r)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?l=!0:10===(i=t.charCodeAt(a++))?c=!0:13===i&&(c=!0,10===t.charCodeAt(a)&&++a),t.slice(r+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(i=t.charCodeAt(e=a++)))c=!0;else if(13===i)c=!0,10===t.charCodeAt(a)&&++a;else if(i!==n)continue;return t.slice(r,e)}return l=!0,t.slice(r,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(i=u())!==Bl;){for(var h=[];i!==Fl&&i!==Bl;)h.push(i),i=u();e&&null==(h=e(h,s++))||r.push(h)}return r}function r(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?jl(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,r,o=i(t,(function(t,i){if(n)return n(t,i-1);r=t,n=e?function(t,e){var n=zl(t);return function(i,r){return e(n(i),r,t)}}(t,e):zl(t)}));return o.columns=r||[],o},parseRows:i,format:function(e,n){return null==n&&(n=Ul(e)),[n.map(a).join(t)].concat(r(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=Ul(t)),r(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}},Gl=Vl(","),Hl=Gl.parse,Wl=Gl.parseRows,Xl=Gl.format,Yl=Gl.formatBody,Zl=Gl.formatRows,Ql=Gl.formatRow,Jl=Gl.formatValue,Kl=Vl("\t"),$l=Kl.parse,tc=Kl.parseRows,ec=Kl.format,nc=Kl.formatBody,ic=Kl.formatRows,rc=Kl.formatRow,oc=Kl.formatValue;function ac(t){for(var e in t){var n,i,r=t[e].trim();if(r)if("true"===r)r=!0;else if("false"===r)r=!1;else if("NaN"===r)r=NaN;else if(isNaN(n=+r)){if(!(i=r.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;sc&&i[4]&&!i[7]&&(r=r.replace(/-/g,"/").replace(/T/," ")),r=new Date(r)}else r=n;else r=null;t[e]=r}return t}const sc=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours(),lc=t=>+t;function cc(t){return t*t}function uc(t){return t*(2-t)}function hc(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function fc(t){return t*t*t}function dc(t){return--t*t*t+1}function pc(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var mc=function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n}(3),gc=function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),vc=function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),yc=Math.PI,xc=yc/2;function bc(t){return 1==+t?1:1-Math.cos(t*xc)}function wc(t){return Math.sin(t*xc)}function _c(t){return(1-Math.cos(yc*t))/2}function Mc(t){return 1.0009775171065494*(Math.pow(2,-10*t)-.0009765625)}function Sc(t){return Mc(1-+t)}function Tc(t){return 1-Mc(t)}function Ac(t){return((t*=2)<=1?Mc(1-t):2-Mc(t-1))/2}function Ec(t){return 1-Math.sqrt(1-t*t)}function qc(t){return Math.sqrt(1- --t*t)}function Cc(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}function Pc(t){return 1-Rc(1-t)}function Rc(t){return(t=+t)<4/11?7.5625*t*t:t<8/11?7.5625*(t-=6/11)*t+.75:t<10/11?7.5625*(t-=9/11)*t+.9375:7.5625*(t-=21/22)*t+63/64}function Lc(t){return((t*=2)<=1?1-Rc(1-t):Rc(t-1)+1)/2}var Ic=function t(e){function n(t){return(t=+t)*t*(e*(t-1)+t)}return e=+e,n.overshoot=t,n}(1.70158),Dc=function t(e){function n(t){return--t*t*((t+1)*e+t)+1}return e=+e,n.overshoot=t,n}(1.70158),Oc=function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(1.70158),Nc=2*Math.PI,Fc=function t(e,n){var i=Math.asin(1/(e=Math.max(1,e)))*(n/=Nc);function r(t){return e*Mc(- --t)*Math.sin((i-t)/n)}return r.amplitude=function(e){return t(e,n*Nc)},r.period=function(n){return t(e,n)},r}(1,.3),Bc=function t(e,n){var i=Math.asin(1/(e=Math.max(1,e)))*(n/=Nc);function r(t){return 1-e*Mc(t=+t)*Math.sin((t+i)/n)}return r.amplitude=function(e){return t(e,n*Nc)},r.period=function(n){return t(e,n)},r}(1,.3),zc=function t(e,n){var i=Math.asin(1/(e=Math.max(1,e)))*(n/=Nc);function r(t){return((t=2*t-1)<0?e*Mc(-t)*Math.sin((i-t)/n):2-e*Mc(t)*Math.sin((i+t)/n))/2}return r.amplitude=function(e){return t(e,n*Nc)},r.period=function(n){return t(e,n)},r}(1,.3);function Uc(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.blob()}var kc=function(t,e){return fetch(t,e).then(Uc)};function jc(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.arrayBuffer()}var Vc=function(t,e){return fetch(t,e).then(jc)};function Gc(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}var Hc=function(t,e){return fetch(t,e).then(Gc)};function Wc(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=void 0),Hc(e,n).then((function(e){return t(e,i)}))}}function Xc(t,e,n,i){3===arguments.length&&"function"==typeof n&&(i=n,n=void 0);var r=Vl(t);return Hc(e,n).then((function(t){return r.parse(t,i)}))}var Yc=Wc(Hl),Zc=Wc($l),Qc=function(t,e){return new Promise((function(n,i){var r=new Image;for(var o in e)r[o]=e[o];r.onerror=i,r.onload=function(){n(r)},r.src=t}))};function Jc(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}var Kc=function(t,e){return fetch(t,e).then(Jc)};function $c(t){return(e,n)=>Hc(e,n).then(e=>(new DOMParser).parseFromString(e,t))}var tu=$c("application/xml"),eu=$c("text/html"),nu=$c("image/svg+xml"),iu=function(t,e){var n,i=1;function r(){var r,o,a=n.length,s=0,l=0;for(r=0;r<a;++r)s+=(o=n[r]).x,l+=o.y;for(s=(s/a-t)*i,l=(l/a-e)*i,r=0;r<a;++r)(o=n[r]).x-=s,o.y-=l}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r};function ru(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,o,a,s,l,c,u,h,f,d=t._root,p={data:i},m=t._x0,g=t._y0,v=t._x1,y=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((c=e>=(o=(m+v)/2))?m=o:v=o,(u=n>=(a=(g+y)/2))?g=a:y=a,r=d,!(d=d[h=u<<1|c]))return r[h]=p,t;if(s=+t._x.call(null,d.data),l=+t._y.call(null,d.data),e===s&&n===l)return p.next=d,r?r[h]=p:t._root=p,t;do{r=r?r[h]=new Array(4):t._root=new Array(4),(c=e>=(o=(m+v)/2))?m=o:v=o,(u=n>=(a=(g+y)/2))?g=a:y=a}while((h=u<<1|c)==(f=(l>=a)<<1|s>=o));return r[f]=d,r[h]=p,t}var ou=function(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r};function au(t){return t[0]}function su(t){return t[1]}function lu(t,e,n){var i=new cu(null==e?au:e,null==n?su:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function cu(t,e,n,i,r,o){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function uu(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var hu=lu.prototype=cu.prototype;hu.copy=function(){var t,e,n=new cu(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=uu(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=uu(e));return n},hu.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return ru(this.cover(e,n),e,n,t)},hu.addAll=function(t){var e,n,i,r,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(a[n]=i,s[n]=r,i<l&&(l=i),i>u&&(u=i),r<c&&(c=r),r>h&&(h=r));if(l>u||c>h)return this;for(this.cover(l,c).cover(u,h),n=0;n<o;++n)ru(this,a[n],s[n],t[n]);return this},hu.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var a,s,l=r-n||1,c=this._root;n>t||t>=r||i>e||e>=o;)switch(s=(e<i)<<1|t<n,(a=new Array(4))[s]=c,c=a,l*=2,s){case 0:r=n+l,o=i+l;break;case 1:n=r-l,o=i+l;break;case 2:r=n+l,i=o-l;break;case 3:n=r-l,i=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this},hu.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},hu.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},hu.find=function(t,e,n){var i,r,o,a,s,l,c,u=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],m=this._root;for(m&&p.push(new ou(m,u,h,f,d)),null==n?n=1/0:(u=t-n,h=e-n,f=t+n,d=e+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(r=l.x0)>f||(o=l.y0)>d||(a=l.x1)<u||(s=l.y1)<h))if(m.length){var g=(r+a)/2,v=(o+s)/2;p.push(new ou(m[3],g,v,a,s),new ou(m[2],r,v,g,s),new ou(m[1],g,o,a,v),new ou(m[0],r,o,g,v)),(c=(e>=v)<<1|t>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var y=t-+this._x.call(null,m.data),x=e-+this._y.call(null,m.data),b=y*y+x*x;if(b<n){var w=Math.sqrt(n=b);u=t-w,h=e-w,f=t+w,d=e+w,i=m.data}}return i},hu.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,i,r,o,a,s,l,c,u,h,f,d=this._root,p=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!d)return this;if(d.length)for(;;){if((c=o>=(s=(p+g)/2))?p=s:g=s,(u=a>=(l=(m+v)/2))?m=l:v=l,e=d,!(d=d[h=u<<1|c]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,i?(r?i.next=r:delete i.next,this):e?(r?e[h]=r:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=r,this)},hu.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},hu.root=function(){return this._root},hu.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},hu.visit=function(t){var e,n,i,r,o,a,s=[],l=this._root;for(l&&s.push(new ou(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,i=e.x0,r=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(i+o)/2,u=(r+a)/2;(n=l[3])&&s.push(new ou(n,c,u,o,a)),(n=l[2])&&s.push(new ou(n,i,u,c,a)),(n=l[1])&&s.push(new ou(n,c,r,o,u)),(n=l[0])&&s.push(new ou(n,i,r,c,u))}return this},hu.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new ou(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,u=(a+l)/2,h=(s+c)/2;(o=r[0])&&n.push(new ou(o,a,s,u,h)),(o=r[1])&&n.push(new ou(o,u,s,l,h)),(o=r[2])&&n.push(new ou(o,a,h,u,c)),(o=r[3])&&n.push(new ou(o,u,h,l,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},hu.x=function(t){return arguments.length?(this._x=t,this):this._x},hu.y=function(t){return arguments.length?(this._y=t,this):this._y};var fu=function(t){return function(){return t}},du=function(t){return 1e-6*(t()-.5)};function pu(t){return t.x+t.vx}function mu(t){return t.y+t.vy}var gu=function(t){var e,n,i,r=1,o=1;function a(){for(var t,a,l,c,u,h,f,d=e.length,p=0;p<o;++p)for(a=lu(e,pu,mu).visitAfter(s),t=0;t<d;++t)l=e[t],h=n[l.index],f=h*h,c=l.x+l.vx,u=l.y+l.vy,a.visit(m);function m(t,e,n,o,a){var s=t.data,d=t.r,p=h+d;if(!s)return e>c+p||o<c-p||n>u+p||a<u-p;if(s.index>l.index){var m=c-s.x-s.vx,g=u-s.y-s.vy,v=m*m+g*g;v<p*p&&(0===m&&(v+=(m=du(i))*m),0===g&&(v+=(g=du(i))*g),v=(p-(v=Math.sqrt(v)))/v*r,l.vx+=(m*=v)*(p=(d*=d)/(f+d)),l.vy+=(g*=v)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var i,r,o=e.length;for(n=new Array(o),i=0;i<o;++i)r=e[i],n[r.index]=+t(r,i,e)}}return"function"!=typeof t&&(t=fu(null==t?1:+t)),a.initialize=function(t,n){e=t,i=n,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(r=+t,a):r},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:fu(+e),l(),a):t},a};function vu(t){return t.index}function yu(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}var xu=function(t){var e,n,i,r,o,a,s=vu,l=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},c=fu(30),u=1;function h(i){for(var r=0,s=t.length;r<u;++r)for(var l,c,h,f,d,p,m,g=0;g<s;++g)c=(l=t[g]).source,f=(h=l.target).x+h.vx-c.x-c.vx||du(a),d=h.y+h.vy-c.y-c.vy||du(a),f*=p=((p=Math.sqrt(f*f+d*d))-n[g])/p*i*e[g],d*=p,h.vx-=f*(m=o[g]),h.vy-=d*m,c.vx+=f*(m=1-m),c.vy+=d*m}function f(){if(i){var a,l,c=i.length,u=t.length,h=new Map(i.map((t,e)=>[s(t,e,i),t]));for(a=0,r=new Array(c);a<u;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=yu(h,l.source)),"object"!=typeof l.target&&(l.target=yu(h,l.target)),r[l.source.index]=(r[l.source.index]||0)+1,r[l.target.index]=(r[l.target.index]||0)+1;for(a=0,o=new Array(u);a<u;++a)l=t[a],o[a]=r[l.source.index]/(r[l.source.index]+r[l.target.index]);e=new Array(u),d(),n=new Array(u),p()}}function d(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+l(t[n],n,t)}function p(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){i=t,a=e,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(u=+t,h):u},h.strength=function(t){return arguments.length?(l="function"==typeof t?t:fu(+t),d(),h):l},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:fu(+t),p(),h):c},h};function bu(t){return t.x}function wu(t){return t.y}var _u=Math.PI*(3-Math.sqrt(5)),Mu=function(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,a=.6,s=new Map,l=vi(h),c=Object(Gt.dispatch)("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%4294967296)/4294967296}();function h(){f(),c.call("tick",e),n<i&&(l.stop(),c.call("end",e))}function f(i){var l,c,u=t.length;void 0===i&&(i=1);for(var h=0;h<i;++h)for(n+=(o-n)*r,s.forEach((function(t){t(n)})),l=0;l<u;++l)null==(c=t[l]).fx?c.x+=c.vx*=a:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=a:(c.y=c.fy,c.vy=0);return e}function d(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),o=n*_u;e.x=r*Math.cos(o),e.y=r*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),d(),e={tick:f,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(u=t,s.forEach(p),e):u},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,i){var r,o,a,s,l,c=0,u=t.length;for(null==i?i=1/0:i*=i,c=0;c<u;++c)(a=(r=e-(s=t[c]).x)*r+(o=n-s.y)*o)<i&&(l=s,i=a);return l},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}},Su=function(){var t,e,n,i,r,o=fu(-30),a=1,s=1/0,l=.81;function c(n){var r,o=t.length,a=lu(t,bu,wu).visitAfter(h);for(i=n,r=0;r<o;++r)e=t[r],a.visit(f)}function u(){if(t){var e,n,i=t.length;for(r=new Array(i),e=0;e<i;++e)n=t[e],r[n.index]=+o(n,e,t)}}function h(t){var e,n,i,o,a,s=0,l=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,i+=n*e.x,o+=n*e.y);t.x=i/l,t.y=o/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function f(t,o,c,u){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,d=u-o,p=h*h+f*f;if(d*d/l<p)return p<s&&(0===h&&(p+=(h=du(n))*h),0===f&&(p+=(f=du(n))*f),p<a&&(p=Math.sqrt(a*p)),e.vx+=h*t.value*i/p,e.vy+=f*t.value*i/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===h&&(p+=(h=du(n))*h),0===f&&(p+=(f=du(n))*f),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(d=r[t.data.index]*i/p,e.vx+=h*d,e.vy+=f*d)}while(t=t.next)}}return c.initialize=function(e,i){t=e,n=i,u()},c.strength=function(t){return arguments.length?(o="function"==typeof t?t:fu(+t),u(),c):o},c.distanceMin=function(t){return arguments.length?(a=t*t,c):Math.sqrt(a)},c.distanceMax=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c.theta=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c},Tu=function(t,e,n){var i,r,o,a=fu(.1);function s(t){for(var a=0,s=i.length;a<s;++a){var l=i[a],c=l.x-e||1e-6,u=l.y-n||1e-6,h=Math.sqrt(c*c+u*u),f=(o[a]-h)*r[a]*t/h;l.vx+=c*f,l.vy+=u*f}}function l(){if(i){var e,n=i.length;for(r=new Array(n),o=new Array(n),e=0;e<n;++e)o[e]=+t(i[e],e,i),r[e]=isNaN(o[e])?0:+a(i[e],e,i)}}return"function"!=typeof t&&(t=fu(+t)),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){i=t,l()},s.strength=function(t){return arguments.length?(a="function"==typeof t?t:fu(+t),l(),s):a},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:fu(+e),l(),s):t},s.x=function(t){return arguments.length?(e=+t,s):e},s.y=function(t){return arguments.length?(n=+t,s):n},s},Au=function(t){var e,n,i,r=fu(.1);function o(t){for(var r,o=0,a=e.length;o<a;++o)(r=e[o]).vx+=(i[o]-r.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),i=new Array(a),o=0;o<a;++o)n[o]=isNaN(i[o]=+t(e[o],o,e))?0:+r(e[o],o,e)}}return"function"!=typeof t&&(t=fu(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(r="function"==typeof t?t:fu(+t),a(),o):r},o.x=function(e){return arguments.length?(t="function"==typeof e?e:fu(+e),a(),o):t},o},Eu=function(t){var e,n,i,r=fu(.1);function o(t){for(var r,o=0,a=e.length;o<a;++o)(r=e[o]).vy+=(i[o]-r.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),i=new Array(a),o=0;o<a;++o)n[o]=isNaN(i[o]=+t(e[o],o,e))?0:+r(e[o],o,e)}}return"function"!=typeof t&&(t=fu(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(r="function"==typeof t?t:fu(+t),a(),o):r},o.y=function(e){return arguments.length?(t="function"==typeof e?e:fu(+e),a(),o):t},o};function qu(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}var Cu=function(t){return(t=qu(Math.abs(t)))?t[1]:NaN},Pu=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ru(t){if(!(e=Pu.exec(t)))throw new Error("invalid format: "+t);var e;return new Lu({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Lu(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}Ru.prototype=Lu.prototype,Lu.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Iu,Du,Ou,Nu,Fu=function(t,e){var n=qu(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")},Bu={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Fu(100*t,e),r:Fu,s:function(t,e){var n=qu(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(Iu=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+qu(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)},zu=function(t){return t},Uu=Array.prototype.map,ku=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],ju=function(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?zu:(e=Uu.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,o=[],a=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?zu:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Uu.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=Ru(t)).fill,n=t.align,h=t.sign,f=t.symbol,d=t.zero,p=t.width,m=t.comma,g=t.precision,v=t.trim,y=t.type;"n"===y?(m=!0,y="g"):Bu[y]||(void 0===g&&(g=12),v=!0,y="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var x="$"===f?r:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?l:"",w=Bu[y],_=/[defgprs%]/.test(y);function M(t){var r,o,l,f=x,M=b;if("c"===y)M=w(t)+M,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:w(Math.abs(t),g),v&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==h&&(S=!1),f=(S?"("===h?h:c:"-"===h||"("===h?"":h)+f,M=("s"===y?ku[8+Iu/3]:"")+M+(S&&"("===h?")":""),_)for(r=-1,o=t.length;++r<o;)if(48>(l=t.charCodeAt(r))||l>57){M=(46===l?a+t.slice(r+1):t.slice(r))+M,t=t.slice(0,r);break}}m&&!d&&(t=i(t,1/0));var T=f.length+t.length+M.length,A=T<p?new Array(p-T+1).join(e):"";switch(m&&d&&(t=i(A+t,A.length?p-M.length:1/0),A=""),n){case"<":t=f+t+M+A;break;case"=":t=f+A+t+M;break;case"^":t=A.slice(0,T=A.length>>1)+f+t+M+A.slice(T);break;default:t=A+f+t+M}return s(t)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),M.toString=function(){return t+""},M}return{format:h,formatPrefix:function(t,e){var n=h(((t=Ru(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Cu(e)/3))),r=Math.pow(10,-i),o=ku[8+i/3];return function(t){return n(r*t)+o}}}};function Vu(t){return Du=ju(t),Ou=Du.format,Nu=Du.formatPrefix,Du}Vu({thousands:",",grouping:[3],currency:["$",""]});var Gu=function(t){return Math.max(0,-Cu(Math.abs(t)))},Hu=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Cu(e)/3)))-Cu(Math.abs(t)))},Wu=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Cu(e)-Cu(t))+1},Xu=Math.PI,Yu=Xu/2,Zu=Xu/4,Qu=2*Xu,Ju=180/Xu,Ku=Xu/180,$u=Math.abs,th=Math.atan,eh=Math.atan2,nh=Math.cos,ih=Math.ceil,rh=Math.exp,oh=(Math.floor,Math.hypot),ah=Math.log,sh=Math.pow,lh=Math.sin,ch=Math.sign||function(t){return t>0?1:t<0?-1:0},uh=Math.sqrt,hh=Math.tan;function fh(t){return t>1?0:t<-1?Xu:Math.acos(t)}function dh(t){return t>1?Yu:t<-1?-Yu:Math.asin(t)}function ph(t){return(t=lh(t/2))*t}function mh(){}function gh(t,e){t&&yh.hasOwnProperty(t.type)&&yh[t.type](t,e)}var vh={Feature:function(t,e){gh(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)gh(n[i].geometry,e)}},yh={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){xh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)xh(n[i],e,0)},Polygon:function(t,e){bh(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)bh(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)gh(n[i],e)}};function xh(t,e,n){var i,r=-1,o=t.length-n;for(e.lineStart();++r<o;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function bh(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)xh(t[n],e,1);e.polygonEnd()}var wh,_h,Mh,Sh,Th,Ah=function(t,e){t&&vh.hasOwnProperty(t.type)?vh[t.type](t,e):gh(t,e)},Eh=new w,qh=new w,Ch={point:mh,lineStart:mh,lineEnd:mh,polygonStart:function(){Eh=new w,Ch.lineStart=Ph,Ch.lineEnd=Rh},polygonEnd:function(){var t=+Eh;qh.add(t<0?Qu+t:t),this.lineStart=this.lineEnd=this.point=mh},sphere:function(){qh.add(Qu)}};function Ph(){Ch.point=Lh}function Rh(){Ih(wh,_h)}function Lh(t,e){Ch.point=Ih,wh=t,_h=e,Mh=t*=Ku,Sh=nh(e=(e*=Ku)/2+Zu),Th=lh(e)}function Ih(t,e){var n=(t*=Ku)-Mh,i=n>=0?1:-1,r=i*n,o=nh(e=(e*=Ku)/2+Zu),a=lh(e),s=Th*a,l=Sh*o+s*nh(r),c=s*i*lh(r);Eh.add(eh(c,l)),Mh=t,Sh=o,Th=a}var Dh,Oh,Nh,Fh,Bh,zh,Uh,kh,jh,Vh,Gh,Hh=function(t){return qh=new w,Ah(t,Ch),2*qh};function Wh(t){return[eh(t[1],t[0]),dh(t[2])]}function Xh(t){var e=t[0],n=t[1],i=nh(n);return[i*nh(e),i*lh(e),lh(n)]}function Yh(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Zh(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Qh(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Jh(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Kh(t){var e=uh(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var $h={point:tf,lineStart:nf,lineEnd:rf,polygonStart:function(){$h.point=of,$h.lineStart=af,$h.lineEnd=sf,jh=new w,Ch.polygonStart()},polygonEnd:function(){Ch.polygonEnd(),$h.point=tf,$h.lineStart=nf,$h.lineEnd=rf,Eh<0?(Dh=-(Nh=180),Oh=-(Fh=90)):jh>1e-6?Fh=90:jh<-1e-6&&(Oh=-90),Gh[0]=Dh,Gh[1]=Nh},sphere:function(){Dh=-(Nh=180),Oh=-(Fh=90)}};function tf(t,e){Vh.push(Gh=[Dh=t,Nh=t]),e<Oh&&(Oh=e),e>Fh&&(Fh=e)}function ef(t,e){var n=Xh([t*Ku,e*Ku]);if(kh){var i=Zh(kh,n),r=Zh([i[1],-i[0],0],i);Kh(r),r=Wh(r);var o,a=t-Bh,s=a>0?1:-1,l=r[0]*Ju*s,c=$u(a)>180;c^(s*Bh<l&&l<s*t)?(o=r[1]*Ju)>Fh&&(Fh=o):c^(s*Bh<(l=(l+360)%360-180)&&l<s*t)?(o=-r[1]*Ju)<Oh&&(Oh=o):(e<Oh&&(Oh=e),e>Fh&&(Fh=e)),c?t<Bh?lf(Dh,t)>lf(Dh,Nh)&&(Nh=t):lf(t,Nh)>lf(Dh,Nh)&&(Dh=t):Nh>=Dh?(t<Dh&&(Dh=t),t>Nh&&(Nh=t)):t>Bh?lf(Dh,t)>lf(Dh,Nh)&&(Nh=t):lf(t,Nh)>lf(Dh,Nh)&&(Dh=t)}else Vh.push(Gh=[Dh=t,Nh=t]);e<Oh&&(Oh=e),e>Fh&&(Fh=e),kh=n,Bh=t}function nf(){$h.point=ef}function rf(){Gh[0]=Dh,Gh[1]=Nh,$h.point=tf,kh=null}function of(t,e){if(kh){var n=t-Bh;jh.add($u(n)>180?n+(n>0?360:-360):n)}else zh=t,Uh=e;Ch.point(t,e),ef(t,e)}function af(){Ch.lineStart()}function sf(){of(zh,Uh),Ch.lineEnd(),$u(jh)>1e-6&&(Dh=-(Nh=180)),Gh[0]=Dh,Gh[1]=Nh,kh=null}function lf(t,e){return(e-=t)<0?e+360:e}function cf(t,e){return t[0]-e[0]}function uf(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var hf,ff,df,pf,mf,gf,vf,yf,xf,bf,wf,_f,Mf,Sf,Tf,Af,Ef=function(t){var e,n,i,r,o,a,s;if(Fh=Nh=-(Dh=Oh=1/0),Vh=[],Ah(t,$h),n=Vh.length){for(Vh.sort(cf),e=1,o=[i=Vh[0]];e<n;++e)uf(i,(r=Vh[e])[0])||uf(i,r[1])?(lf(i[0],r[1])>lf(i[0],i[1])&&(i[1]=r[1]),lf(r[0],i[1])>lf(i[0],i[1])&&(i[0]=r[0])):o.push(i=r);for(a=-1/0,e=0,i=o[n=o.length-1];e<=n;i=r,++e)r=o[e],(s=lf(i[1],r[0]))>a&&(a=s,Dh=r[0],Nh=i[1])}return Vh=Gh=null,Dh===1/0||Oh===1/0?[[NaN,NaN],[NaN,NaN]]:[[Dh,Oh],[Nh,Fh]]},qf={sphere:mh,point:Cf,lineStart:Rf,lineEnd:Df,polygonStart:function(){qf.lineStart=Of,qf.lineEnd=Nf},polygonEnd:function(){qf.lineStart=Rf,qf.lineEnd=Df}};function Cf(t,e){t*=Ku;var n=nh(e*=Ku);Pf(n*nh(t),n*lh(t),lh(e))}function Pf(t,e,n){++hf,df+=(t-df)/hf,pf+=(e-pf)/hf,mf+=(n-mf)/hf}function Rf(){qf.point=Lf}function Lf(t,e){t*=Ku;var n=nh(e*=Ku);Sf=n*nh(t),Tf=n*lh(t),Af=lh(e),qf.point=If,Pf(Sf,Tf,Af)}function If(t,e){t*=Ku;var n=nh(e*=Ku),i=n*nh(t),r=n*lh(t),o=lh(e),a=eh(uh((a=Tf*o-Af*r)*a+(a=Af*i-Sf*o)*a+(a=Sf*r-Tf*i)*a),Sf*i+Tf*r+Af*o);ff+=a,gf+=a*(Sf+(Sf=i)),vf+=a*(Tf+(Tf=r)),yf+=a*(Af+(Af=o)),Pf(Sf,Tf,Af)}function Df(){qf.point=Cf}function Of(){qf.point=Ff}function Nf(){Bf(_f,Mf),qf.point=Cf}function Ff(t,e){_f=t,Mf=e,t*=Ku,e*=Ku,qf.point=Bf;var n=nh(e);Sf=n*nh(t),Tf=n*lh(t),Af=lh(e),Pf(Sf,Tf,Af)}function Bf(t,e){t*=Ku;var n=nh(e*=Ku),i=n*nh(t),r=n*lh(t),o=lh(e),a=Tf*o-Af*r,s=Af*i-Sf*o,l=Sf*r-Tf*i,c=oh(a,s,l),u=dh(c),h=c&&-u/c;xf.add(h*a),bf.add(h*s),wf.add(h*l),ff+=u,gf+=u*(Sf+(Sf=i)),vf+=u*(Tf+(Tf=r)),yf+=u*(Af+(Af=o)),Pf(Sf,Tf,Af)}var zf=function(t){hf=ff=df=pf=mf=gf=vf=yf=0,xf=new w,bf=new w,wf=new w,Ah(t,qf);var e=+xf,n=+bf,i=+wf,r=oh(e,n,i);return r<1e-12&&(e=gf,n=vf,i=yf,ff<1e-6&&(e=df,n=pf,i=mf),(r=oh(e,n,i))<1e-12)?[NaN,NaN]:[eh(n,e)*Ju,dh(i/r)*Ju]},Uf=function(t){return function(){return t}},kf=function(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n};function jf(t,e){return[$u(t)>Xu?t+Math.round(-t/Qu)*Qu:t,e]}function Vf(t,e,n){return(t%=Qu)?e||n?kf(Hf(t),Wf(e,n)):Hf(t):e||n?Wf(e,n):jf}function Gf(t){return function(e,n){return[(e+=t)>Xu?e-Qu:e<-Xu?e+Qu:e,n]}}function Hf(t){var e=Gf(t);return e.invert=Gf(-t),e}function Wf(t,e){var n=nh(t),i=lh(t),r=nh(e),o=lh(e);function a(t,e){var a=nh(e),s=nh(t)*a,l=lh(t)*a,c=lh(e),u=c*n+s*i;return[eh(l*r-u*o,s*n-c*i),dh(u*r+l*o)]}return a.invert=function(t,e){var a=nh(e),s=nh(t)*a,l=lh(t)*a,c=lh(e),u=c*r-l*o;return[eh(l*r+c*o,s*n+u*i),dh(u*n-s*i)]},a}jf.invert=jf;var Xf=function(t){function e(e){return(e=t(e[0]*Ku,e[1]*Ku))[0]*=Ju,e[1]*=Ju,e}return t=Vf(t[0]*Ku,t[1]*Ku,t.length>2?t[2]*Ku:0),e.invert=function(e){return(e=t.invert(e[0]*Ku,e[1]*Ku))[0]*=Ju,e[1]*=Ju,e},e};function Yf(t,e,n,i,r,o){if(n){var a=nh(e),s=lh(e),l=i*n;null==r?(r=e+i*Qu,o=e-l/2):(r=Zf(a,r),o=Zf(a,o),(i>0?r<o:r>o)&&(r+=i*Qu));for(var c,u=r;i>0?u>o:u<o;u-=l)c=Wh([a,-s*nh(u),-s*lh(u)]),t.point(c[0],c[1])}}function Zf(t,e){(e=Xh(e))[0]-=t,Kh(e);var n=fh(-e[1]);return((-e[2]<0?-n:n)+Qu-1e-6)%Qu}var Qf=function(){var t,e,n=Uf([0,0]),i=Uf(90),r=Uf(6),o={point:function(n,i){t.push(n=e(n,i)),n[0]*=Ju,n[1]*=Ju}};function a(){var a=n.apply(this,arguments),s=i.apply(this,arguments)*Ku,l=r.apply(this,arguments)*Ku;return t=[],e=Vf(-a[0]*Ku,-a[1]*Ku,0).invert,Yf(o,s,l,1),a={type:"Polygon",coordinates:[t]},t=e=null,a}return a.center=function(t){return arguments.length?(n="function"==typeof t?t:Uf([+t[0],+t[1]]),a):n},a.radius=function(t){return arguments.length?(i="function"==typeof t?t:Uf(+t),a):i},a.precision=function(t){return arguments.length?(r="function"==typeof t?t:Uf(+t),a):r},a},Jf=function(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:mh,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},Kf=function(t,e){return $u(t[0]-e[0])<1e-6&&$u(t[1]-e[1])<1e-6};function $f(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}var td=function(t,e,n,i,r){var o,a,s=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],a=t[e];if(Kf(i,a)){if(!i[2]&&!a[2]){for(r.lineStart(),o=0;o<e;++o)r.point((i=t[o])[0],i[1]);return void r.lineEnd()}a[0]+=2e-6}s.push(n=new $f(i,t,null,!0)),l.push(n.o=new $f(i,null,n,!1)),s.push(n=new $f(a,t,null,!1)),l.push(n.o=new $f(a,null,n,!0))}})),s.length){for(l.sort(e),ed(s),ed(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var c,u,h=s[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;c=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(o=0,a=c.length;o<a;++o)r.point((u=c[o])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(c=f.p.z,o=c.length-1;o>=0;--o)r.point((u=c[o])[0],u[1]);else i(f.x,f.p.x,-1,r);f=f.p}c=(f=f.o).z,d=!d}while(!f.v);r.lineEnd()}}};function ed(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function nd(t){return $u(t[0])<=Xu?t[0]:ch(t[0])*(($u(t[0])+Xu)%Qu-Xu)}var id=function(t,e){var n=nd(e),i=e[1],r=lh(i),o=[lh(n),-nh(n),0],a=0,s=0,l=new w;1===r?i=Yu+1e-6:-1===r&&(i=-Yu-1e-6);for(var c=0,u=t.length;c<u;++c)if(f=(h=t[c]).length)for(var h,f,d=h[f-1],p=nd(d),m=d[1]/2+Zu,g=lh(m),v=nh(m),y=0;y<f;++y,p=b,g=M,v=S,d=x){var x=h[y],b=nd(x),_=x[1]/2+Zu,M=lh(_),S=nh(_),T=b-p,A=T>=0?1:-1,E=A*T,q=E>Xu,C=g*M;if(l.add(eh(C*A*lh(E),v*S+C*nh(E))),a+=q?T+A*Qu:T,q^p>=n^b>=n){var P=Zh(Xh(d),Xh(x));Kh(P);var R=Zh(o,P);Kh(R);var L=(q^T>=0?-1:1)*dh(R[2]);(i>L||i===L&&(P[0]||P[1]))&&(s+=q^T>=0?1:-1)}}return(a<-1e-6||a<1e-6&&l<-1e-12)^1&s},rd=function(t,e,n,i){return function(r){var o,a,s,l=e(r),c=Jf(),u=e(c),h=!1,f={point:d,lineStart:m,lineEnd:g,polygonStart:function(){f.point=v,f.lineStart=y,f.lineEnd=x,a=[],o=[]},polygonEnd:function(){f.point=d,f.lineStart=m,f.lineEnd=g,a=et(a);var t=id(o,i);a.length?(h||(r.polygonStart(),h=!0),td(a,ad,t,n,r)):t&&(h||(r.polygonStart(),h=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),h&&(r.polygonEnd(),h=!1),a=o=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(e,n){t(e,n)&&r.point(e,n)}function p(t,e){l.point(t,e)}function m(){f.point=p,l.lineStart()}function g(){f.point=d,l.lineEnd()}function v(t,e){s.push([t,e]),u.point(t,e)}function y(){u.lineStart(),s=[]}function x(){v(s[0][0],s[0][1]),u.lineEnd();var t,e,n,i,l=u.clean(),f=c.result(),d=f.length;if(s.pop(),o.push(s),s=null,d)if(1&l){if((e=(n=f[0]).length-1)>0){for(h||(r.polygonStart(),h=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}}else d>1&&2&l&&f.push(f.pop().concat(f.shift())),a.push(f.filter(od))}return f}};function od(t){return t.length>1}function ad(t,e){return((t=t.x)[0]<0?t[1]-Yu-1e-6:Yu-t[1])-((e=e.x)[0]<0?e[1]-Yu-1e-6:Yu-e[1])}var sd=rd((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Xu:-Xu,l=$u(o-n);$u(l-Xu)<1e-6?(t.point(n,i=(i+a)/2>0?Yu:-Yu),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(o,i),e=0):r!==s&&l>=Xu&&($u(n-r)<1e-6&&(n-=1e-6*r),$u(o-s)<1e-6&&(o-=1e-6*s),i=function(t,e,n,i){var r,o,a=lh(t-n);return $u(a)>1e-6?th((lh(e)*(o=nh(i))*lh(n)-lh(i)*(r=nh(e))*lh(t))/(r*o*a)):(e+i)/2}(n,i,o,a),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=o,i=a),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*Yu,i.point(-Xu,r),i.point(0,r),i.point(Xu,r),i.point(Xu,0),i.point(Xu,-r),i.point(0,-r),i.point(-Xu,-r),i.point(-Xu,0),i.point(-Xu,r);else if($u(t[0]-e[0])>1e-6){var o=t[0]<e[0]?Xu:-Xu;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(e[0],e[1])}),[-Xu,-Yu]);var ld=function(t){var e=nh(t),n=6*Ku,i=e>0,r=$u(e)>1e-6;function o(t,n){return nh(t)*nh(n)>e}function a(t,n,i){var r=[1,0,0],o=Zh(Xh(t),Xh(n)),a=Yh(o,o),s=o[0],l=a-s*s;if(!l)return!i&&t;var c=e*a/l,u=-e*s/l,h=Zh(r,o),f=Jh(r,c);Qh(f,Jh(o,u));var d=h,p=Yh(f,d),m=Yh(d,d),g=p*p-m*(Yh(f,f)-1);if(!(g<0)){var v=uh(g),y=Jh(d,(-p-v)/m);if(Qh(y,f),y=Wh(y),!i)return y;var x,b=t[0],w=n[0],_=t[1],M=n[1];w<b&&(x=b,b=w,w=x);var S=w-b,T=$u(S-Xu)<1e-6;if(!T&&M<_&&(x=_,_=M,M=x),T||S<1e-6?T?_+M>0^y[1]<($u(y[0]-b)<1e-6?_:M):_<=y[1]&&y[1]<=M:S>Xu^(b<=y[0]&&y[0]<=w)){var A=Jh(d,(-p+v)/m);return Qh(A,f),[y,Wh(A)]}}}function s(e,n){var r=i?t:Xu-t,o=0;return e<-r?o|=1:e>r&&(o|=2),n<-r?o|=4:n>r&&(o|=8),o}return rd(o,(function(t){var e,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,f){var d,p=[h,f],m=o(h,f),g=i?m?0:s(h,f):m?s(h+(h<0?Xu:-Xu),f):0;if(!e&&(c=l=m)&&t.lineStart(),m!==l&&(!(d=a(e,p))||Kf(e,d)||Kf(p,d))&&(p[2]=1),m!==l)u=0,m?(t.lineStart(),d=a(p,e),t.point(d[0],d[1])):(d=a(e,p),t.point(d[0],d[1],2),t.lineEnd()),e=d;else if(r&&e&&i^m){var v;g&n||!(v=a(p,e,!0))||(u=0,i?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1],3)))}!m||e&&Kf(e,p)||t.point(p[0],p[1]),e=p,l=m,n=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return u|(c&&l)<<1}}}),(function(e,i,r,o){Yf(o,t,n,r,e,i)}),i?[0,-t]:[-Xu,t-Xu])};function cd(t,e,n,i){function r(r,o){return t<=r&&r<=n&&e<=o&&o<=i}function o(r,o,s,c){var u=0,h=0;if(null==r||(u=a(r,s))!==(h=a(o,s))||l(r,o)<0^s>0)do{c.point(0===u||3===u?t:n,u>1?i:e)}while((u=(u+s+4)%4)!==h);else c.point(o[0],o[1])}function a(i,r){return $u(i[0]-t)<1e-6?r>0?0:3:$u(i[0]-n)<1e-6?r>0?2:1:$u(i[1]-e)<1e-6?r>0?1:0:r>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),i=a(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,c,u,h,f,d,p,m,g,v,y,x=a,b=Jf(),w={point:_,lineStart:function(){w.point=M,c&&c.push(u=[]);v=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(M(h,f),d&&g&&b.rejoin(),l.push(b.result()));w.point=_,g&&x.lineEnd()},polygonStart:function(){x=b,l=[],c=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=c.length;n<r;++n)for(var o,a,s=c[n],l=1,u=s.length,h=s[0],f=h[0],d=h[1];l<u;++l)o=f,a=d,h=s[l],f=h[0],d=h[1],a<=i?d>i&&(f-o)*(i-a)>(d-a)*(t-o)&&++e:d<=i&&(f-o)*(i-a)<(d-a)*(t-o)&&--e;return e}(),n=y&&e,r=(l=et(l)).length;(n||r)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),r&&td(l,s,e,o,a),a.polygonEnd());x=a,l=c=u=null}};function _(t,e){r(t,e)&&x.point(t,e)}function M(o,a){var s=r(o,a);if(c&&u.push([o,a]),v)h=o,f=a,d=s,v=!1,s&&(x.lineStart(),x.point(o,a));else if(s&&g)x.point(o,a);else{var l=[p=Math.max(-1e9,Math.min(1e9,p)),m=Math.max(-1e9,Math.min(1e9,m))],b=[o=Math.max(-1e9,Math.min(1e9,o)),a=Math.max(-1e9,Math.min(1e9,a))];!function(t,e,n,i,r,o){var a,s=t[0],l=t[1],c=0,u=1,h=e[0]-s,f=e[1]-l;if(a=n-s,h||!(a>0)){if(a/=h,h<0){if(a<c)return;a<u&&(u=a)}else if(h>0){if(a>u)return;a>c&&(c=a)}if(a=r-s,h||!(a<0)){if(a/=h,h<0){if(a>u)return;a>c&&(c=a)}else if(h>0){if(a<c)return;a<u&&(u=a)}if(a=i-l,f||!(a>0)){if(a/=f,f<0){if(a<c)return;a<u&&(u=a)}else if(f>0){if(a>u)return;a>c&&(c=a)}if(a=o-l,f||!(a<0)){if(a/=f,f<0){if(a>u)return;a>c&&(c=a)}else if(f>0){if(a<c)return;a<u&&(u=a)}return c>0&&(t[0]=s+c*h,t[1]=l+c*f),u<1&&(e[0]=s+u*h,e[1]=l+u*f),!0}}}}}(l,b,t,e,n,i)?s&&(x.lineStart(),x.point(o,a),y=!1):(g||(x.lineStart(),x.point(l[0],l[1])),x.point(b[0],b[1]),s||x.lineEnd(),y=!1)}p=o,m=a,g=s}return w}}var ud,hd,fd,dd,pd=function(){var t,e,n,i=0,r=0,o=960,a=500;return n={stream:function(n){return t&&e===n?t:t=cd(i,r,o,a)(e=n)},extent:function(s){return arguments.length?(i=+s[0][0],r=+s[0][1],o=+s[1][0],a=+s[1][1],t=e=null,n):[[i,r],[o,a]]}}},md={sphere:mh,point:mh,lineStart:function(){md.point=vd,md.lineEnd=gd},lineEnd:mh,polygonStart:mh,polygonEnd:mh};function gd(){md.point=md.lineEnd=mh}function vd(t,e){hd=t*=Ku,fd=lh(e*=Ku),dd=nh(e),md.point=yd}function yd(t,e){t*=Ku;var n=lh(e*=Ku),i=nh(e),r=$u(t-hd),o=nh(r),a=i*lh(r),s=dd*n-fd*i*o,l=fd*n+dd*i*o;ud.add(eh(uh(a*a+s*s),l)),hd=t,fd=n,dd=i}var xd=function(t){return ud=new w,Ah(t,md),+ud},bd=[null,null],wd={type:"LineString",coordinates:bd},_d=function(t,e){return bd[0]=t,bd[1]=e,xd(wd)},Md={Feature:function(t,e){return Td(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)if(Td(n[i].geometry,e))return!0;return!1}},Sd={Sphere:function(){return!0},Point:function(t,e){return Ad(t.coordinates,e)},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)if(Ad(n[i],e))return!0;return!1},LineString:function(t,e){return Ed(t.coordinates,e)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)if(Ed(n[i],e))return!0;return!1},Polygon:function(t,e){return qd(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)if(qd(n[i],e))return!0;return!1},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)if(Td(n[i],e))return!0;return!1}};function Td(t,e){return!(!t||!Sd.hasOwnProperty(t.type))&&Sd[t.type](t,e)}function Ad(t,e){return 0===_d(t,e)}function Ed(t,e){for(var n,i,r,o=0,a=t.length;o<a;o++){if(0===(i=_d(t[o],e)))return!0;if(o>0&&(r=_d(t[o],t[o-1]))>0&&n<=r&&i<=r&&(n+i-r)*(1-Math.pow((n-i)/r,2))<1e-12*r)return!0;n=i}return!1}function qd(t,e){return!!id(t.map(Cd),Pd(e))}function Cd(t){return(t=t.map(Pd)).pop(),t}function Pd(t){return[t[0]*Ku,t[1]*Ku]}var Rd=function(t,e){return(t&&Md.hasOwnProperty(t.type)?Md[t.type]:Td)(t,e)};function Ld(t,e,n){var i=at(t,e-1e-6,n).concat(e);return function(t){return i.map((function(e){return[t,e]}))}}function Id(t,e,n){var i=at(t,e-1e-6,n).concat(e);return function(t){return i.map((function(e){return[e,t]}))}}function Dd(){var t,e,n,i,r,o,a,s,l,c,u,h,f=10,d=f,p=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return at(ih(i/p)*p,n,p).map(u).concat(at(ih(s/m)*m,a,m).map(h)).concat(at(ih(e/f)*f,t,f).filter((function(t){return $u(t%p)>1e-6})).map(l)).concat(at(ih(o/d)*d,r,d).filter((function(t){return $u(t%m)>1e-6})).map(c))}return v.lines=function(){return y().map((function(t){return{type:"LineString",coordinates:t}}))},v.outline=function(){return{type:"Polygon",coordinates:[u(i).concat(h(a).slice(1),u(n).reverse().slice(1),h(s).reverse().slice(1))]}},v.extent=function(t){return arguments.length?v.extentMajor(t).extentMinor(t):v.extentMinor()},v.extentMajor=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],i>n&&(t=i,i=n,n=t),s>a&&(t=s,s=a,a=t),v.precision(g)):[[i,s],[n,a]]},v.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],o=+n[0][1],r=+n[1][1],e>t&&(n=e,e=t,t=n),o>r&&(n=o,o=r,r=n),v.precision(g)):[[e,o],[t,r]]},v.step=function(t){return arguments.length?v.stepMajor(t).stepMinor(t):v.stepMinor()},v.stepMajor=function(t){return arguments.length?(p=+t[0],m=+t[1],v):[p,m]},v.stepMinor=function(t){return arguments.length?(f=+t[0],d=+t[1],v):[f,d]},v.precision=function(f){return arguments.length?(g=+f,l=Ld(o,r,90),c=Id(e,t,g),u=Ld(s,a,90),h=Id(i,n,g),v):g},v.extentMajor([[-180,1e-6-90],[180,90-1e-6]]).extentMinor([[-180,-80-1e-6],[180,80+1e-6]])}function Od(){return Dd()()}var Nd,Fd,Bd,zd,Ud=function(t,e){var n=t[0]*Ku,i=t[1]*Ku,r=e[0]*Ku,o=e[1]*Ku,a=nh(i),s=lh(i),l=nh(o),c=lh(o),u=a*nh(n),h=a*lh(n),f=l*nh(r),d=l*lh(r),p=2*dh(uh(ph(o-i)+a*l*ph(r-n))),m=lh(p),g=p?function(t){var e=lh(t*=p)/m,n=lh(p-t)/m,i=n*u+e*f,r=n*h+e*d,o=n*s+e*c;return[eh(r,i)*Ju,eh(o,uh(i*i+r*r))*Ju]}:function(){return[n*Ju,i*Ju]};return g.distance=p,g},kd=t=>t,jd=new w,Vd=new w,Gd={point:mh,lineStart:mh,lineEnd:mh,polygonStart:function(){Gd.lineStart=Hd,Gd.lineEnd=Yd},polygonEnd:function(){Gd.lineStart=Gd.lineEnd=Gd.point=mh,jd.add($u(Vd)),Vd=new w},result:function(){var t=jd/2;return jd=new w,t}};function Hd(){Gd.point=Wd}function Wd(t,e){Gd.point=Xd,Nd=Bd=t,Fd=zd=e}function Xd(t,e){Vd.add(zd*t-Bd*e),Bd=t,zd=e}function Yd(){Xd(Nd,Fd)}var Zd=Gd,Qd=1/0,Jd=Qd,Kd=-Qd,$d=Kd;var tp,ep,np,ip,rp={point:function(t,e){t<Qd&&(Qd=t);t>Kd&&(Kd=t);e<Jd&&(Jd=e);e>$d&&($d=e)},lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var t=[[Qd,Jd],[Kd,$d]];return Kd=$d=-(Jd=Qd=1/0),t}},op=0,ap=0,sp=0,lp=0,cp=0,up=0,hp=0,fp=0,dp=0,pp={point:mp,lineStart:gp,lineEnd:xp,polygonStart:function(){pp.lineStart=bp,pp.lineEnd=wp},polygonEnd:function(){pp.point=mp,pp.lineStart=gp,pp.lineEnd=xp},result:function(){var t=dp?[hp/dp,fp/dp]:up?[lp/up,cp/up]:sp?[op/sp,ap/sp]:[NaN,NaN];return op=ap=sp=lp=cp=up=hp=fp=dp=0,t}};function mp(t,e){op+=t,ap+=e,++sp}function gp(){pp.point=vp}function vp(t,e){pp.point=yp,mp(np=t,ip=e)}function yp(t,e){var n=t-np,i=e-ip,r=uh(n*n+i*i);lp+=r*(np+t)/2,cp+=r*(ip+e)/2,up+=r,mp(np=t,ip=e)}function xp(){pp.point=mp}function bp(){pp.point=_p}function wp(){Mp(tp,ep)}function _p(t,e){pp.point=Mp,mp(tp=np=t,ep=ip=e)}function Mp(t,e){var n=t-np,i=e-ip,r=uh(n*n+i*i);lp+=r*(np+t)/2,cp+=r*(ip+e)/2,up+=r,hp+=(r=ip*t-np*e)*(np+t),fp+=r*(ip+e),dp+=3*r,mp(np=t,ip=e)}var Sp=pp;function Tp(t){this._context=t}Tp.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Qu)}},result:mh};var Ap,Ep,qp,Cp,Pp,Rp=new w,Lp={point:mh,lineStart:function(){Lp.point=Ip},lineEnd:function(){Ap&&Dp(Ep,qp),Lp.point=mh},polygonStart:function(){Ap=!0},polygonEnd:function(){Ap=null},result:function(){var t=+Rp;return Rp=new w,t}};function Ip(t,e){Lp.point=Dp,Ep=Cp=t,qp=Pp=e}function Dp(t,e){Cp-=t,Pp-=e,Rp.add(uh(Cp*Cp+Pp*Pp)),Cp=t,Pp=e}var Op=Lp;function Np(){this._string=[]}function Fp(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}Np.prototype={_radius:4.5,_circle:Fp(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Fp(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var Bp=function(t,e){var n,i,r=4.5;function o(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),Ah(t,n(i))),i.result()}return o.area=function(t){return Ah(t,n(Zd)),Zd.result()},o.measure=function(t){return Ah(t,n(Op)),Op.result()},o.bounds=function(t){return Ah(t,n(rp)),rp.result()},o.centroid=function(t){return Ah(t,n(Sp)),Sp.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,kd):(t=e).stream,o):t},o.context=function(t){return arguments.length?(i=null==t?(e=null,new Np):new Tp(e=t),"function"!=typeof r&&i.pointRadius(r),o):e},o.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(i.pointRadius(+t),+t),o):r},o.projection(t).context(e)},zp=function(t){return{stream:Up(t)}};function Up(t){return function(e){var n=new kp;for(var i in t)n[i]=t[i];return n.stream=e,n}}function kp(){}function jp(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),Ah(n,t.stream(rp)),e(rp.result()),null!=i&&t.clipExtent(i),t}function Vp(t,e,n){return jp(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+e[0][0]+(i-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])}),n)}function Gp(t,e,n){return Vp(t,[[0,0],e],n)}function Hp(t,e,n){return jp(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),o=(i-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];t.scale(150*r).translate([o,a])}),n)}function Wp(t,e,n){return jp(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),o=-r*n[0][0],a=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([o,a])}),n)}kp.prototype={constructor:kp,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Xp=nh(30*Ku),Yp=function(t,e){return+e?function(t,e){function n(i,r,o,a,s,l,c,u,h,f,d,p,m,g){var v=c-i,y=u-r,x=v*v+y*y;if(x>4*e&&m--){var b=a+f,w=s+d,_=l+p,M=uh(b*b+w*w+_*_),S=dh(_/=M),T=$u($u(_)-1)<1e-6||$u(o-h)<1e-6?(o+h)/2:eh(w,b),A=t(T,S),E=A[0],q=A[1],C=E-i,P=q-r,R=y*C-v*P;(R*R/x>e||$u((v*C+y*P)/x-.5)>.3||a*f+s*d+l*p<Xp)&&(n(i,r,o,a,s,l,E,q,T,b/=M,w/=M,_,m,g),g.point(E,q),n(E,q,T,b,w,_,c,u,h,f,d,p,m,g))}}return function(e){var i,r,o,a,s,l,c,u,h,f,d,p,m={point:g,lineStart:v,lineEnd:x,polygonStart:function(){e.polygonStart(),m.lineStart=b},polygonEnd:function(){e.polygonEnd(),m.lineStart=v}};function g(n,i){n=t(n,i),e.point(n[0],n[1])}function v(){u=NaN,m.point=y,e.lineStart()}function y(i,r){var o=Xh([i,r]),a=t(i,r);n(u,h,c,f,d,p,u=a[0],h=a[1],c=i,f=o[0],d=o[1],p=o[2],16,e),e.point(u,h)}function x(){m.point=g,e.lineEnd()}function b(){v(),m.point=w,m.lineEnd=_}function w(t,e){y(i=t,e),r=u,o=h,a=f,s=d,l=p,m.point=y}function _(){n(u,h,c,f,d,p,r,o,i,a,s,l,16,e),m.lineEnd=x,x()}return m}}(t,e):function(t){return Up({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)};var Zp=Up({point:function(t,e){this.stream.point(t*Ku,e*Ku)}});function Qp(t,e,n,i,r,o){if(!o)return function(t,e,n,i,r){function o(o,a){return[e+t*(o*=i),n-t*(a*=r)]}return o.invert=function(o,a){return[(o-e)/t*i,(n-a)/t*r]},o}(t,e,n,i,r);var a=nh(o),s=lh(o),l=a*t,c=s*t,u=a/t,h=s/t,f=(s*n-a*e)/t,d=(s*e+a*n)/t;function p(t,o){return[l*(t*=i)-c*(o*=r)+e,n-c*t-l*o]}return p.invert=function(t,e){return[i*(u*t-h*e+f),r*(d-h*t-u*e)]},p}function Jp(t){return Kp((function(){return t}))()}function Kp(t){var e,n,i,r,o,a,s,l,c,u,h=150,f=480,d=250,p=0,m=0,g=0,v=0,y=0,x=0,b=1,w=1,_=null,M=sd,S=null,T=kd,A=.5;function E(t){return l(t[0]*Ku,t[1]*Ku)}function q(t){return(t=l.invert(t[0],t[1]))&&[t[0]*Ju,t[1]*Ju]}function C(){var t=Qp(h,0,0,b,w,x).apply(null,e(p,m)),i=Qp(h,f-t[0],d-t[1],b,w,x);return n=Vf(g,v,y),s=kf(e,i),l=kf(n,s),a=Yp(s,A),P()}function P(){return c=u=null,E}return E.stream=function(t){return c&&u===t?c:c=Zp(function(t){return Up({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}(n)(M(a(T(u=t)))))},E.preclip=function(t){return arguments.length?(M=t,_=void 0,P()):M},E.postclip=function(t){return arguments.length?(T=t,S=i=r=o=null,P()):T},E.clipAngle=function(t){return arguments.length?(M=+t?ld(_=t*Ku):(_=null,sd),P()):_*Ju},E.clipExtent=function(t){return arguments.length?(T=null==t?(S=i=r=o=null,kd):cd(S=+t[0][0],i=+t[0][1],r=+t[1][0],o=+t[1][1]),P()):null==S?null:[[S,i],[r,o]]},E.scale=function(t){return arguments.length?(h=+t,C()):h},E.translate=function(t){return arguments.length?(f=+t[0],d=+t[1],C()):[f,d]},E.center=function(t){return arguments.length?(p=t[0]%360*Ku,m=t[1]%360*Ku,C()):[p*Ju,m*Ju]},E.rotate=function(t){return arguments.length?(g=t[0]%360*Ku,v=t[1]%360*Ku,y=t.length>2?t[2]%360*Ku:0,C()):[g*Ju,v*Ju,y*Ju]},E.angle=function(t){return arguments.length?(x=t%360*Ku,C()):x*Ju},E.reflectX=function(t){return arguments.length?(b=t?-1:1,C()):b<0},E.reflectY=function(t){return arguments.length?(w=t?-1:1,C()):w<0},E.precision=function(t){return arguments.length?(a=Yp(s,A=t*t),P()):uh(A)},E.fitExtent=function(t,e){return Vp(E,t,e)},E.fitSize=function(t,e){return Gp(E,t,e)},E.fitWidth=function(t,e){return Hp(E,t,e)},E.fitHeight=function(t,e){return Wp(E,t,e)},function(){return e=t.apply(this,arguments),E.invert=e.invert&&q,C()}}function $p(t){var e=0,n=Xu/3,i=Kp(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*Ku,n=t[1]*Ku):[e*Ju,n*Ju]},r}function tm(t,e){var n=lh(t),i=(n+lh(e))/2;if($u(i)<1e-6)return function(t){var e=nh(t);function n(t,n){return[t*e,lh(n)/e]}return n.invert=function(t,n){return[t/e,dh(n*e)]},n}(t);var r=1+n*(2*i-n),o=uh(r)/i;function a(t,e){var n=uh(r-2*i*lh(e))/i;return[n*lh(t*=i),o-n*nh(t)]}return a.invert=function(t,e){var n=o-e,a=eh(t,$u(n))*ch(n);return n*i<0&&(a-=Xu*ch(t)*ch(n)),[a/i,dh((r-(t*t+n*n)*i*i)/(2*i))]},a}var em=function(){return $p(tm).scale(155.424).center([0,33.6442])},nm=function(){return em().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};var im=function(){var t,e,n,i,r,o,a=nm(),s=em().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=em().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(t,e){o=[t,e]}};function u(t){var e=t[0],a=t[1];return o=null,n.point(e,a),o||(i.point(e,a),o)||(r.point(e,a),o)}function h(){return t=e=null,u}return u.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?s:r>=.166&&r<.234&&i>=-.214&&i<-.115?l:a).invert(t)},u.stream=function(n){return t&&e===n?t:(i=[a.stream(e=n),s.stream(n),l.stream(n)],r=i.length,t={point:function(t,e){for(var n=-1;++n<r;)i[n].point(t,e)},sphere:function(){for(var t=-1;++t<r;)i[t].sphere()},lineStart:function(){for(var t=-1;++t<r;)i[t].lineStart()},lineEnd:function(){for(var t=-1;++t<r;)i[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<r;)i[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<r;)i[t].polygonEnd()}});var i,r},u.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),l.precision(t),h()):a.precision()},u.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),l.scale(t),u.translate(a.translate())):a.scale()},u.translate=function(t){if(!arguments.length)return a.translate();var e=a.scale(),o=+t[0],u=+t[1];return n=a.translate(t).clipExtent([[o-.455*e,u-.238*e],[o+.455*e,u+.238*e]]).stream(c),i=s.translate([o-.307*e,u+.201*e]).clipExtent([[o-.425*e+1e-6,u+.12*e+1e-6],[o-.214*e-1e-6,u+.234*e-1e-6]]).stream(c),r=l.translate([o-.205*e,u+.212*e]).clipExtent([[o-.214*e+1e-6,u+.166*e+1e-6],[o-.115*e-1e-6,u+.234*e-1e-6]]).stream(c),h()},u.fitExtent=function(t,e){return Vp(u,t,e)},u.fitSize=function(t,e){return Gp(u,t,e)},u.fitWidth=function(t,e){return Hp(u,t,e)},u.fitHeight=function(t,e){return Wp(u,t,e)},u.scale(1070)};function rm(t){return function(e,n){var i=nh(e),r=nh(n),o=t(i*r);return o===1/0?[2,0]:[o*r*lh(e),o*lh(n)]}}function om(t){return function(e,n){var i=uh(e*e+n*n),r=t(i),o=lh(r),a=nh(r);return[eh(e*o,i*a),dh(i&&n*o/i)]}}var am=rm((function(t){return uh(2/(1+t))}));am.invert=om((function(t){return 2*dh(t/2)}));var sm=function(){return Jp(am).scale(124.75).clipAngle(179.999)},lm=rm((function(t){return(t=fh(t))&&t/lh(t)}));lm.invert=om((function(t){return t}));var cm=function(){return Jp(lm).scale(79.4188).clipAngle(179.999)};function um(t,e){return[t,ah(hh((Yu+e)/2))]}um.invert=function(t,e){return[t,2*th(rh(e))-Yu]};var hm=function(){return fm(um).scale(961/Qu)};function fm(t){var e,n,i,r=Jp(t),o=r.center,a=r.scale,s=r.translate,l=r.clipExtent,c=null;function u(){var o=Xu*a(),s=r(Xf(r.rotate()).invert([0,0]));return l(null==c?[[s[0]-o,s[1]-o],[s[0]+o,s[1]+o]]:t===um?[[Math.max(s[0]-o,c),e],[Math.min(s[0]+o,n),i]]:[[c,Math.max(s[1]-o,e)],[n,Math.min(s[1]+o,i)]])}return r.scale=function(t){return arguments.length?(a(t),u()):a()},r.translate=function(t){return arguments.length?(s(t),u()):s()},r.center=function(t){return arguments.length?(o(t),u()):o()},r.clipExtent=function(t){return arguments.length?(null==t?c=e=n=i=null:(c=+t[0][0],e=+t[0][1],n=+t[1][0],i=+t[1][1]),u()):null==c?null:[[c,e],[n,i]]},u()}function dm(t){return hh((Yu+t)/2)}function pm(t,e){var n=nh(t),i=t===e?lh(t):ah(n/nh(e))/ah(dm(e)/dm(t)),r=n*sh(dm(t),i)/i;if(!i)return um;function o(t,e){r>0?e<1e-6-Yu&&(e=1e-6-Yu):e>Yu-1e-6&&(e=Yu-1e-6);var n=r/sh(dm(e),i);return[n*lh(i*t),r-n*nh(i*t)]}return o.invert=function(t,e){var n=r-e,o=ch(i)*uh(t*t+n*n),a=eh(t,$u(n))*ch(n);return n*i<0&&(a-=Xu*ch(t)*ch(n)),[a/i,2*th(sh(r/o,1/i))-Yu]},o}var mm=function(){return $p(pm).scale(109.5).parallels([30,30])};function gm(t,e){return[t,e]}gm.invert=gm;var vm=function(){return Jp(gm).scale(152.63)};function ym(t,e){var n=nh(t),i=t===e?lh(t):(n-nh(e))/(e-t),r=n/i+t;if($u(i)<1e-6)return gm;function o(t,e){var n=r-e,o=i*t;return[n*lh(o),r-n*nh(o)]}return o.invert=function(t,e){var n=r-e,o=eh(t,$u(n))*ch(n);return n*i<0&&(o-=Xu*ch(t)*ch(n)),[o/i,r-ch(i)*uh(t*t+n*n)]},o}var xm=function(){return $p(ym).scale(131.154).center([0,13.9389])},bm=1.340264,wm=-.081106,_m=893e-6,Mm=.003796,Sm=uh(3)/2;function Tm(t,e){var n=dh(Sm*lh(e)),i=n*n,r=i*i*i;return[t*nh(n)/(Sm*(bm+3*wm*i+r*(7*_m+9*Mm*i))),n*(bm+wm*i+r*(_m+Mm*i))]}Tm.invert=function(t,e){for(var n,i=e,r=i*i,o=r*r*r,a=0;a<12&&(o=(r=(i-=n=(i*(bm+wm*r+o*(_m+Mm*r))-e)/(bm+3*wm*r+o*(7*_m+9*Mm*r)))*i)*r*r,!($u(n)<1e-12));++a);return[Sm*t*(bm+3*wm*r+o*(7*_m+9*Mm*r))/nh(i),dh(lh(i)/Sm)]};var Am=function(){return Jp(Tm).scale(177.158)};function Em(t,e){var n=nh(e),i=nh(t)*n;return[n*lh(t)/i,lh(e)/i]}Em.invert=om(th);var qm=function(){return Jp(Em).scale(144.049).clipAngle(60)},Cm=function(){var t,e,n,i,r,o,a,s=1,l=0,c=0,u=1,h=1,f=0,d=null,p=1,m=1,g=Up({point:function(t,e){var n=x([t,e]);this.stream.point(n[0],n[1])}}),v=kd;function y(){return p=s*u,m=s*h,o=a=null,x}function x(n){var i=n[0]*p,r=n[1]*m;if(f){var o=r*t-i*e;i=i*t+r*e,r=o}return[i+l,r+c]}return x.invert=function(n){var i=n[0]-l,r=n[1]-c;if(f){var o=r*t+i*e;i=i*t-r*e,r=o}return[i/p,r/m]},x.stream=function(t){return o&&a===t?o:o=g(v(a=t))},x.postclip=function(t){return arguments.length?(v=t,d=n=i=r=null,y()):v},x.clipExtent=function(t){return arguments.length?(v=null==t?(d=n=i=r=null,kd):cd(d=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),y()):null==d?null:[[d,n],[i,r]]},x.scale=function(t){return arguments.length?(s=+t,y()):s},x.translate=function(t){return arguments.length?(l=+t[0],c=+t[1],y()):[l,c]},x.angle=function(n){return arguments.length?(e=lh(f=n%360*Ku),t=nh(f),y()):f*Ju},x.reflectX=function(t){return arguments.length?(u=t?-1:1,y()):u<0},x.reflectY=function(t){return arguments.length?(h=t?-1:1,y()):h<0},x.fitExtent=function(t,e){return Vp(x,t,e)},x.fitSize=function(t,e){return Gp(x,t,e)},x.fitWidth=function(t,e){return Hp(x,t,e)},x.fitHeight=function(t,e){return Wp(x,t,e)},x};function Pm(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),e*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}Pm.invert=function(t,e){var n,i=e,r=25;do{var o=i*i,a=o*o;i-=n=(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while($u(n)>1e-6&&--r>0);return[t/(.8707+(o=i*i)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),i]};var Rm=function(){return Jp(Pm).scale(175.295)};function Lm(t,e){return[nh(e)*lh(t),lh(e)]}Lm.invert=om(dh);var Im=function(){return Jp(Lm).scale(249.5).clipAngle(90+1e-6)};function Dm(t,e){var n=nh(e),i=1+nh(t)*n;return[n*lh(t)/i,lh(e)/i]}Dm.invert=om((function(t){return 2*th(t)}));var Om=function(){return Jp(Dm).scale(250).clipAngle(142)};function Nm(t,e){return[ah(hh((Yu+e)/2)),-t]}Nm.invert=function(t,e){return[-e,2*th(rh(t))-Yu]};var Fm=function(){var t=fm(Nm),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)};function Bm(t,e){return t.parent===e.parent?1:2}function zm(t,e){return t+e.x}function Um(t,e){return Math.max(t,e.y)}var km=function(){var t=Bm,e=1,n=1,i=!1;function r(r){var o,a=0;r.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(zm,0)/t.length}(n),e.y=function(t){return 1+t.reduce(Um,0)}(n)):(e.x=o?a+=t(e,o):0,e.y=0,o=e)}));var s=function(t){for(var e;e=t.children;)t=e[0];return t}(r),l=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(r),c=s.x-t(s,l)/2,u=l.x+t(l,s)/2;return r.eachAfter(i?function(t){t.x=(t.x-r.x)*e,t.y=(r.y-t.y)*n}:function(t){t.x=(t.x-c)/(u-c)*e,t.y=(1-(r.y?t.y/r.y:1))*n})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r};function jm(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function Vm(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Hm)):void 0===e&&(e=Gm);for(var n,i,r,o,a,s=new Ym(t),l=[s];n=l.pop();)if((r=e(n.data))&&(a=(r=Array.from(r)).length))for(n.children=r,o=a-1;o>=0;--o)l.push(i=r[o]=new Ym(r[o])),i.parent=n,i.depth=n.depth+1;return s.eachBefore(Xm)}function Gm(t){return t.children}function Hm(t){return Array.isArray(t)?t[1]:null}function Wm(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Xm(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ym(t){this.data=t,this.depth=this.height=0,this.parent=null}Ym.prototype=Vm.prototype={constructor:Ym,count:function(){return this.eachAfter(jm)},each:function(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,o=this,a=[o],s=[],l=-1;o=a.pop();)if(s.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)a.push(n[i]);for(;o=s.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,o=[r],a=-1;r=o.pop();)if(t.call(e,r,++a,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;t=n.pop(),e=i.pop();for(;t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return Vm(this).eachBefore(Wm)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,o=[r];do{for(t=o.reverse(),o=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)o.push(e[n])}while(o.length)}};var Zm=function(t){for(var e,n,i=0,r=(t=function(t){for(var e,n,i=t.length;i;)n=Math.random()*i--|0,e=t[i],t[i]=t[n],t[n]=e;return t}(Array.from(t))).length,o=[];i<r;)e=t[i],n&&Km(n,e)?++i:(n=tg(o=Qm(o,e)),i=0);return n};function Qm(t,e){var n,i;if($m(e,t))return[e];for(n=0;n<t.length;++n)if(Jm(e,t[n])&&$m(eg(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(i=n+1;i<t.length;++i)if(Jm(eg(t[n],t[i]),e)&&Jm(eg(t[n],e),t[i])&&Jm(eg(t[i],e),t[n])&&$m(ng(t[n],t[i],e),t))return[t[n],t[i],e];throw new Error}function Jm(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function Km(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function $m(t,e){for(var n=0;n<e.length;++n)if(!Km(t,e[n]))return!1;return!0}function tg(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return eg(t[0],t[1]);case 3:return ng(t[0],t[1],t[2])}var e}function eg(t,e){var n=t.x,i=t.y,r=t.r,o=e.x,a=e.y,s=e.r,l=o-n,c=a-i,u=s-r,h=Math.sqrt(l*l+c*c);return{x:(n+o+l/h*u)/2,y:(i+a+c/h*u)/2,r:(h+r+s)/2}}function ng(t,e,n){var i=t.x,r=t.y,o=t.r,a=e.x,s=e.y,l=e.r,c=n.x,u=n.y,h=n.r,f=i-a,d=i-c,p=r-s,m=r-u,g=l-o,v=h-o,y=i*i+r*r-o*o,x=y-a*a-s*s+l*l,b=y-c*c-u*u+h*h,w=d*p-f*m,_=(p*b-m*x)/(2*w)-i,M=(m*g-p*v)/w,S=(d*x-f*b)/(2*w)-r,T=(f*v-d*g)/w,A=M*M+T*T-1,E=2*(o+_*M+S*T),q=_*_+S*S-o*o,C=-(A?(E+Math.sqrt(E*E-4*A*q))/(2*A):q/E);return{x:i+_+M*C,y:r+S+T*C,r:C}}function ig(t,e,n){var i,r,o,a,s=t.x-e.x,l=t.y-e.y,c=s*s+l*l;c?(r=e.r+n.r,r*=r,a=t.r+n.r,r>(a*=a)?(i=(c+a-r)/(2*c),o=Math.sqrt(Math.max(0,a/c-i*i)),n.x=t.x-i*s-o*l,n.y=t.y-i*l+o*s):(i=(c+r-a)/(2*c),o=Math.sqrt(Math.max(0,r/c-i*i)),n.x=e.x+i*s-o*l,n.y=e.y+i*l+o*s)):(n.x=e.x+n.r,n.y=e.y)}function rg(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function og(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,o=(e.y*n.r+n.y*e.r)/i;return r*r+o*o}function ag(t){this._=t,this.next=null,this.previous=null}function sg(t){if(!(o=(e=t,t="object"==typeof e&&"length"in e?e:Array.from(e)).length))return 0;var e,n,i,r,o,a,s,l,c,u,h,f;if((n=t[0]).x=0,n.y=0,!(o>1))return n.r;if(i=t[1],n.x=-i.r,i.x=n.r,i.y=0,!(o>2))return n.r+i.r;ig(i,n,r=t[2]),n=new ag(n),i=new ag(i),r=new ag(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;t:for(l=3;l<o;++l){ig(n._,i._,r=t[l]),r=new ag(r),c=i.next,u=n.previous,h=i._.r,f=n._.r;do{if(h<=f){if(rg(c._,r._)){i=c,n.next=i,i.previous=n,--l;continue t}h+=c._.r,c=c.next}else{if(rg(u._,r._)){(n=u).next=i,i.previous=n,--l;continue t}f+=u._.r,u=u.previous}}while(c!==u.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,a=og(n);(r=r.next)!==i;)(s=og(r))<a&&(n=r,a=s);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=Zm(n),l=0;l<o;++l)(n=t[l]).x-=r.x,n.y-=r.y;return r.r}var lg=function(t){return sg(t),t};function cg(t){return null==t?null:ug(t)}function ug(t){if("function"!=typeof t)throw new Error;return t}function hg(){return 0}var fg=function(t){return function(){return t}};function dg(t){return Math.sqrt(t.value)}var pg=function(){var t=null,e=1,n=1,i=hg;function r(r){return r.x=e/2,r.y=n/2,t?r.eachBefore(mg(t)).eachAfter(gg(i,.5)).eachBefore(vg(1)):r.eachBefore(mg(dg)).eachAfter(gg(hg,1)).eachAfter(gg(i,r.r/Math.min(e,n))).eachBefore(vg(Math.min(e,n)/(2*r.r))),r}return r.radius=function(e){return arguments.length?(t=cg(e),r):t},r.size=function(t){return arguments.length?(e=+t[0],n=+t[1],r):[e,n]},r.padding=function(t){return arguments.length?(i="function"==typeof t?t:fg(+t),r):i},r};function mg(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function gg(t,e){return function(n){if(i=n.children){var i,r,o,a=i.length,s=t(n)*e||0;if(s)for(r=0;r<a;++r)i[r].r+=s;if(o=sg(i),s)for(r=0;r<a;++r)i[r].r-=s;n.r=o+s}}}function vg(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}var yg=function(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)},xg=function(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(i-e)/t.value;++s<l;)(o=a[s]).y0=n,o.y1=r,o.x0=e,o.x1=e+=o.value*c},bg=function(){var t=1,e=1,n=0,i=!1;function r(r){var o=r.height+1;return r.x0=r.y0=n,r.x1=t,r.y1=e/o,r.eachBefore(function(t,e){return function(i){i.children&&xg(i,i.x0,t*(i.depth+1)/e,i.x1,t*(i.depth+2)/e);var r=i.x0,o=i.y0,a=i.x1-n,s=i.y1-n;a<r&&(r=a=(r+a)/2),s<o&&(o=s=(o+s)/2),i.x0=r,i.y0=o,i.x1=a,i.y1=s}}(e,o)),i&&r.eachBefore(yg),r}return r.round=function(t){return arguments.length?(i=!!t,r):i},r.size=function(n){return arguments.length?(t=+n[0],e=+n[1],r):[t,e]},r.padding=function(t){return arguments.length?(n=+t,r):n},r},wg={depth:-1},_g={};function Mg(t){return t.id}function Sg(t){return t.parentId}var Tg=function(){var t=Mg,e=Sg;function n(n){var i,r,o,a,s,l,c,u=Array.from(n),h=u.length,f=new Map;for(r=0;r<h;++r)i=u[r],s=u[r]=new Ym(i),null!=(l=t(i,r,n))&&(l+="")&&(c=s.id=l,f.set(c,f.has(c)?_g:s)),null!=(l=e(i,r,n))&&(l+="")&&(s.parent=l);for(r=0;r<h;++r)if(l=(s=u[r]).parent){if(!(a=f.get(l)))throw new Error("missing: "+l);if(a===_g)throw new Error("ambiguous: "+l);a.children?a.children.push(s):a.children=[s],s.parent=a}else{if(o)throw new Error("multiple roots");o=s}if(!o)throw new Error("no root");if(o.parent=wg,o.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(Xm),o.parent=null,h>0)throw new Error("cycle");return o}return n.id=function(e){return arguments.length?(t=ug(e),n):t},n.parentId=function(t){return arguments.length?(e=ug(t),n):e},n};function Ag(t,e){return t.parent===e.parent?1:2}function Eg(t){var e=t.children;return e?e[0]:t.t}function qg(t){var e=t.children;return e?e[e.length-1]:t.t}function Cg(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Pg(t,e,n){return t.a.parent===e.parent?t.a:n}function Rg(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}Rg.prototype=Object.create(Ym.prototype);var Lg=function(){var t=Ag,e=1,n=1,i=null;function r(r){var l=function(t){for(var e,n,i,r,o,a=new Rg(t,0),s=[a];e=s.pop();)if(i=e._.children)for(e.children=new Array(o=i.length),r=o-1;r>=0;--r)s.push(n=e.children[r]=new Rg(i[r],r)),n.parent=e;return(a.parent=new Rg(null,0)).children=[a],a}(r);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(a),i)r.eachBefore(s);else{var c=r,u=r,h=r;r.eachBefore((function(t){t.x<c.x&&(c=t),t.x>u.x&&(u=t),t.depth>h.depth&&(h=t)}));var f=c===u?1:t(c,u)/2,d=f-c.x,p=e/(u.x+f+d),m=n/(h.depth||1);r.eachBefore((function(t){t.x=(t.x+d)*p,t.y=t.depth*m}))}return r}function o(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){!function(t){for(var e,n=0,i=0,r=t.children,o=r.length;--o>=0;)(e=r[o]).z+=n,e.m+=n,n+=e.s+(i+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-o):e.z=o}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,n,i){if(n){for(var r,o=e,a=e,s=n,l=o.parent.children[0],c=o.m,u=a.m,h=s.m,f=l.m;s=qg(s),o=Eg(o),s&&o;)l=Eg(l),(a=qg(a)).a=e,(r=s.z+h-o.z-c+t(s._,o._))>0&&(Cg(Pg(s,e,i),e,r),c+=r,u+=r),h+=s.m,c+=o.m,f+=l.m,u+=a.m;s&&!qg(a)&&(a.t=s,a.m+=h-u),o&&!Eg(l)&&(l.t=o,l.m+=c-f,i=e)}return i}(e,r,e.parent.A||i[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r},Ig=function(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(r-n)/t.value;++s<l;)(o=a[s]).x0=e,o.x1=i,o.y0=n,o.y1=n+=o.value*c},Dg=(1+Math.sqrt(5))/2;function Og(t,e,n,i,r,o){for(var a,s,l,c,u,h,f,d,p,m,g,v=[],y=e.children,x=0,b=0,w=y.length,_=e.value;x<w;){l=r-n,c=o-i;do{u=y[b++].value}while(!u&&b<w);for(h=f=u,g=u*u*(m=Math.max(c/l,l/c)/(_*t)),p=Math.max(f/g,g/h);b<w;++b){if(u+=s=y[b].value,s<h&&(h=s),s>f&&(f=s),g=u*u*m,(d=Math.max(f/g,g/h))>p){u-=s;break}p=d}v.push(a={value:u,dice:l<c,children:y.slice(x,b)}),a.dice?xg(a,n,i,r,_?i+=c*u/_:o):Ig(a,n,i,_?n+=l*u/_:r,o),_-=u,x=b}return v}var Ng=function t(e){function n(t,n,i,r,o){Og(e,t,n,i,r,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Dg),Fg=function(){var t=Ng,e=!1,n=1,i=1,r=[0],o=hg,a=hg,s=hg,l=hg,c=hg;function u(t){return t.x0=t.y0=0,t.x1=n,t.y1=i,t.eachBefore(h),r=[0],e&&t.eachBefore(yg),t}function h(e){var n=r[e.depth],i=e.x0+n,u=e.y0+n,h=e.x1-n,f=e.y1-n;h<i&&(i=h=(i+h)/2),f<u&&(u=f=(u+f)/2),e.x0=i,e.y0=u,e.x1=h,e.y1=f,e.children&&(n=r[e.depth+1]=o(e)/2,i+=c(e)-n,u+=a(e)-n,(h-=s(e)-n)<i&&(i=h=(i+h)/2),(f-=l(e)-n)<u&&(u=f=(u+f)/2),t(e,i,u,h,f))}return u.round=function(t){return arguments.length?(e=!!t,u):e},u.size=function(t){return arguments.length?(n=+t[0],i=+t[1],u):[n,i]},u.tile=function(e){return arguments.length?(t=ug(e),u):t},u.padding=function(t){return arguments.length?u.paddingInner(t).paddingOuter(t):u.paddingInner()},u.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:fg(+t),u):o},u.paddingOuter=function(t){return arguments.length?u.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):u.paddingTop()},u.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:fg(+t),u):a},u.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:fg(+t),u):s},u.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:fg(+t),u):l},u.paddingLeft=function(t){return arguments.length?(c="function"==typeof t?t:fg(+t),u):c},u},Bg=function(t,e,n,i,r){var o,a,s=t.children,l=s.length,c=new Array(l+1);for(c[0]=a=o=0;o<l;++o)c[o+1]=a+=s[o].value;!function t(e,n,i,r,o,a,l){if(e>=n-1){var u=s[e];return u.x0=r,u.y0=o,u.x1=a,void(u.y1=l)}var h=c[e],f=i/2+h,d=e+1,p=n-1;for(;d<p;){var m=d+p>>>1;c[m]<f?d=m+1:p=m}f-c[d-1]<c[d]-f&&e+1<d&&--d;var g=c[d]-h,v=i-g;if(a-r>l-o){var y=i?(r*v+a*g)/i:a;t(e,d,g,r,o,y,l),t(d,n,v,y,o,a,l)}else{var x=i?(o*v+l*g)/i:l;t(e,d,g,r,o,a,x),t(d,n,v,r,x,a,l)}}(0,l,t.value,e,n,i,r)},zg=function(t,e,n,i,r){(1&t.depth?Ig:xg)(t,e,n,i,r)},Ug=function t(e){function n(t,n,i,r,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,l,c,u,h=-1,f=a.length,d=t.value;++h<f;){for(l=(s=a[h]).children,c=s.value=0,u=l.length;c<u;++c)s.value+=l[c].value;s.dice?xg(s,n,i,r,d?i+=(o-i)*s.value/d:o):Ig(s,n,i,d?n+=(r-n)*s.value/d:r,o),d-=s.value}else t._squarify=a=Og(e,t,n,i,r,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Dg);function kg(t,e,n,i,r){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*i+a*r)/6}var jg=function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],a=i>0?t[i-1]:2*r-o,s=i<e-1?t[i+2]:2*o-r;return kg((n-i/e)*e,a,r,o,s)}},Vg=function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],o=t[i%e],a=t[(i+1)%e],s=t[(i+2)%e];return kg((n-i/e)*e,r,o,a,s)}},Gg=t=>()=>t;function Hg(t,e){return function(n){return t+n*e}}function Wg(t,e){var n=e-t;return n?Hg(t,n>180||n<-180?n-360*Math.round(n/360):n):Gg(isNaN(t)?e:t)}function Xg(t){return 1==(t=+t)?Yg:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):Gg(isNaN(e)?n:e)}}function Yg(t,e){var n=e-t;return n?Hg(t,n):Gg(isNaN(t)?e:t)}var Zg=function t(e){var n=Xg(e);function i(t,e){var i=n((t=Vo(t)).r,(e=Vo(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),a=Yg(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);function Qg(t){return function(e){var n,i,r=e.length,o=new Array(r),a=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=Vo(e[n]),o[n]=i.r||0,a[n]=i.g||0,s[n]=i.b||0;return o=t(o),a=t(a),s=t(s),i.opacity=1,function(t){return i.r=o(t),i.g=a(t),i.b=s(t),i+""}}}var Jg=Qg(jg),Kg=Qg(Vg),$g=function(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(o){for(n=0;n<i;++n)r[n]=t[n]*(1-o)+e[n]*o;return r}};function tv(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}var ev=function(t,e){return(tv(e)?$g:nv)(t,e)};function nv(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),a=new Array(i);for(n=0;n<r;++n)o[n]=uv(t[n],e[n]);for(;n<i;++n)a[n]=e[n];return function(t){for(n=0;n<r;++n)a[n]=o[n](t);return a}}var iv=function(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}},rv=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},ov=function(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=uv(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}},av=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,sv=new RegExp(av.source,"g");var lv,cv=function(t,e){var n,i,r,o=av.lastIndex=sv.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=av.exec(t))&&(i=sv.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:rv(n,i)})),o=sv.lastIndex;return o<e.length&&(r=e.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})},uv=function(t,e){var n,i=typeof e;return null==e||"boolean"===i?Gg(e):("number"===i?rv:"string"===i?(n=zo(e))?(e=n,Zg):cv:e instanceof zo?Zg:e instanceof Date?iv:tv(e)?$g:Array.isArray(e)?nv:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ov:rv)(t,e)},hv=function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},fv=function(t,e){var n=Wg(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},dv=function(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}},pv=180/Math.PI,mv={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},gv=function(t,e,n,i,r,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*pv,skewX:Math.atan(l)*pv,scaleX:a,scaleY:s}};function vv(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,i,r,o,a,s){if(t!==r||i!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:rv(t,r)},{i:l-2,x:rv(i,o)})}else(r||o)&&a.push("translate("+r+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:rv(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:rv(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(o.skewX,a.skewX,s,l),function(t,e,n,i,o,a){if(t!==n||e!==i){var s=o.push(r(o)+"scale(",null,",",null,")");a.push({i:s-4,x:rv(t,n)},{i:s-2,x:rv(e,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var yv=vv((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?mv:gv(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),xv=vv((function(t){return null==t?mv:(lv||(lv=document.createElementNS("http://www.w3.org/2000/svg","g")),lv.setAttribute("transform",t),(t=lv.transform.baseVal.consolidate())?(t=t.matrix,gv(t.a,t.b,t.c,t.d,t.e,t.f)):mv)}),", ",")",")");function bv(t){return((t=Math.exp(t))+1/t)/2}var wv=function t(e,n,i){function r(t,r){var o,a,s=t[0],l=t[1],c=t[2],u=r[0],h=r[1],f=r[2],d=u-s,p=h-l,m=d*d+p*p;if(m<1e-12)a=Math.log(f/c)/e,o=function(t){return[s+t*d,l+t*p,c*Math.exp(e*t*a)]};else{var g=Math.sqrt(m),v=(f*f-c*c+i*m)/(2*c*n*g),y=(f*f-c*c-i*m)/(2*f*n*g),x=Math.log(Math.sqrt(v*v+1)-v),b=Math.log(Math.sqrt(y*y+1)-y);a=(b-x)/e,o=function(t){var i,r=t*a,o=bv(x),u=c/(n*g)*(o*(i=e*r+x,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(x));return[s+u*d,l+u*p,c*o/bv(e*r+x)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);function _v(t){return function(e,n){var i=t((e=Qo(e)).h,(n=Qo(n)).h),r=Yg(e.s,n.s),o=Yg(e.l,n.l),a=Yg(e.opacity,n.opacity);return function(t){return e.h=i(t),e.s=r(t),e.l=o(t),e.opacity=a(t),e+""}}}var Mv=_v(Wg),Sv=_v(Yg);function Tv(t,e){var n=Yg((t=ia(t)).l,(e=ia(e)).l),i=Yg(t.a,e.a),r=Yg(t.b,e.b),o=Yg(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=i(e),t.b=r(e),t.opacity=o(e),t+""}}function Av(t){return function(e,n){var i=t((e=ha(e)).h,(n=ha(n)).h),r=Yg(e.c,n.c),o=Yg(e.l,n.l),a=Yg(e.opacity,n.opacity);return function(t){return e.h=i(t),e.c=r(t),e.l=o(t),e.opacity=a(t),e+""}}}var Ev=Av(Wg),qv=Av(Yg);function Cv(t){return function e(n){function i(e,i){var r=t((e=xa(e)).h,(i=xa(i)).h),o=Yg(e.s,i.s),a=Yg(e.l,i.l),s=Yg(e.opacity,i.opacity);return function(t){return e.h=r(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,i.gamma=e,i}(1)}var Pv=Cv(Wg),Rv=Cv(Yg);function Lv(t,e){void 0===e&&(e=t,t=uv);for(var n=0,i=e.length-1,r=e[0],o=new Array(i<0?0:i);n<i;)o[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return o[e](t-e)}}var Iv=function(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t(i/(e-1));return n};const Dv=Math.PI,Ov=2*Dv,Nv=Ov-1e-6;function Fv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Bv(){return new Fv}Fv.prototype=Bv.prototype={constructor:Fv,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var o=this._x1,a=this._y1,s=n-t,l=i-e,c=o-t,u=a-e,h=c*c+u*u;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(u*s-l*c)>1e-6&&r){var f=n-o,d=i-a,p=s*s+l*l,m=f*f+d*d,g=Math.sqrt(p),v=Math.sqrt(h),y=r*Math.tan((Dv-Math.acos((p+h-m)/(2*g*v)))/2),x=y/v,b=y/g;Math.abs(x-1)>1e-6&&(this._+="L"+(t+x*c)+","+(e+x*u)),this._+="A"+r+","+r+",0,0,"+ +(u*f>c*d)+","+(this._x1=t+b*s)+","+(this._y1=e+b*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,i,r,o){t=+t,e=+e,o=!!o;var a=(n=+n)*Math.cos(i),s=n*Math.sin(i),l=t+a,c=e+s,u=1^o,h=o?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+l+","+c),n&&(h<0&&(h=h%Ov+Ov),h>Nv?this._+="A"+n+","+n+",0,1,"+u+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=Dv)+","+u+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var zv=Bv,Uv=function(t){for(var e,n=-1,i=t.length,r=t[i-1],o=0;++n<i;)e=r,r=t[n],o+=e[1]*r[0]-e[0]*r[1];return o/2},kv=function(t){for(var e,n,i=-1,r=t.length,o=0,a=0,s=t[r-1],l=0;++i<r;)e=s,s=t[i],l+=n=e[0]*s[1]-s[0]*e[1],o+=(e[0]+s[0])*n,a+=(e[1]+s[1])*n;return[o/(l*=3),a/l]};function jv(t,e){return t[0]-e[0]||t[1]-e[1]}function Vv(t){const e=t.length,n=[0,1];let i,r=2;for(i=2;i<e;++i){for(;r>1&&(o=t[n[r-2]],a=t[n[r-1]],s=t[i],(a[0]-o[0])*(s[1]-o[1])-(a[1]-o[1])*(s[0]-o[0])<=0);)--r;n[r++]=i}var o,a,s;return n.slice(0,r)}var Gv=function(t){if((n=t.length)<3)return null;var e,n,i=new Array(n),r=new Array(n);for(e=0;e<n;++e)i[e]=[+t[e][0],+t[e][1],e];for(i.sort(jv),e=0;e<n;++e)r[e]=[i[e][0],-i[e][1]];var o=Vv(i),a=Vv(r),s=a[0]===o[0],l=a[a.length-1]===o[o.length-1],c=[];for(e=o.length-1;e>=0;--e)c.push(t[i[o[e]][2]]);for(e=+s;e<a.length-l;++e)c.push(t[i[a[e]][2]]);return c},Hv=function(t,e){for(var n,i,r=t.length,o=t[r-1],a=e[0],s=e[1],l=o[0],c=o[1],u=!1,h=0;h<r;++h)n=(o=t[h])[0],(i=o[1])>s!=c>s&&a<(l-n)*(s-i)/(c-i)+n&&(u=!u),l=n,c=i;return u},Wv=function(t){for(var e,n,i=-1,r=t.length,o=t[r-1],a=o[0],s=o[1],l=0;++i<r;)e=a,n=s,e-=a=(o=t[i])[0],n-=s=o[1],l+=Math.hypot(e,n);return l},Xv=Math.random,Yv=function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,1===arguments.length?(n=t,t=0):n-=t,function(){return e()*n+t}}return n.source=t,n}(Xv),Zv=function t(e){function n(t,n){return arguments.length<2&&(n=t,t=0),t=Math.floor(t),n=Math.floor(n)-t,function(){return Math.floor(e()*n+t)}}return n.source=t,n}(Xv),Qv=function t(e){function n(t,n){var i,r;return t=null==t?0:+t,n=null==n?1:+n,function(){var o;if(null!=i)o=i,i=null;else do{i=2*e()-1,o=2*e()-1,r=i*i+o*o}while(!r||r>1);return t+n*o*Math.sqrt(-2*Math.log(r)/r)}}return n.source=t,n}(Xv),Jv=function t(e){var n=Qv.source(e);function i(){var t=n.apply(this,arguments);return function(){return Math.exp(t())}}return i.source=t,i}(Xv),Kv=function t(e){function n(t){return(t=+t)<=0?()=>0:function(){for(var n=0,i=t;i>1;--i)n+=e();return n+i*e()}}return n.source=t,n}(Xv),$v=function t(e){var n=Kv.source(e);function i(t){if(0==(t=+t))return e;var i=n(t);return function(){return i()/t}}return i.source=t,i}(Xv),ty=function t(e){function n(t){return function(){return-Math.log1p(-e())/t}}return n.source=t,n}(Xv),ey=function t(e){function n(t){if((t=+t)<0)throw new RangeError("invalid alpha");return t=1/-t,function(){return Math.pow(1-e(),t)}}return n.source=t,n}(Xv),ny=function t(e){function n(t){if((t=+t)<0||t>1)throw new RangeError("invalid p");return function(){return Math.floor(e()+t)}}return n.source=t,n}(Xv),iy=function t(e){function n(t){if((t=+t)<0||t>1)throw new RangeError("invalid p");return 0===t?()=>1/0:1===t?()=>1:(t=Math.log1p(-t),function(){return 1+Math.floor(Math.log1p(-e())/t)})}return n.source=t,n}(Xv),ry=function t(e){var n=Qv.source(e)();function i(t,i){if((t=+t)<0)throw new RangeError("invalid k");if(0===t)return()=>0;if(i=null==i?1:+i,1===t)return()=>-Math.log1p(-e())*i;var r=(t<1?t+1:t)-1/3,o=1/(3*Math.sqrt(r)),a=t<1?()=>Math.pow(e(),1/t):()=>1;return function(){do{do{var t=n(),s=1+o*t}while(s<=0);s*=s*s;var l=1-e()}while(l>=1-.0331*t*t*t*t&&Math.log(l)>=.5*t*t+r*(1-s+Math.log(s)));return r*s*a()*i}}return i.source=t,i}(Xv),oy=function t(e){var n=ry.source(e);function i(t,e){var i=n(t),r=n(e);return function(){var t=i();return 0===t?0:t/(t+r())}}return i.source=t,i}(Xv),ay=function t(e){var n=iy.source(e),i=oy.source(e);function r(t,e){return t=+t,(e=+e)>=1?()=>t:e<=0?()=>0:function(){for(var r=0,o=t,a=e;o*a>16&&o*(1-a)>16;){var s=Math.floor((o+1)*a),l=i(s,o-s+1)();l<=a?(r+=s,o-=s,a=(a-l)/(1-l)):(o=s-1,a/=l)}for(var c=a<.5,u=n(c?a:1-a),h=u(),f=0;h<=o;++f)h+=u();return r+(c?f:o-f)}}return r.source=t,r}(Xv),sy=function t(e){function n(t,n,i){var r;return 0==(t=+t)?r=t=>-Math.log(t):(t=1/t,r=e=>Math.pow(e,t)),n=null==n?0:+n,i=null==i?1:+i,function(){return n+i*r(-Math.log1p(-e()))}}return n.source=t,n}(Xv),ly=function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,function(){return t+n*Math.tan(Math.PI*e())}}return n.source=t,n}(Xv),cy=function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,function(){var i=e();return t+n*Math.log(i/(1-i))}}return n.source=t,n}(Xv),uy=function t(e){var n=ry.source(e),i=ay.source(e);function r(t){return function(){for(var r=0,o=t;o>16;){var a=Math.floor(.875*o),s=n(a)();if(s>o)return r+i(a-1,o/s)();r+=a,o-=s}for(var l=-Math.log1p(-e()),c=0;l<=o;++c)l-=Math.log1p(-e());return r+c}}return r.source=t,r}(Xv);const hy=1/4294967296;function fy(t=Math.random()){let e=0|(0<=t&&t<1?t/hy:Math.abs(t));return()=>(e=1664525*e+1013904223|0,hy*(e>>>0))}function dy(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function py(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const my=Symbol("implicit");function gy(){var t=new Map,e=[],n=[],i=my;function r(r){var o=r+"",a=t.get(o);if(!a){if(i!==my)return i;t.set(o,a=e.push(r))}return n[(a-1)%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of n){const n=i+"";t.has(n)||t.set(n,e.push(i))}return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return gy(e,n).unknown(i)},dy.apply(r,arguments),r}function vy(){var t,e,n=gy().unknown(void 0),i=n.domain,r=n.range,o=0,a=1,s=!1,l=0,c=0,u=.5;function h(){var n=i().length,h=a<o,f=h?a:o,d=h?o:a;t=(d-f)/Math.max(1,n-l+2*c),s&&(t=Math.floor(t)),f+=(d-f-t*(n-l))*u,e=t*(1-l),s&&(f=Math.round(f),e=Math.round(e));var p=at(n).map((function(e){return f+t*e}));return r(h?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(i(t),h()):i()},n.range=function(t){return arguments.length?([o,a]=t,o=+o,a=+a,h()):[o,a]},n.rangeRound=function(t){return[o,a]=t,o=+o,a=+a,s=!0,h()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,h()):s},n.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),h()):l},n.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),h()):l},n.paddingOuter=function(t){return arguments.length?(c=+t,h()):c},n.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),h()):u},n.copy=function(){return vy(i(),[o,a]).round(s).paddingInner(l).paddingOuter(c).align(u)},dy.apply(h(),arguments)}function yy(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return yy(e())},t}function xy(){return yy(vy.apply(null,arguments).paddingInner(1))}var by=function(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}};function wy(t){return+t}var _y=[0,1];function My(t){return t}function Sy(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Ty(t,e,n){var i=t[0],r=t[1],o=e[0],a=e[1];return r<i?(i=Sy(r,i),o=n(a,o)):(i=Sy(i,r),o=n(o,a)),function(t){return o(i(t))}}function Ay(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),o=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<i;)r[a]=Sy(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=u(t,e,1,i)-1;return o[n](r[n](e))}}function Ey(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function qy(){var t,e,n,i,r,o,a=_y,s=_y,l=ri,c=My;function u(){var t,e,n,l=Math.min(a.length,s.length);return c!==My&&(t=a[0],e=a[l-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),i=l>2?Ay:Ty,r=o=null,h}function h(e){return isNaN(e=+e)?n:(r||(r=i(a.map(t),s,l)))(t(c(e)))}return h.invert=function(n){return c(e((o||(o=i(s,a.map(t),Jn)))(n)))},h.domain=function(t){return arguments.length?(a=Array.from(t,wy),u()):a.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),u()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),l=by,u()},h.clamp=function(t){return arguments.length?(c=!!t||My,u()):c!==My},h.interpolate=function(t){return arguments.length?(l=t,u()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,i){return t=n,e=i,u()}}function Cy(){return qy()(My,My)}function Py(t,e,n,i){var r,o=U(t,e,n);switch((i=Ru(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=Hu(o,a))||(i.precision=r),Nu(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=Wu(o,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=Gu(o))||(i.precision=r-2*("%"===i.type))}return Ou(i)}function Ry(t){var e=t.domain;return t.ticks=function(t){var n=e();return B(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return Py(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,o=e(),a=0,s=o.length-1,l=o[a],c=o[s],u=10;for(c<l&&(r=l,l=c,c=r,r=a,a=s,s=r);u-- >0;){if((r=z(l,c,n))===i)return o[a]=l,o[s]=c,e(o);if(r>0)l=Math.floor(l/r)*r,c=Math.ceil(c/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,c=Math.floor(c*r)/r}i=r}return t},t}function Ly(){var t=Cy();return t.copy=function(){return Ey(t,Ly())},dy.apply(t,arguments),Ry(t)}function Iy(t){var e;function n(t){return isNaN(t=+t)?e:t}return n.invert=n,n.domain=n.range=function(e){return arguments.length?(t=Array.from(e,wy),n):t.slice()},n.unknown=function(t){return arguments.length?(e=t,n):e},n.copy=function(){return Iy(t).unknown(e)},t=arguments.length?Array.from(t,wy):[0,1],Ry(n)}function Dy(t,e){var n,i=0,r=(t=t.slice()).length-1,o=t[i],a=t[r];return a<o&&(n=i,i=r,r=n,n=o,o=a,a=n),t[i]=e.floor(o),t[r]=e.ceil(a),t}function Oy(t){return Math.log(t)}function Ny(t){return Math.exp(t)}function Fy(t){return-Math.log(-t)}function By(t){return-Math.exp(-t)}function zy(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Uy(t){return function(e){return-t(-e)}}function ky(t){var e,n,i=t(Oy,Ny),r=i.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?zy:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),r()[0]<0?(e=Uy(e),n=Uy(n),t(Fy,By)):t(Oy,Ny),i}return i.base=function(t){return arguments.length?(o=+t,a()):o},i.domain=function(t){return arguments.length?(r(t),a()):r()},i.ticks=function(t){var i,a=r(),s=a[0],l=a[a.length-1];(i=l<s)&&(f=s,s=l,l=f);var c,u,h,f=e(s),d=e(l),p=null==t?10:+t,m=[];if(!(o%1)&&d-f<p){if(f=Math.floor(f),d=Math.ceil(d),s>0){for(;f<=d;++f)for(u=1,c=n(f);u<o;++u)if(!((h=c*u)<s)){if(h>l)break;m.push(h)}}else for(;f<=d;++f)for(u=o-1,c=n(f);u>=1;--u)if(!((h=c*u)<s)){if(h>l)break;m.push(h)}2*m.length<p&&(m=B(s,l,p))}else m=B(f,d,Math.min(d-f,p)).map(n);return i?m.reverse():m},i.tickFormat=function(t,r){if(null==r&&(r=10===o?".0e":","),"function"!=typeof r&&(r=Ou(r)),t===1/0)return r;null==t&&(t=10);var a=Math.max(1,o*t/i.ticks().length);return function(t){var i=t/n(Math.round(e(t)));return i*o<o-.5&&(i*=o),i<=a?r(t):""}},i.nice=function(){return r(Dy(r(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},i}function jy(){var t=ky(qy()).domain([1,10]);return t.copy=function(){return Ey(t,jy()).base(t.base())},dy.apply(t,arguments),t}function Vy(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function Gy(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Hy(t){var e=1,n=t(Vy(e),Gy(e));return n.constant=function(n){return arguments.length?t(Vy(e=+n),Gy(e)):e},Ry(n)}function Wy(){var t=Hy(qy());return t.copy=function(){return Ey(t,Wy()).constant(t.constant())},dy.apply(t,arguments)}function Xy(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Yy(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Zy(t){return t<0?-t*t:t*t}function Qy(t){var e=t(My,My),n=1;function i(){return 1===n?t(My,My):.5===n?t(Yy,Zy):t(Xy(n),Xy(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,i()):n},Ry(e)}function Jy(){var t=Qy(qy());return t.copy=function(){return Ey(t,Jy()).exponent(t.exponent())},dy.apply(t,arguments),t}function Ky(){return Jy.apply(null,arguments).exponent(.5)}function $y(t){return Math.sign(t)*t*t}function tx(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function ex(){var t,e=Cy(),n=[0,1],i=!1;function r(n){var r=tx(e(n));return isNaN(r)?t:i?Math.round(r):r}return r.invert=function(t){return e.invert($y(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain()},r.range=function(t){return arguments.length?(e.range((n=Array.from(t,wy)).map($y)),r):n.slice()},r.rangeRound=function(t){return r.range(t).round(!0)},r.round=function(t){return arguments.length?(i=!!t,r):i},r.clamp=function(t){return arguments.length?(e.clamp(t),r):e.clamp()},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return ex(e.domain(),n).round(i).clamp(e.clamp()).unknown(t)},dy.apply(r,arguments),Ry(r)}function nx(){var t,e=[],n=[],r=[];function o(){var t=0,i=Math.max(1,n.length);for(r=new Array(i-1);++t<i;)r[t-1]=Z(e,t/i);return a}function a(e){return isNaN(e=+e)?t:n[u(r,e)]}return a.invertExtent=function(t){var i=n.indexOf(t);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},a.domain=function(t){if(!arguments.length)return e.slice();e=[];for(let n of t)null==n||isNaN(n=+n)||e.push(n);return e.sort(i),o()},a.range=function(t){return arguments.length?(n=Array.from(t),o()):n.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return r.slice()},a.copy=function(){return nx().domain(e).range(n).unknown(t)},dy.apply(a,arguments)}function ix(){var t,e=0,n=1,i=1,r=[.5],o=[0,1];function a(e){return e<=e?o[u(r,e,0,i)]:t}function s(){var t=-1;for(r=new Array(i);++t<i;)r[t]=((t+1)*n-(t-i)*e)/(i+1);return a}return a.domain=function(t){return arguments.length?([e,n]=t,e=+e,n=+n,s()):[e,n]},a.range=function(t){return arguments.length?(i=(o=Array.from(t)).length-1,s()):o.slice()},a.invertExtent=function(t){var a=o.indexOf(t);return a<0?[NaN,NaN]:a<1?[e,r[0]]:a>=i?[r[i-1],n]:[r[a-1],r[a]]},a.unknown=function(e){return arguments.length?(t=e,a):a},a.thresholds=function(){return r.slice()},a.copy=function(){return ix().domain([e,n]).range(o).unknown(t)},dy.apply(Ry(a),arguments)}function rx(){var t,e=[.5],n=[0,1],i=1;function r(r){return r<=r?n[u(e,r,0,i)]:t}return r.domain=function(t){return arguments.length?(e=Array.from(t),i=Math.min(e.length,n.length-1),r):e.slice()},r.range=function(t){return arguments.length?(n=Array.from(t),i=Math.min(e.length,n.length-1),r):n.slice()},r.invertExtent=function(t){var i=n.indexOf(t);return[e[i-1],e[i]]},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return rx().domain(e).range(n).unknown(t)},dy.apply(r,arguments)}var ox=new Date,ax=new Date;function sx(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},r.round=function(t){var e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},r.range=function(n,i,o){var a,s=[];if(n=r.ceil(n),o=null==o?1:Math.floor(o),!(n<i&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<i);return s},r.filter=function(n){return sx((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}))},n&&(r.count=function(e,i){return ox.setTime(+e),ax.setTime(+i),t(ox),t(ax),Math.floor(n(ox,ax))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?function(e){return i(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var lx=sx((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));lx.every=function(t){return isFinite(t=Math.floor(t))&&t>0?sx((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var cx=lx,ux=lx.range,hx=sx((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),fx=hx,dx=hx.range;function px(t){return sx((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var mx=px(0),gx=px(1),vx=px(2),yx=px(3),xx=px(4),bx=px(5),wx=px(6),_x=mx.range,Mx=gx.range,Sx=vx.range,Tx=yx.range,Ax=xx.range,Ex=bx.range,qx=wx.range,Cx=sx(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5,t=>t.getDate()-1),Px=Cx,Rx=Cx.range,Lx=sx((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()})),Ix=Lx,Dx=Lx.range,Ox=sx((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()})),Nx=Ox,Fx=Ox.range,Bx=sx((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),zx=Bx,Ux=Bx.range,kx=sx((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));kx.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?sx((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):kx:null};var jx=kx,Vx=kx.range;function Gx(t){return sx((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var Hx=Gx(0),Wx=Gx(1),Xx=Gx(2),Yx=Gx(3),Zx=Gx(4),Qx=Gx(5),Jx=Gx(6),Kx=Hx.range,$x=Wx.range,tb=Xx.range,eb=Yx.range,nb=Zx.range,ib=Qx.range,rb=Jx.range,ob=sx((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1})),ab=ob,sb=ob.range,lb=sx((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));lb.every=function(t){return isFinite(t=Math.floor(t))&&t>0?sx((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var cb=lb,ub=lb.range;function hb(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function fb(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function db(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function pb(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,c=Ab(r),u=Eb(r),h=Ab(o),f=Eb(o),d=Ab(a),p=Eb(a),m=Ab(s),g=Eb(s),v=Ab(l),y=Eb(l),x={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Yb,e:Yb,f:$b,g:uw,G:fw,H:Zb,I:Qb,j:Jb,L:Kb,m:tw,M:ew,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Ow,s:Nw,S:nw,u:iw,U:rw,V:aw,w:sw,W:lw,x:null,X:null,y:cw,Y:hw,Z:dw,"%":Dw},b={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:pw,e:pw,f:xw,g:Pw,G:Lw,H:mw,I:gw,j:vw,L:yw,m:bw,M:ww,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Ow,s:Nw,S:_w,u:Mw,U:Sw,V:Aw,w:Ew,W:qw,x:null,X:null,y:Cw,Y:Rw,Z:Iw,"%":Dw},w={a:function(t,e,n){var i=d.exec(e.slice(n));return i?(t.w=p.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(t,e,n){var i=h.exec(e.slice(n));return i?(t.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(t,e,n){var i=v.exec(e.slice(n));return i?(t.m=y.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(t,e,n){var i=m.exec(e.slice(n));return i?(t.m=g.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(t,n,i){return S(t,e,n,i)},d:Bb,e:Bb,f:Gb,g:Db,G:Ib,H:Ub,I:Ub,j:zb,L:Vb,m:Fb,M:kb,p:function(t,e,n){var i=c.exec(e.slice(n));return i?(t.p=u.get(i[0].toLowerCase()),n+i[0].length):-1},q:Nb,Q:Wb,s:Xb,S:jb,u:Cb,U:Pb,V:Rb,w:qb,W:Lb,x:function(t,e,i){return S(t,n,e,i)},X:function(t,e,n){return S(t,i,e,n)},y:Db,Y:Ib,Z:Ob,"%":Hb};function _(t,e){return function(n){var i,r,o,a=[],s=-1,l=0,c=t.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===t.charCodeAt(s)&&(a.push(t.slice(l,s)),null!=(r=bb[i=t.charAt(++s)])?i=t.charAt(++s):r="e"===i?" ":"0",(o=e[i])&&(i=o(n,r)),a.push(i),l=s+1);return a.push(t.slice(l,s)),a.join("")}}function M(t,e){return function(n){var i,r,o=db(1900,void 0,1);if(S(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(!e||"Z"in o||(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(r=(i=fb(db(o.y,0,1))).getUTCDay(),i=r>4||0===r?Wx.ceil(i):Wx(i),i=ab.offset(i,7*(o.V-1)),o.y=i.getUTCFullYear(),o.m=i.getUTCMonth(),o.d=i.getUTCDate()+(o.w+6)%7):(r=(i=hb(db(o.y,0,1))).getDay(),i=r>4||0===r?gx.ceil(i):gx(i),i=Px.offset(i,7*(o.V-1)),o.y=i.getFullYear(),o.m=i.getMonth(),o.d=i.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),r="Z"in o?fb(db(o.y,0,1)).getUTCDay():hb(db(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(r+5)%7:o.w+7*o.U-(r+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,fb(o)):hb(o)}}function S(t,e,n,i){for(var r,o,a=0,s=e.length,l=n.length;a<s;){if(i>=l)return-1;if(37===(r=e.charCodeAt(a++))){if(r=e.charAt(a++),!(o=w[r in bb?e.charAt(a++):r])||(i=o(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return(x.x=_(n,x),x.X=_(i,x),x.c=_(e,x),b.x=_(n,b),b.X=_(i,b),b.c=_(e,b),{format:function(t){var e=_(t+="",x);return e.toString=function(){return t},e},parse:function(t){var e=M(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=_(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=M(t+="",!0);return e.toString=function(){return t},e}})}var mb,gb,vb,yb,xb,bb={"-":"",_:" ",0:"0"},wb=/^\s*\d+/,_b=/^%/,Mb=/[\\^$*+?|[\]().{}]/g;function Sb(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(e)+r:r)}function Tb(t){return t.replace(Mb,"\\$&")}function Ab(t){return new RegExp("^(?:"+t.map(Tb).join("|")+")","i")}function Eb(t){return new Map(t.map((t,e)=>[t.toLowerCase(),e]))}function qb(t,e,n){var i=wb.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Cb(t,e,n){var i=wb.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function Pb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Rb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function Lb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Ib(t,e,n){var i=wb.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function Db(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function Ob(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Nb(t,e,n){var i=wb.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function Fb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Bb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function zb(t,e,n){var i=wb.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function Ub(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function kb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function jb(t,e,n){var i=wb.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function Vb(t,e,n){var i=wb.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function Gb(t,e,n){var i=wb.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Hb(t,e,n){var i=_b.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function Wb(t,e,n){var i=wb.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function Xb(t,e,n){var i=wb.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function Yb(t,e){return Sb(t.getDate(),e,2)}function Zb(t,e){return Sb(t.getHours(),e,2)}function Qb(t,e){return Sb(t.getHours()%12||12,e,2)}function Jb(t,e){return Sb(1+Px.count(cx(t),t),e,3)}function Kb(t,e){return Sb(t.getMilliseconds(),e,3)}function $b(t,e){return Kb(t,e)+"000"}function tw(t,e){return Sb(t.getMonth()+1,e,2)}function ew(t,e){return Sb(t.getMinutes(),e,2)}function nw(t,e){return Sb(t.getSeconds(),e,2)}function iw(t){var e=t.getDay();return 0===e?7:e}function rw(t,e){return Sb(mx.count(cx(t)-1,t),e,2)}function ow(t){var e=t.getDay();return e>=4||0===e?xx(t):xx.ceil(t)}function aw(t,e){return t=ow(t),Sb(xx.count(cx(t),t)+(4===cx(t).getDay()),e,2)}function sw(t){return t.getDay()}function lw(t,e){return Sb(gx.count(cx(t)-1,t),e,2)}function cw(t,e){return Sb(t.getFullYear()%100,e,2)}function uw(t,e){return Sb((t=ow(t)).getFullYear()%100,e,2)}function hw(t,e){return Sb(t.getFullYear()%1e4,e,4)}function fw(t,e){var n=t.getDay();return Sb((t=n>=4||0===n?xx(t):xx.ceil(t)).getFullYear()%1e4,e,4)}function dw(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Sb(e/60|0,"0",2)+Sb(e%60,"0",2)}function pw(t,e){return Sb(t.getUTCDate(),e,2)}function mw(t,e){return Sb(t.getUTCHours(),e,2)}function gw(t,e){return Sb(t.getUTCHours()%12||12,e,2)}function vw(t,e){return Sb(1+ab.count(cb(t),t),e,3)}function yw(t,e){return Sb(t.getUTCMilliseconds(),e,3)}function xw(t,e){return yw(t,e)+"000"}function bw(t,e){return Sb(t.getUTCMonth()+1,e,2)}function ww(t,e){return Sb(t.getUTCMinutes(),e,2)}function _w(t,e){return Sb(t.getUTCSeconds(),e,2)}function Mw(t){var e=t.getUTCDay();return 0===e?7:e}function Sw(t,e){return Sb(Hx.count(cb(t)-1,t),e,2)}function Tw(t){var e=t.getUTCDay();return e>=4||0===e?Zx(t):Zx.ceil(t)}function Aw(t,e){return t=Tw(t),Sb(Zx.count(cb(t),t)+(4===cb(t).getUTCDay()),e,2)}function Ew(t){return t.getUTCDay()}function qw(t,e){return Sb(Wx.count(cb(t)-1,t),e,2)}function Cw(t,e){return Sb(t.getUTCFullYear()%100,e,2)}function Pw(t,e){return Sb((t=Tw(t)).getUTCFullYear()%100,e,2)}function Rw(t,e){return Sb(t.getUTCFullYear()%1e4,e,4)}function Lw(t,e){var n=t.getUTCDay();return Sb((t=n>=4||0===n?Zx(t):Zx.ceil(t)).getUTCFullYear()%1e4,e,4)}function Iw(){return"+0000"}function Dw(){return"%"}function Ow(t){return+t}function Nw(t){return Math.floor(+t/1e3)}function Fw(t){return mb=pb(t),gb=mb.format,vb=mb.parse,yb=mb.utcFormat,xb=mb.utcParse,mb}Fw({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Bw(t){return new Date(t)}function zw(t){return t instanceof Date?+t:+new Date(+t)}function Uw(t,e,n,i,o,a,s,l,c){var u=Cy(),h=u.invert,f=u.domain,d=c(".%L"),p=c(":%S"),m=c("%I:%M"),g=c("%I %p"),v=c("%a %d"),y=c("%b %d"),x=c("%B"),b=c("%Y"),w=[[s,1,1e3],[s,5,5e3],[s,15,15e3],[s,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[o,1,36e5],[o,3,108e5],[o,6,216e5],[o,12,432e5],[i,1,864e5],[i,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function _(r){return(s(r)<r?d:a(r)<r?p:o(r)<r?m:i(r)<r?g:e(r)<r?n(r)<r?v:y:t(r)<r?x:b)(r)}function M(e,n,i){if(null==e&&(e=10),"number"==typeof e){var o,a=Math.abs(i-n)/e,s=r((function(t){return t[2]})).right(w,a);return s===w.length?(o=U(n/31536e6,i/31536e6,e),e=t):s?(o=(s=w[a/w[s-1][2]<w[s][2]/a?s-1:s])[1],e=s[0]):(o=Math.max(U(n,i,e),1),e=l),e.every(o)}return e}return u.invert=function(t){return new Date(h(t))},u.domain=function(t){return arguments.length?f(Array.from(t,zw)):f().map(Bw)},u.ticks=function(t){var e,n=f(),i=n[0],r=n[n.length-1],o=r<i;return o&&(e=i,i=r,r=e),e=(e=M(t,i,r))?e.range(i,r+1):[],o?e.reverse():e},u.tickFormat=function(t,e){return null==e?_:c(e)},u.nice=function(t){var e=f();return(t=M(t,e[0],e[e.length-1]))?f(Dy(e,t)):u},u.copy=function(){return Ey(u,Uw(t,e,n,i,o,a,s,l,c))},u}function kw(){return dy.apply(Uw(cx,fx,mx,Px,Ix,Nx,zx,jx,gb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}var jw=sx((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})),Vw=jw,Gw=jw.range,Hw=sx((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),Ww=Hw,Xw=Hw.range,Yw=sx((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()})),Zw=Yw,Qw=Yw.range;function Jw(){return dy.apply(Uw(cb,Vw,Hx,ab,Ww,Zw,zx,jx,yb).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Kw(){var t,e,n,i,r,o=0,a=1,s=My,l=!1;function c(e){return isNaN(e=+e)?r:s(0===n?.5:(e=(i(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function u(t){return function(e){var n,i;return arguments.length?([n,i]=e,s=t(n,i),c):[s(0),s(1)]}}return c.domain=function(r){return arguments.length?([o,a]=r,t=i(o=+o),e=i(a=+a),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(l=!!t,c):l},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.range=u(ri),c.rangeRound=u(by),c.unknown=function(t){return arguments.length?(r=t,c):r},function(r){return i=r,t=r(o),e=r(a),n=t===e?0:1/(e-t),c}}function $w(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function t_(){var t=Ry(Kw()(My));return t.copy=function(){return $w(t,t_())},py.apply(t,arguments)}function e_(){var t=ky(Kw()).domain([1,10]);return t.copy=function(){return $w(t,e_()).base(t.base())},py.apply(t,arguments)}function n_(){var t=Hy(Kw());return t.copy=function(){return $w(t,n_()).constant(t.constant())},py.apply(t,arguments)}function i_(){var t=Qy(Kw());return t.copy=function(){return $w(t,i_()).exponent(t.exponent())},py.apply(t,arguments)}function r_(){return i_.apply(null,arguments).exponent(.5)}function o_(){var t=[],e=My;function n(n){if(!isNaN(n=+n))return e((u(t,n,1)-1)/(t.length-1))}return n.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let n of e)null==n||isNaN(n=+n)||t.push(n);return t.sort(i),n},n.interpolator=function(t){return arguments.length?(e=t,n):e},n.range=function(){return t.map((n,i)=>e(i/(t.length-1)))},n.quantiles=function(e){return Array.from({length:e+1},(n,i)=>Y(t,i/e))},n.copy=function(){return o_(e).domain(t)},py.apply(n,arguments)}function a_(t,e){for(var n=0,i=e.length-1,r=e[0],o=new Array(i<0?0:i);n<i;)o[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return o[e](t-e)}}function s_(){var t,e,n,i,r,o,a,s=0,l=.5,c=1,u=1,h=My,f=!1;function d(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(u*t<u*e?i:r),h(f?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,i,r;return arguments.length?([n,i,r]=e,h=a_(t,[n,i,r]),d):[h(0),h(.5),h(1)]}}return d.domain=function(a){return arguments.length?([s,l,c]=a,t=o(s=+s),e=o(l=+l),n=o(c=+c),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),u=e<t?-1:1,d):[s,l,c]},d.clamp=function(t){return arguments.length?(f=!!t,d):f},d.interpolator=function(t){return arguments.length?(h=t,d):h},d.range=p(ri),d.rangeRound=p(by),d.unknown=function(t){return arguments.length?(a=t,d):a},function(a){return o=a,t=a(s),e=a(l),n=a(c),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),u=e<t?-1:1,d}}function l_(){var t=Ry(s_()(My));return t.copy=function(){return $w(t,l_())},py.apply(t,arguments)}function c_(){var t=ky(s_()).domain([.1,1,10]);return t.copy=function(){return $w(t,c_()).base(t.base())},py.apply(t,arguments)}function u_(){var t=Hy(s_());return t.copy=function(){return $w(t,u_()).constant(t.constant())},py.apply(t,arguments)}function h_(){var t=Qy(s_());return t.copy=function(){return $w(t,h_()).exponent(t.exponent())},py.apply(t,arguments)}function f_(){return h_.apply(null,arguments).exponent(.5)}var d_=function(t){for(var e=t.length/6|0,n=new Array(e),i=0;i<e;)n[i]="#"+t.slice(6*i,6*++i);return n},p_=d_("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),m_=d_("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),g_=d_("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),v_=d_("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),y_=d_("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),x_=d_("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),b_=d_("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),w_=d_("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),__=d_("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),M_=d_("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),S_=t=>Wn(t[t.length-1]),T_=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(d_),A_=S_(T_),E_=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(d_),q_=S_(E_),C_=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(d_),P_=S_(C_),R_=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(d_),L_=S_(R_),I_=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(d_),D_=S_(I_),O_=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(d_),N_=S_(O_),F_=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(d_),B_=S_(F_),z_=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(d_),U_=S_(z_),k_=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(d_),j_=S_(k_),V_=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(d_),G_=S_(V_),H_=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(d_),W_=S_(H_),X_=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(d_),Y_=S_(X_),Z_=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(d_),Q_=S_(Z_),J_=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(d_),K_=S_(J_),$_=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(d_),tM=S_($_),eM=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(d_),nM=S_(eM),iM=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(d_),rM=S_(iM),oM=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(d_),aM=S_(oM),sM=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(d_),lM=S_(sM),cM=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(d_),uM=S_(cM),hM=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(d_),fM=S_(hM),dM=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(d_),pM=S_(dM),mM=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(d_),gM=S_(mM),vM=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(d_),yM=S_(vM),xM=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(d_),bM=S_(xM),wM=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(d_),_M=S_(wM),MM=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(d_),SM=S_(MM),TM=function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"},AM=Math.PI/180,EM=180/Math.PI;function qM(t){if(t instanceof PM)return new PM(t.h,t.s,t.l,t.opacity);t instanceof Rn||(t=Cn(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(-.6557636667999999*i+-1.7884503806*e-3.5172982438*n)/-5.9615122912,o=i-r,a=(1.97294*(n-r)- -.29227*o)/-.90649,s=Math.sqrt(a*a+o*o)/(1.97294*r*(1-r)),l=s?Math.atan2(a,o)*EM-120:NaN;return new PM(l<0?l+360:l,s,r,t.opacity)}function CM(t,e,n,i){return 1===arguments.length?qM(t):new PM(t,e,n,null==i?1:i)}function PM(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function RM(t){return function e(n){function i(e,i){var r=t((e=CM(e)).h,(i=CM(i)).h),o=Vn(e.s,i.s),a=Vn(e.l,i.l),s=Vn(e.opacity,i.opacity);return function(t){return e.h=r(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,i.gamma=e,i}(1)}un(PM,CM,hn(fn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new PM(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new PM(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*AM,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new Rn(255*(e+n*(-.14861*i+1.78277*r)),255*(e+n*(-.29227*i+-.90649*r)),255*(e+n*(1.97294*i)),this.opacity)}}));RM((function(t,e){var n=e-t;return n?kn(t,n>180||n<-180?n-360*Math.round(n/360):n):Un(isNaN(t)?e:t)}));var LM=RM(Vn),IM=LM(CM(300,.5,0),CM(-240,.5,1)),DM=LM(CM(-100,.75,.35),CM(80,1.5,.8)),OM=LM(CM(260,.75,.35),CM(80,1.5,.8)),NM=CM(),FM=function(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return NM.h=360*t-100,NM.s=1.5-1.5*e,NM.l=.8-.9*e,NM+""},BM=Pn(),zM=Math.PI/3,UM=2*Math.PI/3,kM=function(t){var e;return t=(.5-t)*Math.PI,BM.r=255*(e=Math.sin(t))*e,BM.g=255*(e=Math.sin(t+zM))*e,BM.b=255*(e=Math.sin(t+UM))*e,BM+""},jM=function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"};function VM(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}var GM=VM(d_("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),HM=VM(d_("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),WM=VM(d_("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),XM=VM(d_("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),YM=function(t){return Ml(ll(t).call(document.documentElement))},ZM=0;function QM(){return new JM}function JM(){this._="@"+(++ZM).toString(36)}JM.prototype=QM.prototype={constructor:JM,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var KM=function(t,e){return t.target&&(t=Sl(t),void 0===e&&(e=t.currentTarget),t=t.touches||[t]),Array.from(t,t=>Tl(t,e))},$M=function(t){return"string"==typeof t?new bl([document.querySelectorAll(t)],[document.documentElement]):new bl([null==t?[]:fs(t)],xl)},tS=function(t){return function(){return t}},eS=Math.abs,nS=Math.atan2,iS=Math.cos,rS=Math.max,oS=Math.min,aS=Math.sin,sS=Math.sqrt,lS=Math.PI,cS=lS/2,uS=2*lS;function hS(t){return t>1?0:t<-1?lS:Math.acos(t)}function fS(t){return t>=1?cS:t<=-1?-cS:Math.asin(t)}function dS(t){return t.innerRadius}function pS(t){return t.outerRadius}function mS(t){return t.startAngle}function gS(t){return t.endAngle}function vS(t){return t&&t.padAngle}function yS(t,e,n,i,r,o,a,s){var l=n-t,c=i-e,u=a-r,h=s-o,f=h*l-u*c;if(!(f*f<1e-12))return[t+(f=(u*(e-o)-h*(t-r))/f)*l,e+f*c]}function xS(t,e,n,i,r,o,a){var s=t-n,l=e-i,c=(a?o:-o)/sS(s*s+l*l),u=c*l,h=-c*s,f=t+u,d=e+h,p=n+u,m=i+h,g=(f+p)/2,v=(d+m)/2,y=p-f,x=m-d,b=y*y+x*x,w=r-o,_=f*m-p*d,M=(x<0?-1:1)*sS(rS(0,w*w*b-_*_)),S=(_*x-y*M)/b,T=(-_*y-x*M)/b,A=(_*x+y*M)/b,E=(-_*y+x*M)/b,q=S-g,C=T-v,P=A-g,R=E-v;return q*q+C*C>P*P+R*R&&(S=A,T=E),{cx:S,cy:T,x01:-u,y01:-h,x11:S*(r/w-1),y11:T*(r/w-1)}}var bS=function(){var t=dS,e=pS,n=tS(0),i=null,r=mS,o=gS,a=vS,s=null;function l(){var l,c,u=+t.apply(this,arguments),h=+e.apply(this,arguments),f=r.apply(this,arguments)-cS,d=o.apply(this,arguments)-cS,p=eS(d-f),m=d>f;if(s||(s=l=zv()),h<u&&(c=h,h=u,u=c),h>1e-12)if(p>uS-1e-12)s.moveTo(h*iS(f),h*aS(f)),s.arc(0,0,h,f,d,!m),u>1e-12&&(s.moveTo(u*iS(d),u*aS(d)),s.arc(0,0,u,d,f,m));else{var g,v,y=f,x=d,b=f,w=d,_=p,M=p,S=a.apply(this,arguments)/2,T=S>1e-12&&(i?+i.apply(this,arguments):sS(u*u+h*h)),A=oS(eS(h-u)/2,+n.apply(this,arguments)),E=A,q=A;if(T>1e-12){var C=fS(T/u*aS(S)),P=fS(T/h*aS(S));(_-=2*C)>1e-12?(b+=C*=m?1:-1,w-=C):(_=0,b=w=(f+d)/2),(M-=2*P)>1e-12?(y+=P*=m?1:-1,x-=P):(M=0,y=x=(f+d)/2)}var R=h*iS(y),L=h*aS(y),I=u*iS(w),D=u*aS(w);if(A>1e-12){var O,N=h*iS(x),F=h*aS(x),B=u*iS(b),z=u*aS(b);if(p<lS&&(O=yS(R,L,B,z,N,F,I,D))){var U=R-O[0],k=L-O[1],j=N-O[0],V=F-O[1],G=1/aS(hS((U*j+k*V)/(sS(U*U+k*k)*sS(j*j+V*V)))/2),H=sS(O[0]*O[0]+O[1]*O[1]);E=oS(A,(u-H)/(G-1)),q=oS(A,(h-H)/(G+1))}}M>1e-12?q>1e-12?(g=xS(B,z,R,L,h,q,m),v=xS(N,F,I,D,h,q,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),q<A?s.arc(g.cx,g.cy,q,nS(g.y01,g.x01),nS(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,q,nS(g.y01,g.x01),nS(g.y11,g.x11),!m),s.arc(0,0,h,nS(g.cy+g.y11,g.cx+g.x11),nS(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,q,nS(v.y11,v.x11),nS(v.y01,v.x01),!m))):(s.moveTo(R,L),s.arc(0,0,h,y,x,!m)):s.moveTo(R,L),u>1e-12&&_>1e-12?E>1e-12?(g=xS(I,D,N,F,u,-E,m),v=xS(R,L,B,z,u,-E,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),E<A?s.arc(g.cx,g.cy,E,nS(g.y01,g.x01),nS(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,E,nS(g.y01,g.x01),nS(g.y11,g.x11),!m),s.arc(0,0,u,nS(g.cy+g.y11,g.cx+g.x11),nS(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,E,nS(v.y11,v.x11),nS(v.y01,v.x01),!m))):s.arc(0,0,u,w,b,m):s.lineTo(I,D)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-lS/2;return[iS(i)*n,aS(i)*n]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:tS(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:tS(+t),l):e},l.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:tS(+t),l):n},l.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:tS(+t),l):i},l.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:tS(+t),l):r},l.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:tS(+t),l):o},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:tS(+t),l):a},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l},wS=Array.prototype.slice,_S=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)};function MS(t){this._context=t}MS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var SS=function(t){return new MS(t)};function TS(t){return t[0]}function AS(t){return t[1]}var ES=function(t,e){var n=tS(!0),i=null,r=SS,o=null;function a(a){var s,l,c,u=(a=_S(a)).length,h=!1;for(null==i&&(o=r(c=zv())),s=0;s<=u;++s)!(s<u&&n(l=a[s],s,a))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(l,s,a),+e(l,s,a));if(c)return o=null,c+""||null}return t="function"==typeof t?t:void 0===t?TS:tS(t),e="function"==typeof e?e:void 0===e?AS:tS(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:tS(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:tS(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:tS(!!t),a):n},a.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),a):r},a.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),a):i},a},qS=function(t,e,n){var i=null,r=tS(!0),o=null,a=SS,s=null;function l(l){var c,u,h,f,d,p=(l=_S(l)).length,m=!1,g=new Array(p),v=new Array(p);for(null==o&&(s=a(d=zv())),c=0;c<=p;++c){if(!(c<p&&r(f=l[c],c,l))===m)if(m=!m)u=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=c-1;h>=u;--h)s.point(g[h],v[h]);s.lineEnd(),s.areaEnd()}m&&(g[c]=+t(f,c,l),v[c]=+e(f,c,l),s.point(i?+i(f,c,l):g[c],n?+n(f,c,l):v[c]))}if(d)return s=null,d+""||null}function c(){return ES().defined(r).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?TS:tS(+t),e="function"==typeof e?e:tS(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?AS:tS(+n),l.x=function(e){return arguments.length?(t="function"==typeof e?e:tS(+e),i=null,l):t},l.x0=function(e){return arguments.length?(t="function"==typeof e?e:tS(+e),l):t},l.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:tS(+t),l):i},l.y=function(t){return arguments.length?(e="function"==typeof t?t:tS(+t),n=null,l):e},l.y0=function(t){return arguments.length?(e="function"==typeof t?t:tS(+t),l):e},l.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:tS(+t),l):n},l.lineX0=l.lineY0=function(){return c().x(t).y(e)},l.lineY1=function(){return c().x(t).y(n)},l.lineX1=function(){return c().x(i).y(e)},l.defined=function(t){return arguments.length?(r="function"==typeof t?t:tS(!!t),l):r},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l},CS=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},PS=function(t){return t},RS=function(){var t=PS,e=CS,n=null,i=tS(0),r=tS(uS),o=tS(0);function a(a){var s,l,c,u,h,f=(a=_S(a)).length,d=0,p=new Array(f),m=new Array(f),g=+i.apply(this,arguments),v=Math.min(uS,Math.max(-uS,r.apply(this,arguments)-g)),y=Math.min(Math.abs(v)/f,o.apply(this,arguments)),x=y*(v<0?-1:1);for(s=0;s<f;++s)(h=m[p[s]=s]=+t(a[s],s,a))>0&&(d+=h);for(null!=e?p.sort((function(t,n){return e(m[t],m[n])})):null!=n&&p.sort((function(t,e){return n(a[t],a[e])})),s=0,c=d?(v-f*x)/d:0;s<f;++s,g=u)l=p[s],u=g+((h=m[l])>0?h*c:0)+x,m[l]={data:a[l],index:s,value:h,startAngle:g,endAngle:u,padAngle:y};return m}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:tS(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,n=null,a):e},a.sort=function(t){return arguments.length?(n=t,e=null,a):n},a.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:tS(+t),a):i},a.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:tS(+t),a):r},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:tS(+t),a):o},a},LS=DS(SS);function IS(t){this._curve=t}function DS(t){function e(e){return new IS(t(e))}return e._curve=t,e}function OS(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?e(DS(t)):e()._curve},t}IS.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};var NS=function(){return OS(ES().curve(LS))},FS=function(){var t=qS().curve(LS),e=t.curve,n=t.lineX0,i=t.lineX1,r=t.lineY0,o=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return OS(n())},delete t.lineX0,t.lineEndAngle=function(){return OS(i())},delete t.lineX1,t.lineInnerRadius=function(){return OS(r())},delete t.lineY0,t.lineOuterRadius=function(){return OS(o())},delete t.lineY1,t.curve=function(t){return arguments.length?e(DS(t)):e()._curve},t},BS=function(t,e){return[(e=+e)*Math.cos(t-=Math.PI/2),e*Math.sin(t)]};function zS(t){return t.source}function US(t){return t.target}function kS(t){var e=zS,n=US,i=TS,r=AS,o=null;function a(){var a,s=wS.call(arguments),l=e.apply(this,s),c=n.apply(this,s);if(o||(o=a=zv()),t(o,+i.apply(this,(s[0]=l,s)),+r.apply(this,s),+i.apply(this,(s[0]=c,s)),+r.apply(this,s)),a)return o=null,a+""||null}return a.source=function(t){return arguments.length?(e=t,a):e},a.target=function(t){return arguments.length?(n=t,a):n},a.x=function(t){return arguments.length?(i="function"==typeof t?t:tS(+t),a):i},a.y=function(t){return arguments.length?(r="function"==typeof t?t:tS(+t),a):r},a.context=function(t){return arguments.length?(o=null==t?null:t,a):o},a}function jS(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e=(e+i)/2,n,e,r,i,r)}function VS(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+r)/2,i,n,i,r)}function GS(t,e,n,i,r){var o=BS(e,n),a=BS(e,n=(n+r)/2),s=BS(i,n),l=BS(i,r);t.moveTo(o[0],o[1]),t.bezierCurveTo(a[0],a[1],s[0],s[1],l[0],l[1])}function HS(){return kS(jS)}function WS(){return kS(VS)}function XS(){var t=kS(GS);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t}var YS={draw:function(t,e){var n=Math.sqrt(e/lS);t.moveTo(n,0),t.arc(0,0,n,0,uS)}},ZS={draw:function(t,e){var n=Math.sqrt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},QS=Math.sqrt(1/3),JS=2*QS,KS={draw:function(t,e){var n=Math.sqrt(e/JS),i=n*QS;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}},$S=Math.sin(lS/10)/Math.sin(7*lS/10),tT=Math.sin(uS/10)*$S,eT=-Math.cos(uS/10)*$S,nT={draw:function(t,e){var n=Math.sqrt(.8908130915292852*e),i=tT*n,r=eT*n;t.moveTo(0,-n),t.lineTo(i,r);for(var o=1;o<5;++o){var a=uS*o/5,s=Math.cos(a),l=Math.sin(a);t.lineTo(l*n,-s*n),t.lineTo(s*i-l*r,l*i+s*r)}t.closePath()}},iT={draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},rT=Math.sqrt(3),oT={draw:function(t,e){var n=-Math.sqrt(e/(3*rT));t.moveTo(0,2*n),t.lineTo(-rT*n,-n),t.lineTo(rT*n,-n),t.closePath()}},aT=Math.sqrt(3)/2,sT=1/Math.sqrt(12),lT=3*(sT/2+1),cT={draw:function(t,e){var n=Math.sqrt(e/lT),i=n/2,r=n*sT,o=i,a=n*sT+n,s=-o,l=a;t.moveTo(i,r),t.lineTo(o,a),t.lineTo(s,l),t.lineTo(-.5*i-aT*r,aT*i+-.5*r),t.lineTo(-.5*o-aT*a,aT*o+-.5*a),t.lineTo(-.5*s-aT*l,aT*s+-.5*l),t.lineTo(-.5*i+aT*r,-.5*r-aT*i),t.lineTo(-.5*o+aT*a,-.5*a-aT*o),t.lineTo(-.5*s+aT*l,-.5*l-aT*s),t.closePath()}},uT=[YS,ZS,KS,iT,nT,oT,cT],hT=function(t,e){var n=null;function i(){var i;if(n||(n=i=zv()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return t="function"==typeof t?t:tS(t||YS),e="function"==typeof e?e:tS(void 0===e?64:+e),i.type=function(e){return arguments.length?(t="function"==typeof e?e:tS(e),i):t},i.size=function(t){return arguments.length?(e="function"==typeof t?t:tS(+t),i):e},i.context=function(t){return arguments.length?(n=null==t?null:t,i):n},i},fT=function(){};function dT(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function pT(t){this._context=t}pT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:dT(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:dT(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var mT=function(t){return new pT(t)};function gT(t){this._context=t}gT.prototype={areaStart:fT,areaEnd:fT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:dT(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var vT=function(t){return new gT(t)};function yT(t){this._context=t}yT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:dT(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var xT=function(t){return new yT(t)};function bT(t,e){this._basis=new pT(t),this._beta=e}bT.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,r=t[0],o=e[0],a=t[n]-r,s=e[n]-o,l=-1;++l<=n;)i=l/n,this._basis.point(this._beta*t[l]+(1-this._beta)*(r+i*a),this._beta*e[l]+(1-this._beta)*(o+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var wT=function t(e){function n(t){return 1===e?new pT(t):new bT(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function _T(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function MT(t,e){this._context=t,this._k=(1-e)/6}MT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:_T(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:_T(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ST=function t(e){function n(t){return new MT(t,e)}return n.tension=function(e){return t(+e)},n}(0);function TT(t,e){this._context=t,this._k=(1-e)/6}TT.prototype={areaStart:fT,areaEnd:fT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:_T(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var AT=function t(e){function n(t){return new TT(t,e)}return n.tension=function(e){return t(+e)},n}(0);function ET(t,e){this._context=t,this._k=(1-e)/6}ET.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_T(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var qT=function t(e){function n(t){return new ET(t,e)}return n.tension=function(e){return t(+e)},n}(0);function CT(t,e,n){var i=t._x1,r=t._y1,o=t._x2,a=t._y2;if(t._l01_a>1e-12){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>1e-12){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*c+t._x1*t._l23_2a-e*t._l12_2a)/u,a=(a*c+t._y1*t._l23_2a-n*t._l12_2a)/u}t._context.bezierCurveTo(i,r,o,a,t._x2,t._y2)}function PT(t,e){this._context=t,this._alpha=e}PT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:CT(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var RT=function t(e){function n(t){return e?new PT(t,e):new MT(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function LT(t,e){this._context=t,this._alpha=e}LT.prototype={areaStart:fT,areaEnd:fT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:CT(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var IT=function t(e){function n(t){return e?new LT(t,e):new TT(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function DT(t,e){this._context=t,this._alpha=e}DT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:CT(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var OT=function t(e){function n(t){return e?new DT(t,e):new ET(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function NT(t){this._context=t}NT.prototype={areaStart:fT,areaEnd:fT,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};var FT=function(t){return new NT(t)};function BT(t){return t<0?-1:1}function zT(t,e,n){var i=t._x1-t._x0,r=e-t._x1,o=(t._y1-t._y0)/(i||r<0&&-0),a=(n-t._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(BT(o)+BT(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function UT(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function kT(t,e,n){var i=t._x0,r=t._y0,o=t._x1,a=t._y1,s=(o-i)/3;t._context.bezierCurveTo(i+s,r+s*e,o-s,a-s*n,o,a)}function jT(t){this._context=t}function VT(t){this._context=new GT(t)}function GT(t){this._context=t}function HT(t){return new jT(t)}function WT(t){return new VT(t)}function XT(t){this._context=t}function YT(t){var e,n,i=t.length-1,r=new Array(i),o=new Array(i),a=new Array(i);for(r[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<i-1;++e)r[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(r[i-1]=2,o[i-1]=7,a[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)n=r[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(r[i-1]=a[i-1]/o[i-1],e=i-2;e>=0;--e)r[e]=(a[e]-r[e+1])/o[e];for(o[i-1]=(t[i]+r[i-1])/2,e=0;e<i-1;++e)o[e]=2*t[e+1]-r[e+1];return[r,o]}jT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:kT(this,this._t0,UT(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,kT(this,UT(this,n=zT(this,t,e)),n);break;default:kT(this,this._t0,n=zT(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(VT.prototype=Object.create(jT.prototype)).point=function(t,e){jT.prototype.point.call(this,e,t)},GT.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,o){this._context.bezierCurveTo(e,t,i,n,o,r)}},XT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var i=YT(t),r=YT(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var ZT=function(t){return new XT(t)};function QT(t,e){this._context=t,this._t=e}QT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var JT=function(t){return new QT(t,.5)};function KT(t){return new QT(t,0)}function $T(t){return new QT(t,1)}var tA=function(t,e){if((r=t.length)>1)for(var n,i,r,o=1,a=t[e[0]],s=a.length;o<r;++o)for(i=a,a=t[e[o]],n=0;n<s;++n)a[n][1]+=a[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]},eA=function(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n};function nA(t,e){return t[e]}function iA(t){const e=[];return e.key=t,e}var rA=function(){var t=tS([]),e=eA,n=tA,i=nA;function r(r){var o,a,s=Array.from(t.apply(this,arguments),iA),l=s.length,c=-1;for(const t of r)for(o=0,++c;o<l;++o)(s[o][c]=[0,+i(t,s[o].key,c,r)]).data=t;for(o=0,a=_S(e(s));o<l;++o)s[a[o]].index=o;return n(s,a),s}return r.keys=function(e){return arguments.length?(t="function"==typeof e?e:tS(Array.from(e)),r):t},r.value=function(t){return arguments.length?(i="function"==typeof t?t:tS(+t),r):i},r.order=function(t){return arguments.length?(e=null==t?eA:"function"==typeof t?t:tS(Array.from(t)),r):e},r.offset=function(t){return arguments.length?(n=null==t?tA:t,r):n},r},oA=function(t,e){if((i=t.length)>0){for(var n,i,r,o=0,a=t[0].length;o<a;++o){for(r=n=0;n<i;++n)r+=t[n][o][1]||0;if(r)for(n=0;n<i;++n)t[n][o][1]/=r}tA(t,e)}},aA=function(t,e){if((s=t.length)>0)for(var n,i,r,o,a,s,l=0,c=t[e[0]].length;l<c;++l)for(o=a=0,n=0;n<s;++n)(r=(i=t[e[n]][l])[1]-i[0])>0?(i[0]=o,i[1]=o+=r):r<0?(i[1]=a,i[0]=a+=r):(i[0]=0,i[1]=r)},sA=function(t,e){if((n=t.length)>0){for(var n,i=0,r=t[e[0]],o=r.length;i<o;++i){for(var a=0,s=0;a<n;++a)s+=t[a][i][1]||0;r[i][1]+=r[i][0]=-s/2}tA(t,e)}},lA=function(t,e){if((r=t.length)>0&&(i=(n=t[e[0]]).length)>0){for(var n,i,r,o=0,a=1;a<i;++a){for(var s=0,l=0,c=0;s<r;++s){for(var u=t[e[s]],h=u[a][1]||0,f=(h-(u[a-1][1]||0))/2,d=0;d<s;++d){var p=t[e[d]];f+=(p[a][1]||0)-(p[a-1][1]||0)}l+=h,c+=f*h}n[a-1][1]+=n[a-1][0]=o,l&&(o-=c/l)}n[a-1][1]+=n[a-1][0]=o,tA(t,e)}},cA=function(t){var e=t.map(uA);return eA(t).sort((function(t,n){return e[t]-e[n]}))};function uA(t){for(var e,n=-1,i=0,r=t.length,o=-1/0;++n<r;)(e=+t[n][1])>o&&(o=e,i=n);return i}var hA=function(t){var e=t.map(fA);return eA(t).sort((function(t,n){return e[t]-e[n]}))};function fA(t){for(var e,n=0,i=-1,r=t.length;++i<r;)(e=+t[i][1])&&(n+=e);return n}var dA=function(t){return hA(t).reverse()},pA=function(t){var e,n,i=t.length,r=t.map(fA),o=cA(t),a=0,s=0,l=[],c=[];for(e=0;e<i;++e)n=o[e],a<s?(a+=r[n],l.push(n)):(s+=r[n],c.push(n));return c.reverse().concat(l)},mA=function(t){return eA(t).reverse()};var gA=Date.prototype.toISOString?function(t){return t.toISOString()}:yb("%Y-%m-%dT%H:%M:%S.%LZ");var vA,yA,xA=+new Date("2000-01-01T00:00:00.000Z")?function(t){var e=new Date(t);return isNaN(e)?null:e}:xb("%Y-%m-%dT%H:%M:%S.%LZ"),bA=0,wA=0,_A=0,MA=0,SA=0,TA=0,AA="object"==typeof performance&&performance.now?performance:Date,EA="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function qA(){return SA||(EA(CA),SA=AA.now()+TA)}function CA(){SA=0}function PA(){this._call=this._time=this._next=null}function RA(t,e,n){var i=new PA;return i.restart(t,e,n),i}function LA(){qA(),++bA;for(var t,e=vA;e;)(t=SA-e._time)>=0&&e._call.call(null,t),e=e._next;--bA}function IA(){SA=(MA=AA.now())+TA,bA=wA=0;try{LA()}finally{bA=0,function(){var t,e,n=vA,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:vA=e);yA=t,OA(i)}(),SA=0}}function DA(){var t=AA.now(),e=t-MA;e>1e3&&(TA-=e,MA=t)}function OA(t){bA||(wA&&(wA=clearTimeout(wA)),t-SA>24?(t<1/0&&(wA=setTimeout(IA,t-AA.now()-TA)),_A&&(_A=clearInterval(_A))):(_A||(MA=AA.now(),_A=setInterval(DA,1e3)),bA=1,EA(IA)))}PA.prototype=RA.prototype={constructor:PA,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?qA():+n)+(null==e?0:+e),this._next||yA===this||(yA?yA._next=this:vA=this,yA=this),this._call=t,this._time=n,OA()},stop:function(){this._call&&(this._call=null,this._time=1/0,OA())}};var NA=function(t,e,n){var i=new PA;return e=null==e?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,n),i},FA=function(t,e,n){var i=new PA,r=e;return null==e?(i.restart(t,e,n),i):(i._restart=i.restart,i.restart=function(t,e,n){e=+e,n=null==n?qA():+n,i._restart((function o(a){a+=r,i._restart(o,r+=e,n),t(a)}),e,n)},i.restart(t,e,n),i)},BA=cs("start","end","cancel","interrupt"),zA=[],UA=function(t,e,n,i,r,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(l){var c,u,h,f;if(1!==n.state)return s();for(c in r)if((f=r[c]).name===n.name){if(3===f.state)return NA(o);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(NA((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(l))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function a(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),o=-1,a=i.length;++o<a;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=RA((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:BA,tween:zA,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})};function kA(t,e){var n=VA(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function jA(t,e){var n=VA(t,e);if(n.state>3)throw new Error("too late; already running");return n}function VA(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var GA=function(t,e){var n,i,r,o=t.__transition,a=!0;if(o){for(r in e=null==e?null:e+"",o)(n=o[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]):a=!1;a&&delete t.__transition}};function HA(t,e){var n,i;return function(){var r=jA(this,t),o=r.tween;if(o!==n)for(var a=0,s=(i=n=o).length;a<s;++a)if(i[a].name===e){(i=i.slice()).splice(a,1);break}r.tween=i}}function WA(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var o=jA(this,t),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}o.tween=r}}function XA(t,e,n){var i=t._id;return t.each((function(){var t=jA(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return VA(t,i).value[e]}}var YA=function(t,e){var n;return("number"==typeof e?rv:e instanceof zo?Zg:(n=zo(e))?(e=n,Zg):cv)(t,e)};function ZA(t){return function(){this.removeAttribute(t)}}function QA(t){return function(){this.removeAttributeNS(t.space,t.local)}}function JA(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===i?r:r=e(i=a,n)}}function KA(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===i?r:r=e(i=a,n)}}function $A(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttribute(t)}}function tE(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttributeNS(t.space,t.local)}}function eE(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function nE(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function iE(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&nE(t,r)),n}return r._value=e,r}function rE(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&eE(t,r)),n}return r._value=e,r}function oE(t,e){return function(){kA(this,t).delay=+e.apply(this,arguments)}}function aE(t,e){return e=+e,function(){kA(this,t).delay=e}}function sE(t,e){return function(){jA(this,t).duration=+e.apply(this,arguments)}}function lE(t,e){return e=+e,function(){jA(this,t).duration=e}}function cE(t,e){if("function"!=typeof e)throw new Error;return function(){jA(this,t).ease=e}}function uE(t,e,n){var i,r,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?kA:jA;return function(){var a=o(this,t),s=a.on;s!==i&&(r=(i=s).copy()).on(e,n),a.on=r}}var hE=_l.prototype.constructor;function fE(t){return function(){this.style.removeProperty(t)}}function dE(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function pE(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&dE(t,o,n)),i}return o._value=e,o}function mE(t){return function(e){this.textContent=t.call(this,e)}}function gE(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&mE(i)),e}return i._value=t,i}var vE=0;function yE(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function xE(t){return _l().transition(t)}function bE(){return++vE}var wE=_l.prototype;yE.prototype=xE.prototype={constructor:yE,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=hs(t));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s,l,c=i[a],u=c.length,h=o[a]=new Array(u),f=0;f<u;++f)(s=c[f])&&(l=t.call(s,s.__data__,f,c))&&("__data__"in s&&(l.__data__=s.__data__),h[f]=l,UA(h[f],e,n,f,h,VA(s,n)));return new yE(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=ps(t));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var l,c=i[s],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var f,d=t.call(l,l.__data__,h,c),p=VA(l,n),m=0,g=d.length;m<g;++m)(f=d[m])&&UA(f,e,n,m,d,p);o.push(d),a.push(l)}return new yE(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=ms(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new yE(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new yE(a,this._parents,this._name,this._id)},selection:function(){return new hE(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=bE(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var u=VA(a,e);UA(a,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new yE(i,this._parents,t,n)},call:wE.call,nodes:wE.nodes,node:wE.node,size:wE.size,empty:wE.empty,each:wE.each,on:function(t,e){var n=this._id;return arguments.length<2?VA(this.node(),n).on.on(t):this.each(uE(n,t,e))},attr:function(t,e){var n=Cs(t),i="transform"===n?xv:YA;return this.attrTween(t,"function"==typeof e?(n.local?tE:$A)(n,i,XA(this,"attr."+t,e)):null==e?(n.local?QA:ZA)(n):(n.local?KA:JA)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=Cs(t);return this.tween(n,(i.local?iE:rE)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?yv:YA;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var o=Us(this,t),a=(this.style.removeProperty(t),Us(this,t));return o===a?null:o===n&&a===i?r:r=e(n=o,i=a)}}(t,i)).on("end.style."+t,fE(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,o;return function(){var a=Us(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=Us(this,t)),a===l?null:a===i&&l===r?o:(r=l,o=e(i=a,s))}}(t,i,XA(this,"style."+t,e))).each(function(t,e){var n,i,r,o,a="style."+e,s="end."+a;return function(){var l=jA(this,t),c=l.on,u=null==l.value[a]?o||(o=fE(e)):void 0;c===n&&r===u||(i=(n=c).copy()).on(s,r=u),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,o=n+"";return function(){var a=Us(this,t);return a===o?null:a===i?r:r=e(i=a,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,pE(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(XA(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,gE(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=VA(this.node(),n).tween,o=0,a=r.length;o<a;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?HA:WA)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?oE:aE)(e,t)):VA(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?sE:lE)(e,t)):VA(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(cE(e,t)):VA(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;jA(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(o,a){var s={value:a},l={value:function(){0==--r&&o()}};n.each((function(){var n=jA(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===r&&o()}))},[Symbol.iterator]:wE[Symbol.iterator]};var _E={time:null,delay:0,duration:250,ease:pc};function ME(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}_l.prototype.interrupt=function(t){return this.each((function(){GA(this,t)}))},_l.prototype.transition=function(t){var e,n;t instanceof yE?(e=t._id,t=t._name):(e=bE(),(n=_E).time=qA(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)(a=s[c])&&UA(a,t,e,c,s,n||ME(a,e));return new yE(i,this._parents,t,e)};var SE=[null],TE=function(t,e){var n,i,r=t.__transition;if(r)for(i in e=null==e?null:e+"",r)if((n=r[i]).state>1&&n.name===e)return new yE([[t]],SE,e,+i);return null};function AE(){}var EE=function(t){return null==t?AE:function(){return this.querySelector(t)}},qE=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)};function CE(){return[]}var PE=function(t){return null==t?CE:function(){return this.querySelectorAll(t)}};var RE=function(t){return function(){return this.matches(t)}};function LE(t){return function(e){return e.matches(t)}}var IE=Array.prototype.find;function DE(){return this.firstElementChild}var OE=Array.prototype.filter;function NE(){return this.children}var FE=function(t){return new Array(t.length)};function BE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}BE.prototype={constructor:BE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var zE=function(t){return function(){return t}};function UE(t,e,n,i,r,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new BE(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function kE(t,e,n,i,r,o,a){var s,l,c,u=new Map,h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(d[s]=c=a.call(l,l.__data__,s,e)+"",u.has(c)?r[s]=l:u.set(c,l));for(s=0;s<f;++s)c=a.call(t,o[s],s,o)+"",(l=u.get(c))?(i[s]=l,l.__data__=o[s],u.delete(c)):n[s]=new BE(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&u.get(d[s])===l&&(r[s]=l)}function jE(t){return t.__data__}function VE(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var GE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},HE=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),GE.hasOwnProperty(e)?{space:GE[e],local:t}:t};function WE(t){return function(){this.removeAttribute(t)}}function XE(t){return function(){this.removeAttributeNS(t.space,t.local)}}function YE(t,e){return function(){this.setAttribute(t,e)}}function ZE(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function QE(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function JE(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var KE=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function $E(t){return function(){this.style.removeProperty(t)}}function tq(t,e,n){return function(){this.style.setProperty(t,e,n)}}function eq(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function nq(t,e){return t.style.getPropertyValue(e)||KE(t).getComputedStyle(t,null).getPropertyValue(e)}function iq(t){return function(){delete this[t]}}function rq(t,e){return function(){this[t]=e}}function oq(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function aq(t){return t.trim().split(/^|\s+/)}function sq(t){return t.classList||new lq(t)}function lq(t){this._node=t,this._names=aq(t.getAttribute("class")||"")}function cq(t,e){for(var n=sq(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function uq(t,e){for(var n=sq(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function hq(t){return function(){cq(this,t)}}function fq(t){return function(){uq(this,t)}}function dq(t,e){return function(){(e.apply(this,arguments)?cq:uq)(this,t)}}lq.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function pq(){this.textContent=""}function mq(t){return function(){this.textContent=t}}function gq(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function vq(){this.innerHTML=""}function yq(t){return function(){this.innerHTML=t}}function xq(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function bq(){this.nextSibling&&this.parentNode.appendChild(this)}function wq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function _q(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return"http://www.w3.org/1999/xhtml"===n&&"http://www.w3.org/1999/xhtml"===e.documentElement.namespaceURI?e.createElement(t):e.createElementNS(n,t)}}function Mq(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var Sq=function(t){var e=HE(t);return(e.local?Mq:_q)(e)};function Tq(){return null}function Aq(){var t=this.parentNode;t&&t.removeChild(this)}function Eq(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function qq(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Cq(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Pq(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Rq(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Lq(t,e,n){var i=KE(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Iq(t,e){return function(){return Lq(this,t,e)}}function Dq(t,e){return function(){return Lq(this,t,e.apply(this,arguments))}}var Oq=[null];function Nq(t,e){this._groups=t,this._parents=e}function Fq(){return new Nq([[document.documentElement]],Oq)}Nq.prototype=Fq.prototype={constructor:Nq,select:function(t){"function"!=typeof t&&(t=EE(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=s[u])&&(a=t.call(o,o.__data__,u,s))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new Nq(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:qE(e)}}(t):PE(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(i.push(t.call(a,a.__data__,c,s)),r.push(a));return new Nq(i,r)},selectChild:function(t){return this.select(null==t?DE:function(t){return function(){return IE.call(this.children,t)}}("function"==typeof t?t:LE(t)))},selectChildren:function(t){return this.selectAll(null==t?NE:function(t){return function(){return OE.call(this.children,t)}}("function"==typeof t?t:LE(t)))},filter:function(t){"function"!=typeof t&&(t=RE(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new Nq(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,jE);var n=e?kE:UE,i=this._parents,r=this._groups;"function"!=typeof t&&(t=zE(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],h=r[c],f=h.length,d=qE(t.call(u,u&&u.__data__,c,i)),p=d.length,m=s[c]=new Array(p),g=a[c]=new Array(p),v=l[c]=new Array(f);n(u,h,m,g,v,d,e);for(var y,x,b=0,w=0;b<p;++b)if(y=m[b]){for(b>=w&&(w=b+1);!(x=g[w])&&++w<p;);y._next=x||null}}return(a=new Nq(a,i))._enter=s,a._exit=l,a},enter:function(){return new Nq(this._enter||this._groups.map(FE),this._parents)},exit:function(){return new Nq(this._exit||this._groups.map(FE),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){if(!(t instanceof Nq))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new Nq(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=VE);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,c=r[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new Nq(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=HE(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?XE:WE:"function"==typeof e?n.local?JE:QE:n.local?ZE:YE)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?$E:"function"==typeof e?eq:tq)(t,e,null==n?"":n)):nq(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?iq:"function"==typeof e?oq:rq)(t,e)):this.node()[t]},classed:function(t,e){var n=aq(t+"");if(arguments.length<2){for(var i=sq(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?dq:e?hq:fq)(n,e))},text:function(t){return arguments.length?this.each(null==t?pq:("function"==typeof t?gq:mq)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?vq:("function"==typeof t?xq:yq)(t)):this.node().innerHTML},raise:function(){return this.each(bq)},lower:function(){return this.each(wq)},append:function(t){var e="function"==typeof t?t:Sq(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Sq(t),i=null==e?Tq:"function"==typeof e?e:EE(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Aq)},clone:function(t){return this.select(t?qq:Eq)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=Cq(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Rq:Pq,i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(i=0,l=s[c];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Dq:Iq)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,a=r.length;o<a;++o)(i=r[o])&&(yield i)}};var Bq=Fq,zq=function(t){return"string"==typeof t?new Nq([[document.querySelector(t)]],[document.documentElement]):new Nq([[t]],Oq)};var Uq=function(t){t.preventDefault(),t.stopImmediatePropagation()},kq=function(t){var e=t.document.documentElement,n=zq(t).on("dragstart.drag",Uq,!0);"onselectstart"in e?n.on("selectstart.drag",Uq,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function jq(t,e){var n=t.document.documentElement,i=zq(t).on("dragstart.drag",null);e&&(i.on("click.drag",Uq,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Vq=Math.SQRT2;function Gq(t){return((t=Math.exp(t))+1/t)/2}var Hq=function(t,e){var n,i,r=t[0],o=t[1],a=t[2],s=e[0],l=e[1],c=e[2],u=s-r,h=l-o,f=u*u+h*h;if(f<1e-12)i=Math.log(c/a)/Vq,n=function(t){return[r+t*u,o+t*h,a*Math.exp(Vq*t*i)]};else{var d=Math.sqrt(f),p=(c*c-a*a+4*f)/(2*a*2*d),m=(c*c-a*a-4*f)/(2*c*2*d),g=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(m*m+1)-m);i=(v-g)/Vq,n=function(t){var e,n=t*i,s=Gq(g),l=a/(2*d)*(s*(e=Vq*n+g,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[r+l*u,o+l*h,a*s/Gq(Vq*n+g)]}}return n.duration=1e3*i,n},Wq=function(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]},Xq=Object(Gt.dispatch)("start","end","cancel","interrupt"),Yq=[],Zq=function(t,e,n,i,r,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(l){var c,u,h,f;if(1!==n.state)return s();for(c in r)if((f=r[c]).name===n.name){if(3===f.state)return wi(o);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(wi((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(l))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function a(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),o=-1,a=i.length;++o<a;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=vi((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:Xq,tween:Yq,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})};function Qq(t,e){var n=Kq(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Jq(t,e){var n=Kq(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Kq(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var $q=function(t,e){var n,i,r,o=t.__transition,a=!0;if(o){for(r in e=null==e?null:e+"",o)(n=o[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]):a=!1;a&&delete t.__transition}};function tC(t,e){var n,i;return function(){var r=Jq(this,t),o=r.tween;if(o!==n)for(var a=0,s=(i=n=o).length;a<s;++a)if(i[a].name===e){(i=i.slice()).splice(a,1);break}r.tween=i}}function eC(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var o=Jq(this,t),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}o.tween=r}}function nC(t,e,n){var i=t._id;return t.each((function(){var t=Jq(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Kq(t,i).value[e]}}var iC=function(t,e){var n;return("number"==typeof e?Jn:e instanceof An?Gn:(n=An(e))?(e=n,Gn):ii)(t,e)};function rC(t){return function(){this.removeAttribute(t)}}function oC(t){return function(){this.removeAttributeNS(t.space,t.local)}}function aC(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===i?r:r=e(i=a,n)}}function sC(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===i?r:r=e(i=a,n)}}function lC(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttribute(t)}}function cC(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttributeNS(t.space,t.local)}}function uC(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function hC(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function fC(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&hC(t,r)),n}return r._value=e,r}function dC(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&uC(t,r)),n}return r._value=e,r}function pC(t,e){return function(){Qq(this,t).delay=+e.apply(this,arguments)}}function mC(t,e){return e=+e,function(){Qq(this,t).delay=e}}function gC(t,e){return function(){Jq(this,t).duration=+e.apply(this,arguments)}}function vC(t,e){return e=+e,function(){Jq(this,t).duration=e}}function yC(t,e){if("function"!=typeof e)throw new Error;return function(){Jq(this,t).ease=e}}function xC(t,e,n){var i,r,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Qq:Jq;return function(){var a=o(this,t),s=a.on;s!==i&&(r=(i=s).copy()).on(e,n),a.on=r}}var bC=Bq.prototype.constructor;function wC(t){return function(){this.style.removeProperty(t)}}function _C(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function MC(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&_C(t,o,n)),i}return o._value=e,o}function SC(t){return function(e){this.textContent=t.call(this,e)}}function TC(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&SC(i)),e}return i._value=t,i}var AC=0;function EC(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function qC(){return++AC}var CC=Bq.prototype;EC.prototype=function(t){return Bq().transition(t)}.prototype={constructor:EC,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=EE(t));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s,l,c=i[a],u=c.length,h=o[a]=new Array(u),f=0;f<u;++f)(s=c[f])&&(l=t.call(s,s.__data__,f,c))&&("__data__"in s&&(l.__data__=s.__data__),h[f]=l,Zq(h[f],e,n,f,h,Kq(s,n)));return new EC(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=PE(t));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var l,c=i[s],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var f,d=t.call(l,l.__data__,h,c),p=Kq(l,n),m=0,g=d.length;m<g;++m)(f=d[m])&&Zq(f,e,n,m,d,p);o.push(d),a.push(l)}return new EC(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=RE(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new EC(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new EC(a,this._parents,this._name,this._id)},selection:function(){return new bC(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=qC(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var u=Kq(a,e);Zq(a,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new EC(i,this._parents,t,n)},call:CC.call,nodes:CC.nodes,node:CC.node,size:CC.size,empty:CC.empty,each:CC.each,on:function(t,e){var n=this._id;return arguments.length<2?Kq(this.node(),n).on.on(t):this.each(xC(n,t,e))},attr:function(t,e){var n=HE(t),i="transform"===n?Bi:iC;return this.attrTween(t,"function"==typeof e?(n.local?cC:lC)(n,i,nC(this,"attr."+t,e)):null==e?(n.local?oC:rC)(n):(n.local?sC:aC)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=HE(t);return this.tween(n,(i.local?fC:dC)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Fi:iC;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var o=nq(this,t),a=(this.style.removeProperty(t),nq(this,t));return o===a?null:o===n&&a===i?r:r=e(n=o,i=a)}}(t,i)).on("end.style."+t,wC(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,o;return function(){var a=nq(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=nq(this,t)),a===l?null:a===i&&l===r?o:(r=l,o=e(i=a,s))}}(t,i,nC(this,"style."+t,e))).each(function(t,e){var n,i,r,o,a="style."+e,s="end."+a;return function(){var l=Jq(this,t),c=l.on,u=null==l.value[a]?o||(o=wC(e)):void 0;c===n&&r===u||(i=(n=c).copy()).on(s,r=u),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,o=n+"";return function(){var a=nq(this,t);return a===o?null:a===i?r:r=e(i=a,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,MC(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(nC(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,TC(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Kq(this.node(),n).tween,o=0,a=r.length;o<a;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?tC:eC)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?pC:mC)(e,t)):Kq(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?gC:vC)(e,t)):Kq(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(yC(e,t)):Kq(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Jq(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(o,a){var s={value:a},l={value:function(){0==--r&&o()}};n.each((function(){var n=Jq(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===r&&o()}))},[Symbol.iterator]:CC[Symbol.iterator]};var PC={time:null,delay:0,duration:250,ease:mr};function RC(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Bq.prototype.interrupt=function(t){return this.each((function(){$q(this,t)}))},Bq.prototype.transition=function(t){var e,n;t instanceof EC?(e=t._id,t=t._name):(e=qC(),(n=PC).time=pi(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)(a=s[c])&&Zq(a,t,e,c,s,n||RC(a,e));return new EC(i,this._parents,t,e)};var LC=t=>()=>t;function IC(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function DC(t,e,n){this.k=t,this.x=e,this.y=n}DC.prototype={constructor:DC,scale:function(t){return 1===t?this:new DC(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new DC(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var OC=new DC(1,0,0);function NC(t){for(;!t.__zoom;)if(!(t=t.parentNode))return OC;return t.__zoom}function FC(t){t.stopImmediatePropagation()}NC.prototype=DC.prototype;var BC=function(t){t.preventDefault(),t.stopImmediatePropagation()};function zC(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function UC(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function kC(){return this.__zoom||OC}function jC(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function VC(){return navigator.maxTouchPoints||"ontouchstart"in this}function GC(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}var HC=function(){var t,e,n,i=zC,r=UC,o=GC,a=jC,s=VC,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=Hq,f=Object(Gt.dispatch)("start","zoom","end"),d=0,p=10;function m(t){t.property("__zoom",kC).on("wheel.zoom",_).on("mousedown.zoom",M).on("dblclick.zoom",S).filter(s).on("touchstart.zoom",T).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new DC(e,t.x,t.y)}function v(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new DC(t.k,i,r)}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function x(t,e,n,i){t.on("start.zoom",(function(){b(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){b(this,arguments).event(i).end()})).tween("zoom",(function(){var t=this,o=arguments,a=b(t,o).event(i),s=r.apply(t,o),l=null==n?y(s):"function"==typeof n?n.apply(t,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=t.__zoom,f="function"==typeof e?e.apply(t,o):e,d=h(u.invert(l).concat(c/u.k),f.invert(l).concat(c/f.k));return function(t){if(1===t)t=f;else{var e=d(t),n=c/e[2];t=new DC(n,l[0]-e[0]*n,l[1]-e[1]*n)}a.zoom(null,t)}}))}function b(t,e,n){return!n&&t.__zooming||new w(t,e)}function w(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function _(t,...e){if(i.apply(this,arguments)){var n=b(this,e).event(t),r=this.__zoom,s=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,a.apply(this,arguments)))),u=Wq(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=r.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(r.k===s)return;n.mouse=[u,r.invert(u)],$q(this),n.start()}BC(t),n.wheel=setTimeout(h,150),n.zoom("mouse",o(v(g(r,s),n.mouse[0],n.mouse[1]),n.extent,c))}function h(){n.wheel=null,n.end()}}function M(t,...e){if(!n&&i.apply(this,arguments)){var r=b(this,e,!0).event(t),a=zq(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",p,!0),s=Wq(t,l),l=t.currentTarget,u=t.clientX,h=t.clientY;kq(t.view),FC(t),r.mouse=[s,this.__zoom.invert(s)],$q(this),r.start()}function f(t){if(BC(t),!r.moved){var e=t.clientX-u,n=t.clientY-h;r.moved=e*e+n*n>d}r.event(t).zoom("mouse",o(v(r.that.__zoom,r.mouse[0]=Wq(t,l),r.mouse[1]),r.extent,c))}function p(t){a.on("mousemove.zoom mouseup.zoom",null),jq(t.view,r.moved),BC(t),r.event(t).end()}}function S(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,a=Wq(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),l=n.k*(t.shiftKey?.5:2),h=o(v(g(n,l),a,s),r.apply(this,e),c);BC(t),u>0?zq(this).transition().duration(u).call(x,h,a,t):zq(this).call(m.transform,h,a,t)}}function T(n,...r){if(i.apply(this,arguments)){var o,a,s,l,c=n.touches,u=c.length,h=b(this,r,n.changedTouches.length===u).event(n);for(FC(n),a=0;a<u;++a)s=c[a],l=[l=Wq(s,this),this.__zoom.invert(l),s.identifier],h.touch0?h.touch1||h.touch0[2]===l[2]||(h.touch1=l,h.taps=0):(h.touch0=l,o=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(h.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),500)),$q(this),h.start())}}function A(t,...e){if(this.__zooming){var n,i,r,a,s=b(this,e).event(t),l=t.changedTouches,u=l.length;for(BC(t),n=0;n<u;++n)i=l[n],r=Wq(i,this),s.touch0&&s.touch0[2]===i.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===i.identifier&&(s.touch1[0]=r);if(i=s.that.__zoom,s.touch1){var h=s.touch0[0],f=s.touch0[1],d=s.touch1[0],p=s.touch1[1],m=(m=d[0]-h[0])*m+(m=d[1]-h[1])*m,y=(y=p[0]-f[0])*y+(y=p[1]-f[1])*y;i=g(i,Math.sqrt(m/y)),r=[(h[0]+d[0])/2,(h[1]+d[1])/2],a=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(v(i,r,a),s.extent,c))}}function E(t,...i){if(this.__zooming){var r,o,a=b(this,i).event(t),s=t.changedTouches,l=s.length;for(FC(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),r=0;r<l;++r)o=s[r],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=Wq(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<p)){var c=zq(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return m.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",kC),t!==r?x(t,e,n,i):r.interrupt().each((function(){b(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,i){m.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n,i)},m.scaleTo=function(t,e,n,i){m.transform(t,(function(){var t=r.apply(this,arguments),i=this.__zoom,a=null==n?y(t):"function"==typeof n?n.apply(this,arguments):n,s=i.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return o(v(g(i,l),a,s),t,c)}),n,i)},m.translateBy=function(t,e,n,i){m.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},m.translateTo=function(t,e,n,i,a){m.transform(t,(function(){var t=r.apply(this,arguments),a=this.__zoom,s=null==i?y(t):"function"==typeof i?i.apply(this,arguments):i;return o(OC.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),i,a)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=zq(this.that).datum();f.call(t,this.that,new IC(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:f}),e)}},m.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:LC(+t),m):a},m.filter=function(t){return arguments.length?(i="function"==typeof t?t:LC(!!t),m):i},m.touchable=function(t){return arguments.length?(s="function"==typeof t?t:LC(!!t),m):s},m.extent=function(t){return arguments.length?(r="function"==typeof t?t:LC([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):r},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(o=t,m):o},m.duration=function(t){return arguments.length?(u=+t,m):u},m.interpolate=function(t){return arguments.length?(h=t,m):h},m.on=function(){var t=f.on.apply(f,arguments);return t===f?m:t},m.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,m):Math.sqrt(d)},m.tapDistance=function(t){return arguments.length?(p=+t,m):p},m};n.d(e,"version",(function(){return"6.2.0"})),n.d(e,"bisect",(function(){return u})),n.d(e,"bisectRight",(function(){return s})),n.d(e,"bisectLeft",(function(){return l})),n.d(e,"bisectCenter",(function(){return c})),n.d(e,"ascending",(function(){return i})),n.d(e,"bisector",(function(){return r})),n.d(e,"count",(function(){return h})),n.d(e,"cross",(function(){return m})),n.d(e,"cumsum",(function(){return g})),n.d(e,"descending",(function(){return v})),n.d(e,"deviation",(function(){return x})),n.d(e,"extent",(function(){return b})),n.d(e,"fsum",(function(){return _})),n.d(e,"Adder",(function(){return w})),n.d(e,"group",(function(){return S})),n.d(e,"groups",(function(){return T})),n.d(e,"index",(function(){return q})),n.d(e,"indexes",(function(){return C})),n.d(e,"rollup",(function(){return A})),n.d(e,"rollups",(function(){return E})),n.d(e,"bin",(function(){return V})),n.d(e,"histogram",(function(){return V})),n.d(e,"thresholdFreedmanDiaconis",(function(){return Q})),n.d(e,"thresholdScott",(function(){return J})),n.d(e,"thresholdSturges",(function(){return j})),n.d(e,"max",(function(){return G})),n.d(e,"maxIndex",(function(){return K})),n.d(e,"mean",(function(){return $})),n.d(e,"median",(function(){return tt})),n.d(e,"merge",(function(){return et})),n.d(e,"min",(function(){return H})),n.d(e,"minIndex",(function(){return nt})),n.d(e,"nice",(function(){return k})),n.d(e,"pairs",(function(){return it})),n.d(e,"permute",(function(){return ot})),n.d(e,"quantile",(function(){return Y})),n.d(e,"quantileSorted",(function(){return Z})),n.d(e,"quickselect",(function(){return W})),n.d(e,"range",(function(){return at})),n.d(e,"least",(function(){return st})),n.d(e,"leastIndex",(function(){return lt})),n.d(e,"greatest",(function(){return ct})),n.d(e,"greatestIndex",(function(){return ut})),n.d(e,"scan",(function(){return ht})),n.d(e,"shuffle",(function(){return ft})),n.d(e,"shuffler",(function(){return dt})),n.d(e,"sum",(function(){return pt})),n.d(e,"ticks",(function(){return B})),n.d(e,"tickIncrement",(function(){return z})),n.d(e,"tickStep",(function(){return U})),n.d(e,"transpose",(function(){return mt})),n.d(e,"variance",(function(){return y})),n.d(e,"zip",(function(){return vt})),n.d(e,"every",(function(){return yt})),n.d(e,"some",(function(){return xt})),n.d(e,"filter",(function(){return bt})),n.d(e,"map",(function(){return wt})),n.d(e,"reduce",(function(){return _t})),n.d(e,"reverse",(function(){return Mt})),n.d(e,"sort",(function(){return St})),n.d(e,"difference",(function(){return Tt})),n.d(e,"disjoint",(function(){return At})),n.d(e,"intersection",(function(){return qt})),n.d(e,"subset",(function(){return Pt})),n.d(e,"superset",(function(){return Ct})),n.d(e,"union",(function(){return Rt})),n.d(e,"axisTop",(function(){return Ut})),n.d(e,"axisRight",(function(){return kt})),n.d(e,"axisBottom",(function(){return jt})),n.d(e,"axisLeft",(function(){return Vt})),n.d(e,"brush",(function(){return Yr})),n.d(e,"brushX",(function(){return Wr})),n.d(e,"brushY",(function(){return Xr})),n.d(e,"brushSelection",(function(){return Hr})),n.d(e,"chord",(function(){return oo})),n.d(e,"chordTranspose",(function(){return ao})),n.d(e,"chordDirected",(function(){return so})),n.d(e,"ribbon",(function(){return wo})),n.d(e,"ribbonArrow",(function(){return _o})),n.d(e,"color",(function(){return zo})),n.d(e,"rgb",(function(){return Vo})),n.d(e,"hsl",(function(){return Qo})),n.d(e,"lab",(function(){return ia})),n.d(e,"hcl",(function(){return ha})),n.d(e,"lch",(function(){return ua})),n.d(e,"gray",(function(){return na})),n.d(e,"cubehelix",(function(){return xa})),n.d(e,"contours",(function(){return Ca})),n.d(e,"contourDensity",(function(){return Oa})),n.d(e,"Delaunay",(function(){return ns})),n.d(e,"Voronoi",(function(){return Qa})),n.d(e,"dispatch",(function(){return cs})),n.d(e,"drag",(function(){return Nl})),n.d(e,"dragDisable",(function(){return ql})),n.d(e,"dragEnable",(function(){return Cl})),n.d(e,"dsvFormat",(function(){return Vl})),n.d(e,"csvParse",(function(){return Hl})),n.d(e,"csvParseRows",(function(){return Wl})),n.d(e,"csvFormat",(function(){return Xl})),n.d(e,"csvFormatBody",(function(){return Yl})),n.d(e,"csvFormatRows",(function(){return Zl})),n.d(e,"csvFormatRow",(function(){return Ql})),n.d(e,"csvFormatValue",(function(){return Jl})),n.d(e,"tsvParse",(function(){return $l})),n.d(e,"tsvParseRows",(function(){return tc})),n.d(e,"tsvFormat",(function(){return ec})),n.d(e,"tsvFormatBody",(function(){return nc})),n.d(e,"tsvFormatRows",(function(){return ic})),n.d(e,"tsvFormatRow",(function(){return rc})),n.d(e,"tsvFormatValue",(function(){return oc})),n.d(e,"autoType",(function(){return ac})),n.d(e,"easeLinear",(function(){return lc})),n.d(e,"easeQuad",(function(){return hc})),n.d(e,"easeQuadIn",(function(){return cc})),n.d(e,"easeQuadOut",(function(){return uc})),n.d(e,"easeQuadInOut",(function(){return hc})),n.d(e,"easeCubic",(function(){return pc})),n.d(e,"easeCubicIn",(function(){return fc})),n.d(e,"easeCubicOut",(function(){return dc})),n.d(e,"easeCubicInOut",(function(){return pc})),n.d(e,"easePoly",(function(){return vc})),n.d(e,"easePolyIn",(function(){return mc})),n.d(e,"easePolyOut",(function(){return gc})),n.d(e,"easePolyInOut",(function(){return vc})),n.d(e,"easeSin",(function(){return _c})),n.d(e,"easeSinIn",(function(){return bc})),n.d(e,"easeSinOut",(function(){return wc})),n.d(e,"easeSinInOut",(function(){return _c})),n.d(e,"easeExp",(function(){return Ac})),n.d(e,"easeExpIn",(function(){return Sc})),n.d(e,"easeExpOut",(function(){return Tc})),n.d(e,"easeExpInOut",(function(){return Ac})),n.d(e,"easeCircle",(function(){return Cc})),n.d(e,"easeCircleIn",(function(){return Ec})),n.d(e,"easeCircleOut",(function(){return qc})),n.d(e,"easeCircleInOut",(function(){return Cc})),n.d(e,"easeBounce",(function(){return Rc})),n.d(e,"easeBounceIn",(function(){return Pc})),n.d(e,"easeBounceOut",(function(){return Rc})),n.d(e,"easeBounceInOut",(function(){return Lc})),n.d(e,"easeBack",(function(){return Oc})),n.d(e,"easeBackIn",(function(){return Ic})),n.d(e,"easeBackOut",(function(){return Dc})),n.d(e,"easeBackInOut",(function(){return Oc})),n.d(e,"easeElastic",(function(){return Bc})),n.d(e,"easeElasticIn",(function(){return Fc})),n.d(e,"easeElasticOut",(function(){return Bc})),n.d(e,"easeElasticInOut",(function(){return zc})),n.d(e,"blob",(function(){return kc})),n.d(e,"buffer",(function(){return Vc})),n.d(e,"dsv",(function(){return Xc})),n.d(e,"csv",(function(){return Yc})),n.d(e,"tsv",(function(){return Zc})),n.d(e,"image",(function(){return Qc})),n.d(e,"json",(function(){return Kc})),n.d(e,"text",(function(){return Hc})),n.d(e,"xml",(function(){return tu})),n.d(e,"html",(function(){return eu})),n.d(e,"svg",(function(){return nu})),n.d(e,"forceCenter",(function(){return iu})),n.d(e,"forceCollide",(function(){return gu})),n.d(e,"forceLink",(function(){return xu})),n.d(e,"forceManyBody",(function(){return Su})),n.d(e,"forceRadial",(function(){return Tu})),n.d(e,"forceSimulation",(function(){return Mu})),n.d(e,"forceX",(function(){return Au})),n.d(e,"forceY",(function(){return Eu})),n.d(e,"formatDefaultLocale",(function(){return Vu})),n.d(e,"format",(function(){return Ou})),n.d(e,"formatPrefix",(function(){return Nu})),n.d(e,"formatLocale",(function(){return ju})),n.d(e,"formatSpecifier",(function(){return Ru})),n.d(e,"FormatSpecifier",(function(){return Lu})),n.d(e,"precisionFixed",(function(){return Gu})),n.d(e,"precisionPrefix",(function(){return Hu})),n.d(e,"precisionRound",(function(){return Wu})),n.d(e,"geoArea",(function(){return Hh})),n.d(e,"geoBounds",(function(){return Ef})),n.d(e,"geoCentroid",(function(){return zf})),n.d(e,"geoCircle",(function(){return Qf})),n.d(e,"geoClipAntimeridian",(function(){return sd})),n.d(e,"geoClipCircle",(function(){return ld})),n.d(e,"geoClipExtent",(function(){return pd})),n.d(e,"geoClipRectangle",(function(){return cd})),n.d(e,"geoContains",(function(){return Rd})),n.d(e,"geoDistance",(function(){return _d})),n.d(e,"geoGraticule",(function(){return Dd})),n.d(e,"geoGraticule10",(function(){return Od})),n.d(e,"geoInterpolate",(function(){return Ud})),n.d(e,"geoLength",(function(){return xd})),n.d(e,"geoPath",(function(){return Bp})),n.d(e,"geoAlbers",(function(){return nm})),n.d(e,"geoAlbersUsa",(function(){return im})),n.d(e,"geoAzimuthalEqualArea",(function(){return sm})),n.d(e,"geoAzimuthalEqualAreaRaw",(function(){return am})),n.d(e,"geoAzimuthalEquidistant",(function(){return cm})),n.d(e,"geoAzimuthalEquidistantRaw",(function(){return lm})),n.d(e,"geoConicConformal",(function(){return mm})),n.d(e,"geoConicConformalRaw",(function(){return pm})),n.d(e,"geoConicEqualArea",(function(){return em})),n.d(e,"geoConicEqualAreaRaw",(function(){return tm})),n.d(e,"geoConicEquidistant",(function(){return xm})),n.d(e,"geoConicEquidistantRaw",(function(){return ym})),n.d(e,"geoEqualEarth",(function(){return Am})),n.d(e,"geoEqualEarthRaw",(function(){return Tm})),n.d(e,"geoEquirectangular",(function(){return vm})),n.d(e,"geoEquirectangularRaw",(function(){return gm})),n.d(e,"geoGnomonic",(function(){return qm})),n.d(e,"geoGnomonicRaw",(function(){return Em})),n.d(e,"geoIdentity",(function(){return Cm})),n.d(e,"geoProjection",(function(){return Jp})),n.d(e,"geoProjectionMutator",(function(){return Kp})),n.d(e,"geoMercator",(function(){return hm})),n.d(e,"geoMercatorRaw",(function(){return um})),n.d(e,"geoNaturalEarth1",(function(){return Rm})),n.d(e,"geoNaturalEarth1Raw",(function(){return Pm})),n.d(e,"geoOrthographic",(function(){return Im})),n.d(e,"geoOrthographicRaw",(function(){return Lm})),n.d(e,"geoStereographic",(function(){return Om})),n.d(e,"geoStereographicRaw",(function(){return Dm})),n.d(e,"geoTransverseMercator",(function(){return Fm})),n.d(e,"geoTransverseMercatorRaw",(function(){return Nm})),n.d(e,"geoRotation",(function(){return Xf})),n.d(e,"geoStream",(function(){return Ah})),n.d(e,"geoTransform",(function(){return zp})),n.d(e,"cluster",(function(){return km})),n.d(e,"hierarchy",(function(){return Vm})),n.d(e,"pack",(function(){return pg})),n.d(e,"packSiblings",(function(){return lg})),n.d(e,"packEnclose",(function(){return Zm})),n.d(e,"partition",(function(){return bg})),n.d(e,"stratify",(function(){return Tg})),n.d(e,"tree",(function(){return Lg})),n.d(e,"treemap",(function(){return Fg})),n.d(e,"treemapBinary",(function(){return Bg})),n.d(e,"treemapDice",(function(){return xg})),n.d(e,"treemapSlice",(function(){return Ig})),n.d(e,"treemapSliceDice",(function(){return zg})),n.d(e,"treemapSquarify",(function(){return Ng})),n.d(e,"treemapResquarify",(function(){return Ug})),n.d(e,"interpolate",(function(){return uv})),n.d(e,"interpolateArray",(function(){return ev})),n.d(e,"interpolateBasis",(function(){return jg})),n.d(e,"interpolateBasisClosed",(function(){return Vg})),n.d(e,"interpolateDate",(function(){return iv})),n.d(e,"interpolateDiscrete",(function(){return hv})),n.d(e,"interpolateHue",(function(){return fv})),n.d(e,"interpolateNumber",(function(){return rv})),n.d(e,"interpolateNumberArray",(function(){return $g})),n.d(e,"interpolateObject",(function(){return ov})),n.d(e,"interpolateRound",(function(){return dv})),n.d(e,"interpolateString",(function(){return cv})),n.d(e,"interpolateTransformCss",(function(){return yv})),n.d(e,"interpolateTransformSvg",(function(){return xv})),n.d(e,"interpolateZoom",(function(){return wv})),n.d(e,"interpolateRgb",(function(){return Zg})),n.d(e,"interpolateRgbBasis",(function(){return Jg})),n.d(e,"interpolateRgbBasisClosed",(function(){return Kg})),n.d(e,"interpolateHsl",(function(){return Mv})),n.d(e,"interpolateHslLong",(function(){return Sv})),n.d(e,"interpolateLab",(function(){return Tv})),n.d(e,"interpolateHcl",(function(){return Ev})),n.d(e,"interpolateHclLong",(function(){return qv})),n.d(e,"interpolateCubehelix",(function(){return Pv})),n.d(e,"interpolateCubehelixLong",(function(){return Rv})),n.d(e,"piecewise",(function(){return Lv})),n.d(e,"quantize",(function(){return Iv})),n.d(e,"path",(function(){return zv})),n.d(e,"polygonArea",(function(){return Uv})),n.d(e,"polygonCentroid",(function(){return kv})),n.d(e,"polygonHull",(function(){return Gv})),n.d(e,"polygonContains",(function(){return Hv})),n.d(e,"polygonLength",(function(){return Wv})),n.d(e,"quadtree",(function(){return lu})),n.d(e,"randomUniform",(function(){return Yv})),n.d(e,"randomInt",(function(){return Zv})),n.d(e,"randomNormal",(function(){return Qv})),n.d(e,"randomLogNormal",(function(){return Jv})),n.d(e,"randomBates",(function(){return $v})),n.d(e,"randomIrwinHall",(function(){return Kv})),n.d(e,"randomExponential",(function(){return ty})),n.d(e,"randomPareto",(function(){return ey})),n.d(e,"randomBernoulli",(function(){return ny})),n.d(e,"randomGeometric",(function(){return iy})),n.d(e,"randomBinomial",(function(){return ay})),n.d(e,"randomGamma",(function(){return ry})),n.d(e,"randomBeta",(function(){return oy})),n.d(e,"randomWeibull",(function(){return sy})),n.d(e,"randomCauchy",(function(){return ly})),n.d(e,"randomLogistic",(function(){return cy})),n.d(e,"randomPoisson",(function(){return uy})),n.d(e,"randomLcg",(function(){return fy})),n.d(e,"scaleBand",(function(){return vy})),n.d(e,"scalePoint",(function(){return xy})),n.d(e,"scaleIdentity",(function(){return Iy})),n.d(e,"scaleLinear",(function(){return Ly})),n.d(e,"scaleLog",(function(){return jy})),n.d(e,"scaleSymlog",(function(){return Wy})),n.d(e,"scaleOrdinal",(function(){return gy})),n.d(e,"scaleImplicit",(function(){return my})),n.d(e,"scalePow",(function(){return Jy})),n.d(e,"scaleSqrt",(function(){return Ky})),n.d(e,"scaleRadial",(function(){return ex})),n.d(e,"scaleQuantile",(function(){return nx})),n.d(e,"scaleQuantize",(function(){return ix})),n.d(e,"scaleThreshold",(function(){return rx})),n.d(e,"scaleTime",(function(){return kw})),n.d(e,"scaleUtc",(function(){return Jw})),n.d(e,"scaleSequential",(function(){return t_})),n.d(e,"scaleSequentialLog",(function(){return e_})),n.d(e,"scaleSequentialPow",(function(){return i_})),n.d(e,"scaleSequentialSqrt",(function(){return r_})),n.d(e,"scaleSequentialSymlog",(function(){return n_})),n.d(e,"scaleSequentialQuantile",(function(){return o_})),n.d(e,"scaleDiverging",(function(){return l_})),n.d(e,"scaleDivergingLog",(function(){return c_})),n.d(e,"scaleDivergingPow",(function(){return h_})),n.d(e,"scaleDivergingSqrt",(function(){return f_})),n.d(e,"scaleDivergingSymlog",(function(){return u_})),n.d(e,"tickFormat",(function(){return Py})),n.d(e,"schemeCategory10",(function(){return p_})),n.d(e,"schemeAccent",(function(){return m_})),n.d(e,"schemeDark2",(function(){return g_})),n.d(e,"schemePaired",(function(){return v_})),n.d(e,"schemePastel1",(function(){return y_})),n.d(e,"schemePastel2",(function(){return x_})),n.d(e,"schemeSet1",(function(){return b_})),n.d(e,"schemeSet2",(function(){return w_})),n.d(e,"schemeSet3",(function(){return __})),n.d(e,"schemeTableau10",(function(){return M_})),n.d(e,"interpolateBrBG",(function(){return A_})),n.d(e,"schemeBrBG",(function(){return T_})),n.d(e,"interpolatePRGn",(function(){return q_})),n.d(e,"schemePRGn",(function(){return E_})),n.d(e,"interpolatePiYG",(function(){return P_})),n.d(e,"schemePiYG",(function(){return C_})),n.d(e,"interpolatePuOr",(function(){return L_})),n.d(e,"schemePuOr",(function(){return R_})),n.d(e,"interpolateRdBu",(function(){return D_})),n.d(e,"schemeRdBu",(function(){return I_})),n.d(e,"interpolateRdGy",(function(){return N_})),n.d(e,"schemeRdGy",(function(){return O_})),n.d(e,"interpolateRdYlBu",(function(){return B_})),n.d(e,"schemeRdYlBu",(function(){return F_})),n.d(e,"interpolateRdYlGn",(function(){return U_})),n.d(e,"schemeRdYlGn",(function(){return z_})),n.d(e,"interpolateSpectral",(function(){return j_})),n.d(e,"schemeSpectral",(function(){return k_})),n.d(e,"interpolateBuGn",(function(){return G_})),n.d(e,"schemeBuGn",(function(){return V_})),n.d(e,"interpolateBuPu",(function(){return W_})),n.d(e,"schemeBuPu",(function(){return H_})),n.d(e,"interpolateGnBu",(function(){return Y_})),n.d(e,"schemeGnBu",(function(){return X_})),n.d(e,"interpolateOrRd",(function(){return Q_})),n.d(e,"schemeOrRd",(function(){return Z_})),n.d(e,"interpolatePuBuGn",(function(){return K_})),n.d(e,"schemePuBuGn",(function(){return J_})),n.d(e,"interpolatePuBu",(function(){return tM})),n.d(e,"schemePuBu",(function(){return $_})),n.d(e,"interpolatePuRd",(function(){return nM})),n.d(e,"schemePuRd",(function(){return eM})),n.d(e,"interpolateRdPu",(function(){return rM})),n.d(e,"schemeRdPu",(function(){return iM})),n.d(e,"interpolateYlGnBu",(function(){return aM})),n.d(e,"schemeYlGnBu",(function(){return oM})),n.d(e,"interpolateYlGn",(function(){return lM})),n.d(e,"schemeYlGn",(function(){return sM})),n.d(e,"interpolateYlOrBr",(function(){return uM})),n.d(e,"schemeYlOrBr",(function(){return cM})),n.d(e,"interpolateYlOrRd",(function(){return fM})),n.d(e,"schemeYlOrRd",(function(){return hM})),n.d(e,"interpolateBlues",(function(){return pM})),n.d(e,"schemeBlues",(function(){return dM})),n.d(e,"interpolateGreens",(function(){return gM})),n.d(e,"schemeGreens",(function(){return mM})),n.d(e,"interpolateGreys",(function(){return yM})),n.d(e,"schemeGreys",(function(){return vM})),n.d(e,"interpolatePurples",(function(){return bM})),n.d(e,"schemePurples",(function(){return xM})),n.d(e,"interpolateReds",(function(){return _M})),n.d(e,"schemeReds",(function(){return wM})),n.d(e,"interpolateOranges",(function(){return SM})),n.d(e,"schemeOranges",(function(){return MM})),n.d(e,"interpolateCividis",(function(){return TM})),n.d(e,"interpolateCubehelixDefault",(function(){return IM})),n.d(e,"interpolateRainbow",(function(){return FM})),n.d(e,"interpolateWarm",(function(){return DM})),n.d(e,"interpolateCool",(function(){return OM})),n.d(e,"interpolateSinebow",(function(){return kM})),n.d(e,"interpolateTurbo",(function(){return jM})),n.d(e,"interpolateViridis",(function(){return GM})),n.d(e,"interpolateMagma",(function(){return HM})),n.d(e,"interpolateInferno",(function(){return WM})),n.d(e,"interpolatePlasma",(function(){return XM})),n.d(e,"create",(function(){return YM})),n.d(e,"creator",(function(){return ll})),n.d(e,"local",(function(){return QM})),n.d(e,"matcher",(function(){return ms})),n.d(e,"namespace",(function(){return Cs})),n.d(e,"namespaces",(function(){return qs})),n.d(e,"pointer",(function(){return Tl})),n.d(e,"pointers",(function(){return KM})),n.d(e,"select",(function(){return Ml})),n.d(e,"selectAll",(function(){return $M})),n.d(e,"selection",(function(){return _l})),n.d(e,"selector",(function(){return hs})),n.d(e,"selectorAll",(function(){return ps})),n.d(e,"style",(function(){return Us})),n.d(e,"window",(function(){return Ns})),n.d(e,"arc",(function(){return bS})),n.d(e,"area",(function(){return qS})),n.d(e,"line",(function(){return ES})),n.d(e,"pie",(function(){return RS})),n.d(e,"areaRadial",(function(){return FS})),n.d(e,"radialArea",(function(){return FS})),n.d(e,"lineRadial",(function(){return NS})),n.d(e,"radialLine",(function(){return NS})),n.d(e,"pointRadial",(function(){return BS})),n.d(e,"linkHorizontal",(function(){return HS})),n.d(e,"linkVertical",(function(){return WS})),n.d(e,"linkRadial",(function(){return XS})),n.d(e,"symbol",(function(){return hT})),n.d(e,"symbols",(function(){return uT})),n.d(e,"symbolCircle",(function(){return YS})),n.d(e,"symbolCross",(function(){return ZS})),n.d(e,"symbolDiamond",(function(){return KS})),n.d(e,"symbolSquare",(function(){return iT})),n.d(e,"symbolStar",(function(){return nT})),n.d(e,"symbolTriangle",(function(){return oT})),n.d(e,"symbolWye",(function(){return cT})),n.d(e,"curveBasisClosed",(function(){return vT})),n.d(e,"curveBasisOpen",(function(){return xT})),n.d(e,"curveBasis",(function(){return mT})),n.d(e,"curveBundle",(function(){return wT})),n.d(e,"curveCardinalClosed",(function(){return AT})),n.d(e,"curveCardinalOpen",(function(){return qT})),n.d(e,"curveCardinal",(function(){return ST})),n.d(e,"curveCatmullRomClosed",(function(){return IT})),n.d(e,"curveCatmullRomOpen",(function(){return OT})),n.d(e,"curveCatmullRom",(function(){return RT})),n.d(e,"curveLinearClosed",(function(){return FT})),n.d(e,"curveLinear",(function(){return SS})),n.d(e,"curveMonotoneX",(function(){return HT})),n.d(e,"curveMonotoneY",(function(){return WT})),n.d(e,"curveNatural",(function(){return ZT})),n.d(e,"curveStep",(function(){return JT})),n.d(e,"curveStepAfter",(function(){return $T})),n.d(e,"curveStepBefore",(function(){return KT})),n.d(e,"stack",(function(){return rA})),n.d(e,"stackOffsetExpand",(function(){return oA})),n.d(e,"stackOffsetDiverging",(function(){return aA})),n.d(e,"stackOffsetNone",(function(){return tA})),n.d(e,"stackOffsetSilhouette",(function(){return sA})),n.d(e,"stackOffsetWiggle",(function(){return lA})),n.d(e,"stackOrderAppearance",(function(){return cA})),n.d(e,"stackOrderAscending",(function(){return hA})),n.d(e,"stackOrderDescending",(function(){return dA})),n.d(e,"stackOrderInsideOut",(function(){return pA})),n.d(e,"stackOrderNone",(function(){return eA})),n.d(e,"stackOrderReverse",(function(){return mA})),n.d(e,"timeInterval",(function(){return sx})),n.d(e,"timeMillisecond",(function(){return jx})),n.d(e,"timeMilliseconds",(function(){return Vx})),n.d(e,"utcMillisecond",(function(){return jx})),n.d(e,"utcMilliseconds",(function(){return Vx})),n.d(e,"timeSecond",(function(){return zx})),n.d(e,"timeSeconds",(function(){return Ux})),n.d(e,"utcSecond",(function(){return zx})),n.d(e,"utcSeconds",(function(){return Ux})),n.d(e,"timeMinute",(function(){return Nx})),n.d(e,"timeMinutes",(function(){return Fx})),n.d(e,"timeHour",(function(){return Ix})),n.d(e,"timeHours",(function(){return Dx})),n.d(e,"timeDay",(function(){return Px})),n.d(e,"timeDays",(function(){return Rx})),n.d(e,"timeWeek",(function(){return mx})),n.d(e,"timeWeeks",(function(){return _x})),n.d(e,"timeSunday",(function(){return mx})),n.d(e,"timeSundays",(function(){return _x})),n.d(e,"timeMonday",(function(){return gx})),n.d(e,"timeMondays",(function(){return Mx})),n.d(e,"timeTuesday",(function(){return vx})),n.d(e,"timeTuesdays",(function(){return Sx})),n.d(e,"timeWednesday",(function(){return yx})),n.d(e,"timeWednesdays",(function(){return Tx})),n.d(e,"timeThursday",(function(){return xx})),n.d(e,"timeThursdays",(function(){return Ax})),n.d(e,"timeFriday",(function(){return bx})),n.d(e,"timeFridays",(function(){return Ex})),n.d(e,"timeSaturday",(function(){return wx})),n.d(e,"timeSaturdays",(function(){return qx})),n.d(e,"timeMonth",(function(){return fx})),n.d(e,"timeMonths",(function(){return dx})),n.d(e,"timeYear",(function(){return cx})),n.d(e,"timeYears",(function(){return ux})),n.d(e,"utcMinute",(function(){return Zw})),n.d(e,"utcMinutes",(function(){return Qw})),n.d(e,"utcHour",(function(){return Ww})),n.d(e,"utcHours",(function(){return Xw})),n.d(e,"utcDay",(function(){return ab})),n.d(e,"utcDays",(function(){return sb})),n.d(e,"utcWeek",(function(){return Hx})),n.d(e,"utcWeeks",(function(){return Kx})),n.d(e,"utcSunday",(function(){return Hx})),n.d(e,"utcSundays",(function(){return Kx})),n.d(e,"utcMonday",(function(){return Wx})),n.d(e,"utcMondays",(function(){return $x})),n.d(e,"utcTuesday",(function(){return Xx})),n.d(e,"utcTuesdays",(function(){return tb})),n.d(e,"utcWednesday",(function(){return Yx})),n.d(e,"utcWednesdays",(function(){return eb})),n.d(e,"utcThursday",(function(){return Zx})),n.d(e,"utcThursdays",(function(){return nb})),n.d(e,"utcFriday",(function(){return Qx})),n.d(e,"utcFridays",(function(){return ib})),n.d(e,"utcSaturday",(function(){return Jx})),n.d(e,"utcSaturdays",(function(){return rb})),n.d(e,"utcMonth",(function(){return Vw})),n.d(e,"utcMonths",(function(){return Gw})),n.d(e,"utcYear",(function(){return cb})),n.d(e,"utcYears",(function(){return ub})),n.d(e,"timeFormatDefaultLocale",(function(){return Fw})),n.d(e,"timeFormat",(function(){return gb})),n.d(e,"timeParse",(function(){return vb})),n.d(e,"utcFormat",(function(){return yb})),n.d(e,"utcParse",(function(){return xb})),n.d(e,"timeFormatLocale",(function(){return pb})),n.d(e,"isoFormat",(function(){return gA})),n.d(e,"isoParse",(function(){return xA})),n.d(e,"now",(function(){return qA})),n.d(e,"timer",(function(){return RA})),n.d(e,"timerFlush",(function(){return LA})),n.d(e,"timeout",(function(){return NA})),n.d(e,"interval",(function(){return FA})),n.d(e,"transition",(function(){return xE})),n.d(e,"active",(function(){return TE})),n.d(e,"interrupt",(function(){return GA})),n.d(e,"zoom",(function(){return HC})),n.d(e,"zoomTransform",(function(){return NC})),n.d(e,"zoomIdentity",(function(){return OC}))},function(t,e,n){"use strict";var i=n(89);let r={font:"Arial",color:"#222222",barColor:"#1e282c",sepColor:"#292929",panelColor:"#222d32",resizeTabColor:"#26405b",boxColor:"#444444",textColor:"#FFFFFF",iconColor:"#FFFFFF",tabButtonColor:"#377c2fad",buttonColor:"#3c8dbc",buttonOverColor:"#6f6a804d",buttonLightColor:"#ecf0f5",menuBarColor:"#3c8dbc",menuColor:"#3c8dbc",menuOverColor:"#6f6a804d",accordionContainerBackground:"#ecf0f5",accordionItemHeaderBackground:"#555555",accordionItemBackground:"#eee5",accordionItemBorder:"#242424",addComponentsContainerBackground:"#333",sliderTrack:"#ecf0f5",sliderProgress:"#555555",sliderScrubber:"#26d212"};i.a.register(r,"light");let o={font:"Arial",color:"#ffffff",barColor:"#111111",barColor2:"#222222",barColor3:"#333333",sepColor:"#292929",panelColor:"#333333",resizeTabColor:"#222222",boxColor:"#444444",textColor:"#FFFFFF",iconColor:"#FFFFFF",tabButtonColor:"#377c2fad",buttonColor:"#355d30a8",buttonOverColor:"#2ec01dad",buttonLightColor:"#333333",menuBarColor:"#355d30",menuColor:"#355d30",menuOverColor:"#2ec01d",accordionContainerBackground:"#333333",accordionItemHeaderBackground:"#555555",accordionItemBackground:"#eee5",accordionItemBorder:"#242424",addComponentsContainerBackground:"#333",sliderTrack:"#222222",sliderProgress:"#555555",sliderScrubber:"#26d212",audioTrack:"#222222",audioProgress:"#555555",audioScrubber:"#26d212"};i.a.register(o,"dark");var a=i.a.get(Settings.general.theme);window.Theme=a},,,,,,,,,,,,,,function(t,e,n){t.exports=function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};e[a][0].call(l.exports,(function(t){var n=e[a][1][t];return r(n||t)}),l,l.exports,t,e,n,i)}return n[a].exports}for(var o=!1,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,n){var i=t("../math/Vec3");function r(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=r;var o=new i;r.prototype.setFromPoints=function(t,e,n,i){var r=this.lowerBound,a=this.upperBound,s=n;r.copy(t[0]),s&&s.vmult(r,r),a.copy(r);for(var l=1;l<t.length;l++){var c=t[l];s&&(s.vmult(c,o),c=o),c.x>a.x&&(a.x=c.x),c.x<r.x&&(r.x=c.x),c.y>a.y&&(a.y=c.y),c.y<r.y&&(r.y=c.y),c.z>a.z&&(a.z=c.z),c.z<r.z&&(r.z=c.z)}return e&&(e.vadd(r,r),e.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this},r.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n),e=t.lowerBound.y,this.lowerBound.y>e&&(this.lowerBound.y=e),n=t.upperBound.y,this.upperBound.y<n&&(this.upperBound.y=n),e=t.lowerBound.z,this.lowerBound.z>e&&(this.lowerBound.z=e),n=t.upperBound.z,this.upperBound.z<n&&(this.upperBound.z=n)},r.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return(i.x<=n.x&&n.x<=r.x||e.x<=r.x&&r.x<=n.x)&&(i.y<=n.y&&n.y<=r.y||e.y<=r.y&&r.y<=n.y)&&(i.z<=n.z&&n.z<=r.z||e.z<=r.z&&r.z<=n.z)},r.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return e.x<=i.x&&n.x>=r.x&&e.y<=i.y&&n.y>=r.y&&e.z<=i.z&&n.z>=r.z},r.prototype.getCorners=function(t,e,n,i,r,o,a,s){var l=this.lowerBound,c=this.upperBound;t.copy(l),e.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),r.set(c.x,l.y,l.z),o.set(l.x,c.y,l.z),a.set(l.x,l.y,c.z),s.copy(c)};var a=[new i,new i,new i,new i,new i,new i,new i,new i];r.prototype.toLocalFrame=function(t,e){var n=a,i=n[0],r=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7];this.getCorners(i,r,o,s,l,c,u,h);for(var f=0;8!==f;f++){var d=n[f];t.pointToLocal(d,d)}return e.setFromPoints(n)},r.prototype.toWorldFrame=function(t,e){var n=a,i=n[0],r=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7];this.getCorners(i,r,o,s,l,c,u,h);for(var f=0;8!==f;f++){var d=n[f];t.pointToWorld(d,d)}return e.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,n){function i(){this.matrix=[]}e.exports=i,i.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}return this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,n){if(t=t.index,(e=e.index)>t){var i=e;e=t,t=i}this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var i=t("../objects/Body"),r=t("../math/Vec3"),o=t("../math/Quaternion");function a(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),e.exports=a,a.prototype.collisionPairs=function(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var s=i.STATIC|i.KINEMATIC;a.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&s)&&t.sleepState!==i.SLEEPING||0==(e.type&s)&&e.sleepState!==i.SLEEPING)},a.prototype.intersectionTest=function(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)};var l=new r;new r,new o,new r,a.prototype.doBoundingSphereBroadphase=function(t,e,n,i){var r=l;e.position.vsub(t.position,r);var o=Math.pow(t.boundingRadius+e.boundingRadius,2);r.norm2()<o&&(n.push(t),i.push(e))},a.prototype.doBoundingBoxBroadphase=function(t,e,n,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))};var c={keys:[]},u=[],h=[];a.prototype.makePairsUnique=function(t,e){for(var n=c,i=u,r=h,o=t.length,a=0;a!==o;a++)i[a]=t[a],r[a]=e[a];for(t.length=0,e.length=0,a=0;a!==o;a++){var s=i[a].id,l=r[a].id;n[f=s<l?s+","+l:l+","+s]=a,n.keys.push(f)}for(a=0;a!==n.keys.length;a++){var f=n.keys.pop(),d=n[f];t.push(i[d]),e.push(r[d]),delete n[f]}},a.prototype.setWorld=function(t){};var f=new r;a.boundingSphereCheck=function(t,e){var n=f;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},a.prototype.aabbQuery=function(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,n){e.exports=a;var i=t("./Broadphase"),r=t("../math/Vec3"),o=t("../shapes/Shape");function a(t,e,n,o,a){i.apply(this),this.nx=n||10,this.ny=o||10,this.nz=a||10,this.aabbMin=t||new r(100,100,100),this.aabbMax=e||new r(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(s<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var l=0;l<s;l++)this.bins[l]=[],this.binLengths[l]=0}a.prototype=new i,a.prototype.constructor=a;var s=new r;new r,a.prototype.collisionPairs=function(t,e,n){for(var i=t.numObjects(),r=t.bodies,a=this.aabbMax,l=this.aabbMin,c=this.nx,u=this.ny,h=this.nz,f=u*h,d=h,p=a.x,m=a.y,g=a.z,v=l.x,y=l.y,x=l.z,b=c/(p-v),w=u/(m-y),_=h/(g-x),M=(p-v)/c,S=(m-y)/u,T=(g-x)/h,A=.5*Math.sqrt(M*M+S*S+T*T),E=o.types,q=E.SPHERE,C=E.PLANE,P=(E.BOX,E.COMPOUND,E.CONVEXPOLYHEDRON,this.bins),R=this.binLengths,L=this.bins.length,I=0;I!==L;I++)R[I]=0;var D=Math.ceil;function O(t,e,n,i,r,o,a){var s=(t-v)*b|0,l=(e-y)*w|0,p=(n-x)*_|0,m=D((i-v)*b),g=D((r-y)*w),M=D((o-x)*_);s<0?s=0:s>=c&&(s=c-1),l<0?l=0:l>=u&&(l=u-1),p<0?p=0:p>=h&&(p=h-1),m<0?m=0:m>=c&&(m=c-1),g<0?g=0:g>=u&&(g=u-1),M<0?M=0:M>=h&&(M=h-1),l*=d,p*=1,m*=f,g*=d,M*=1;for(var S=s*=f;S<=m;S+=f)for(var T=l;T<=g;T+=d)for(var A=p;A<=M;A+=1){var E=S+T+A;P[E][R[E]++]=a}}for(l=Math.min,a=Math.max,I=0;I!==i;I++){var N=(et=r[I]).shape;switch(N.type){case q:var F=et.position.x,B=et.position.y,z=et.position.z,U=N.radius;O(F-U,B-U,z-U,F+U,B+U,z+U,et);break;case C:N.worldNormalNeedsUpdate&&N.computeWorldNormal(et.quaternion);var k=N.worldNormal,j=v+.5*M-et.position.x,V=y+.5*S-et.position.y,G=x+.5*T-et.position.z,H=s;H.set(j,V,G);for(var W=0,X=0;W!==c;W++,X+=f,H.y=V,H.x+=M)for(var Y=0,Z=0;Y!==u;Y++,Z+=d,H.z=G,H.y+=S)for(var Q=0,J=0;Q!==h;Q++,J+=1,H.z+=T)if(H.dot(k)<A){var K=X+Z+J;P[K][R[K]++]=et}break;default:et.aabbNeedsUpdate&&et.computeAABB(),O(et.aabb.lowerBound.x,et.aabb.lowerBound.y,et.aabb.lowerBound.z,et.aabb.upperBound.x,et.aabb.upperBound.y,et.aabb.upperBound.z,et)}}for(I=0;I!==L;I++){var $=R[I];if($>1){var tt=P[I];for(W=0;W!==$;W++){var et=tt[W];for(Y=0;Y!==W;Y++){var nt=tt[Y];this.needBroadphaseCollision(et,nt)&&this.intersectionTest(et,nt,e,n)}}}}this.makePairsUnique(e,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,n){e.exports=o;var i=t("./Broadphase"),r=t("./AABB");function o(){i.apply(this)}o.prototype=new i,o.prototype.constructor=o,o.prototype.collisionPairs=function(t,e,n){var i,r,o,a,s=t.bodies,l=s.length;for(i=0;i!==l;i++)for(r=0;r!==i;r++)o=s[i],a=s[r],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,e,n)},new r,o.prototype.aabbQuery=function(t,e,n){n=n||[];for(var i=0;i<t.bodies.length;i++){var r=t.bodies[i];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,n){function i(){this.matrix={}}e.exports=i,i.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}return t+"-"+e in this.matrix},i.prototype.set=function(t,e,n){if(t=t.id,(e=e.id)>t){var i=e;e=t,t=i}n?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=c;var i=t("../math/Vec3"),r=t("../math/Quaternion"),o=t("../math/Transform"),a=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),s=t("../shapes/Shape"),l=t("../collision/AABB");function c(t,e){this.from=t?t.clone():new i,this.to=e?e.clone():new i,this._direction=new i,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=c.ANY,this.result=new a,this.hasHit=!1,this.callback=function(t){}}c.prototype.constructor=c,c.CLOSEST=1,c.ANY=2,c.ALL=4;var u=new l,h=[];c.prototype.intersectWorld=function(t,e){return this.mode=e.mode||c.ANY,this.result=e.result||new a,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(u),h.length=0,t.broadphase.aabbQuery(t,u,h),this.intersectBodies(h),this.hasHit};var f=new i,d=new i;function p(t,e,n,i){i.vsub(e,D),n.vsub(e,f),t.vsub(e,d);var r,o,a=D.dot(D),s=D.dot(f),l=D.dot(d),c=f.dot(f),u=f.dot(d);return(r=c*l-s*u)>=0&&(o=a*u-s*l)>=0&&r+o<a*c-s*s}c.pointInTriangle=p;var m=new i,g=new r;c.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=m,r=g,o=0,a=t.shapes.length;o<a;o++){var s=t.shapes[o];if((!n||s.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[o],r),t.quaternion.vmult(t.shapeOffsets[o],i),i.vadd(t.position,i),this.intersectShape(s,r,i,t),this.result._shouldStop))break}},c.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,i=t.length;!this.result._shouldStop&&n<i;n++)this.intersectBody(t[n])},c.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},c.prototype.intersectShape=function(t,e,n,i){if(!(function(t,e,n){n.vsub(t,D);var i=D.dot(e);return e.mult(i,O),O.vadd(t,O),n.distanceTo(O)}(this.from,this._direction,n)>t.boundingSphereRadius)){var r=this[t.type];r&&r.call(this,t,e,n,i)}},new i,new i;var v=new i,y=new i,x=new i,b=new i;new i,new a,c.prototype.intersectBox=function(t,e,n,i){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,i)},c.prototype[s.types.BOX]=c.prototype.intersectBox,c.prototype.intersectPlane=function(t,e,n,r){var o=this.from,a=this.to,s=this._direction,l=new i(0,0,1);e.vmult(l,l);var c=new i;o.vsub(n,c);var u=c.dot(l);if(a.vsub(n,c),!(u*c.dot(l)>0||o.distanceTo(a)<u)){var h=l.dot(s);if(!(Math.abs(h)<this.precision)){var f=new i,d=new i,p=new i;o.vsub(n,f);var m=-l.dot(f)/h;s.scale(m,d),o.vadd(d,p),this.reportIntersection(l,p,t,r,-1)}}},c.prototype[s.types.PLANE]=c.prototype.intersectPlane,c.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var w={faceList:[0]};c.prototype.intersectHeightfield=function(t,e,n,r){t.data,t.elementSize;var a=new i,s=new c(this.from,this.to);o.pointToLocalFrame(n,e,s.from,s.from),o.pointToLocalFrame(n,e,s.to,s.to);var l=[],u=null,h=null,f=null,d=null,p=t.getIndexOfPosition(s.from.x,s.from.y,l,!1);if(p&&(u=l[0],h=l[1],f=l[0],d=l[1]),(p=t.getIndexOfPosition(s.to.x,s.to.y,l,!1))&&((null===u||l[0]<u)&&(u=l[0]),(null===f||l[0]>f)&&(f=l[0]),(null===h||l[1]<h)&&(h=l[1]),(null===d||l[1]>d)&&(d=l[1])),null!==u){var m=[];t.getRectMinMax(u,h,f,d,m);for(var g=u;g<=f;g++)for(var v=h;v<=d;v++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(g,v,!1),o.pointToWorldFrame(n,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,r,w),this.result._shouldStop)return;t.getConvexTrianglePillar(g,v,!0),o.pointToWorldFrame(n,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,r,w)}}},c.prototype[s.types.HEIGHTFIELD]=c.prototype.intersectHeightfield;var _=new i,M=new i;c.prototype.intersectSphere=function(t,e,n,i){var r=this.from,o=this.to,a=t.radius,s=Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)+Math.pow(o.z-r.z,2),l=2*((o.x-r.x)*(r.x-n.x)+(o.y-r.y)*(r.y-n.y)+(o.z-r.z)*(r.z-n.z)),c=Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2)-Math.pow(a,2),u=Math.pow(l,2)-4*s*c,h=_,f=M;if(!(u<0))if(0===u)r.lerp(o,u,h),h.vsub(n,f),f.normalize(),this.reportIntersection(f,h,t,i,-1);else{var d=(-l-Math.sqrt(u))/(2*s),p=(-l+Math.sqrt(u))/(2*s);if(d>=0&&d<=1&&(r.lerp(o,d,h),h.vsub(n,f),f.normalize(),this.reportIntersection(f,h,t,i,-1)),this.result._shouldStop)return;p>=0&&p<=1&&(r.lerp(o,p,h),h.vsub(n,f),f.normalize(),this.reportIntersection(f,h,t,i,-1))}},c.prototype[s.types.SPHERE]=c.prototype.intersectSphere;var S=new i,T=(new i,new i,new i);c.prototype.intersectConvex=function(t,e,n,i,r){for(var o=S,a=T,s=r&&r.faceList||null,l=t.faces,c=t.vertices,u=t.faceNormals,h=this._direction,f=this.from,d=this.to,m=f.distanceTo(d),g=s?s.length:l.length,w=this.result,_=0;!w._shouldStop&&_<g;_++){var M=s?s[_]:_,A=l[M],E=u[M],q=e,C=n;a.copy(c[A[0]]),q.vmult(a,a),a.vadd(C,a),a.vsub(f,a),q.vmult(E,o);var P=h.dot(o);if(!(Math.abs(P)<this.precision)){var R=o.dot(a)/P;if(!(R<0)){h.mult(R,v),v.vadd(f,v),y.copy(c[A[0]]),q.vmult(y,y),C.vadd(y,y);for(var L=1;!w._shouldStop&&L<A.length-1;L++){x.copy(c[A[L]]),b.copy(c[A[L+1]]),q.vmult(x,x),q.vmult(b,b),C.vadd(x,x),C.vadd(b,b);var I=v.distanceTo(f);!p(v,y,x,b)&&!p(v,x,y,b)||I>m||this.reportIntersection(o,v,t,i,M)}}}}},c.prototype[s.types.CONVEXPOLYHEDRON]=c.prototype.intersectConvex;var A=new i,E=new i,q=new i,C=new i,P=new i,R=new i,L=(new l,[]),I=new o;c.prototype.intersectTrimesh=function(t,e,n,i,r){var a=A,s=L,l=I,c=T,u=E,h=q,f=C,d=R,m=P,g=(r&&r.faceList,t.indices),w=(t.vertices,t.faceNormals,this.from),_=this.to,M=this._direction;l.position.copy(n),l.quaternion.copy(e),o.vectorToLocalFrame(n,e,M,u),o.pointToLocalFrame(n,e,w,h),o.pointToLocalFrame(n,e,_,f);var S=h.distanceSquared(f);t.tree.rayQuery(this,l,s);for(var D=0,O=s.length;!this.result._shouldStop&&D!==O;D++){var N=s[D];t.getNormal(N,a),t.getVertex(g[3*N],y),y.vsub(h,c);var F=u.dot(a),B=a.dot(c)/F;if(!(B<0)){u.scale(B,v),v.vadd(h,v),t.getVertex(g[3*N+1],x),t.getVertex(g[3*N+2],b);var z=v.distanceSquared(h);!p(v,x,y,b)&&!p(v,y,x,b)||z>S||(o.vectorToWorldFrame(e,a,m),o.pointToWorldFrame(n,e,v,d),this.reportIntersection(m,d,t,i,N))}}s.length=0},c.prototype[s.types.TRIMESH]=c.prototype.intersectTrimesh,c.prototype.reportIntersection=function(t,e,n,i,r){var o=this.from,a=this.to,s=o.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case c.ALL:this.hasHit=!0,l.set(o,a,t,e,n,i,s),l.hasHit=!0,this.callback(l);break;case c.CLOSEST:(s<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,a,t,e,n,i,s));break;case c.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,a,t,e,n,i,s),l._shouldStop=!0}};var D=new i,O=new i},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,n){var i=t("../math/Vec3");function r(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=r,r.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(t,e,n,i,r,o,a){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=o,this.distance=a}},{"../math/Vec3":30}],11:[function(t,e,n){t("../shapes/Shape");var i=t("../collision/Broadphase");function r(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}e.exports=r,r.prototype=new i,r.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},r.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)t[r+1]=t[r];t[r+1]=i}return t},r.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)t[r+1]=t[r];t[r+1]=i}return t},r.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)t[r+1]=t[r];t[r+1]=i}return t},r.prototype.collisionPairs=function(t,e,n){var i,o,a=this.axisList,s=a.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==s;i++){var c=a[i];for(o=i+1;o<s;o++){var u=a[o];if(this.needBroadphaseCollision(c,u)){if(!r.checkBounds(c,u,l))break;this.intersectionTest(c,u,e,n)}}}},r.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,i=0;i!==n;i++){var o=t[i];o.aabbNeedsUpdate&&o.computeAABB()}0===e?r.insertionSortX(t):1===e?r.insertionSortY(t):2===e&&r.insertionSortZ(t)},r.checkBounds=function(t,e,n){var i,r;0===n?(i=t.position.x,r=e.position.x):1===n?(i=t.position.y,r=e.position.y):2===n&&(i=t.position.z,r=e.position.z);var o=t.boundingRadius,a=e.boundingRadius;return r-a<i+o},r.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,i=0,r=0,o=0,a=this.axisList,s=a.length,l=1/s,c=0;c!==s;c++){var u=a[c],h=u.position.x;t+=h,e+=h*h;var f=u.position.y;n+=f,i+=f*f;var d=u.position.z;r+=d,o+=d*d}var p=e-t*t*l,m=i-n*n*l,g=o-r*r*l;this.axisIndex=p>m?p>g?0:2:m>g?1:2},r.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,r="x";1===i&&(r="y"),2===i&&(r="z");for(var o=this.axisList,a=(e.lowerBound[r],e.upperBound[r],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(e)&&n.push(s)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,n){e.exports=s,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/ConeEquation"),o=t("../equations/RotationalEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new a,c=n.pivotB?n.pivotB.clone():new a;this.axisA=n.axisA?n.axisA.clone():new a,this.axisB=n.axisB?n.axisB.clone():new a,i.call(this,t,l,e,c,s),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;var u=this.coneEquation=new r(t,e,n),h=this.twistEquation=new o(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,u.maxForce=0,u.minForce=-s,h.maxForce=0,h.minForce=-s,this.equations.push(u,h)}s.prototype=new i,s.constructor=s,new a,new a,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,r=this.twistEquation;i.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(r.axisA,r.axisA),t.vectorToWorldFrame(r.axisA,r.axisA),this.axisB.tangents(r.axisB,r.axisB),e.vectorToWorldFrame(r.axisB,r.axisB),n.angle=this.angle,r.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,n){e.exports=r;var i=t("../utils/Utils");function r(t,e,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=r.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},r.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},r.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,n){e.exports=o;var i=t("./Constraint"),r=t("../equations/ContactEquation");function o(t,e,n,o){i.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===o&&(o=1e6),this.distance=n;var a=this.distanceEquation=new r(t,e);this.equations.push(a),a.minForce=-o,a.maxForce=o}o.prototype=new i,o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,i=.5*this.distance,r=n.ni;e.position.vsub(t.position,r),r.normalize(),r.mult(i,n.ri),r.mult(-i,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,n){e.exports=s,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation"),o=t("../equations/RotationalMotorEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new a,c=n.pivotB?n.pivotB.clone():new a;i.call(this,t,l,e,c,s),(this.axisA=n.axisA?n.axisA.clone():new a(1,0,0)).normalize(),(this.axisB=n.axisB?n.axisB.clone():new a(1,0,0)).normalize();var u=this.rotationalEquation1=new r(t,e,n),h=this.rotationalEquation2=new r(t,e,n),f=this.motorEquation=new o(t,e,s);f.enabled=!1,this.equations.push(u,h,f)}s.prototype=new i,s.constructor=s,s.prototype.enableMotor=function(){this.motorEquation.enabled=!0},s.prototype.disableMotor=function(){this.motorEquation.enabled=!1},s.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},s.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var l=new a,c=new a;s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,r=this.rotationalEquation1,o=this.rotationalEquation2,a=l,s=c,u=this.axisA,h=this.axisB;i.prototype.update.call(this),t.quaternion.vmult(u,a),e.quaternion.vmult(h,s),a.tangents(r.axisA,o.axisA),r.axisB.copy(s),o.axisB.copy(s),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,n){e.exports=a,t("./Constraint");var i=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation"),o=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,s=new o,l=new o,c=new o;t.position.vadd(e.position,c),c.scale(.5,c),e.pointToLocalFrame(c,l),t.pointToLocalFrame(c,s),i.call(this,t,s,e,l,a);var u=this.rotationalEquation1=new r(t,e,n),h=this.rotationalEquation2=new r(t,e,n),f=this.rotationalEquation3=new r(t,e,n);this.equations.push(u,h,f)}a.prototype=new i,a.constructor=a,new o,new o,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),r=this.rotationalEquation2,a=this.rotationalEquation3;i.prototype.update.call(this),t.vectorToWorldFrame(o.UNIT_X,n.axisA),e.vectorToWorldFrame(o.UNIT_Y,n.axisB),t.vectorToWorldFrame(o.UNIT_Y,r.axisA),e.vectorToWorldFrame(o.UNIT_Z,r.axisB),t.vectorToWorldFrame(o.UNIT_Z,a.axisA),e.vectorToWorldFrame(o.UNIT_X,a.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,n){e.exports=a;var i=t("./Constraint"),r=t("../equations/ContactEquation"),o=t("../math/Vec3");function a(t,e,n,a,s){i.call(this,t,n),s=void 0!==s?s:1e6,this.pivotA=e?e.clone():new o,this.pivotB=a?a.clone():new o;var l=this.equationX=new r(t,n),c=this.equationY=new r(t,n),u=this.equationZ=new r(t,n);this.equations.push(l,c,u),l.minForce=c.minForce=u.minForce=-s,l.maxForce=c.maxForce=u.maxForce=s,l.ni.set(1,0,0),c.ni.set(0,1,0),u.ni.set(0,0,1)}a.prototype=new i,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,n){e.exports=o;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation"));function o(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.angle=void 0!==n.angle?n.angle:0}o.prototype=new r,o.prototype.constructor=o;var a=new i,s=new i;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,o=a,l=s,c=this.jacobianElementA,u=this.jacobianElementB;return i.cross(r,o),r.cross(i,l),c.rotational.copy(l),u.rotational.copy(o),-(Math.cos(this.angle)-i.dot(r))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,n){e.exports=o;var i=t("./Equation"),r=t("../math/Vec3");function o(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,0,n),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}t("../math/Mat3"),o.prototype=new i,o.prototype.constructor=o;var a=new r,s=new r,l=new r;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.bi,r=this.bj,o=this.ri,c=this.rj,u=a,h=s,f=i.velocity,d=i.angularVelocity,p=(i.force,i.torque,r.velocity),m=r.angularVelocity,g=(r.force,r.torque,l),v=this.jacobianElementA,y=this.jacobianElementB,x=this.ni;o.cross(x,u),c.cross(x,h),x.negate(v.spatial),u.negate(v.rotational),y.spatial.copy(x),y.rotational.copy(h),g.copy(r.position),g.vadd(c,g),g.vsub(i.position,g),g.vsub(o,g);var b=x.dot(g),w=this.restitution+1;return-b*e-(w*p.dot(x)-w*f.dot(x)+m.dot(h)-d.dot(u))*n-t*this.computeGiMf()};var c=new r,u=new r,h=new r,f=new r,d=new r;o.prototype.getImpactVelocityAlongNormal=function(){var t=c,e=u,n=h,i=f,r=d;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,r),this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,n){e.exports=o;var i=t("../math/JacobianElement"),r=t("../math/Vec3");function o(t,e,n,r){this.id=o.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===r?1e6:r,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}o.prototype.constructor=o,o.id=0,o.prototype.setSpookParams=function(t,e,n){var i=e,r=t,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*r*(1+4*i))},o.prototype.computeB=function(t,e,n){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n},o.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,o=i.position;return t.spatial.dot(r)+e.spatial.dot(o)};var a=new r;o.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,o=i.velocity,s=n.angularVelocity||a,l=i.angularVelocity||a;return t.multiplyVectors(r,s)+e.multiplyVectors(o,l)},o.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,o=i.vlambda,s=n.wlambda||a,l=i.wlambda||a;return t.multiplyVectors(r,s)+e.multiplyVectors(o,l)};var s=new r,l=new r,c=new r,u=new r;o.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,o=n.torque,a=i.force,h=i.torque,f=n.invMassSolve,d=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(o,c):c.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(h,u):u.set(0,0,0),r.mult(f,s),a.mult(d,l),t.multiplyVectors(s,c)+e.multiplyVectors(l,u)};var h=new r;o.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,o=i.invMassSolve,a=n.invInertiaWorldSolve,s=i.invInertiaWorldSolve,l=r+o;return a&&(a.vmult(t.rotational,h),l+=h.dot(t.rotational)),s&&(s.vmult(e.rotational,h),l+=h.dot(e.rotational)),l};var f=new r;new r,new r,new r,new r,new r,o.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,o=f;e.spatial.mult(i.invMassSolve*t,o),i.vlambda.vadd(o,i.vlambda),n.spatial.mult(r.invMassSolve*t,o),r.vlambda.vadd(o,r.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(e.rotational,o),o.mult(t,o),i.wlambda.vadd(o,i.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(n.rotational,o),o.mult(t,o),r.wlambda.vadd(o,r.wlambda))},o.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,n){e.exports=o;var i=t("./Equation"),r=t("../math/Vec3");function o(t,e,n){i.call(this,t,e,-n,n),this.ri=new r,this.rj=new r,this.t=new r}t("../math/Mat3"),o.prototype=new i,o.prototype.constructor=o;var a=new r,s=new r;o.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),i=this.rj,r=a,o=s,l=this.t;n.cross(l,r),i.cross(l,o);var c=this.jacobianElementA,u=this.jacobianElementB;return l.negate(c.spatial),r.negate(c.rotational),u.spatial.copy(l),u.rotational.copy(o),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,n){e.exports=o;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation"));function o(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}o.prototype=new r,o.prototype.constructor=o;var a=new i,s=new i;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,o=a,l=s,c=this.jacobianElementA,u=this.jacobianElementB;return i.cross(r,o),r.cross(i,l),c.rotational.copy(l),u.rotational.copy(o),-(Math.cos(this.maxAngle)-i.dot(r))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,n){e.exports=o;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation"));function o(t,e,n){n=void 0!==n?n:1e6,r.call(this,t,e,-n,n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}o.prototype=new r,o.prototype.constructor=o,o.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),i=this.axisB,r=this.jacobianElementA,o=this.jacobianElementB;return r.rotational.copy(n),i.negate(o.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,n){var i=t("../utils/Utils");function r(t,e,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}e.exports=r,r.idCounter=0},{"../utils/Utils":53}],25:[function(t,e,n){function i(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=i.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=i,i.idCounter=0},{}],26:[function(t,e,n){e.exports=r;var i=t("./Vec3");function r(){this.spatial=new i,this.rotational=new i}r.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,n){e.exports=r;var i=t("./Vec3");function r(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}r.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},r.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},r.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},r.prototype.getTrace=function(t){t=t||new i;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},r.prototype.vmult=function(t,e){e=e||new i;var n=this.elements,r=t.x,o=t.y,a=t.z;return e.x=n[0]*r+n[1]*o+n[2]*a,e.y=n[3]*r+n[4]*o+n[5]*a,e.z=n[6]*r+n[7]*o+n[8]*a,e},r.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},r.prototype.mmult=function(t,e){for(var n=e||new r,i=0;i<3;i++)for(var o=0;o<3;o++){for(var a=0,s=0;s<3;s++)a+=t.elements[i+3*s]*this.elements[s+3*o];n.elements[i+3*o]=a}return n},r.prototype.scale=function(t,e){e=e||new r;for(var n=this.elements,i=e.elements,o=0;3!==o;o++)i[3*o+0]=t.x*n[3*o+0],i[3*o+1]=t.y*n[3*o+1],i[3*o+2]=t.z*n[3*o+2];return e},r.prototype.solve=function(t,e){e=e||new i;for(var n,r=[],o=0;o<12;o++)r.push(0);for(o=0;o<3;o++)for(n=0;n<3;n++)r[o+4*n]=this.elements[o+3*n];r[3]=t.x,r[7]=t.y,r[11]=t.z;var a,s,l=3,c=l;do{if(0===r[(o=c-l)+4*o])for(n=o+1;n<c;n++)if(0!==r[o+4*n]){a=4;do{r[(s=4-a)+4*o]+=r[s+4*n]}while(--a);break}if(0!==r[o+4*o])for(n=o+1;n<c;n++){var u=r[o+4*n]/r[o+4*o];a=4;do{r[(s=4-a)+4*n]=s<=o?0:r[s+4*n]-r[s+4*o]*u}while(--a)}}while(--l);if(e.z=r[11]/r[10],e.y=(r[7]-r[6]*e.z)/r[5],e.x=(r[3]-r[2]*e.z-r[1]*e.y)/r[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},r.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},r.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},r.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},r.prototype.reverse=function(t){t=t||new r;for(var e,n=[],i=0;i<18;i++)n.push(0);for(i=0;i<3;i++)for(e=0;e<3;e++)n[i+6*e]=this.elements[i+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var o,a,s=3,l=s;do{if(0===n[(i=l-s)+6*i])for(e=i+1;e<l;e++)if(0!==n[i+6*e]){o=6;do{n[(a=6-o)+6*i]+=n[a+6*e]}while(--o);break}if(0!==n[i+6*i])for(e=i+1;e<l;e++){var c=n[i+6*e]/n[i+6*i];o=6;do{n[(a=6-o)+6*e]=a<=i?0:n[a+6*e]-n[a+6*i]*c}while(--o)}}while(--s);i=2;do{e=i-1;do{c=n[i+6*e]/n[i+6*i],o=6;do{n[(a=6-o)+6*e]=n[a+6*e]-n[a+6*i]*c}while(--o)}while(e--)}while(--i);i=2;do{c=1/n[i+6*i],o=6;do{n[(a=6-o)+6*i]=n[a+6*i]*c}while(--o)}while(i--);i=2;do{e=2;do{if(a=n[3+e+6*i],isNaN(a)||a===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(i,e,a)}while(e--)}while(i--);return t},r.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,o=e+e,a=n+n,s=i+i,l=e*o,c=e*a,u=e*s,h=n*a,f=n*s,d=i*s,p=r*o,m=r*a,g=r*s,v=this.elements;return v[0]=1-(h+d),v[1]=c-g,v[2]=u+m,v[3]=c+g,v[4]=1-(l+d),v[5]=f-p,v[6]=u-m,v[7]=f+p,v[8]=1-(l+h),this},r.prototype.transpose=function(t){for(var e=(t=t||new r).elements,n=this.elements,i=0;3!==i;i++)for(var o=0;3!==o;o++)e[3*i+o]=n[3*o+i];return t}},{"./Vec3":30}],28:[function(t,e,n){e.exports=r;var i=t("./Vec3");function r(t,e,n,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}r.prototype.set=function(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i},r.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},r.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},r.prototype.toAxisAngle=function(t){t=t||new i,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var o=new i,a=new i;r.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var n=o,i=a;t.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var r=t.cross(e);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var s=new i,l=new i,c=new i;r.prototype.mult=function(t,e){e=e||new r;var n=this.w,i=s,o=l,a=c;return i.set(this.x,this.y,this.z),o.set(t.x,t.y,t.z),e.w=n*t.w-i.dot(o),i.cross(o,a),e.x=n*o.x+t.w*i.x+a.x,e.y=n*o.y+t.w*i.y+a.y,e.z=n*o.z+t.w*i.z+a.z,e},r.prototype.inverse=function(t){var e=this.x,n=this.y,i=this.z,o=this.w;t=t||new r,this.conjugate(t);var a=1/(e*e+n*n+i*i+o*o);return t.x*=a,t.y*=a,t.z*=a,t.w*=a,t},r.prototype.conjugate=function(t){return(t=t||new r).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},r.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},r.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},r.prototype.vmult=function(t,e){e=e||new i;var n=t.x,r=t.y,o=t.z,a=this.x,s=this.y,l=this.z,c=this.w,u=c*n+s*o-l*r,h=c*r+l*n-a*o,f=c*o+a*r-s*n,d=-a*n-s*r-l*o;return e.x=u*c+d*-a+h*-l-f*-s,e.y=h*c+d*-s+f*-a-u*-l,e.z=f*c+d*-l+u*-s-h*-a,e},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.prototype.toEuler=function(t,e){var n,i,r;e=e||"YZX";var o=this.x,a=this.y,s=this.z,l=this.w;switch(e){case"YZX":var c=o*a+s*l;if(c>.499&&(n=2*Math.atan2(o,l),i=Math.PI/2,r=0),c<-.499&&(n=-2*Math.atan2(o,l),i=-Math.PI/2,r=0),isNaN(n)){var u=o*o,h=a*a,f=s*s;n=Math.atan2(2*a*l-2*o*s,1-2*h-2*f),i=Math.asin(2*c),r=Math.atan2(2*o*l-2*a*s,1-2*u-2*f)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=n,t.z=i,t.x=r},r.prototype.setFromEuler=function(t,e,n,i){i=i||"XYZ";var r=Math.cos(t/2),o=Math.cos(e/2),a=Math.cos(n/2),s=Math.sin(t/2),l=Math.sin(e/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=s*o*a+r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a-s*l*c):"YXZ"===i?(this.x=s*o*a+r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a+s*l*c):"ZXY"===i?(this.x=s*o*a-r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a-s*l*c):"ZYX"===i?(this.x=s*o*a-r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a+s*l*c):"YZX"===i?(this.x=s*o*a+r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a-s*l*c):"XZY"===i&&(this.x=s*o*a-r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a+s*l*c),this},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,n){var i=t("./Vec3"),r=t("./Quaternion");function o(t){t=t||{},this.position=new i,t.position&&this.position.copy(t.position),this.quaternion=new r,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=o;var a=new r;o.pointToLocalFrame=function(t,e,n,r){return r=r||new i,n.vsub(t,r),e.conjugate(a),a.vmult(r,r),r},o.prototype.pointToLocal=function(t,e){return o.pointToLocalFrame(this.position,this.quaternion,t,e)},o.pointToWorldFrame=function(t,e,n,r){return r=r||new i,e.vmult(n,r),r.vadd(t,r),r},o.prototype.pointToWorld=function(t,e){return o.pointToWorldFrame(this.position,this.quaternion,t,e)},o.prototype.vectorToWorldFrame=function(t,e){return e=e||new i,this.quaternion.vmult(t,e),e},o.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},o.vectorToLocalFrame=function(t,e,n,r){return r=r||new i,e.w*=-1,e.vmult(n,r),e.w*=-1,r}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,n){e.exports=r;var i=t("./Mat3");function r(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}r.ZERO=new r(0,0,0),r.UNIT_X=new r(1,0,0),r.UNIT_Y=new r(0,1,0),r.UNIT_Z=new r(0,0,1),r.prototype.cross=function(t,e){var n=t.x,i=t.y,o=t.z,a=this.x,s=this.y,l=this.z;return(e=e||new r).x=s*o-l*i,e.y=l*n-a*o,e.z=a*i-s*n,e},r.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},r.prototype.setZero=function(){this.x=this.y=this.z=0},r.prototype.vadd=function(t,e){if(!e)return new r(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},r.prototype.vsub=function(t,e){if(!e)return new r(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},r.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},r.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){var r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i},r.prototype.unit=function(t){t=t||new r;var e=this.x,n=this.y,i=this.z,o=Math.sqrt(e*e+n*n+i*i);return o>0?(o=1/o,t.x=e*o,t.y=n*o,t.z=i*o):(t.x=1,t.y=0,t.z=0),t},r.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},r.prototype.length=r.prototype.norm,r.prototype.norm2=function(){return this.dot(this)},r.prototype.lengthSquared=r.prototype.norm2,r.prototype.distanceTo=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z;return Math.sqrt((r-e)*(r-e)+(o-n)*(o-n)+(a-i)*(a-i))},r.prototype.distanceSquared=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z;return(r-e)*(r-e)+(o-n)*(o-n)+(a-i)*(a-i)},r.prototype.mult=function(t,e){e=e||new r;var n=this.x,i=this.y,o=this.z;return e.x=t*n,e.y=t*i,e.z=t*o,e},r.prototype.scale=r.prototype.mult,r.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},r.prototype.negate=function(t){return(t=t||new r).x=-this.x,t.y=-this.y,t.z=-this.z,t};var o=new r,a=new r;r.prototype.tangents=function(t,e){var n=this.norm();if(n>0){var i=o,r=1/n;i.set(this.x*r,this.y*r,this.z*r);var s=a;Math.abs(i.x)<.9?(s.set(1,0,0),i.cross(s,t)):(s.set(0,1,0),i.cross(s,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},r.prototype.toString=function(){return this.x+","+this.y+","+this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},r.prototype.lerp=function(t,e,n){var i=this.x,r=this.y,o=this.z;n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.z=o+(t.z-o)*e},r.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},r.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var s=new r;r.prototype.isAntiparallelTo=function(t,e){return this.negate(s),s.almostEquals(t,e)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,n){e.exports=c;var i=t("../utils/EventTarget"),r=(t("../shapes/Shape"),t("../math/Vec3")),o=t("../math/Mat3"),a=t("../math/Quaternion"),s=(t("../material/Material"),t("../collision/AABB")),l=t("../shapes/Box");function c(t){t=t||{},i.apply(this),this.id=c.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,t.position&&this.position.copy(t.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new r,this.force=new r;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?c.STATIC:c.DYNAMIC,typeof t.type==typeof c.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new a,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new a,this.angularVelocity=new r,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new s,this.aabbNeedsUpdate=!0,this.wlambda=new r,t.shape&&this.addShape(t.shape),this.updateMassProperties()}c.prototype=new i,c.prototype.constructor=c,c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2,c.idCounter=0,c.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===c.SLEEPING&&this.dispatchEvent({type:"wakeup"})},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},c.sleepyEvent={type:"sleepy"},c.sleepEvent={type:"sleep"},c.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);e===c.AWAKE&&n<i?(this.sleepState=c.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(c.sleepyEvent)):e===c.SLEEPY&&n>i?this.wakeUp():e===c.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(c.sleepEvent))}},c.prototype.updateSolveMassProperties=function(){this.sleepState===c.SLEEPING||this.type===c.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},c.prototype.pointToLocalFrame=function(t,e){return e=e||new r,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},c.prototype.vectorToLocalFrame=function(t,e){return e=e||new r,this.quaternion.conjugate().vmult(t,e),e},c.prototype.pointToWorldFrame=function(t,e){return e=e||new r,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},c.prototype.vectorToWorldFrame=function(t,e){return e=e||new r,this.quaternion.vmult(t,e),e};var u=new r,h=new a;c.prototype.addShape=function(t,e,n){var i=new r,o=new a;return e&&i.copy(e),n&&o.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},c.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,i=0,r=0;r!==n;r++){var o=t[r];o.updateBoundingSphereRadius();var a=e[r].norm(),s=o.boundingSphereRadius;a+s>i&&(i=a+s)}this.boundingRadius=i};var f=new s;c.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,r=u,o=h,a=this.quaternion,s=this.aabb,l=f,c=0;c!==i;c++){var d=t[c];n[c].mult(a,o),o.vmult(e[c],r),r.vadd(this.position,r),d.calculateWorldAABB(r,o,l.lowerBound,l.upperBound),0===c?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1};var d=new o,p=new o;new o,c.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var n=d,i=p;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(e,n),n.mmult(i,this.invInertiaWorld)}};var m=new r,g=new r;c.prototype.applyForce=function(t,e){if(this.type===c.DYNAMIC){var n=m;e.vsub(this.position,n);var i=g;n.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}};var v=new r,y=new r;c.prototype.applyLocalForce=function(t,e){if(this.type===c.DYNAMIC){var n=v,i=y;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyForce(n,i)}};var x=new r,b=new r,w=new r;c.prototype.applyImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=x;e.vsub(this.position,n);var i=b;i.copy(t),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var r=w;n.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}};var _=new r,M=new r;c.prototype.applyLocalImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=_,i=M;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyImpulse(n,i)}};var S=new r;c.prototype.updateMassProperties=function(){var t=S;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)},c.prototype.getVelocityAtWorldPoint=function(t,e){var n=new r;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,n){t("./Body");var i=t("../math/Vec3"),r=t("../math/Quaternion"),o=(t("../collision/RaycastResult"),t("../collision/Ray")),a=t("../objects/WheelInfo");function s(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=s,new i,new i,new i;var l=new i,c=new i,u=new i;new o,s.prototype.addWheel=function(t){var e=new a(t=t||{}),n=this.wheelInfos.length;return this.wheelInfos.push(e),n},s.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t},new i,s.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},s.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},s.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},s.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},s.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,r=this.chassisBody,o=0;o<n;o++)this.updateWheelTransform(o);this.currentVehicleSpeedKmHour=3.6*r.velocity.norm();var a=new i;for(this.getVehicleAxisWorld(this.indexForwardAxis,a),a.dot(r.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),o=0;o<n;o++)this.castRay(e[o]);this.updateSuspension(t);var s=new i,l=new i;for(o=0;o<n;o++){var c=(d=e[o]).suspensionForce;c>d.maxSuspensionForce&&(c=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(c*t,s),d.raycastResult.hitPointWorld.vsub(r.position,l),r.applyImpulse(s,d.raycastResult.hitPointWorld)}this.updateFriction(t);var u=new i,h=new i,f=new i;for(o=0;o<n;o++){var d=e[o];r.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,f);var p=1;switch(this.indexUpAxis){case 1:p=-1}if(d.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,h);var m=h.dot(d.raycastResult.hitNormalWorld);d.raycastResult.hitNormalWorld.scale(m,u),h.vsub(u,h);var g=h.dot(f);d.deltaRotation=p*g*t/d.radius}!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(d.engineForce>0?1:-1)*d.customSlidingRotationalSpeed*t),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},s.prototype.updateSuspension=function(t){for(var e=this.chassisBody.mass,n=this.wheelInfos,i=n.length,r=0;r<i;r++){var o=n[r];if(o.isInContact){var a,s=o.suspensionRestLength-o.suspensionLength;a=o.suspensionStiffness*s*o.clippedInvContactDotSuspension;var l=o.suspensionRelativeVelocity;a-=(l<0?o.dampingCompression:o.dampingRelaxation)*l,o.suspensionForce=a*e,o.suspensionForce<0&&(o.suspensionForce=0)}else o.suspensionForce=0}},s.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var h=new i,f=new i;s.prototype.castRay=function(t){var e=h,n=f;this.updateWheelTransformWorld(t);var r=this.chassisBody,o=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scale(a,e);var s=t.chassisConnectionPointWorld;s.vadd(e,n);var l=t.raycastResult;l.reset();var c=r.collisionResponse;r.collisionResponse=!1,this.world.rayTest(s,n,l),r.collisionResponse=c;var u=l.body;if(t.raycastResult.groundObject=0,u){o=l.distance,t.raycastResult.hitNormalWorld=l.hitNormalWorld,t.isInContact=!0;var d=l.distance;t.suspensionLength=d-t.radius;var p=t.suspensionRestLength-t.maxSuspensionTravel,m=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<p&&(t.suspensionLength=p),t.suspensionLength>m&&(t.suspensionLength=m,t.raycastResult.reset());var g=t.raycastResult.hitNormalWorld.dot(t.directionWorld),v=new i;r.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,v);var y=t.raycastResult.hitNormalWorld.dot(v);if(g>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var x=-1/g;t.suspensionRelativeVelocity=y*x,t.clippedInvContactDotSuspension=x}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return o},s.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},s.prototype.updateWheelTransform=function(t){var e=l,n=c,i=u,o=this.wheelInfos[t];this.updateWheelTransformWorld(o),o.directionLocal.scale(-1,e),n.copy(o.axleLocal),e.cross(n,i),i.normalize(),n.normalize();var a=o.steering,s=new r;s.setFromAxisAngle(e,a);var h=new r;h.setFromAxisAngle(n,o.rotation);var f=o.worldTransform.quaternion;this.chassisBody.quaternion.mult(s,f),f.mult(h,f),f.normalize();var d=o.worldTransform.position;d.copy(o.directionWorld),d.scale(o.suspensionLength,d),d.vadd(o.chassisConnectionPointWorld,d)};var d=[new i(1,0,0),new i(0,1,0),new i(0,0,1)];s.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var p=new i,m=[],g=[];s.prototype.updateFriction=function(t){for(var e=p,n=this.wheelInfos,r=n.length,o=this.chassisBody,a=g,s=m,l=0;l<r;l++)f=(A=n[l]).raycastResult.body,A.sideImpulse=0,A.forwardImpulse=0,a[l]||(a[l]=new i),s[l]||(s[l]=new i);for(l=0;l<r;l++)if(f=(A=n[l]).raycastResult.body){var c=s[l];this.getWheelTransformWorld(l).vectorToWorldFrame(d[this.indexRightAxis],c);var u=A.raycastResult.hitNormalWorld,h=c.dot(u);u.scale(h,e),c.vsub(e,c),c.normalize(),u.cross(c,a[l]),a[l].normalize(),A.sideImpulse=C(o,A.raycastResult.hitPointWorld,f,A.raycastResult.hitPointWorld,c),A.sideImpulse*=1}for(this.sliding=!1,l=0;l<r;l++){var f=(A=n[l]).raycastResult.body,v=0;if(A.slipInfo=1,f){var y=A.brake?A.brake:0;v=b(o,f,A.raycastResult.hitPointWorld,a[l],y);var x=y/(v+=A.engineForce*t);A.slipInfo*=x}if(A.forwardImpulse=0,A.skidInfo=1,f){A.skidInfo=1;var w=A.suspensionForce*t*A.frictionSlip,_=w*w;A.forwardImpulse=v;var M=.5*A.forwardImpulse,S=1*A.sideImpulse,T=M*M+S*S;A.sliding=!1,T>_&&(this.sliding=!0,A.sliding=!0,x=w/Math.sqrt(T),A.skidInfo*=x)}}if(this.sliding)for(l=0;l<r;l++)0!==(A=n[l]).sideImpulse&&A.skidInfo<1&&(A.forwardImpulse*=A.skidInfo,A.sideImpulse*=A.skidInfo);for(l=0;l<r;l++){var A=n[l],E=new i;if(E.copy(A.raycastResult.hitPointWorld),0!==A.forwardImpulse){var q=new i;a[l].scale(A.forwardImpulse,q),o.applyImpulse(q,E)}if(0!==A.sideImpulse){f=A.raycastResult.body;var P=new i;P.copy(A.raycastResult.hitPointWorld);var R=new i;s[l].scale(A.sideImpulse,R),o.pointToLocalFrame(E,E),E["xyz"[this.indexUpAxis]]*=A.rollInfluence,o.pointToWorldFrame(E,E),o.applyImpulse(R,E),R.scale(-1,R),f.applyImpulse(R,P)}}};var v=new i,y=new i,x=new i;function b(t,e,n,i,r){var o=0,a=n,s=v,l=y,c=x;return t.getVelocityAtWorldPoint(a,s),e.getVelocityAtWorldPoint(a,l),s.vsub(l,c),r<(o=-i.dot(c)*(1/(T(t,n,i)+T(e,n,i))))&&(o=r),o<-r&&(o=-r),o}var w=new i,_=new i,M=new i,S=new i;function T(t,e,n){var i=w,r=_,o=M,a=S;return e.vsub(t.position,i),i.cross(n,r),t.invInertiaWorld.vmult(r,a),a.cross(i,o),t.invMass+n.dot(o)}var A=new i,E=new i,q=new i;function C(t,e,n,i,r,o){if(r.norm2()>1.1)return 0;var a=A,s=E,l=q;return t.getVelocityAtWorldPoint(e,a),n.getVelocityAtWorldPoint(i,s),a.vsub(s,l),-.2*r.dot(l)*(1/(t.invMass+n.invMass))}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,n){var i=t("./Body"),r=t("../shapes/Sphere"),o=t("../shapes/Box"),a=t("../math/Vec3"),s=t("../constraints/HingeConstraint");function l(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new a(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new o(new a(5,2,.5));this.chassisBody=new i(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=l,l.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new i(1,new r(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new a;var n=void 0!==t.position?t.position.clone():new a,o=new a;this.chassisBody.pointToWorldFrame(n,o),e.position.set(o.x,o.y,o.z);var l=void 0!==t.axis?t.axis.clone():new a(0,1,0);this.wheelAxes.push(l);var c=new s(this.chassisBody,e,{pivotA:n,axisA:l,pivotB:a.ZERO,axisB:l,collideConnected:!1});return this.constraints.push(c),this.wheelBodies.length-1},l.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],i=Math.cos(t),r=Math.sin(t),o=n.x,a=n.y;this.constraints[e].axisA.set(i*o-r*a,r*o+i*a,0)},l.prototype.setMotorSpeed=function(t,e){var n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t},l.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var c=new a;l.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},l.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],i=this.wheelBodies[e],r=i.torque;n.scale(t,c),i.vectorToWorldFrame(c,c),r.vadd(c,r)},l.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.add(n[i]);for(i=0;i<e.length;i++)t.addConstraint(e[i]);t.addEventListener("preStep",this._update.bind(this))},l.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},l.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.remove(n[i]);for(i=0;i<e.length;i++)t.removeConstraint(e[i])};var u=new a;l.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],n=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,u),n.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,n){e.exports=r,t("../shapes/Shape");var i=t("../math/Vec3");function r(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),r.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},r.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new i;r.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,i=t.id,r=this.smoothingRadius*this.smoothingRadius,a=o,s=0;s!==n;s++){var l=this.particles[s];l.position.vsub(t.position,a),i!==l.id&&a.norm2()<r&&e.push(l)}};var a=new i,s=new i,l=new i,c=new i,u=new i,h=new i;r.prototype.update=function(){for(var t=this.particles.length,e=a,n=this.speedOfSound,i=this.eps,r=0;r!==t;r++){var o=this.particles[r];(S=this.neighbors[r]).length=0,this.getNeighbors(o,S),S.push(this.particles[r]);for(var f=S.length,d=0,p=0;p!==f;p++){o.position.vsub(S[p].position,e);var m=e.norm(),g=this.w(m);d+=S[p].mass*g}this.densities[r]=d,this.pressures[r]=n*n*(this.densities[r]-this.density)}var v=s,y=l,x=c,b=u,w=h;for(r=0;r!==t;r++){var _,M,S,T=this.particles[r];for(v.set(0,0,0),y.set(0,0,0),f=(S=this.neighbors[r]).length,p=0;p!==f;p++){var A=S[p];T.position.vsub(A.position,b);var E=b.norm();_=-A.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+i)+this.pressures[p]/(this.densities[p]*this.densities[p]+i)),this.gradw(b,x),x.mult(_,x),v.vadd(x,v),A.velocity.vsub(T.velocity,w),w.mult(1/(1e-4+this.densities[r]*this.densities[p])*this.viscosity*A.mass,w),M=this.nablaw(E),w.mult(M,w),y.vadd(w,y)}y.mult(T.mass,y),v.mult(T.mass,v),T.force.vadd(y,T.force),T.force.vadd(v,T.force)}},r.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},r.prototype.gradw=function(t,e){var n=t.norm(),i=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),e)},r.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,n){var i=t("../math/Vec3");function r(t,e,n){n=n||{},this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}e.exports=r,r.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},r.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},r.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},r.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var o=new i,a=new i,s=new i,l=new i,c=new i,u=new i,h=new i,f=new i,d=new i,p=new i,m=new i;r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,g=o,v=a,y=s,x=l,b=m,w=c,_=u,M=h,S=f,T=d,A=p;this.getWorldAnchorA(w),this.getWorldAnchorB(_),w.vsub(i.position,M),_.vsub(r.position,S),_.vsub(w,g);var E=g.norm();v.copy(g),v.normalize(),r.velocity.vsub(i.velocity,y),r.angularVelocity.cross(S,b),y.vadd(b,y),i.angularVelocity.cross(M,b),y.vsub(b,y),v.mult(-t*(E-n)-e*y.dot(v),x),i.force.vsub(x,i.force),r.force.vadd(x,r.force),M.cross(x,T),S.cross(x,A),i.torque.vsub(T,i.torque),r.torque.vadd(A,r.torque)}},{"../math/Vec3":30}],36:[function(t,e,n){var i=t("../math/Vec3"),r=t("../math/Transform"),o=t("../collision/RaycastResult"),a=t("../utils/Utils");function s(t){t=a.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new r,this.isInContact=!1}e.exports=s;var l=new i,c=new i;l=new i,s.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,c),t.getVelocityAtWorldPoint(c,l);var i=e.hitNormalWorld.dot(l);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/n;this.suspensionRelativeVelocity=i*r,this.clippedInvContactDotSuspension=r}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,n){e.exports=a;var i=t("./Shape"),r=t("../math/Vec3"),o=t("./ConvexPolyhedron");function a(t){i.call(this),this.type=i.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}a.prototype=new i,a.prototype.constructor=a,a.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=r,a=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],s=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new o(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=s,s.material=this.material},a.prototype.calculateLocalInertia=function(t,e){return e=e||new r,a.calculateInertia(this.halfExtents,t,e),e},a.calculateInertia=function(t,e,n){var i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},a.prototype.getSideNormals=function(t,e){var n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(var r=0;r!==n.length;r++)e.vmult(n[r],n[r]);return n},a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var s=new r;new r,a.prototype.forEachWorldCorner=function(t,e,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],o=0;o<r.length;o++)s.set(r[o][0],r[o][1],r[o][2]),e.vmult(s,s),t.vadd(s,s),n(s.x,s.y,s.z)};var l=[new r,new r,new r,new r,new r,new r,new r,new r];a.prototype.calculateWorldAABB=function(t,e,n,i){var r=this.halfExtents;l[0].set(r.x,r.y,r.z),l[1].set(-r.x,r.y,r.z),l[2].set(-r.x,-r.y,r.z),l[3].set(-r.x,-r.y,-r.z),l[4].set(r.x,-r.y,-r.z),l[5].set(r.x,r.y,-r.z),l[6].set(-r.x,r.y,-r.z),l[7].set(r.x,-r.y,r.z);var o=l[0];e.vmult(o,o),t.vadd(o,o),i.copy(o),n.copy(o);for(var a=1;a<8;a++){o=l[a],e.vmult(o,o),t.vadd(o,o);var s=o.x,c=o.y,u=o.z;s>i.x&&(i.x=s),c>i.y&&(i.y=c),u>i.z&&(i.z=u),s<n.x&&(n.x=s),c<n.y&&(n.y=c),u<n.z&&(n.z=u)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,n){e.exports=a;var i=t("./Shape"),r=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform"));function a(t,e,n){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}a.prototype=new i,a.prototype.constructor=a;var s=new r;a.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var i=s,r=0;r!==t.length;r++)for(var o=t[r],a=o.length,l=0;l!==a;l++){var c=(l+1)%a;e[o[l]].vsub(e[o[c]],i),i.normalize();for(var u=!1,h=0;h!==n.length;h++)if(n[h].almostEquals(i)||n[h].almostEquals(i)){u=!0;break}u||n.push(i.clone())}},a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var n=this.faceNormals[t]||new r;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var i=this.vertices[this.faces[t][0]];if(n.dot(i)<0)for(console.error(".faceNormals["+t+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}};var l=new r,c=new r;a.computeNormal=function(t,e,n,i){e.vsub(t,c),n.vsub(e,l),l.cross(c,i),i.isZero()||i.normalize()},a.prototype.getFaceNormal=function(t,e){var n=this.faces[t],i=this.vertices[n[0]],r=this.vertices[n[1]],o=this.vertices[n[2]];return a.computeNormal(i,r,o,e)};var u=new r;a.prototype.clipAgainstHull=function(t,e,n,i,o,a,s,l,c){for(var h=u,f=-1,d=-Number.MAX_VALUE,p=0;p<n.faces.length;p++){h.copy(n.faceNormals[p]),o.vmult(h,h);var m=h.dot(a);m>d&&(d=m,f=p)}for(var g=[],v=n.faces[f],y=v.length,x=0;x<y;x++){var b=n.vertices[v[x]],w=new r;w.copy(b),o.vmult(w,w),i.vadd(w,w),g.push(w)}f>=0&&this.clipFaceAgainstHull(a,t,e,g,s,l,c)};var h=new r,f=new r,d=new r,p=new r,m=new r,g=new r;a.prototype.findSeparatingAxis=function(t,e,n,i,r,o,a,s){var l=h,c=f,u=d,v=p,y=m,x=g,b=Number.MAX_VALUE;if(this.uniqueAxes)for(_=0;_!==this.uniqueAxes.length;_++){if(n.vmult(this.uniqueAxes[_],l),!1===(T=this.testSepAxis(l,t,e,n,i,r)))return!1;T<b&&(b=T,o.copy(l))}else for(var w=a?a.length:this.faces.length,_=0;_<w;_++){var M=a?a[_]:_;if(l.copy(this.faceNormals[M]),n.vmult(l,l),!1===(T=this.testSepAxis(l,t,e,n,i,r)))return!1;T<b&&(b=T,o.copy(l))}if(t.uniqueAxes)for(_=0;_!==t.uniqueAxes.length;_++){if(r.vmult(t.uniqueAxes[_],c),!1===(T=this.testSepAxis(c,t,e,n,i,r)))return!1;T<b&&(b=T,o.copy(c))}else for(var S=s?s.length:t.faces.length,_=0;_<S;_++){var T;if(M=s?s[_]:_,c.copy(t.faceNormals[M]),r.vmult(c,c),!1===(T=this.testSepAxis(c,t,e,n,i,r)))return!1;T<b&&(b=T,o.copy(c))}for(var A=0;A!==this.uniqueEdges.length;A++){n.vmult(this.uniqueEdges[A],v);for(var E=0;E!==t.uniqueEdges.length;E++)if(r.vmult(t.uniqueEdges[E],y),v.cross(y,x),!x.almostZero()){x.normalize();var q=this.testSepAxis(x,t,e,n,i,r);if(!1===q)return!1;q<b&&(b=q,o.copy(x))}}return i.vsub(e,u),u.dot(o)>0&&o.negate(o),!0};var v=[],y=[];a.prototype.testSepAxis=function(t,e,n,i,r,o){a.project(this,t,n,i,v),a.project(e,t,r,o,y);var s=v[0],l=v[1],c=y[0],u=y[1];if(s<u||c<l)return!1;var h=s-u,f=c-l;return h<f?h:f};var x=new r,b=new r;a.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(x,b);var n=b.x-x.x,i=b.y-x.y,r=b.z-x.z;e.x=1/12*t*(2*i*2*i+2*r*2*r),e.y=1/12*t*(2*n*2*n+2*r*2*r),e.z=1/12*t*(2*i*2*i+2*n*2*n)},a.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]];return-n.dot(i)};var w=new r,_=new r,M=new r,S=new r,T=new r,A=new r,E=new r,q=new r;a.prototype.clipFaceAgainstHull=function(t,e,n,i,r,o,a){for(var s=w,l=_,c=M,u=S,h=T,f=A,d=E,p=q,m=i,g=[],v=-1,y=Number.MAX_VALUE,x=0;x<this.faces.length;x++){s.copy(this.faceNormals[x]),n.vmult(s,s);var b=s.dot(t);b<y&&(y=b,v=x)}if(!(v<0)){var C=this.faces[v];C.connectedFaces=[];for(var P=0;P<this.faces.length;P++)for(var R=0;R<this.faces[P].length;R++)-1!==C.indexOf(this.faces[P][R])&&P!==v&&-1===C.connectedFaces.indexOf(P)&&C.connectedFaces.push(P);m.length;for(var L=C.length,I=0;I<L;I++){var D=this.vertices[C[I]],O=this.vertices[C[(I+1)%L]];D.vsub(O,l),c.copy(l),n.vmult(c,c),e.vadd(c,c),u.copy(this.faceNormals[v]),n.vmult(u,u),e.vadd(u,u),c.cross(u,h),h.negate(h),f.copy(D),n.vmult(f,f),e.vadd(f,f),f.dot(h);var N=C.connectedFaces[I];d.copy(this.faceNormals[N]);var F=this.getPlaneConstantOfFace(N);p.copy(d),n.vmult(p,p);var B=F-p.dot(e);for(this.clipFaceAgainstPlane(m,g,p,B);m.length;)m.shift();for(;g.length;)m.push(g.shift())}for(d.copy(this.faceNormals[v]),F=this.getPlaneConstantOfFace(v),p.copy(d),n.vmult(p,p),B=F-p.dot(e),P=0;P<m.length;P++){var z=p.dot(m[P])+B;if(z<=r&&(console.log("clamped: depth="+z+" to minDist="+r),z=r),z<=o){var U=m[P];if(z<=0){var k={point:U,normal:p,depth:z};a.push(k)}}}}},a.prototype.clipFaceAgainstPlane=function(t,e,n,i){var o,a,s=t.length;if(s<2)return e;var l=t[t.length-1],c=t[0];o=n.dot(l)+i;for(var u=0;u<s;u++){if(c=t[u],a=n.dot(c)+i,o<0)if(a<0)(h=new r).copy(c),e.push(h);else{var h=new r;l.lerp(c,o/(o-a),h),e.push(h)}else a<0&&(h=new r,l.lerp(c,o/(o-a),h),e.push(h),e.push(c));l=c,o=a}return e},a.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new r);for(var i=this.vertices,o=this.worldVertices,a=0;a!==n;a++)e.vmult(i[a],o[a]),t.vadd(o[a],o[a]);this.worldVerticesNeedsUpdate=!1},new r,a.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<n;r++){var o=i[r];o.x<t.x?t.x=o.x:o.x>e.x&&(e.x=o.x),o.y<t.y?t.y=o.y:o.y>e.y&&(e.y=o.y),o.z<t.z?t.z=o.z:o.z>e.z&&(e.z=o.z)}},a.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new r);for(var n=this.faceNormals,i=this.worldFaceNormals,o=0;o!==e;o++)t.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1},a.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,i=e.length;n!==i;n++){var r=e[n].norm2();r>t&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)};var C=new r;a.prototype.calculateWorldAABB=function(t,e,n,i){for(var r,o,a,s,l,c,u=this.vertices.length,h=this.vertices,f=0;f<u;f++){C.copy(h[f]),e.vmult(C,C),t.vadd(C,C);var d=C;d.x<r||void 0===r?r=d.x:(d.x>s||void 0===s)&&(s=d.x),d.y<o||void 0===o?o=d.y:(d.y>l||void 0===l)&&(l=d.y),d.z<a||void 0===a?a=d.z:(d.z>c||void 0===c)&&(c=d.z)}n.set(r,o,a),i.set(s,l,c)},a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},a.prototype.getAveragePointLocal=function(t){t=t||new r;for(var e=this.vertices.length,n=this.vertices,i=0;i<e;i++)t.vadd(n[i],t);return t.mult(1/e,t),t},a.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,i=this.vertices;if(e){for(var r=0;r<n;r++){var o=i[r];e.vmult(o,o)}for(r=0;r<this.faceNormals.length;r++)o=this.faceNormals[r],e.vmult(o,o)}if(t)for(r=0;r<n;r++)(o=i[r]).vadd(t,o)};var P=new r,R=new r,L=new r;a.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,i=this.faces,r=this.faceNormals,o=this.faces.length,a=P;this.getAveragePointLocal(a);for(var s=0;s<o;s++){this.faces[s].length,e=r[s];var l=n[i[s][0]],c=R;t.vsub(l,c);var u=e.dot(c),h=L;a.vsub(l,h);var f=e.dot(h);if(u<0&&f>0||u>0&&f<0)return!1}return-1},new r;var I=new r,D=new r;a.project=function(t,e,n,i,r){var a=t.vertices.length,s=I,l=0,c=0,u=D,h=t.vertices;u.setZero(),o.vectorToLocalFrame(n,i,e,s),o.pointToLocalFrame(n,i,u,u);var f=u.dot(s);c=l=h[0].dot(s);for(var d=1;d<a;d++){var p=h[d].dot(s);p>l&&(l=p),p<c&&(c=p)}if((c-=f)>(l-=f)){var m=c;c=l,l=m}r[0]=l,r[1]=c}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,n){e.exports=a;var i=t("./Shape"),r=t("../math/Vec3"),o=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function a(t,e,n,a){var s=a,l=[],c=[],u=[],h=[],f=[],d=Math.cos,p=Math.sin;l.push(new r(e*d(0),e*p(0),.5*-n)),h.push(0),l.push(new r(t*d(0),t*p(0),.5*n)),f.push(1);for(var m=0;m<s;m++){var g=2*Math.PI/s*(m+1),v=2*Math.PI/s*(m+.5);m<s-1?(l.push(new r(e*d(g),e*p(g),.5*-n)),h.push(2*m+2),l.push(new r(t*d(g),t*p(g),.5*n)),f.push(2*m+3),u.push([2*m+2,2*m+3,2*m+1,2*m])):u.push([0,1,2*m+1,2*m]),(s%2==1||m<s/2)&&c.push(new r(d(v),p(v),0))}u.push(f),c.push(new r(0,0,1));var y=[];for(m=0;m<h.length;m++)y.push(h[h.length-m-1]);u.push(y),this.type=i.types.CONVEXPOLYHEDRON,o.call(this,l,u,c)}a.prototype=new o},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,n){var i=t("./Shape"),r=t("./ConvexPolyhedron"),o=t("../math/Vec3"),a=t("../utils/Utils");function s(t,e){e=a.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new r,this.pillarOffset=new o,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=s,s.prototype=new i,s.prototype.update=function(){this._cachedPillars={}},s.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];r<e&&(e=r)}this.minValue=e},s.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];r>e&&(e=r)}this.maxValue=e},s.prototype.setHeightValueAtIndex=function(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},s.prototype.getRectMinMax=function(t,e,n,i,r){r=r||[];for(var o=this.data,a=this.minValue,s=t;s<=n;s++)for(var l=e;l<=i;l++){var c=o[s][l];c>a&&(a=c)}r[0]=this.minValue,r[1]=a},s.prototype.getIndexOfPosition=function(t,e,n,i){var r=this.elementSize,o=this.data,a=Math.floor(t/r),s=Math.floor(e/r);return n[0]=a,n[1]=s,i&&(a<0&&(a=0),s<0&&(s=0),a>=o.length-1&&(a=o.length-1),s>=o[0].length-1&&(s=o[0].length-1)),!(a<0||s<0||a>=o.length-1||s>=o[0].length-1)},s.prototype.getHeightAt=function(t,e,n){var i=[];this.getIndexOfPosition(t,e,i,n);var r=[];return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,r),(r[0]+r[1])/2},s.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+"_"+e+"_"+(n?1:0)},s.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},s.prototype.setCachedConvexTrianglePillar=function(t,e,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:i,offset:r}},s.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},s.prototype.getConvexTrianglePillar=function(t,e,n){var i=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){if(s=this.getCachedConvexTrianglePillar(t,e,n))return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);i=new r,a=new o,this.pillarConvex=i,this.pillarOffset=a}var s=this.data,l=this.elementSize,c=i.faces;i.vertices.length=6;for(var u=0;u<6;u++)i.vertices[u]||(i.vertices[u]=new o);for(c.length=5,u=0;u<5;u++)c[u]||(c[u]=[]);var h=i.vertices,f=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;n?(a.set((t+.75)*l,(e+.75)*l,f),h[0].set(.25*l,.25*l,s[t+1][e+1]-f),h[1].set(-.75*l,.25*l,s[t][e+1]-f),h[2].set(.25*l,-.75*l,s[t+1][e]-f),h[3].set(.25*l,.25*l,-f-1),h[4].set(-.75*l,.25*l,-f-1),h[5].set(.25*l,-.75*l,-f-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=2,c[2][1]=5,c[2][2]=3,c[2][3]=0,c[3][0]=3,c[3][1]=4,c[3][2]=1,c[3][3]=0,c[4][0]=1,c[4][1]=4,c[4][2]=5,c[4][3]=2):(a.set((t+.25)*l,(e+.25)*l,f),h[0].set(-.25*l,-.25*l,s[t][e]-f),h[1].set(.75*l,-.25*l,s[t+1][e]-f),h[2].set(-.25*l,.75*l,s[t][e+1]-f),h[3].set(-.25*l,-.25*l,-f-1),h[4].set(.75*l,-.25*l,-f-1),h[5].set(-.25*l,.75*l,-f-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=0,c[2][1]=2,c[2][2]=5,c[2][3]=3,c[3][0]=1,c[3][1]=0,c[3][2]=3,c[3][3]=4,c[4][0]=4,c[4][1]=5,c[4][2]=2,c[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,i,a)},s.prototype.calculateLocalInertia=function(t,e){return(e=e||new o).set(0,0,0),e},s.prototype.volume=function(){return Number.MAX_VALUE},s.prototype.calculateWorldAABB=function(t,e,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},s.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new o(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,n){e.exports=o;var i=t("./Shape"),r=t("../math/Vec3");function o(){i.call(this),this.type=i.types.PARTICLE}o.prototype=new i,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},o.prototype.volume=function(){return 0},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},o.prototype.calculateWorldAABB=function(t,e,n,i){n.copy(t),i.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,n){e.exports=o;var i=t("./Shape"),r=t("../math/Vec3");function o(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}o.prototype=new i,o.prototype.constructor=o,o.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},o.prototype.calculateLocalInertia=function(t,e){return e=e||new r},o.prototype.volume=function(){return Number.MAX_VALUE};var a=new r;o.prototype.calculateWorldAABB=function(t,e,n,i){a.set(0,0,1),e.vmult(a,a);var r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===a.x&&(i.x=t.x),1===a.y&&(i.y=t.y),1===a.z&&(i.z=t.z),-1===a.x&&(n.x=t.x),-1===a.y&&(n.y=t.y),-1===a.z&&(n.z=t.z)},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,n){e.exports=i;var i=t("./Shape");function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),i.prototype.constructor=i,i.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,n){e.exports=o;var i=t("./Shape"),r=t("../math/Vec3");function o(t){if(i.call(this),this.radius=void 0!==t?Number(t):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}o.prototype=new i,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(t,e){e=e||new r;var n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e},o.prototype.volume=function(){return 4*Math.PI*this.radius/3},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},o.prototype.calculateWorldAABB=function(t,e,n,i){for(var r=this.radius,o=["x","y","z"],a=0;a<o.length;a++){var s=o[a];n[s]=t[s]-r,i[s]=t[s]+r}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,n){e.exports=l;var i=t("./Shape"),r=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform")),a=t("../collision/AABB"),s=t("../utils/Octree");function l(t,e){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new a,this.edges=null,this.scale=new r(1,1,1),this.tree=new s,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}l.prototype=new i,l.prototype.constructor=l;var c=new r;l.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new a,i=new r,o=new r,s=new r,l=[i,o,s],c=0;c<this.indices.length/3;c++){var u=3*c;this._getUnscaledVertex(this.indices[u],i),this._getUnscaledVertex(this.indices[u+1],o),this._getUnscaledVertex(this.indices[u+2],s),n.setFromPoints(l),t.insert(n,c)}t.removeEmptyNodes()};var u=new a;l.prototype.getTrianglesInAABB=function(t,e){u.copy(t);var n=this.scale,i=n.x,r=n.y,o=n.z,a=u.lowerBound,s=u.upperBound;return a.x/=i,a.y/=r,a.z/=o,s.x/=i,s.y/=r,s.z/=o,this.tree.aabbQuery(u,e)},l.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},l.prototype.updateNormals=function(){for(var t=c,e=this.normals,n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],o=this.indices[i+1],a=this.indices[i+2];this.getVertex(r,m),this.getVertex(o,g),this.getVertex(a,v),l.computeNormal(g,m,v,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}},l.prototype.updateEdges=function(){for(var t={},e=function(e,n){t[r<o?r+"_"+o:o+"_"+r]=!0},n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],o=this.indices[i+1];this.indices[i+2],e(),e(),e()}var a=Object.keys(t);for(this.edges=new Int16Array(2*a.length),n=0;n<a.length;n++){var s=a[n].split("_");this.edges[2*n]=parseInt(s[0],10),this.edges[2*n+1]=parseInt(s[1],10)}},l.prototype.getEdgeVertex=function(t,e,n){var i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)};var h=new r,f=new r;l.prototype.getEdgeVector=function(t,e){var n=h,i=f;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)};var d=new r,p=new r;l.computeNormal=function(t,e,n,i){e.vsub(t,p),n.vsub(e,d),d.cross(p,i),i.isZero()||i.normalize()};var m=new r,g=new r,v=new r;l.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},l.prototype._getUnscaledVertex=function(t,e){var n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])},l.prototype.getWorldVertex=function(t,e,n,i){return this.getVertex(t,i),o.pointToWorldFrame(e,n,i,i),i},l.prototype.getTriangleVertices=function(t,e,n,i){var r=3*t;this.getVertex(this.indices[r],e),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)},l.prototype.getNormal=function(t,e){var n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var y=new a;l.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(y);var n=y.upperBound.x-y.lowerBound.x,i=y.upperBound.y-y.lowerBound.y,r=y.upperBound.z-y.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*r*2*r),1/12*t*(2*n*2*n+2*r*2*r),1/12*t*(2*i*2*i+2*n*2*n))};var x=new r;l.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,i=this.vertices.length,r=(this.vertices,x);this.getVertex(0,r),e.copy(r),n.copy(r);for(var o=0;o!==i;o++)this.getVertex(o,r),r.x<e.x?e.x=r.x:r.x>n.x&&(n.x=r.x),r.y<e.y?e.y=r.y:r.y>n.y&&(n.y=r.y),r.z<e.z?e.z=r.z:r.z>n.z&&(n.z=r.z)},l.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},l.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new r,i=0,o=e.length/3;i!==o;i++){this.getVertex(i,n);var a=n.norm2();a>t&&(t=a)}this.boundingSphereRadius=Math.sqrt(t)},new r;var b=new o,w=new a;l.prototype.calculateWorldAABB=function(t,e,n,i){var r=b,o=w;r.position=t,r.quaternion=e,this.aabb.toWorldFrame(r,o),n.copy(o.lowerBound),i.copy(o.upperBound)},l.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},l.createTorus=function(t,e,n,i,r){t=t||1,e=e||.5,n=n||8,i=i||6,r=r||2*Math.PI;for(var o=[],a=[],s=0;s<=n;s++)for(var c=0;c<=i;c++){var u=c/i*r,h=s/n*Math.PI*2,f=(t+e*Math.cos(h))*Math.cos(u),d=(t+e*Math.cos(h))*Math.sin(u),p=e*Math.sin(h);o.push(f,d,p)}for(s=1;s<=n;s++)for(c=1;c<=i;c++){var m=(i+1)*s+c-1,g=(i+1)*(s-1)+c-1,v=(i+1)*(s-1)+c,y=(i+1)*s+c;a.push(m,g,y),a.push(g,v,y)}return new l(o,a)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,n){e.exports=r,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver");function r(){i.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new i;var o=[],a=[],s=[];r.prototype.solve=function(t,e){var n,i,r,l,c,u=0,h=this.iterations,f=this.tolerance*this.tolerance,d=this.equations,p=d.length,m=e.bodies,g=m.length,v=t;if(0!==p)for(var y=0;y!==g;y++)m[y].updateSolveMassProperties();var x=a,b=s,w=o;for(x.length=p,b.length=p,w.length=p,y=0;y!==p;y++){var _=d[y];w[y]=0,b[y]=_.computeB(v),x[y]=1/_.computeC()}if(0!==p){for(y=0;y!==g;y++){var M=(A=m[y]).vlambda,S=A.wlambda;M.set(0,0,0),S&&S.set(0,0,0)}for(u=0;u!==h;u++){l=0;for(var T=0;T!==p;T++)_=d[T],n=b[T],i=x[T],(c=w[T])+(r=i*(n-_.computeGWlambda()-_.eps*c))<_.minForce?r=_.minForce-c:c+r>_.maxForce&&(r=_.maxForce-c),w[T]+=r,l+=r>0?r:-r,_.addToWlambda(r);if(l*l<f)break}for(y=0;y!==g;y++){var A,E=(A=m[y]).velocity,q=A.angularVelocity;E.vadd(A.vlambda,E),q&&q.vadd(A.wlambda,q)}}return u}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,n){function i(){this.equations=[]}e.exports=i,i.prototype.solve=function(t,e){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=o,t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver"),r=t("../objects/Body");function o(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}o.prototype=new i;var a=[],s=[],l={bodies:[]},c=r.STATIC;function u(t){for(var e=t.length,n=0;n!==e;n++){var i=t[n];if(!(i.visited||i.body.type&c))return i}return!1}var h=[];function f(t,e,n,i){for(h.push(t),t.visited=!0,e(t,n,i);h.length;)for(var r,o=h.pop();r=u(o.children);)r.visited=!0,e(r,n,i),h.push(r)}function d(t,e,n){e.push(t.body);for(var i=t.eqs.length,r=0;r!==i;r++){var o=t.eqs[r];-1===n.indexOf(o)&&n.push(o)}}function p(t,e){return e.id-t.id}o.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},o.prototype.solve=function(t,e){for(var n=a,i=this.nodePool,r=e.bodies,o=this.equations,c=o.length,h=r.length,m=this.subsolver;i.length<h;)i.push(this.createNode());n.length=h;for(var g=0;g<h;g++)n[g]=i[g];for(g=0;g!==h;g++){var v=n[g];v.body=r[g],v.children.length=0,v.eqs.length=0,v.visited=!1}for(var y=0;y!==c;y++){var x=o[y],b=(g=r.indexOf(x.bi),r.indexOf(x.bj)),w=n[g],_=n[b];w.children.push(_),w.eqs.push(x),_.children.push(w),_.eqs.push(x)}var M,S=0,T=s;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var A=l;M=u(n);){T.length=0,A.bodies.length=0,f(M,d,A.bodies,T);var E=T.length;for(T=T.sort(p),g=0;g!==E;g++)m.addEquation(T[g]);m.solve(t,A),m.removeAllEquations(),S++}return S}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,n){var i=function(){};e.exports=i,i.prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;var i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}},{}],50:[function(t,e,n){var i=t("../collision/AABB"),r=t("../math/Vec3");function o(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new i,this.data=[],this.children=[]}function a(t,e){(e=e||{}).root=null,e.aabb=t,o.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=a,a.prototype=new o,o.prototype.reset=function(t,e){this.children.length=this.data.length=0},o.prototype.insert=function(t,e,n){var i=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var o=!1;r.length||(this.subdivide(),o=!0);for(var a=0;8!==a;a++)if(r[a].insert(t,e,n+1))return!0;o&&(r.length=0)}return i.push(e),!0};var s=new r;o.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,n=t.upperBound,a=this.children;a.push(new o({aabb:new i({lowerBound:new r(0,0,0)})}),new o({aabb:new i({lowerBound:new r(1,0,0)})}),new o({aabb:new i({lowerBound:new r(1,1,0)})}),new o({aabb:new i({lowerBound:new r(1,1,1)})}),new o({aabb:new i({lowerBound:new r(0,1,1)})}),new o({aabb:new i({lowerBound:new r(0,0,1)})}),new o({aabb:new i({lowerBound:new r(1,0,1)})}),new o({aabb:new i({lowerBound:new r(0,1,0)})})),n.vsub(e,s),s.scale(.5,s);for(var l=this.root||this,c=0;8!==c;c++){var u=a[c];u.root=l;var h=u.aabb.lowerBound;h.x*=s.x,h.y*=s.y,h.z*=s.z,h.vadd(e,h),h.vadd(s,u.aabb.upperBound)}},o.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e};var l=new i;o.prototype.rayQuery=function(t,e,n){return t.getAABB(l),l.toLocalFrame(e,l),this.aabbQuery(l,n),n},o.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;n>=0;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,n){function i(){this.objects=[],this.type=Object}e.exports=i,i.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,n){function i(){this.data={keys:[]}}e.exports=i,i.prototype.get=function(t,e){if(t>e){var n=e;e=t,t=n}return this.data[t+"-"+e]},i.prototype.set=function(t,e,n){if(t>e){var i=e;e=t,t=i}var r=t+"-"+e;this.get(t,e)||this.data.keys.push(r),this.data[r]=n},i.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;)delete t[e.pop()]}},{}],53:[function(t,e,n){function i(){}e.exports=i,i.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=o;var i=t("../math/Vec3"),r=t("./Pool");function o(){r.call(this),this.type=i}o.prototype=new r,o.prototype.constructObject=function(){return new i}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,n){e.exports=f;var i=t("../collision/AABB"),r=t("../shapes/Shape"),o=t("../collision/Ray"),a=t("../math/Vec3"),s=t("../math/Transform"),l=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),c=(t("../solver/Solver"),t("../utils/Vec3Pool")),u=t("../equations/ContactEquation"),h=t("../equations/FrictionEquation");function f(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}f.prototype.createContactEquation=function(t,e,n,i,r,o){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=t,a.bj=e):a=new u(t,e),a.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=n.material||t.material,c=i.material||e.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(a.restitution=l.restitution*c.restitution),a.si=r||n,a.sj=o||i,a},f.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,i=t.bj,r=t.si,o=t.sj,a=this.world,s=this.currentContactMaterial,l=s.friction,c=r.material||n.material,u=o.material||i.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(l=c.friction*u.friction),l>0){var f=l*a.gravity.length(),d=n.invMass+i.invMass;d>0&&(d=1/d);var p=this.frictionEquationPool,m=p.length?p.pop():new h(n,i,f*d),g=p.length?p.pop():new h(n,i,f*d);return m.bi=g.bi=n,m.bj=g.bj=i,m.minForce=g.minForce=-f*d,m.maxForce=g.maxForce=f*d,m.ri.copy(t.ri),m.rj.copy(t.rj),g.ri.copy(t.ri),g.rj.copy(t.rj),t.ni.tangents(m.t,g.t),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),g.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.enabled=g.enabled=t.enabled,e.push(m,g),!0}return!1};var d=new a,p=new a,m=new a;f.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];d.setZero(),p.setZero(),m.setZero();for(var r=e.bi,o=(e.bj,0);o!==t;o++)(e=this.result[this.result.length-1-o]).bodyA!==r?(d.vadd(e.ni,d),p.vadd(e.ri,p),m.vadd(e.rj,m)):(d.vsub(e.ni,d),p.vadd(e.rj,p),m.vadd(e.ri,m));var a=1/t;p.scale(a,n.ri),m.scale(a,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),d.normalize(),d.tangents(n.t,i.t)}};var g=new a,v=new a,y=new l,x=new l;f.prototype.getContacts=function(t,e,n,i,r,o,a){this.contactPointPool=r,this.frictionEquationPool=a,this.result=i,this.frictionResult=o;for(var s=y,l=x,c=g,u=v,h=0,f=t.length;h!==f;h++){var d=t[h],p=e[h],m=null;d.material&&p.material&&(m=n.getContactMaterial(d.material,p.material)||null);for(var b=0;b<d.shapes.length;b++){d.quaternion.mult(d.shapeOrientations[b],s),d.quaternion.vmult(d.shapeOffsets[b],c),c.vadd(d.position,c);for(var w=d.shapes[b],_=0;_<p.shapes.length;_++){p.quaternion.mult(p.shapeOrientations[_],l),p.quaternion.vmult(p.shapeOffsets[_],u),u.vadd(p.position,u);var M=p.shapes[_];if(!(c.distanceTo(u)>w.boundingSphereRadius+M.boundingSphereRadius)){var S=null;w.material&&M.material&&(S=n.getContactMaterial(w.material,M.material)||null),this.currentContactMaterial=S||m||n.defaultContactMaterial;var T=this[w.type|M.type];T&&(w.type<M.type?T.call(this,w,M,c,u,s,l,d,p,w,M):T.call(this,M,w,u,c,l,s,p,d,w,M))}}}}},f.prototype[r.types.BOX|r.types.BOX]=f.prototype.boxBox=function(t,e,n,i,r,o,a,s){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,r,o,a,s,t,e)},f.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=f.prototype.boxConvex=function(t,e,n,i,r,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,r,o,a,s,t,e)},f.prototype[r.types.BOX|r.types.PARTICLE]=f.prototype.boxParticle=function(t,e,n,i,r,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,r,o,a,s,t,e)},f.prototype[r.types.SPHERE]=f.prototype.sphereSphere=function(t,e,n,i,r,o,a,s){var l=this.createContactEquation(a,s,t,e);i.vsub(n,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(t.radius,l.ri),l.rj.mult(-e.radius,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(a.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(s.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var b=new a,w=new a,_=new a;f.prototype[r.types.PLANE|r.types.TRIMESH]=f.prototype.planeTrimesh=function(t,e,n,i,r,o,l,c){var u=new a,h=b;h.set(0,0,1),r.vmult(h,h);for(var f=0;f<e.vertices.length/3;f++){e.getVertex(f,u);var d=new a;d.copy(u),s.pointToWorldFrame(i,o,d,u);var p=w;if(u.vsub(n,p),h.dot(p)<=0){var m=this.createContactEquation(l,c,t,e);m.ni.copy(h);var g=_;h.scale(p.dot(h),g),u.vsub(g,g),m.ri.copy(g),m.ri.vsub(l.position,m.ri),m.rj.copy(u),m.rj.vsub(c.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}};var M=new a,S=new a,T=(new a,new a),A=new a,E=new a,q=new a,C=new a,P=new a,R=new a,L=new a,I=new a,D=new a,O=new a,N=new i,F=[];f.prototype[r.types.SPHERE|r.types.TRIMESH]=f.prototype.sphereTrimesh=function(t,e,n,i,r,a,l,c){var u=E,h=q,f=C,d=P,p=R,m=L,g=N,v=A,y=S,x=F;s.pointToLocalFrame(i,a,n,p);var b=t.radius;g.lowerBound.set(p.x-b,p.y-b,p.z-b),g.upperBound.set(p.x+b,p.y+b,p.z+b),e.getTrianglesInAABB(g,x);for(var w=T,_=t.radius*t.radius,B=0;B<x.length;B++)for(var z=0;z<3;z++)e.getVertex(e.indices[3*x[B]+z],w),w.vsub(p,y),y.norm2()<=_&&(v.copy(w),s.pointToWorldFrame(i,a,v,w),w.vsub(n,y),(j=this.createContactEquation(l,c,t,e)).ni.copy(y),j.ni.normalize(),j.ri.copy(j.ni),j.ri.scale(t.radius,j.ri),j.ri.vadd(n,j.ri),j.ri.vsub(l.position,j.ri),j.rj.copy(w),j.rj.vsub(c.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult));for(B=0;B<x.length;B++)for(z=0;z<3;z++){e.getVertex(e.indices[3*x[B]+z],u),e.getVertex(e.indices[3*x[B]+(z+1)%3],h),h.vsub(u,f),p.vsub(h,m);var U=m.dot(f);p.vsub(u,m);var k=m.dot(f);if(k>0&&U<0&&(p.vsub(u,m),d.copy(f),d.normalize(),k=m.dot(d),d.scale(k,m),m.vadd(u,m),(Y=m.distanceTo(p))<t.radius)){var j=this.createContactEquation(l,c,t,e);m.vsub(p,j.ni),j.ni.normalize(),j.ni.scale(t.radius,j.ri),s.pointToWorldFrame(i,a,m,m),m.vsub(c.position,j.rj),s.vectorToWorldFrame(a,j.ni,j.ni),s.vectorToWorldFrame(a,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}for(var V=I,G=D,H=O,W=M,X=(B=0,x.length);B!==X;B++){e.getTriangleVertices(x[B],V,G,H),e.getNormal(x[B],W),p.vsub(V,m);var Y=m.dot(W);W.scale(Y,m),p.vsub(m,m),Y=m.distanceTo(p),o.pointInTriangle(m,V,G,H)&&Y<t.radius&&(j=this.createContactEquation(l,c,t,e),m.vsub(p,j.ni),j.ni.normalize(),j.ni.scale(t.radius,j.ri),s.pointToWorldFrame(i,a,m,m),m.vsub(c.position,j.rj),s.vectorToWorldFrame(a,j.ni,j.ni),s.vectorToWorldFrame(a,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult))}x.length=0};var B=new a,z=new a;f.prototype[r.types.SPHERE|r.types.PLANE]=f.prototype.spherePlane=function(t,e,n,i,r,o,a,s){var l=this.createContactEquation(a,s,t,e);if(l.ni.set(0,0,1),o.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(t.radius,l.ri),n.vsub(i,B),l.ni.mult(l.ni.dot(B),z),B.vsub(z,l.rj),-B.dot(l.ni)<=t.radius){var c=l.ri,u=l.rj;c.vadd(n,c),c.vsub(a.position,c),u.vadd(i,u),u.vsub(s.position,u),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var U=new a,k=new a,j=new a;function V(t,e,n){for(var i=null,r=t.length,o=0;o!==r;o++){var a=t[o],s=U;t[(o+1)%r].vsub(a,s);var l=k;s.cross(e,l);var c=j;n.vsub(a,c);var u=l.dot(c);if(!(null===i||u>0&&!0===i||u<=0&&!1===i))return!1;null===i&&(i=u>0)}return!0}var G=new a,H=new a,W=new a,X=new a,Y=[new a,new a,new a,new a,new a,new a],Z=new a,Q=new a,J=new a,K=new a;f.prototype[r.types.SPHERE|r.types.BOX]=f.prototype.sphereBox=function(t,e,n,i,r,o,a,s){var l=this.v3pool,c=Y;n.vsub(i,G),e.getSideNormals(c,o);for(var u=t.radius,h=!1,f=Q,d=J,p=K,m=null,g=0,v=0,y=0,x=null,b=0,w=c.length;b!==w&&!1===h;b++){var _=H;_.copy(c[b]);var M=_.norm();_.normalize();var S=G.dot(_);if(S<M+u&&S>0){var T=W,A=X;T.copy(c[(b+1)%3]),A.copy(c[(b+2)%3]);var E=T.norm(),q=A.norm();T.normalize(),A.normalize();var C=G.dot(T),P=G.dot(A);if(C<E&&C>-E&&P<q&&P>-q){var R=Math.abs(S-M-u);(null===x||R<x)&&(x=R,v=C,y=P,m=M,f.copy(_),d.copy(T),p.copy(A),g++)}}}if(g){h=!0;var L=this.createContactEquation(a,s,t,e);f.mult(-u,L.ri),L.ni.copy(f),L.ni.negate(L.ni),f.mult(m,f),d.mult(v,d),f.vadd(d,f),p.mult(y,p),f.vadd(p,L.rj),L.ri.vadd(n,L.ri),L.ri.vsub(a.position,L.ri),L.rj.vadd(i,L.rj),L.rj.vsub(s.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}for(var I=l.get(),D=Z,O=0;2!==O&&!h;O++)for(var N=0;2!==N&&!h;N++)for(var F=0;2!==F&&!h;F++)I.set(0,0,0),O?I.vadd(c[0],I):I.vsub(c[0],I),N?I.vadd(c[1],I):I.vsub(c[1],I),F?I.vadd(c[2],I):I.vsub(c[2],I),i.vadd(I,D),D.vsub(n,D),D.norm2()<u*u&&(h=!0,(L=this.createContactEquation(a,s,t,e)).ri.copy(D),L.ri.normalize(),L.ni.copy(L.ri),L.ri.mult(u,L.ri),L.rj.copy(I),L.ri.vadd(n,L.ri),L.ri.vsub(a.position,L.ri),L.rj.vadd(i,L.rj),L.rj.vsub(s.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult));l.release(I),I=null;var B=l.get(),z=l.get(),U=(L=l.get(),l.get()),k=(R=l.get(),c.length);for(O=0;O!==k&&!h;O++)for(N=0;N!==k&&!h;N++)if(O%3!=N%3){c[N].cross(c[O],B),B.normalize(),c[O].vadd(c[N],z),L.copy(n),L.vsub(z,L),L.vsub(i,L);var j=L.dot(B);for(B.mult(j,U),F=0;F===O%3||F===N%3;)F++;R.copy(n),R.vsub(U,R),R.vsub(z,R),R.vsub(i,R);var V=Math.abs(j),$=R.norm();if(V<c[F].norm()&&$<u){h=!0;var tt=this.createContactEquation(a,s,t,e);z.vadd(U,tt.rj),tt.rj.copy(tt.rj),R.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(i,tt.ri),tt.ri.vsub(n,tt.ri),tt.ri.normalize(),tt.ri.mult(u,tt.ri),tt.ri.vadd(n,tt.ri),tt.ri.vsub(a.position,tt.ri),tt.rj.vadd(i,tt.rj),tt.rj.vsub(s.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}l.release(B,z,L,U,R)};var $=new a,tt=new a,et=new a,nt=new a,it=new a,rt=new a,ot=new a,at=new a,st=new a,lt=new a;f.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=f.prototype.sphereConvex=function(t,e,n,i,r,o,a,s){var l=this.v3pool;n.vsub(i,$);for(var c=e.faceNormals,u=e.faces,h=e.vertices,f=t.radius,d=0;d!==h.length;d++){var p=h[d],m=it;o.vmult(p,m),i.vadd(m,m);var g=nt;if(m.vsub(n,g),g.norm2()<f*f)return v=!0,(R=this.createContactEquation(a,s,t,e)).ri.copy(g),R.ri.normalize(),R.ni.copy(R.ri),R.ri.mult(f,R.ri),m.vsub(i,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(a.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(s.position,R.rj),this.result.push(R),void this.createFrictionEquationsFromContact(R,this.frictionResult)}for(var v=!1,y=(d=0,u.length);d!==y&&!1===v;d++){var x=c[d],b=u[d],w=rt;o.vmult(x,w);var _=ot;o.vmult(h[b[0]],_),_.vadd(i,_);var M=at;w.mult(-f,M),n.vadd(M,M);var S=st;M.vsub(_,S);var T=S.dot(w),A=lt;if(n.vsub(_,A),T<0&&A.dot(w)>0){for(var E=[],q=0,C=b.length;q!==C;q++){var P=l.get();o.vmult(h[b[q]],P),i.vadd(P,P),E.push(P)}if(V(E,w,n)){v=!0;var R=this.createContactEquation(a,s,t,e);w.mult(-f,R.ri),w.negate(R.ni);var L=l.get();w.mult(-T,L);var I=l.get();w.mult(-f,I),n.vsub(i,R.rj),R.rj.vadd(I,R.rj),R.rj.vadd(L,R.rj),R.rj.vadd(i,R.rj),R.rj.vsub(s.position,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(a.position,R.ri),l.release(L),l.release(I),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult),q=0;for(var D=E.length;q!==D;q++)l.release(E[q]);return}for(q=0;q!==b.length;q++){var O=l.get(),N=l.get();o.vmult(h[b[(q+1)%b.length]],O),o.vmult(h[b[(q+2)%b.length]],N),i.vadd(O,O),i.vadd(N,N);var F=tt;N.vsub(O,F);var B=et;F.unit(B);var z=l.get(),U=l.get();n.vsub(O,U);var k=U.dot(B);B.mult(k,z),z.vadd(O,z);var j=l.get();if(z.vsub(n,j),k>0&&k*k<F.norm2()&&j.norm2()<f*f){for(R=this.createContactEquation(a,s,t,e),z.vsub(i,R.rj),z.vsub(n,R.ni),R.ni.normalize(),R.ni.mult(f,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(s.position,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(a.position,R.ri),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult),q=0,D=E.length;q!==D;q++)l.release(E[q]);return l.release(O),l.release(N),l.release(z),l.release(j),void l.release(U)}l.release(O),l.release(N),l.release(z),l.release(j),l.release(U)}for(q=0,D=E.length;q!==D;q++)l.release(E[q])}}},new a,new a,f.prototype[r.types.PLANE|r.types.BOX]=f.prototype.planeBox=function(t,e,n,i,r,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,r,o,a,s)};var ct=new a,ut=new a,ht=new a,ft=new a;f.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=f.prototype.planeConvex=function(t,e,n,i,r,o,a,s){var l=ct,c=ut;c.set(0,0,1),r.vmult(c,c);for(var u=0,h=ht,f=0;f!==e.vertices.length;f++)if(l.copy(e.vertices[f]),o.vmult(l,l),i.vadd(l,l),l.vsub(n,h),c.dot(h)<=0){var d=this.createContactEquation(a,s,t,e),p=ft;c.mult(c.dot(h),p),l.vsub(p,p),p.vsub(n,d.ri),d.ni.copy(c),l.vsub(i,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(s.position,d.rj),this.result.push(d),u++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}this.enableFrictionReduction&&u&&this.createFrictionFromAverage(u)};var dt=new a,pt=new a;f.prototype[r.types.CONVEXPOLYHEDRON]=f.prototype.convexConvex=function(t,e,n,i,r,o,a,s,l,c,u,h){var f=dt;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,r,i,o,f,u,h)){var d=[],p=pt;t.clipAgainstHull(n,r,e,i,o,f,-100,100,d);for(var m=0,g=0;g!==d.length;g++){var v=this.createContactEquation(a,s,t,e,l,c),y=v.ri,x=v.rj;f.negate(v.ni),d[g].normal.negate(p),p.mult(d[g].depth,p),d[g].point.vadd(p,y),x.copy(d[g].point),y.vsub(n,y),x.vsub(i,x),y.vadd(n,y),y.vsub(a.position,y),x.vadd(i,x),x.vsub(s.position,x),this.result.push(v),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var mt=new a,gt=new a,vt=new a;f.prototype[r.types.PLANE|r.types.PARTICLE]=f.prototype.planeParticle=function(t,e,n,i,r,o,a,s){var l=mt;l.set(0,0,1),a.quaternion.vmult(l,l);var c=gt;if(i.vsub(a.position,c),l.dot(c)<=0){var u=this.createContactEquation(s,a,e,t);u.ni.copy(l),u.ni.negate(u.ni),u.ri.set(0,0,0);var h=vt;l.mult(l.dot(i),h),i.vsub(h,h),u.rj.copy(h),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var yt=new a;f.prototype[r.types.PARTICLE|r.types.SPHERE]=f.prototype.sphereParticle=function(t,e,n,i,r,o,a,s){var l=yt;if(l.set(0,0,1),i.vsub(n,l),l.norm2()<=t.radius*t.radius){var c=this.createContactEquation(s,a,e,t);l.normalize(),c.rj.copy(l),c.rj.mult(t.radius,c.rj),c.ni.copy(l),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var xt=new l,bt=new a,wt=(new a,new a),_t=new a,Mt=new a;f.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=f.prototype.convexParticle=function(t,e,n,i,r,o,a,s){var l=-1,c=wt,u=Mt,h=null,f=bt;if(f.copy(i),f.vsub(n,f),r.conjugate(xt),xt.vmult(f,f),t.pointIsInside(f)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,r),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(r);for(var d=0,p=t.faces.length;d!==p;d++){var m=[t.worldVertices[t.faces[d][0]]],g=t.worldFaceNormals[d];i.vsub(m[0],_t);var v=-g.dot(_t);(null===h||Math.abs(v)<Math.abs(h))&&(h=v,l=d,c.copy(g))}if(-1!==l){var y=this.createContactEquation(s,a,e,t);c.mult(h,u),u.vadd(i,u),u.vsub(n,u),y.rj.copy(u),c.negate(y.ni),y.ri.set(0,0,0);var x=y.ri,b=y.rj;x.vadd(i,x),x.vsub(s.position,x),b.vadd(n,b),b.vsub(a.position,b),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},f.prototype[r.types.BOX|r.types.HEIGHTFIELD]=f.prototype.boxHeightfield=function(t,e,n,i,r,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,r,o,a,s)};var St=new a,Tt=new a,At=[0];f.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=f.prototype.convexHeightfield=function(t,e,n,i,r,o,a,l){var c=e.data,u=e.elementSize,h=t.boundingSphereRadius,f=Tt,d=At,p=St;s.pointToLocalFrame(i,o,n,p);var m=Math.floor((p.x-h)/u)-1,g=Math.ceil((p.x+h)/u)+1,v=Math.floor((p.y-h)/u)-1,y=Math.ceil((p.y+h)/u)+1;if(!(g<0||y<0||m>c.length||v>c[0].length)){m<0&&(m=0),g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),m>=c.length&&(m=c.length-1),g>=c.length&&(g=c.length-1),y>=c[0].length&&(y=c[0].length-1),v>=c[0].length&&(v=c[0].length-1);var x=[];e.getRectMinMax(m,v,g,y,x);var b=x[0],w=x[1];if(!(p.z-h>w||p.z+h<b))for(var _=m;_<g;_++)for(var M=v;M<y;M++)e.getConvexTrianglePillar(_,M,!1),s.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,f,r,o,a,l,null,null,d,null),e.getConvexTrianglePillar(_,M,!0),s.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,f,r,o,a,l,null,null,d,null)}};var Et=new a,qt=new a;f.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=f.prototype.sphereHeightfield=function(t,e,n,i,r,o,a,l){var c=e.data,u=t.radius,h=e.elementSize,f=qt,d=Et;s.pointToLocalFrame(i,o,n,d);var p=Math.floor((d.x-u)/h)-1,m=Math.ceil((d.x+u)/h)+1,g=Math.floor((d.y-u)/h)-1,v=Math.ceil((d.y+u)/h)+1;if(!(m<0||v<0||p>c.length||v>c[0].length)){p<0&&(p=0),m<0&&(m=0),g<0&&(g=0),v<0&&(v=0),p>=c.length&&(p=c.length-1),m>=c.length&&(m=c.length-1),v>=c[0].length&&(v=c[0].length-1),g>=c[0].length&&(g=c[0].length-1);var y=[];e.getRectMinMax(p,g,m,v,y);var x=y[0],b=y[1];if(!(d.z-u>b||d.z+u<x))for(var w=this.result,_=p;_<m;_++)for(var M=g;M<v;M++){var S=w.length;if(e.getConvexTrianglePillar(_,M,!1),s.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,f,r,o,a,l),e.getConvexTrianglePillar(_,M,!0),s.pointToWorldFrame(i,o,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,f,r,o,a,l),w.length-S>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,n){e.exports=y;var i=t("../shapes/Shape"),r=t("../math/Vec3"),o=t("../math/Quaternion"),a=t("../solver/GSSolver"),s=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),l=t("../utils/EventTarget"),c=t("../collision/ArrayCollisionMatrix"),u=t("../material/Material"),h=t("../material/ContactMaterial"),f=t("../objects/Body"),d=t("../utils/TupleDictionary"),p=t("../collision/RaycastResult"),m=t("../collision/AABB"),g=t("../collision/Ray"),v=t("../collision/NaiveBroadphase");function y(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new v,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new s(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new u("default"),this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}y.prototype=new l,new m;var x=new g;if(y.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},y.prototype.numObjects=function(){return this.bodies.length},y.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},y.prototype.add=y.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof f&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},y.prototype.addConstraint=function(t){this.constraints.push(t)},y.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},y.prototype.rayTest=function(t,e,n){n instanceof p?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},y.prototype.raycastAll=function(t,e,n,i){return n.mode=g.ALL,n.from=t,n.to=e,n.callback=i,x.intersectWorld(this,n)},y.prototype.raycastAny=function(t,e,n,i){return n.mode=g.ANY,n.from=t,n.to=e,n.result=i,x.intersectWorld(this,n)},y.prototype.raycastClosest=function(t,e,n,i){return n.mode=g.CLOSEST,n.from=t,n.to=e,n.result=i,x.intersectWorld(this,n)},y.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(var r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},y.prototype.removeBody=y.prototype.remove,y.prototype.addMaterial=function(t){this.materials.push(t)},y.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),performance.now=function(){return Date.now()-b}}var w=new r;y.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var i=Math.floor((this.time+e)/t)-Math.floor(this.time/t);i=Math.min(i,n);for(var r=performance.now(),o=0;o!==i&&(this.internalStep(t),!(performance.now()-r>1e3*t));o++);this.time+=e;for(var a=this.time%t/t,s=w,l=this.bodies,c=0;c!==l.length;c++){var u=l[c];u.type!==f.STATIC&&u.sleepState!==f.SLEEPING?(u.position.vsub(u.previousPosition,s),s.scale(a,s),u.position.vadd(s,u.interpolatedPosition)):(u.interpolatedPosition.copy(u.position),u.interpolatedQuaternion.copy(u.quaternion))}}};var _={type:"postStep"},M={type:"preStep"},S={type:"collide",body:null,contact:null},T=[],A=[],E=[],q=[],C=(new r,new r,new r,new r,new r,new r,new r,new r,new r,new o,new o),P=new o,R=new r;y.prototype.internalStep=function(t){this.dt=t;var e,n=this.contacts,r=E,o=q,a=this.numObjects(),s=this.bodies,l=this.solver,c=this.gravity,u=this.doProfiling,h=this.profile,d=f.DYNAMIC,p=this.constraints,m=A,g=(c.norm(),c.x),v=c.y,y=c.z,x=0;for(u&&(e=performance.now()),x=0;x!==a;x++)if((U=s[x]).type&d){var b=U.force,w=U.mass;b.x+=w*g,b.y+=w*v,b.z+=w*y}x=0;for(var L=this.subsystems.length;x!==L;x++)this.subsystems[x].update();u&&(e=performance.now()),r.length=0,o.length=0,this.broadphase.collisionPairs(this,r,o),u&&(h.broadphase=performance.now()-e);var I=p.length;for(x=0;x!==I;x++)if(!(j=p[x]).collideConnected)for(var D=r.length-1;D>=0;D-=1)(j.bodyA===r[D]&&j.bodyB===o[D]||j.bodyB===r[D]&&j.bodyA===o[D])&&(r.splice(D,1),o.splice(D,1));this.collisionMatrixTick(),u&&(e=performance.now());var O=T,N=n.length;for(x=0;x!==N;x++)O.push(n[x]);n.length=0;var F=this.frictionEquations.length;for(x=0;x!==F;x++)m.push(this.frictionEquations[x]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(r,o,this,n,O,this.frictionEquations,m),u&&(h.narrowphase=performance.now()-e),u&&(e=performance.now()),x=0;x<this.frictionEquations.length;x++)l.addEquation(this.frictionEquations[x]);for(var B=n.length,z=0;z!==B;z++){var U=(j=n[z]).bi,k=j.bj;j.si,j.sj,(U.material&&k.material&&this.getContactMaterial(U.material,k.material)||this.defaultContactMaterial).friction,U.material&&k.material&&(U.material.friction>=0&&k.material.friction>=0&&(U.material.friction,k.material.friction),U.material.restitution>=0&&k.material.restitution>=0&&(j.restitution=U.material.restitution*k.material.restitution)),l.addEquation(j),U.allowSleep&&U.type===f.DYNAMIC&&U.sleepState===f.SLEEPING&&k.sleepState===f.AWAKE&&k.type!==f.STATIC&&k.velocity.norm2()+k.angularVelocity.norm2()>=2*Math.pow(k.sleepSpeedLimit,2)&&(U._wakeUpAfterNarrowphase=!0),k.allowSleep&&k.type===f.DYNAMIC&&k.sleepState===f.SLEEPING&&U.sleepState===f.AWAKE&&U.type!==f.STATIC&&U.velocity.norm2()+U.angularVelocity.norm2()>=2*Math.pow(U.sleepSpeedLimit,2)&&(k._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(U,k,!0),this.collisionMatrixPrevious.get(U,k)||(S.body=k,S.contact=j,U.dispatchEvent(S),S.body=U,k.dispatchEvent(S))}for(u&&(h.makeContactConstraints=performance.now()-e,e=performance.now()),x=0;x!==a;x++)(U=s[x])._wakeUpAfterNarrowphase&&(U.wakeUp(),U._wakeUpAfterNarrowphase=!1);for(I=p.length,x=0;x!==I;x++){var j;(j=p[x]).update(),D=0;for(var V=j.equations.length;D!==V;D++){var G=j.equations[D];l.addEquation(G)}}l.solve(t,this),u&&(h.solve=performance.now()-e),l.removeAllEquations();var H=Math.pow;for(x=0;x!==a;x++)if((U=s[x]).type&d){var W=H(1-U.linearDamping,t),X=U.velocity;X.mult(W,X);var Y=U.angularVelocity;if(Y){var Z=H(1-U.angularDamping,t);Y.mult(Z,Y)}}for(this.dispatchEvent(M),x=0;x!==a;x++)(U=s[x]).preStep&&U.preStep.call(U);u&&(e=performance.now());var Q=C,J=P,K=this.stepnumber,$=f.DYNAMIC|f.KINEMATIC,tt=K%(this.quatNormalizeSkip+1)==0,et=this.quatNormalizeFast,nt=.5*t;for(i.types.PLANE,i.types.CONVEXPOLYHEDRON,x=0;x!==a;x++){var it=s[x],rt=it.force,ot=it.torque;if(it.type&$&&it.sleepState!==f.SLEEPING){var at=it.velocity,st=it.angularVelocity,lt=it.position,ct=it.quaternion,ut=it.invMass,ht=it.invInertiaWorld;at.x+=rt.x*ut*t,at.y+=rt.y*ut*t,at.z+=rt.z*ut*t,it.angularVelocity&&(ht.vmult(ot,R),R.mult(t,R),R.vadd(st,st)),lt.x+=at.x*t,lt.y+=at.y*t,lt.z+=at.z*t,it.angularVelocity&&(Q.set(st.x,st.y,st.z,0),Q.mult(ct,J),ct.x+=nt*J.x,ct.y+=nt*J.y,ct.z+=nt*J.z,ct.w+=nt*J.w,tt&&(et?ct.normalizeFast():ct.normalize())),it.aabb&&(it.aabbNeedsUpdate=!0),it.updateInertiaWorld&&it.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,u&&(h.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(_),x=0;x!==a;x++){var ft=(U=s[x]).postStep;ft&&ft.call(U)}if(this.allowSleep)for(x=0;x!==a;x++)s[x].sleepTick(this.time)},y.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var i=t[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},function(t,e,n){(function(t){function n(t,e){for(var n=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}e.resolve=function(){for(var e="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,r="/"===a.charAt(0))}return(r?"/":"")+(e=n(i(e.split("/"),(function(t){return!!t})),!r).join("/"))||"."},e.normalize=function(t){var o=e.isAbsolute(t),a="/"===r(t,-1);return(t=n(i(t.split("/"),(function(t){return!!t})),!o).join("/"))||o||(t="."),t&&a&&(t+="/"),(o?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},e.relative=function(t,n){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var r=i(t.split("/")),o=i(n.split("/")),a=Math.min(r.length,o.length),s=a,l=0;l<a;l++)if(r[l]!==o[l]){s=l;break}var c=[];for(l=s;l<r.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,i=-1,r=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!r){i=o;break}}else r=!1;return-1===i?n?"/":".":n&&1===i?"/":t.slice(0,i)},e.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,i=-1,r=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!r){n=e+1;break}}else-1===i&&(r=!1,i=e+1);return-1===i?"":t.slice(n,i)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,n=0,i=-1,r=!0,o=0,a=t.length-1;a>=0;--a){var s=t.charCodeAt(a);if(47!==s)-1===i&&(r=!1,i=a+1),46===s?-1===e?e=a:1!==o&&(o=1):-1!==e&&(o=-1);else if(!r){n=a+1;break}}return-1===e||-1===i||0===o||1===o&&e===i-1&&e===n+1?"":t.slice(e,i)};var r="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n(126))},function(t,e,n){var i,r,o;
/**
 * @license PSON (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/PSON for details
 */!function(a){"use strict";function s(t){if(!t)throw new Error("PSON requires ByteBuffer.js: Get it at https://github.com/dcodeIO/ByteBuffer.js");var e,n={};return n.T={ZERO:0,MAX:239,NULL:240,TRUE:241,FALSE:242,EOBJECT:243,EARRAY:244,ESTRING:245,OBJECT:246,ARRAY:247,INTEGER:248,LONG:249,FLOAT:250,DOUBLE:251,STRING:252,STRING_ADD:253,STRING_GET:254,BINARY:255},n.Encoder=function(t,e){var n=new t(4);n.length=4;var i=t.Long,r=function(t,e,n){if(this.dict={},this.next=0,t&&Array.isArray(t))for(;this.next<t.length;)this.dict[t[this.next]]=this.next++;this.progressive=!!e,this.options=n||{}};return r.prototype.encode=function(e,n){var i=!1;n||(n=new t,i=!0);var r=n.littleEndian;try{return this._encodeValue(e,n.LE()),n.littleEndian=r,i?n.flip():n}catch(t){throw n.littleEndian=r,t}},r.prototype._encodeValue=function(r,o,a){if(null===r)o.writeUint8(e.NULL);else switch(typeof r){case"function":r=r.toString();case"string":0===r.length?o.writeUint8(e.ESTRING):this.dict.hasOwnProperty(r)?(o.writeUint8(e.STRING_GET),o.writeVarint32(this.dict[r])):(o.writeUint8(e.STRING),o.writeVString(r));break;case"number":if(r===parseInt(r)){var s=t.zigZagEncode32(r);s<=e.MAX?o.writeUint8(s):(o.writeUint8(e.INTEGER),o.writeVarint32ZigZag(r))}else n.writeFloat32(r,0),r===n.readFloat32(0)?(o.writeUint8(e.FLOAT),o.writeFloat32(r)):(o.writeUint8(e.DOUBLE),o.writeFloat64(r));break;case"boolean":o.writeUint8(r?e.TRUE:e.FALSE);break;case"object":var l;if(Array.isArray(r))if(0===r.length)o.writeUint8(e.EARRAY);else for(o.writeUint8(e.ARRAY),o.writeVarint32(r.length),l=0;l<r.length;l++)this._encodeValue(r[l],o);else if(i&&r instanceof i)o.writeUint8(e.LONG),o.writeVarint64ZigZag(r);else try{r=t.wrap(r),o.writeUint8(e.BINARY),o.writeVarint32(r.remaining()),o.append(r)}catch(t){var c=Object.keys(r),u=0;for(l=0;l<c.length;l++)void 0!==r[c[l]]&&u++;if(0===u)o.writeUint8(e.EOBJECT);else for(o.writeUint8(e.OBJECT),o.writeVarint32(u),a||(a=!!r._PSON_EXCL_),l=0;l<c.length;l++){var h=c[l];void 0!==r[h]&&(this.dict.hasOwnProperty(h)?(o.writeUint8(e.STRING_GET),o.writeVarint32(this.dict[h])):(this.progressive&&!a?(this.dict[h]=this.next++,o.writeUint8(e.STRING_ADD)):o.writeUint8(e.STRING),o.writeVString(h)),this._encodeValue(r[h],o))}}break;case"undefined":o.writeUint8(e.NULL)}},r}(t,n.T),n.Decoder=function(t,e){var n=t.Long,i=function(t,e,n){this.dict=t&&Array.isArray(t)?t:[],this.progressive=!!e,this.options=n||{}};return i.prototype.decode=function(e){e instanceof t||(e=t.wrap(e));var n=e.littleEndian;try{var i=this._decodeValue(e.LE());return e.littleEndian=n,i}catch(t){throw e.littleEndian=n,t}},i.prototype._decodeValue=function(i){var r=i.readUint8();if(r<=e.MAX)return t.zigZagDecode32(r);switch(r){case e.NULL:return null;case e.TRUE:return!0;case e.FALSE:return!1;case e.EOBJECT:return{};case e.EARRAY:return[];case e.ESTRING:return"";case e.OBJECT:r=i.readVarint32();for(var o={};--r>=0;)o[this._decodeValue(i)]=this._decodeValue(i);return o;case e.ARRAY:r=i.readVarint32();for(var a=[];--r>=0;)a.push(this._decodeValue(i));return a;case e.INTEGER:return i.readVarint32ZigZag();case e.LONG:return n?i.readVarint64ZigZag():i.readVarint32ZigZag();case e.FLOAT:return i.readFloat32();case e.DOUBLE:return i.readFloat64();case e.STRING:return i.readVString();case e.STRING_ADD:var s=i.readVString();return this.dict.push(s),s;case e.STRING_GET:return this.dict[i.readVarint32()];case e.BINARY:r=i.readVarint32();var l=i.slice(i.offset,i.offset+r);return i.offset+=r,l;default:throw new Error("Illegal type at "+i.offset+": "+r)}},i}(t,n.T),n.Pair=((e=function(){this.encoder,this.decoder}).prototype.encode=function(t){return this.encoder.encode(t)},e.prototype.toArrayBuffer=function(t){return this.encoder.encode(t).toArrayBuffer()},e.prototype.toBuffer=function(t){return this.encoder.encode(t).toBuffer()},e.prototype.decode=function(t){return this.decoder.decode(t)},e),n.StaticPair=function(t,e,n){var i=function(i,r){t.call(this),this.encoder=new e(i,!1,r),this.decoder=new n(i,!1,r)};return i.prototype=Object.create(t.prototype),i}(n.Pair,n.Encoder,n.Decoder),n.ProgressivePair=function(t,e,i){var r=function(n,r){t.call(this),this.encoder=new e(n,!0,r),this.decoder=new i(n,!0,r)};return(r.prototype=Object.create(t.prototype)).exclude=function(t){n.exclude(t)},r.prototype.include=function(t){n.include(t)},r}(n.Pair,n.Encoder,n.Decoder),n.exclude=function(t){"object"==typeof t&&Object.defineProperty(t,"_PSON_EXCL_",{value:!0,enumerable:!1,configurable:!0})},n.include=function(t){"object"==typeof t&&delete t._PSON_EXCL_},n}t.exports?t.exports=s(n(506)):(r=[n(507)],void 0===(o="function"==typeof(i=s)?i.apply(e,r):i)||(t.exports=o))}()},function(t,e,n){(function(t){var r,o;
/**
 * @license ByteBuffer.js (c) 2013-2014 Daniel Wirtz <dcode@dcode.io>
 * This version of ByteBuffer.js uses an ArrayBuffer as its backing buffer which is accessed through a DataView and is
 * compatible with modern browsers.
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/ByteBuffer.js for details
 */!function(a){"use strict";function s(t){var e=function(t,n,i){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===n&&(n=e.DEFAULT_ENDIAN),void 0===i&&(i=e.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");n=!!n,i=!!i}this.buffer=0===t?r:new ArrayBuffer(t),this.view=0===t?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=void 0!==n&&!!n,this.noAssert=!!i};e.VERSION="3.5.5",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var n=e.prototype,r=new ArrayBuffer(0),o=String.fromCharCode;function a(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function s(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+o.apply(String,t);t.length+arguments.length>1024&&(e.push(o.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}e.allocate=function(t,n,i){return new e(t,n,i)},e.concat=function(t,n,i,r){"boolean"!=typeof n&&"string"==typeof n||(r=i,i=n,n=void 0);for(var o,a=0,s=0,l=t.length;s<l;++s)e.isByteBuffer(t[s])||(t[s]=e.wrap(t[s],n)),(o=t[s].limit-t[s].offset)>0&&(a+=o);if(0===a)return new e(0,i,r);var c,u=new e(a,i,r),h=new Uint8Array(u.buffer);for(s=0;s<l;)(o=(c=t[s++]).limit-c.offset)<=0||(h.set(new Uint8Array(c.buffer).subarray(c.offset,c.limit),u.offset),u.offset+=o);return u.limit=u.offset,u.offset=0,u},e.isByteBuffer=function(t){return!0===(t&&t instanceof e)},e.type=function(){return ArrayBuffer},e.wrap=function(t,r,o,a){if("string"!=typeof r&&(a=o,o=r,r=void 0),"string"==typeof t)switch(void 0===r&&(r="utf8"),r){case"base64":return e.fromBase64(t,o);case"hex":return e.fromHex(t,o);case"binary":return e.fromBinary(t,o);case"utf8":return e.fromUTF8(t,o);case"debug":return e.fromDebug(t,o);default:throw Error("Unsupported encoding: "+r)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var s;if(e.isByteBuffer(t))return(s=n.clone.call(t)).markedOffset=-1,s;if(t instanceof Uint8Array)s=new e(0,o,a),t.length>0&&(s.buffer=t.buffer,s.offset=t.byteOffset,s.limit=t.byteOffset+t.length,s.view=t.length>0?new DataView(t.buffer):null);else if(t instanceof ArrayBuffer)s=new e(0,o,a),t.byteLength>0&&(s.buffer=t,s.offset=0,s.limit=t.byteLength,s.view=t.byteLength>0?new DataView(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");for((s=new e(t.length,o,a)).limit=t.length,i=0;i<t.length;++i)s.view.setUint8(i,t[i])}return s},n.writeInt8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=1,this.view.setInt8(e,t),n&&(this.offset+=1),this},n.writeByte=n.writeInt8,n.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view.getInt8(t);return e&&(this.offset+=1),n},n.readByte=n.readInt8,n.writeUint8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=1,this.view.setUint8(e,t),n&&(this.offset+=1),this},n.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view.getUint8(t);return e&&(this.offset+=1),n},n.writeInt16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.view.setInt16(e,t,this.littleEndian),n&&(this.offset+=2),this},n.writeShort=n.writeInt16,n.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=this.view.getInt16(t,this.littleEndian);return e&&(this.offset+=2),n},n.readShort=n.readInt16,n.writeUint16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.view.setUint16(e,t,this.littleEndian),n&&(this.offset+=2),this},n.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=this.view.getUint16(t,this.littleEndian);return e&&(this.offset+=2),n},n.writeInt32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setInt32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.writeInt=n.writeInt32,n.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getInt32(t,this.littleEndian);return e&&(this.offset+=4),n},n.readInt=n.readInt32,n.writeUint32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setUint32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getUint32(t,this.littleEndian);return e&&(this.offset+=4),n},t&&(n.writeInt64=function(e,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var r=this.buffer.byteLength;return n>r&&this.resize((r*=2)>n?r:n),n-=8,this.littleEndian?(this.view.setInt32(n,e.low,!0),this.view.setInt32(n+4,e.high,!0)):(this.view.setInt32(n,e.high,!1),this.view.setInt32(n+4,e.low,!1)),i&&(this.offset+=8),this},n.writeLong=n.writeInt64,n.readInt64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=this.littleEndian?new t(this.view.getInt32(e,!0),this.view.getInt32(e+4,!0),!1):new t(this.view.getInt32(e+4,!1),this.view.getInt32(e,!1),!1);return n&&(this.offset+=8),i},n.readLong=n.readInt64,n.writeUint64=function(e,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var r=this.buffer.byteLength;return n>r&&this.resize((r*=2)>n?r:n),n-=8,this.littleEndian?(this.view.setInt32(n,e.low,!0),this.view.setInt32(n+4,e.high,!0)):(this.view.setInt32(n,e.high,!1),this.view.setInt32(n+4,e.low,!1)),i&&(this.offset+=8),this},n.readUint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=this.littleEndian?new t(this.view.getInt32(e,!0),this.view.getInt32(e+4,!0),!0):new t(this.view.getInt32(e+4,!1),this.view.getInt32(e,!1),!0);return n&&(this.offset+=8),i}),n.writeFloat32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setFloat32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.writeFloat=n.writeFloat32,n.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getFloat32(t,this.littleEndian);return e&&(this.offset+=4),n},n.readFloat=n.readFloat32,n.writeFloat64=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=8,this.view.setFloat64(e,t,this.littleEndian),n&&(this.offset+=8),this},n.writeDouble=n.writeFloat64,n.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.view.getFloat64(t,this.littleEndian);return e&&(this.offset+=8),n},n.readDouble=n.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},n.writeVarint32=function(t,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var r,o=e.calculateVarint32(t);n+=o;var a=this.buffer.byteLength;return n>a&&this.resize((a*=2)>n?a:n),n-=o,this.view.setUint8(n,r=128|t),(t>>>=0)>=128?(r=t>>7|128,this.view.setUint8(n+1,r),t>=16384?(r=t>>14|128,this.view.setUint8(n+2,r),t>=1<<21?(r=t>>21|128,this.view.setUint8(n+3,r),t>=1<<28?(this.view.setUint8(n+4,t>>28&15),o=5):(this.view.setUint8(n+3,127&r),o=4)):(this.view.setUint8(n+2,127&r),o=3)):(this.view.setUint8(n+1,127&r),o=2)):(this.view.setUint8(n,127&r),o=1),i?(this.offset+=o,this):o},n.writeVarint32ZigZag=function(t,n){return this.writeVarint32(e.zigZagEncode32(t),n)},n.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i,r=0,o=0;do{if(i=t+r,!this.noAssert&&i>this.limit){var a=Error("Truncated");throw a.truncated=!0,a}n=this.view.getUint8(i),r<5&&(o|=(127&n)<<7*r>>>0),++r}while(128==(128&n));return o|=0,e?(this.offset+=r,o):{value:o,length:r}},n.readVarint32ZigZag=function(t){var n=this.readVarint32(t);return"object"==typeof n?n.value=e.zigZagDecode32(n.value):n=e.zigZagDecode32(n),n},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var n=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,r=e.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},n.writeVarint64=function(n,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof n)n=t.fromNumber(n);else if("string"==typeof n)n=t.fromString(n);else if(!(n&&n instanceof t))throw TypeError("Illegal value: "+n+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof n?n=t.fromNumber(n,!1):"string"==typeof n?n=t.fromString(n,!1):!1!==n.unsigned&&(n=n.toSigned());var o=e.calculateVarint64(n),a=n.toInt()>>>0,s=n.shiftRightUnsigned(28).toInt()>>>0,l=n.shiftRightUnsigned(56).toInt()>>>0;i+=o;var c=this.buffer.byteLength;switch(i>c&&this.resize((c*=2)>i?c:i),i-=o,o){case 10:this.view.setUint8(i+9,l>>>7&1);case 9:this.view.setUint8(i+8,9!==o?128|l:127&l);case 8:this.view.setUint8(i+7,8!==o?s>>>21|128:s>>>21&127);case 7:this.view.setUint8(i+6,7!==o?s>>>14|128:s>>>14&127);case 6:this.view.setUint8(i+5,6!==o?s>>>7|128:s>>>7&127);case 5:this.view.setUint8(i+4,5!==o?128|s:127&s);case 4:this.view.setUint8(i+3,4!==o?a>>>21|128:a>>>21&127);case 3:this.view.setUint8(i+2,3!==o?a>>>14|128:a>>>14&127);case 2:this.view.setUint8(i+1,2!==o?a>>>7|128:a>>>7&127);case 1:this.view.setUint8(i,1!==o?128|a:127&a)}return r?(this.offset+=o,this):o},n.writeVarint64ZigZag=function(t,n){return this.writeVarint64(e.zigZagEncode64(t),n)},n.readVarint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,r=0,o=0,a=0,s=0;if(r=127&(s=this.view.getUint8(e++)),128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<7,128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<14,128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<21,128&s&&(o=127&(s=this.view.getUint8(e++)),128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<7,128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<14,128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<21,128&s&&(a=127&(s=this.view.getUint8(e++)),128&s&&(a|=(127&(s=this.view.getUint8(e++)))<<7,128&s))))))))))throw Error("Buffer overrun");var l=t.fromBits(r|o<<28,o>>>4|a<<24,!1);return n?(this.offset=e,l):{value:l,length:e-i}},n.readVarint64ZigZag=function(n){var i=this.readVarint64(n);return i&&i.value instanceof t?i.value=e.zigZagDecode64(i.value):i=e.zigZagDecode64(i),i}),n.writeCString=function(t,e){var n=void 0===e;n&&(e=this.offset);var i,r=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(i=0;i<r;++i)if(0===t.charCodeAt(i))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}r=c.calculateUTF16asUTF8(a(t))[1],e+=r+1;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=r+1,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),this.view.setUint8(e++,0),n?(this.offset=e,this):r},n.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i=t,r=-1;return c.decodeUTF8toUTF16(function(){if(0===r)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(r=this.view.getUint8(t++))?null:r}.bind(this),n=s(),!0),e?(this.offset=t,n()):{string:n(),length:t-i}},n.writeIString=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i,r=e;i=c.calculateUTF16asUTF8(a(t),this.noAssert)[1],e+=4+i;var o=this.buffer.byteLength;if(e>o&&this.resize((o*=2)>e?o:e),e-=4+i,this.view.setUint32(e,i,this.littleEndian),e+=4,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),e!==r+4+i)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+i));return n?(this.offset=e,this):e-r},n.readIString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n,i,r=t;n=this.view.getUint32(t,this.littleEndian);var o,a=(t+=4)+n;return c.decodeUTF8toUTF16(function(){return t<a?this.view.getUint8(t++):null}.bind(this),o=s(),this.noAssert),i=o(),e?(this.offset=t,i):{string:i,length:t-r}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",n.writeUTF8String=function(t,e){var n,i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r=e;n=c.calculateUTF16asUTF8(a(t))[1],e+=n;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=n,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),i?(this.offset=e,this):e-r},n.writeString=n.writeUTF8String,e.calculateUTF8Chars=function(t){return c.calculateUTF16asUTF8(a(t))[0]},e.calculateUTF8Bytes=function(t){return c.calculateUTF16asUTF8(a(t))[1]},n.readUTF8String=function(t,n,i){"number"==typeof n&&(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),void 0===n&&(n=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,a=0,l=i;if(n===e.METRICS_CHARS){if(o=s(),c.decodeUTF8(function(){return a<t&&i<this.limit?this.view.getUint8(i++):null}.bind(this),function(t){++a,c.UTF8toUTF16(t,o)}.bind(this)),a!==t)throw RangeError("Illegal range: Truncated data, "+a+" == "+t);return r?(this.offset=i,o()):{string:o(),length:i-l}}if(n===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+"+t+") <= "+this.buffer.byteLength)}var u=i+t;if(c.decodeUTF8toUTF16(function(){return i<u?this.view.getUint8(i++):null}.bind(this),o=s(),this.noAssert),i!==u)throw RangeError("Illegal range: Truncated data, "+i+" == "+u);return r?(this.offset=i,o()):{string:o(),length:i-l}}throw TypeError("Unsupported metrics: "+n)},n.readString=n.readUTF8String,n.writeVString=function(t,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var r,o,s=n;r=c.calculateUTF16asUTF8(a(t),this.noAssert)[1],o=e.calculateVarint32(r),n+=o+r;var l=this.buffer.byteLength;if(n>l&&this.resize((l*=2)>n?l:n),n-=o+r,n+=this.writeVarint32(r,n),c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(n++,t)}.bind(this)),n!==s+r+o)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+r+o));return i?(this.offset=n,this):n-s},n.readVString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i=this.readVarint32(t),r=t;t+=i.length,i=i.value;var o=t+i,a=s();return c.decodeUTF8toUTF16(function(){return t<o?this.view.getUint8(t++):null}.bind(this),a,this.noAssert),n=a(),e?(this.offset=t,n):{string:n,length:t-r}},n.append=function(t,n,i){"number"!=typeof n&&"string"==typeof n||(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;i+=o;var a=this.buffer.byteLength;return i>a&&this.resize((a*=2)>i?a:i),i-=o,new Uint8Array(this.buffer,i).set(new Uint8Array(t.buffer).subarray(t.offset,t.limit)),t.offset+=o,r&&(this.offset+=o),this},n.appendTo=function(t,e){return t.append(this,e),this},n.assert=function(t){return this.noAssert=!t,this},n.capacity=function(){return this.buffer.byteLength},n.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},n.clone=function(t){var n=new e(0,this.littleEndian,this.noAssert);if(t){var i=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(i).set(this.buffer),n.buffer=i,n.view=new DataView(i)}else n.buffer=this.buffer,n.view=this.view;return n.offset=this.offset,n.markedOffset=this.markedOffset,n.limit=this.limit,n},n.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var n=e-t;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(t,e)),this.buffer=i,this.view=new DataView(i),this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=n,this},n.copy=function(t,n){if(void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(t===n)return new e(0,this.littleEndian,this.noAssert);var i=n-t,r=new e(i,this.littleEndian,this.noAssert);return r.offset=0,r.limit=i,r.markedOffset>=0&&(r.markedOffset-=t),this.copyTo(r,0,t,n),r},n.copyTo=function(t,n,i,r){var o,a;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(n=(a=void 0===n)?t.offset:0|n,i=(o=void 0===i)?this.offset:0|i,r=void 0===r?this.limit:0|r,n<0||n>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+n+" <= "+t.buffer.byteLength);if(i<0||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var s=r-i;return 0===s?t:(t.ensureCapacity(n+s),new Uint8Array(t.buffer).set(new Uint8Array(this.buffer).subarray(i,r),n),o&&(this.offset+=s),a&&(t.offset+=s),this)},n.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},n.fill=function(t,e,n){var i=void 0===e;if(i&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(e>=n)return this;for(;e<n;)this.view.setUint8(e++,t);return i&&(this.offset=e),this},n.flip=function(){return this.limit=this.offset,this.offset=0,this},n.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},n.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},n.LE=function(t){return this.littleEndian=void 0===t||!!t,this},n.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},n.prepend=function(t,n,i){"number"!=typeof n&&"string"==typeof n||(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;var a,s=o-i;if(s>0){var l=new ArrayBuffer(this.buffer.byteLength+s);(a=new Uint8Array(l)).set(new Uint8Array(this.buffer).subarray(i,this.buffer.byteLength),o),this.buffer=l,this.view=new DataView(l),this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,i+=s}else a=new Uint8Array(this.buffer);return a.set(new Uint8Array(t.buffer).subarray(t.offset,t.limit),i-o),t.offset=t.limit,r&&(this.offset-=o),this},n.prependTo=function(t,e){return t.prepend(this,e),this},n.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},n.remaining=function(){return this.limit-this.offset},n.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},n.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t);new Uint8Array(e).set(new Uint8Array(this.buffer)),this.buffer=e,this.view=new DataView(e)}return this},n.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(t,e)),this.view=new DataView(this.buffer),this)},n.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},n.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n=this.clone();return n.offset=t,n.limit=e,n},n.toBuffer=function(t){var e=this.offset,n=this.limit;if(e>n){var i=e;e=n,n=i}if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal limit: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(!t&&0===e&&n===this.buffer.byteLength)return this.buffer;if(e===n)return r;var o=new ArrayBuffer(n-e);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(e,n),0),o},n.toArrayBuffer=n.toBuffer,n.toString=function(t,e,n){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(n=e=t="utf8"),t){case"utf8":return this.toUTF8(e,n);case"base64":return this.toBase64(e,n);case"hex":return this.toHex(e,n);case"binary":return this.toBinary(e,n);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var l=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],n=[],i=0,r=e.length;i<r;++i)n[e[i]]=i;return t.encode=function(t,n){for(var i,r;null!==(i=t());)n(e[i>>2&63]),r=(3&i)<<4,null!==(i=t())?(n(e[63&((r|=i>>4&15)|i>>4&15)]),r=(15&i)<<2,null!==(i=t())?(n(e[63&(r|i>>6&3)]),n(e[63&i])):(n(e[63&r]),n(61))):(n(e[63&r]),n(61),n(61))},t.decode=function(t,e){var i,r,o;function a(t){throw Error("Illegal character code: "+t)}for(;null!==(i=t());)if(void 0===(r=n[i])&&a(i),null!==(i=t())&&(void 0===(o=n[i])&&a(i),e(r<<2>>>0|(48&o)>>4),null!==(i=t()))){if(void 0===(r=n[i])){if(61===i)break;a(i)}if(e((15&o)<<4>>>0|(60&r)>>2),null!==(i=t())){if(void 0===(o=n[i])){if(61===i)break;a(i)}e((3&r)<<6>>>0|o)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();n.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;return l.encode(function(){return t<e?this.view.getUint8(t++):null}.bind(this),n=s()),n()},e.fromBase64=function(t,n,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%4!=0)throw TypeError("Illegal str: Length not a multiple of 4")}var r=new e(t.length/4*3,n,i),o=0;return l.decode(a(t),(function(t){r.view.setUint8(o++,t)})),r.limit=o,r},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},n.toBinary=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return"";for(var n=[],i=[];t<e;)n.push(this.view.getUint8(t++)),n.length>=1024&&(i.push(String.fromCharCode.apply(String,n)),n=[]);return i.join("")+String.fromCharCode.apply(String,n)},e.fromBinary=function(t,n,i){if(!i&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");for(var r,o=0,a=t.length,s=new e(a,n,i);o<a;){if(r=t.charCodeAt(o),!i&&r>255)throw RangeError("Illegal charCode at "+o+": 0 <= "+r+" <= 255");s.view.setUint8(o++,r)}return s.limit=a,s},n.toDebug=function(t){for(var e,n=-1,i=this.buffer.byteLength,r="",o="",a="";n<i;){if(-1!==n&&(r+=(e=this.view.getUint8(n))<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=e>32&&e<127?String.fromCharCode(e):".")),++n,t&&n>0&&n%16==0&&n!==i){for(;r.length<51;)r+=" ";a+=r+o+"\n",r=o=""}n===this.offset&&n===this.limit?r+=n===this.markedOffset?"!":"|":n===this.offset?r+=n===this.markedOffset?"[":"<":n===this.limit?r+=n===this.markedOffset?"]":">":r+=n===this.markedOffset?"'":t||0!==n&&n!==i?" ":""}if(t&&" "!==r){for(;r.length<51;)r+=" ";a+=r+o+"\n"}return t?a:r},e.fromDebug=function(t,n,i){for(var r,o,a=t.length,s=new e((a+1)/3|0,n,i),l=0,c=0,u=!1,h=!1,f=!1,d=!1,p=!1;l<a;){switch(r=t.charAt(l++)){case"!":if(!i){if(h||f||d){p=!0;break}h=f=d=!0}s.offset=s.markedOffset=s.limit=c,u=!1;break;case"|":if(!i){if(h||d){p=!0;break}h=d=!0}s.offset=s.limit=c,u=!1;break;case"[":if(!i){if(h||f){p=!0;break}h=f=!0}s.offset=s.markedOffset=c,u=!1;break;case"<":if(!i){if(h){p=!0;break}h=!0}s.offset=c,u=!1;break;case"]":if(!i){if(d||f){p=!0;break}d=f=!0}s.limit=s.markedOffset=c,u=!1;break;case">":if(!i){if(d){p=!0;break}d=!0}s.limit=c,u=!1;break;case"'":if(!i){if(f){p=!0;break}f=!0}s.markedOffset=c,u=!1;break;case" ":u=!1;break;default:if(!i&&u){p=!0;break}if(o=parseInt(r+t.charAt(l++),16),!i&&(isNaN(o)||o<0||o>255))throw TypeError("Illegal str: Not a debug encoded string");s.view.setUint8(c++,o),u=!0}if(p)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!i){if(!h||!d)throw TypeError("Illegal str: Missing offset or limit");if(c<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+a)}return s},n.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var n,i=new Array(e-t);t<e;)(n=this.view.getUint8(t++))<16?i.push("0",n.toString(16)):i.push(n.toString(16));return i.join("")},e.fromHex=function(t,n,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var r,o=t.length,a=new e(o/2|0,n),s=0,l=0;s<o;s+=2){if(r=parseInt(t.substring(s,s+2),16),!i&&(!isFinite(r)||r<0||r>255))throw TypeError("Illegal str: Contains non-hex characters");a.view.setUint8(l++,r)}return a.limit=l,a};var c=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,i,r,o,a=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0==(128&n))e(n);else if(192==(224&n))null===(i=t())&&a([n,i]),e((31&n)<<6|63&i);else if(224==(240&n))(null===(i=t())||null===(r=t()))&&a([n,i,r]),e((15&n)<<12|(63&i)<<6|63&r);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(i=t())||null===(r=t())||null===(o=t()))&&a([n,i,r,o]),e((7&n)<<18|(63&i)<<12|(63&r)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var n,i=null;null!==(n=null!==i?i:t());)n>=55296&&n<=57343&&null!==(i=t())&&i>=56320&&i<=57343?(e(1024*(n-55296)+i-56320+65536),i=null):e(n);null!==i&&e(i)},UTF8toUTF16:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(e){for(var n,i=0;null!==(n=e());)i+=t.calculateCodePoint(n);return i},calculateUTF16asUTF8:function(e){var n=0,i=0;return t.UTF16toUTF8(e,(function(e){++n,i+=t.calculateCodePoint(e)})),[n,i]}};return t}();return n.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;try{c.decodeUTF8toUTF16(function(){return t<e?this.view.getUint8(t++):null}.bind(this),n=s())}catch(n){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return n()},e.fromUTF8=function(t,n,i){if(!i&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var r=new e(c.calculateUTF16asUTF8(a(t),!0)[1],n,i),o=0;return c.encodeUTF16toUTF8(a(t),(function(t){r.view.setUint8(o++,t)})),r.limit=o,r},e}t&&"object"==typeof e&&e?t.exports=function(){var t;try{t=n(233)}catch(t){}return s(t)}():(r=[n(234)],void 0===(o=function(t){return s(t)}.apply(e,r))||(t.exports=o))}()}).call(this,n(232)(t))},function(t,e,n){(function(t){var r,o;
/**
 * @license ByteBuffer.js (c) 2013-2014 Daniel Wirtz <dcode@dcode.io>
 * This version of ByteBuffer.js uses an ArrayBuffer as its backing buffer which is accessed through a DataView and is
 * compatible with modern browsers.
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/ByteBuffer.js for details
 */!function(a){"use strict";function s(t){var e=function(t,n,i){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===n&&(n=e.DEFAULT_ENDIAN),void 0===i&&(i=e.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");n=!!n,i=!!i}this.buffer=0===t?r:new ArrayBuffer(t),this.view=0===t?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=void 0!==n&&!!n,this.noAssert=!!i};e.VERSION="3.5.5",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var n=e.prototype,r=new ArrayBuffer(0),o=String.fromCharCode;function a(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function s(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+o.apply(String,t);t.length+arguments.length>1024&&(e.push(o.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}e.allocate=function(t,n,i){return new e(t,n,i)},e.concat=function(t,n,i,r){"boolean"!=typeof n&&"string"==typeof n||(r=i,i=n,n=void 0);for(var o,a=0,s=0,l=t.length;s<l;++s)e.isByteBuffer(t[s])||(t[s]=e.wrap(t[s],n)),(o=t[s].limit-t[s].offset)>0&&(a+=o);if(0===a)return new e(0,i,r);var c,u=new e(a,i,r),h=new Uint8Array(u.buffer);for(s=0;s<l;)(o=(c=t[s++]).limit-c.offset)<=0||(h.set(new Uint8Array(c.buffer).subarray(c.offset,c.limit),u.offset),u.offset+=o);return u.limit=u.offset,u.offset=0,u},e.isByteBuffer=function(t){return!0===(t&&t instanceof e)},e.type=function(){return ArrayBuffer},e.wrap=function(t,r,o,a){if("string"!=typeof r&&(a=o,o=r,r=void 0),"string"==typeof t)switch(void 0===r&&(r="utf8"),r){case"base64":return e.fromBase64(t,o);case"hex":return e.fromHex(t,o);case"binary":return e.fromBinary(t,o);case"utf8":return e.fromUTF8(t,o);case"debug":return e.fromDebug(t,o);default:throw Error("Unsupported encoding: "+r)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var s;if(e.isByteBuffer(t))return(s=n.clone.call(t)).markedOffset=-1,s;if(t instanceof Uint8Array)s=new e(0,o,a),t.length>0&&(s.buffer=t.buffer,s.offset=t.byteOffset,s.limit=t.byteOffset+t.length,s.view=t.length>0?new DataView(t.buffer):null);else if(t instanceof ArrayBuffer)s=new e(0,o,a),t.byteLength>0&&(s.buffer=t,s.offset=0,s.limit=t.byteLength,s.view=t.byteLength>0?new DataView(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");for((s=new e(t.length,o,a)).limit=t.length,i=0;i<t.length;++i)s.view.setUint8(i,t[i])}return s},n.writeInt8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=1,this.view.setInt8(e,t),n&&(this.offset+=1),this},n.writeByte=n.writeInt8,n.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view.getInt8(t);return e&&(this.offset+=1),n},n.readByte=n.readInt8,n.writeUint8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=1,this.view.setUint8(e,t),n&&(this.offset+=1),this},n.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view.getUint8(t);return e&&(this.offset+=1),n},n.writeInt16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.view.setInt16(e,t,this.littleEndian),n&&(this.offset+=2),this},n.writeShort=n.writeInt16,n.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=this.view.getInt16(t,this.littleEndian);return e&&(this.offset+=2),n},n.readShort=n.readInt16,n.writeUint16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.view.setUint16(e,t,this.littleEndian),n&&(this.offset+=2),this},n.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=this.view.getUint16(t,this.littleEndian);return e&&(this.offset+=2),n},n.writeInt32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setInt32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.writeInt=n.writeInt32,n.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getInt32(t,this.littleEndian);return e&&(this.offset+=4),n},n.readInt=n.readInt32,n.writeUint32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setUint32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getUint32(t,this.littleEndian);return e&&(this.offset+=4),n},t&&(n.writeInt64=function(e,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var r=this.buffer.byteLength;return n>r&&this.resize((r*=2)>n?r:n),n-=8,this.littleEndian?(this.view.setInt32(n,e.low,!0),this.view.setInt32(n+4,e.high,!0)):(this.view.setInt32(n,e.high,!1),this.view.setInt32(n+4,e.low,!1)),i&&(this.offset+=8),this},n.writeLong=n.writeInt64,n.readInt64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=this.littleEndian?new t(this.view.getInt32(e,!0),this.view.getInt32(e+4,!0),!1):new t(this.view.getInt32(e+4,!1),this.view.getInt32(e,!1),!1);return n&&(this.offset+=8),i},n.readLong=n.readInt64,n.writeUint64=function(e,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var r=this.buffer.byteLength;return n>r&&this.resize((r*=2)>n?r:n),n-=8,this.littleEndian?(this.view.setInt32(n,e.low,!0),this.view.setInt32(n+4,e.high,!0)):(this.view.setInt32(n,e.high,!1),this.view.setInt32(n+4,e.low,!1)),i&&(this.offset+=8),this},n.readUint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=this.littleEndian?new t(this.view.getInt32(e,!0),this.view.getInt32(e+4,!0),!0):new t(this.view.getInt32(e+4,!1),this.view.getInt32(e,!1),!0);return n&&(this.offset+=8),i}),n.writeFloat32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.view.setFloat32(e,t,this.littleEndian),n&&(this.offset+=4),this},n.writeFloat=n.writeFloat32,n.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=this.view.getFloat32(t,this.littleEndian);return e&&(this.offset+=4),n},n.readFloat=n.readFloat32,n.writeFloat64=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=8,this.view.setFloat64(e,t,this.littleEndian),n&&(this.offset+=8),this},n.writeDouble=n.writeFloat64,n.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.view.getFloat64(t,this.littleEndian);return e&&(this.offset+=8),n},n.readDouble=n.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},n.writeVarint32=function(t,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var r,o=e.calculateVarint32(t);n+=o;var a=this.buffer.byteLength;return n>a&&this.resize((a*=2)>n?a:n),n-=o,this.view.setUint8(n,r=128|t),(t>>>=0)>=128?(r=t>>7|128,this.view.setUint8(n+1,r),t>=16384?(r=t>>14|128,this.view.setUint8(n+2,r),t>=1<<21?(r=t>>21|128,this.view.setUint8(n+3,r),t>=1<<28?(this.view.setUint8(n+4,t>>28&15),o=5):(this.view.setUint8(n+3,127&r),o=4)):(this.view.setUint8(n+2,127&r),o=3)):(this.view.setUint8(n+1,127&r),o=2)):(this.view.setUint8(n,127&r),o=1),i?(this.offset+=o,this):o},n.writeVarint32ZigZag=function(t,n){return this.writeVarint32(e.zigZagEncode32(t),n)},n.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i,r=0,o=0;do{if(i=t+r,!this.noAssert&&i>this.limit){var a=Error("Truncated");throw a.truncated=!0,a}n=this.view.getUint8(i),r<5&&(o|=(127&n)<<7*r>>>0),++r}while(128==(128&n));return o|=0,e?(this.offset+=r,o):{value:o,length:r}},n.readVarint32ZigZag=function(t){var n=this.readVarint32(t);return"object"==typeof n?n.value=e.zigZagDecode32(n.value):n=e.zigZagDecode32(n),n},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var n=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,r=e.shiftRightUnsigned(56).toInt()>>>0;return 0==r?0==i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},n.writeVarint64=function(n,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof n)n=t.fromNumber(n);else if("string"==typeof n)n=t.fromString(n);else if(!(n&&n instanceof t))throw TypeError("Illegal value: "+n+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof n?n=t.fromNumber(n,!1):"string"==typeof n?n=t.fromString(n,!1):!1!==n.unsigned&&(n=n.toSigned());var o=e.calculateVarint64(n),a=n.toInt()>>>0,s=n.shiftRightUnsigned(28).toInt()>>>0,l=n.shiftRightUnsigned(56).toInt()>>>0;i+=o;var c=this.buffer.byteLength;switch(i>c&&this.resize((c*=2)>i?c:i),i-=o,o){case 10:this.view.setUint8(i+9,l>>>7&1);case 9:this.view.setUint8(i+8,9!==o?128|l:127&l);case 8:this.view.setUint8(i+7,8!==o?s>>>21|128:s>>>21&127);case 7:this.view.setUint8(i+6,7!==o?s>>>14|128:s>>>14&127);case 6:this.view.setUint8(i+5,6!==o?s>>>7|128:s>>>7&127);case 5:this.view.setUint8(i+4,5!==o?128|s:127&s);case 4:this.view.setUint8(i+3,4!==o?a>>>21|128:a>>>21&127);case 3:this.view.setUint8(i+2,3!==o?a>>>14|128:a>>>14&127);case 2:this.view.setUint8(i+1,2!==o?a>>>7|128:a>>>7&127);case 1:this.view.setUint8(i,1!==o?128|a:127&a)}return r?(this.offset+=o,this):o},n.writeVarint64ZigZag=function(t,n){return this.writeVarint64(e.zigZagEncode64(t),n)},n.readVarint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,r=0,o=0,a=0,s=0;if(r=127&(s=this.view.getUint8(e++)),128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<7,128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<14,128&s&&(r|=(127&(s=this.view.getUint8(e++)))<<21,128&s&&(o=127&(s=this.view.getUint8(e++)),128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<7,128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<14,128&s&&(o|=(127&(s=this.view.getUint8(e++)))<<21,128&s&&(a=127&(s=this.view.getUint8(e++)),128&s&&(a|=(127&(s=this.view.getUint8(e++)))<<7,128&s))))))))))throw Error("Buffer overrun");var l=t.fromBits(r|o<<28,o>>>4|a<<24,!1);return n?(this.offset=e,l):{value:l,length:e-i}},n.readVarint64ZigZag=function(n){var i=this.readVarint64(n);return i&&i.value instanceof t?i.value=e.zigZagDecode64(i.value):i=e.zigZagDecode64(i),i}),n.writeCString=function(t,e){var n=void 0===e;n&&(e=this.offset);var i,r=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(i=0;i<r;++i)if(0===t.charCodeAt(i))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}r=c.calculateUTF16asUTF8(a(t))[1],e+=r+1;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=r+1,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),this.view.setUint8(e++,0),n?(this.offset=e,this):r},n.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i=t,r=-1;return c.decodeUTF8toUTF16(function(){if(0===r)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(r=this.view.getUint8(t++))?null:r}.bind(this),n=s(),!0),e?(this.offset=t,n()):{string:n(),length:t-i}},n.writeIString=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i,r=e;i=c.calculateUTF16asUTF8(a(t),this.noAssert)[1],e+=4+i;var o=this.buffer.byteLength;if(e>o&&this.resize((o*=2)>e?o:e),e-=4+i,this.view.setUint32(e,i,this.littleEndian),e+=4,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),e!==r+4+i)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+i));return n?(this.offset=e,this):e-r},n.readIString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n,i,r=t;n=this.view.getUint32(t,this.littleEndian);var o,a=(t+=4)+n;return c.decodeUTF8toUTF16(function(){return t<a?this.view.getUint8(t++):null}.bind(this),o=s(),this.noAssert),i=o(),e?(this.offset=t,i):{string:i,length:t-r}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",n.writeUTF8String=function(t,e){var n,i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r=e;n=c.calculateUTF16asUTF8(a(t))[1],e+=n;var o=this.buffer.byteLength;return e>o&&this.resize((o*=2)>e?o:e),e-=n,c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(e++,t)}.bind(this)),i?(this.offset=e,this):e-r},n.writeString=n.writeUTF8String,e.calculateUTF8Chars=function(t){return c.calculateUTF16asUTF8(a(t))[0]},e.calculateUTF8Bytes=function(t){return c.calculateUTF16asUTF8(a(t))[1]},n.readUTF8String=function(t,n,i){"number"==typeof n&&(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),void 0===n&&(n=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,a=0,l=i;if(n===e.METRICS_CHARS){if(o=s(),c.decodeUTF8(function(){return a<t&&i<this.limit?this.view.getUint8(i++):null}.bind(this),function(t){++a,c.UTF8toUTF16(t,o)}.bind(this)),a!==t)throw RangeError("Illegal range: Truncated data, "+a+" == "+t);return r?(this.offset=i,o()):{string:o(),length:i-l}}if(n===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+"+t+") <= "+this.buffer.byteLength)}var u=i+t;if(c.decodeUTF8toUTF16(function(){return i<u?this.view.getUint8(i++):null}.bind(this),o=s(),this.noAssert),i!==u)throw RangeError("Illegal range: Truncated data, "+i+" == "+u);return r?(this.offset=i,o()):{string:o(),length:i-l}}throw TypeError("Unsupported metrics: "+n)},n.readString=n.readUTF8String,n.writeVString=function(t,n){var i=void 0===n;if(i&&(n=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var r,o,s=n;r=c.calculateUTF16asUTF8(a(t),this.noAssert)[1],o=e.calculateVarint32(r),n+=o+r;var l=this.buffer.byteLength;if(n>l&&this.resize((l*=2)>n?l:n),n-=o+r,n+=this.writeVarint32(r,n),c.encodeUTF16toUTF8(a(t),function(t){this.view.setUint8(n++,t)}.bind(this)),n!==s+r+o)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+r+o));return i?(this.offset=n,this):n-s},n.readVString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,i=this.readVarint32(t),r=t;t+=i.length,i=i.value;var o=t+i,a=s();return c.decodeUTF8toUTF16(function(){return t<o?this.view.getUint8(t++):null}.bind(this),a,this.noAssert),n=a(),e?(this.offset=t,n):{string:n,length:t-r}},n.append=function(t,n,i){"number"!=typeof n&&"string"==typeof n||(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;i+=o;var a=this.buffer.byteLength;return i>a&&this.resize((a*=2)>i?a:i),i-=o,new Uint8Array(this.buffer,i).set(new Uint8Array(t.buffer).subarray(t.offset,t.limit)),t.offset+=o,r&&(this.offset+=o),this},n.appendTo=function(t,e){return t.append(this,e),this},n.assert=function(t){return this.noAssert=!t,this},n.capacity=function(){return this.buffer.byteLength},n.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},n.clone=function(t){var n=new e(0,this.littleEndian,this.noAssert);if(t){var i=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(i).set(this.buffer),n.buffer=i,n.view=new DataView(i)}else n.buffer=this.buffer,n.view=this.view;return n.offset=this.offset,n.markedOffset=this.markedOffset,n.limit=this.limit,n},n.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var n=e-t;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(t,e)),this.buffer=i,this.view=new DataView(i),this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=n,this},n.copy=function(t,n){if(void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(t===n)return new e(0,this.littleEndian,this.noAssert);var i=n-t,r=new e(i,this.littleEndian,this.noAssert);return r.offset=0,r.limit=i,r.markedOffset>=0&&(r.markedOffset-=t),this.copyTo(r,0,t,n),r},n.copyTo=function(t,n,i,r){var o,a;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(n=(a=void 0===n)?t.offset:0|n,i=(o=void 0===i)?this.offset:0|i,r=void 0===r?this.limit:0|r,n<0||n>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+n+" <= "+t.buffer.byteLength);if(i<0||r>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var s=r-i;return 0===s?t:(t.ensureCapacity(n+s),new Uint8Array(t.buffer).set(new Uint8Array(this.buffer).subarray(i,r),n),o&&(this.offset+=s),a&&(t.offset+=s),this)},n.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},n.fill=function(t,e,n){var i=void 0===e;if(i&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(e>=n)return this;for(;e<n;)this.view.setUint8(e++,t);return i&&(this.offset=e),this},n.flip=function(){return this.limit=this.offset,this.offset=0,this},n.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},n.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},n.LE=function(t){return this.littleEndian=void 0===t||!!t,this},n.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},n.prepend=function(t,n,i){"number"!=typeof n&&"string"==typeof n||(i=n,n=void 0);var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;var a,s=o-i;if(s>0){var l=new ArrayBuffer(this.buffer.byteLength+s);(a=new Uint8Array(l)).set(new Uint8Array(this.buffer).subarray(i,this.buffer.byteLength),o),this.buffer=l,this.view=new DataView(l),this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,i+=s}else a=new Uint8Array(this.buffer);return a.set(new Uint8Array(t.buffer).subarray(t.offset,t.limit),i-o),t.offset=t.limit,r&&(this.offset-=o),this},n.prependTo=function(t,e){return t.prepend(this,e),this},n.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},n.remaining=function(){return this.limit-this.offset},n.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},n.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t);new Uint8Array(e).set(new Uint8Array(this.buffer)),this.buffer=e,this.view=new DataView(e)}return this},n.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(t,e)),this.view=new DataView(this.buffer),this)},n.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},n.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n=this.clone();return n.offset=t,n.limit=e,n},n.toBuffer=function(t){var e=this.offset,n=this.limit;if(e>n){var i=e;e=n,n=i}if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal limit: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(!t&&0===e&&n===this.buffer.byteLength)return this.buffer;if(e===n)return r;var o=new ArrayBuffer(n-e);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(e,n),0),o},n.toArrayBuffer=n.toBuffer,n.toString=function(t,e,n){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(n=e=t="utf8"),t){case"utf8":return this.toUTF8(e,n);case"base64":return this.toBase64(e,n);case"hex":return this.toHex(e,n);case"binary":return this.toBinary(e,n);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var l=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],n=[],i=0,r=e.length;i<r;++i)n[e[i]]=i;return t.encode=function(t,n){for(var i,r;null!==(i=t());)n(e[i>>2&63]),r=(3&i)<<4,null!==(i=t())?(n(e[63&((r|=i>>4&15)|i>>4&15)]),r=(15&i)<<2,null!==(i=t())?(n(e[63&(r|i>>6&3)]),n(e[63&i])):(n(e[63&r]),n(61))):(n(e[63&r]),n(61),n(61))},t.decode=function(t,e){var i,r,o;function a(t){throw Error("Illegal character code: "+t)}for(;null!==(i=t());)if(void 0===(r=n[i])&&a(i),null!==(i=t())&&(void 0===(o=n[i])&&a(i),e(r<<2>>>0|(48&o)>>4),null!==(i=t()))){if(void 0===(r=n[i])){if(61===i)break;a(i)}if(e((15&o)<<4>>>0|(60&r)>>2),null!==(i=t())){if(void 0===(o=n[i])){if(61===i)break;a(i)}e((3&r)<<6>>>0|o)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();n.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;return l.encode(function(){return t<e?this.view.getUint8(t++):null}.bind(this),n=s()),n()},e.fromBase64=function(t,n,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%4!=0)throw TypeError("Illegal str: Length not a multiple of 4")}var r=new e(t.length/4*3,n,i),o=0;return l.decode(a(t),(function(t){r.view.setUint8(o++,t)})),r.limit=o,r},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},n.toBinary=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return"";for(var n=[],i=[];t<e;)n.push(this.view.getUint8(t++)),n.length>=1024&&(i.push(String.fromCharCode.apply(String,n)),n=[]);return i.join("")+String.fromCharCode.apply(String,n)},e.fromBinary=function(t,n,i){if(!i&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");for(var r,o=0,a=t.length,s=new e(a,n,i);o<a;){if(r=t.charCodeAt(o),!i&&r>255)throw RangeError("Illegal charCode at "+o+": 0 <= "+r+" <= 255");s.view.setUint8(o++,r)}return s.limit=a,s},n.toDebug=function(t){for(var e,n=-1,i=this.buffer.byteLength,r="",o="",a="";n<i;){if(-1!==n&&(r+=(e=this.view.getUint8(n))<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=e>32&&e<127?String.fromCharCode(e):".")),++n,t&&n>0&&n%16==0&&n!==i){for(;r.length<51;)r+=" ";a+=r+o+"\n",r=o=""}n===this.offset&&n===this.limit?r+=n===this.markedOffset?"!":"|":n===this.offset?r+=n===this.markedOffset?"[":"<":n===this.limit?r+=n===this.markedOffset?"]":">":r+=n===this.markedOffset?"'":t||0!==n&&n!==i?" ":""}if(t&&" "!==r){for(;r.length<51;)r+=" ";a+=r+o+"\n"}return t?a:r},e.fromDebug=function(t,n,i){for(var r,o,a=t.length,s=new e((a+1)/3|0,n,i),l=0,c=0,u=!1,h=!1,f=!1,d=!1,p=!1;l<a;){switch(r=t.charAt(l++)){case"!":if(!i){if(h||f||d){p=!0;break}h=f=d=!0}s.offset=s.markedOffset=s.limit=c,u=!1;break;case"|":if(!i){if(h||d){p=!0;break}h=d=!0}s.offset=s.limit=c,u=!1;break;case"[":if(!i){if(h||f){p=!0;break}h=f=!0}s.offset=s.markedOffset=c,u=!1;break;case"<":if(!i){if(h){p=!0;break}h=!0}s.offset=c,u=!1;break;case"]":if(!i){if(d||f){p=!0;break}d=f=!0}s.limit=s.markedOffset=c,u=!1;break;case">":if(!i){if(d){p=!0;break}d=!0}s.limit=c,u=!1;break;case"'":if(!i){if(f){p=!0;break}f=!0}s.markedOffset=c,u=!1;break;case" ":u=!1;break;default:if(!i&&u){p=!0;break}if(o=parseInt(r+t.charAt(l++),16),!i&&(isNaN(o)||o<0||o>255))throw TypeError("Illegal str: Not a debug encoded string");s.view.setUint8(c++,o),u=!0}if(p)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!i){if(!h||!d)throw TypeError("Illegal str: Missing offset or limit");if(c<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+a)}return s},n.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var n,i=new Array(e-t);t<e;)(n=this.view.getUint8(t++))<16?i.push("0",n.toString(16)):i.push(n.toString(16));return i.join("")},e.fromHex=function(t,n,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var r,o=t.length,a=new e(o/2|0,n),s=0,l=0;s<o;s+=2){if(r=parseInt(t.substring(s,s+2),16),!i&&(!isFinite(r)||r<0||r>255))throw TypeError("Illegal str: Contains non-hex characters");a.view.setUint8(l++,r)}return a.limit=l,a};var c=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,i,r,o,a=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0==(128&n))e(n);else if(192==(224&n))null===(i=t())&&a([n,i]),e((31&n)<<6|63&i);else if(224==(240&n))(null===(i=t())||null===(r=t()))&&a([n,i,r]),e((15&n)<<12|(63&i)<<6|63&r);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(i=t())||null===(r=t())||null===(o=t()))&&a([n,i,r,o]),e((7&n)<<18|(63&i)<<12|(63&r)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var n,i=null;null!==(n=null!==i?i:t());)n>=55296&&n<=57343&&null!==(i=t())&&i>=56320&&i<=57343?(e(1024*(n-55296)+i-56320+65536),i=null):e(n);null!==i&&e(i)},UTF8toUTF16:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(e){for(var n,i=0;null!==(n=e());)i+=t.calculateCodePoint(n);return i},calculateUTF16asUTF8:function(e){var n=0,i=0;return t.UTF16toUTF8(e,(function(e){++n,i+=t.calculateCodePoint(e)})),[n,i]}};return t}();return n.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;try{c.decodeUTF8toUTF16(function(){return t<e?this.view.getUint8(t++):null}.bind(this),n=s())}catch(n){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return n()},e.fromUTF8=function(t,n,i){if(!i&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var r=new e(c.calculateUTF16asUTF8(a(t),!0)[1],n,i),o=0;return c.encodeUTF16toUTF8(a(t),(function(t){r.view.setUint8(o++,t)})),r.limit=o,r},e}t&&"object"==typeof e&&e?t.exports=function(){var t;try{t=n(233)}catch(t){}return s(t)}():(r=[n(234)],void 0===(o=function(t){return s(t)}.apply(e,r))||(t.exports=o))}()}).call(this,n(232)(t))},function(t,e,n){"use strict";n.r(e);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="transform",this.type="Transform",n}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.init=function(){return i.prototype.init.call(this),this},Object.defineProperty(o.prototype,"position",{set:function(t){this.entity.object3D.position=t},get:function(){return this.entity.object3D.position},enumerable:!0}),Object.defineProperty(o.prototype,"scale",{set:function(t){this.entity.object3D.scale=t},get:function(){return this.entity.object3D.scale},enumerable:!0}),Object.defineProperty(o.prototype,"rotation",{set:function(t){this.entity.object3D.rotation=t},get:function(){return this.entity.object3D.rotation},enumerable:!0}),e.default=r("transform",o)},function(t,e,n){t.exports=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return i.colors[Math.abs(e)%i.colors.length]}function i(t){let n;function a(...t){if(!a.enabled)return;const e=a,r=Number(new Date),o=r-(n||r);e.diff=o,e.prev=n,e.curr=r,n=r,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let s=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(n,r)=>{if("%%"===n)return n;s++;const o=i.formatters[r];if("function"==typeof o){const i=t[s];n=o.call(e,i),t.splice(s,1),s--}return n}),i.formatArgs.call(e,t),(e.log||i.log).apply(e,t)}return a.namespace=t,a.enabled=i.enabled(t),a.useColors=i.useColors(),a.color=e(t),a.destroy=r,a.extend=o,"function"==typeof i.init&&i.init(a),i.instances.push(a),a}function r(){const t=i.instances.indexOf(this);return-1!==t&&(i.instances.splice(t,1),!0)}function o(t,e){const n=i(this.namespace+(void 0===e?":":e)+t);return n.log=this.log,n}function a(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},i.disable=function(){const t=[...i.names.map(a),...i.skips.map(a).map(t=>"-"+t)].join(",");return i.enable(""),t},i.enable=function(t){let e;i.save(t),i.names=[],i.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length;for(e=0;e<r;e++)n[e]&&("-"===(t=n[e].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+t.substr(1)+"$")):i.names.push(new RegExp("^"+t+"$")));for(e=0;e<i.instances.length;e++){const t=i.instances[e];t.enabled=i.enabled(t.namespace)}},i.enabled=function(t){if("*"===t[t.length-1])return!0;let e,n;for(e=0,n=i.skips.length;e<n;e++)if(i.skips[e].test(t))return!1;for(e=0,n=i.names.length;e<n;e++)if(i.names[e].test(t))return!0;return!1},i.humanize=n(510),Object.keys(t).forEach(e=>{i[e]=t[e]}),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=e,i.enable(i.load()),i}},function(t,e){var n=1e3,i=6e4,r=36e5,o=24*r;function a(t,e,n,i){var r=e>=1.5*n;return Math.round(t/n)+" "+i+(r?"s":"")}t.exports=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===s&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=o)return a(t,e,o,"day");if(e>=r)return a(t,e,r,"hour");if(e>=i)return a(t,e,i,"minute");if(e>=n)return a(t,e,n,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=o)return Math.round(t/o)+"d";if(e>=r)return Math.round(t/r)+"h";if(e>=i)return Math.round(t/i)+"m";if(e>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){"use strict";var i=n(512),r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Sources cannot be null or undefined");return Object(t)}function s(t,e,n){var o=e[n];if(null!=o){if(r.call(t,n)&&(void 0===t[n]||null===t[n]))throw new TypeError("Cannot convert undefined or null to object ("+n+")");r.call(t,n)&&i(o)?t[n]=l(Object(t[n]),e[n]):t[n]=o}}function l(t,e){if(t===e)return t;for(var n in e=Object(e))r.call(e,n)&&s(t,e,n);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),a=0;a<i.length;a++)o.call(e,i[a])&&s(t,e,i[a]);return t}t.exports=function(t){t=a(t);for(var e=1;e<arguments.length;e++)l(t,arguments[e]);return t}},function(t,e,n){"use strict";t.exports=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}},function(t,e,n){(function(e){var i,r=n(235)("device:error"),o=!1,a=!1,s=t.exports.isWebXRAvailable=!window.debug&&void 0!==navigator.xr;if(window.addEventListener("vrdisplayactivate",(function(t){var e;s||(e=document.createElement("canvas"),i=t.display,e.getContext("webgl",{}),i.requestPresent([{source:e}]).then((function(){}),(function(){})))})),s){function l(){}navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then((function(t){o=t})).catch(l),navigator.xr.isSessionSupported("immersive-ar").then((function(t){a=t})).catch((function(){}))):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then((function(){o=!0})).catch(l),navigator.xr.supportsSession("immersive-ar").then((function(){a=!0})).catch((function(){}))):r("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then((function(t){}));function c(){return i}t.exports.getVRDisplay=c,t.exports.checkHeadsetConnected=function(){return o||a||!!c()},t.exports.checkARSupport=function(){return a};var u,h,f=(h=!1,u=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4)))&&(h=!0),(p()||d()||y())&&(h=!0),v()&&(h=!1),function(){return h});function d(t){var e=t||window.navigator.userAgent;return/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(e)}function p(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function m(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function g(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function v(){return m()||g()}function y(){return/R7 Build/.test(window.navigator.userAgent)}t.exports.isMobile=f,t.exports.isTablet=d,t.exports.isIOS=p,t.exports.isMobileDeviceRequestingDesktopSite=function(){return!f()&&!v()&&void 0!==window.orientation},t.exports.isOculusBrowser=m,t.exports.isFirefoxReality=g,t.exports.isMobileVR=v,t.exports.isR7=y,t.exports.isLandscape=function(){var t=window.orientation;return y()&&(t+=90),90===t||-90===t},t.exports.isBrowserEnvironment=!(e&&!e.browser),t.exports.isNodeEnvironment=!t.exports.isBrowserEnvironment}).call(this,n(126))},function(t,e){var n=Object.freeze(Object.create(null));function i(){return{}}function r(t){var e;if(t&&t.constructor===Object)for(e in t)t[e]=void 0}t.exports.createPool=function(t){var e=[],o=null;function a(n){var i,r;if((n=void 0===n?e.length:n)>0&&null==o&&(o=0),n>0)for(i=e.length,e.length+=Number(n),r=i;r<e.length;r++)e[r]=t();return e.length}return t=t||i,{grow:a,pool:e,recycle:function(t){t instanceof Object&&(null!==o&&-1!==o?e[--o]=t:e[e.length]=t)},size:function(){return e.length},use:function(){var t;return null!==o&&o!==e.length||a(e.length||5),t=e[o],e[o++]=n,r(t),t}}},t.exports.clearObject=r,t.exports.removeUnusedKeys=function(t,e){var n;if(t&&t.constructor===Object)for(n in t)n in e||delete t[n]}},function(t,e){t.exports=function(t,e){return n=Array.prototype.slice.call(arguments,2),function(){var i=n.concat(Array.prototype.slice.call(arguments,0));return t.apply(e,i)};var n}},function(t,e,n){(function(e){var i=n(184),r=n(185),o=i("utils:coordinates:warn"),a=["x","y","z","w"],s=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;t.exports.regex=s;var l=/\s+/g;function c(t){return s.test(t)}function u(t){return null!=t&&t.constructor===String?parseFloat(t,10):t}t.exports.parse=function(t,e){var n,i,o,s,c,h,f,d,p;if(t&&t instanceof Object)return h=void 0===t.x?e&&e.x:t.x,f=void 0===t.y?e&&e.y:t.y,d=void 0===t.z?e&&e.z:t.z,p=void 0===t.w?e&&e.w:t.w,null!=h&&(t.x=u(h)),null!=f&&(t.y=u(f)),null!=d&&(t.z=u(d)),null!=p&&(t.w=u(p)),t;if(null==t)return"object"==typeof e?r({},e):e;for(n=t.trim().split(l),c={},s=0;s<a.length;s++)if(o=a[s],n[s])c[o]=parseFloat(n[s],10);else{if(void 0===(i=e&&e[o]))continue;c[o]=u(i)}return c},t.exports.stringify=function(t){var e;return"object"!=typeof t?t:(e=t.x+" "+t.y,null!=t.z&&(e+=" "+t.z),null!=t.w&&(e+=" "+t.w),e)},t.exports.isCoordinates=c,t.exports.isCoordinate=function(t){return o("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),c(t)},t.exports.toVector3=function(t){return new e.Vector3(t.x,t.y,t.z)}}).call(this,n(0))},function(t,e){var n;t.exports.split=(n={},function(t,e){return e in n||(n[e]={}),t in n[e]?n[e][t]:(n[e][t]=t.split(e),n[e][t])})},function(t,e){var n=/-([a-z])/g;function i(t){return t.replace(n,l)}function r(t){var e,n;for(n in t)n!==(e=i(n))&&(t[e]=t[n],delete t[n]);return t}t.exports.parse=function(t,e){var n;return"string"!=typeof t?t:(n=function(t,e){var n,i,r,o,a,l;for(e=e||{},n=s(t),i=0;i<n.length;i++)(r=n[i])&&(o=r.indexOf(":"),a=r.substr(0,o).trim(),l=r.substr(o+1).trim(),e[a]=l);return e}(t,e))[""]?t:r(n)},t.exports.stringify=function(t){return"string"==typeof t?t:function(t){var e,n=0,i=0,r="";for(e in t)n++;for(e in t)r+=e+": "+t[e],i<n-1&&(r+="; "),i++;return r}(t)},t.exports.toCamelCase=i,t.exports.transformKeysToCamelCase=r;var o,a,s=(o=[],a=/url\([^)]+$/,function(t){var e,n="",i=0;for(o.length=0;i<t.length;)-1===(e=t.indexOf(";",i))&&(e=t.length),n+=t.substring(i,e),a.test(n)?(n+=";",i=e+1):(o.push(n.trim()),n="",i=e+1);return o});function l(t){return t[1].toUpperCase()}},function(t,e,n){var i=n(184)("utils:src-loader:warn");function r(t,e,n){!function(t,e){var n;if(t.tagName)return void e("IMG"===t.tagName);(n=new XMLHttpRequest).open("HEAD",t),n.addEventListener("load",(function(i){var r;n.status>=200&&n.status<300?null==(r=n.getResponseHeader("Content-Type"))?a(t,e):r.startsWith("image")?e(!0):e(!1):a(t,e),n.abort()})),n.send()}(t,(function(i){i?e(t):n(t)}))}function o(t){var e=t.match(/\url\((.+)\)/);if(e)return e[1]}function a(t,e){var n=new Image;n.addEventListener("load",(function(){e(!0)})),n.addEventListener("error",(function(){e(!1)})),n.src=t}t.exports={parseUrl:o,validateSrc:r,validateCubemapSrc:function(t,e){var n,a,s,l="",c=[];for(a=0;a<5;a++)l+="(url\\((?:[^\\)]+)\\),\\s*)";function u(t){c.push(t),6===c.length&&e(c)}if(l+="(url\\((?:[^\\)]+)\\)\\s*)",s=t.match(new RegExp(l)))for(a=1;a<7;a++)r(o(s[a]),u);else if(n=function(t){try{var e=document.querySelector(t);return e||i('No element was found matching the selector: "%s"',t),e}catch(e){return void i('"%s" is not a valid selector',t)}}(t))return"A-CUBEMAP"===n.tagName&&n.srcs?e(n.srcs):void i('Selector "%s" does not point to <a-cubemap>',t)}}},function(t,e,n){"use strict";n.r(e),function(t){var i=n(4),r=n(5).Component,o=n(5).registerComponent,a=function(e,n){var i=r.call(this,e,n);return this.fog=new t.Fog("#FFFFFF",5,20),this.name="fog",this.type="Fog",i};(a.prototype=Object.create(r.prototype)).init=function(){return"Scene"!==this.entity.type?(i.default.alert(i.default.locale.hintAttachedToScene),null):(this.entity.object3D.fog||(this.entity.object3D.fog=this.fog),this)},a.prototype.setFogMode=function(e){var n=null!==this.fog?this.fog.color.getHex():"#FFFFFF";e===t.Fog.LINEAR?this.fog=new t.Fog(n,5,20):e===t.Fog.EXPONENTIAL?this.fog=new t.FogExp2(n,.01):e===t.Fog.NONE&&(this.fog=null),this.entity.object3D.fog=this.fog},a.prototype.update=function(t){},e.default=o("fog",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(3),r=n(5).Component,o=n(5).registerComponent,a=function(t,e){var n=r.call(this,t,e);return this.name="smoke",this.type="Smoke",this.smokeParticles=[],this.partiesLimit=50,n};(a.prototype=Object.create(r.prototype)).init=function(){if("Scene"!==this.entity.type)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var e=this.entity;return(new t.TextureLoader).load(i.a.getImg("Cloud1"),n=>{var i=new t.MeshLambertMaterial({color:16777215,map:n,transparent:!0,opacity:.5});i.map.minFilter=t.LinearFilter;for(var r=new t.PlaneBufferGeometry(100,100),o=[],a=this.partiesLimit;a--;)o[a]=new t.Mesh(r,i),o[a].position.set(20*Math.random()-10,20*Math.random()-10,10*Math.random()-20),o[a].rotation.z=10*Math.random(),this.smokeParticles.push(o[a]),e.object3D.add(o[a])}),this},a.prototype.update=function(t){let e=this.smokeParticles.length;for(;e--;)this.smokeParticles[e].rotation.z+=.2*t},a.prototype.dispose=function(){},a.prototype.destroy=function(){var t=this.entity;if(t){let e=this.smokeParticles.length;for(;e--;)t.object3D.remove(this.smokeParticles[e])}},e.default=o("smoke",a)}.call(this,n(0))},function(t,e,n){t.exports=n.p+"assets/3d.png"},function(t,e,n){"use strict";n.r(e),function(t){var i=new t.Vector3(15,4,6),r=new t.Box3;r.setFromCenterAndSize(new t.Vector3,i);var o=function(e,n){this.sphereGeo=e||new t.SphereBufferGeometry(.2,32,16),this.cloudMat=n||new t.MeshPhongMaterial({color:16777215,shininess:0}),t.Group.call(this),this.spheres=[];var i=new t.Vector3,r=new t.Vector3(1,.25,.6),o=t.Math.randInt(10,25),a=new t.Vector2(.2,1);this.fillBox(i,r,o,a);var s=new t.Vector3(0,r.y,0),l=new t.Vector3(.5,.25,.5),c=t.Math.randInt(5,15),u=new t.Vector2(.2,1);this.fillBox(s,l,c,u);var h=new t.Vector3(-.7,0,0),f=new t.Vector3(.4,.2,.25),d=t.Math.randInt(3,7),p=new t.Vector2(.1,.5);this.fillBox(h,f,d,p),this.userData.velocity=t.Math.randFloat(.003,.007)};(o.prototype=Object.create(t.Group.prototype)).constructor=o,o.prototype.fillBox=function(e,n,i,r){(new t.Box3).setFromCenterAndSize(e,n);var o=new t.Group;o.position.copy(e),this.add(o);for(var a=0;a<i;a++){var s=new t.Mesh(this.sphereGeo,this.cloudMat);s.position.set(t.Math.randFloatSpread(n.x),t.Math.randFloatSpread(n.y),t.Math.randFloatSpread(n.z)),s.userData.scale=t.Math.randFloat(r.x,r.y),s.scale.setScalar(s.userData.scale),s.userData.velocity=t.Math.randFloat(.001,.002),o.add(s),this.spheres.push(s)}return o},o.prototype.update=function(t){for(var e=0;e<this.spheres.length;e++){var n=this.spheres[e],i=.4*Math.sin(t+(e+1))+1;n.scale.setScalar(n.userData.scale*i)}this.position.x+=this.userData.velocity,this.position.x>r.max.x&&(this.position.x=r.min.x)};var a=n(5).Component,s=n(5).registerComponent,l=function(e,n){var i=a.call(this,e,n);return this.name="cloud",this.type="Cloud",this.scene=null,this.clouds=[],this.cloudsLimit=10,this.params={color:16777215,shininess:0,size:.2},this.clock=new t.Clock,i};(l.prototype=Object.create(a.prototype)).init=function(){if("Scene"!==this.entity.type)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var e=this.scene=this.entity,n=new t.DirectionalLight(12632256,.3);return n.position.set(1,-3,2),e.add(n),this.createClouds(),this.clock.start(),this},l.prototype.updateParams=function(){},l.prototype.createClouds=function(){for(var e=new t.SphereBufferGeometry(this.params.size,32,16),n=new t.MeshPhongMaterial({color:this.params.color,shininess:this.params.shininess}),r=0;r<this.cloudsLimit;r++){var a=new o(e,n);a.position.set(t.Math.randFloatSpread(i.x),t.Math.randFloatSpread(i.y)+3,t.Math.randFloatSpread(i.z)),this.scene.add(a),this.clouds.push(a)}},l.prototype.update=function(t){for(var e=this.clock.getElapsedTime(),n=0;n<this.clouds.length;n++)this.clouds[n].update(e)},l.prototype.dispose=function(){},l.prototype.destroy=function(){var t=this.entity;if(t){let e=this.clouds.length;for(;e--;)t.object3D.remove(this.clouds[e])}},e.default=s("cloud",l)}.call(this,n(0))},function(t,e,n){(function(t){var e=n(5).Component,i=(n(5).registerComponent,function(t,n){var i=e.call(this,t,n);return this.name="cloud2",this.type="Cloud2",this.cloudParticles=[],this.partiesLimit=50,i});i.IS_EXPOSED=!1,(i.prototype=Object.create(e.prototype)).init=function(){if("Scene"!==this.entity.type)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var e=this.entity,n=new t.DirectionalLight(12632256,.3);return n.position.set(1,-3,2),e.add(n),(new t.TextureLoader).load("assets/imgs/clouds/dark-cloud.png",n=>{var i=new t.MeshLambertMaterial({color:16777215,map:n,transparent:!0,opacity:.5});i.map.minFilter=t.LinearFilter;for(var r=new t.PlaneBufferGeometry(100,100),o=[],a=this.partiesLimit;a--;)o[a]=new t.Mesh(r,i),o[a].position.set(10*Math.random()-5,Math.random()+3,10*Math.random()-5),o[a].rotation.x=1.4915,o[a].rotation.z=10*Math.random(),this.cloudParticles.push(o[a]),e.object3D.add(o[a])}),this},i.prototype.update=function(t){let e=this.cloudParticles.length;for(;e--;)this.cloudParticles[e].rotation.z+=.2*t},i.prototype.dispose=function(){},i.prototype.destroy=function(){var t=this.entity;if(t){let e=this.cloudParticles.length;for(;e--;)t.object3D.remove(this.cloudParticles[e])}}}).call(this,n(0))},function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(526),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(186))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r,o,a,s,l=1,c={},u=!1,h=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},i=function(t){o.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,i=function(t){var e=h.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),i=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return c[l]=r,i(l),l++},f.clearImmediate=d}function d(t){delete c[t]}function p(t){if(u)setTimeout(p,0,t);else{var e=c[t];if(e){u=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{d(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(186),n(126))},function(t,e){console.log("I'm `fs` modules")},function(t,e,n){"use strict";n.r(e);var i=n(154).System,r=n(154).registerSystem,o=function(t){var e=i.call(this,t);return this.name="physics",this.type="Physics",this.world=null,this.materials={},this.waters=[],e};(o.prototype=Object.create(i.prototype)).init=function(){this.world=new CANNON.World;var t=new CANNON.Material("groundMaterial");this.materials.ground=t;var e=new CANNON.ContactMaterial(t,t,{friction:.4,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularizationTime:3});this.world.addContactMaterial(e);var n=new CANNON.Material("bouncyMaterial");this.materials.bouncy=n;var i=new CANNON.ContactMaterial(t,n,{friction:.4,restitution:.7,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularizationTime:3});this.world.addContactMaterial(i);var r=new CANNON.Material("slipperyMaterial");this.materials.slippery=r;var o=new CANNON.ContactMaterial(t,r,{friction:0,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3});this.world.addContactMaterial(o),this.world.defaultContactMaterial.contactEquationStiffness=1e9,this.world.defaultContactMaterial.contactEquationRelaxation=4,this.world.quatNormalizeSkip=0,this.world.quatNormalizeFast=!1,this.world.gravity.set(0,-9.8,0),this.world.broadphase=new CANNON.NaiveBroadphase,this.world.solver=new CANNON.SplitSolver(new CANNON.GSSolver),this.world.solver.tolerance=.05,this.world.solver.iterations=7,this.centerOfBouyancy=new CANNON.Vec3,this.liftForce=new CANNON.Vec3,this.viscousForce=new CANNON.Vec3,this.velocityAtWorldPoint=new CANNON.Vec3;var a=this;this.world.addEventListener("postStep",(function(t){a.applyAABBBuoyancyForces()})),this.scene.physics=this},o.prototype.applyAABBBuoyancyForces=function(){for(var t=0;t<this.world.bodies.length;t++)for(var e=this.world.bodies[t],n=e.aabb,i=e.entity.getComponent("Physics"),r=0;r<this.waters.length;r++){var o=this.waters[r];if(e!=o)for(var a=o.position,s=0;s<e.shapes.length;s++){var l,c=e.shapes[s];if(e.position.y+n.upperBound.y<a.y)this.centerOfBouyancy.set(e.position),l=c.volume;else{if(!(e.position.y+n.lowerBound.y<a.y))continue;var u=n.upperBound.x-n.lowerBound.x,h=a.y-(e.position.y+n.lowerBound.y),f=n.upperBound.z-n.lowerBound.z;l=u*h*f,this.centerOfBouyancy.set(e.position.x+n.lowerBound.x+u/2,e.position.y+n.lowerBound.y+h/2,e.position.z+n.lowerBound.z+f/2)}var d=i.upforcePerVolume?i.upforcePerVolume:100,p=i.viscosity?i.viscosity:.8;a.vsub(this.centerOfBouyancy,this.liftForce),this.liftForce.scale(l*d,this.liftForce),this.liftForce.x=this.liftForce.z=0,this.centerOfBouyancy.vsub(e.position,this.centerOfBouyancy),e.getVelocityAtWorldPoint(this.centerOfBouyancy,this.velocityAtWorldPoint),this.velocityAtWorldPoint.scale(-p,this.viscousForce),e.applyForce(this.viscousForce,this.centerOfBouyancy),e.applyForce(this.liftForce,this.centerOfBouyancy)}}},o.prototype.update=function(){},o.prototype.dispose=function(){},e.default=r("physics",o)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(453),r=(n(26),n(27),n(56),n(31),n(5).Component),o=n(5).registerComponent,a=function(t,e){var n=r.call(this,t,e);return this.name="fps-controls",this.type="FirstPersonControls",this.controls=null,n};a.UP=new t.Vector3(0,1,0),a.ZERO=new t.Vector3(0,0,0),(a.prototype=Object.create(r.prototype)).init=function(){return"Scene"!==this.entity.type?(TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null):(this.setupControls(),this)},a.prototype.setupControls=function(){var t=this.entity,e=TDS_RT.program.getActiveCanvas(t),n=TDS_RT.program.getActiveCamera(t);n&&(n.position.set(0,.5,5),this.controls=new i.a(n,e),this.controls.enabled=!0,this.controls.heightSpeed=0,this.controls.autoForward=!1,this.controls.autoSpeedFactor=0,this.controls.lookVertical=!1)},a.prototype.update=function(t){this.controls.update(t)},a.prototype.updateControls=function(){},e.default=o("fps-controls",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(181),r=(n(26),n(27),n(56),n(31),n(4)),o=n(5).Component,a=n(5).registerComponent,s=function(t,e){var n=o.call(this,t,e);return this.name="drag-controls",this.type="DragControls",this.controls=null,this.objects=[],n};s.UP=new t.Vector3(0,1,0),s.ZERO=new t.Vector3(0,0,0),(s.prototype=Object.create(o.prototype)).init=function(t){return this},s.prototype.lazyLoad=function(t,e){var n;"Scene"==this.entity.type?(this.objects=this.entity.object3D.children,n=this.entity):(this.objects=[],this.objects.push(this.entity.object3D),n=r.default.program.getScene(this.entity));var o=n.camera;if(!o||!e)return this;this.controls=new i.a(this.objects,o,e),this.controls.addEventListener("dragstart",t=>{if(r.default.program.isInRunner()){if(n.hasComponent("OrbitControls")){var e=n.getComponent("OrbitControls");e.enabled=!1,e.controls&&(e.controls.enabled=!1)}t.object&&t.object.material&&t.object.material.emissive&&t.object.material.emissive.set(11184810)}}),this.controls.addEventListener("drag",t=>{r.default.program.isInRunner()&&(this.entity.hasComponent("Physics")&&this.entity.getComponent("Physics").body.position.copy(t.object.position))}),this.controls.addEventListener("dragend",t=>{if(r.default.program.isInRunner()){if(n.hasComponent("OrbitControls")){var e=n.getComponent("OrbitControls");e.enabled=!0,e.controls&&(e.controls.enabled=!0)}t.object.material.emissive&&t.object.material.emissive.set(0)}})},s.prototype.update=function(t){},s.prototype.updateControls=function(){},e.default=a("drag-controls",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(26),r=n(27),o=n(5).Component,a=n(5).registerComponent,s=function(e,n){var i=o.call(this,e,n);return this.name="object-controls",this.type="ObjectControls",this.velocity=new t.Vector3,this.canJump=!0,this.scene=null,this.mouse=new r.a(window,!0),this.raycaster=new t.Raycaster,this.object=null,this.selected=null,this.sensitivity=1,this.autoRotate=!0,this.rotateSpeed=1,this.originY=0,i};s.UP=new t.Vector3(0,1,0),s.ZERO=new t.Vector3(0,0,0),(s.prototype=Object.create(o.prototype)).init=function(t){return this.entity.hasComponent("Mesh")?this:(TDS_RT.alert(TDS_RT.locale.hintAttachedToMesh),null)},s.prototype.lazyLoad=function(t,e){this.setupControls(t,e)},s.prototype.setupControls=function(t,e){var n=(this.scene=TDS_RT.program.getScene(this.entity)).camera;n&&e&&(n.position.set(0,.5,5),this.object=this.entity.object3D,this.originY=this.object.position.y,this.setupKeyControls(n,e),this.setupMouseControls(n,e))},s.prototype.intersectObjects=function(e,n,i){var r=n.getBoundingClientRect(),o=new t.Vector2(i.clientX-r.left,i.clientY-r.top),a=new t.Vector2(o.x/n.width*2-1,-2*o.y/n.height+1);this.raycaster.setFromCamera(a,e);var s=this.raycaster.intersectObjects(this.scene.children,!0);return s.length>0&&s[0]},s.prototype.setupKeyControls=function(t,e){var n=this.object,r=this.entity.getComponent("Physics");e.setAttribute("tabindex",1),e.onkeydown=t=>{if(TDS_RT.program.isInRunner()&&this.selected&&this.selected.object==this.entity&&TDS_RT.program.mode!==i.a.MODE_EDITING)switch(t.keyCode){case 38:case 87:n.position.z-=.1*this.sensitivity,r&&(r.body.position.z-=.1*this.sensitivity);break;case 40:case 83:n.position.z+=.1*this.sensitivity,r&&(r.body.position.z+=.1*this.sensitivity);break;case 37:case 65:n.position.x-=.1*this.sensitivity,r&&(r.body.position.x-=.1*this.sensitivity);break;case 39:case 68:n.position.x+=.1*this.sensitivity,r&&(r.body.position.x+=.1*this.sensitivity);break;case 32:!0===this.canJump&&(r?(r.body.velocity.y+=3.5,this.oldY=r.body.position.y):this.velocity.y+=3.5),this.canJump=!1}},e.onkeyup=t=>{}},s.prototype.setupMouseControls=function(e,n){var r=this,o=this.object;n.addEventListener("mousedown",(function(t){if(!TDS_RT.program.isInRunner())return;var o=r.selected=r.intersectObjects(e,n,t);if(!o||o.object!=r.entity)return;if(TDS_RT.program.mode===i.a.MODE_EDITING)return;if(r.scene.hasComponent("OrbitControls")){var a=r.scene.getComponent("OrbitControls");a.enabled=!1,a.controls.enabled=!1}c=!0,s}),!1),n.addEventListener("mousemove",(function(e){if(!TDS_RT.program.isInRunner())return;if(c){var n={x:e.offsetX-u.x,y:e.offsetY-u.y};if(u={x:e.offsetX,y:e.offsetY},0!=n.x){if(!m(.05*Math.sign(n.x),"y"))return;o.rotation.y+=.05*Math.sign(n.x),l}0}var i=r.entity.getComponent("Physics");i&&i.body.quaternion.copy((new t.Quaternion).setFromEuler(o.rotation))}),!1),n.addEventListener("mouseup",(function(t){if(!TDS_RT.program.isInRunner())return;if(r.scene.hasComponent("OrbitControls")){var e=r.scene.getComponent("OrbitControls");e.enabled=!0,e.controls.enabled=!0}c=!1,g()}),!1),n.addEventListener("wheel",(function(t){if(!TDS_RT.program.isInRunner())return;var n=t.wheelDelta?t.wheelDelta:-1*t.deltaY;n>0&&e.position.z>6?d():n<0&&e.position.z<15&&p()}),!1),n.addEventListener("touchstart",(function(t){if(!TDS_RT.program.isInRunner())return;t.preventDefault(),s,2===t.touches.length?(f.X=Math.abs(t.touches[0].clientX-t.touches[1].clientX),f.Y=Math.abs(t.touches[0].clientY-t.touches[1].clientY),h=new Array(2)):u={x:t.touches[0].pageX,y:t.touches[0].pageY}}),!1),n.addEventListener("touchmove",(function(t){if(!TDS_RT.program.isInRunner())return;if(t.preventDefault(),l,2===t.touches.length){h=new Array(2);var n=Math.abs(t.touches[0].clientX-t.touches[1].clientX),i=Math.abs(t.touches[0].clientY-t.touches[1].clientY);f&&f.X>0&&f.Y>0&&(n>f.X&&i>f.Y&&e.position.z>6?d():n<f.X&&e.position.z<15&&i<f.Y&&p()),f.X=n,f.Y=i}else if(0===h.length){f.X=null,f.Y=null;var r={x:t.touches[0].pageX-u.x,y:t.touches[0].pageY-u.y};if(u={x:t.touches[0].pageX,y:t.touches[0].pageY},0!=r.x){if(!m(.05*Math.sign(r.x),"y"))return;o.rotation.y+=.05*Math.sign(r.x)}0}}),!1),n.addEventListener("touchend",(function(t){if(!TDS_RT.program.isInRunner())return;f.X=null,f.Y=null,h.length>0?h.pop():h=[];t.preventDefault();g()}),!1);var a={x:{enabled:!1,from:Math.PI/8,to:Math.PI/8},y:{enabled:!1,from:Math.PI/4,to:Math.PI/4}},s=0,l=1,c=!1,u={x:0,y:0},h=[],f={X:null,Y:null};function d(){e.position.z-=.5}function p(){e.position.z+=.5}function m(t,e){return!a[e].enabled||!!(-1*a[e].from<o.rotation[e]+t&&o.rotation[e]+t<a[e].to)}function g(){u={x:0,y:0}}},s.prototype.update=function(t){if(TDS_RT.program.isInRunner()&&this.object){var e=this.entity.getComponent("Physics");e?this.oldY===e.body.position.y&&(this.velocity.y=0,this.canJump=!0):(this.velocity.y-=9.8*t,this.object.position.y+=this.velocity.y*t,this.object.position.y<this.originY&&(this.velocity.y=0,this.object.position.y=this.originY,this.canJump=!0)),this.autoRotate&&(this.object.rotation.y+=t*this.rotateSpeed)}},s.prototype.updateControls=function(){},e.default=a("object-controls",s)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(136),r=n(17),o=n(3),a=n(5).Component,s=n(5).registerComponent;function l(t,e){var n=a.call(this,t,e);return this.name="halo",this.type="Halo",this.halo=null,this.size=1,this.defaultTextureLensFlare=[],n}l.prototype=Object.create(a.prototype),l.prototype.init=function(){if(this.halo)return this;for(var t=0;t<4;t++){var e=new r.a(o.a.getImg("Flare"+t));e.name="lensflare"+t,this.defaultTextureLensFlare.push(e)}return this.halo=new i.a,this.addFlares(),this.entity.object3D.add(this.halo),this},l.prototype.addFlares=function(){this.halo.addFlare(this.defaultTextureLensFlare[0],70*this.size,0),this.halo.addFlare(this.defaultTextureLensFlare[2],51*this.size,0),this.halo.addFlare(this.defaultTextureLensFlare[2],51*this.size,0),this.halo.addFlare(this.defaultTextureLensFlare[2],50*this.size,0),this.halo.addFlare(this.defaultTextureLensFlare[3],6*this.size,.6),this.halo.addFlare(this.defaultTextureLensFlare[3],7*this.size,.7),this.halo.addFlare(this.defaultTextureLensFlare[3],12*this.size,.9),this.halo.addFlare(this.defaultTextureLensFlare[3],7*this.size,1)},l.prototype.refreshHalo=function(){this.destroy(),this.halo=new i.a,this.addFlares(),this.entity.object3D.add(this.halo)},l.prototype.destroy=function(){this.entity.object3D.remove(this.halo),this.halo=null},l.prototype.toJSON=function(t){var e=a.prototype.toJSON.call(this,t);return e.properties={size:this.size},e},e.default=s("halo",l)},function(t,e,n){(function(t){var e,n,i;t.Lensflare=function(){t.Mesh.call(this,t.Lensflare.Geometry,new t.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new t.Vector3,n=new t.DataTexture(new Uint8Array(768),16,16,t.RGBFormat);n.minFilter=t.NearestFilter,n.magFilter=t.NearestFilter,n.wrapS=t.ClampToEdgeWrapping,n.wrapT=t.ClampToEdgeWrapping,n.needsUpdate=!0;var i=new t.DataTexture(new Uint8Array(768),16,16,t.RGBFormat);i.minFilter=t.NearestFilter,i.magFilter=t.NearestFilter,i.wrapS=t.ClampToEdgeWrapping,i.wrapT=t.ClampToEdgeWrapping,i.needsUpdate=!0;var r=t.Lensflare.Geometry,o=new t.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),a=new t.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new t.Mesh(r,o),l=[],c=t.LensflareElement.Shader,u=new t.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:i},color:{value:new t.Color(16777215)},scale:{value:new t.Vector2},screenPosition:{value:new t.Vector3}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:t.AdditiveBlending,transparent:!0,depthWrite:!1}),h=new t.Mesh(r,u);this.addElement=function(t){l.push(t)};var f=new t.Vector2,d=new t.Vector2,p=new t.Box2,m=new t.Vector4;this.onBeforeRender=function(t,c,g){m.copy(t.getCurrentViewport());var v=m.w/m.z,y=m.z/2,x=m.w/2,b=16/m.w;if(f.set(b*v,b),p.min.set(m.x,m.y),p.max.set(m.x+(m.z-16),m.y+(m.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(g.matrixWorldInverse),e.applyMatrix4(g.projectionMatrix),d.x=m.x+e.x*y+y-8,d.y=m.y+e.y*x+x-8,p.containsPoint(d)){t.copyFramebufferToTexture(d,n),(T=o.uniforms).scale.value=f,T.screenPosition.value=e,t.renderBufferDirect(g,null,r,o,s,null),t.copyFramebufferToTexture(d,i),(T=a.uniforms).scale.value=f,T.screenPosition.value=e,t.renderBufferDirect(g,null,r,a,s,null);for(var w=2*-e.x,_=2*-e.y,M=0,S=l.length;M<S;M++){var T,A=l[M];(T=u.uniforms).color.value.copy(A.color),T.map.value=A.texture,T.screenPosition.value.x=e.x+w*A.distance,T.screenPosition.value.y=e.y+_*A.distance;b=A.size/m.w,v=m.w/m.z;T.scale.value.set(b*v,b),u.uniformsNeedUpdate=!0,t.renderBufferDirect(g,null,r,u,h,null)}}},this.dispose=function(){o.dispose(),a.dispose(),u.dispose(),n.dispose(),i.dispose();for(var t=0,e=l.length;t<e;t++)l[t].texture.dispose()}},t.Lensflare.prototype=Object.create(t.Mesh.prototype),t.Lensflare.prototype.constructor=t.Lensflare,t.Lensflare.prototype.isLensflare=!0,t.LensflareElement=function(e,n,i,r){this.texture=e,this.size=n||1,this.distance=i||0,this.color=r||new t.Color(16777215)},t.LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},t.Lensflare.Geometry=(e=new t.BufferGeometry,n=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),i=new t.InterleavedBuffer(n,5),e.setIndex([0,1,2,0,2,3]),e.addAttribute("position",new t.InterleavedBufferAttribute(i,3,0,!1)),e.addAttribute("uv",new t.InterleavedBufferAttribute(i,2,3,!1)),e)}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(3),n(50),n(139);var i=n(5).Component,r=n(5).registerComponent;function o(e,n){var r=i.call(this,e,n);return this.name="ripple",this.type="Ripple",this.WATER_WIDTH=100,this.WATER_HEIGHT=100,this.waterGeometry=null,this.waterVerticesNext=null,this.waterVerticesPrev=null,this.waterMaterial=null,this.waterMesh=null,this.C1=0,this.C2=0,this.C3=0,this.cubeRenderTarget=new t.WebGLCubeRenderTarget(1,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding}),this.cubeCamera=new t.CubeCamera(.1,5e3,this.cubeRenderTarget),this.params={spacing:.4,wave_speed:.5,viscosity:.1},this.seeds=[],r}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.init=function(){return"Plane"!=this.entity.type?(TDS_RT.alert("Ripple can only be applied to a plane"),null):(this.waterGeometry=new t.PlaneGeometry(this.entity.width,this.entity.height,this.WATER_WIDTH,this.WATER_HEIGHT),this.waterVerticesPrev=Array.from(this.waterGeometry.vertices),this.waterVerticesNext=Array.from(this.waterGeometry.vertices),this.entity.geometry=this.waterGeometry,this.waterMesh=this.entity,this.updateParams(),this)},o.prototype.seedWaterSurface=function(){let e=this.waterGeometry.vertices;const n=t.Math.randInt(0,this.WATER_WIDTH-1)*this.WATER_WIDTH+t.Math.randInt(0,this.WATER_HEIGHT-1);e[n].z+=.1,this.waterGeometry.verticesNeedUpdate=!0,-1==this.seeds.indexOf(n)&&this.seeds.push(n)},o.prototype.updateParams=function(){const t=this.params.spacing,e=this.params.wave_speed,n=this.params.viscosity,i=.1*((n+Math.sqrt(n*n+32*e*e/t*t))/(8*e*e/t*t)),r=n*i+2;this.C1=(4-8*e*e*i*i/(t*t))/r,this.C2=(n*i-2)/r,this.C3=1*e*e*i*i/(t*t)/r},o.prototype.indexFrom=function(t,e){const n=(t+this.WATER_WIDTH)%this.WATER_WIDTH,i=(e+this.WATER_HEIGHT)%this.WATER_HEIGHT;return n*this.WATER_WIDTH+i},o.prototype.updateWaterSurface=function(){const t=(t,e,n,i,r)=>{const o=this.indexFrom(i+0,r+0),a=this.indexFrom(i+1,r+0),s=this.indexFrom(i-1,r+0),l=this.indexFrom(i+0,r+1),c=this.indexFrom(i+0,r-1);t[o].z=this.C1*e[o].z+this.C2*n[o].z+this.C3*(e[a].z+e[s].z+e[l].z+e[c].z)},e=this.waterGeometry.vertices;for(let n=0;n<this.seeds.length;n++){let i=this.seeds[n],r=i%this.WATER_WIDTH,o=Math.floor(i/this.WATER_WIDTH);t(this.waterVerticesNext,e,this.waterVerticesPrev,o,r),e[i].z<=0&&this.seeds.splice(n,1)}this.waterVerticesPrev=Array.from(e),this.waterGeometry.vertices=Array.from(this.waterVerticesNext),this.waterGeometry.computeVertexNormals(),this.waterGeometry.verticesNeedUpdate=!0},o.prototype.update=function(t){this.waterMesh&&(this.seedWaterSurface(),this.updateWaterSurface())},o.prototype.dispose=function(){},e.default=r("ripple",o)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(132);var i=n(3),r=n(17),o=n(4),a=n(5).Component,s=n(5).registerComponent;function l(e,n){var i=a.call(this,e,n);return this.name="panorama",this.type="Panorama",this.panorama=null,n?this.object3D.geometry.applyMatrix((new t.Matrix4).makeScale(-1,1,1)):this.createObject3D(),i}l.prototype=Object.create(a.prototype),l.prototype.createObject3D=function(){var e=new t.SphereGeometry(500,60,40);e.applyMatrix((new t.Matrix4).makeScale(-1,1,1));var n=this.panorama?this.panorama:new r.a(i.a.getImg("Pano1")),o=new t.MeshBasicMaterial({map:n});this.object3D=new t.Mesh(e,o)},l.prototype.init=function(){return"Scene"!==this.entity.type?(o.default.alert(o.default.locale.hintAttachedToScene),null):this},l.prototype.update=function(t){},e.default=s("panorama",l)}.call(this,n(0))},function(t,e,n){!function(t,e,n,i,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},c=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},f=function(){function t(e){var n=e.x,i=void 0===n?0:n,r=e.y,o=void 0===r?0:r,s=e.nx,l=e.ny,c=e.dy,u=void 0===c?0:c,h=e.dx,f=void 0===h?0:h,d=e.color,p=void 0===d?"grey":d,m=e.data,g=e.type,v=e.subject,y=e.connector,x=e.note,b=e.disable,w=e.id,_=e.className;a(this,t),this._dx=void 0!==s?s-i:f,this._dy=void 0!==l?l-o:u,this._x=i,this._y=o,this._color=p,this.id=w,this._className=_||"",this._type=g||"",this.data=m,this.note=x||{},this.connector=y||{},this.subject=v||{},this.disable=b||[]}return s(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var e=t.x,n=t.y;this._dx=e,this._dy=n,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var e=t.x,n=t.y;this._x=e,this._y=n,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),d=function(){function t(e){var n=e.annotations,i=e.accessors,r=e.accessorsInverse;a(this,t),this.accessors=i,this.accessorsInverse=r,this.annotations=n}return s(t,[{key:"clearTypes",value:function(t){this.annotations.forEach((function(e){e.type=void 0,e.subject=t&&t.subject||e.subject,e.connector=t&&t.connector||e.connector,e.note=t&&t.note||e.note}))}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach((function(e){e.type.setPositionWithAccessors(t.accessors)}))}},{key:"editMode",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.editMode=t,e.type.updateEditMode())}))}},{key:"updateDisable",value:function(t){this.annotations.forEach((function(e){e.disable=t,e.type&&t.forEach((function(t){e.type[t]&&(e.type[t].remove&&e.type[t].remove(),e.type[t]=void 0)}))}))}},{key:"updateTextWrap",value:function(t){this.annotations.forEach((function(e){e.type&&e.type.updateTextWrap&&e.type.updateTextWrap(t)}))}},{key:"updateText",value:function(){this.annotations.forEach((function(t){t.type&&t.type.drawText&&t.type.drawText()}))}},{key:"updateNotePadding",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.notePadding=t)}))}},{key:"json",get:function(){var t=this;return this.annotations.map((function(e){var n=e.json;return t.accessorsInverse&&e.data&&(n.data={},Object.keys(t.accessorsInverse).forEach((function(i){n.data[i]=t.accessorsInverse[i]({x:e.x,y:e.y})}))),n}))}},{key:"noteNodes",get:function(){return this.annotations.map((function(t){return l({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})}))}}]),t}(),p=function(t,e){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=e<0?"top":"bottom"),t},m=function(t,e){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=e<0?"right":"left"),t},g=["topBottom","top","bottom"],v=["leftRight","left","right"],y=function(t){var e=t.data,n=t.curve,r=void 0===n?i.curveLinear:n,o=t.canvasContext,a=t.className,s=t.classID,l=i.line().curve(r),c={type:"path",className:a,classID:s,data:e};return o?(l.context(o),c.pathMethods=l):c.attrs={d:l(e)},c},x=function(t){var e=t.data,n=t.canvasContext,r={type:"path",className:t.className,classID:t.classID,data:e},o=i.arc().innerRadius(e.innerRadius||0).outerRadius(e.outerRadius||e.radius||2).startAngle(e.startAngle||0).endAngle(e.endAngle||2*Math.PI);return n?(o.context(n),r.pathMethods=lineGen):r.attrs={d:o()},r},b=function(t){var e=t.align,n=t.x,i=void 0===n?0:n,r=t.y,o=void 0===r?0:r,a=t.bbox,s=t.offset;"top"===(e=p(e,s.y))?o-=a.height:"middle"===e&&(o-=a.height/2);var l=[[i,o],[i,o+a.height]];return{components:[y({data:l,className:"note-line"})]}},w=function(t){var e=t.align,n=t.x,i=void 0===n?0:n,r=t.y,o=void 0===r?0:r,a=t.offset,s=t.bbox;"right"===(e=m(e,a.x))?i-=s.width:"middle"===e&&(i-=s.width/2);var l=[[i,o],[i+s.width,o]];return{components:[y({data:l,className:"note-line"})]}},_=function(t){var e=t.type,n=t.subjectType,i=e.annotation,r=i.position,o=i.x-r.x,a=o+i.dx,s=i.y-r.y,l=s+i.dy,c=i.subject;if("circle"===n&&(c.outerRadius||c.radius)){var u=Math.sqrt((o-a)*(o-a)+(s-l)*(s-l)),h=Math.asin(-l/u),f=c.outerRadius||c.radius+(c.radiusPadding||0);o=Math.abs(Math.cos(h)*f)*(a<0?-1:1),s=Math.abs(Math.sin(h)*f)*(l<0?-1:1)}if("rect"===n){var d=c.width,p=c.height;(d>0&&i.dx>0||d<0&&i.dx<0)&&(o=Math.abs(d)>Math.abs(i.dx)?d/2:d),(p>0&&i.dy>0||p<0&&i.dy<0)&&(s=Math.abs(p)>Math.abs(i.dy)?p/2:p),o===d/2&&s===p/2&&(o=a,s=l)}return[[o,s],[a,l]]},M=function(t){var e=_(t);return{components:[y({data:e,className:"connector"})]}},S=function(t){var e=t.type,n=t.subjectType,i=e.annotation,r=i.position,o=i.x-r.x,a=o+i.dx,s=i.y-r.y,l=s+i.dy,c=i.subject;if("rect"===n){var u=c.width,h=c.height;(u>0&&i.dx>0||u<0&&i.dx<0)&&(o=Math.abs(u)>Math.abs(i.dx)?u/2:u),(h>0&&i.dy>0||h<0&&i.dy<0)&&(s=Math.abs(h)>Math.abs(i.dy)?h/2:h),o===u/2&&s===h/2&&(o=a,s=l)}var f=[[o,s],[a,l]],d=l-s,p=a-o,m=a,g=l,v=l<s&&a>o||a<o&&l>s?-1:1;if(Math.abs(p)<Math.abs(d)?(m=a,g=s+p*v):(g=l,m=o+d*v),"circle"===n&&(c.outerRadius||c.radius)){var x=(c.outerRadius||c.radius)+(c.radiusPadding||0),b=x/Math.sqrt(2);if(Math.abs(p)>b&&Math.abs(d)>b)f=[[o=b*(a<0?-1:1),s=b*(l<0?-1:1)],[m,g],[a,l]];else if(Math.abs(p)>Math.abs(d)){var w=Math.asin(-l/x);f=[[o=Math.abs(Math.cos(w)*x)*(a<0?-1:1),l],[a,l]]}else{var _=Math.acos(a/x);f=[[a,s=Math.abs(Math.sin(_)*x)*(l<0?-1:1)],[a,l]]}}else f=[[o,s],[m,g],[a,l]];return{components:[y({data:f,className:"connector"})]}},T=function(t){var n=t.type,r=t.connectorData,o=t.subjectType;r||(r={}),r.points&&"number"!=typeof r.points||(r.points=A(n.annotation.offset,r.points)),r.curve||(r.curve=i.curveCatmullRom);var a=[];if(n.editMode){var s=r.points.map((function(t,e){return l({},function(t){var e=t.cx,n=void 0===e?0:e,i=t.cy;return{move:{x:n,y:void 0===i?0:i}}}({cx:t[0],cy:t[1]}),{index:e})})),c=function(t){r.points[t][0]+=e.event.dx,r.points[t][1]+=e.event.dy,n.redrawConnector()};a=n.mapHandles(s.map((function(t){return l({},t.move,{drag:c.bind(n,t.index)})})))}var u=_({type:n,subjectType:o});return u=[u[0]].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(r.points),[u[1]]),{components:[y({data:u,curve:r.curve,className:"connector"})],handles:a}},A=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n={x:t.x/(e+1),y:t.y/(e+1)},i=[],r=1;r<=e;r++)i.push([n.x*r+r%2*20,n.y*r-r%2*20]);return i},E=function(t){var e=t.annotation,n=t.start,i=t.end,r=t.scale,o=void 0===r?1:r,a=e.position;n=n?[-i[0]+n[0],-i[1]+n[1]]:[e.dx,e.dy],i||(i=[e.x-a.x,e.y-a.y]);var s=i[0],l=i[1],c=n[0],u=n[1],h=10*o,f=16/180*Math.PI,d=Math.atan(u/c);c<0&&(d+=Math.PI);var p=[[s,l],[Math.cos(d+f)*h+s,Math.sin(d+f)*h+l],[Math.cos(d-f)*h+s,Math.sin(d-f)*h+l],[s,l]];return{components:[y({data:p,className:"connector-end connector-arrow",classID:"connector-end"})]}},q=function(t){var e=t.line,n=t.scale,i=void 0===n?1:n,r=x({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(i)}});return r.attrs.transform="translate("+e.data[0][0]+", "+e.data[0][1]+")",{components:[r]}},C=function(t){var n=t.subjectData,i=t.type;n.radius||n.outerRadius||(n.radius=20);var r=[],o=x({data:n,className:"subject"});if(i.editMode){var a=function(t){var e=t.cx,n=void 0===e?0:e,i=t.cy,r=void 0===i?0:i,o=t.r1,a=t.r2,s=t.padding,l={move:{x:n,y:r}};return void 0!==o&&(l.r1={x:n+o/Math.sqrt(2),y:r+o/Math.sqrt(2)}),void 0!==a&&(l.r2={x:n+a/Math.sqrt(2),y:r+a/Math.sqrt(2)}),void 0!==s&&(l.padding={x:n+o+s,y:r}),l}({r1:o.data.outerRadius||o.data.radius,r2:o.data.innerRadius,padding:n.radiusPadding}),s=function(t){var r=n[t]+e.event.dx*Math.sqrt(2);n[t]=r,i.redrawSubject(),i.redrawConnector()},c=[l({},a.r1,{drag:s.bind(i,void 0!==n.outerRadius?"outerRadius":"radius")})];n.innerRadius&&c.push(l({},a.r2,{drag:s.bind(i,"innerRadius")})),r=i.mapHandles(c)}return o.attrs["fill-opacity"]=0,{components:[o],handles:r}},P=function(t){var n=t.subjectData,i=t.type;n.width||(n.width=100),n.height||(n.height=100);var r=[],o=n.width,a=n.height,s=y({data:[[0,0],[o,0],[o,a],[0,a],[0,0]],className:"subject"});if(i.editMode){var l=[{x:o,y:a/2,drag:function(){n.width=e.event.x,i.redrawSubject(),i.redrawConnector()}.bind(i)},{x:o/2,y:a,drag:function(){n.height=e.event.y,i.redrawSubject(),i.redrawConnector()}.bind(i)}];r=i.mapHandles(l)}return s.attrs["fill-opacity"]=.1,{components:[s],handles:r}},R=function(t){var e=t.subjectData,n=t.type.annotation.position,i=(void 0!==e.x1?e.x1:n.x)-n.x,r=(void 0!==e.x2?e.x2:n.x)-n.x,o=(void 0!==e.y1?e.y1:n.y)-n.y,a=(void 0!==e.y2?e.y2:n.y)-n.y;return{components:[y({data:[[i,o],[r,a]],className:"subject"})]}},L=function(t){var n=t.subjectData,i=void 0===n?{}:n,r=t.type,o=void 0===r?{}:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o.typeSettings&&o.typeSettings.subject;i.radius||(s&&s.radius?i.radius=s.radius:i.radius=14),i.x||s&&s.x&&(i.x=s.x),i.y||s&&s.y&&(i.y=s.y);var l=[],c=[],u=i.radius,h=.7*u,f=0,d=0,p=Math.sqrt(2)*u,m={xleftcorner:-u,xrightcorner:u,ytopcorner:-u,ybottomcorner:u,xleft:-p,xright:p,ytop:-p,ybottom:p};i.x&&!i.y?f=m["x"+i.x]:i.y&&!i.x?d=m["y"+i.y]:i.x&&i.y&&(f=m["x"+i.x+"corner"],d=m["y"+i.y+"corner"]);var g="translate("+f+", "+d+")",v=x({className:"subject",data:{radius:u}});v.attrs.transform=g,v.attrs.fill=a.color,v.attrs["stroke-linecap"]="round",v.attrs["stroke-width"]="3px";var b=x({className:"subject-ring",data:{outerRadius:u,innerRadius:h}});b.attrs.transform=g,b.attrs["stroke-width"]="3px",b.attrs.fill="white";var w=void 0;if(f&&d||!f&&!d)w=y({className:"subject-pointer",data:[[0,0],[f||0,0],[0,d||0],[0,0]]});else if(f||d){var _=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||e*u/Math.sqrt(2)};w=y({className:"subject-pointer",data:[[0,0],[_(f),_(d)],[_(f,-1),_(d,-1)],[0,0]]})}if(w&&(w.attrs.fill=a.color,w.attrs["stroke-linecap"]="round",w.attrs["stroke-width"]="3px",c.push(w)),o.editMode){var M=function(){i.x=e.event.x<2*-u?"left":e.event.x>2*u?"right":void 0,i.y=e.event.y<2*-u?"top":e.event.y>2*u?"bottom":void 0,o.redrawSubject()},S={x:2*f,y:2*d,drag:M.bind(o)};S.x||S.y||(S.y=-u),l=o.mapHandles([S])}var T=void 0;return i.text&&(T={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:i.text,"text-anchor":"middle",dy:".25em",x:f,y:d}}),c.push(v),c.push(b),c.push(T),{components:c,handles:l}},I=function(){function t(e){var n=e.a,i=e.annotation,r=e.editMode,o=e.dispatcher,s=e.notePadding,l=e.accessors;if(a(this,t),this.a=n,this.note=-1===i.disable.indexOf("note")&&n.select("g.annotation-note"),this.noteContent=this.note&&n.select("g.annotation-note-content"),this.connector=-1===i.disable.indexOf("connector")&&n.select("g.annotation-connector"),this.subject=-1===i.disable.indexOf("subject")&&n.select("g.annotation-subject"),this.dispatcher=o,o){var c=W.bind(null,o,i);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=i,this.editMode=i.editMode||r,this.notePadding=void 0!==s?s:3,this.offsetCornerX=0,this.offsetCornerY=0,l&&i.data&&this.init(l)}return s(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,i){var r=this;Array.isArray(i)||(i=[i]),i.filter((function(t){return t})).forEach((function(i){var o=i.type,a=i.className,s=i.attrs,l=i.handles,c=i.classID;if("handle"===o)!function(t){var i=t.group,r=t.handles,o=t.r,a=void 0===o?10:o,s=i.selectAll("circle.handle").data(r);s.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(n.drag().container(e.select("g.annotations").node()).on("start",(function(t){return t.start&&t.start(t)})).on("drag",(function(t){return t.drag&&t.drag(t)})).on("end",(function(t){return t.end&&t.end(t)}))),i.selectAll("circle.handle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r||a})).attr("class",(function(t){return"handle "+(t.className||"")})),s.exit().remove()}({group:t,r:s&&s.r,handles:l});else{H(t,[r.annotation],o,a,c);for(var u=t.select(o+"."+(c||a)),h=Object.keys(s),f=[],d=u.node().attributes,p=d.length-1;p>=0;p--){var m=d[p].name;-1===h.indexOf(m)&&"class"!==m&&f.push(m)}h.forEach((function(t){"text"===t?u.text(s[t]):u.attr(t,s[t])})),f.forEach((function(t){return u.attr(t,null)}))}}))}},{key:"getNoteBBox",value:function(){return Y(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=Y(this.note,".annotation-note-content"),e=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(e[1])+this.annotation.dx,t.offsetCornerY=parseFloat(e[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.subject,i=e.type,r={type:this,subjectData:n},o={};"circle"===i?o=C(r):"rect"===i?o=P(r):"threshold"===i?o=R(r):"badge"===i&&(o=L(r,this.annotation));var a=o,s=a.components,l=void 0===s?[]:s,c=a.handles,u=void 0===c?[]:c;return l.forEach((function(e){e&&e.attrs&&!e.attrs.stroke&&(e.attrs.stroke=t.annotation.color)})),this.editMode&&(u=u.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),l.push({type:"handle",handles:u})),l}},{key:"drawConnector",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.connector,i=n.type||e.type,r={type:this,connectorData:n};r.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var o="curve"===i?T(r):"elbow"===i?S(r):M(r),a=o.components,s=void 0===a?[]:a,l=o.handles,c=void 0===l?[]:l,u=s[0];u&&(u.attrs.stroke=this.annotation.color,u.attrs.fill="none");var h=n.end||e.end,f={};if("arrow"===h){var d=u.data[1],p=u.data[0],m=Math.sqrt(Math.pow(d[0]-p[0],2)+Math.pow(d[1]-p[1],2));m<5&&u.data[2]&&(d=u.data[2]),f=E({annotation:this.annotation,start:d,end:p,scale:n.endScale})}else"dot"===h?f=q({line:u,scale:n.endScale}):h&&"none"!==h||this.connector&&this.connector.select(".connector-end").remove();return f.components&&(f.components.forEach((function(e){e.attrs.fill=t.annotation.color,e.attrs.stroke=t.annotation.color})),s=s.concat(f.components)),this.editMode&&0!==c.length&&s.push({type:"handle",handles:c}),s}},{key:"drawNote",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.annotation.note,o=r.align||i.align||"dynamic",a={bbox:i.bbox,align:o,offset:this.annotation.offset},s=r.lineType||i.lineType,l={};"vertical"===s?l=b(a):"horizontal"===s&&(l=w(a));var c=l,u=c.components,h=void 0===u?[]:u,f=c.handles,d=void 0===f?[]:f;if(h.forEach((function(e){e.attrs.stroke=t.annotation.color})),this.editMode){d=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),h.push({type:"handle",handles:d});var p=this.dragNote.bind(this),m=this.dragstarted.bind(this),g=this.dragended.bind(this);this.note.call(n.drag().container(e.select("g.annotations").node()).on("start",(function(t){return m(t)})).on("drag",(function(t){return p(t)})).on("end",(function(t){return g(t)})))}else this.note.on("mousedown.drag",null);return h}},{key:"drawNoteContent",value:function(t){var e=this.annotation.note,n=void 0!==e.padding?e.padding:this.notePadding,i=e.orientation||t.orientation||"topBottom",r=e.lineType||t.lineType,o=e.align||t.align||"dynamic";"vertical"===r?i="leftRight":"horizontal"===r&&(i="topBottom");var a=function(t){var e=t.padding,n=void 0===e?0:e,i=t.bbox,r=void 0===i?{x:0,y:0,width:0,height:0}:i,o=t.align,a=t.orientation,s=t.offset,l=void 0===s?{x:0,y:0}:s,c=-r.x,u=0;return-1!==g.indexOf(a)?(o=m(o,l.x),l.y<0&&"topBottom"===a||"top"===a?u-=r.height+n:u+=n,"middle"===o?c-=r.width/2:"right"===o&&(c-=r.width)):-1!==v.indexOf(a)&&(o=p(o,l.y),l.x<0&&"leftRight"===a||"left"===a?c-=r.width+n:c+=n,"middle"===o?u-=r.height/2:"top"===o&&(u-=r.height)),{x:c,y:u}}({padding:n,bbox:t.bbox,offset:this.annotation.offset,orientation:i,align:o}),s=a.x,l=a.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=l+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+l+")"),[]}},{key:"drawOnScreen",value:function(t,e){return this.drawOnSVG(t,e)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){e.event.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=e.event.dx,t.y+=e.event.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=e.event.dx,t.y+=e.event.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var e=this;return t.map((function(t){return l({},t,{start:e.dragstarted.bind(e),end:e.dragended.bind(e)})}))}}]),t}(),D=function(t,e,n){return function(t){function i(t){a(this,i);var n=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return n.typeSettings=e,e.disable&&e.disable.forEach((function(t){n[t]&&n[t].remove(),n[t]=void 0,"note"===t&&(n.noteContent=void 0)})),n}return u(i,t),s(i,[{key:"className",value:function(){return""+(e.className||c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"className",this)&&c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=l({},e.subject,this.typeSettings.subject),c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawSubject",this).call(this,l({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=l({},e.connector,this.typeSettings.connector),c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawConnector",this).call(this,l({},t,e.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=l({},e.note,this.typeSettings.note),c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawNote",this).call(this,l({},t,e.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawNoteContent",this).call(this,l({},t,e.note,this.typeSettings.note))}}],[{key:"init",value:function(t,e){return c(i.__proto__||Object.getPrototypeOf(i),"init",this).call(this,t,e),n&&(t=n(t,e)),t}}]),i}(t)},O=function(t){function e(t){a(this,e);var n=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.textWrap=t.textWrap||120,n.drawText(),n}return u(e,t),s(e,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){H(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");H(t,[this.annotation],"rect","annotation-note-bg"),H(t,[this.annotation],"text","annotation-note-label"),H(t,[this.annotation],"text","annotation-note-title");var e={height:0},n=this.a.select("text.annotation-note-label"),i=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,r=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,a=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,s={top:0,bottom:0,left:0,right:0};"number"==typeof a?s={top:a,bottom:a,left:a,right:a}:a&&"object"===(void 0===a?"undefined":o(a))&&(s=l(s,a)),this.annotation.note.title&&((u=this.a.select("text.annotation-note-title")).text(this.annotation.note.title),u.attr("fill",this.annotation.color),u.attr("font-weight","bold"),u.call(X,i,r),e=u.node().getBBox()),n.text(this.annotation.note.label).attr("dx","0"),n.call(X,i,r),n.attr("y",1.1*e.height||0),n.attr("fill",this.annotation.color);var c=this.getNoteBBox();if(this.a.select("rect.annotation-note-bg").attr("width",c.width+s.left+s.right).attr("height",c.height+s.top+s.bottom).attr("x",c.x-s.left).attr("y",-s.top).attr("fill","white").attr("fill-opacity",0),this.dispatcher){var u,h=W.bind(null,this.dispatcher,Z);h({component:n,name:"text"}),this.annotation.note.title&&h({component:u=this.a.select("text.annotation-note-title"),name:"text"})}}}}]),e}(I),N=D(O,{className:"label",note:{align:"middle"}}),F=D(O,{className:"callout",note:{lineType:"horizontal"}}),B=D(F,{className:"callout elbow",connector:{type:"elbow"}}),z=D(F,{className:"callout curve",connector:{type:"curve"}}),U=D(I,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),k=D(O,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),j=D(O,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),V=function(t){function e(){return a(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),s(e,[{key:"mapY",value:function(t){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapY",this).call(this,t);var n=this.annotation;(n.subject.x1||n.subject.x2)&&n.data&&t.y&&(n.y=t.y(n.data)),!n.subject.x1&&!n.subject.x2||n.x||(n.x=n.subject.x1||n.subject.x2)}},{key:"mapX",value:function(t){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapX",this).call(this,t);var n=this.annotation;(n.subject.y1||n.subject.y2)&&n.data&&t.x&&(n.x=t.x(n.data)),!n.subject.y1&&!n.subject.y2||n.y||(n.y=n.subject.y1||n.subject.y2)}}]),e}(F),G=D(V,{className:"callout xythreshold",subject:{type:"threshold"}}),H=function(t,e,n,i,r){var o=t.selectAll(n+"."+(r||i)).data(e);return o.enter().append(n).merge(o).attr("class",i),o.exit().remove(),t},W=function(t,e,n){var i=n.component,r=n.name;i&&i.on("mouseover.annotations",(function(){t.call(r+"over",i,e)})).on("mouseout.annotations",(function(){return t.call(r+"out",i,e)})).on("click.annotations",(function(){return t.call(r+"click",i,e)}))},X=function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each((function(){for(var t=e.select(this),o=t.text().split(i||/[ \t\r\n]+/).reverse().filter((function(t){return""!==t})),a=void 0,s=[],l=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");a=o.pop();)s.push(a),l.text(s.join(" ")),l.node().getComputedTextLength()>n&&s.length>1&&(s.pop(),l.text(s.join(" ")),s=[a],l=t.append("tspan").attr("x",0).attr("dy",r+"em").text(a))}))},Y=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(e).nodes().reduce((function(t,e){var n=e.getBBox();t.x=Math.min(t.x,n.x),t.y=Math.min(t.y,n.y),t.width=Math.max(t.width,n.width);var i=e&&e.attributes&&e.attributes.y;return t.height=Math.max(t.height,(i&&parseFloat(i.value)||0)+n.height),t}),{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function Z(){var t=[],n=void 0,i=void 0,o=[],a={},s={},l=!1,c=void 0,u=F,h=void 0,p=void 0,m=r.dispatch("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart","textover","textout","textclick"),g=void 0,v=function(i){g=i,l||i.selectAll("circle.handle").remove();var r=t.map((function(t){return t.type||(t.type=u),t.disable||(t.disable=o),new f(t)}));n=n||new d({annotations:r,accessors:a,accessorsInverse:s,ids:c}),i.selectAll("g").data([n]).enter().append("g").attr("class","annotations");var v=i.select("g.annotations");H(v,n.annotations,"g","annotation");var y=v.selectAll("g.annotation");y.each((function(t){var n=e.select(this);n.attr("class","annotation"),H(n,[t],"g","annotation-connector"),H(n,[t],"g","annotation-subject"),H(n,[t],"g","annotation-note"),H(n.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:n,annotation:t,textWrap:h,notePadding:p,editMode:l,dispatcher:m,accessors:a}),t.type.draw(),t.type.drawText&&t.type.drawText()}))};return v.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",n.json),window.copy(JSON.stringify(n.json.map((function(t){return delete t.type,t})))),v},v.update=function(){return t&&n&&(t=n.annotations.map((function(t){return t.type.draw(),t}))),v},v.updateText=function(){return n&&(n.updateText(h),t=n.annotations),v},v.updatedAccessors=function(){return n.setPositionWithAccessors(),t=n.annotations,v},v.disable=function(e){return arguments.length?(o=e,n&&(n.updateDisable(o),t=n.annotations),v):o},v.textWrap=function(e){return arguments.length?(h=e,n&&(n.updateTextWrap(h),t=n.annotations),v):h},v.notePadding=function(e){return arguments.length?(p=e,n&&(n.updateNotePadding(p),t=n.annotations),v):p},v.type=function(e,i){return arguments.length?(u=e,n&&(n.annotations.map((function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=u,t.subject=i&&i.subject||t.subject,t.connector=i&&i.connector||t.connector,t.note=i&&i.note||t.note})),t=n.annotations),v):u},v.annotations=function(e){if(!arguments.length)return n&&n.annotations||t;if(t=e,n&&n.annotations){var i=t.some((function(t){return!t.type||"[object Object]"!==t.type.toString()}));i?(n=null,v(g)):n.annotations=t}return v},v.context=function(t){return arguments.length?(i=t,v):i},v.accessors=function(t){return arguments.length?(a=t,v):a},v.accessorsInverse=function(t){return arguments.length?(s=t,v):s},v.ids=function(t){return arguments.length?(c=t,v):c},v.editMode=function(e){return arguments.length?(l=e,g&&g.selectAll("g.annotation").classed("editable",l),n&&(n.editMode(l),t=n.annotations),v):l},v.collection=function(t){return arguments.length?(n=t,v):n},v.on=function(){var t=m.on.apply(m,arguments);return t===m?v:t},v}var Q={annotation:Z,annotationTypeBase:I,annotationLabel:N,annotationCallout:F,annotationCalloutCurve:z,annotationCalloutElbow:B,annotationCalloutCircle:k,annotationCalloutRect:j,annotationXYThreshold:G,annotationBadge:U,annotationCustomType:D};t.annotation=Z,t.annotationTypeBase=I,t.annotationLabel=N,t.annotationCallout=F,t.annotationCalloutCurve=z,t.annotationCalloutElbow=B,t.annotationCalloutCircle=k,t.annotationCalloutRect=j,t.annotationXYThreshold=G,t.annotationBadge=U,t.annotationCustomType=D,t.default=Q,Object.defineProperty(t,"__esModule",{value:!0})}(e,n(25),n(569),n(568),n(61))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(139),r=n(5).Component,o=n(5).registerComponent;function a(e,n){var i=r.call(this,e,n);return this.name="soap",this.type="Soap",this.soap=null,this.cubeRenderTarget=new t.WebGLCubeRenderTarget(1,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding}),this.cubeCamera=new t.CubeCamera(.1,5e3,this.cubeRenderTarget),this.oldMaterial=null,i}a.prototype=Object.create(r.prototype),a.prototype.init=function(){var e=this,n=this.entity.object3D;if(!(n instanceof t.Mesh))return TDS_RT.alert("Soap can only be applied to meshes"),this;var r=TDS_RT.program.getScene(this.entity);if(!r)return this;r.add(this.cubeCamera),this.cubeCamera.position.copy(n.position),this.oldMaterial=this.entity.material;var o=t.UniformsUtils.clone(i.a.uniforms);return o.tCube.value=this.cubeCamera.renderTarget,this.entity.material=new t.ShaderMaterial({uniforms:o,vertexShader:i.a.vertexShader,fragmentShader:i.a.fragmentShader}),this.entity.onBeforeRender=function(t,n,i){e.entity.visible=!1,e.cubeCamera.update(t,n),e.entity.visible=!0},this},a.prototype.update=function(t){},a.prototype.destroy=function(){this.entity.material=this.oldMaterial,this.entity.material.needsUpdate=!0},e.default=o("soap",a)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(5).Component,r=n(5).registerComponent;function o(e,n){var r=i.call(this,e,n);return this.name="mirror",this.type="Mirror",this.mirror=null,this.cubeRenderTarget=new t.WebGLCubeRenderTarget(256,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding}),this.cubeCamera=new t.CubeCamera(.1,1e3,this.cubeRenderTarget),this.oldMaterial=null,this.refractionRatio=.98,this.reflectivity=.9,r}o.prototype=Object.create(i.prototype),o.prototype.init=function(){var e=this,n=this.entity.object3D;if(!(n instanceof t.Mesh))return TDS_RT.alert("Mirror can only be applied to meshes"),this;if(!TDS_RT.program.getScene(this.entity))return this;this.cubeCamera.position.copy(n.position),this.oldMaterial=this.entity.material;var i=new t.MeshPhongMaterial({color:this.entity.material.color,map:this.entity.material.map,envMap:this.cubeCamera.renderTarget.texture,refractionRatio:this.refractionRatio,reflectivity:this.reflectivity});return this.entity.material=i,this.entity.onBeforeRender=function(t,n,i){e.entity.visible=!1,e.cubeCamera.update(t,n),e.entity.visible=!0,e.entity.material.envMap=e.cubeRenderTarget.texture},this},o.prototype.update=function(t){},o.prototype.destroy=function(){this.entity.material=this.oldMaterial,this.entity.material.needsUpdate=!0},e.default=r("mirror",o)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(5).Component,r=n(5).registerComponent;function o(e,n){var r=i.call(this,e,n);return this.name="clearcoat",this.type="ClearCoat",this.cubeRenderTarget=new t.WebGLCubeRenderTarget(1,{format:t.RGBFormat,generateMipmaps:!0,minFilter:t.LinearMipmapLinearFilter,encoding:t.sRGBEncoding}),this.cubeCamera=new t.CubeCamera(.1,5e3,this.cubeRenderTarget),this.oldMaterial=null,this.useCubeCamera=!1,this.clearCoat=null,this.params={envMapIntensity:2,reflectivity:.9,clearcoat:.02},n||this.createObject3D(),r}o.prototype=Object.create(i.prototype),o.prototype.createObject3D=function(){if(this.clearCoat)return this;var e=this.entity.object3D;if(!(e instanceof t.Mesh))return TDS_RT.alert("ClearCoat can only be applied to meshes"),this;this.cubeCamera.position.copy(e.position),this.oldMaterial=this.entity.material;var n=this.entity.material.envMap;this.useCubeCamera&&(n=this.cubeRenderTarget.texture),this.clearCoat=new t.MeshPhysicalMaterial({roughness:.01,metalness:.1,map:this.entity.material.map,color:this.entity.material.color,side:t.FrontSide,envMap:n,envMapIntensity:this.params.envMapIntensity,reflectivity:this.params.reflectivity,clearcoat:this.params.clearcoat,premultipliedAlpha:!0}),this.entity.material=this.clearCoat,this.entity.material.needsUpdate=!0,this.updateCubeCamera()},o.prototype.init=function(){TDS_RT.program.getScene(this.entity);return this},o.prototype.updateCubeCamera=function(){if(this.entity){var t=this;this.useCubeCamera?this.entity.onBeforeRender=function(e,n,i){t.entity.visible=!1,t.cubeCamera.update(e,n),t.entity.visible=!0,t.entity.material.envMap=t.cubeRenderTarget.texture}:(this.entity.onBeforeRender=()=>{},t.entity.material.envMap=this.oldMaterial.envMap)}},o.prototype.update=function(t){},o.prototype.destroy=function(){this.entity.material=this.oldMaterial,this.clearCoat=null},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={useCubeCamera:this.useCubeCamera},t},o.prototype.fromJSON=function(t,e){return i.prototype.fromJSON.call(this,t,e),this.useCubeCamera=t.useCubeCamera,this},e.default=r("clearcoat",o)}.call(this,n(0))},function(t,n,i){"use strict";i.r(n),function(t){var r=i(456),o=i(98),a=i(5).Component,s=i(5).registerComponent;function l(e){var n=a.call(this,e);return this.name="outline",this.type="Outline",this.params={visibleEdgeColor:new t.Color(1,1,1),hiddenEdgeColor:new t.Color(.1,.04,.02),edgeStrength:3,edgeGlow:0,edgeThickness:1,pulsePeriod:0,usePatternTexture:!1},this.highlightOnHover=!1,this.raycaster=new t.Raycaster,this.scene=null,this.composer=null,this.outlinePass=null,this.fxaaPass=null,n}l.prototype=Object.create(a.prototype),l.prototype.init=function(){if("Scene"!==this.entity.type)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var e=this.scene=this.entity,n=e.root.canvas,i=e.camera;return i?(this.composer=i.composer,this.outlinePass||(this.outlinePass=new r.a(new t.Vector2(window.innerWidth,window.innerHeight),e.object3D,i),this.composer.addPass(this.outlinePass),this.fxaaPass=new o.a,this.fxaaPass.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),this.updateComposer(this.fxaaPass)),n&&this.setupMouseControls(i,n),this):this},l.prototype.resize=function(t,e){t*e!=0&&(this.outlinePass&&this.outlinePass.setSize(t,e),this.fxaaPass&&this.fxaaPass.setSize(t,e))},l.prototype.updateComposer=function(t){var e=this.composer;t.renderToScreen=!0;for(var n=0;n<e.passes.length;n++)e.passes[n].renderToScreen=!1;e.addPass(t)},l.prototype.update=function(t){if(this.outlinePass&&(this.outlinePass.visibleEdgeColor=this.params.visibleEdgeColor,this.outlinePass.hiddenEdgeColor=this.params.hiddenEdgeColor,this.outlinePass.edgeStrength=this.params.edgeStrength,this.outlinePass.edgeGlow=this.params.edgeGlow,this.outlinePass.edgeThickness=this.params.edgeThickness,this.outlinePass.pulsePeriod=this.params.pulsePeriod,this.highlightOnHover)){this.outlinePass.selectedObjects=[];var n=this.intersectObjects(camera,domElement,e);n&&this.outlinePass.selectedObjects.push(n.object)}},l.prototype.intersectObjects=function(e,n,i){var r=n.getBoundingClientRect(),o=new t.Vector2(i.clientX-r.left,i.clientY-r.top),a=new t.Vector2(o.x/n.width*2-1,-2*o.y/n.height+1);this.raycaster.setFromCamera(a,e);var s=this.raycaster.intersectObjects([this.entity.object3D],!0);return s.length>0&&s[0]},l.prototype.setupMouseControls=function(t,e){var n=this;function i(i){n.outlinePass.selectedObjects=[];var r=n.intersectObjects(t,e,i);r&&n.outlinePass.selectedObjects.push(r.object)}e.onpointerdown=t=>{i(t)},e.ontouchstart=t=>{i(t)}},l.prototype.dispose=function(){if(this.composer){var t=this.composer.passes,e=t.indexOf(this.outlinePass);e>-1&&t.splice(e,1),(e=t.indexOf(this.fxaaPass))>-1&&t.splice(e,1)}this.outlinePass=null},l.prototype.toJSON=function(){var t=a.prototype.toJSON.call(this);return t.properties={params:{visibleEdgeColor:this.params.visibleEdgeColor,hiddenEdgeColor:this.params.hiddenEdgeColor,edgeStrength:this.params.edgeStrength,edgeGlow:this.params.edgeGlow,edgeThickness:this.params.edgeThickness,pulsePeriod:this.params.pulsePeriod,usePatternTexture:this.params.usePatternTexture}},t},l.prototype.fromJSON=function(e,n){var i=a.prototype.fromJSON.call(e,n);return this.params=i.properties.params,this.params.visibleEdgeColor=new t.Color(i.properties.params.visibleEdgeColor.r,i.properties.params.visibleEdgeColor.g,i.properties.params.visibleEdgeColor.b),this.params.hiddenEdgeColor=new t.Color(i.properties.params.hiddenEdgeColor.r,i.properties.params.hiddenEdgeColor.g,i.properties.params.hiddenEdgeColor.b),i},n.default=s("outline",l)}.call(this,i(0))},function(t,e,n){"use strict";n.r(e);var i=n(457),r=n(5).Component,o=n(5).registerComponent;function a(t,e){var n=r.call(this,t,e);return this.name="godrays",this.type="GodRays",this.scene=null,this.camera=null,this.composer=null,this.godrayPass=null,n}a.IS_EXPOSED=!1,a.prototype=Object.create(r.prototype),a.prototype.init=function(){if("Scene"!==this.entity.type)return TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null;var t=this.scene=TDS_RT.program.getActiveScene(),e=TDS_RT.program.getActiveCanvas(t),n=TDS_RT.program.getActiveCamera(t);return n=t.camera?t.camera:t.defaultCamera,this.composer=n.composer,this.godrayPass=new i.a(e),this.updateComposer(this.godrayPass),this},a.prototype.updateComposer=function(t){var e=this.composer;t.renderToScreen=!0;for(var n=0;n<e.passes.length;n++)e.passes[n].renderToScreen=!1;e.addPass(t)},a.prototype.update=function(t){this.godrayPass},a.prototype.enable=function(t){this.godrayPass&&(this.godrayPass.enabled=t),this.enabled?this.composer.addPass(this.godrayPass):this.composer.removePass(this.godrayPass)},a.prototype.reload=function(){this.godrayPass&&(this.godrayPass.setBackgroundColor(this.godrayPass.bgColor),this.godrayPass.setSunColor(this.godrayPass.sunColor))},a.prototype.dispose=function(){},e.default=o("godrays",a)},function(t,e,n){"use strict";n.r(e),function(t){n(87),n(543),n(544);var i=n(5).Component,r=n(5).registerComponent;function o(e,n){var r=i.call(this,e,n);return this.name="noise",this.type="Noise",this.params={color:new t.Color(1,1,1),indentify:1},n||this.createObject3D(),r}o.IS_EXPOSED=!1,o.prototype=Object.create(i.prototype),o.prototype.init=function(){},o.prototype.createObject3D=function(){var e=this.entity.object3D;if(!(e instanceof t.Mesh))return TDS_RT.alert("Noise can only be applied to meshes"),null;var n={uniforms:{size:{value:1},color:{type:"vec3",value:new t.Color(16777215)},center:{type:"vec3",value:new t.Vector3},u_data:{value:null}},vertexShader:["varying vec3 vUv;","void main() {","    vUv = position;","    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["float rand(vec2 co){","    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","","varying vec3 vUv;","void main() {","    vec3 color = vec3(0.);","    color = vec3(rand(vUv.xy), rand(vUv.yz), rand(vUv.xz));","    gl_FragColor = vec4( color, 0.5 );","}"].join("\n")},i=new t.ShaderMaterial({vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms,side:t.BackSide}),r=e.geometry;if(r=r||new t.SphereBufferGeometry(1500,16,16),this.noise=new t.Mesh(r,i),this.entity.hasComponent("Mesh")){this.noise.position.copy(this.entity.position),this.noise.rotation.copy(this.entity.rotation),this.noise.scale.copy(this.entity.scale);var o=this.entity.getComponent("Mesh");scene.object3D.remove(this.entity.object3D),this.entity.object3D=o.object3D=this.noise,scene.object3D.add(this.noise)}return this},o.prototype.update=function(t){},e.default=r("noise",o)}.call(this,n(0))},function(t,e,n){"use strict";var i=n(43),r=function(t,e,n,r,o){i.a.call(this),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};r.prototype=Object.assign(Object.create(i.a.prototype),{constructor:r,render:function(t,e,n){var i,r,o,a=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(i=t.getClearColor().getHex(),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(i,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=a}})},function(t,e,n){"use strict";var i=n(0),r=n(43),o=function(t,e){r.a.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof i.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=i.UniformsUtils.clone(t.uniforms),this.material=new i.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new r.a.FullScreenQuad(this.material)};o.prototype=Object.assign(Object.create(r.a.prototype),{constructor:o,render:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}})},function(t,e,n){"use strict";n.r(e),function(t){var i=n(474),r=n(115),o=n(458),a=n(167),s=(n(241),n(3)),l=(n(188),n(5).Component),c=n(5).registerComponent;function u(t,e){var n=l.call(this,t,e);return this.name="volume",this.type="Volume",this.params={clim1:0,clim2:1,renderstyle:"iso",isothreshold:.15,colormap:"viridis"},this.visFile="",this.visData=null,n}u.IS_EXPOSED=!1,u.prototype=Object.create(l.prototype),u.prototype.init=function(){var e=this.entity.object3D;if(!1===a.a.isWebGL2Available())return TDS_RT.alert("Volume needs webgl2 support."),null;if(!(e instanceof t.Mesh))return TDS_RT.alert("Volume can only be applied to meshes"),null;var n=null,l=TDS_RT.program.getScene(this.entity);if(!l.root.canvas)return this;if(l.root.canvas,n=l.camera?l.camera:l.defaultCamera,this.visData){n.up.set(0,0,1);var c=(new i.a).parse(this.visData),u=(c=new r.a(c.xLength,c.yLength,c.zLength,"float",c.data),new t.DataTexture3D(c.data,c.xLength,c.yLength,c.zLength));u.format=t.RedFormat,u.type=t.FloatType,u.minFilter=u.magFilter=t.LinearFilter,u.unpackAlignment=1;var h={viridis:(new t.TextureLoader).load(s.a.getImg("CM_VIRIDIS"),this.update),gray:(new t.TextureLoader).load(s.a.getImg("CM_GRAY"),this.update)},f=o.a,d=t.UniformsUtils.clone(f.uniforms);d.u_data.value=u,d.u_size.value.set(c.xLength,c.yLength,c.zLength),d.u_clim.value.set(this.params.clim1,this.params.clim2),d.u_renderstyle.value="mip"==this.params.renderstyle?0:1,d.u_renderthreshold.value=this.params.isothreshold,d.u_cmdata.value=h[this.params.colormap];var p=new t.ShaderMaterial({uniforms:d,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,side:t.BackSide}),m=new t.BoxBufferGeometry(c.xLength,c.yLength,c.zLength);m.translate(c.xLength/2-.5,c.yLength/2-.5,c.zLength/2-.5),e.geometry=m,e.material=p,e.castShadow=!1,e.scale.set(1/c.xLength,1/c.xLength,1/c.xLength)}return this},u.prototype.reload=function(){this.init()},u.prototype.update=function(t){},e.default=c("volume",u)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(115),r=n(459),o=n(167),a=(n(241),n(3)),s=n(5).Component,l=n(5).registerComponent;function c(t,e){var n=s.call(this,t,e);return this.name="volume-fog",this.type="VolumeFog",this.volume=null,this.params={clim1:0,clim2:1,colormap:"gray"},this.start=0,this.camera=null,n}c.IS_EXPOSED=!1,c.prototype=Object.create(s.prototype),c.prototype.init=function(){var e=this.entity.object3D;if(!1===o.a.isWebGL2Available())return TDS_RT.alert("VolumeFog needs webgl2 support."),null;if(!(e instanceof t.Mesh))return TDS_RT.alert("VolumeFog can only be applied to meshes"),null;var n=TDS_RT.program.getScene(this.entity);if(!n.root.canvas)return this;n.root.canvas,this.camera=n.camera?n.camera:n.defaultCamera,null===e.geometry.boundingBox&&e.geometry.computeBoundingBox();var s=new t.Vector3;e.geometry.boundingBox.getSize(s);var l=s.clone();l.set(100*Math.round(l.x),100*Math.round(l.y),100*Math.round(l.z));for(var c=new Float32Array(l.x*l.y*l.z),u=(e.position,0);u<l.x;++u)for(var h=0;h<l.y;++h)for(var f=0;f<l.z;++f)c[f+h*l.x+u*l.y*l.x]=.1;var d=new i.a(l.x,l.y,l.z,"float",c),p=new t.DataTexture3D(d.data,d.xLength,d.yLength,d.zLength);p.format=t.RedFormat,p.type=t.FloatType,p.minFilter=p.magFilter=t.LinearFilter,p.unpackAlignment=1;var m=new t.BoxBufferGeometry(s.x,s.y,s.z,d.xLength,d.yLength,d.zLength);e.geometry=m,e.castShadow=!1;var g={viridis:(new t.TextureLoader).load(a.a.getImg("CM_VIRIDIS"),this.update),gray:(new t.TextureLoader).load(a.a.getImg("CM_GRAY"),this.update),noise:(new t.TextureLoader).load(a.a.getImg("CM_NOISE"),this.update)},v=r.a,y=t.UniformsUtils.clone(v.uniforms);y.u_data.value=p,y.u_size.value.set(s.x,s.y,s.z),y.u_cmdata.value=g[this.params.colormap],y.u_camera={type:"v3",value:this.camera.position},y.u_object={type:"v3",value:e.position};var x=new t.ShaderMaterial({uniforms:y,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,transparent:!0,side:t.BackSide});e.material=x,this.start=Date.now()},c.prototype.update=function(t){if(this&&this.entity){var e=this.entity.object3D;e.material.uniforms.time.value=25e-5*(Date.now()-this.start),e.material.uniforms.u_camera={type:"v3",value:this.camera.position}}},e.default=l("volume-fog",c)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(67);var i=n(176),r=(n(12),n(3)),o=n(17),a=n(5).Component,s=n(5).registerComponent;function l(e,n){var s=a.call(this,e,n);return this.name="teleport",this.type="Teleport",this.teleport=null,this.uniforms=t.UniformsUtils.clone(i.a.uniforms),this.tex=new o.a(r.a.getImg("Noise")),this.uniforms.u_noise.value=this.tex,s}l.prototype=Object.create(a.prototype),l.prototype.init=function(){var e=this;if("Plane"!==this.entity.type)return TDS_RT.alert("Teleport can only be applied to plane."),null;if(this.teleport)return this;var n=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:i.a.vertexShader,fragmentShader:i.a.fragmentShader});return this.entity.material=n,this.teleport=this.entity.object3D,this.teleport.onBeforeRender=function(t,n,i){e.uniforms.u_resolution.value.x=t.domElement.width,e.uniforms.u_resolution.value.y=t.domElement.height},this},l.prototype.update=function(t){this.uniforms.u_time.value+=t},e.default=s("teleport",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(67);var i=n(177),r=n(3),o=n(460),a=n(5).Component,s=n(5).registerComponent;function l(e,n){var r=a.call(this,e,n);return this.name="portal",this.type="Portal",this.portal=null,this.uniforms=t.UniformsUtils.clone(i.a.uniforms),this.loader=new o.a,this.loader.setTranscoderPath("workers/basis/"),r}l.g_text=null,l.prototype=Object.create(a.prototype),l.prototype.init=function(){var t=this;if(!this.entity.hasComponent("Mesh"))return TDS_RT.alert("Portal can only be applied to mesh."),null;if(this.portal)return this;var e=TDS_RT.program.getScene(this.entity),n=TDS_RT.program.getActiveRenderer(e);return n?(this.loader.detectSupport(n),l.g_tex?this.createPortal(l.g_tex):this.loader.load(r.a.get("Door"),(function(e){l.g_tex=e,t.createPortal(e)}),void 0,(function(t){console.error(t)})),this):this},l.prototype.createPortal=function(e){var n=this;e.wrapS=e.wrapT=t.RepeatWrapping,e.encoding=t.sRGBEncoding,this.uniforms.u_tex.value=e;var r=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:i.a.vertexShader,fragmentShader:i.a.fragmentShader});this.entity.material=r,this.portal=this.entity.object3D,this.portal.onBeforeRender=function(t,e,i){n.uniforms.u_resolution.value.x=t.domElement.width,n.uniforms.u_resolution.value.y=t.domElement.height}},l.prototype.dispose=function(){},l.prototype.update=function(t){this.entity.scale.z>1&&(this.entity.scale.z=Math.max(this.entity.scale.z-t*this.entity.scale.z,1)),this.uniforms.u_time&&(this.uniforms.u_time.value+=t)},e.default=s("portal",l)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var i=n(127),r=n.n(i),o=n(78),a=n(10),s=n(5).Component,l=n(5).registerComponent,c=new t.Vector2(0,0),u=function(t){t.touches?o.a.to(c,.8,{x:t.clientX||t.pageX||t.touches[0].pageX||0,y:t.clientY||t.pageY||t.touches[0].pageY||0,ease:a.b.easeOut}):o.a.to(c,.8,{x:t.clientX||t.pageX||0,y:t.clientY||t.pageY||0,ease:a.b.easeOut})};["mousemove","touchmove"].forEach((function(t){window.addEventListener(t,u)}));var h=function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)};function f(e,n){var i=s.call(this,e,n);return this.name="gooey",this.type="Gooey",this.params={color:new t.Color(1,1,1),indentify:1},this.gooey=null,this.noise=new r.a,this.time=0,this.vertex=50,this.emissive=12405731,i}f.prototype=Object.create(s.prototype),f.prototype.createBubble=function(){for(var e=this.vertex,n=new t.SphereGeometry(this.entity.width,e,e),i=0;i<n.vertices.length;i++){var r=n.vertices[i];r.original=r.clone()}var o=new t.MeshStandardMaterial({emissive:12405731,emissiveIntensity:.5,roughness:.61,metalness:.21,side:t.FrontSide});this.entity.geometry=n,this.entity.material=o,this.gooey=this.entity.object3D},f.prototype.init=function(){return"Box"!==this.entity.type&&"Sphere"!==this.entity.type?(TDS_RT.alert("Gooey can only be applied to box or sphere."),null):(this.createBubble(),this)},f.prototype.update=function(t){if(this.enabled){this.time+=t;var e=TDS_RT.program.getActiveScene(),n=TDS_RT.program.getActiveCanvas(e),i=n.offsetWidth,r=n.offsetHeight;if(!(i*r<=0)){var o,a,s=h({x:0,y:0},{x:n.width/2,y:n.height/2}),l=h(c,{x:i/2,y:r/2});l=((l/=s)-(o=1))*(1-(a=0))/(0-o)+a;for(var u=this.entity.geometry,f=0;f<u.vertices.length;f++){var d=u.vertices[f];d.copy(d.original);var p=.3*this.noise.noise3D(.6*d.x+.5*this.time,.6*d.y+.5*this.time,.6*d.z)*(l+.1)+.8;d.multiplyScalar(p)}u.verticesNeedUpdate=!0,this.entity.material.emissiveIntensity=Math.sin(5*this.time)}}},e.default=l("gooey",f)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);n(127);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="blink",this.type="Blink",this.params={indentify:1,frequency:5},this.blink=null,this.canvas=null,this.time=0,n}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this.entity.hasComponent("Mesh")?this:(TDS_RT.alert("Blink can only be applied to mesh."),null)},o.prototype.update=function(t){this.time+=t,this.entity.material.opacity=Math.sin(this.time*this.params.frequency)},e.default=r("blink",o)},function(t,e,n){"use strict";n.r(e),function(t){n(127);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="blink",this.type="Twinkle",this.frequency=.8,this.applyToScene=!1,this.time=0,this.scene=null,this.bgColor=null,n}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this.entity.hasComponent("PointLight")?(this.scene=TDS_RT.program.getActiveScene(),this.applyToScene&&(this.scene.background=new t.Color(7433340),this.scene.fog=new t.Fog(this.scene.background,1,5),this.bgColor=this.scene.background.getHSL()),this):(TDS_RT.alert(TDS_RT.locale.hintTwinkleAttachedToLight),null)},o.prototype.update=function(t){this.time+=t,Math.round(this.time)%2&&Math.random()>this.frequency?(this.entity.intensity=.4,this.applyToScene&&this.scene.background.setHSL(this.bgColor.h,this.bgColor.s,this.bgColor.l+.1)):(this.entity.intensity=0,this.applyToScene&&this.scene.background.setHSL(this.bgColor.h,this.bgColor.s,this.bgColor.l))},e.default=r("twinkle",o)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e);n(127);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="flow",this.type="Flow",this.params={speed:1,xForce:1,yForce:1},this.canvas=null,this.time=0,n}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this.entity.hasComponent("Mesh")?this:(TDS_RT.alert("Flow can only be applied to mesh."),null)},o.prototype.update=function(t){this.time+=t,this.entity.material.map&&(this.entity.material.map.offset.x=3*this.time*this.params.speed*this.params.xForce%1,this.entity.material.map.offset.y=3*this.time*this.params.speed*this.params.yForce%1)},e.default=r("flow",o)},function(t,e,n){"use strict";n.r(e);n(93);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="floating",this.type="Floating",this.amplitude=200,this.frequency=5,this.attenuation=0,this.time=0,n}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this},o.prototype.update=function(t){if(this.enabled){this.time+=t;var e=.5*Math.pow(.5,this.attenuation*this.time-1);this.entity.position.y+=Math.sin(this.frequency*this.time)/this.amplitude*e}},o.prototype.dispose=function(){this.time=0},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={amplitude:this.amplitude,frequency:this.frequency,attenuation:this.attenuation},t},e.default=r("floating",o)},function(t,e,n){"use strict";n.r(e);n(93);var i=n(5).Component,r=n(5).registerComponent;function o(t,e){var n=i.call(this,t,e);return this.name="floating",this.type="Waving",this.amplitude=100,this.frequency=5,this.time=0,n}o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this},o.prototype.update=function(t){this.enabled&&(this.time+=t,this.entity.position.x+=Math.sin(this.frequency*this.time)/this.amplitude)},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={amplitude:this.amplitude,frequency:this.frequency},t},e.default=r("waving",o)},function(t,e,n){"use strict";n.r(e),function(t){var i=n(5).Component,r=n(5).registerComponent;function o(e,n,r,a){var s=i.call(this,e,n);return this.name="revolution",this.type="Revolution",this.center=r||new t.Vector3,this.axis=a||new t.Vector3(0,1,0),this.speed=1,this.direction=o.CLOCKWISE,this.r=0,this.time=0,s}o.CLOCKWISE=1,o.COUNTER_CLOCKWISE=-1,o.prototype=Object.create(i.prototype),o.prototype.init=function(){return this},o.prototype.update=function(t){if(this.enabled){this.center.y=this.entity.position.y,this.r=this.entity.position.distanceTo(this.center),this.time+=t;var e=this.time*this.speed;this.entity.position.x=this.r*Math.cos(e),this.entity.position.z=this.direction*this.r*Math.sin(e)}},o.prototype.toJSON=function(){var t=i.prototype.toJSON.call(this);return t.properties={speed:this.speed,direction:this.direction},t},e.default=r("revolution",o)}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){n(239),n(88),n(29);var i=n(135),r=n(5).Component,o=n(5).registerComponent;function a(t,e,n,i){return this.name="physics-multiple",this.type="PhysicsMultiple",this.coordSystem=a.LOCAL,this.bodyLimit=200,this.bodyMap={},this.objectMap={},this.params={type:CANNON.Body.DYNAMIC,mass:1},this.system=n,this.world=void 0!==n?n.world:void 0,this.material=void 0!==i?i:void 0,this.shapeType="BoxGeometry",this.friction=.4,this.restitution=.3,this.upforcePerVolume=100,this.viscosity=.8,_this}a.IS_EXPOSED=!1,a.prototype=Object.create(r.prototype),a.prototype.init=function(){var e=this,n=this.entity.object3D;if(!(n instanceof t.Group||n instanceof t.Scene))return TDS_RT.alert("PhysicsMultiple can only be applied to scene or group"),null;if(void 0===this.world){var r=TDS_RT.program.getScene(this.entity);r&&(this.system=r.physics,this.world=this.system.world)}var o=0;return n.traverse((function(r){if(!(o>=e.bodyLimit)){if(r!==n){var s=new CANNON.Body;s.type=CANNON.Body.DYNAMIC,s.mass=1,s.entity=r.entity,"Water"==e.entity.type&&(e.system.waters.push(s),s.collisionResponse=!1);var l=e.system.materials.ground;if(void 0===e.material){if(e.material=s.material=new CANNON.Material(r.name),s.material.id!=l.id){var c=new CANNON.ContactMaterial(l,s.material,{friction:e.friction,restitution:e.restitution});e.world.addContactMaterial(c)}}else s.material=e.material,(c=e.world.getContactMaterial(l,e.material)).friction=e.friction,c.restitution=e.restitution;if(s.shapes=[],e.addShape(s,i.a.createShape(r,e.shapeType)),e.coordSystem===a.WORLD)s.position.copy(r.position),s.quaternion.copy(r.quaternion);else if(e.coordSystem===a.LOCAL){var u=new t.Vector3;r.getWorldPosition(u),s.position.copy(u);var h=new t.Quaternion;r.getWorldQuaternion(h),s.quaternion.copy(h)}e.bodyMap[s.id]=s,e.objectMap[s.id]=r,e.world.addBody(s)}o++}})),levent.bind(this.entity,"child-reloaded",()=>{}),this},a.prototype.reload=function(){this.init()},a.prototype.attached=function(){},a.prototype.update=function(e){if(this.enabled)for(var n in this.bodyMap){var i=this.bodyMap[n],r=this.objectMap[n];if(this.coordSystem===a.WORLD)r.position.copy(i.position),i.fixedRotation||r.quaternion.copy(i.quaternion);else if(this.coordSystem===a.LOCAL){var o=new t.Matrix4;if(i.fixedRotation)o.setPosition(i.position.x,i.position.y,i.position.z);else{var s=new t.Quaternion;s.copy(i.quaternion),o.makeRotationFromQuaternion(s),o.setPosition(i.position.x,i.position.y,i.position.z)}var l=new t.Matrix4;l.getInverse(r.parent.matrixWorld);var c=new t.Vector3;l.multiply(o),l.decompose(r.position,r.quaternion,c)}}},a.prototype.addShape=function(t,e){e instanceof CANNON.Shape&&t.addShape(e)},a.prototype.dispose=function(){this.bodies=[]},a.prototype.toJSON=function(t){},a.WORLD=100,a.LOCAL=101,e.default=o("physics-multiple",a)}.call(this,n(0))},function(t,e,n){"use strict";n(0)},function(t,e,n){"use strict";(function(t){new t.Color(16777215),new t.Vector3,["varying vec3 vUv;","void main() {","    vUv = position;","    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["float rand(vec2 co){","    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","","varying vec3 vUv;","void main() {","    vec3 color = vec3(0.);","    color = vec3(rand(vUv.xy), rand(vUv.yz), rand(vUv.xz));","    gl_FragColor = vec4( color, 0.5 );","}"].join("\n"),["varying vec2 vUv;","void main() {","    vUv = uv;","    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D u_texture;","varying vec2 vUv;","void main() {","    gl_FragColor = texture2D(u_texture, vUv);","}"].join("\n")}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(465),r=n(12).Entity,o=n(12).registerEntity;function a(t){var e=r.call(this,t);this.className="SkyboxEntity",this.name="Skybox",this.type="Skybox";var n=new i.a((new Date).getHours());return e.addComponent(n),this.object3D=n.object3D,e}a.prototype=Object.create(r.prototype),a.prototype.init=function(){return r.prototype.init.call(this),this},a.prototype.getSkybox=function(){return this.object3D},e.default=o("SkyboxEntity",a)},function(t,e,n){(function(t){var e,n;t.BufferGeometry.prototype.computeBoundingSphere=(e=new t.Box3,n=new t.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new t.Sphere);var i=this.attributes.position;if(i){var r=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(r);for(var o=0,a=i.array,s=a.length,l=0;l<s;l+=3){n.set(a[l],a[l+1],a[l+2]);var c=r.distanceToSquared(n);c>o&&(o=c)}this.boundingSphere.radius=Math.sqrt(o)}}),t.BufferGeometry.prototype.toJSON=function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,t.name=this.name,void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{},morphAttributes:{}};var i=this.index;if(null!==i){var r=Array.prototype.slice.call(i.array);t.data.index={type:i.array.constructor.name,array:r}}var o=this.attributes;for(var n in o){var a=o[n];r=Array.prototype.slice.call(a.array);t.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:r,normalized:a.normalized}}var s=this.morphAttributes;for(var n in s){for(var l=this.morphAttributes[n],c=(r=[],0),u=l.length;c<u;c++){a=l[c];r.push({name:a.name,itemSize:a.itemSize,type:a.array.constructor.name,array:Array.prototype.slice.call(a.array),normalized:a.normalized})}t.data.morphAttributes[n]=r}var h=this.groups;h.length>0&&(t.data.groups=JSON.parse(JSON.stringify(h)));var f=this.boundingSphere;return null!==f&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t}}).call(this,n(0))},function(t,e,n){(function(t){const{Object3D:e}=n(0);function i(t,e){return t.distance-e.distance}function r(t,e,n,i,o){if((void 0===o||t.visible)&&function t(e,n){if(!1===e.receiveRayCast)return!1;if(!0===n){const i=e.parent;return!i||!1!==i.receiveRayCast&&t(i,n)}return!0}(t,!0)&&(t.layers.test(e.layers)&&t.raycast(e,n),!0===i)){const i=t.children;for(let t=0,o=i.length;t<o;t++)r(i[t],e,n,!0)}}t.Raycaster.prototype.intersectObject=function(t,e,n){const o=n||[];return r(t,this,o,e),o.sort(i),o},t.Raycaster.prototype.intersectObjects=function(t,e,n){const o=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(let n=0,i=t.length;n<i;n++)r(t[n],this,o,e);return o.sort(i),o}}).call(this,n(0))},function(t,e,n){(function(t){t.ConvexGeometry=function(e){t.Geometry.call(this),this.fromBufferGeometry(new t.ConvexBufferGeometry(e)),this.mergeVertices()},t.ConvexGeometry.prototype=Object.create(t.Geometry.prototype),t.ConvexGeometry.prototype.constructor=t.ConvexGeometry,t.ConvexBufferGeometry=function(e){t.BufferGeometry.call(this);var n=[],i=[];void 0===t.ConvexHull&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on THREE.ConvexHull");for(var r=(new t.ConvexHull).setFromPoints(e).faces,o=0;o<r.length;o++){var a=r[o],s=a.edge;do{var l=s.head().point;n.push(l.x,l.y,l.z),i.push(a.normal.x,a.normal.y,a.normal.z),s=s.next}while(s!==a.edge)}this.addAttribute("position",new t.Float32BufferAttribute(n,3)),this.addAttribute("normal",new t.Float32BufferAttribute(i,3))},t.ConvexBufferGeometry.prototype=Object.create(t.BufferGeometry.prototype),t.ConvexBufferGeometry.prototype.constructor=t.ConvexBufferGeometry}).call(this,n(0))},function(t,e,n){(function(t){t.OpenBoxBufferGeometry=function(e,n,i,r,o,a){t.BufferGeometry.call(this),this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:a};var s=this,l=function(t,e,n){var i=0,r=0;return i+=(t+1)*(e+1)*2,r+=t*e*2,i+=(t+1)*(n+1)*1,r+=t*n*1,r+=t*n*2,[i+=(t+1)*(n+1)*2,r*=6]}(r=Math.floor(r)||1,o=Math.floor(o)||1,a=Math.floor(a)||1),c=l[0],u=l[1],h=new(u>65535?Uint32Array:Uint16Array)(u),f=new Float32Array(3*c),d=new Float32Array(3*c),p=new Float32Array(2*c),m=0,g=0,v=0,y=0,x=0;function b(e,n,i,r,o,a,l,c,u,b,w){for(var _=a/u,M=l/b,S=a/2,T=l/2,A=c/2,E=u+1,q=b+1,C=0,P=0,R=new t.Vector3,L=0;L<q;L++)for(var I=L*M-T,D=0;D<E;D++){var O=D*_-S;R[e]=O*r,R[n]=I*o,R[i]=A,f[m]=R.x,f[m+1]=R.y,f[m+2]=R.z,R[e]=0,R[n]=0,R[i]=c>0?1:-1,d[m]=R.x,d[m+1]=R.y,d[m+2]=R.z,p[g]=D/u,p[g+1]=1-L/b,m+=3,g+=2,C+=1}for(L=0;L<b;L++)for(D=0;D<u;D++){var N=y+D+E*L,F=y+D+E*(L+1),B=y+(D+1)+E*(L+1),z=y+(D+1)+E*L;h[v]=N,h[v+1]=F,h[v+2]=z,h[v+3]=F,h[v+4]=B,h[v+5]=z,v+=6,P+=6}s.addGroup(x,P,w),x+=P,y+=C}b("z","y","x",-1,-1,i,n,e,a,o,0),b("z","y","x",1,-1,i,n,-e,a,o,1),b("x","z","y",1,-1,e,i,-n,r,a,3),b("x","y","z",1,-1,e,n,i,r,o,4),b("x","y","z",-1,-1,e,n,-i,r,o,5),this.setIndex(new t.BufferAttribute(h,1)),this.addAttribute("position",new t.BufferAttribute(f,3)),this.addAttribute("normal",new t.BufferAttribute(d,3)),this.addAttribute("uv",new t.BufferAttribute(p,2))},t.OpenBoxBufferGeometry.prototype=Object.create(t.BufferGeometry.prototype),t.OpenBoxBufferGeometry.prototype.constructor=t.OpenBoxBufferGeometry}).call(this,n(0))},function(t,e,n){(function(t){t.Texture.prototype.toJSON=function(e){const n=void 0===e||"string"==typeof e;if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:TDS_RT.VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0===this.img&&void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=t.MathUtils.generateUUID()),!n&&void 0===e.images[r.uuid]&&!this.isPMREMTexture&&!this.isCubeTexture){let n;try{if(Array.isArray(r)){n=[];for(let e=0,i=r.length;e<i;e++)n.push(t.ImageUtils.getDataURL(r[e]))}else n=t.ImageUtils.getDataURL(r)}catch(t){console.log("TDS: Warning on saving image ",t)}e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return e.textures[this.uuid]=i,i}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var e=n(92),i=n(85);const{WireframeGeometry:r,ParametricGeometry:o,ParametricBufferGeometry:a,TetrahedronGeometry:s,TetrahedronBufferGeometry:l,OctahedronGeometry:c,OctahedronBufferGeometry:u,IcosahedronGeometry:h,IcosahedronBufferGeometry:f,DodecahedronGeometry:d,DodecahedronBufferGeometry:p,PolyhedronGeometry:m,PolyhedronBufferGeometry:g,TubeGeometry:v,TubeBufferGeometry:y,TorusKnotGeometry:x,TorusKnotBufferGeometry:b,TorusGeometry:w,TorusBufferGeometry:_,TextGeometry:M,TextBufferGeometry:S,SphereGeometry:T,SphereBufferGeometry:A,RingGeometry:E,RingBufferGeometry:q,PlaneGeometry:C,PlaneBufferGeometry:P,LatheGeometry:R,LatheBufferGeometry:L,ShapeGeometry:I,ShapeBufferGeometry:D,ExtrudeGeometry:O,ExtrudeBufferGeometry:N,EdgesGeometry:F,ConeGeometry:B,ConeBufferGeometry:z,CylinderGeometry:U,CylinderBufferGeometry:k,CircleGeometry:j,CircleBufferGeometry:V,BoxGeometry:G,BoxBufferGeometry:H,BufferGeometryLoader:W,Scene:X,Mesh:Y,Fog:Z,FogExp2:Q,PerspectiveCamera:J,OrthographicCamera:K,AmbientLight:$,PointLight:tt,SpotLight:et,DirectionalLight:nt,RectAreaLight:it,HemisphereLight:rt,SkinnedMesh:ot,InstancedMesh:at,Line:st,LineSegments:lt,LOD:ct,LineLoop:ut,Sprite:ht,Group:ft,PointCloud:dt,Points:pt,Object3D:mt}=n(0);var gt=Object.freeze({__proto__:null,WireframeGeometry:r,ParametricGeometry:o,ParametricBufferGeometry:a,TetrahedronGeometry:s,TetrahedronBufferGeometry:l,OctahedronGeometry:c,OctahedronBufferGeometry:u,IcosahedronGeometry:h,IcosahedronBufferGeometry:f,DodecahedronGeometry:d,DodecahedronBufferGeometry:p,PolyhedronGeometry:m,PolyhedronBufferGeometry:g,TubeGeometry:v,TubeBufferGeometry:y,TorusKnotGeometry:x,TorusKnotBufferGeometry:b,TorusGeometry:w,TorusBufferGeometry:_,TextGeometry:M,TextBufferGeometry:S,SphereGeometry:T,SphereBufferGeometry:A,RingGeometry:E,RingBufferGeometry:q,PlaneGeometry:C,PlaneBufferGeometry:P,LatheGeometry:R,LatheBufferGeometry:L,ShapeGeometry:I,ShapeBufferGeometry:D,ExtrudeGeometry:O,ExtrudeBufferGeometry:N,EdgesGeometry:F,ConeGeometry:B,ConeBufferGeometry:z,CylinderGeometry:U,CylinderBufferGeometry:k,CircleGeometry:j,CircleBufferGeometry:V,BoxGeometry:G,BoxBufferGeometry:H,LineGeometry:i.a});t.ObjectLoader.prototype.parse=function(t,e){var n=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),o=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,i,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},t.ObjectLoader.prototype.parseGeometries=function(e,n){var r={};if(void 0!==e)for(var o=new W,a=0,s=e.length;a<s;a++){var l,c=e[a];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":l=new gt[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new gt[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new gt[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new gt[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new gt[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new gt[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new gt[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new gt[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new gt[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new gt[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"TubeGeometry":case"TubeBufferGeometry":l=new gt[c.type]((new Curves[c.path.type]).fromJSON(c.path),c.tubularSegments,c.radius,c.radialSegments,c.closed);break;case"LatheGeometry":case"LatheBufferGeometry":l=new gt[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new gt[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],h=0,f=c.shapes.length;h<f;h++){var d=n[c.shapes[h]];u.push(d)}l=new gt[c.type](u,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],h=0,f=c.shapes.length;h<f;h++){d=n[c.shapes[h]];u.push(d)}var p=c.options.extrudePath;void 0!==p&&(c.options.extrudePath=(new Curves[p.type]).fromJSON(p)),l=new gt[c.type](u,c.options);break;case"BufferGeometry":case"InstancedBufferGeometry":l=o.parse(c);break;case"LineGeometry":l=(new i.a).parse(c);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in t)l=(new t.LegacyJSONLoader).parse(c,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}l.uuid=c.uuid,void 0!==c.name&&(l.name=c.name),!0===l.isBufferGeometry&&void 0!==c.userData&&(l.userData=c.userData),r[c.uuid]=l}return r},t.ObjectLoader.prototype.parseObject=function(t,n,i){var r;function o(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),n[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(i[o])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":r=new X,void 0!==t.background&&Number.isInteger(t.background)&&(r.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new Z(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new Q(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new J(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new K(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new $(t.color,t.intensity);break;case"DirectionalLight":r=new nt(t.color,t.intensity);break;case"PointLight":r=new tt(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new it(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new et(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new rt(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":var s,l=o(t.geometry),c=a(t.material);void 0!==t.skeleton&&void 0!==l.bones&&(s=l.bones,l.bones=void 0),r=new ot(l,c),void 0!==t.skeleton&&(r.skeletonUUID=t.skeleton),void 0!==t.bindMode&&(r.bindMode=t.bindMode),void 0!==t.bindMatrix&&r.bindMatrix.fromArray(t.bindMatrix),r.updateMatrixWorld(!0),void 0!==s&&(l.bones=s);break;case"Mesh":l=o(t.geometry),c=a(t.material);r=l.bones&&l.bones.length>0?new ot(l,c):new Y(l,c);break;case"InstancedMesh":l=o(t.geometry),c=a(t.material);var u=t.count,h=t.instanceMatrix;(r=new at(l,c,u)).instanceMatrix=new BufferAttribute(new Float32Array(h.array),16);break;case"LOD":r=new ct;break;case"Line":r=new st(o(t.geometry),a(t.material),t.mode);break;case"Line2":r=new e.a(o(t.geometry),a(t.material));break;case"LineLoop":r=new ut(o(t.geometry),a(t.material));break;case"LineSegments":r=new lt(o(t.geometry),a(t.material));break;case"PointCloud":case"Points":r=new pt(o(t.geometry),a(t.material));break;case"Sprite":r=new ht(a(t.material));break;case"Group":r=new ft;break;default:r=new mt}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children)for(var f=t.children,d=0;d<f.length;d++)r.add(this.parseObject(f[d],n,i));if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);for(var p=t.levels,m=0;m<p.length;m++){var g=p[m],v=r.getObjectByProperty("uuid",g.object);void 0!==v&&r.addLevel(v,g.distance)}}return r}}.call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){var e=n(168);const{ShadowMaterial:i,ShaderMaterial:r,SpriteMaterial:o,RawShaderMaterial:a,PointsMaterial:s,MeshPhysicalMaterial:l,MeshStandardMaterial:c,MeshPhongMaterial:u,MeshToonMaterial:h,MeshNormalMaterial:f,MeshLambertMaterial:d,MeshDepthMaterial:p,MeshDistanceMaterial:m,MeshBasicMaterial:g,MeshMatcapMaterial:v,LineDashedMaterial:y,LineBasicMaterial:x,Material:b,Color:w,Vector2:_,Vector3:M,Vector4:S,Matrix3:T,Matrix4:A}=n(0);var E=Object.freeze({__proto__:null,ShadowMaterial:i,SpriteMaterial:o,RawShaderMaterial:a,ShaderMaterial:r,PointsMaterial:s,MeshPhysicalMaterial:l,MeshStandardMaterial:c,MeshPhongMaterial:u,MeshToonMaterial:h,MeshNormalMaterial:f,MeshLambertMaterial:d,MeshDepthMaterial:p,MeshDistanceMaterial:m,MeshBasicMaterial:g,MeshMatcapMaterial:v,LineDashedMaterial:y,LineBasicMaterial:x,LineMaterial:e.a,Material:b});t.MaterialLoader.prototype.parse=function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var i=new E[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new w).setHex(t.sheen)),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.uniforms)for(var r in t.uniforms){var o=t.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=(new w).setHex(o.value);break;case"v2":i.uniforms[r].value=(new _).fromArray(o.value);break;case"v3":i.uniforms[r].value=(new M).fromArray(o.value);break;case"v4":i.uniforms[r].value=(new S).fromArray(o.value);break;case"m3":i.uniforms[r].value=(new T).fromArray(o.value);case"m4":i.uniforms[r].value=(new A).fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)i.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap),i.transparent=!0),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new _).fromArray(s)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new _).fromArray(t.clearcoatNormalScale)),i}}.call(this,n(0))},function(t,e,n){(function(t){t.SkinnedMesh.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose(),null!==this.geometry&&this.geometry.dispose(),t.Object3D.prototype.dispose.call(this)},t.SkinnedMesh.prototype.toJSON=function(e){var n=this,i=t.Object3D.prototype.toJSON.call(this,e,(function(t,e){void 0!==n.skeleton&&(void 0===t.skeletons[n.skeleton.uuid]&&(t.skeletons[n.skeleton.uuid]=n.skeleton.toJSON(t)),e.skeleton=n.skeleton.uuid)}));return void 0!==this.bindMode&&(i.object.bindMode=this.bindMode),void 0!==this.bindMatrix&&(i.object.bindMatrix=this.bindMatrix.toArray()),i}}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(652),r=function(t){return function(){return t}},o=Math.PI,a=o/2,s=2*o;function l(t){return t.innerRadius}function c(t){return t.outerRadius}function u(t){return t.startAngle}function h(t){return t.endAngle}function f(t){return t&&t.padAngle}function d(t){return t>=1?a:t<=-1?-a:Math.asin(t)}function p(t,e,n,i,r,o,a,s){var l=n-t,c=i-e,u=a-r,h=s-o,f=(u*(e-o)-h*(t-r))/(h*l-u*c);return[t+f*l,e+f*c]}function m(t,e,n,i,r,o,a){var s=t-n,l=e-i,c=(a?o:-o)/Math.sqrt(s*s+l*l),u=c*l,h=-c*s,f=t+u,d=e+h,p=n+u,m=i+h,g=(f+p)/2,v=(d+m)/2,y=p-f,x=m-d,b=y*y+x*x,w=r-o,_=f*m-p*d,M=(x<0?-1:1)*Math.sqrt(Math.max(0,w*w*b-_*_)),S=(_*x-y*M)/b,T=(-_*y-x*M)/b,A=(_*x+y*M)/b,E=(-_*y+x*M)/b,q=S-g,C=T-v,P=A-g,R=E-v;return q*q+C*C>P*P+R*R&&(S=A,T=E),{cx:S,cy:T,x01:-u,y01:-h,x11:S*(r/w-1),y11:T*(r/w-1)}}var g=function(){var t=l,e=c,n=r(0),g=null,v=u,y=h,x=f,b=null;function w(){var r,l,c=+t.apply(this,arguments),u=+e.apply(this,arguments),h=v.apply(this,arguments)-a,f=y.apply(this,arguments)-a,w=Math.abs(f-h),_=f>h;if(b||(b=r=Object(i.a)()),u<c&&(l=u,u=c,c=l),u>1e-12)if(w>s-1e-12)b.moveTo(u*Math.cos(h),u*Math.sin(h)),b.arc(0,0,u,h,f,!_),c>1e-12&&(b.moveTo(c*Math.cos(f),c*Math.sin(f)),b.arc(0,0,c,f,h,_));else{var M,S,T=h,A=f,E=h,q=f,C=w,P=w,R=x.apply(this,arguments)/2,L=R>1e-12&&(g?+g.apply(this,arguments):Math.sqrt(c*c+u*u)),I=Math.min(Math.abs(u-c)/2,+n.apply(this,arguments)),D=I,O=I;if(L>1e-12){var N=d(L/c*Math.sin(R)),F=d(L/u*Math.sin(R));(C-=2*N)>1e-12?(E+=N*=_?1:-1,q-=N):(C=0,E=q=(h+f)/2),(P-=2*F)>1e-12?(T+=F*=_?1:-1,A-=F):(P=0,T=A=(h+f)/2)}var B=u*Math.cos(T),z=u*Math.sin(T),U=c*Math.cos(q),k=c*Math.sin(q);if(I>1e-12){var j=u*Math.cos(A),V=u*Math.sin(A),G=c*Math.cos(E),H=c*Math.sin(E);if(w<o){var W=C>1e-12?p(B,z,G,H,j,V,U,k):[U,k],X=B-W[0],Y=z-W[1],Z=j-W[0],Q=V-W[1],J=1/Math.sin(Math.acos((X*Z+Y*Q)/(Math.sqrt(X*X+Y*Y)*Math.sqrt(Z*Z+Q*Q)))/2),K=Math.sqrt(W[0]*W[0]+W[1]*W[1]);D=Math.min(I,(c-K)/(J-1)),O=Math.min(I,(u-K)/(J+1))}}P>1e-12?O>1e-12?(M=m(G,H,B,z,u,O,_),S=m(j,V,U,k,u,O,_),b.moveTo(M.cx+M.x01,M.cy+M.y01),O<I?b.arc(M.cx,M.cy,O,Math.atan2(M.y01,M.x01),Math.atan2(S.y01,S.x01),!_):(b.arc(M.cx,M.cy,O,Math.atan2(M.y01,M.x01),Math.atan2(M.y11,M.x11),!_),b.arc(0,0,u,Math.atan2(M.cy+M.y11,M.cx+M.x11),Math.atan2(S.cy+S.y11,S.cx+S.x11),!_),b.arc(S.cx,S.cy,O,Math.atan2(S.y11,S.x11),Math.atan2(S.y01,S.x01),!_))):(b.moveTo(B,z),b.arc(0,0,u,T,A,!_)):b.moveTo(B,z),c>1e-12&&C>1e-12?D>1e-12?(M=m(U,k,j,V,c,-D,_),S=m(B,z,G,H,c,-D,_),b.lineTo(M.cx+M.x01,M.cy+M.y01),D<I?b.arc(M.cx,M.cy,D,Math.atan2(M.y01,M.x01),Math.atan2(S.y01,S.x01),!_):(b.arc(M.cx,M.cy,D,Math.atan2(M.y01,M.x01),Math.atan2(M.y11,M.x11),!_),b.arc(0,0,c,Math.atan2(M.cy+M.y11,M.cx+M.x11),Math.atan2(S.cy+S.y11,S.cx+S.x11),_),b.arc(S.cx,S.cy,D,Math.atan2(S.y11,S.x11),Math.atan2(S.y01,S.x01),!_))):b.arc(0,0,c,q,E,_):b.lineTo(U,k)}else b.moveTo(0,0);if(b.closePath(),r)return b=null,r+""||null}return w.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+v.apply(this,arguments)+ +y.apply(this,arguments))/2-o/2;return[Math.cos(i)*n,Math.sin(i)*n]},w.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:r(+e),w):t},w.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:r(+t),w):e},w.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:r(+t),w):n},w.padRadius=function(t){return arguments.length?(g=null==t?null:"function"==typeof t?t:r(+t),w):g},w.startAngle=function(t){return arguments.length?(v="function"==typeof t?t:r(+t),w):v},w.endAngle=function(t){return arguments.length?(y="function"==typeof t?t:r(+t),w):y},w.padAngle=function(t){return arguments.length?(x="function"==typeof t?t:r(+t),w):x},w.context=function(t){return arguments.length?(b=null==t?null:t,w):b},w};function v(t){this._context=t}v.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var y=function(t){return new v(t)};function x(t){return t[0]}function b(t){return t[1]}var w=function(){var t=x,e=b,n=r(!0),o=null,a=y,s=null;function l(r){var l,c,u,h=r.length,f=!1;for(null==o&&(s=a(u=Object(i.a)())),l=0;l<=h;++l)!(l<h&&n(c=r[l],l,r))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+t(c,l,r),+e(c,l,r));if(u)return s=null,u+""||null}return l.x=function(e){return arguments.length?(t="function"==typeof e?e:r(+e),l):t},l.y=function(t){return arguments.length?(e="function"==typeof t?t:r(+t),l):e},l.defined=function(t){return arguments.length?(n="function"==typeof t?t:r(!!t),l):n},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l},_=function(){var t=x,e=null,n=r(0),o=b,a=r(!0),s=null,l=y,c=null;function u(r){var u,h,f,d,p,m=r.length,g=!1,v=new Array(m),y=new Array(m);for(null==s&&(c=l(p=Object(i.a)())),u=0;u<=m;++u){if(!(u<m&&a(d=r[u],u,r))===g)if(g=!g)h=u,c.areaStart(),c.lineStart();else{for(c.lineEnd(),c.lineStart(),f=u-1;f>=h;--f)c.point(v[f],y[f]);c.lineEnd(),c.areaEnd()}g&&(v[u]=+t(d,u,r),y[u]=+n(d,u,r),c.point(e?+e(d,u,r):v[u],o?+o(d,u,r):y[u]))}if(p)return c=null,p+""||null}function h(){return w().defined(a).curve(l).context(s)}return u.x=function(n){return arguments.length?(t="function"==typeof n?n:r(+n),e=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:r(+e),u):t},u.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:r(+t),u):e},u.y=function(t){return arguments.length?(n="function"==typeof t?t:r(+t),o=null,u):n},u.y0=function(t){return arguments.length?(n="function"==typeof t?t:r(+t),u):n},u.y1=function(t){return arguments.length?(o=null==t?null:"function"==typeof t?t:r(+t),u):o},u.lineX0=u.lineY0=function(){return h().x(t).y(n)},u.lineY1=function(){return h().x(t).y(o)},u.lineX1=function(){return h().x(e).y(n)},u.defined=function(t){return arguments.length?(a="function"==typeof t?t:r(!!t),u):a},u.curve=function(t){return arguments.length?(l=t,null!=s&&(c=l(s)),u):l},u.context=function(t){return arguments.length?(null==t?s=c=null:c=l(s=t),u):s},u},M=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},S=function(t){return t},T=function(){var t=S,e=M,n=null,i=r(0),o=r(s),a=r(0);function l(r){var l,c,u,h,f,d=r.length,p=0,m=new Array(d),g=new Array(d),v=+i.apply(this,arguments),y=Math.min(s,Math.max(-s,o.apply(this,arguments)-v)),x=Math.min(Math.abs(y)/d,a.apply(this,arguments)),b=x*(y<0?-1:1);for(l=0;l<d;++l)(f=g[m[l]=l]=+t(r[l],l,r))>0&&(p+=f);for(null!=e?m.sort((function(t,n){return e(g[t],g[n])})):null!=n&&m.sort((function(t,e){return n(r[t],r[e])})),l=0,u=p?(y-d*b)/p:0;l<d;++l,v=h)c=m[l],h=v+((f=g[c])>0?f*u:0)+b,g[c]={data:r[c],index:l,value:f,startAngle:v,endAngle:h,padAngle:x};return g}return l.value=function(e){return arguments.length?(t="function"==typeof e?e:r(+e),l):t},l.sortValues=function(t){return arguments.length?(e=t,n=null,l):e},l.sort=function(t){return arguments.length?(n=t,e=null,l):n},l.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:r(+t),l):i},l.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:r(+t),l):o},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:r(+t),l):a},l},A=q(y);function E(t){this._curve=t}function q(t){function e(e){return new E(t(e))}return e._curve=t,e}function C(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?e(q(t)):e()._curve},t}E.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};var P=function(){return C(w().curve(A))},R=function(){var t=_().curve(A),e=t.curve,n=t.lineX0,i=t.lineX1,r=t.lineY0,o=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return C(n())},delete t.lineX0,t.lineEndAngle=function(){return C(i())},delete t.lineX1,t.lineInnerRadius=function(){return C(r())},delete t.lineY0,t.lineOuterRadius=function(){return C(o())},delete t.lineY1,t.curve=function(t){return arguments.length?e(q(t)):e()._curve},t},L={draw:function(t,e){var n=Math.sqrt(e/o);t.moveTo(n,0),t.arc(0,0,n,0,s)}},I={draw:function(t,e){var n=Math.sqrt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},D=Math.sqrt(1/3),O=2*D,N={draw:function(t,e){var n=Math.sqrt(e/O),i=n*D;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}},F=Math.sin(o/10)/Math.sin(7*o/10),B=Math.sin(s/10)*F,z=-Math.cos(s/10)*F,U={draw:function(t,e){var n=Math.sqrt(.8908130915292852*e),i=B*n,r=z*n;t.moveTo(0,-n),t.lineTo(i,r);for(var o=1;o<5;++o){var a=s*o/5,l=Math.cos(a),c=Math.sin(a);t.lineTo(c*n,-l*n),t.lineTo(l*i-c*r,c*i+l*r)}t.closePath()}},k={draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},j=Math.sqrt(3),V={draw:function(t,e){var n=-Math.sqrt(e/(3*j));t.moveTo(0,2*n),t.lineTo(-j*n,-n),t.lineTo(j*n,-n),t.closePath()}},G=Math.sqrt(3)/2,H=1/Math.sqrt(12),W=3*(H/2+1),X={draw:function(t,e){var n=Math.sqrt(e/W),i=n/2,r=n*H,o=i,a=n*H+n,s=-o,l=a;t.moveTo(i,r),t.lineTo(o,a),t.lineTo(s,l),t.lineTo(-.5*i-G*r,G*i+-.5*r),t.lineTo(-.5*o-G*a,G*o+-.5*a),t.lineTo(-.5*s-G*l,G*s+-.5*l),t.lineTo(-.5*i+G*r,-.5*r-G*i),t.lineTo(-.5*o+G*a,-.5*a-G*o),t.lineTo(-.5*s+G*l,-.5*l-G*s),t.closePath()}},Y=[L,I,N,k,U,V,X],Z=function(){var t=r(L),e=r(64),n=null;function o(){var r;if(n||(n=r=Object(i.a)()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return o.type=function(e){return arguments.length?(t="function"==typeof e?e:r(e),o):t},o.size=function(t){return arguments.length?(e="function"==typeof t?t:r(+t),o):e},o.context=function(t){return arguments.length?(n=null==t?null:t,o):n},o},Q=function(){};function J(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function K(t){this._context=t}K.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:J(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:J(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var $=function(t){return new K(t)};function tt(t){this._context=t}tt.prototype={areaStart:Q,areaEnd:Q,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:J(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var et=function(t){return new tt(t)};function nt(t){this._context=t}nt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:J(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var it=function(t){return new nt(t)};function rt(t,e){this._basis=new K(t),this._beta=e}rt.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,r=t[0],o=e[0],a=t[n]-r,s=e[n]-o,l=-1;++l<=n;)i=l/n,this._basis.point(this._beta*t[l]+(1-this._beta)*(r+i*a),this._beta*e[l]+(1-this._beta)*(o+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var ot=function t(e){function n(t){return 1===e?new K(t):new rt(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function at(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function st(t,e){this._context=t,this._k=(1-e)/6}st.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:at(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:at(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var lt=function t(e){function n(t){return new st(t,e)}return n.tension=function(e){return t(+e)},n}(0);function ct(t,e){this._context=t,this._k=(1-e)/6}ct.prototype={areaStart:Q,areaEnd:Q,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:at(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ut=function t(e){function n(t){return new ct(t,e)}return n.tension=function(e){return t(+e)},n}(0);function ht(t,e){this._context=t,this._k=(1-e)/6}ht.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:at(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ft=function t(e){function n(t){return new ht(t,e)}return n.tension=function(e){return t(+e)},n}(0);function dt(t,e,n){var i=t._x1,r=t._y1,o=t._x2,a=t._y2;if(t._l01_a>1e-12){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>1e-12){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*c+t._x1*t._l23_2a-e*t._l12_2a)/u,a=(a*c+t._y1*t._l23_2a-n*t._l12_2a)/u}t._context.bezierCurveTo(i,r,o,a,t._x2,t._y2)}function pt(t,e){this._context=t,this._alpha=e}pt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:dt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var mt=function t(e){function n(t){return e?new pt(t,e):new st(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function gt(t,e){this._context=t,this._alpha=e}gt.prototype={areaStart:Q,areaEnd:Q,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:dt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var vt=function t(e){function n(t){return e?new gt(t,e):new ct(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function yt(t,e){this._context=t,this._alpha=e}yt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:dt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var xt=function t(e){function n(t){return e?new yt(t,e):new ht(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function bt(t){this._context=t}bt.prototype={areaStart:Q,areaEnd:Q,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};var wt=function(t){return new bt(t)};function _t(t){return t<0?-1:1}function Mt(t,e,n){var i=t._x1-t._x0,r=e-t._x1,o=(t._y1-t._y0)/(i||r<0&&-0),a=(n-t._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(_t(o)+_t(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function St(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Tt(t,e,n){var i=t._x0,r=t._y0,o=t._x1,a=t._y1,s=(o-i)/3;t._context.bezierCurveTo(i+s,r+s*e,o-s,a-s*n,o,a)}function At(t){this._context=t}function Et(t){this._context=new qt(t)}function qt(t){this._context=t}function Ct(t){return new At(t)}function Pt(t){return new Et(t)}function Rt(t){this._context=t}function Lt(t){var e,n,i=t.length-1,r=new Array(i),o=new Array(i),a=new Array(i);for(r[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<i-1;++e)r[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(r[i-1]=2,o[i-1]=7,a[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)n=r[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(r[i-1]=a[i-1]/o[i-1],e=i-2;e>=0;--e)r[e]=(a[e]-r[e+1])/o[e];for(o[i-1]=(t[i]+r[i-1])/2,e=0;e<i-1;++e)o[e]=2*t[e+1]-r[e+1];return[r,o]}At.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Tt(this,this._t0,St(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Tt(this,St(this,n=Mt(this,t,e)),n);break;default:Tt(this,this._t0,n=Mt(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Et.prototype=Object.create(At.prototype)).point=function(t,e){At.prototype.point.call(this,e,t)},qt.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,o){this._context.bezierCurveTo(e,t,i,n,o,r)}},Rt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var i=Lt(t),r=Lt(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var It=function(t){return new Rt(t)};function Dt(t,e){this._context=t,this._t=e}Dt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var Ot=function(t){return new Dt(t,.5)};function Nt(t){return new Dt(t,0)}function Ft(t){return new Dt(t,1)}var Bt=Array.prototype.slice,zt=function(t,e){if((i=t.length)>1)for(var n,i,r=1,o=t[e[0]],a=o.length;r<i;++r){n=o,o=t[e[r]];for(var s=0;s<a;++s)o[s][1]+=o[s][0]=isNaN(n[s][1])?n[s][0]:n[s][1]}},Ut=function(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n};function kt(t,e){return t[e]}var jt=function(){var t=r([]),e=Ut,n=zt,i=kt;function o(r){var o,a,s=t.apply(this,arguments),l=r.length,c=s.length,u=new Array(c);for(o=0;o<c;++o){for(var h,f=s[o],d=u[o]=new Array(l),p=0;p<l;++p)d[p]=h=[0,+i(r[p],f,p,r)],h.data=r[p];d.key=f}for(o=0,a=e(u);o<c;++o)u[a[o]].index=o;return n(u,a),u}return o.keys=function(e){return arguments.length?(t="function"==typeof e?e:r(Bt.call(e)),o):t},o.value=function(t){return arguments.length?(i="function"==typeof t?t:r(+t),o):i},o.order=function(t){return arguments.length?(e=null==t?Ut:"function"==typeof t?t:r(Bt.call(t)),o):e},o.offset=function(t){return arguments.length?(n=null==t?zt:t,o):n},o},Vt=function(t,e){if((i=t.length)>0){for(var n,i,r,o=0,a=t[0].length;o<a;++o){for(r=n=0;n<i;++n)r+=t[n][o][1]||0;if(r)for(n=0;n<i;++n)t[n][o][1]/=r}zt(t,e)}},Gt=function(t,e){if((n=t.length)>0){for(var n,i=0,r=t[e[0]],o=r.length;i<o;++i){for(var a=0,s=0;a<n;++a)s+=t[a][i][1]||0;r[i][1]+=r[i][0]=-s/2}zt(t,e)}},Ht=function(t,e){if((r=t.length)>0&&(i=(n=t[e[0]]).length)>0){for(var n,i,r,o=0,a=1;a<i;++a){for(var s=0,l=0,c=0;s<r;++s){for(var u=t[e[s]],h=u[a][1]||0,f=(h-(u[a-1][1]||0))/2,d=0;d<s;++d){var p=t[e[d]];f+=(p[a][1]||0)-(p[a-1][1]||0)}l+=h,c+=f*h}n[a-1][1]+=n[a-1][0]=o,l&&(o-=c/l)}n[a-1][1]+=n[a-1][0]=o,zt(t,e)}},Wt=function(t){var e=t.map(Xt);return Ut(t).sort((function(t,n){return e[t]-e[n]}))};function Xt(t){for(var e,n=0,i=-1,r=t.length;++i<r;)(e=+t[i][1])&&(n+=e);return n}var Yt=function(t){return Wt(t).reverse()},Zt=function(t){var e,n,i=t.length,r=t.map(Xt),o=Ut(t).sort((function(t,e){return r[e]-r[t]})),a=0,s=0,l=[],c=[];for(e=0;e<i;++e)n=o[e],a<s?(a+=r[n],l.push(n)):(s+=r[n],c.push(n));return c.reverse().concat(l)},Qt=function(t){return Ut(t).reverse()};n.d(e,"arc",(function(){return g})),n.d(e,"area",(function(){return _})),n.d(e,"line",(function(){return w})),n.d(e,"pie",(function(){return T})),n.d(e,"radialArea",(function(){return R})),n.d(e,"radialLine",(function(){return P})),n.d(e,"symbol",(function(){return Z})),n.d(e,"symbols",(function(){return Y})),n.d(e,"symbolCircle",(function(){return L})),n.d(e,"symbolCross",(function(){return I})),n.d(e,"symbolDiamond",(function(){return N})),n.d(e,"symbolSquare",(function(){return k})),n.d(e,"symbolStar",(function(){return U})),n.d(e,"symbolTriangle",(function(){return V})),n.d(e,"symbolWye",(function(){return X})),n.d(e,"curveBasisClosed",(function(){return et})),n.d(e,"curveBasisOpen",(function(){return it})),n.d(e,"curveBasis",(function(){return $})),n.d(e,"curveBundle",(function(){return ot})),n.d(e,"curveCardinalClosed",(function(){return ut})),n.d(e,"curveCardinalOpen",(function(){return ft})),n.d(e,"curveCardinal",(function(){return lt})),n.d(e,"curveCatmullRomClosed",(function(){return vt})),n.d(e,"curveCatmullRomOpen",(function(){return xt})),n.d(e,"curveCatmullRom",(function(){return mt})),n.d(e,"curveLinearClosed",(function(){return wt})),n.d(e,"curveLinear",(function(){return y})),n.d(e,"curveMonotoneX",(function(){return Ct})),n.d(e,"curveMonotoneY",(function(){return Pt})),n.d(e,"curveNatural",(function(){return It})),n.d(e,"curveStep",(function(){return Ot})),n.d(e,"curveStepAfter",(function(){return Ft})),n.d(e,"curveStepBefore",(function(){return Nt})),n.d(e,"stack",(function(){return jt})),n.d(e,"stackOffsetExpand",(function(){return Vt})),n.d(e,"stackOffsetNone",(function(){return zt})),n.d(e,"stackOffsetSilhouette",(function(){return Gt})),n.d(e,"stackOffsetWiggle",(function(){return Ht})),n.d(e,"stackOrderAscending",(function(){return Wt})),n.d(e,"stackOrderDescending",(function(){return Yt})),n.d(e,"stackOrderInsideOut",(function(){return Zt})),n.d(e,"stackOrderNone",(function(){return Ut})),n.d(e,"stackOrderReverse",(function(){return Qt}))},function(t,e,n){"use strict";n.r(e);var i=n(61),r=n(25);function o(){r.event.stopImmediatePropagation()}var a=function(){r.event.preventDefault(),r.event.stopImmediatePropagation()},s=function(t){var e=t.document.documentElement,n=Object(r.select)(t).on("dragstart.drag",a,!0);"onselectstart"in e?n.on("selectstart.drag",a,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function l(t,e){var n=t.document.documentElement,i=Object(r.select)(t).on("dragstart.drag",null);e&&(i.on("click.drag",a,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var c=function(t){return function(){return t}};function u(t,e,n,i,r,o,a,s,l,c){this.target=t,this.type=e,this.subject=n,this.identifier=i,this.active=r,this.x=o,this.y=a,this.dx=s,this.dy=l,this._=c}function h(){return!r.event.button}function f(){return this.parentNode}function d(t){return null==t?{x:r.event.x,y:r.event.y}:t}function p(){return"ontouchstart"in this}u.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var m=function(){var t,e,n,m,g=h,v=f,y=d,x=p,b={},w=Object(i.dispatch)("start","drag","end"),_=0,M=0;function S(t){t.on("mousedown.drag",T).filter(x).on("touchstart.drag",q).on("touchmove.drag",C).on("touchend.drag touchcancel.drag",P).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function T(){if(!m&&g.apply(this,arguments)){var i=R("mouse",v.apply(this,arguments),r.mouse,this,arguments);i&&(Object(r.select)(r.event.view).on("mousemove.drag",A,!0).on("mouseup.drag",E,!0),s(r.event.view),o(),n=!1,t=r.event.clientX,e=r.event.clientY,i("start"))}}function A(){if(a(),!n){var i=r.event.clientX-t,o=r.event.clientY-e;n=i*i+o*o>M}b.mouse("drag")}function E(){Object(r.select)(r.event.view).on("mousemove.drag mouseup.drag",null),l(r.event.view,n),a(),b.mouse("end")}function q(){if(g.apply(this,arguments)){var t,e,n=r.event.changedTouches,i=v.apply(this,arguments),a=n.length;for(t=0;t<a;++t)(e=R(n[t].identifier,i,r.touch,this,arguments))&&(o(),e("start"))}}function C(){var t,e,n=r.event.changedTouches,i=n.length;for(t=0;t<i;++t)(e=b[n[t].identifier])&&(a(),e("drag"))}function P(){var t,e,n=r.event.changedTouches,i=n.length;for(m&&clearTimeout(m),m=setTimeout((function(){m=null}),500),t=0;t<i;++t)(e=b[n[t].identifier])&&(o(),e("end"))}function R(t,e,n,i,o){var a,s,l,c=n(e,t),h=w.copy();if(Object(r.customEvent)(new u(S,"beforestart",a,t,_,c[0],c[1],0,0,h),(function(){return null!=(r.event.subject=a=y.apply(i,o))&&(s=a.x-c[0]||0,l=a.y-c[1]||0,!0)})))return function f(d){var p,m=c;switch(d){case"start":b[t]=f,p=_++;break;case"end":delete b[t],--_;case"drag":c=n(e,t),p=_}Object(r.customEvent)(new u(S,d,a,t,p,c[0]+s,c[1]+l,c[0]-m[0],c[1]-m[1],h),h.apply,h,[d,i,o])}}return S.filter=function(t){return arguments.length?(g="function"==typeof t?t:c(!!t),S):g},S.container=function(t){return arguments.length?(v="function"==typeof t?t:c(t),S):v},S.subject=function(t){return arguments.length?(y="function"==typeof t?t:c(t),S):y},S.touchable=function(t){return arguments.length?(x="function"==typeof t?t:c(!!t),S):x},S.on=function(){var t=w.on.apply(w,arguments);return t===w?S:t},S.clickDistance=function(t){return arguments.length?(M=(t=+t)*t,S):Math.sqrt(M)},S};n.d(e,"drag",(function(){return m})),n.d(e,"dragDisable",(function(){return s})),n.d(e,"dragEnable",(function(){return l}))},function(t,e,n){"use strict";function i(t,e){if(this===window)return new i(t,e);this.img=t.image;var n={opacity:1,blur:10,crop:[0,0,this.img.naturalWidth,this.img.naturalHeight],enableSizeChange:!0,parentElement:document.getElementsByTagName("body")[0],fps:30,fillStyle:"#8ED6FF",enableCollisions:!0,gravityThreshold:3,gravityAngle:Math.PI/2,gravityAngleVariance:0,reflectionScaledownFactor:5,reflectionDropMappingWidth:200,reflectionDropMappingHeight:200,width:this.img.clientWidth,height:this.img.clientHeight,position:"absolute",top:0,left:0};for(var r in n)void 0===t[r]&&(t[r]=n[r]);this.options=t,this.drops=[],this.canvas=e||this.prepareCanvas(),this.prepareBackground(),this.prepareGlass(),this.reflection=this.REFLECTION_MINIATURE,this.trail=this.TRAIL_DROPS,this.gravity=this.GRAVITY_REAL,this.collision=this.COLLISION_SIMPLE}function r(t,e,n,i,r){this.x=Math.floor(e),this.y=Math.floor(n),this.r=Math.random()*r+i,this.rainyday=t,this.context=t.context,this.reflection=t.reflected}function o(){this.r=0,this.g=0,this.b=0,this.next=null}function a(t,e,n){this.resolution=n,this.xc=t,this.yc=e,this.matrix=new Array(t);for(var i=0;i<=t+5;i++){this.matrix[i]=new Array(e);for(var r=0;r<=e+5;++r)this.matrix[i][r]=new s(null)}}function s(t){this.drop=t,this.next=null}n.r(e),i.prototype.prepareCanvas=function(){var t=document.createElement("canvas");return t.style.position=this.options.position,t.style.top=this.options.top,t.style.left=this.options.left,t.width=this.options.width,t.height=this.options.height,this.options.parentElement.appendChild(t),this.options.enableSizeChange&&this.setResizeHandler(),t},i.prototype.setResizeHandler=function(){null!==window.onresize?window.setInterval(this.checkSize.bind(this),100):(window.onresize=this.checkSize.bind(this),window.onorientationchange=this.checkSize.bind(this))},i.prototype.checkSize=function(){var t=this.img.clientWidth,e=this.img.clientHeight,n=this.img.offsetLeft,i=this.img.offsetTop,r=this.canvas.width,o=this.canvas.height,a=this.canvas.offsetLeft,s=this.canvas.offsetTop;r===t&&o===e||(this.canvas.width=t,this.canvas.height=e,this.prepareBackground(),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.prepareReflections()),a===n&&s===i||(this.canvas.offsetLeft=n,this.canvas.offsetTop=i)},i.prototype.animateDrops=function(){this.addDropCallback&&this.addDropCallback();for(var t=this.drops.slice(),e=[],n=0;n<t.length;++n)t[n].animate()&&e.push(t[n]);this.drops=e},i.prototype.prepareReflections=function(){this.reflected=document.createElement("canvas"),this.reflected.width=this.canvas.width/this.options.reflectionScaledownFactor,this.reflected.height=this.canvas.height/this.options.reflectionScaledownFactor,this.reflected.getContext("2d").drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.reflected.width,this.reflected.height)},i.prototype.prepareGlass=function(){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.context=this.glass.getContext("2d")},i.prototype.rain=function(t,e){if(this.reflection!==this.REFLECTION_NONE&&this.prepareReflections(),this.animateDrops(),this.presets=t,this.PRIVATE_GRAVITY_FORCE_FACTOR_Y=.001*this.options.fps/25,this.PRIVATE_BASE_FRICTION=6,this.PRIVATE_GRAVITY_FORCE_FACTOR_X=(Math.PI/2-this.options.gravityAngle)*(.001*this.options.fps)/50,this.options.enableCollisions){for(var n=0,i=0;i<t.length;i++)t[i][0]+t[i][1]>n&&(n=Math.floor(t[i][0]+t[i][1]));if(n>0){var o=Math.ceil(this.canvas.width/n),s=Math.ceil(this.canvas.height/n);this.matrix=new a(o,s,n)}else this.options.enableCollisions=!1}for(i=0;i<t.length;i++)t[i][3]||(t[i][3]=-1);var l=0;this.addDropCallback=function(){var n=(new Date).getTime();if(!(n-l<e)){l=n;var i,o=this.canvas.getContext("2d");o.clearRect(0,0,this.canvas.width,this.canvas.height),o.drawImage(this.background,0,0,this.canvas.width,this.canvas.height);for(var a=0;a<t.length;a++)if(t[a][2]>1||-1===t[a][3]){if(0!==t[a][3]){t[a][3]--;for(var s=0;s<t[a][2];++s)this.putDrop(new r(this,Math.random()*this.canvas.width,Math.random()*this.canvas.height,t[a][0],t[a][1]))}}else if(Math.random()<t[a][2]){i=t[a];break}i&&this.putDrop(new r(this,Math.random()*this.canvas.width,Math.random()*this.canvas.height,i[0],i[1])),o.save(),o.globalAlpha=this.options.opacity,o.drawImage(this.glass,0,0,this.canvas.width,this.canvas.height),o.restore()}}.bind(this)},i.prototype.putDrop=function(t){t.draw(),this.gravity&&t.r>this.options.gravityThreshold&&(this.options.enableCollisions&&this.matrix.update(t),this.drops.push(t))},i.prototype.clearDrop=function(t,e){var n=t.clear(e);if(n){var i=this.drops.indexOf(t);i>=0&&this.drops.splice(i,1)}return n},r.prototype.draw=function(){this.context.save(),this.context.beginPath();var t=this.r;if(this.r=.95*this.r,this.r<3)this.context.arc(this.x,this.y,this.r,0,2*Math.PI,!0),this.context.closePath();else if(this.colliding||this.yspeed>2){if(this.colliding){var e=this.colliding;this.r=1.001*(this.r>e.r?this.r:e.r),this.x+=e.x-this.x,this.colliding=null}var n=1+.1*this.yspeed;this.context.moveTo(this.x-this.r/n,this.y),this.context.bezierCurveTo(this.x-this.r,this.y-2*this.r,this.x+this.r,this.y-2*this.r,this.x+this.r/n,this.y),this.context.bezierCurveTo(this.x+this.r,this.y+n*this.r,this.x-this.r,this.y+n*this.r,this.x-this.r/n,this.y)}else this.context.arc(this.x,this.y,.9*this.r,0,2*Math.PI,!0),this.context.closePath();this.context.clip(),this.r=t,this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},r.prototype.clear=function(t){return this.context.clearRect(this.x-this.r-1,this.y-this.r-2,2*this.r+2,2*this.r+2),t?(this.terminate=!0,!0):this.y-this.r>this.rainyday.canvas.height||this.x-this.r>this.rainyday.canvas.width||this.x+this.r<0},r.prototype.animate=function(){if(this.terminate)return!1;var t=this.rainyday.gravity(this);if(!t&&this.rainyday.trail&&this.rainyday.trail(this),this.rainyday.options.enableCollisions){var e=this.rainyday.matrix.update(this,t);e&&this.rainyday.collision(this,e)}return!t||this.terminate},i.prototype.TRAIL_NONE=function(){},i.prototype.TRAIL_DROPS=function(t){if(!t.trailY||t.y-t.trailY>=100*Math.random()*t.r){t.trailY=t.y;var e=new r(this,t.x+(2*Math.random()-1)*Math.random(),t.y-t.r-5,Math.ceil(t.r/5),0);this.putDrop(e),t.r=Math.sqrt(t.r*t.r-e.r*e.r)}},i.prototype.TRAIL_SMUDGE=function(t){var e=t.y-t.r-3,n=t.x-t.r/2+2*Math.random();e<0||n<0||this.context.drawImage(this.clearbackground,n,e,t.r,2,n,e,t.r,2)},i.prototype.GRAVITY_NONE=function(){return!0},i.prototype.GRAVITY_LINEAR=function(t){return!!this.clearDrop(t)||(t.yspeed?(t.yspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r),t.xspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.draw(),!1)},i.prototype.GRAVITY_REAL=function(t){if(this.clearDrop(t))return!0;if(t.yspeed){var e=this.PRIVATE_BASE_FRICTION+Math.ceil(9.8*Math.random())/(Math.floor(t.r)-this.presets[0][0]+1);t.yspeed+=Math.floor(9.8-e)/30,t.yspeed<0&&(t.yspeed=0),t.xspeed+=Math.floor(t.r)}else t.yspeed=.01,t.xspeed=0;return t.y+=t.yspeed,t.draw(),!1},i.prototype.GRAVITY_NON_LINEAR=function(t){return!!this.clearDrop(t)||(t.collided?(t.collided=!1,t.seed=Math.floor(t.r*Math.random()*this.options.fps),t.skipping=!1,t.slowing=!1):(!t.seed||t.seed<0)&&(t.seed=Math.floor(t.r*Math.random()*this.options.fps),t.skipping=!1===t.skipping,t.slowing=!0),t.seed--,t.yspeed?t.slowing?(t.yspeed/=1.1,t.xspeed/=1.1,t.yspeed<this.PRIVATE_GRAVITY_FORCE_FACTOR_Y&&(t.slowing=!1)):t.skipping?(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X):(t.yspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r),t.xspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),0!==this.options.gravityAngleVariance&&(t.xspeed+=(2*Math.random()-1)*t.yspeed*this.options.gravityAngleVariance),t.y+=t.yspeed,t.x+=t.xspeed,t.draw(),!1)},i.prototype.positiveMin=function(t,e){var n=0;return(n=t<e?t<=0?e:t:e<=0?t:e)<=0?1:n},i.prototype.REFLECTION_NONE=function(){this.context.fillStyle=this.options.fillStyle,this.context.fill()},i.prototype.REFLECTION_MINIATURE=function(t){var e=Math.max((t.x-this.options.reflectionDropMappingWidth)/this.options.reflectionScaledownFactor,0),n=Math.max((t.y-this.options.reflectionDropMappingHeight)/this.options.reflectionScaledownFactor,0),i=this.positiveMin(2*this.options.reflectionDropMappingWidth/this.options.reflectionScaledownFactor,this.reflected.width-e),r=this.positiveMin(2*this.options.reflectionDropMappingHeight/this.options.reflectionScaledownFactor,this.reflected.height-n),o=Math.max(t.x-1.1*t.r,0),a=Math.max(t.y-1.1*t.r,0);this.context.drawImage(this.reflected,e,n,i,r,o,a,2*t.r,2*t.r)},i.prototype.COLLISION_SIMPLE=function(t,e){for(var n,i,r,o=e;null!=o;){var a=o.drop,s=t.r+a.r,l=t.x-a.x,c=t.y-a.y;if(Math.abs(l)<s&&Math.abs(c)<s&&Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))<t.r+a.r){n=a;break}o=o.next}n&&(t.y>n.y?(i=t,r=n):(i=n,r=t),this.clearDrop(r),this.clearDrop(i,!0),this.matrix.remove(i),r.r=Math.sqrt(i.r*i.r+r.r*r.r),r.draw(),r.colliding=i,r.collided=!0)},i.prototype.prepareBackground=function(){this.background=document.createElement("canvas"),this.background.width=this.canvas.width,this.background.height=this.canvas.height,this.clearbackground=document.createElement("canvas"),this.clearbackground.width=this.canvas.width,this.clearbackground.height=this.canvas.height;var t=this.background.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.canvas.width,this.canvas.height),(t=this.clearbackground.getContext("2d")).clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.canvas.width,this.canvas.height),!isNaN(this.options.blur)&&this.options.blur>=1&&this.stackBlurCanvasRGB(this.canvas.width,this.canvas.height,this.options.blur)},i.prototype.stackBlurCanvasRGB=function(t,e,n){var i=[[0,9],[1,11],[2,12],[3,13],[5,14],[7,15],[11,16],[15,17],[22,18],[31,19],[45,20],[63,21],[90,22],[127,23],[181,24]];n|=0;var r,a,s,l,c,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,T=this.background.getContext("2d"),A=T.getImageData(0,0,t,e),E=A.data,q=n+1,C=q*(q+1)/2,P=new o,R=new o,L=P;for(s=1;s<2*n+1;s++)L=L.next=new o,s===q&&(R=L);L.next=P;var I=null,D=null;h=u=0;for(var O,N=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259][n],F=0;F<i.length;++F)if(n<=i[F][0]){O=i[F-1][1];break}for(a=0;a<e;a++){for(y=x=b=f=d=p=0,m=q*(w=E[u]),g=q*(_=E[u+1]),v=q*(M=E[u+2]),f+=C*w,d+=C*_,p+=C*M,L=P,s=0;s<q;s++)L.r=w,L.g=_,L.b=M,L=L.next;for(s=1;s<q;s++)l=u+((t-1<s?t-1:s)<<2),f+=(L.r=w=E[l])*(S=q-s),d+=(L.g=_=E[l+1])*S,p+=(L.b=M=E[l+2])*S,y+=w,x+=_,b+=M,L=L.next;for(I=P,D=R,r=0;r<t;r++)E[u]=f*N>>O,E[u+1]=d*N>>O,E[u+2]=p*N>>O,f-=m,d-=g,p-=v,m-=I.r,g-=I.g,v-=I.b,l=h+((l=r+n+1)<t-1?l:t-1)<<2,f+=y+=I.r=E[l],d+=x+=I.g=E[l+1],p+=b+=I.b=E[l+2],I=I.next,m+=w=D.r,g+=_=D.g,v+=M=D.b,y-=w,x-=_,b-=M,D=D.next,u+=4;h+=t}for(r=0;r<t;r++){for(x=b=y=d=p=f=0,m=q*(w=E[u=r<<2]),g=q*(_=E[u+1]),v=q*(M=E[u+2]),f+=C*w,d+=C*_,p+=C*M,L=P,s=0;s<q;s++)L.r=w,L.g=_,L.b=M,L=L.next;for(c=t,s=1;s<q;s++)u=c+r<<2,f+=(L.r=w=E[u])*(S=q-s),d+=(L.g=_=E[u+1])*S,p+=(L.b=M=E[u+2])*S,y+=w,x+=_,b+=M,L=L.next,s<e-1&&(c+=t);for(u=r,I=P,D=R,a=0;a<e;a++)E[l=u<<2]=f*N>>O,E[l+1]=d*N>>O,E[l+2]=p*N>>O,f-=m,d-=g,p-=v,m-=I.r,g-=I.g,v-=I.b,l=r+((l=a+q)<e-1?l:e-1)*t<<2,f+=y+=I.r=E[l],d+=x+=I.g=E[l+1],p+=b+=I.b=E[l+2],I=I.next,m+=w=D.r,g+=_=D.g,v+=M=D.b,y-=w,x-=_,b-=M,D=D.next,u+=t}T.putImageData(A,0,0)},a.prototype.update=function(t,e){if(t.gid){if(!this.matrix[t.gmx]||!this.matrix[t.gmx][t.gmy])return null;if(this.matrix[t.gmx][t.gmy].remove(t),e)return null;if(t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),!this.matrix[t.gmx]||!this.matrix[t.gmx][t.gmy])return null;this.matrix[t.gmx][t.gmy].add(t);var n=this.collisions(t);if(n&&null!=n.next)return n.next}else{if(t.gid=Math.random().toString(36).substr(2,9),t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),!this.matrix[t.gmx]||!this.matrix[t.gmx][t.gmy])return null;this.matrix[t.gmx][t.gmy].add(t)}return null},a.prototype.collisions=function(t){var e=new s(null),n=e;return e=this.addAll(e,t.gmx-1,t.gmy+1),e=this.addAll(e,t.gmx,t.gmy+1),e=this.addAll(e,t.gmx+1,t.gmy+1),n},a.prototype.addAll=function(t,e,n){if(e>0&&n>0&&e<this.xc&&n<this.yc)for(var i=this.matrix[e][n];null!=i.next;)i=i.next,t.next=new s(i.drop),t=t.next;return t},a.prototype.remove=function(t){this.matrix[t.gmx][t.gmy].remove(t)},s.prototype.add=function(t){for(var e=this;null!=e.next;)e=e.next;e.next=new s(t)},s.prototype.remove=function(t){for(var e=this,n=null;null!=e.next;)n=e,(e=e.next).drop.gid===t.gid&&(n.next=e.next)};var l=n(5).Component,c=n(5).registerComponent,u=function(t,e){var n=l.call(this,t,e);return this.rain=null,this.name="rain",this.type="Rain",this.overlapCanvas=document.createElement("canvas"),this.overlapCanvas.style.position="absolute",this.overlapCanvas.style.top=0,this.overlapCanvas.style.left=0,this.overlapCanvas.style.pointerEvents="none",this.overlapCanvas.style.zIndex="99",n};u.IS_EXPOSED=!1,(u.prototype=Object.create(l.prototype)).init=function(){return"Scene"!==this.entity.type?(TDS_RT.alert(TDS_RT.locale.hintAttachedToScene),null):(levent.bind(TDS_RT,"SCENE_RESIZED",this.resize,this),this)},u.prototype.update=function(t){this.rain&&this.rain.animateDrops()},u.prototype.resize=function(t,e){var n=this,r=this.entity;this.overlapCanvas.width=r.root.canvas.width,this.overlapCanvas.height=r.root.canvas.height,r.root.canvas.parentNode.insertBefore(this.overlapCanvas,r.root.canvas),r.getImageData=!0,levent.bind(TDS_RT,"RENDER_IMAGEDATA_READY",(function(t){var e=new Image;e.onload=function(){n.rain=new i({image:e},n.overlapCanvas),n.rain.rain([[1,2,1e3]]),n.rain.rain([[3,3,.88],[5,5,.9],[6,2,1]],100)},e.src=r.imgData}))};e.default=c("rain",u)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var i=Math.PI,r=2*i,o=r-1e-6;function a(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function s(){return new a}a.prototype=s.prototype={constructor:a,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(t,e,n,r,o){t=+t,e=+e,n=+n,r=+r,o=+o;var a=this._x1,s=this._y1,l=n-t,c=r-e,u=a-t,h=s-e,f=u*u+h*h;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(f>1e-6)if(Math.abs(h*l-c*u)>1e-6&&o){var d=n-a,p=r-s,m=l*l+c*c,g=d*d+p*p,v=Math.sqrt(m),y=Math.sqrt(f),x=o*Math.tan((i-Math.acos((m+f-g)/(2*v*y)))/2),b=x/y,w=x/v;Math.abs(b-1)>1e-6&&(this._+="L"+(t+b*u)+","+(e+b*h)),this._+="A"+o+","+o+",0,0,"+ +(h*d>u*p)+","+(this._x1=t+w*l)+","+(this._y1=e+w*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,a,s,l){t=+t,e=+e,l=!!l;var c=(n=+n)*Math.cos(a),u=n*Math.sin(a),h=t+c,f=e+u,d=1^l,p=l?a-s:s-a;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+h+","+f:(Math.abs(this._x1-h)>1e-6||Math.abs(this._y1-f)>1e-6)&&(this._+="L"+h+","+f),n&&(p<0&&(p=p%r+r),p>o?this._+="A"+n+","+n+",0,1,"+d+","+(t-c)+","+(e-u)+"A"+n+","+n+",0,1,"+d+","+(this._x1=h)+","+(this._y1=f):p>1e-6&&(this._+="A"+n+","+n+",0,"+ +(p>=i)+","+d+","+(this._x1=t+n*Math.cos(s))+","+(this._y1=e+n*Math.sin(s))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}},e.a=s}])}));
//# sourceMappingURL=tds_rt.js.map